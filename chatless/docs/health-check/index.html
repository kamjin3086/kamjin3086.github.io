<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>可用性检查（健康检查） - Chatless Docs</title><link rel="stylesheet" href="/_astro/index.C3i11XiZ.css">
<link rel="stylesheet" href="/_astro/architecture.DH3oK6xB.css"></head> <body class="docs-body"> <div class="docs-container"> <aside class="docs-aside"> <!-- 返回首页链接 --> <a href="/chatless" class="back-to-home"> <img src="/chatless-logo.svg" width="32" alt="Chatless Logo" class="back-logo"> <div class="back-text"> <span class="back-label">返回</span> <span class="back-title">Chatless 首页</span> </div> </a> <div class="docs-search"> <input id="docs-search" type="search" placeholder="搜索文档..." aria-label="搜索文档"> </div> <div class="docs-nav" id="docs-nav"> <ul> <li class="nav-group" aria-collapsed="false"> <button class="nav-group-toggle level1" aria-controls="概述-1" aria-expanded="true">概述</button> <ul id="概述-1"> <ul> <li> <a class="nav-link" href="/chatless/docs">简介</a> </li><li> <a class="nav-link" href="/chatless/docs/getting-started">快速开始</a> </li> </ul> </ul> </li><li class="nav-group" aria-collapsed="false"> <button class="nav-group-toggle level1" aria-controls="功能-1" aria-expanded="true">功能</button> <ul id="功能-1"> <ul> <li> <a class="nav-link" href="/chatless/docs/ui-chat-tools">对话与工具</a> </li><li> <a class="nav-link" href="/chatless/docs/ui-knowledge">知识库（RAG）</a> </li><li> <a class="nav-link" href="/chatless/docs/ui-history">历史记录</a> </li><li> <a class="nav-link" href="/chatless/docs/ui-prompt">Prompt 管理</a> </li><li> <a class="nav-link" href="/chatless/docs/ui-settings">设置</a> </li><li> <a class="nav-link" href="/chatless/docs/ui-about">关于</a> </li> </ul> </ul> </li><li class="nav-group" aria-collapsed="false"> <button class="nav-group-toggle level1" aria-controls="开发与参考-1" aria-expanded="true">开发与参考</button> <ul id="开发与参考-1"> <ul> <li> <a class="nav-link" href="/chatless/docs/build-from-source">从源码构建</a> </li><li> <a class="nav-link" href="/chatless/docs/contributing">贡献指南</a> </li><li> <a class="nav-link" href="/chatless/docs/roadmap">开发计划</a> </li><li> <a class="nav-link" href="/chatless/docs/license">许可证</a> </li><li> <a class="nav-link" href="/chatless/docs/faq">FAQ</a> </li> </ul> </ul> </li><li class="nav-group" aria-collapsed="false"> <button class="nav-group-toggle level1" aria-controls="其他-1" aria-expanded="true">其他</button> <ul id="其他-1"> <ul> <li> <a class="nav-link" href="/chatless/docs/health-check">可用性检查</a> </li> </ul> </ul> </li> </ul> </div> </aside> <main class="docs-main"> <div class="docs-header"> <nav aria-label="Breadcrumb" class="breadcrumbs"> <ol> <li><a href="/chatless">Chatless</a><span class="sep">/</span></li><li><a href="/chatless/docs">Docs</a><span class="sep">/</span></li><li><a href="/chatless/docs">设计</a><span class="sep">/</span></li><li aria-current="page">可用性检查</li> </ol> </nav> <h1 class="docs-title">可用性检查（健康检查）</h1> </div> <article class="docs-content" id="docs-content">   <p>本文档介绍 Chatless 如何判断 AI 提供商服务是否可用，以及推荐的检查策略。</p> <div class="note"> <strong>核心目标</strong>：判断 API 服务是否正常运行（服务可达），而非验证 API 密钥是否有效。
</div> <h2>为什么需要健康检查？</h2> <ul> <li><strong>仅测网络连通性不够</strong>：简单的 ping 或 TCP 连接测试无法确认 API 服务本身是否正常工作</li> <li><strong>避免计费</strong>：使用真实密钥发起测试请求会消耗 API 额度或触发计费，不适合作为频繁的健康检查手段</li> <li><strong>快速诊断</strong>：在用户配置提供商后，快速反馈服务状态，提升体验</li> </ul> <h2>推荐策略：使用错误密钥的最小请求</h2> <p>这是一种安全、高效的检查方法，步骤如下：</p> <ol> <li>构造一个最小的 API 请求（如 <code>GET /v1/models</code> 或 <code>POST /v1/chat/completions</code> 带最小输入）</li> <li>在请求头中使用明确的<strong>错误密钥</strong>（如 <code>Authorization: Bearer sk-invalid</code>）</li> <li>根据响应判断服务状态：
<ul> <li><strong>4xx + 认证错误信息</strong>：说明服务正常，只是密钥无效（符合预期）✓</li> <li><strong>超时 / 连接失败 / 5xx</strong>：说明服务不可用或不稳定 ✗</li> </ul> </li> </ol> <p>这种方法既能验证服务可用性，又不会消耗 API 额度，且能覆盖 DNS、TLS、路由、网关等整个链路的问题。</p> <h2>示例：OpenAI 兼容接口</h2> <p>以下命令展示如何手动测试 OpenAI API 的可用性：</p> <pre><code>curl -sS -X GET \
  -H "Authorization: Bearer sk-invalid" \
  -H "Content-Type: application/json" \
  https://api.openai.com/v1/models
</code></pre> <p><strong>预期结果</strong>：收到 <code>401</code> 或 <code>403</code> 响应，提示认证失败。这说明服务正常，只是密钥无效。</p> <p><strong>异常情况</strong>：如果长时间无响应或返回 <code>5xx</code> 错误，则说明服务不可用或不稳定。</p> <p><em>提示：将 <code>api.openai.com</code> 替换为您使用的提供商或自托管网关的 Base URL 即可。</em></p> <h2>实现建议</h2> <ul> <li><strong>短超时 + 有限重试</strong>：使用较短的超时时间（如 5-10 秒），避免阻塞用户界面</li> <li><strong>控制检查频率</strong>：设置冷却时间（如 1-5 分钟），避免触发服务商的速率限制</li> <li><strong>状态记录与展示</strong>：记录最近一次检查的状态与时间戳，在设置界面向用户展示"服务健康度"</li> <li><strong>高级配置</strong>：在设置中暴露"检查端点""超时/重试次数"等参数，供高级用户自定义</li> </ul> <h2>与真实调用的区别</h2> <table> <thead> <tr><th>健康检查</th><th>真实调用</th></tr> </thead> <tbody> <tr><td>使用错误密钥</td><td>使用用户配置的真实密钥</td></tr> <tr><td>仅判断服务是否可用</td><td>执行实际的 AI 对话或任务</td></tr> <tr><td>不消耗 API 额度</td><td>会消耗 API 额度并可能计费</td></tr> <tr><td>周期性或手动触发</td><td>由用户输入触发</td></tr> </tbody> </table>  </article> <nav class="docs-pager"> <a class="prev" href="/chatless/docs/faq" aria-label="上一页：FAQ">&larr; FAQ</a> <span class="spacer"></span>  </nav> </main> <aside class="docs-toc"> <div class="toc-title">目录</div> <nav id="toc"></nav> </aside> </div> <script type="module" src="/_astro/ChatlessDocsLayout.astro_astro_type_script_index_0_lang.CGjljoP9.js"></script> </body> </html>