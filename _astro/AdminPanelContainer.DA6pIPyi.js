import{j as e,S as A,s as w,M as z}from"./index.CRO4pM4d.js";import{r as a}from"./index.CbBne_R2.js";import"./pako.esm.CMINtMsn.js";function R({githubConfig:g,authToken:S}){const[x,k]=a.useState([]),[u,y]=a.useState(!0),[n,C]=a.useState(new Set),[m,E]=a.useState("all"),[b,I]=a.useState(""),[p,P]=a.useState("date"),[L,M]=a.useState(!1),[f,T]=a.useState(null),[d,c]=a.useState(1),j=20,N=(t,s="info",r=3e3)=>{T({message:t,type:s}),setTimeout(()=>T(null),r)},D=async()=>{y(!0);try{if(g&&S){A.reset();const t=A.create({type:"github-client",owner:g.owner,repo:g.repo,path:g.path,branch:g.branch,token:S});w.setStorage(t);const s=await w.initialize();if(!s.success)throw new Error(s.error||"GitHub åˆå§‹åŒ–å¤±è´¥");const l=(await w.getAll()).filter(i=>!i.isDeleted);k(l),N(`âœ… å·²åŠ è½½ ${l.length} æ¡è®°å¿†`,"success")}else N("âŒ æœªé…ç½® GitHub æˆ–æœªç™»å½•","error")}catch(t){console.error("åŠ è½½æ•°æ®å¤±è´¥:",t),N(`âŒ åŠ è½½å¤±è´¥: ${t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯"}`,"error")}finally{y(!1)}};a.useEffect(()=>{D()},[]);const h=a.useMemo(()=>{let t=x;if(m!=="all"&&(t=t.filter(s=>s.type===m)),b.trim()){const s=b.toLowerCase();t=t.filter(r=>((r.type==="card"?r.content:r.text)?.toLowerCase()||"").includes(s)||r.title?.toLowerCase().includes(s)||r.tags?.some(i=>i.toLowerCase().includes(s)))}return t.sort((s,r)=>{if(p==="date")return new Date(r.date).getTime()-new Date(s.date).getTime();if(p==="type")return(s.type||"memory").localeCompare(r.type||"memory");{const l=s.type==="card"?s.content:s.text,i=r.type==="card"?r.content:r.text;return(l||"").localeCompare(i||"")}}),t},[x,m,b,p]),o=Math.ceil(h.length/j),v=a.useMemo(()=>{const t=(d-1)*j;return h.slice(t,t+j)},[h,d]);a.useEffect(()=>{c(1)},[m,b,p]);const B=a.useMemo(()=>{const t=new Set(x.map(s=>s.type||"text"));return Array.from(t).sort()},[x]),_=t=>{const s=new Set(n);s.has(t)?s.delete(t):s.add(t),C(s)},$=()=>{const t=v.map(l=>l.id),s=t.every(l=>n.has(l)),r=new Set(n);s?t.forEach(l=>r.delete(l)):t.forEach(l=>r.add(l)),C(r)},G=async()=>{if(n.size!==0)try{const t=await w.getAll(),s=new Date,r=t.map(i=>n.has(i.id)?{...i,isDeleted:!0,deletedAt:s,deletedBy:"admin-panel"}:i);await w.save(r),z.saveMemories(r),z.updateSyncTime();const l=r.filter(i=>!i.isDeleted);k(l),N(`âœ… å·²åˆ é™¤ ${n.size} æ¡è®°å¿†`,"success",3e3),C(new Set),M(!1)}catch(t){console.error("åˆ é™¤å¤±è´¥:",t),N(`âŒ åˆ é™¤å¤±è´¥: ${t instanceof Error?t.message:"æœªçŸ¥é”™è¯¯"}`,"error",5e3)}},F=t=>(typeof t=="string"?new Date(t):t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),H=t=>({text:"bg-blue-500/20 text-blue-300",card:"bg-purple-500/20 text-purple-300",index:"bg-green-500/20 text-green-300",arena:"bg-orange-500/20 text-orange-300","arena-v2":"bg-pink-500/20 text-pink-300"})[t||"text"]||"bg-gray-500/20 text-gray-300",O=t=>t.type==="card"||t.type==="index"?t.title||t.content||"æ— æ ‡é¢˜":t.text||"æ— å†…å®¹";return e.jsxs("div",{className:"min-h-screen bg-[#0f0f1e] text-white p-6 overflow-y-auto",style:{height:"100vh",overflowY:"auto"},children:[f&&e.jsx("div",{className:["fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg animate-fade-in max-w-md",f.type==="success"?"bg-green-500/20 border border-green-500/50 text-green-300":f.type==="error"?"bg-red-500/20 border border-red-500/50 text-red-300":f.type==="warning"?"bg-yellow-500/20 border border-yellow-500/50 text-yellow-300":"bg-blue-500/20 border border-blue-500/50 text-blue-300"].join(" "),children:f.message}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-2xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"âš ï¸ ç¡®è®¤åˆ é™¤"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["ä½ ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ",e.jsx("span",{className:"text-red-400 font-bold",children:n.size})," æ¡è®°å¿†å—ï¼Ÿ æ­¤æ“ä½œ",e.jsx("span",{className:"text-red-400",children:"ä¸å¯æ¢å¤"}),"ã€‚"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>M(!1),className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:G,className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg transition-colors font-medium",children:"ç¡®è®¤åˆ é™¤"})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-red-400 to-pink-500 bg-clip-text text-transparent",children:"ðŸ› ï¸ è®°å¿†ç®¡ç†é¢æ¿"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Memory Admin Panel - æ•°æ®ç®¡ç†å·¥å…·"})]}),e.jsxs("a",{href:"/memories",className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"è¿”å›žä¸»åº”ç”¨"]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:e.jsx("button",{onClick:D,className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-2",children:"ðŸ”„ åˆ·æ–°"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"æ€»è®°å¿†æ•°"}),e.jsx("div",{className:"text-2xl font-bold",children:x.length})]}),e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"ç­›é€‰ç»“æžœ"}),e.jsx("div",{className:"text-2xl font-bold",children:h.length})]}),e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4",children:[e.jsx("div",{className:"text-gray-500 text-sm mb-1",children:"å·²é€‰ä¸­"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:n.size})]})]}),e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("input",{type:"text",value:b,onChange:t=>I(t.target.value),placeholder:"æœç´¢å†…å®¹æˆ–æ ‡ç­¾...",className:"flex-1 bg-gray-950/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500/50"}),e.jsxs("select",{value:m,onChange:t=>E(t.target.value),className:"bg-gray-950/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500/50",children:[e.jsx("option",{value:"all",children:"å…¨éƒ¨ç±»åž‹"}),B.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:p,onChange:t=>P(t.target.value),className:"bg-gray-950/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500/50",children:[e.jsx("option",{value:"date",children:"æŒ‰æ—¥æœŸ"}),e.jsx("option",{value:"type",children:"æŒ‰ç±»åž‹"}),e.jsx("option",{value:"content",children:"æŒ‰å†…å®¹"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors text-sm",children:v.every(t=>n.has(t.id))&&v.length>0?"å–æ¶ˆå…¨é€‰":"å…¨é€‰å½“å‰é¡µ"}),e.jsxs("button",{onClick:()=>M(!0),disabled:n.size===0,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:bg-gray-800 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm font-medium",children:["åˆ é™¤é€‰ä¸­ (",n.size,")"]})]})]}),o>1&&e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["ç¬¬ ",d," / ",o," é¡µï¼Œå…± ",h.length," æ¡"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(1),disabled:d===1,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"é¦–é¡µ"}),e.jsx("button",{onClick:()=>c(t=>Math.max(1,t-1)),disabled:d===1,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>c(t=>Math.min(o,t+1)),disabled:d===o,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"ä¸‹ä¸€é¡µ"}),e.jsx("button",{onClick:()=>c(o),disabled:d===o,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"æœ«é¡µ"})]})]}),u?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-950/50 border-b border-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"é€‰æ‹©"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"ç±»åž‹"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"å†…å®¹"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æ ‡ç­¾"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"åˆ›å»ºæ—¶é—´"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-400",children:"æ“ä½œ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:v.map(t=>e.jsxs("tr",{className:"hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.has(t.id),onChange:()=>_(t.id),className:"w-4 h-4 rounded border-gray-600 bg-gray-800 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-900"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${H(t.type)}`,children:t.type||"text"})}),e.jsx("td",{className:"px-4 py-3 max-w-xs",children:(()=>{const s=O(t);return e.jsxs("div",{className:"text-sm text-gray-300 truncate",title:s,children:[s.substring(0,50),s.length>50?"...":""]})})()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.tags?.slice(0,3).map(s=>e.jsxs("span",{className:"px-2 py-0.5 bg-gray-800 rounded text-xs text-gray-400",children:["#",s]},s)),(t.tags?.length||0)>3&&e.jsxs("span",{className:"px-2 py-0.5 text-xs text-gray-500",children:["+",(t.tags?.length||0)-3]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400",children:F(t.date)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>{C(new Set([t.id])),M(!0)},className:"text-red-400 hover:text-red-300 transition-colors text-sm",children:"åˆ é™¤"})})]},t.id))})]})}),v.length===0&&!u&&e.jsx("div",{className:"text-center py-20 text-gray-500",children:b||m!=="all"?"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å¿†":"æš‚æ— è®°å¿†æ•°æ®"})]}),o>1&&e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["æ˜¾ç¤º ",(d-1)*j+1," - ",Math.min(d*j,h.length)," æ¡"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(1),disabled:d===1,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"é¦–é¡µ"}),e.jsx("button",{onClick:()=>c(t=>Math.max(1,t-1)),disabled:d===1,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"ä¸Šä¸€é¡µ"}),e.jsx("button",{onClick:()=>c(t=>Math.min(o,t+1)),disabled:d===o,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"ä¸‹ä¸€é¡µ"}),e.jsx("button",{onClick:()=>c(o),disabled:d===o,className:"px-3 py-1 bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:text-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:"æœ«é¡µ"})]})]}),e.jsx("div",{className:"mt-6 text-center text-gray-600 text-sm",children:"âš ï¸ ç®¡ç†é¢æ¿ä»…ç”¨äºŽæ•°æ®ç®¡ç†ï¼Œè¯·è°¨æ…Žæ“ä½œ"})]})]})}const U={owner:"kamjin3086",repo:"thineasy",path:"memories.json",branch:"data"};function J(){const[g,S]=a.useState(null),[x,k]=a.useState(null);return a.useEffect(()=>{const u=localStorage.getItem("thineasy_auth_token"),y=localStorage.getItem("thineasy_auth_expiry"),n=!!(u&&y&&Date.now()<parseInt(y));S(u),k(n)},[]),x===null?e.jsx("div",{className:"min-h-screen bg-[#0f0f1e] text-white flex items-center justify-center",children:e.jsx("div",{className:"text-xl",children:"åŠ è½½ä¸­..."})}):x?e.jsx(R,{githubConfig:U,authToken:g}):e.jsx("div",{className:"min-h-screen bg-[#0f0f1e] text-white flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-gray-900/80 backdrop-blur-xl rounded-2xl p-8 border border-gray-700/50 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ”’"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"éœ€è¦ç™»å½•"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"è¯·å…ˆç™»å½•ä¸»åº”ç”¨åŽå†è®¿é—®ç®¡ç†é¢æ¿"}),e.jsx("a",{href:"/memories",className:"inline-block px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl transition-all",children:"å‰å¾€ç™»å½•"})]})})}export{J as default};
