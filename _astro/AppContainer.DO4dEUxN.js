const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/vectorSearch.CYflu1JK.js","_astro/index.CRO4pM4d.js","_astro/pako.esm.CMINtMsn.js"])))=>i.map(i=>d[i]);
import{M as lp,S as $o,s as Bi,j as g}from"./index.CRO4pM4d.js";import{r as P,a as DN,g as pv,R as Xt,t as D6,c as Yy}from"./index.CbBne_R2.js";import{_ as Yh}from"./preload-helper.BlTxHScW.js";import{r as Mhe,a as Ahe}from"./index.CwhW8xSp.js";import"./pako.esm.CMINtMsn.js";async function S9(t,e){const{encryptedData:n,iv:r,salt:i,authTag:a}=e,s=new TextEncoder,o=await window.crypto.subtle.importKey("raw",s.encode(t),{name:"PBKDF2"},!1,["deriveKey"]),l=await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:Uint8Array.from(atob(i),h=>h.charCodeAt(0)),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!0,["decrypt"]),u=Uint8Array.from(atob(n),h=>h.charCodeAt(0)),c=Uint8Array.from(atob(a),h=>h.charCodeAt(0)),d=new Uint8Array(u.length+c.length);d.set(u),d.set(c,u.length);try{const h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:Uint8Array.from(atob(r),f=>f.charCodeAt(0))},l,d);return new TextDecoder().decode(h)}catch(h){throw console.error("Decryption failed:",h),new Error("密码错误或数据损坏")}}function khe(t){const[e,n]=P.useState([]),r=P.useRef(!1),i=P.useCallback((d,h=!1)=>{if(h){n(d),r.current=!0,console.log(`✅ 关联数据已强制更新 (${d.length} 条)`);return}r.current?console.log("⚠️ 关联数据已初始化，跳过重复初始化"):(n(d),r.current=!0,console.log(`✅ 关联数据已初始化 (${d.length} 条)`))},[]),a=P.useCallback((d,h)=>{n(f=>{if(f.some(b=>b.fromId===d&&b.toId===h||b.fromId===h&&b.toId===d))return f;const x=[...f,{fromId:d,toId:h,createdAt:new Date}];return t?.onSaveRelations&&t.onSaveRelations(x),x})},[t]),s=P.useCallback((d,h)=>{n(f=>{const m=f.filter(x=>!(x.fromId===d&&x.toId===h||x.fromId===h&&x.toId===d));return t?.onSaveRelations&&t.onSaveRelations(m),m})},[t]),o=P.useCallback(d=>e.filter(h=>h.fromId===d||h.toId===d).map(h=>h.fromId===d?h.toId:h.fromId),[e]),l=P.useCallback(d=>e.some(h=>h.fromId===d||h.toId===d),[e]),u=P.useCallback(d=>{n(h=>{const f=h.filter(m=>m.fromId!==d&&m.toId!==d);return t?.onSaveRelations&&t.onSaveRelations(f),f})},[t]),c=P.useCallback(()=>{n(()=>{const d=[];return t?.onSaveRelations&&t.onSaveRelations(d),d})},[t]);return{relations:e,addRelation:a,removeRelation:s,getRelatedMemories:o,hasRelations:l,initializeRelations:i,removeRelationsForMemory:u,resetRelations:c}}const u2={DEBOUNCE_SAVE_MS:3e3,INPUT_FOCUS_DELAY_MS:50,TIMELINE_DAYS:90,ONE_DAY_MS:1440*60*1e3},E9={MAX_MEMORY_LENGTH:200},Ihe={DRAFT_SAVE_INTERVAL_MS:1e3},c2={DEFAULT_WEIGHTS:{recency:.3,revisit:.25,depth:.2,connectivity:.15,actionability:.1},NORMALIZATION_FACTORS:{revisitCount:10,editCount:5,connectionCount:5}};function Nhe({memories:t,onUpdateMemories:e}){const n=P.useRef(null),r=P.useCallback(u=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{e(u(t)),n.current=null},Ihe.DRAFT_SAVE_INTERVAL_MS)},[t,e]),i=P.useCallback(u=>{r(c=>c.map(d=>d.id===u?{...d,visitCount:(d.visitCount||0)+1,lastVisitedAt:new Date}:d))},[r]),a=P.useCallback((u,c)=>{r(d=>d.map(h=>{if(h.id!==u)return h;const f={editCount:(h.editCount||0)+1};return c!==void 0&&(f.totalEditTime=(h.totalEditTime||0)+c),{...h,...f}}))},[r]),s=P.useCallback(u=>{console.log(`[Analytics] 关联建立: ${u}`)},[]),o=P.useCallback((u,c)=>{e(t.map(d=>d.id===u?{...d,actionability:c}:d))},[t,e]),l=P.useCallback(u=>{const c=t.find(d=>d.id===u);return c?{visitCount:c.visitCount||0,editCount:c.editCount||0,lastVisitedAt:c.lastVisitedAt}:null},[t]);return{trackVisit:i,trackEdit:a,trackAssociation:s,setActionability:o,getMemoryStats:l}}const Rhe=[];function T9(t,e){const n=new Map;for(const r of t)n.set(r.id,r);for(const r of e){const i=n.get(r.id);if(!i){n.set(r.id,r);continue}if(r.isDeleted&&!i.isDeleted){n.set(r.id,r);continue}if(i.isDeleted&&!r.isDeleted)continue;const a=i,s=r,o=a.editCount??0,l=s.editCount??0,u=a.visitCount??0,c=s.visitCount??0,d=a.lastVisitedAt?new Date(a.lastVisitedAt).getTime():0,h=s.lastVisitedAt?new Date(s.lastVisitedAt).getTime():0,f=l>o||c>u||h>d||String(s.text||"").length>String(a.text||"").length;n.set(r.id,f?s:a)}return Array.from(n.values()).sort((r,i)=>{const a=new Date(r.date).getTime(),s=new Date(i.date).getTime();return a-s})}function Phe(t){const{githubConfig:e,authToken:n,onShowToast:r,onInitializeRelations:i}=t,[a,s]=P.useState(()=>{try{return lp.loadMemories()}catch{return Rhe}}),[o,l]=P.useState("local"),[u,c]=P.useState(null),d=!0;P.useEffect(()=>{let y=!1;return(async()=>{try{const w=await lp.loadMemoriesAsync();if(y)return;w.length>0&&s(_=>{const S=_.some(E=>E.type==="arena-v2"&&!E.arenaV2Nodes),M=w.some(E=>E.type==="arena-v2"&&!!E.arenaV2Nodes);return _.length===0||w.length>_.length||S&&M?w:_})}catch{}})(),()=>{y=!0}},[]);const h=P.useRef(!0),f=P.useRef(!1),m=P.useCallback(()=>{try{const y=n||localStorage.getItem("thineasy_auth_token")||"",w=localStorage.getItem("thineasy_auth_expiry"),_=w?parseInt(w):0;return{token:y,ok:!!y&&(!w||Date.now()<_)}}catch{return{token:"",ok:!1}}},[n]),x=P.useCallback(async y=>{if(!e)return;const{token:w,ok:_}=m();if(_){l("syncing");try{$o.reset();const S=$o.create({type:"github-client",owner:e.owner,repo:e.repo,path:e.path,branch:e.branch,token:w});Bi.setStorage(S);const M=await Bi.initialize();if(!M.success)throw new Error(M.error||"GitHub 初始化失败");const E=await Bi.getAll(),C=await Bi.loadRelations();if(!h.current)return;s(R=>{const k=T9(E,R),I=new Set;let N=!1;const D=k.map(F=>{if(!F?.id)return F;if(!I.has(F.id))return I.add(F.id),F;const L=globalThis.crypto?.randomUUID?.()??`${Date.now().toString()}-${Math.random().toString(36).slice(2)}`;return N=!0,{...F,id:L}});N&&(console.warn("⚠️ 检测到重复记忆 ID，已自动修复（可能需要重新建立部分关联）"),r?.(`检测到重复记忆 ID，已自动修复。
如果之前有关联，可能需要重新建立。`,"warning",6e3));try{lp.saveMemories(D)}catch{}return D}),C.length>0?(i?.(C,!0),console.log(`✅ 已从 GitHub 加载 ${C.length} 条关联`)):C.length===0&&console.log("ℹ️ GitHub 暂无关联数据，保持本地关联"),l("connected"),y==="manual"&&r?.("已从 GitHub 同步并更新本地缓存","success",2500)}catch(S){const M=S instanceof Error?S.message:String(S);console.error("❌ GitHub 同步失败:",M);try{$o.reset();const E=$o.create({type:"local"});Bi.setStorage(E),await Bi.initialize()}catch{}h.current&&(l(y==="manual"?"error":"local"),y==="manual"&&r?.(`GitHub 不可用，已继续使用本地缓存：${M}`,"warning",6e3))}}},[e,m,r,i]),b=P.useCallback(async()=>{r?.("正在同步存储...","info");const y=(()=>{try{const w=n||localStorage.getItem("thineasy_auth_token")||"",_=localStorage.getItem("thineasy_auth_expiry"),S=_?parseInt(_):0;return!w||_&&Date.now()>=S?"":w}catch{return""}})();if(e&&y){l("syncing");try{$o.reset();const w=$o.create({type:"github-client",owner:e.owner,repo:e.repo,path:e.path,branch:e.branch,token:y});Bi.setStorage(w);const _=await Bi.initialize();if(!_.success)throw new Error(_.error||"GitHub 初始化失败");const S=await Bi.getAll(),M=await Bi.loadRelations();s(E=>{const C=T9(S,E);try{lp.saveMemories(C)}catch{}return C}),M.length>0&&(i?.(M,!0),console.log(`✅ 已同步 ${M.length} 条关联`)),l("connected"),r?.("已从 GitHub 同步完成","success",2500);return}catch(w){const _=w instanceof Error?w.message:String(w);console.error("Refresh GitHub failed:",_);try{$o.reset();const S=$o.create({type:"local"});Bi.setStorage(S),await Bi.initialize()}catch{}l("local"),r?.(`GitHub 不可用，继续使用本地缓存：${_}`,"warning",6e3);return}}try{const w=await Bi.initialize();if(w.success){const _=Bi.getStorageType();_.includes("Client")||_.includes("APIClient")?(l("connected"),r?.("存储连接已恢复","success",2500)):(l("local"),r?.("当前使用本地存储","warning",4e3))}else l("error"),r?.(`重连失败: ${w.error}`,"error",6e3)}catch(w){const _=w instanceof Error?w.message:String(w);l("error"),r?.(`重连发生错误: ${_}`,"error",6e3)}},[n,e,r,i]);return P.useEffect(()=>{const y=()=>{const _=lp.getCacheStats();c(_)};y();const w=setInterval(y,3e4);return()=>clearInterval(w)},[]),P.useEffect(()=>{if(f.current)return;f.current=!0;const{ok:y}=m();e&&y?x("initial"):l("local")},[]),P.useEffect(()=>{if(o==="local")try{const y=localStorage.getItem("storage-fallback");if(!y)return;localStorage.removeItem("storage-fallback");const w=JSON.parse(y),_=w?.error?`原因：${w.error}`:"原因未知";r?.(`当前使用本地存储（未连接 GitHub），历史仓库数据不会加载。
${_}`,"warning",7e3)}catch{}},[d,o,r]),P.useEffect(()=>{const y=setTimeout(()=>{try{lp.saveMemories(a)}catch{}},300);return()=>clearTimeout(y)},[a]),P.useEffect(()=>()=>{h.current=!1},[]),{memories:a,setMemories:s,storageStatus:o,cacheStats:u,isLoaded:d,handleStorageRefresh:b}}function Dhe(t={}){const{onShowToast:e}=t,[n,r]=P.useState({status:"idle"});P.useEffect(()=>{let a=!1;return(async()=>{try{r({status:"checking"});const l=await(await Yh(()=>import("./vectorSearch.CYflu1JK.js"),__vite__mapDeps([0,1,2]))).checkVectorEngine();a||r(l)}catch(o){const l=o instanceof Error?o.message:String(o);a||r({status:"error",error:l})}})(),()=>{a=!0}},[]);const i=P.useCallback(async()=>{r({status:"loading"});try{const a=await Yh(()=>import("./vectorSearch.CYflu1JK.js"),__vite__mapDeps([0,1,2]));a.resetVectorEngine();const s=await a.warmupVectorEngine();if(r(s),s.status==="ready")e?.("语义引擎已就绪（向量搜索可用）","success",2500);else{const o=s.status==="error"?s.error:"未知错误";e?.(`语义引擎初始化失败：${o}`,"warning",6e3)}}catch(a){const s=a instanceof Error?a.message:String(a);r({status:"error",error:s}),e?.(`语义引擎初始化失败：${s}`,"warning",6e3)}},[e]);return{vectorEngine:n,handleVectorEngineRefresh:i}}function Ohe(){const[t,e]=P.useState({visible:!1,memoryId:null,position:{x:0,y:0}}),n=P.useCallback((X,H)=>{e({visible:!0,memoryId:X,position:H})},[]),r=P.useCallback(()=>{e({visible:!1,memoryId:null,position:{x:0,y:0}})},[]),[i,a]=P.useState({visible:!1,sourceMemoryIds:[]}),s=P.useCallback(X=>{a({visible:!0,sourceMemoryIds:X})},[]),o=P.useCallback(()=>{a({visible:!1,sourceMemoryIds:[]})},[]),[l,u]=P.useState({visible:!1,cardId:null,position:{x:0,y:0}}),c=P.useCallback((X,H)=>{u({visible:!0,cardId:X,position:H})},[]),d=P.useCallback(()=>{u({visible:!1,cardId:null,position:{x:0,y:0}})},[]),[h,f]=P.useState({visible:!1,preselectedIds:[]}),m=P.useCallback((X=[])=>{f({visible:!0,preselectedIds:X})},[]),x=P.useCallback(()=>{f({visible:!1,preselectedIds:[]})},[]),[b,y]=P.useState({visible:!1,indexId:null,position:{x:0,y:0}}),w=P.useCallback((X,H)=>{y({visible:!0,indexId:X,position:H})},[]),_=P.useCallback(()=>{y({visible:!1,indexId:null,position:{x:0,y:0}})},[]),[S,M]=P.useState({visible:!1,arenaId:null}),E=P.useCallback(X=>{M({visible:!0,arenaId:X})},[]),C=P.useCallback(()=>{M({visible:!1,arenaId:null})},[]),[R,k]=P.useState({visible:!1,arenaMemory:null}),I=P.useCallback(X=>{k({visible:!0,arenaMemory:X})},[]),N=P.useCallback(()=>{k({visible:!1,arenaMemory:null})},[]),[D,F]=P.useState(!1),[L,U]=P.useState(!1),[j,q]=P.useState(!1),[Z,Q]=P.useState(!1),[z,W]=P.useState(!1);return{searchModal:t,setSearchModal:e,openSearchModal:n,closeSearchModal:r,createCardModal:i,setCreateCardModal:a,openCreateCardModal:s,closeCreateCardModal:o,cardDetailModal:l,setCardDetailModal:u,openCardDetailModal:c,closeCardDetailModal:d,createIndexModal:h,setCreateIndexModal:f,openCreateIndexModal:m,closeCreateIndexModal:x,indexDetailModal:b,setIndexDetailModal:y,openIndexDetailModal:w,closeIndexDetailModal:_,arenaEditor:S,setArenaEditor:M,openArenaEditor:E,closeArenaEditor:C,arenaV2Editor:R,setArenaV2Editor:k,openArenaV2Editor:I,closeArenaV2Editor:N,passwordModalOpen:D,setPasswordModalOpen:F,clearAllOpen:L,setClearAllOpen:U,arenaManagerModalOpen:j,setArenaManagerModalOpen:q,createArenaModalOpen:Z,setCreateArenaModalOpen:Q,createArenaV2ModalOpen:z,setCreateArenaV2ModalOpen:W}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const B0="182",hh={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},fh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},SX=0,O6=1,EX=2,Lhe=3,TX=0,Zp=1,Ig=2,wh=3,Uu=0,rs=1,po=2,Fl=0,Lh=1,l_=2,L6=3,F6=4,CX=5,zc=100,MX=101,AX=102,kX=103,IX=104,NX=200,RX=201,PX=202,DX=203,u_=204,c_=205,OX=206,LX=207,FX=208,BX=209,UX=210,zX=211,jX=212,HX=213,$X=214,d_=0,h_=1,f_=2,Xh=3,p_=4,m_=5,g_=6,v_=7,mv=0,VX=1,qX=2,vo=0,ON=1,LN=2,FN=3,d2=4,BN=5,UN=6,zN=7,B6="attached",GX="detached",h2=300,Hl=301,Qc=302,l1=303,u1=304,U0=306,c1=1e3,bs=1001,d1=1002,Ti=1003,jN=1004,Fhe=1004,$p=1005,Bhe=1005,Pr=1006,Ng=1007,Uhe=1007,Il=1008,zhe=1008,Ka=1009,HN=1010,$N=1011,o0=1012,f2=1013,yo=1014,Qa=1015,$l=1016,p2=1017,m2=1018,l0=1020,VN=35902,qN=35899,GN=1021,WN=1022,Da=1023,Vl=1026,Vc=1027,g2=1028,gv=1029,Kh=1030,v2=1031,jhe=1032,y2=1033,Rg=33776,Pg=33777,Dg=33778,Og=33779,y_=35840,x_=35841,b_=35842,__=35843,w_=36196,S_=37492,E_=37496,T_=37488,C_=37489,M_=37490,A_=37491,k_=37808,I_=37809,N_=37810,R_=37811,P_=37812,D_=37813,O_=37814,L_=37815,F_=37816,B_=37817,U_=37818,z_=37819,j_=37820,H_=37821,$_=36492,V_=36494,q_=36495,G_=36283,W_=36284,Y_=36285,X_=36286,WX=2200,YX=2201,XX=2202,h1=2300,K_=2301,Fb=2302,Sh=2400,Eh=2401,f1=2402,x2=2500,YN=2501,Hhe=0,$he=1,Vhe=2,KX=3200,ZX=3201,qhe=3202,Ghe=3203,pd=0,JX=1,ku="",Na="srgb",ed="srgb-linear",p1="linear",xr="srgb",Whe="",Yhe="rg",Xhe="ga",Khe=0,ph=7680,Zhe=7681,Jhe=7682,Qhe=7683,efe=34055,tfe=34056,nfe=5386,rfe=512,ife=513,afe=514,sfe=515,ofe=516,lfe=517,ufe=518,U6=519,QX=512,eK=513,tK=514,b2=515,nK=516,rK=517,_2=518,iK=519,m1=35044,cfe=35048,dfe=35040,hfe=35045,ffe=35049,pfe=35041,mfe=35046,gfe=35050,vfe=35042,yfe="100",z6="300 es",qs=2e3,u0=2001,xfe={COMPUTE:"compute",RENDER:"render"},bfe={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},_fe={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function aK(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const wfe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Vp(t,e){return new wfe[t](e)}function sK(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function g1(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function oK(){const t=g1("canvas");return t.style.display="block",t}const C9={};let td=null;function Sfe(t){td=t}function Efe(){return td}function v1(...t){const e="THREE."+t.shift();td?td("log",e,...t):console.log(e,...t)}function Ut(...t){const e="THREE."+t.shift();td?td("warn",e,...t):console.warn(e,...t)}function tn(...t){const e="THREE."+t.shift();td?td("error",e,...t):console.error(e,...t)}function c0(...t){const e=t.join(" ");e in C9||(C9[e]=!0,Ut(...t))}function Tfe(t,e,n){return new Promise(function(r,i){function a(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}}setTimeout(a,n)})}let Wl=class{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const a=i.indexOf(n);a!==-1&&i.splice(a,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const r=n[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let a=0,s=i.length;a<s;a++)i[a].call(this,e);e.target=null}}};const Aa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let M9=1234567;const Fh=Math.PI/180,d0=180/Math.PI;function Ws(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Aa[t&255]+Aa[t>>8&255]+Aa[t>>16&255]+Aa[t>>24&255]+"-"+Aa[e&255]+Aa[e>>8&255]+"-"+Aa[e>>16&15|64]+Aa[e>>24&255]+"-"+Aa[n&63|128]+Aa[n>>8&255]+"-"+Aa[n>>16&255]+Aa[n>>24&255]+Aa[r&255]+Aa[r>>8&255]+Aa[r>>16&255]+Aa[r>>24&255]).toLowerCase()}function gn(t,e,n){return Math.max(e,Math.min(n,t))}function XN(t,e){return(t%e+e)%e}function Cfe(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function Mfe(t,e,n){return t!==e?(n-t)/(e-t):0}function Lg(t,e,n){return(1-n)*t+n*e}function Afe(t,e,n,r){return Lg(t,e,1-Math.exp(-n*r))}function kfe(t,e=1){return e-Math.abs(XN(t,e*2)-e)}function Ife(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Nfe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Rfe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Pfe(t,e){return t+Math.random()*(e-t)}function Dfe(t){return t*(.5-Math.random())}function Ofe(t){t!==void 0&&(M9=t);let e=M9+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Lfe(t){return t*Fh}function Ffe(t){return t*d0}function Bfe(t){return(t&t-1)===0&&t!==0}function Ufe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function zfe(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function jfe(t,e,n,r,i){const a=Math.cos,s=Math.sin,o=a(n/2),l=s(n/2),u=a((e+r)/2),c=s((e+r)/2),d=a((e-r)/2),h=s((e-r)/2),f=a((r-e)/2),m=s((r-e)/2);switch(i){case"XYX":t.set(o*c,l*d,l*h,o*u);break;case"YZY":t.set(l*h,o*c,l*d,o*u);break;case"ZXZ":t.set(l*d,l*h,o*c,o*u);break;case"XZX":t.set(o*c,l*m,l*f,o*u);break;case"YXY":t.set(l*f,o*c,l*m,o*u);break;case"ZYZ":t.set(l*m,l*f,o*c,o*u);break;default:Ut("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Za(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function In(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const KN={DEG2RAD:Fh,RAD2DEG:d0,generateUUID:Ws,clamp:gn,euclideanModulo:XN,mapLinear:Cfe,inverseLerp:Mfe,lerp:Lg,damp:Afe,pingpong:kfe,smoothstep:Ife,smootherstep:Nfe,randInt:Rfe,randFloat:Pfe,randFloatSpread:Dfe,seededRandom:Ofe,degToRad:Lfe,radToDeg:Ffe,isPowerOfTwo:Bfe,ceilPowerOfTwo:Ufe,floorPowerOfTwo:zfe,setQuaternionFromProperEuler:jfe,normalize:In,denormalize:Za};class dt{constructor(e=0,n=0){dt.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=gn(this.x,e.x,n.x),this.y=gn(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=gn(this.x,e,n),this.y=gn(this.y,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(gn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),a=this.x-e.x,s=this.y-e.y;return this.x=a*r-s*i+e.x,this.y=a*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xa{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,a,s,o){let l=r[i+0],u=r[i+1],c=r[i+2],d=r[i+3],h=a[s+0],f=a[s+1],m=a[s+2],x=a[s+3];if(o<=0){e[n+0]=l,e[n+1]=u,e[n+2]=c,e[n+3]=d;return}if(o>=1){e[n+0]=h,e[n+1]=f,e[n+2]=m,e[n+3]=x;return}if(d!==x||l!==h||u!==f||c!==m){let b=l*h+u*f+c*m+d*x;b<0&&(h=-h,f=-f,m=-m,x=-x,b=-b);let y=1-o;if(b<.9995){const w=Math.acos(b),_=Math.sin(w);y=Math.sin(y*w)/_,o=Math.sin(o*w)/_,l=l*y+h*o,u=u*y+f*o,c=c*y+m*o,d=d*y+x*o}else{l=l*y+h*o,u=u*y+f*o,c=c*y+m*o,d=d*y+x*o;const w=1/Math.sqrt(l*l+u*u+c*c+d*d);l*=w,u*=w,c*=w,d*=w}}e[n]=l,e[n+1]=u,e[n+2]=c,e[n+3]=d}static multiplyQuaternionsFlat(e,n,r,i,a,s){const o=r[i],l=r[i+1],u=r[i+2],c=r[i+3],d=a[s],h=a[s+1],f=a[s+2],m=a[s+3];return e[n]=o*m+c*d+l*f-u*h,e[n+1]=l*m+c*h+u*d-o*f,e[n+2]=u*m+c*f+o*h-l*d,e[n+3]=c*m-o*d-l*h-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,a=e._z,s=e._order,o=Math.cos,l=Math.sin,u=o(r/2),c=o(i/2),d=o(a/2),h=l(r/2),f=l(i/2),m=l(a/2);switch(s){case"XYZ":this._x=h*c*d+u*f*m,this._y=u*f*d-h*c*m,this._z=u*c*m+h*f*d,this._w=u*c*d-h*f*m;break;case"YXZ":this._x=h*c*d+u*f*m,this._y=u*f*d-h*c*m,this._z=u*c*m-h*f*d,this._w=u*c*d+h*f*m;break;case"ZXY":this._x=h*c*d-u*f*m,this._y=u*f*d+h*c*m,this._z=u*c*m+h*f*d,this._w=u*c*d-h*f*m;break;case"ZYX":this._x=h*c*d-u*f*m,this._y=u*f*d+h*c*m,this._z=u*c*m-h*f*d,this._w=u*c*d+h*f*m;break;case"YZX":this._x=h*c*d+u*f*m,this._y=u*f*d+h*c*m,this._z=u*c*m-h*f*d,this._w=u*c*d-h*f*m;break;case"XZY":this._x=h*c*d-u*f*m,this._y=u*f*d-h*c*m,this._z=u*c*m+h*f*d,this._w=u*c*d+h*f*m;break;default:Ut("Quaternion: .setFromEuler() encountered an unknown order: "+s)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],a=n[8],s=n[1],o=n[5],l=n[9],u=n[2],c=n[6],d=n[10],h=r+o+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(c-l)*f,this._y=(a-u)*f,this._z=(s-i)*f}else if(r>o&&r>d){const f=2*Math.sqrt(1+r-o-d);this._w=(c-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(a+u)/f}else if(o>d){const f=2*Math.sqrt(1+o-r-d);this._w=(a-u)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+d-r-o);this._w=(s-i)/f,this._x=(a+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(gn(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,a=e._z,s=e._w,o=n._x,l=n._y,u=n._z,c=n._w;return this._x=r*c+s*o+i*u-a*l,this._y=i*c+s*l+a*o-r*u,this._z=a*c+s*u+r*l-i*o,this._w=s*c-r*o-i*l-a*u,this._onChangeCallback(),this}slerp(e,n){if(n<=0)return this;if(n>=1)return this.copy(e);let r=e._x,i=e._y,a=e._z,s=e._w,o=this.dot(e);o<0&&(r=-r,i=-i,a=-a,s=-s,o=-o);let l=1-n;if(o<.9995){const u=Math.acos(o),c=Math.sin(u);l=Math.sin(l*u)/c,n=Math.sin(n*u)/c,this._x=this._x*l+r*n,this._y=this._y*l+i*n,this._z=this._z*l+a*n,this._w=this._w*l+s*n,this._onChangeCallback()}else this._x=this._x*l+r*n,this._y=this._y*l+i*n,this._z=this._z*l+a*n,this._w=this._w*l+s*n,this.normalize();return this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),a*Math.sin(n),a*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class we{constructor(e=0,n=0,r=0){we.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(A9.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(A9.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*n+a[3]*r+a[6]*i,this.y=a[1]*n+a[4]*r+a[7]*i,this.z=a[2]*n+a[5]*r+a[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,a=e.elements,s=1/(a[3]*n+a[7]*r+a[11]*i+a[15]);return this.x=(a[0]*n+a[4]*r+a[8]*i+a[12])*s,this.y=(a[1]*n+a[5]*r+a[9]*i+a[13])*s,this.z=(a[2]*n+a[6]*r+a[10]*i+a[14])*s,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,a=e.x,s=e.y,o=e.z,l=e.w,u=2*(s*i-o*r),c=2*(o*n-a*i),d=2*(a*r-s*n);return this.x=n+l*u+s*d-o*c,this.y=r+l*c+o*u-a*d,this.z=i+l*d+a*c-s*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,a=e.elements;return this.x=a[0]*n+a[4]*r+a[8]*i,this.y=a[1]*n+a[5]*r+a[9]*i,this.z=a[2]*n+a[6]*r+a[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=gn(this.x,e.x,n.x),this.y=gn(this.y,e.y,n.y),this.z=gn(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=gn(this.x,e,n),this.y=gn(this.y,e,n),this.z=gn(this.z,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,a=e.z,s=n.x,o=n.y,l=n.z;return this.x=i*l-a*o,this.y=a*s-r*l,this.z=r*o-i*s,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return R4.copy(this).projectOnVector(e),this.sub(R4)}reflect(e){return this.sub(R4.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(gn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const R4=new we,A9=new xa;class Sn{constructor(e,n,r,i,a,s,o,l,u){Sn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,a,s,o,l,u)}set(e,n,r,i,a,s,o,l,u){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=n,c[4]=a,c[5]=l,c[6]=r,c[7]=s,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,a=this.elements,s=r[0],o=r[3],l=r[6],u=r[1],c=r[4],d=r[7],h=r[2],f=r[5],m=r[8],x=i[0],b=i[3],y=i[6],w=i[1],_=i[4],S=i[7],M=i[2],E=i[5],C=i[8];return a[0]=s*x+o*w+l*M,a[3]=s*b+o*_+l*E,a[6]=s*y+o*S+l*C,a[1]=u*x+c*w+d*M,a[4]=u*b+c*_+d*E,a[7]=u*y+c*S+d*C,a[2]=h*x+f*w+m*M,a[5]=h*b+f*_+m*E,a[8]=h*y+f*S+m*C,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return n*s*c-n*o*u-r*a*c+r*o*l+i*a*u-i*s*l}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],d=c*s-o*u,h=o*l-c*a,f=u*a-s*l,m=n*d+r*h+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/m;return e[0]=d*x,e[1]=(i*u-c*r)*x,e[2]=(o*r-i*s)*x,e[3]=h*x,e[4]=(c*n-i*l)*x,e[5]=(i*a-o*n)*x,e[6]=f*x,e[7]=(r*l-u*n)*x,e[8]=(s*n-r*a)*x,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,a,s,o){const l=Math.cos(a),u=Math.sin(a);return this.set(r*l,r*u,-r*(l*s+u*o)+s+e,-i*u,i*l,-i*(-u*s+l*o)+o+n,0,0,1),this}scale(e,n){return this.premultiply(P4.makeScale(e,n)),this}rotate(e){return this.premultiply(P4.makeRotation(-e)),this}translate(e,n){return this.premultiply(P4.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const P4=new Sn,k9=new Sn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),I9=new Sn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Hfe(){const t={enabled:!0,workingColorSpace:ed,spaces:{},convert:function(i,a,s){return this.enabled===!1||a===s||!a||!s||(this.spaces[a].transfer===xr&&(i.r=Du(i.r),i.g=Du(i.g),i.b=Du(i.b)),this.spaces[a].primaries!==this.spaces[s].primaries&&(i.applyMatrix3(this.spaces[a].toXYZ),i.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===xr&&(i.r=Jp(i.r),i.g=Jp(i.g),i.b=Jp(i.b))),i},workingToColorSpace:function(i,a){return this.convert(i,this.workingColorSpace,a)},colorSpaceToWorking:function(i,a){return this.convert(i,a,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===ku?p1:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,a=this.workingColorSpace){return i.fromArray(this.spaces[a].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,a,s){return i.copy(this.spaces[a].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,a){return c0("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(i,a)},toWorkingColorSpace:function(i,a){return c0("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(i,a)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[ed]:{primaries:e,whitePoint:r,transfer:p1,toXYZ:k9,fromXYZ:I9,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Na},outputColorSpaceConfig:{drawingBufferColorSpace:Na}},[Na]:{primaries:e,whitePoint:r,transfer:xr,toXYZ:k9,fromXYZ:I9,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Na}}}),t}const Yn=Hfe();function Du(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Jp(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let up;class lK{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{up===void 0&&(up=g1("canvas")),up.width=e.width,up.height=e.height;const i=up.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=up}return r.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=g1("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),a=i.data;for(let s=0;s<a.length;s++)a[s]=Du(a[s]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(Du(n[r]/255)*255):n[r]=Du(n[r]);return{data:n,width:e.width,height:e.height}}else return Ut("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let $fe=0;class qc{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:$fe++}),this.uuid=Ws(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const n=this.data;return typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?e.set(n.videoWidth,n.videoHeight,0):typeof VideoFrame<"u"&&n instanceof VideoFrame?e.set(n.displayHeight,n.displayWidth,0):n!==null?e.set(n.width,n.height,n.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let a;if(Array.isArray(i)){a=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?a.push(D4(i[s].image)):a.push(D4(i[s]))}else a=D4(i);r.url=a}return n||(e.images[this.uuid]=r),r}}function D4(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?lK.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(Ut("Texture: Unable to serialize Texture."),{})}let Vfe=0;const O4=new we;class hi extends Wl{constructor(e=hi.DEFAULT_IMAGE,n=hi.DEFAULT_MAPPING,r=bs,i=bs,a=Pr,s=Il,o=Da,l=Ka,u=hi.DEFAULT_ANISOTROPY,c=ku){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Vfe++}),this.uuid=Ws(),this.name="",this.source=new qc(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=a,this.minFilter=s,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new dt(0,0),this.repeat=new dt(1,1),this.center=new dt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Sn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(O4).x}get height(){return this.source.getSize(O4).y}get depth(){return this.source.getSize(O4).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const n in e){const r=e[n];if(r===void 0){Ut(`Texture.setValues(): parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){Ut(`Texture.setValues(): property '${n}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==h2)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case c1:e.x=e.x-Math.floor(e.x);break;case bs:e.x=e.x<0?0:1;break;case d1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case c1:e.y=e.y-Math.floor(e.y);break;case bs:e.y=e.y<0?0:1;break;case d1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}hi.DEFAULT_IMAGE=null;hi.DEFAULT_MAPPING=h2;hi.DEFAULT_ANISOTROPY=1;class er{constructor(e=0,n=0,r=0,i=1){er.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,a=this.w,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i+s[12]*a,this.y=s[1]*n+s[5]*r+s[9]*i+s[13]*a,this.z=s[2]*n+s[6]*r+s[10]*i+s[14]*a,this.w=s[3]*n+s[7]*r+s[11]*i+s[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,a;const l=e.elements,u=l[0],c=l[4],d=l[8],h=l[1],f=l[5],m=l[9],x=l[2],b=l[6],y=l[10];if(Math.abs(c-h)<.01&&Math.abs(d-x)<.01&&Math.abs(m-b)<.01){if(Math.abs(c+h)<.1&&Math.abs(d+x)<.1&&Math.abs(m+b)<.1&&Math.abs(u+f+y-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const _=(u+1)/2,S=(f+1)/2,M=(y+1)/2,E=(c+h)/4,C=(d+x)/4,R=(m+b)/4;return _>S&&_>M?_<.01?(r=0,i=.707106781,a=.707106781):(r=Math.sqrt(_),i=E/r,a=C/r):S>M?S<.01?(r=.707106781,i=0,a=.707106781):(i=Math.sqrt(S),r=E/i,a=R/i):M<.01?(r=.707106781,i=.707106781,a=0):(a=Math.sqrt(M),r=C/a,i=R/a),this.set(r,i,a,n),this}let w=Math.sqrt((b-m)*(b-m)+(d-x)*(d-x)+(h-c)*(h-c));return Math.abs(w)<.001&&(w=1),this.x=(b-m)/w,this.y=(d-x)/w,this.z=(h-c)/w,this.w=Math.acos((u+f+y-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=gn(this.x,e.x,n.x),this.y=gn(this.y,e.y,n.y),this.z=gn(this.z,e.z,n.z),this.w=gn(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=gn(this.x,e,n),this.y=gn(this.y,e,n),this.z=gn(this.z,e,n),this.w=gn(this.w,e,n),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(gn(r,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ZN extends Wl{constructor(e=1,n=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Pr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=r.depth,this.scissor=new er(0,0,e,n),this.scissorTest=!1,this.viewport=new er(0,0,e,n);const i={width:e,height:n,depth:r.depth},a=new hi(i);this.textures=[];const s=r.count;for(let o=0;o<s;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const n={minFilter:Pr,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(n.mapping=e.mapping),e.wrapS!==void 0&&(n.wrapS=e.wrapS),e.wrapT!==void 0&&(n.wrapT=e.wrapT),e.wrapR!==void 0&&(n.wrapR=e.wrapR),e.magFilter!==void 0&&(n.magFilter=e.magFilter),e.minFilter!==void 0&&(n.minFilter=e.minFilter),e.format!==void 0&&(n.format=e.format),e.type!==void 0&&(n.type=e.type),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(n.colorSpace=e.colorSpace),e.flipY!==void 0&&(n.flipY=e.flipY),e.generateMipmaps!==void 0&&(n.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(n.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(n)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,a=this.textures.length;i<a;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,r=e.textures.length;n<r;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const i=Object.assign({},e.textures[n].image);this.textures[n].source=new qc(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ys extends ZN{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class w2 extends hi{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Ti,this.minFilter=Ti,this.wrapR=bs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class qfe extends Ys{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new w2(null,e,n,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class S2 extends hi{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Ti,this.minFilter=Ti,this.wrapR=bs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Gfe extends Ys{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new S2(null,e,n,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Ai{constructor(e=new we(1/0,1/0,1/0),n=new we(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Lo.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Lo.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Lo.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const a=r.getAttribute("position");if(n===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let s=0,o=a.count;s<o;s++)e.isMesh===!0?e.getVertexPosition(s,Lo):Lo.fromBufferAttribute(a,s),Lo.applyMatrix4(e.matrixWorld),this.expandByPoint(Lo);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Xy.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Xy.copy(r.boundingBox)),Xy.applyMatrix4(e.matrixWorld),this.union(Xy)}const i=e.children;for(let a=0,s=i.length;a<s;a++)this.expandByObject(i[a],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Lo),Lo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lm),Ky.subVectors(this.max,Lm),cp.subVectors(e.a,Lm),dp.subVectors(e.b,Lm),hp.subVectors(e.c,Lm),wc.subVectors(dp,cp),Sc.subVectors(hp,dp),qd.subVectors(cp,hp);let n=[0,-wc.z,wc.y,0,-Sc.z,Sc.y,0,-qd.z,qd.y,wc.z,0,-wc.x,Sc.z,0,-Sc.x,qd.z,0,-qd.x,-wc.y,wc.x,0,-Sc.y,Sc.x,0,-qd.y,qd.x,0];return!L4(n,cp,dp,hp,Ky)||(n=[1,0,0,0,1,0,0,0,1],!L4(n,cp,dp,hp,Ky))?!1:(Zy.crossVectors(wc,Sc),n=[Zy.x,Zy.y,Zy.z],L4(n,cp,dp,hp,Ky))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Lo).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Lo).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(vu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const vu=[new we,new we,new we,new we,new we,new we,new we,new we],Lo=new we,Xy=new Ai,cp=new we,dp=new we,hp=new we,wc=new we,Sc=new we,qd=new we,Lm=new we,Ky=new we,Zy=new we,Gd=new we;function L4(t,e,n,r,i){for(let a=0,s=t.length-3;a<=s;a+=3){Gd.fromArray(t,a);const o=i.x*Math.abs(Gd.x)+i.y*Math.abs(Gd.y)+i.z*Math.abs(Gd.z),l=e.dot(Gd),u=n.dot(Gd),c=r.dot(Gd);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const Wfe=new Ai,Fm=new we,F4=new we;let Hi=class{constructor(e=new we,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):Wfe.setFromPoints(e).getCenter(r);let i=0;for(let a=0,s=e.length;a<s;a++)i=Math.max(i,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Fm.subVectors(e,this.center);const n=Fm.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(Fm,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(F4.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Fm.copy(e.center).add(F4)),this.expandByPoint(Fm.copy(e.center).sub(F4))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}};const yu=new we,B4=new we,Jy=new we,Ec=new we,U4=new we,Qy=new we,z4=new we;class ff{constructor(e=new we,n=new we(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,yu)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=yu.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(yu.copy(this.origin).addScaledVector(this.direction,n),yu.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){B4.copy(e).add(n).multiplyScalar(.5),Jy.copy(n).sub(e).normalize(),Ec.copy(this.origin).sub(B4);const a=e.distanceTo(n)*.5,s=-this.direction.dot(Jy),o=Ec.dot(this.direction),l=-Ec.dot(Jy),u=Ec.lengthSq(),c=Math.abs(1-s*s);let d,h,f,m;if(c>0)if(d=s*l-o,h=s*o-l,m=a*c,d>=0)if(h>=-m)if(h<=m){const x=1/c;d*=x,h*=x,f=d*(d+s*h+2*o)+h*(s*d+h+2*l)+u}else h=a,d=Math.max(0,-(s*h+o)),f=-d*d+h*(h+2*l)+u;else h=-a,d=Math.max(0,-(s*h+o)),f=-d*d+h*(h+2*l)+u;else h<=-m?(d=Math.max(0,-(-s*a+o)),h=d>0?-a:Math.min(Math.max(-a,-l),a),f=-d*d+h*(h+2*l)+u):h<=m?(d=0,h=Math.min(Math.max(-a,-l),a),f=h*(h+2*l)+u):(d=Math.max(0,-(s*a+o)),h=d>0?a:Math.min(Math.max(-a,-l),a),f=-d*d+h*(h+2*l)+u);else h=s>0?-a:a,d=Math.max(0,-(s*h+o)),f=-d*d+h*(h+2*l)+u;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(B4).addScaledVector(Jy,h),f}intersectSphere(e,n){yu.subVectors(e.center,this.origin);const r=yu.dot(this.direction),i=yu.dot(yu)-r*r,a=e.radius*e.radius;if(i>a)return null;const s=Math.sqrt(a-i),o=r-s,l=r+s;return l<0?null:o<0?this.at(l,n):this.at(o,n)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,a,s,o,l;const u=1/this.direction.x,c=1/this.direction.y,d=1/this.direction.z,h=this.origin;return u>=0?(r=(e.min.x-h.x)*u,i=(e.max.x-h.x)*u):(r=(e.max.x-h.x)*u,i=(e.min.x-h.x)*u),c>=0?(a=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(a=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),r>s||a>i||((a>r||isNaN(r))&&(r=a),(s<i||isNaN(i))&&(i=s),d>=0?(o=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(o=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),r>l||o>i)||((o>r||r!==r)&&(r=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,yu)!==null}intersectTriangle(e,n,r,i,a){U4.subVectors(n,e),Qy.subVectors(r,e),z4.crossVectors(U4,Qy);let s=this.direction.dot(z4),o;if(s>0){if(i)return null;o=1}else if(s<0)o=-1,s=-s;else return null;Ec.subVectors(this.origin,e);const l=o*this.direction.dot(Qy.crossVectors(Ec,Qy));if(l<0)return null;const u=o*this.direction.dot(U4.cross(Ec));if(u<0||l+u>s)return null;const c=-o*Ec.dot(z4);return c<0?null:this.at(c/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class fn{constructor(e,n,r,i,a,s,o,l,u,c,d,h,f,m,x,b){fn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,a,s,o,l,u,c,d,h,f,m,x,b)}set(e,n,r,i,a,s,o,l,u,c,d,h,f,m,x,b){const y=this.elements;return y[0]=e,y[4]=n,y[8]=r,y[12]=i,y[1]=a,y[5]=s,y[9]=o,y[13]=l,y[2]=u,y[6]=c,y[10]=d,y[14]=h,y[3]=f,y[7]=m,y[11]=x,y[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new fn().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return this.determinant()===0?(e.set(1,0,0),n.set(0,1,0),r.set(0,0,1),this):(e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this)}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const n=this.elements,r=e.elements,i=1/fp.setFromMatrixColumn(e,0).length(),a=1/fp.setFromMatrixColumn(e,1).length(),s=1/fp.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*s,n[9]=r[9]*s,n[10]=r[10]*s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,a=e.z,s=Math.cos(r),o=Math.sin(r),l=Math.cos(i),u=Math.sin(i),c=Math.cos(a),d=Math.sin(a);if(e.order==="XYZ"){const h=s*c,f=s*d,m=o*c,x=o*d;n[0]=l*c,n[4]=-l*d,n[8]=u,n[1]=f+m*u,n[5]=h-x*u,n[9]=-o*l,n[2]=x-h*u,n[6]=m+f*u,n[10]=s*l}else if(e.order==="YXZ"){const h=l*c,f=l*d,m=u*c,x=u*d;n[0]=h+x*o,n[4]=m*o-f,n[8]=s*u,n[1]=s*d,n[5]=s*c,n[9]=-o,n[2]=f*o-m,n[6]=x+h*o,n[10]=s*l}else if(e.order==="ZXY"){const h=l*c,f=l*d,m=u*c,x=u*d;n[0]=h-x*o,n[4]=-s*d,n[8]=m+f*o,n[1]=f+m*o,n[5]=s*c,n[9]=x-h*o,n[2]=-s*u,n[6]=o,n[10]=s*l}else if(e.order==="ZYX"){const h=s*c,f=s*d,m=o*c,x=o*d;n[0]=l*c,n[4]=m*u-f,n[8]=h*u+x,n[1]=l*d,n[5]=x*u+h,n[9]=f*u-m,n[2]=-u,n[6]=o*l,n[10]=s*l}else if(e.order==="YZX"){const h=s*l,f=s*u,m=o*l,x=o*u;n[0]=l*c,n[4]=x-h*d,n[8]=m*d+f,n[1]=d,n[5]=s*c,n[9]=-o*c,n[2]=-u*c,n[6]=f*d+m,n[10]=h-x*d}else if(e.order==="XZY"){const h=s*l,f=s*u,m=o*l,x=o*u;n[0]=l*c,n[4]=-d,n[8]=u*c,n[1]=h*d+x,n[5]=s*c,n[9]=f*d-m,n[2]=m*d-f,n[6]=o*c,n[10]=x*d+h}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Yfe,e,Xfe)}lookAt(e,n,r){const i=this.elements;return Us.subVectors(e,n),Us.lengthSq()===0&&(Us.z=1),Us.normalize(),Tc.crossVectors(r,Us),Tc.lengthSq()===0&&(Math.abs(r.z)===1?Us.x+=1e-4:Us.z+=1e-4,Us.normalize(),Tc.crossVectors(r,Us)),Tc.normalize(),ex.crossVectors(Us,Tc),i[0]=Tc.x,i[4]=ex.x,i[8]=Us.x,i[1]=Tc.y,i[5]=ex.y,i[9]=Us.y,i[2]=Tc.z,i[6]=ex.z,i[10]=Us.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,a=this.elements,s=r[0],o=r[4],l=r[8],u=r[12],c=r[1],d=r[5],h=r[9],f=r[13],m=r[2],x=r[6],b=r[10],y=r[14],w=r[3],_=r[7],S=r[11],M=r[15],E=i[0],C=i[4],R=i[8],k=i[12],I=i[1],N=i[5],D=i[9],F=i[13],L=i[2],U=i[6],j=i[10],q=i[14],Z=i[3],Q=i[7],z=i[11],W=i[15];return a[0]=s*E+o*I+l*L+u*Z,a[4]=s*C+o*N+l*U+u*Q,a[8]=s*R+o*D+l*j+u*z,a[12]=s*k+o*F+l*q+u*W,a[1]=c*E+d*I+h*L+f*Z,a[5]=c*C+d*N+h*U+f*Q,a[9]=c*R+d*D+h*j+f*z,a[13]=c*k+d*F+h*q+f*W,a[2]=m*E+x*I+b*L+y*Z,a[6]=m*C+x*N+b*U+y*Q,a[10]=m*R+x*D+b*j+y*z,a[14]=m*k+x*F+b*q+y*W,a[3]=w*E+_*I+S*L+M*Z,a[7]=w*C+_*N+S*U+M*Q,a[11]=w*R+_*D+S*j+M*z,a[15]=w*k+_*F+S*q+M*W,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],a=e[12],s=e[1],o=e[5],l=e[9],u=e[13],c=e[2],d=e[6],h=e[10],f=e[14],m=e[3],x=e[7],b=e[11],y=e[15],w=l*f-u*h,_=o*f-u*d,S=o*h-l*d,M=s*f-u*c,E=s*h-l*c,C=s*d-o*c;return n*(x*w-b*_+y*S)-r*(m*w-b*M+y*E)+i*(m*_-x*M+y*C)-a*(m*S-x*E+b*C)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],d=e[9],h=e[10],f=e[11],m=e[12],x=e[13],b=e[14],y=e[15],w=d*b*u-x*h*u+x*l*f-o*b*f-d*l*y+o*h*y,_=m*h*u-c*b*u-m*l*f+s*b*f+c*l*y-s*h*y,S=c*x*u-m*d*u+m*o*f-s*x*f-c*o*y+s*d*y,M=m*d*l-c*x*l-m*o*h+s*x*h+c*o*b-s*d*b,E=n*w+r*_+i*S+a*M;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/E;return e[0]=w*C,e[1]=(x*h*a-d*b*a-x*i*f+r*b*f+d*i*y-r*h*y)*C,e[2]=(o*b*a-x*l*a+x*i*u-r*b*u-o*i*y+r*l*y)*C,e[3]=(d*l*a-o*h*a-d*i*u+r*h*u+o*i*f-r*l*f)*C,e[4]=_*C,e[5]=(c*b*a-m*h*a+m*i*f-n*b*f-c*i*y+n*h*y)*C,e[6]=(m*l*a-s*b*a-m*i*u+n*b*u+s*i*y-n*l*y)*C,e[7]=(s*h*a-c*l*a+c*i*u-n*h*u-s*i*f+n*l*f)*C,e[8]=S*C,e[9]=(m*d*a-c*x*a-m*r*f+n*x*f+c*r*y-n*d*y)*C,e[10]=(s*x*a-m*o*a+m*r*u-n*x*u-s*r*y+n*o*y)*C,e[11]=(c*o*a-s*d*a-c*r*u+n*d*u+s*r*f-n*o*f)*C,e[12]=M*C,e[13]=(c*x*i-m*d*i+m*r*h-n*x*h-c*r*b+n*d*b)*C,e[14]=(m*o*i-s*x*i-m*r*l+n*x*l+s*r*b-n*o*b)*C,e[15]=(s*d*i-c*o*i+c*r*l-n*d*l-s*r*h+n*o*h)*C,this}scale(e){const n=this.elements,r=e.x,i=e.y,a=e.z;return n[0]*=r,n[4]*=i,n[8]*=a,n[1]*=r,n[5]*=i,n[9]*=a,n[2]*=r,n[6]*=i,n[10]*=a,n[3]*=r,n[7]*=i,n[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),a=1-r,s=e.x,o=e.y,l=e.z,u=a*s,c=a*o;return this.set(u*s+r,u*o-i*l,u*l+i*o,0,u*o+i*l,c*o+r,c*l-i*s,0,u*l-i*o,c*l+i*s,a*l*l+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,a,s){return this.set(1,r,a,0,e,1,s,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,a=n._x,s=n._y,o=n._z,l=n._w,u=a+a,c=s+s,d=o+o,h=a*u,f=a*c,m=a*d,x=s*c,b=s*d,y=o*d,w=l*u,_=l*c,S=l*d,M=r.x,E=r.y,C=r.z;return i[0]=(1-(x+y))*M,i[1]=(f+S)*M,i[2]=(m-_)*M,i[3]=0,i[4]=(f-S)*E,i[5]=(1-(h+y))*E,i[6]=(b+w)*E,i[7]=0,i[8]=(m+_)*C,i[9]=(b-w)*C,i[10]=(1-(h+x))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return r.set(1,1,1),n.identity(),this;let a=fp.set(i[0],i[1],i[2]).length();const s=fp.set(i[4],i[5],i[6]).length(),o=fp.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),Fo.copy(this);const u=1/a,c=1/s,d=1/o;return Fo.elements[0]*=u,Fo.elements[1]*=u,Fo.elements[2]*=u,Fo.elements[4]*=c,Fo.elements[5]*=c,Fo.elements[6]*=c,Fo.elements[8]*=d,Fo.elements[9]*=d,Fo.elements[10]*=d,n.setFromRotationMatrix(Fo),r.x=a,r.y=s,r.z=o,this}makePerspective(e,n,r,i,a,s,o=qs,l=!1){const u=this.elements,c=2*a/(n-e),d=2*a/(r-i),h=(n+e)/(n-e),f=(r+i)/(r-i);let m,x;if(l)m=a/(s-a),x=s*a/(s-a);else if(o===qs)m=-(s+a)/(s-a),x=-2*s*a/(s-a);else if(o===u0)m=-s/(s-a),x=-s*a/(s-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=h,u[12]=0,u[1]=0,u[5]=d,u[9]=f,u[13]=0,u[2]=0,u[6]=0,u[10]=m,u[14]=x,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,n,r,i,a,s,o=qs,l=!1){const u=this.elements,c=2/(n-e),d=2/(r-i),h=-(n+e)/(n-e),f=-(r+i)/(r-i);let m,x;if(l)m=1/(s-a),x=s/(s-a);else if(o===qs)m=-2/(s-a),x=-(s+a)/(s-a);else if(o===u0)m=-1/(s-a),x=-a/(s-a);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=c,u[4]=0,u[8]=0,u[12]=h,u[1]=0,u[5]=d,u[9]=0,u[13]=f,u[2]=0,u[6]=0,u[10]=m,u[14]=x,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const fp=new we,Fo=new fn,Yfe=new we(0,0,0),Xfe=new we(1,1,1),Tc=new we,ex=new we,Us=new we,N9=new fn,R9=new xa;class Js{constructor(e=0,n=0,r=0,i=Js.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,a=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],d=i[2],h=i[6],f=i[10];switch(n){case"XYZ":this._y=Math.asin(gn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-gn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-d,a),this._z=0);break;case"ZXY":this._x=Math.asin(gn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-gn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(gn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-gn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,f),this._y=0);break;default:Ut("Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return N9.makeRotationFromQuaternion(e),this.setFromRotationMatrix(N9,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return R9.setFromEuler(this),this.setFromQuaternion(R9,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Js.DEFAULT_ORDER="XYZ";class h0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Kfe=0;const P9=new we,pp=new xa,xu=new fn,tx=new we,Bm=new we,Zfe=new we,Jfe=new xa,D9=new we(1,0,0),O9=new we(0,1,0),L9=new we(0,0,1),F9={type:"added"},Qfe={type:"removed"},mp={type:"childadded",child:null},j4={type:"childremoved",child:null};class nr extends Wl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Kfe++}),this.uuid=Ws(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nr.DEFAULT_UP.clone();const e=new we,n=new Js,r=new xa,i=new we(1,1,1);function a(){r.setFromEuler(n,!1)}function s(){n.setFromQuaternion(r,void 0,!1)}n._onChange(a),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fn},normalMatrix:{value:new Sn}}),this.matrix=new fn,this.matrixWorld=new fn,this.matrixAutoUpdate=nr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=nr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new h0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return pp.setFromAxisAngle(e,n),this.quaternion.multiply(pp),this}rotateOnWorldAxis(e,n){return pp.setFromAxisAngle(e,n),this.quaternion.premultiply(pp),this}rotateX(e){return this.rotateOnAxis(D9,e)}rotateY(e){return this.rotateOnAxis(O9,e)}rotateZ(e){return this.rotateOnAxis(L9,e)}translateOnAxis(e,n){return P9.copy(e).applyQuaternion(this.quaternion),this.position.add(P9.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(D9,e)}translateY(e){return this.translateOnAxis(O9,e)}translateZ(e){return this.translateOnAxis(L9,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(xu.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?tx.copy(e):tx.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Bm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xu.lookAt(Bm,tx,this.up):xu.lookAt(tx,Bm,this.up),this.quaternion.setFromRotationMatrix(xu),i&&(xu.extractRotation(i.matrixWorld),pp.setFromRotationMatrix(xu),this.quaternion.premultiply(pp.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(tn("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(F9),mp.child=e,this.dispatchEvent(mp),mp.child=null):tn("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Qfe),j4.child=e,this.dispatchEvent(j4),j4.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),xu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),xu.multiply(e.parent.matrixWorld)),e.applyMatrix4(xu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(F9),mp.child=e,this.dispatchEvent(mp),mp.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,n);if(s!==void 0)return s}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bm,e,Zfe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bm,Jfe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const d=l[u];a(e.shapes,d)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(a(e.materials,this.material[l]));i.material=o}else i.material=a(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(a(e.animations,l))}}if(n){const o=s(e.geometries),l=s(e.materials),u=s(e.textures),c=s(e.images),d=s(e.shapes),h=s(e.skeletons),f=s(e.animations),m=s(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),d.length>0&&(r.shapes=d),h.length>0&&(r.skeletons=h),f.length>0&&(r.animations=f),m.length>0&&(r.nodes=m)}return r.object=i,r;function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}nr.DEFAULT_UP=new we(0,1,0);nr.DEFAULT_MATRIX_AUTO_UPDATE=!0;nr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Bo=new we,bu=new we,H4=new we,_u=new we,gp=new we,vp=new we,B9=new we,$4=new we,V4=new we,q4=new we,G4=new er,W4=new er,Y4=new er;class xs{constructor(e=new we,n=new we,r=new we){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),Bo.subVectors(e,n),i.cross(Bo);const a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}static getBarycoord(e,n,r,i,a){Bo.subVectors(i,n),bu.subVectors(r,n),H4.subVectors(e,n);const s=Bo.dot(Bo),o=Bo.dot(bu),l=Bo.dot(H4),u=bu.dot(bu),c=bu.dot(H4),d=s*u-o*o;if(d===0)return a.set(0,0,0),null;const h=1/d,f=(u*l-o*c)*h,m=(s*c-o*l)*h;return a.set(1-f-m,m,f)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,_u)===null?!1:_u.x>=0&&_u.y>=0&&_u.x+_u.y<=1}static getInterpolation(e,n,r,i,a,s,o,l){return this.getBarycoord(e,n,r,i,_u)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,_u.x),l.addScaledVector(s,_u.y),l.addScaledVector(o,_u.z),l)}static getInterpolatedAttribute(e,n,r,i,a,s){return G4.setScalar(0),W4.setScalar(0),Y4.setScalar(0),G4.fromBufferAttribute(e,n),W4.fromBufferAttribute(e,r),Y4.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(G4,a.x),s.addScaledVector(W4,a.y),s.addScaledVector(Y4,a.z),s}static isFrontFacing(e,n,r,i){return Bo.subVectors(r,n),bu.subVectors(e,n),Bo.cross(bu).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Bo.subVectors(this.c,this.b),bu.subVectors(this.a,this.b),Bo.cross(bu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return xs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return xs.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,a){return xs.getInterpolation(e,this.a,this.b,this.c,n,r,i,a)}containsPoint(e){return xs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return xs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,a=this.c;let s,o;gp.subVectors(i,r),vp.subVectors(a,r),$4.subVectors(e,r);const l=gp.dot($4),u=vp.dot($4);if(l<=0&&u<=0)return n.copy(r);V4.subVectors(e,i);const c=gp.dot(V4),d=vp.dot(V4);if(c>=0&&d<=c)return n.copy(i);const h=l*d-c*u;if(h<=0&&l>=0&&c<=0)return s=l/(l-c),n.copy(r).addScaledVector(gp,s);q4.subVectors(e,a);const f=gp.dot(q4),m=vp.dot(q4);if(m>=0&&f<=m)return n.copy(a);const x=f*u-l*m;if(x<=0&&u>=0&&m<=0)return o=u/(u-m),n.copy(r).addScaledVector(vp,o);const b=c*m-f*d;if(b<=0&&d-c>=0&&f-m>=0)return B9.subVectors(a,i),o=(d-c)/(d-c+(f-m)),n.copy(i).addScaledVector(B9,o);const y=1/(b+x+h);return s=x*y,o=h*y,n.copy(r).addScaledVector(gp,s).addScaledVector(vp,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const uK={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Cc={h:0,s:0,l:0},nx={h:0,s:0,l:0};function X4(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}let zt=class{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Na){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Yn.colorSpaceToWorking(this,n),this}setRGB(e,n,r,i=Yn.workingColorSpace){return this.r=e,this.g=n,this.b=r,Yn.colorSpaceToWorking(this,i),this}setHSL(e,n,r,i=Yn.workingColorSpace){if(e=XN(e,1),n=gn(n,0,1),r=gn(r,0,1),n===0)this.r=this.g=this.b=r;else{const a=r<=.5?r*(1+n):r+n-r*n,s=2*r-a;this.r=X4(s,a,e+1/3),this.g=X4(s,a,e),this.b=X4(s,a,e-1/3)}return Yn.colorSpaceToWorking(this,i),this}setStyle(e,n=Na){function r(a){a!==void 0&&parseFloat(a)<1&&Ut("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:Ut("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=i[1],s=a.length;if(s===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,n);if(s===6)return this.setHex(parseInt(a,16),n);Ut("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Na){const r=uK[e.toLowerCase()];return r!==void 0?this.setHex(r,n):Ut("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Du(e.r),this.g=Du(e.g),this.b=Du(e.b),this}copyLinearToSRGB(e){return this.r=Jp(e.r),this.g=Jp(e.g),this.b=Jp(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Na){return Yn.workingToColorSpace(ka.copy(this),e),Math.round(gn(ka.r*255,0,255))*65536+Math.round(gn(ka.g*255,0,255))*256+Math.round(gn(ka.b*255,0,255))}getHexString(e=Na){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Yn.workingColorSpace){Yn.workingToColorSpace(ka.copy(this),n);const r=ka.r,i=ka.g,a=ka.b,s=Math.max(r,i,a),o=Math.min(r,i,a);let l,u;const c=(o+s)/2;if(o===s)l=0,u=0;else{const d=s-o;switch(u=c<=.5?d/(s+o):d/(2-s-o),s){case r:l=(i-a)/d+(i<a?6:0);break;case i:l=(a-r)/d+2;break;case a:l=(r-i)/d+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,n=Yn.workingColorSpace){return Yn.workingToColorSpace(ka.copy(this),n),e.r=ka.r,e.g=ka.g,e.b=ka.b,e}getStyle(e=Na){Yn.workingToColorSpace(ka.copy(this),e);const n=ka.r,r=ka.g,i=ka.b;return e!==Na?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(Cc),this.setHSL(Cc.h+e,Cc.s+n,Cc.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(Cc),e.getHSL(nx);const r=Lg(Cc.h,nx.h,n),i=Lg(Cc.s,nx.s,n),a=Lg(Cc.l,nx.l,n);return this.setHSL(r,i,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,a=e.elements;return this.r=a[0]*n+a[3]*r+a[6]*i,this.g=a[1]*n+a[4]*r+a[7]*i,this.b=a[2]*n+a[5]*r+a[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const ka=new zt;zt.NAMES=uK;let epe=0;class Ua extends Wl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:epe++}),this.uuid=Ws(),this.name="",this.type="Material",this.blending=Lh,this.side=Uu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=u_,this.blendDst=c_,this.blendEquation=zc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new zt(0,0,0),this.blendAlpha=0,this.depthFunc=Xh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=U6,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ph,this.stencilZFail=ph,this.stencilZPass=ph,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){Ut(`Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){Ut(`Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Lh&&(r.blending=this.blending),this.side!==Uu&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==u_&&(r.blendSrc=this.blendSrc),this.blendDst!==c_&&(r.blendDst=this.blendDst),this.blendEquation!==zc&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Xh&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==U6&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ph&&(r.stencilFail=this.stencilFail),this.stencilZFail!==ph&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==ph&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.allowOverride===!1&&(r.allowOverride=!1),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(a){const s=[];for(const o in a){const l=a[o];delete l.metadata,s.push(l)}return s}if(n){const a=i(e.textures),s=i(e.images);a.length>0&&(r.textures=a),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let a=0;a!==i;++a)r[a]=n[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Gu extends Ua{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Js,this.combine=mv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Iu=tpe();function tpe(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(r[l]=0,r[l|256]=32768,i[l]=24,i[l|256]=24):u<-14?(r[l]=1024>>-u-14,r[l|256]=1024>>-u-14|32768,i[l]=-u-1,i[l|256]=-u-1):u<=15?(r[l]=u+15<<10,r[l|256]=u+15<<10|32768,i[l]=13,i[l|256]=13):u<128?(r[l]=31744,r[l|256]=64512,i[l]=24,i[l|256]=24):(r[l]=31744,r[l|256]=64512,i[l]=13,i[l|256]=13)}const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,a[l]=u|c}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:s,offsetTable:o}}function fs(t){Math.abs(t)>65504&&Ut("DataUtils.toHalfFloat(): Value out of range."),t=gn(t,-65504,65504),Iu.floatView[0]=t;const e=Iu.uint32View[0],n=e>>23&511;return Iu.baseTable[n]+((e&8388607)>>Iu.shiftTable[n])}function pg(t){const e=t>>10;return Iu.uint32View[0]=Iu.mantissaTable[Iu.offsetTable[e]+(t&1023)]+Iu.exponentTable[e],Iu.floatView[0]}class npe{static toHalfFloat(e){return fs(e)}static fromHalfFloat(e){return pg(e)}}const Fi=new we,rx=new dt;let rpe=0;class Xn{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:rpe++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=m1,this.updateRanges=[],this.gpuType=Qa,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,a=this.itemSize;i<a;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)rx.fromBufferAttribute(this,n),rx.applyMatrix3(e),this.setXY(n,rx.x,rx.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)Fi.fromBufferAttribute(this,n),Fi.applyMatrix3(e),this.setXYZ(n,Fi.x,Fi.y,Fi.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)Fi.fromBufferAttribute(this,n),Fi.applyMatrix4(e),this.setXYZ(n,Fi.x,Fi.y,Fi.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Fi.fromBufferAttribute(this,n),Fi.applyNormalMatrix(e),this.setXYZ(n,Fi.x,Fi.y,Fi.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Fi.fromBufferAttribute(this,n),Fi.transformDirection(e),this.setXYZ(n,Fi.x,Fi.y,Fi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=Za(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=In(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Za(n,this.array)),n}setX(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Za(n,this.array)),n}setY(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Za(n,this.array)),n}setZ(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Za(n,this.array)),n}setW(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,a){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array),a=In(a,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==m1&&(e.usage=this.usage),e}}class ipe extends Xn{constructor(e,n,r){super(new Int8Array(e),n,r)}}class ape extends Xn{constructor(e,n,r){super(new Uint8Array(e),n,r)}}class spe extends Xn{constructor(e,n,r){super(new Uint8ClampedArray(e),n,r)}}class ope extends Xn{constructor(e,n,r){super(new Int16Array(e),n,r)}}class JN extends Xn{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class lpe extends Xn{constructor(e,n,r){super(new Int32Array(e),n,r)}}class QN extends Xn{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class upe extends Xn{constructor(e,n,r){super(new Uint16Array(e),n,r),this.isFloat16BufferAttribute=!0}getX(e){let n=pg(this.array[e*this.itemSize]);return this.normalized&&(n=Za(n,this.array)),n}setX(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize]=fs(n),this}getY(e){let n=pg(this.array[e*this.itemSize+1]);return this.normalized&&(n=Za(n,this.array)),n}setY(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+1]=fs(n),this}getZ(e){let n=pg(this.array[e*this.itemSize+2]);return this.normalized&&(n=Za(n,this.array)),n}setZ(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+2]=fs(n),this}getW(e){let n=pg(this.array[e*this.itemSize+3]);return this.normalized&&(n=Za(n,this.array)),n}setW(e,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+3]=fs(n),this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array)),this.array[e+0]=fs(n),this.array[e+1]=fs(r),this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array)),this.array[e+0]=fs(n),this.array[e+1]=fs(r),this.array[e+2]=fs(i),this}setXYZW(e,n,r,i,a){return e*=this.itemSize,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array),a=In(a,this.array)),this.array[e+0]=fs(n),this.array[e+1]=fs(r),this.array[e+2]=fs(i),this.array[e+3]=fs(a),this}}class Wt extends Xn{constructor(e,n,r){super(new Float32Array(e),n,r)}}let cpe=0;const lo=new fn,K4=new nr,yp=new we,zs=new Ai,Um=new Ai,ia=new we;class bn extends Wl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:cpe++}),this.uuid=Ws(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(aK(e)?QN:JN)(e,1):this.index=e,this}setIndirect(e,n=0){return this.indirect=e,this.indirectOffset=n,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new Sn().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return lo.makeRotationFromQuaternion(e),this.applyMatrix4(lo),this}rotateX(e){return lo.makeRotationX(e),this.applyMatrix4(lo),this}rotateY(e){return lo.makeRotationY(e),this.applyMatrix4(lo),this}rotateZ(e){return lo.makeRotationZ(e),this.applyMatrix4(lo),this}translate(e,n,r){return lo.makeTranslation(e,n,r),this.applyMatrix4(lo),this}scale(e,n,r){return lo.makeScale(e,n,r),this.applyMatrix4(lo),this}lookAt(e){return K4.lookAt(e),K4.updateMatrix(),this.applyMatrix4(K4.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yp).negate(),this.translate(yp.x,yp.y,yp.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,a=e.length;i<a;i++){const s=e[i];r.push(s.x,s.y,s.z||0)}this.setAttribute("position",new Wt(r,3))}else{const r=Math.min(e.length,n.count);for(let i=0;i<r;i++){const a=e[i];n.setXYZ(i,a.x,a.y,a.z||0)}e.length>n.count&&Ut("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ai);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){tn("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new we(-1/0,-1/0,-1/0),new we(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const a=n[r];zs.setFromBufferAttribute(a),this.morphTargetsRelative?(ia.addVectors(this.boundingBox.min,zs.min),this.boundingBox.expandByPoint(ia),ia.addVectors(this.boundingBox.max,zs.max),this.boundingBox.expandByPoint(ia)):(this.boundingBox.expandByPoint(zs.min),this.boundingBox.expandByPoint(zs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&tn('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hi);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){tn("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new we,1/0);return}if(e){const r=this.boundingSphere.center;if(zs.setFromBufferAttribute(e),n)for(let a=0,s=n.length;a<s;a++){const o=n[a];Um.setFromBufferAttribute(o),this.morphTargetsRelative?(ia.addVectors(zs.min,Um.min),zs.expandByPoint(ia),ia.addVectors(zs.max,Um.max),zs.expandByPoint(ia)):(zs.expandByPoint(Um.min),zs.expandByPoint(Um.max))}zs.getCenter(r);let i=0;for(let a=0,s=e.count;a<s;a++)ia.fromBufferAttribute(e,a),i=Math.max(i,r.distanceToSquared(ia));if(n)for(let a=0,s=n.length;a<s;a++){const o=n[a],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)ia.fromBufferAttribute(o,u),l&&(yp.fromBufferAttribute(e,u),ia.add(yp)),i=Math.max(i,r.distanceToSquared(ia))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&tn('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){tn("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,a=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xn(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),o=[],l=[];for(let R=0;R<r.count;R++)o[R]=new we,l[R]=new we;const u=new we,c=new we,d=new we,h=new dt,f=new dt,m=new dt,x=new we,b=new we;function y(R,k,I){u.fromBufferAttribute(r,R),c.fromBufferAttribute(r,k),d.fromBufferAttribute(r,I),h.fromBufferAttribute(a,R),f.fromBufferAttribute(a,k),m.fromBufferAttribute(a,I),c.sub(u),d.sub(u),f.sub(h),m.sub(h);const N=1/(f.x*m.y-m.x*f.y);isFinite(N)&&(x.copy(c).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(N),b.copy(d).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(N),o[R].add(x),o[k].add(x),o[I].add(x),l[R].add(b),l[k].add(b),l[I].add(b))}let w=this.groups;w.length===0&&(w=[{start:0,count:e.count}]);for(let R=0,k=w.length;R<k;++R){const I=w[R],N=I.start,D=I.count;for(let F=N,L=N+D;F<L;F+=3)y(e.getX(F+0),e.getX(F+1),e.getX(F+2))}const _=new we,S=new we,M=new we,E=new we;function C(R){M.fromBufferAttribute(i,R),E.copy(M);const k=o[R];_.copy(k),_.sub(M.multiplyScalar(M.dot(k))).normalize(),S.crossVectors(E,k);const N=S.dot(l[R])<0?-1:1;s.setXYZW(R,_.x,_.y,_.z,N)}for(let R=0,k=w.length;R<k;++R){const I=w[R],N=I.start,D=I.count;for(let F=N,L=N+D;F<L;F+=3)C(e.getX(F+0)),C(e.getX(F+1)),C(e.getX(F+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Xn(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let h=0,f=r.count;h<f;h++)r.setXYZ(h,0,0,0);const i=new we,a=new we,s=new we,o=new we,l=new we,u=new we,c=new we,d=new we;if(e)for(let h=0,f=e.count;h<f;h+=3){const m=e.getX(h+0),x=e.getX(h+1),b=e.getX(h+2);i.fromBufferAttribute(n,m),a.fromBufferAttribute(n,x),s.fromBufferAttribute(n,b),c.subVectors(s,a),d.subVectors(i,a),c.cross(d),o.fromBufferAttribute(r,m),l.fromBufferAttribute(r,x),u.fromBufferAttribute(r,b),o.add(c),l.add(c),u.add(c),r.setXYZ(m,o.x,o.y,o.z),r.setXYZ(x,l.x,l.y,l.z),r.setXYZ(b,u.x,u.y,u.z)}else for(let h=0,f=n.count;h<f;h+=3)i.fromBufferAttribute(n,h+0),a.fromBufferAttribute(n,h+1),s.fromBufferAttribute(n,h+2),c.subVectors(s,a),d.subVectors(i,a),c.cross(d),r.setXYZ(h+0,c.x,c.y,c.z),r.setXYZ(h+1,c.x,c.y,c.z),r.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)ia.fromBufferAttribute(e,n),ia.normalize(),e.setXYZ(n,ia.x,ia.y,ia.z)}toNonIndexed(){function e(o,l){const u=o.array,c=o.itemSize,d=o.normalized,h=new u.constructor(l.length*c);let f=0,m=0;for(let x=0,b=l.length;x<b;x++){o.isInterleavedBufferAttribute?f=l[x]*o.data.stride+o.offset:f=l[x]*c;for(let y=0;y<c;y++)h[m++]=u[f++]}return new Xn(h,c,d)}if(this.index===null)return Ut("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new bn,r=this.index.array,i=this.attributes;for(const o in i){const l=i[o],u=e(l,r);n.setAttribute(o,u)}const a=this.morphAttributes;for(const o in a){const l=[],u=a[o];for(let c=0,d=u.length;c<d;c++){const h=u[c],f=e(h,r);l.push(f)}n.morphAttributes[o]=l}n.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,l=s.length;o<l;o++){const u=s[o];n.addGroup(u.start,u.count,u.materialIndex)}return n}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const l in r){const u=r[l];e.data.attributes[l]=u.toJSON(e.data)}const i={};let a=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let d=0,h=u.length;d<h;d++){const f=u[d];c.push(f.toJSON(e.data))}c.length>0&&(i[l]=c,a=!0)}a&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const u in i){const c=i[u];this.setAttribute(u,c.clone(n))}const a=e.morphAttributes;for(const u in a){const c=[],d=a[u];for(let h=0,f=d.length;h<f;h++)c.push(d[h].clone(n));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let u=0,c=s.length;u<c;u++){const d=s[u];this.addGroup(d.start,d.count,d.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const U9=new fn,Wd=new ff,ix=new Hi,z9=new we,ax=new we,sx=new we,ox=new we,Z4=new we,lx=new we,j9=new we,ux=new we;class Kr extends nr{constructor(e=new bn,n=new Gu){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,a=r.morphAttributes.position,s=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(a&&o){lx.set(0,0,0);for(let l=0,u=a.length;l<u;l++){const c=o[l],d=a[l];c!==0&&(Z4.fromBufferAttribute(d,e),s?lx.addScaledVector(Z4,c):lx.addScaledVector(Z4.sub(n),c))}n.add(lx)}return n}raycast(e,n){const r=this.geometry,i=this.material,a=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),ix.copy(r.boundingSphere),ix.applyMatrix4(a),Wd.copy(e.ray).recast(e.near),!(ix.containsPoint(Wd.origin)===!1&&(Wd.intersectSphere(ix,z9)===null||Wd.origin.distanceToSquared(z9)>(e.far-e.near)**2))&&(U9.copy(a).invert(),Wd.copy(e.ray).applyMatrix4(U9),!(r.boundingBox!==null&&Wd.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Wd)))}_computeIntersections(e,n,r){let i;const a=this.geometry,s=this.material,o=a.index,l=a.attributes.position,u=a.attributes.uv,c=a.attributes.uv1,d=a.attributes.normal,h=a.groups,f=a.drawRange;if(o!==null)if(Array.isArray(s))for(let m=0,x=h.length;m<x;m++){const b=h[m],y=s[b.materialIndex],w=Math.max(b.start,f.start),_=Math.min(o.count,Math.min(b.start+b.count,f.start+f.count));for(let S=w,M=_;S<M;S+=3){const E=o.getX(S),C=o.getX(S+1),R=o.getX(S+2);i=cx(this,y,e,r,u,c,d,E,C,R),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=b.materialIndex,n.push(i))}}else{const m=Math.max(0,f.start),x=Math.min(o.count,f.start+f.count);for(let b=m,y=x;b<y;b+=3){const w=o.getX(b),_=o.getX(b+1),S=o.getX(b+2);i=cx(this,s,e,r,u,c,d,w,_,S),i&&(i.faceIndex=Math.floor(b/3),n.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let m=0,x=h.length;m<x;m++){const b=h[m],y=s[b.materialIndex],w=Math.max(b.start,f.start),_=Math.min(l.count,Math.min(b.start+b.count,f.start+f.count));for(let S=w,M=_;S<M;S+=3){const E=S,C=S+1,R=S+2;i=cx(this,y,e,r,u,c,d,E,C,R),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=b.materialIndex,n.push(i))}}else{const m=Math.max(0,f.start),x=Math.min(l.count,f.start+f.count);for(let b=m,y=x;b<y;b+=3){const w=b,_=b+1,S=b+2;i=cx(this,s,e,r,u,c,d,w,_,S),i&&(i.faceIndex=Math.floor(b/3),n.push(i))}}}}function dpe(t,e,n,r,i,a,s,o){let l;if(e.side===rs?l=r.intersectTriangle(s,a,i,!0,o):l=r.intersectTriangle(i,a,s,e.side===Uu,o),l===null)return null;ux.copy(o),ux.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(ux);return u<n.near||u>n.far?null:{distance:u,point:ux.clone(),object:t}}function cx(t,e,n,r,i,a,s,o,l,u){t.getVertexPosition(o,ax),t.getVertexPosition(l,sx),t.getVertexPosition(u,ox);const c=dpe(t,e,n,r,ax,sx,ox,j9);if(c){const d=new we;xs.getBarycoord(j9,ax,sx,ox,d),i&&(c.uv=xs.getInterpolatedAttribute(i,o,l,u,d,new dt)),a&&(c.uv1=xs.getInterpolatedAttribute(a,o,l,u,d,new dt)),s&&(c.normal=xs.getInterpolatedAttribute(s,o,l,u,d,new we),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const h={a:o,b:l,c:u,normal:new we,materialIndex:0};xs.getNormal(ax,sx,ox,h.normal),c.face=h,c.barycoord=d}return c}class pf extends bn{constructor(e=1,n=1,r=1,i=1,a=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:a,depthSegments:s};const o=this;i=Math.floor(i),a=Math.floor(a),s=Math.floor(s);const l=[],u=[],c=[],d=[];let h=0,f=0;m("z","y","x",-1,-1,r,n,e,s,a,0),m("z","y","x",1,-1,r,n,-e,s,a,1),m("x","z","y",1,1,e,r,n,i,s,2),m("x","z","y",1,-1,e,r,-n,i,s,3),m("x","y","z",1,-1,e,n,r,i,a,4),m("x","y","z",-1,-1,e,n,-r,i,a,5),this.setIndex(l),this.setAttribute("position",new Wt(u,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(d,2));function m(x,b,y,w,_,S,M,E,C,R,k){const I=S/C,N=M/R,D=S/2,F=M/2,L=E/2,U=C+1,j=R+1;let q=0,Z=0;const Q=new we;for(let z=0;z<j;z++){const W=z*N-F;for(let X=0;X<U;X++){const H=X*I-D;Q[x]=H*w,Q[b]=W*_,Q[y]=L,u.push(Q.x,Q.y,Q.z),Q[x]=0,Q[b]=0,Q[y]=E>0?1:-1,c.push(Q.x,Q.y,Q.z),d.push(X/C),d.push(1-z/R),q+=1}}for(let z=0;z<R;z++)for(let W=0;W<C;W++){const X=h+W+U*z,H=h+W+U*(z+1),J=h+(W+1)+U*(z+1),te=h+(W+1)+U*z;l.push(X,H,te),l.push(H,J,te),Z+=6}o.addGroup(f,Z,k),f+=Z,h+=q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pf(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function f0(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(Ut("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Xa(t){const e={};for(let n=0;n<t.length;n++){const r=f0(t[n]);for(const i in r)e[i]=r[i]}return e}function hpe(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function cK(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Yn.workingColorSpace}const y1={clone:f0,merge:Xa};var fpe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ppe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ss extends Ua{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=fpe,this.fragmentShader=ppe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=f0(e.uniforms),this.uniformsGroups=hpe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?n.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?n.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?n.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?n.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?n.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?n.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?n.uniforms[i]={type:"m4",value:s.toArray()}:n.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}let E2=class extends nr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new fn,this.projectionMatrix=new fn,this.projectionMatrixInverse=new fn,this.coordinateSystem=qs,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Mc=new we,H9=new dt,$9=new dt;class Si extends E2{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=d0*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Fh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return d0*2*Math.atan(Math.tan(Fh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){Mc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Mc.x,Mc.y).multiplyScalar(-e/Mc.z),Mc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Mc.x,Mc.y).multiplyScalar(-e/Mc.z)}getViewSize(e,n){return this.getViewBounds(e,H9,$9),n.subVectors($9,H9)}setViewOffset(e,n,r,i,a,s){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(Fh*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,a=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,u=s.fullHeight;a+=s.offsetX*i/l,n-=s.offsetY*r/u,i*=s.width/l,r*=s.height/u}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+i,n,n-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const xp=-90,bp=1;class dK extends nr{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Si(xp,bp,e,n);i.layers=this.layers,this.add(i);const a=new Si(xp,bp,e,n);a.layers=this.layers,this.add(a);const s=new Si(xp,bp,e,n);s.layers=this.layers,this.add(s);const o=new Si(xp,bp,e,n);o.layers=this.layers,this.add(o);const l=new Si(xp,bp,e,n);l.layers=this.layers,this.add(l);const u=new Si(xp,bp,e,n);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,a,s,o,l]=n;for(const u of n)this.remove(u);if(e===qs)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===u0)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of n)this.add(u),u.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,s,o,l,u,c]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const x=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,a),e.setRenderTarget(r,1,i),e.render(n,s),e.setRenderTarget(r,2,i),e.render(n,o),e.setRenderTarget(r,3,i),e.render(n,l),e.setRenderTarget(r,4,i),e.render(n,u),r.texture.generateMipmaps=x,e.setRenderTarget(r,5,i),e.render(n,c),e.setRenderTarget(d,h,f),e.xr.enabled=m,r.texture.needsPMREMUpdate=!0}}class vv extends hi{constructor(e=[],n=Hl,r,i,a,s,o,l,u,c){super(e,n,r,i,a,s,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class e8 extends Ys{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new vv(i),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new pf(5,5,5),a=new Ss({name:"CubemapFromEquirect",uniforms:f0(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:rs,blending:Fl});a.uniforms.tEquirect.value=n;const s=new Kr(i,a),o=n.minFilter;return n.minFilter===Il&&(n.minFilter=Pr),new dK(1,10,this).update(e,s),n.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,n=!0,r=!0,i=!0){const a=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(n,r,i);e.setRenderTarget(a)}}class qp extends nr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const mpe={type:"move"};class Bb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new qp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new we,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new we),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new we,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new we),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,a=null,s=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(u&&e.hand){s=!0;for(const x of e.hand.values()){const b=n.getJointPose(x,r),y=this._getHandJoint(u,x);b!==null&&(y.matrix.fromArray(b.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=b.radius),y.visible=b!==null}const c=u.joints["index-finger-tip"],d=u.joints["thumb-tip"],h=c.position.distanceTo(d.position),f=.02,m=.005;u.inputState.pinching&&h>f+m?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&h<=f-m&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=n.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&a!==null&&(i=a),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(mpe)))}return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=a!==null),u!==null&&(u.visible=s!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new qp;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}class T2{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new zt(e),this.density=n}clone(){return new T2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class C2{constructor(e,n=1,r=1e3){this.isFog=!0,this.name="",this.color=new zt(e),this.near=n,this.far=r}clone(){return new C2(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class t8 extends nr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Js,this.environmentIntensity=1,this.environmentRotation=new Js,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class M2{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=m1,this.updateRanges=[],this.version=0,this.uuid=Ws()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,r){e*=this.stride,r*=n.stride;for(let i=0,a=this.stride;i<a;i++)this.array[e+i]=n.array[r+i];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(n,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const qa=new we;class Gs{constructor(e,n,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,r=this.data.count;n<r;n++)qa.fromBufferAttribute(this,n),qa.applyMatrix4(e),this.setXYZ(n,qa.x,qa.y,qa.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)qa.fromBufferAttribute(this,n),qa.applyNormalMatrix(e),this.setXYZ(n,qa.x,qa.y,qa.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)qa.fromBufferAttribute(this,n),qa.transformDirection(e),this.setXYZ(n,qa.x,qa.y,qa.z);return this}getComponent(e,n){let r=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(r=Za(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=In(r,this.array)),this.data.array[e*this.data.stride+this.offset+n]=r,this}setX(e,n){return this.normalized&&(n=In(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=In(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=In(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=In(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=Za(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=Za(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=Za(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=Za(n,this.array)),n}setXY(e,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=In(n,this.array),r=In(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this}setXYZ(e,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,n,r,i,a){return e=e*this.data.stride+this.offset,this.normalized&&(n=In(n,this.array),r=In(r,this.array),i=In(i,this.array),a=In(a,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=a,this}clone(e){if(e===void 0){v1("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[i+a])}return new Xn(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Gs(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){v1("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[i+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class n8 extends Ua{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new zt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let _p;const zm=new we,wp=new we,Sp=new we,Ep=new dt,jm=new dt,hK=new fn,dx=new we,Hm=new we,hx=new we,V9=new dt,J4=new dt,q9=new dt;class fK extends nr{constructor(e=new n8){if(super(),this.isSprite=!0,this.type="Sprite",_p===void 0){_p=new bn;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new M2(n,5);_p.setIndex([0,1,2,0,2,3]),_p.setAttribute("position",new Gs(r,3,0,!1)),_p.setAttribute("uv",new Gs(r,2,3,!1))}this.geometry=_p,this.material=e,this.center=new dt(.5,.5),this.count=1}raycast(e,n){e.camera===null&&tn('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),wp.setFromMatrixScale(this.matrixWorld),hK.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Sp.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&wp.multiplyScalar(-Sp.z);const r=this.material.rotation;let i,a;r!==0&&(a=Math.cos(r),i=Math.sin(r));const s=this.center;fx(dx.set(-.5,-.5,0),Sp,s,wp,i,a),fx(Hm.set(.5,-.5,0),Sp,s,wp,i,a),fx(hx.set(.5,.5,0),Sp,s,wp,i,a),V9.set(0,0),J4.set(1,0),q9.set(1,1);let o=e.ray.intersectTriangle(dx,Hm,hx,!1,zm);if(o===null&&(fx(Hm.set(-.5,.5,0),Sp,s,wp,i,a),J4.set(0,1),o=e.ray.intersectTriangle(dx,hx,Hm,!1,zm),o===null))return;const l=e.ray.origin.distanceTo(zm);l<e.near||l>e.far||n.push({distance:l,point:zm.clone(),uv:xs.getInterpolation(zm,dx,Hm,hx,V9,J4,q9,new dt),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function fx(t,e,n,r,i,a){Ep.subVectors(t,n).addScalar(.5).multiply(r),i!==void 0?(jm.x=a*Ep.x-i*Ep.y,jm.y=i*Ep.x+a*Ep.y):jm.copy(Ep),t.copy(e),t.x+=jm.x,t.y+=jm.y,t.applyMatrix4(hK)}const px=new we,G9=new we;class pK extends nr{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let r=0,i=n.length;r<i;r++){const a=n[r];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,r=0){n=Math.abs(n);const i=this.levels;let a;for(a=0;a<i.length&&!(n<i[a].distance);a++);return i.splice(a,0,{distance:n,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){const n=this.levels;for(let r=0;r<n.length;r++)if(n[r].distance===e){const i=n.splice(r,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let r,i;for(r=1,i=n.length;r<i;r++){let a=n[r].distance;if(n[r].object.visible&&(a-=a*n[r].hysteresis),e<a)break}return n[r-1].object}return null}raycast(e,n){if(this.levels.length>0){px.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(px);this.getObjectForDistance(i).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){px.setFromMatrixPosition(e.matrixWorld),G9.setFromMatrixPosition(this.matrixWorld);const r=px.distanceTo(G9)/e.zoom;n[0].object.visible=!0;let i,a;for(i=1,a=n.length;i<a;i++){let s=n[i].distance;if(n[i].object.visible&&(s-=s*n[i].hysteresis),r>=s)n[i-1].object.visible=!1,n[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<a;i++)n[i].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const r=this.levels;for(let i=0,a=r.length;i<a;i++){const s=r[i];n.object.levels.push({object:s.object.uuid,distance:s.distance,hysteresis:s.hysteresis})}return n}}const W9=new we,Y9=new er,X9=new er,gpe=new we,K9=new fn,mx=new we,Q4=new Hi,Z9=new fn,eE=new ff;class mK extends Kr{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=B6,this.bindMatrix=new fn,this.bindMatrixInverse=new fn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ai),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,mx),this.boundingBox.expandByPoint(mx)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Hi),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)this.getVertexPosition(r,mx),this.boundingSphere.expandByPoint(mx)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const r=this.material,i=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Q4.copy(this.boundingSphere),Q4.applyMatrix4(i),e.ray.intersectsSphere(Q4)!==!1&&(Z9.copy(i).invert(),eE.copy(e.ray).applyMatrix4(Z9),!(this.boundingBox!==null&&eE.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,eE)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new er,n=this.geometry.attributes.skinWeight;for(let r=0,i=n.count;r<i;r++){e.fromBufferAttribute(n,r);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),n.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===B6?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===GX?this.bindMatrixInverse.copy(this.bindMatrix).invert():Ut("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const r=this.skeleton,i=this.geometry;Y9.fromBufferAttribute(i.attributes.skinIndex,e),X9.fromBufferAttribute(i.attributes.skinWeight,e),W9.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let a=0;a<4;a++){const s=X9.getComponent(a);if(s!==0){const o=Y9.getComponent(a);K9.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),n.addScaledVector(gpe.copy(W9).applyMatrix4(K9),s)}}return n.applyMatrix4(this.bindMatrixInverse)}}class r8 extends nr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class tl extends hi{constructor(e=null,n=1,r=1,i,a,s,o,l,u=Ti,c=Ti,d,h){super(null,s,o,l,u,c,i,a,d,h),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const J9=new fn,vpe=new fn;class A2{constructor(e=[],n=[]){this.uuid=Ws(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){Ut("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new fn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const r=new fn;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,n=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let a=0,s=e.length;a<s;a++){const o=e[a]?e[a].matrixWorld:vpe;J9.multiplyMatrices(o,n[a]),J9.toArray(r,a*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new A2(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const r=new tl(n,e,e,Da,Qa);return r.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=r,this}getBoneByName(e){for(let n=0,r=this.bones.length;n<r;n++){const i=this.bones[n];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const a=e.bones[r];let s=n[a];s===void 0&&(Ut("Skeleton: No bone found with UUID:",a),s=new r8),this.bones.push(s),this.boneInverses.push(new fn().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,r=this.boneInverses;for(let i=0,a=n.length;i<a;i++){const s=n[i];e.bones.push(s.uuid);const o=r[i];e.boneInverses.push(o.toArray())}return e}}class Zh extends Xn{constructor(e,n,r,i=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Tp=new fn,Q9=new fn,gx=[],eO=new Ai,ype=new fn,$m=new Kr,Vm=new Hi;class gK extends Kr{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new Zh(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,ype)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new Ai),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Tp),eO.copy(e.boundingBox).applyMatrix4(Tp),this.boundingBox.union(eO)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new Hi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,Tp),Vm.copy(e.boundingSphere).applyMatrix4(Tp),this.boundingSphere.union(Vm)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,n){const r=n.morphTargetInfluences,i=this.morphTexture.source.data.data,a=r.length+1,s=e*a+1;for(let o=0;o<r.length;o++)r[o]=i[s+o]}raycast(e,n){const r=this.matrixWorld,i=this.count;if($m.geometry=this.geometry,$m.material=this.material,$m.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Vm.copy(this.boundingSphere),Vm.applyMatrix4(r),e.ray.intersectsSphere(Vm)!==!1))for(let a=0;a<i;a++){this.getMatrixAt(a,Tp),Q9.multiplyMatrices(r,Tp),$m.matrixWorld=Q9,$m.raycast(e,gx);for(let s=0,o=gx.length;s<o;s++){const l=gx[s];l.instanceId=a,l.object=this,n.push(l)}gx.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new Zh(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,n){const r=n.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new tl(new Float32Array(i*this.count),i,this.count,g2,Qa));const a=this.morphTexture.source.data.data;let s=0;for(let u=0;u<r.length;u++)s+=r[u];const o=this.geometry.morphTargetsRelative?1:1-s,l=i*e;a[l]=o,a.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const tE=new we,xpe=new we,bpe=new Sn;class Tu{constructor(e=new we(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=tE.subVectors(r,n).cross(xpe.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(tE),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/i;return a<0||a>1?null:n.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||bpe.getNormalMatrix(e),i=this.coplanarPoint(tE).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Yd=new Hi,_pe=new dt(.5,.5),vx=new we;class z0{constructor(e=new Tu,n=new Tu,r=new Tu,i=new Tu,a=new Tu,s=new Tu){this.planes=[e,n,r,i,a,s]}set(e,n,r,i,a,s){const o=this.planes;return o[0].copy(e),o[1].copy(n),o[2].copy(r),o[3].copy(i),o[4].copy(a),o[5].copy(s),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=qs,r=!1){const i=this.planes,a=e.elements,s=a[0],o=a[1],l=a[2],u=a[3],c=a[4],d=a[5],h=a[6],f=a[7],m=a[8],x=a[9],b=a[10],y=a[11],w=a[12],_=a[13],S=a[14],M=a[15];if(i[0].setComponents(u-s,f-c,y-m,M-w).normalize(),i[1].setComponents(u+s,f+c,y+m,M+w).normalize(),i[2].setComponents(u+o,f+d,y+x,M+_).normalize(),i[3].setComponents(u-o,f-d,y-x,M-_).normalize(),r)i[4].setComponents(l,h,b,S).normalize(),i[5].setComponents(u-l,f-h,y-b,M-S).normalize();else if(i[4].setComponents(u-l,f-h,y-b,M-S).normalize(),n===qs)i[5].setComponents(u+l,f+h,y+b,M+S).normalize();else if(n===u0)i[5].setComponents(l,h,b,S).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Yd.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Yd.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Yd)}intersectsSprite(e){Yd.center.set(0,0,0);const n=_pe.distanceTo(e.center);return Yd.radius=.7071067811865476+n,Yd.applyMatrix4(e.matrixWorld),this.intersectsSphere(Yd)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let a=0;a<6;a++)if(n[a].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(vx.x=i.normal.x>0?e.max.x:e.min.x,vx.y=i.normal.y>0?e.max.y:e.min.y,vx.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(vx)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const vl=new fn,yl=new z0;class k2{constructor(){this.coordinateSystem=qs}intersectsObject(e,n){if(!n.isArrayCamera||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(vl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),yl.setFromProjectionMatrix(vl,i.coordinateSystem,i.reversedDepth),yl.intersectsObject(e))return!0}return!1}intersectsSprite(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(vl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),yl.setFromProjectionMatrix(vl,i.coordinateSystem,i.reversedDepth),yl.intersectsSprite(e))return!0}return!1}intersectsSphere(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(vl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),yl.setFromProjectionMatrix(vl,i.coordinateSystem,i.reversedDepth),yl.intersectsSphere(e))return!0}return!1}intersectsBox(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(vl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),yl.setFromProjectionMatrix(vl,i.coordinateSystem,i.reversedDepth),yl.intersectsBox(e))return!0}return!1}containsPoint(e,n){if(!n||!n.cameras||n.cameras.length===0)return!1;for(let r=0;r<n.cameras.length;r++){const i=n.cameras[r];if(vl.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),yl.setFromProjectionMatrix(vl,i.coordinateSystem,i.reversedDepth),yl.containsPoint(e))return!0}return!1}clone(){return new k2}}function nE(t,e){return t-e}function wpe(t,e){return t.z-e.z}function Spe(t,e){return e.z-t.z}class Epe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,n,r,i){const a=this.pool,s=this.list;this.index>=a.length&&a.push({start:-1,count:-1,z:-1,index:-1});const o=a[this.index];s.push(o),this.index++,o.start=e,o.count=n,o.z=r,o.index=i}reset(){this.list.length=0,this.index=0}}const ds=new fn,Tpe=new zt(1,1,1),tO=new z0,Cpe=new k2,yx=new Ai,Xd=new Hi,qm=new we,nO=new we,Mpe=new we,rE=new Epe,Ia=new Kr,xx=[];function Ape(t,e,n=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const i=t.count;for(let a=0;a<i;a++)for(let s=0;s<r;s++)e.setComponent(a+n,s,t.getComponent(a,s))}else e.array.set(t.array,n*r);e.needsUpdate=!0}function Kd(t,e){if(t.constructor!==e.constructor){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++)e[r]=t[r]}else{const n=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,n))}}class vK extends Kr{constructor(e,n,r=n*2,i){super(new bn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=n,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const n=new Float32Array(e*e*4),r=new tl(n,e,e,Da,Qa);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Uint32Array(e*e),r=new tl(n,e,e,gv,yo);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Float32Array(e*e*4).fill(1),r=new tl(n,e,e,Da,Qa);r.colorSpace=Yn.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const n=this.geometry,r=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const s=e.getAttribute(a),{array:o,itemSize:l,normalized:u}=s,c=new o.constructor(r*l),d=new Xn(c,l,u);n.setAttribute(a,d)}if(e.getIndex()!==null){const a=r>65535?new Uint32Array(i):new Uint16Array(i);n.setIndex(new Xn(a,1))}this._geometryInitialized=!0}}_validateGeometry(e){const n=this.geometry;if(!!e.getIndex()!=!!n.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in n.attributes){if(!e.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=e.getAttribute(r),a=n.getAttribute(r);if(i.itemSize!==a.itemSize||i.normalized!==a.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const n=this._instanceInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const n=this._geometryInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ai);const e=this.boundingBox,n=this._instanceInfo;e.makeEmpty();for(let r=0,i=n.length;r<i;r++){if(n[r].active===!1)continue;const a=n[r].geometryIndex;this.getMatrixAt(r,ds),this.getBoundingBoxAt(a,yx).applyMatrix4(ds),e.union(yx)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hi);const e=this.boundingSphere,n=this._instanceInfo;e.makeEmpty();for(let r=0,i=n.length;r<i;r++){if(n[r].active===!1)continue;const a=n[r].geometryIndex;this.getMatrixAt(r,ds),this.getBoundingSphereAt(a,Xd).applyMatrix4(ds),e.union(Xd)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(nE),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=r):(i=this._instanceInfo.length,this._instanceInfo.push(r));const a=this._matricesTexture;ds.identity().toArray(a.image.data,i*16),a.needsUpdate=!0;const s=this._colorsTexture;return s&&(Tpe.toArray(s.image.data,i*4),s.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,n=-1,r=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},a=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=n===-1?e.getAttribute("position").count:n;const s=e.getIndex();if(s!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=r===-1?s.count:r),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(nE),l=this._availableGeometryIds.shift(),a[l]=i):(l=this._geometryCount,this._geometryCount++,a.push(i)),this.setGeometryAt(l,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,l}setGeometryAt(e,n){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(n);const r=this.geometry,i=r.getIndex()!==null,a=r.getIndex(),s=n.getIndex(),o=this._geometryInfo[e];if(i&&s.count>o.reservedIndexCount||n.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,u=o.reservedVertexCount;o.vertexCount=n.getAttribute("position").count;for(const c in r.attributes){const d=n.getAttribute(c),h=r.getAttribute(c);Ape(d,h,l);const f=d.itemSize;for(let m=d.count,x=u;m<x;m++){const b=l+m;for(let y=0;y<f;y++)h.setComponent(b,y,0)}h.needsUpdate=!0,h.addUpdateRange(l*f,u*f)}if(i){const c=o.indexStart,d=o.reservedIndexCount;o.indexCount=n.getIndex().count;for(let h=0;h<s.count;h++)a.setX(c+h,l+s.getX(h));for(let h=s.count,f=d;h<f;h++)a.setX(c+h,l);a.needsUpdate=!0,a.addUpdateRange(c,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,n.boundingBox!==null&&(o.boundingBox=n.boundingBox.clone()),o.boundingSphere=null,n.boundingSphere!==null&&(o.boundingSphere=n.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const n=this._geometryInfo;if(e>=n.length||n[e].active===!1)return this;const r=this._instanceInfo;for(let i=0,a=r.length;i<a;i++)r[i].active&&r[i].geometryIndex===e&&this.deleteInstance(i);return n[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,n=0;const r=this._geometryInfo,i=r.map((s,o)=>o).sort((s,o)=>r[s].vertexStart-r[o].vertexStart),a=this.geometry;for(let s=0,o=r.length;s<o;s++){const l=i[s],u=r[l];if(u.active!==!1){if(a.index!==null){if(u.indexStart!==n){const{indexStart:c,vertexStart:d,reservedIndexCount:h}=u,f=a.index,m=f.array,x=e-d;for(let b=c;b<c+h;b++)m[b]=m[b]+x;f.array.copyWithin(n,c,c+h),f.addUpdateRange(n,h),f.needsUpdate=!0,u.indexStart=n}n+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:c,reservedVertexCount:d}=u,h=a.attributes;for(const f in h){const m=h[f],{array:x,itemSize:b}=m;x.copyWithin(e*b,c*b,(c+d)*b),m.addUpdateRange(e*b,d*b),m.needsUpdate=!0}u.vertexStart=e}e+=u.reservedVertexCount,u.start=a.index?u.indexStart:u.vertexStart,this._nextIndexStart=a.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,n){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const a=new Ai,s=r.index,o=r.attributes.position;for(let l=i.start,u=i.start+i.count;l<u;l++){let c=l;s&&(c=s.getX(c)),a.expandByPoint(qm.fromBufferAttribute(o,c))}i.boundingBox=a}return n.copy(i.boundingBox),n}getBoundingSphereAt(e,n){if(e>=this._geometryCount)return null;const r=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const a=new Hi;this.getBoundingBoxAt(e,yx),yx.getCenter(a.center);const s=r.index,o=r.attributes.position;let l=0;for(let u=i.start,c=i.start+i.count;u<c;u++){let d=u;s&&(d=s.getX(d)),qm.fromBufferAttribute(o,d),l=Math.max(l,a.center.distanceToSquared(qm))}a.radius=Math.sqrt(l),i.boundingSphere=a}return n.copy(i.boundingSphere),n}setMatrixAt(e,n){this.validateInstanceId(e);const r=this._matricesTexture,i=this._matricesTexture.image.data;return n.toArray(i,e*16),r.needsUpdate=!0,this}getMatrixAt(e,n){return this.validateInstanceId(e),n.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,n){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),n.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,n){return this.validateInstanceId(e),n.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,n){return this.validateInstanceId(e),this._instanceInfo[e].visible===n?this:(this._instanceInfo[e].visible=n,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,n){return this.validateInstanceId(e),this.validateGeometryId(n),this._instanceInfo[e].geometryIndex=n,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,n={}){this.validateGeometryId(e);const r=this._geometryInfo[e];return n.vertexStart=r.vertexStart,n.vertexCount=r.vertexCount,n.reservedVertexCount=r.reservedVertexCount,n.indexStart=r.indexStart,n.indexCount=r.indexCount,n.reservedIndexCount=r.reservedIndexCount,n.start=r.start,n.count=r.count,n}setInstanceCount(e){const n=this._availableInstanceIds,r=this._instanceInfo;for(n.sort(nE);n[n.length-1]===r.length-1;)r.pop(),n.pop();if(e<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),a=new Int32Array(e);Kd(this._multiDrawCounts,i),Kd(this._multiDrawStarts,a),this._multiDrawCounts=i,this._multiDrawStarts=a,this._maxInstanceCount=e;const s=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;s.dispose(),this._initIndirectTexture(),Kd(s.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Kd(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Kd(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,n){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${n}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(l=>l.indexStart+l.reservedIndexCount))>n)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${n}. Cannot shrink further.`);const a=this.geometry;a.dispose(),this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new bn,this._initializeGeometry(a));const s=this.geometry;a.index&&Kd(a.index.array,s.index.array);for(const o in a.attributes)Kd(a.attributes[o].array,s.attributes[o].array)}raycast(e,n){const r=this._instanceInfo,i=this._geometryInfo,a=this.matrixWorld,s=this.geometry;Ia.material=this.material,Ia.geometry.index=s.index,Ia.geometry.attributes=s.attributes,Ia.geometry.boundingBox===null&&(Ia.geometry.boundingBox=new Ai),Ia.geometry.boundingSphere===null&&(Ia.geometry.boundingSphere=new Hi);for(let o=0,l=r.length;o<l;o++){if(!r[o].visible||!r[o].active)continue;const u=r[o].geometryIndex,c=i[u];Ia.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(o,Ia.matrixWorld).premultiply(a),this.getBoundingBoxAt(u,Ia.geometry.boundingBox),this.getBoundingSphereAt(u,Ia.geometry.boundingSphere),Ia.raycast(e,xx);for(let d=0,h=xx.length;d<h;d++){const f=xx[d];f.object=this,f.batchId=o,n.push(f)}xx.length=0}Ia.material=null,Ia.geometry.index=null,Ia.geometry.attributes={},Ia.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(n=>({...n,boundingBox:n.boundingBox!==null?n.boundingBox.clone():null,boundingSphere:n.boundingSphere!==null?n.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(n=>({...n})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,n,r,i,a){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),o=s===null?1:s.array.BYTES_PER_ELEMENT,l=this._instanceInfo,u=this._multiDrawStarts,c=this._multiDrawCounts,d=this._geometryInfo,h=this.perObjectFrustumCulled,f=this._indirectTexture,m=f.image.data,x=r.isArrayCamera?Cpe:tO;h&&!r.isArrayCamera&&(ds.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),tO.setFromProjectionMatrix(ds,r.coordinateSystem,r.reversedDepth));let b=0;if(this.sortObjects){ds.copy(this.matrixWorld).invert(),qm.setFromMatrixPosition(r.matrixWorld).applyMatrix4(ds),nO.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(ds);for(let _=0,S=l.length;_<S;_++)if(l[_].visible&&l[_].active){const M=l[_].geometryIndex;this.getMatrixAt(_,ds),this.getBoundingSphereAt(M,Xd).applyMatrix4(ds);let E=!1;if(h&&(E=!x.intersectsSphere(Xd,r)),!E){const C=d[M],R=Mpe.subVectors(Xd.center,qm).dot(nO);rE.push(C.start,C.count,R,_)}}const y=rE.list,w=this.customSort;w===null?y.sort(a.transparent?Spe:wpe):w.call(this,y,r);for(let _=0,S=y.length;_<S;_++){const M=y[_];u[b]=M.start*o,c[b]=M.count,m[b]=M.index,b++}rE.reset()}else for(let y=0,w=l.length;y<w;y++)if(l[y].visible&&l[y].active){const _=l[y].geometryIndex;let S=!1;if(h&&(this.getMatrixAt(y,ds),this.getBoundingSphereAt(_,Xd).applyMatrix4(ds),S=!x.intersectsSphere(Xd,r)),!S){const M=d[_];u[b]=M.start*o,c[b]=M.count,m[b]=y,b++}}f.needsUpdate=!0,this._multiDrawCount=b,this._visibilityChanged=!1}onBeforeShadow(e,n,r,i,a,s){this.onBeforeRender(e,null,i,a,s)}}class is extends Ua{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new zt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Z_=new we,J_=new we,rO=new fn,Gm=new ff,bx=new Hi,iE=new we,iO=new we;let nd=class extends nr{constructor(e=new bn,n=new is){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[0];for(let i=1,a=n.count;i<a;i++)Z_.fromBufferAttribute(n,i-1),J_.fromBufferAttribute(n,i),r[i]=r[i-1],r[i]+=Z_.distanceTo(J_);e.setAttribute("lineDistance",new Wt(r,1))}else Ut("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,a=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),bx.copy(r.boundingSphere),bx.applyMatrix4(i),bx.radius+=a,e.ray.intersectsSphere(bx)===!1)return;rO.copy(i).invert(),Gm.copy(e.ray).applyMatrix4(rO);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,c=r.index,h=r.attributes.position;if(c!==null){const f=Math.max(0,s.start),m=Math.min(c.count,s.start+s.count);for(let x=f,b=m-1;x<b;x+=u){const y=c.getX(x),w=c.getX(x+1),_=_x(this,e,Gm,l,y,w,x);_&&n.push(_)}if(this.isLineLoop){const x=c.getX(m-1),b=c.getX(f),y=_x(this,e,Gm,l,x,b,m-1);y&&n.push(y)}}else{const f=Math.max(0,s.start),m=Math.min(h.count,s.start+s.count);for(let x=f,b=m-1;x<b;x+=u){const y=_x(this,e,Gm,l,x,x+1,x);y&&n.push(y)}if(this.isLineLoop){const x=_x(this,e,Gm,l,m-1,f,m-1);x&&n.push(x)}}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}};function _x(t,e,n,r,i,a,s){const o=t.geometry.attributes.position;if(Z_.fromBufferAttribute(o,i),J_.fromBufferAttribute(o,a),n.distanceSqToSegment(Z_,J_,iE,iO)>r)return;iE.applyMatrix4(t.matrixWorld);const u=e.ray.origin.distanceTo(iE);if(!(u<e.near||u>e.far))return{distance:u,point:iO.clone().applyMatrix4(t.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:t}}const aO=new we,sO=new we;class Yl extends nd{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[];for(let i=0,a=n.count;i<a;i+=2)aO.fromBufferAttribute(n,i),sO.fromBufferAttribute(n,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+aO.distanceTo(sO);e.setAttribute("lineDistance",new Wt(r,1))}else Ut("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class yK extends nd{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class i8 extends Ua{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new zt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const oO=new fn,j6=new ff,wx=new Hi,Sx=new we;class xK extends nr{constructor(e=new bn,n=new i8){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,a=e.params.Points.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),wx.copy(r.boundingSphere),wx.applyMatrix4(i),wx.radius+=a,e.ray.intersectsSphere(wx)===!1)return;oO.copy(i).invert(),j6.copy(e.ray).applyMatrix4(oO);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=r.index,d=r.attributes.position;if(u!==null){const h=Math.max(0,s.start),f=Math.min(u.count,s.start+s.count);for(let m=h,x=f;m<x;m++){const b=u.getX(m);Sx.fromBufferAttribute(d,b),lO(Sx,b,l,i,e,n,this)}}else{const h=Math.max(0,s.start),f=Math.min(d.count,s.start+s.count);for(let m=h,x=f;m<x;m++)Sx.fromBufferAttribute(d,m),lO(Sx,m,l,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}}function lO(t,e,n,r,i,a,s){const o=j6.distanceSqToPoint(t);if(o<n){const l=new we;j6.closestPointToPoint(t,l),l.applyMatrix4(r);const u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;a.push({distance:u,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:s})}}class bK extends hi{constructor(e,n,r,i,a=Pr,s=Pr,o,l,u){super(e,n,r,i,a,s,o,l,u),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const c=this;function d(){c.needsUpdate=!0,c._requestVideoFrameCallbackId=e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(d))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class kpe extends bK{constructor(e,n,r,i,a,s,o,l){super({},e,n,r,i,a,s,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class Ipe extends hi{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=Ti,this.minFilter=Ti,this.generateMipmaps=!1,this.needsUpdate=!0}}class I2 extends hi{constructor(e,n,r,i,a,s,o,l,u,c,d,h){super(null,s,o,l,u,c,i,a,d,h),this.isCompressedTexture=!0,this.image={width:n,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Npe extends I2{constructor(e,n,r,i,a,s){super(e,n,r,a,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=bs,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Rpe extends I2{constructor(e,n,r){super(void 0,e[0].width,e[0].height,n,r,Hl),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Ppe extends hi{constructor(e,n,r,i,a,s,o,l,u){super(e,n,r,i,a,s,o,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class p0 extends hi{constructor(e,n,r=yo,i,a,s,o=Ti,l=Ti,u,c=Vl,d=1){if(c!==Vl&&c!==Vc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const h={width:e,height:n,depth:d};super(h,i,a,s,o,l,c,r,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new qc(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class _K extends p0{constructor(e,n=yo,r=Hl,i,a,s=Ti,o=Ti,l,u=Vl){const c={width:e,height:e,depth:1},d=[c,c,c,c,c,c];super(e,e,n,r,i,a,s,o,l,u),this.image=d,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class a8 extends hi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class N2 extends bn{constructor(e=1,n=1,r=4,i=8,a=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:n,capSegments:r,radialSegments:i,heightSegments:a},n=Math.max(0,n),r=Math.max(1,Math.floor(r)),i=Math.max(3,Math.floor(i)),a=Math.max(1,Math.floor(a));const s=[],o=[],l=[],u=[],c=n/2,d=Math.PI/2*e,h=n,f=2*d+h,m=r*2+a,x=i+1,b=new we,y=new we;for(let w=0;w<=m;w++){let _=0,S=0,M=0,E=0;if(w<=r){const k=w/r,I=k*Math.PI/2;S=-c-e*Math.cos(I),M=e*Math.sin(I),E=-e*Math.cos(I),_=k*d}else if(w<=r+a){const k=(w-r)/a;S=-c+k*n,M=e,E=0,_=d+k*h}else{const k=(w-r-a)/r,I=k*Math.PI/2;S=c+e*Math.sin(I),M=e*Math.cos(I),E=e*Math.sin(I),_=d+h+k*d}const C=Math.max(0,Math.min(1,_/f));let R=0;w===0?R=.5/i:w===m&&(R=-.5/i);for(let k=0;k<=i;k++){const I=k/i,N=I*Math.PI*2,D=Math.sin(N),F=Math.cos(N);y.x=-M*F,y.y=S,y.z=M*D,o.push(y.x,y.y,y.z),b.set(-M*F,E,M*D),b.normalize(),l.push(b.x,b.y,b.z),u.push(I+R,C)}if(w>0){const k=(w-1)*x;for(let I=0;I<i;I++){const N=k+I,D=k+I+1,F=w*x+I,L=w*x+I+1;s.push(N,D,F),s.push(D,L,F)}}}this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new N2(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class R2 extends bn{constructor(e=1,n=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:r,thetaLength:i},n=Math.max(3,n);const a=[],s=[],o=[],l=[],u=new we,c=new dt;s.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let d=0,h=3;d<=n;d++,h+=3){const f=r+d/n*i;u.x=e*Math.cos(f),u.y=e*Math.sin(f),s.push(u.x,u.y,u.z),o.push(0,0,1),c.x=(s[h]/e+1)/2,c.y=(s[h+1]/e+1)/2,l.push(c.x,c.y)}for(let d=1;d<=n;d++)a.push(d,d+1,0);this.setIndex(a),this.setAttribute("position",new Wt(s,3)),this.setAttribute("normal",new Wt(o,3)),this.setAttribute("uv",new Wt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new R2(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class yv extends bn{constructor(e=1,n=1,r=1,i=32,a=1,s=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:a,openEnded:s,thetaStart:o,thetaLength:l};const u=this;i=Math.floor(i),a=Math.floor(a);const c=[],d=[],h=[],f=[];let m=0;const x=[],b=r/2;let y=0;w(),s===!1&&(e>0&&_(!0),n>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new Wt(d,3)),this.setAttribute("normal",new Wt(h,3)),this.setAttribute("uv",new Wt(f,2));function w(){const S=new we,M=new we;let E=0;const C=(n-e)/r;for(let R=0;R<=a;R++){const k=[],I=R/a,N=I*(n-e)+e;for(let D=0;D<=i;D++){const F=D/i,L=F*l+o,U=Math.sin(L),j=Math.cos(L);M.x=N*U,M.y=-I*r+b,M.z=N*j,d.push(M.x,M.y,M.z),S.set(U,C,j).normalize(),h.push(S.x,S.y,S.z),f.push(F,1-I),k.push(m++)}x.push(k)}for(let R=0;R<i;R++)for(let k=0;k<a;k++){const I=x[k][R],N=x[k+1][R],D=x[k+1][R+1],F=x[k][R+1];(e>0||k!==0)&&(c.push(I,N,F),E+=3),(n>0||k!==a-1)&&(c.push(N,D,F),E+=3)}u.addGroup(y,E,0),y+=E}function _(S){const M=m,E=new dt,C=new we;let R=0;const k=S===!0?e:n,I=S===!0?1:-1;for(let D=1;D<=i;D++)d.push(0,b*I,0),h.push(0,I,0),f.push(.5,.5),m++;const N=m;for(let D=0;D<=i;D++){const L=D/i*l+o,U=Math.cos(L),j=Math.sin(L);C.x=k*j,C.y=b*I,C.z=k*U,d.push(C.x,C.y,C.z),h.push(0,I,0),E.x=U*.5+.5,E.y=j*.5*I+.5,f.push(E.x,E.y),m++}for(let D=0;D<i;D++){const F=M+D,L=N+D;S===!0?c.push(L,L+1,F):c.push(L+1,L,F),R+=3}u.addGroup(y,R,S===!0?1:2),y+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yv(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class xv extends yv{constructor(e=1,n=1,r=32,i=1,a=!1,s=0,o=Math.PI*2){super(0,e,n,r,i,a,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o}}static fromJSON(e){return new xv(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class md extends bn{constructor(e=[],n=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:r,detail:i};const a=[],s=[];o(i),u(r),c(),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(a.slice(),3)),this.setAttribute("uv",new Wt(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(w){const _=new we,S=new we,M=new we;for(let E=0;E<n.length;E+=3)f(n[E+0],_),f(n[E+1],S),f(n[E+2],M),l(_,S,M,w)}function l(w,_,S,M){const E=M+1,C=[];for(let R=0;R<=E;R++){C[R]=[];const k=w.clone().lerp(S,R/E),I=_.clone().lerp(S,R/E),N=E-R;for(let D=0;D<=N;D++)D===0&&R===E?C[R][D]=k:C[R][D]=k.clone().lerp(I,D/N)}for(let R=0;R<E;R++)for(let k=0;k<2*(E-R)-1;k++){const I=Math.floor(k/2);k%2===0?(h(C[R][I+1]),h(C[R+1][I]),h(C[R][I])):(h(C[R][I+1]),h(C[R+1][I+1]),h(C[R+1][I]))}}function u(w){const _=new we;for(let S=0;S<a.length;S+=3)_.x=a[S+0],_.y=a[S+1],_.z=a[S+2],_.normalize().multiplyScalar(w),a[S+0]=_.x,a[S+1]=_.y,a[S+2]=_.z}function c(){const w=new we;for(let _=0;_<a.length;_+=3){w.x=a[_+0],w.y=a[_+1],w.z=a[_+2];const S=b(w)/2/Math.PI+.5,M=y(w)/Math.PI+.5;s.push(S,1-M)}m(),d()}function d(){for(let w=0;w<s.length;w+=6){const _=s[w+0],S=s[w+2],M=s[w+4],E=Math.max(_,S,M),C=Math.min(_,S,M);E>.9&&C<.1&&(_<.2&&(s[w+0]+=1),S<.2&&(s[w+2]+=1),M<.2&&(s[w+4]+=1))}}function h(w){a.push(w.x,w.y,w.z)}function f(w,_){const S=w*3;_.x=e[S+0],_.y=e[S+1],_.z=e[S+2]}function m(){const w=new we,_=new we,S=new we,M=new we,E=new dt,C=new dt,R=new dt;for(let k=0,I=0;k<a.length;k+=9,I+=6){w.set(a[k+0],a[k+1],a[k+2]),_.set(a[k+3],a[k+4],a[k+5]),S.set(a[k+6],a[k+7],a[k+8]),E.set(s[I+0],s[I+1]),C.set(s[I+2],s[I+3]),R.set(s[I+4],s[I+5]),M.copy(w).add(_).add(S).divideScalar(3);const N=b(M);x(E,I+0,w,N),x(C,I+2,_,N),x(R,I+4,S,N)}}function x(w,_,S,M){M<0&&w.x===1&&(s[_]=w.x-1),S.x===0&&S.z===0&&(s[_]=M/2/Math.PI+.5)}function b(w){return Math.atan2(w.z,-w.x)}function y(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new md(e.vertices,e.indices,e.radius,e.detail)}}class P2 extends md{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,i=1/r,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(a,s,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new P2(e.radius,e.detail)}}const Ex=new we,Tx=new we,aE=new we,Cx=new xs;class wK extends bn{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const i=Math.pow(10,4),a=Math.cos(Fh*n),s=e.getIndex(),o=e.getAttribute("position"),l=s?s.count:o.count,u=[0,0,0],c=["a","b","c"],d=new Array(3),h={},f=[];for(let m=0;m<l;m+=3){s?(u[0]=s.getX(m),u[1]=s.getX(m+1),u[2]=s.getX(m+2)):(u[0]=m,u[1]=m+1,u[2]=m+2);const{a:x,b,c:y}=Cx;if(x.fromBufferAttribute(o,u[0]),b.fromBufferAttribute(o,u[1]),y.fromBufferAttribute(o,u[2]),Cx.getNormal(aE),d[0]=`${Math.round(x.x*i)},${Math.round(x.y*i)},${Math.round(x.z*i)}`,d[1]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,d[2]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let w=0;w<3;w++){const _=(w+1)%3,S=d[w],M=d[_],E=Cx[c[w]],C=Cx[c[_]],R=`${S}_${M}`,k=`${M}_${S}`;k in h&&h[k]?(aE.dot(h[k].normal)<=a&&(f.push(E.x,E.y,E.z),f.push(C.x,C.y,C.z)),h[k]=null):R in h||(h[R]={index0:u[w],index1:u[_],normal:aE.clone()})}}for(const m in h)if(h[m]){const{index0:x,index1:b}=h[m];Ex.fromBufferAttribute(o,x),Tx.fromBufferAttribute(o,b),f.push(Ex.x,Ex.y,Ex.z),f.push(Tx.x,Tx.y,Tx.z)}this.setAttribute("position",new Wt(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class ol{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Ut("Curve: .getPoint() not implemented.")}getPointAt(e,n){const r=this.getUtoTmapping(e);return this.getPoint(r,n)}getPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return n}getSpacedPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPointAt(r/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let r,i=this.getPoint(0),a=0;n.push(0);for(let s=1;s<=e;s++)r=this.getPoint(s/e),a+=r.distanceTo(i),n.push(a),i=r;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n=null){const r=this.getLengths();let i=0;const a=r.length;let s;n?s=n:s=e*r[a-1];let o=0,l=a-1,u;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),u=r[i]-s,u<0)o=i+1;else if(u>0)l=i-1;else{l=i;break}if(i=l,r[i]===s)return i/(a-1);const c=r[i],h=r[i+1]-c,f=(s-c)/h;return(i+f)/(a-1)}getTangent(e,n){let i=e-1e-4,a=e+1e-4;i<0&&(i=0),a>1&&(a=1);const s=this.getPoint(i),o=this.getPoint(a),l=n||(s.isVector2?new dt:new we);return l.copy(o).sub(s).normalize(),l}getTangentAt(e,n){const r=this.getUtoTmapping(e);return this.getTangent(r,n)}computeFrenetFrames(e,n=!1){const r=new we,i=[],a=[],s=[],o=new we,l=new fn;for(let f=0;f<=e;f++){const m=f/e;i[f]=this.getTangentAt(m,new we)}a[0]=new we,s[0]=new we;let u=Number.MAX_VALUE;const c=Math.abs(i[0].x),d=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=u&&(u=c,r.set(1,0,0)),d<=u&&(u=d,r.set(0,1,0)),h<=u&&r.set(0,0,1),o.crossVectors(i[0],r).normalize(),a[0].crossVectors(i[0],o),s[0].crossVectors(i[0],a[0]);for(let f=1;f<=e;f++){if(a[f]=a[f-1].clone(),s[f]=s[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();const m=Math.acos(gn(i[f-1].dot(i[f]),-1,1));a[f].applyMatrix4(l.makeRotationAxis(o,m))}s[f].crossVectors(i[f],a[f])}if(n===!0){let f=Math.acos(gn(a[0].dot(a[e]),-1,1));f/=e,i[0].dot(o.crossVectors(a[0],a[e]))>0&&(f=-f);for(let m=1;m<=e;m++)a[m].applyMatrix4(l.makeRotationAxis(i[m],f*m)),s[m].crossVectors(i[m],a[m])}return{tangents:i,normals:a,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class D2 extends ol{constructor(e=0,n=0,r=1,i=1,a=0,s=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=r,this.yRadius=i,this.aStartAngle=a,this.aEndAngle=s,this.aClockwise=o,this.aRotation=l}getPoint(e,n=new dt){const r=n,i=Math.PI*2;let a=this.aEndAngle-this.aStartAngle;const s=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=i;for(;a>i;)a-=i;a<Number.EPSILON&&(s?a=0:a=i),this.aClockwise===!0&&!s&&(a===i?a=-i:a=a-i);const o=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),h=l-this.aX,f=u-this.aY;l=h*c-f*d+this.aX,u=h*d+f*c+this.aY}return r.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class SK extends D2{constructor(e,n,r,i,a,s){super(e,n,r,r,i,a,s),this.isArcCurve=!0,this.type="ArcCurve"}}function s8(){let t=0,e=0,n=0,r=0;function i(a,s,o,l){t=a,e=o,n=-3*a+3*s-2*o-l,r=2*a-2*s+o+l}return{initCatmullRom:function(a,s,o,l,u){i(s,o,u*(o-a),u*(l-s))},initNonuniformCatmullRom:function(a,s,o,l,u,c,d){let h=(s-a)/u-(o-a)/(u+c)+(o-s)/c,f=(o-s)/c-(l-s)/(c+d)+(l-o)/d;h*=c,f*=c,i(s,o,h,f)},calc:function(a){const s=a*a,o=s*a;return t+e*a+n*s+r*o}}}const Mx=new we,sE=new s8,oE=new s8,lE=new s8;class EK extends ol{constructor(e=[],n=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=r,this.tension=i}getPoint(e,n=new we){const r=n,i=this.points,a=i.length,s=(a-(this.closed?0:1))*e;let o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:l===0&&o===a-1&&(o=a-2,l=1);let u,c;this.closed||o>0?u=i[(o-1)%a]:(Mx.subVectors(i[0],i[1]).add(i[0]),u=Mx);const d=i[o%a],h=i[(o+1)%a];if(this.closed||o+2<a?c=i[(o+2)%a]:(Mx.subVectors(i[a-1],i[a-2]).add(i[a-1]),c=Mx),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(u.distanceToSquared(d),f),x=Math.pow(d.distanceToSquared(h),f),b=Math.pow(h.distanceToSquared(c),f);x<1e-4&&(x=1),m<1e-4&&(m=x),b<1e-4&&(b=x),sE.initNonuniformCatmullRom(u.x,d.x,h.x,c.x,m,x,b),oE.initNonuniformCatmullRom(u.y,d.y,h.y,c.y,m,x,b),lE.initNonuniformCatmullRom(u.z,d.z,h.z,c.z,m,x,b)}else this.curveType==="catmullrom"&&(sE.initCatmullRom(u.x,d.x,h.x,c.x,this.tension),oE.initCatmullRom(u.y,d.y,h.y,c.y,this.tension),lE.initCatmullRom(u.z,d.z,h.z,c.z,this.tension));return r.set(sE.calc(l),oE.calc(l),lE.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const i=this.points[n];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(new we().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function uO(t,e,n,r,i){const a=(r-e)*.5,s=(i-n)*.5,o=t*t,l=t*o;return(2*n-2*r+a+s)*l+(-3*n+3*r-2*a-s)*o+a*t+n}function Dpe(t,e){const n=1-t;return n*n*e}function Ope(t,e){return 2*(1-t)*t*e}function Lpe(t,e){return t*t*e}function Fg(t,e,n,r){return Dpe(t,e)+Ope(t,n)+Lpe(t,r)}function Fpe(t,e){const n=1-t;return n*n*n*e}function Bpe(t,e){const n=1-t;return 3*n*n*t*e}function Upe(t,e){return 3*(1-t)*t*t*e}function zpe(t,e){return t*t*t*e}function Bg(t,e,n,r,i){return Fpe(t,e)+Bpe(t,n)+Upe(t,r)+zpe(t,i)}class o8 extends ol{constructor(e=new dt,n=new dt,r=new dt,i=new dt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=r,this.v3=i}getPoint(e,n=new dt){const r=n,i=this.v0,a=this.v1,s=this.v2,o=this.v3;return r.set(Bg(e,i.x,a.x,s.x,o.x),Bg(e,i.y,a.y,s.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class TK extends ol{constructor(e=new we,n=new we,r=new we,i=new we){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=r,this.v3=i}getPoint(e,n=new we){const r=n,i=this.v0,a=this.v1,s=this.v2,o=this.v3;return r.set(Bg(e,i.x,a.x,s.x,o.x),Bg(e,i.y,a.y,s.y,o.y),Bg(e,i.z,a.z,s.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class l8 extends ol{constructor(e=new dt,n=new dt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new dt){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new dt){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class CK extends ol{constructor(e=new we,n=new we){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new we){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new we){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class u8 extends ol{constructor(e=new dt,n=new dt,r=new dt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new dt){const r=n,i=this.v0,a=this.v1,s=this.v2;return r.set(Fg(e,i.x,a.x,s.x),Fg(e,i.y,a.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class O2 extends ol{constructor(e=new we,n=new we,r=new we){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new we){const r=n,i=this.v0,a=this.v1,s=this.v2;return r.set(Fg(e,i.x,a.x,s.x),Fg(e,i.y,a.y,s.y),Fg(e,i.z,a.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class c8 extends ol{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new dt){const r=n,i=this.points,a=(i.length-1)*e,s=Math.floor(a),o=a-s,l=i[s===0?s:s-1],u=i[s],c=i[s>i.length-2?i.length-1:s+1],d=i[s>i.length-3?i.length-1:s+2];return r.set(uO(o,l.x,u.x,c.x,d.x),uO(o,l.y,u.y,c.y,d.y)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const i=this.points[n];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const i=e.points[n];this.points.push(new dt().fromArray(i))}return this}}var Q_=Object.freeze({__proto__:null,ArcCurve:SK,CatmullRomCurve3:EK,CubicBezierCurve:o8,CubicBezierCurve3:TK,EllipseCurve:D2,LineCurve:l8,LineCurve3:CK,QuadraticBezierCurve:u8,QuadraticBezierCurve3:O2,SplineCurve:c8});class MK extends ol{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(n)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Q_[r](n,e))}return this}getPoint(e,n){const r=e*this.getLength(),i=this.getCurveLengths();let a=0;for(;a<i.length;){if(i[a]>=r){const s=i[a]-r,o=this.curves[a],l=o.getLength(),u=l===0?0:1-s/l;return o.getPointAt(u,n)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let r=0,i=this.curves.length;r<i;r++)n+=this.curves[r].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let r;for(let i=0,a=this.curves;i<a.length;i++){const s=a[i],o=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,l=s.getPoints(o);for(let u=0;u<l.length;u++){const c=l[u];r&&r.equals(c)||(n.push(c),r=c)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const i=e.curves[n];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,r=this.curves.length;n<r;n++){const i=this.curves[n];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const i=e.curves[n];this.curves.push(new Q_[i.type]().fromJSON(i))}return this}}class ew extends MK{constructor(e){super(),this.type="Path",this.currentPoint=new dt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,r=e.length;n<r;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const r=new l8(this.currentPoint.clone(),new dt(e,n));return this.curves.push(r),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,r,i){const a=new u8(this.currentPoint.clone(),new dt(e,n),new dt(r,i));return this.curves.push(a),this.currentPoint.set(r,i),this}bezierCurveTo(e,n,r,i,a,s){const o=new o8(this.currentPoint.clone(),new dt(e,n),new dt(r,i),new dt(a,s));return this.curves.push(o),this.currentPoint.set(a,s),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),r=new c8(n);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,r,i,a,s){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,n+l,r,i,a,s),this}absarc(e,n,r,i,a,s){return this.absellipse(e,n,r,r,i,a,s),this}ellipse(e,n,r,i,a,s,o,l){const u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+u,n+c,r,i,a,s,o,l),this}absellipse(e,n,r,i,a,s,o,l){const u=new D2(e,n,r,i,a,s,o,l);if(this.curves.length>0){const d=u.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(u);const c=u.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Bh extends ew{constructor(e){super(e),this.uuid=Ws(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let r=0,i=this.holes.length;r<i;r++)n[r]=this.holes[r].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const i=e.holes[n];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,r=this.holes.length;n<r;n++){const i=this.holes[n];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const i=e.holes[n];this.holes.push(new ew().fromJSON(i))}return this}}function jpe(t,e,n=2){const r=e&&e.length,i=r?e[0]*n:t.length;let a=AK(t,0,i,n,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,u;if(r&&(a=Gpe(t,e,a,n)),t.length>80*n){o=t[0],l=t[1];let c=o,d=l;for(let h=n;h<i;h+=n){const f=t[h],m=t[h+1];f<o&&(o=f),m<l&&(l=m),f>c&&(c=f),m>d&&(d=m)}u=Math.max(c-o,d-l),u=u!==0?32767/u:0}return x1(a,s,n,o,l,u,0),s}function AK(t,e,n,r,i){let a;if(i===r0e(t,e,n,r)>0)for(let s=e;s<n;s+=r)a=cO(s/r|0,t[s],t[s+1],a);else for(let s=n-r;s>=e;s-=r)a=cO(s/r|0,t[s],t[s+1],a);return a&&m0(a,a.next)&&(_1(a),a=a.next),a}function Jh(t,e){if(!t)return t;e||(e=t);let n=t,r;do if(r=!1,!n.steiner&&(m0(n,n.next)||di(n.prev,n,n.next)===0)){if(_1(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function x1(t,e,n,r,i,a,s){if(!t)return;!s&&a&&Zpe(t,r,i,a);let o=t;for(;t.prev!==t.next;){const l=t.prev,u=t.next;if(a?$pe(t,r,i,a):Hpe(t)){e.push(l.i,t.i,u.i),_1(t),t=u.next,o=u.next;continue}if(t=u,t===o){s?s===1?(t=Vpe(Jh(t),e),x1(t,e,n,r,i,a,2)):s===2&&qpe(t,e,n,r,i,a):x1(Jh(t),e,n,r,i,a,1);break}}}function Hpe(t){const e=t.prev,n=t,r=t.next;if(di(e,n,r)>=0)return!1;const i=e.x,a=n.x,s=r.x,o=e.y,l=n.y,u=r.y,c=Math.min(i,a,s),d=Math.min(o,l,u),h=Math.max(i,a,s),f=Math.max(o,l,u);let m=r.next;for(;m!==e;){if(m.x>=c&&m.x<=h&&m.y>=d&&m.y<=f&&mg(i,o,a,l,s,u,m.x,m.y)&&di(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function $pe(t,e,n,r){const i=t.prev,a=t,s=t.next;if(di(i,a,s)>=0)return!1;const o=i.x,l=a.x,u=s.x,c=i.y,d=a.y,h=s.y,f=Math.min(o,l,u),m=Math.min(c,d,h),x=Math.max(o,l,u),b=Math.max(c,d,h),y=H6(f,m,e,n,r),w=H6(x,b,e,n,r);let _=t.prevZ,S=t.nextZ;for(;_&&_.z>=y&&S&&S.z<=w;){if(_.x>=f&&_.x<=x&&_.y>=m&&_.y<=b&&_!==i&&_!==s&&mg(o,c,l,d,u,h,_.x,_.y)&&di(_.prev,_,_.next)>=0||(_=_.prevZ,S.x>=f&&S.x<=x&&S.y>=m&&S.y<=b&&S!==i&&S!==s&&mg(o,c,l,d,u,h,S.x,S.y)&&di(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=x&&_.y>=m&&_.y<=b&&_!==i&&_!==s&&mg(o,c,l,d,u,h,_.x,_.y)&&di(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;S&&S.z<=w;){if(S.x>=f&&S.x<=x&&S.y>=m&&S.y<=b&&S!==i&&S!==s&&mg(o,c,l,d,u,h,S.x,S.y)&&di(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function Vpe(t,e){let n=t;do{const r=n.prev,i=n.next.next;!m0(r,i)&&IK(r,n,n.next,i)&&b1(r,i)&&b1(i,r)&&(e.push(r.i,n.i,i.i),_1(n),_1(n.next),n=t=i),n=n.next}while(n!==t);return Jh(n)}function qpe(t,e,n,r,i,a){let s=t;do{let o=s.next.next;for(;o!==s.prev;){if(s.i!==o.i&&e0e(s,o)){let l=NK(s,o);s=Jh(s,s.next),l=Jh(l,l.next),x1(s,e,n,r,i,a,0),x1(l,e,n,r,i,a,0);return}o=o.next}s=s.next}while(s!==t)}function Gpe(t,e,n,r){const i=[];for(let a=0,s=e.length;a<s;a++){const o=e[a]*r,l=a<s-1?e[a+1]*r:t.length,u=AK(t,o,l,r,!1);u===u.next&&(u.steiner=!0),i.push(Qpe(u))}i.sort(Wpe);for(let a=0;a<i.length;a++)n=Ype(i[a],n);return n}function Wpe(t,e){let n=t.x-e.x;if(n===0&&(n=t.y-e.y,n===0)){const r=(t.next.y-t.y)/(t.next.x-t.x),i=(e.next.y-e.y)/(e.next.x-e.x);n=r-i}return n}function Ype(t,e){const n=Xpe(t,e);if(!n)return e;const r=NK(n,t);return Jh(r,r.next),Jh(n,n.next)}function Xpe(t,e){let n=e;const r=t.x,i=t.y;let a=-1/0,s;if(m0(t,n))return n;do{if(m0(t,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const d=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(d<=r&&d>a&&(a=d,s=n.x<n.next.x?n:n.next,d===r))return s}n=n.next}while(n!==e);if(!s)return null;const o=s,l=s.x,u=s.y;let c=1/0;n=s;do{if(r>=n.x&&n.x>=l&&r!==n.x&&kK(i<u?r:a,i,l,u,i<u?a:r,i,n.x,n.y)){const d=Math.abs(i-n.y)/(r-n.x);b1(n,t)&&(d<c||d===c&&(n.x>s.x||n.x===s.x&&Kpe(s,n)))&&(s=n,c=d)}n=n.next}while(n!==o);return s}function Kpe(t,e){return di(t.prev,t,e.prev)<0&&di(e.next,t,t.next)<0}function Zpe(t,e,n,r){let i=t;do i.z===0&&(i.z=H6(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,Jpe(i)}function Jpe(t){let e,n=1;do{let r=t,i;t=null;let a=null;for(e=0;r;){e++;let s=r,o=0;for(let u=0;u<n&&(o++,s=s.nextZ,!!s);u++);let l=n;for(;o>0||l>0&&s;)o!==0&&(l===0||!s||r.z<=s.z)?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=s}a.nextZ=null,n*=2}while(e>1);return t}function H6(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Qpe(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function kK(t,e,n,r,i,a,s,o){return(i-s)*(e-o)>=(t-s)*(a-o)&&(t-s)*(r-o)>=(n-s)*(e-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function mg(t,e,n,r,i,a,s,o){return!(t===s&&e===o)&&kK(t,e,n,r,i,a,s,o)}function e0e(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!t0e(t,e)&&(b1(t,e)&&b1(e,t)&&n0e(t,e)&&(di(t.prev,t,e.prev)||di(t,e.prev,e))||m0(t,e)&&di(t.prev,t,t.next)>0&&di(e.prev,e,e.next)>0)}function di(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function m0(t,e){return t.x===e.x&&t.y===e.y}function IK(t,e,n,r){const i=kx(di(t,e,n)),a=kx(di(t,e,r)),s=kx(di(n,r,t)),o=kx(di(n,r,e));return!!(i!==a&&s!==o||i===0&&Ax(t,n,e)||a===0&&Ax(t,r,e)||s===0&&Ax(n,t,r)||o===0&&Ax(n,e,r))}function Ax(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function kx(t){return t>0?1:t<0?-1:0}function t0e(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&IK(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function b1(t,e){return di(t.prev,t,t.next)<0?di(t,e,t.next)>=0&&di(t,t.prev,e)>=0:di(t,e,t.prev)<0||di(t,t.next,e)<0}function n0e(t,e){let n=t,r=!1;const i=(t.x+e.x)/2,a=(t.y+e.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function NK(t,e){const n=$6(t.i,t.x,t.y),r=$6(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function cO(t,e,n,r){const i=$6(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function _1(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $6(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function r0e(t,e,n,r){let i=0;for(let a=e,s=n-r;a<n;a+=r)i+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return i}class i0e{static triangulate(e,n,r=2){return jpe(e,n,r)}}class Ko{static area(e){const n=e.length;let r=0;for(let i=n-1,a=0;a<n;i=a++)r+=e[i].x*e[a].y-e[a].x*e[i].y;return r*.5}static isClockWise(e){return Ko.area(e)<0}static triangulateShape(e,n){const r=[],i=[],a=[];dO(e),hO(r,e);let s=e.length;n.forEach(dO);for(let l=0;l<n.length;l++)i.push(s),s+=n[l].length,hO(r,n[l]);const o=i0e.triangulate(r,i);for(let l=0;l<o.length;l+=3)a.push(o.slice(l,l+3));return a}}function dO(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hO(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class L2 extends bn{constructor(e=new Bh([new dt(.5,.5),new dt(-.5,.5),new dt(-.5,-.5),new dt(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const r=this,i=[],a=[];for(let o=0,l=e.length;o<l;o++){const u=e[o];s(u)}this.setAttribute("position",new Wt(i,3)),this.setAttribute("uv",new Wt(a,2)),this.computeVertexNormals();function s(o){const l=[],u=n.curveSegments!==void 0?n.curveSegments:12,c=n.steps!==void 0?n.steps:1,d=n.depth!==void 0?n.depth:1;let h=n.bevelEnabled!==void 0?n.bevelEnabled:!0,f=n.bevelThickness!==void 0?n.bevelThickness:.2,m=n.bevelSize!==void 0?n.bevelSize:f-.1,x=n.bevelOffset!==void 0?n.bevelOffset:0,b=n.bevelSegments!==void 0?n.bevelSegments:3;const y=n.extrudePath,w=n.UVGenerator!==void 0?n.UVGenerator:a0e;let _,S=!1,M,E,C,R;if(y){_=y.getSpacedPoints(c),S=!0,h=!1;const ke=y.isCatmullRomCurve3?y.closed:!1;M=y.computeFrenetFrames(c,ke),E=new we,C=new we,R=new we}h||(b=0,f=0,m=0,x=0);const k=o.extractPoints(u);let I=k.shape;const N=k.holes;if(!Ko.isClockWise(I)){I=I.reverse();for(let ke=0,Me=N.length;ke<Me;ke++){const Ie=N[ke];Ko.isClockWise(Ie)&&(N[ke]=Ie.reverse())}}function F(ke){const Ie=10000000000000001e-36;let ce=ke[0];for(let G=1;G<=ke.length;G++){const xe=G%ke.length,Oe=ke[xe],Fe=Oe.x-ce.x,ze=Oe.y-ce.y,le=Fe*Fe+ze*ze,re=Math.max(Math.abs(Oe.x),Math.abs(Oe.y),Math.abs(ce.x),Math.abs(ce.y)),me=Ie*re*re;if(le<=me){ke.splice(xe,1),G--;continue}ce=Oe}}F(I),N.forEach(F);const L=N.length,U=I;for(let ke=0;ke<L;ke++){const Me=N[ke];I=I.concat(Me)}function j(ke,Me,Ie){return Me||tn("ExtrudeGeometry: vec does not exist"),ke.clone().addScaledVector(Me,Ie)}const q=I.length;function Z(ke,Me,Ie){let ce,G,xe;const Oe=ke.x-Me.x,Fe=ke.y-Me.y,ze=Ie.x-ke.x,le=Ie.y-ke.y,re=Oe*Oe+Fe*Fe,me=Oe*le-Fe*ze;if(Math.abs(me)>Number.EPSILON){const de=Math.sqrt(re),ve=Math.sqrt(ze*ze+le*le),_e=Me.x-Fe/de,Be=Me.y+Oe/de,He=Ie.x-le/ve,pt=Ie.y+ze/ve,gt=((He-_e)*le-(pt-Be)*ze)/(Oe*le-Fe*ze);ce=_e+Oe*gt-ke.x,G=Be+Fe*gt-ke.y;const We=ce*ce+G*G;if(We<=2)return new dt(ce,G);xe=Math.sqrt(We/2)}else{let de=!1;Oe>Number.EPSILON?ze>Number.EPSILON&&(de=!0):Oe<-Number.EPSILON?ze<-Number.EPSILON&&(de=!0):Math.sign(Fe)===Math.sign(le)&&(de=!0),de?(ce=-Fe,G=Oe,xe=Math.sqrt(re)):(ce=Oe,G=Fe,xe=Math.sqrt(re/2))}return new dt(ce/xe,G/xe)}const Q=[];for(let ke=0,Me=U.length,Ie=Me-1,ce=ke+1;ke<Me;ke++,Ie++,ce++)Ie===Me&&(Ie=0),ce===Me&&(ce=0),Q[ke]=Z(U[ke],U[Ie],U[ce]);const z=[];let W,X=Q.concat();for(let ke=0,Me=L;ke<Me;ke++){const Ie=N[ke];W=[];for(let ce=0,G=Ie.length,xe=G-1,Oe=ce+1;ce<G;ce++,xe++,Oe++)xe===G&&(xe=0),Oe===G&&(Oe=0),W[ce]=Z(Ie[ce],Ie[xe],Ie[Oe]);z.push(W),X=X.concat(W)}let H;if(b===0)H=Ko.triangulateShape(U,N);else{const ke=[],Me=[];for(let Ie=0;Ie<b;Ie++){const ce=Ie/b,G=f*Math.cos(ce*Math.PI/2),xe=m*Math.sin(ce*Math.PI/2)+x;for(let Oe=0,Fe=U.length;Oe<Fe;Oe++){const ze=j(U[Oe],Q[Oe],xe);oe(ze.x,ze.y,-G),ce===0&&ke.push(ze)}for(let Oe=0,Fe=L;Oe<Fe;Oe++){const ze=N[Oe];W=z[Oe];const le=[];for(let re=0,me=ze.length;re<me;re++){const de=j(ze[re],W[re],xe);oe(de.x,de.y,-G),ce===0&&le.push(de)}ce===0&&Me.push(le)}}H=Ko.triangulateShape(ke,Me)}const J=H.length,te=m+x;for(let ke=0;ke<q;ke++){const Me=h?j(I[ke],X[ke],te):I[ke];S?(C.copy(M.normals[0]).multiplyScalar(Me.x),E.copy(M.binormals[0]).multiplyScalar(Me.y),R.copy(_[0]).add(C).add(E),oe(R.x,R.y,R.z)):oe(Me.x,Me.y,0)}for(let ke=1;ke<=c;ke++)for(let Me=0;Me<q;Me++){const Ie=h?j(I[Me],X[Me],te):I[Me];S?(C.copy(M.normals[ke]).multiplyScalar(Ie.x),E.copy(M.binormals[ke]).multiplyScalar(Ie.y),R.copy(_[ke]).add(C).add(E),oe(R.x,R.y,R.z)):oe(Ie.x,Ie.y,d/c*ke)}for(let ke=b-1;ke>=0;ke--){const Me=ke/b,Ie=f*Math.cos(Me*Math.PI/2),ce=m*Math.sin(Me*Math.PI/2)+x;for(let G=0,xe=U.length;G<xe;G++){const Oe=j(U[G],Q[G],ce);oe(Oe.x,Oe.y,d+Ie)}for(let G=0,xe=N.length;G<xe;G++){const Oe=N[G];W=z[G];for(let Fe=0,ze=Oe.length;Fe<ze;Fe++){const le=j(Oe[Fe],W[Fe],ce);S?oe(le.x,le.y+_[c-1].y,_[c-1].x+Ie):oe(le.x,le.y,d+Ie)}}}ee(),se();function ee(){const ke=i.length/3;if(h){let Me=0,Ie=q*Me;for(let ce=0;ce<J;ce++){const G=H[ce];Te(G[2]+Ie,G[1]+Ie,G[0]+Ie)}Me=c+b*2,Ie=q*Me;for(let ce=0;ce<J;ce++){const G=H[ce];Te(G[0]+Ie,G[1]+Ie,G[2]+Ie)}}else{for(let Me=0;Me<J;Me++){const Ie=H[Me];Te(Ie[2],Ie[1],Ie[0])}for(let Me=0;Me<J;Me++){const Ie=H[Me];Te(Ie[0]+q*c,Ie[1]+q*c,Ie[2]+q*c)}}r.addGroup(ke,i.length/3-ke,0)}function se(){const ke=i.length/3;let Me=0;ue(U,Me),Me+=U.length;for(let Ie=0,ce=N.length;Ie<ce;Ie++){const G=N[Ie];ue(G,Me),Me+=G.length}r.addGroup(ke,i.length/3-ke,1)}function ue(ke,Me){let Ie=ke.length;for(;--Ie>=0;){const ce=Ie;let G=Ie-1;G<0&&(G=ke.length-1);for(let xe=0,Oe=c+b*2;xe<Oe;xe++){const Fe=q*xe,ze=q*(xe+1),le=Me+ce+Fe,re=Me+G+Fe,me=Me+G+ze,de=Me+ce+ze;Ne(le,re,me,de)}}}function oe(ke,Me,Ie){l.push(ke),l.push(Me),l.push(Ie)}function Te(ke,Me,Ie){be(ke),be(Me),be(Ie);const ce=i.length/3,G=w.generateTopUV(r,i,ce-3,ce-2,ce-1);De(G[0]),De(G[1]),De(G[2])}function Ne(ke,Me,Ie,ce){be(ke),be(Me),be(ce),be(Me),be(Ie),be(ce);const G=i.length/3,xe=w.generateSideWallUV(r,i,G-6,G-3,G-2,G-1);De(xe[0]),De(xe[1]),De(xe[3]),De(xe[1]),De(xe[2]),De(xe[3])}function be(ke){i.push(l[ke*3+0]),i.push(l[ke*3+1]),i.push(l[ke*3+2])}function De(ke){a.push(ke.x),a.push(ke.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,r=this.parameters.options;return s0e(n,r,e)}static fromJSON(e,n){const r=[];for(let a=0,s=e.shapes.length;a<s;a++){const o=n[e.shapes[a]];r.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new Q_[i.type]().fromJSON(i)),new L2(r,e.options)}}const a0e={generateTopUV:function(t,e,n,r,i){const a=e[n*3],s=e[n*3+1],o=e[r*3],l=e[r*3+1],u=e[i*3],c=e[i*3+1];return[new dt(a,s),new dt(o,l),new dt(u,c)]},generateSideWallUV:function(t,e,n,r,i,a){const s=e[n*3],o=e[n*3+1],l=e[n*3+2],u=e[r*3],c=e[r*3+1],d=e[r*3+2],h=e[i*3],f=e[i*3+1],m=e[i*3+2],x=e[a*3],b=e[a*3+1],y=e[a*3+2];return Math.abs(o-c)<Math.abs(s-u)?[new dt(s,1-l),new dt(u,1-d),new dt(h,1-m),new dt(x,1-y)]:[new dt(o,1-l),new dt(c,1-d),new dt(f,1-m),new dt(b,1-y)]}};function s0e(t,e,n){if(n.shapes=[],Array.isArray(t))for(let r=0,i=t.length;r<i;r++){const a=t[r];n.shapes.push(a.uuid)}else n.shapes.push(t.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class F2 extends md{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,a,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new F2(e.radius,e.detail)}}class B2 extends bn{constructor(e=[new dt(0,-.5),new dt(.5,0),new dt(0,.5)],n=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:r,phiLength:i},n=Math.floor(n),i=gn(i,0,Math.PI*2);const a=[],s=[],o=[],l=[],u=[],c=1/n,d=new we,h=new dt,f=new we,m=new we,x=new we;let b=0,y=0;for(let w=0;w<=e.length-1;w++)switch(w){case 0:b=e[w+1].x-e[w].x,y=e[w+1].y-e[w].y,f.x=y*1,f.y=-b,f.z=y*0,x.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(x.x,x.y,x.z);break;default:b=e[w+1].x-e[w].x,y=e[w+1].y-e[w].y,f.x=y*1,f.y=-b,f.z=y*0,m.copy(f),f.x+=x.x,f.y+=x.y,f.z+=x.z,f.normalize(),l.push(f.x,f.y,f.z),x.copy(m)}for(let w=0;w<=n;w++){const _=r+w*c*i,S=Math.sin(_),M=Math.cos(_);for(let E=0;E<=e.length-1;E++){d.x=e[E].x*S,d.y=e[E].y,d.z=e[E].x*M,s.push(d.x,d.y,d.z),h.x=w/n,h.y=E/(e.length-1),o.push(h.x,h.y);const C=l[3*E+0]*S,R=l[3*E+1],k=l[3*E+0]*M;u.push(C,R,k)}}for(let w=0;w<n;w++)for(let _=0;_<e.length-1;_++){const S=_+w*e.length,M=S,E=S+e.length,C=S+e.length+1,R=S+1;a.push(M,E,R),a.push(C,R,E)}this.setIndex(a),this.setAttribute("position",new Wt(s,3)),this.setAttribute("uv",new Wt(o,2)),this.setAttribute("normal",new Wt(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new B2(e.points,e.segments,e.phiStart,e.phiLength)}}class bv extends md{constructor(e=1,n=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new bv(e.radius,e.detail)}}class Wu extends bn{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const a=e/2,s=n/2,o=Math.floor(r),l=Math.floor(i),u=o+1,c=l+1,d=e/o,h=n/l,f=[],m=[],x=[],b=[];for(let y=0;y<c;y++){const w=y*h-s;for(let _=0;_<u;_++){const S=_*d-a;m.push(S,-w,0),x.push(0,0,1),b.push(_/o),b.push(1-y/l)}}for(let y=0;y<l;y++)for(let w=0;w<o;w++){const _=w+u*y,S=w+u*(y+1),M=w+1+u*(y+1),E=w+1+u*y;f.push(_,S,E),f.push(S,M,E)}this.setIndex(f),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(x,3)),this.setAttribute("uv",new Wt(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wu(e.width,e.height,e.widthSegments,e.heightSegments)}}class U2 extends bn{constructor(e=.5,n=1,r=32,i=1,a=0,s=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:i,thetaStart:a,thetaLength:s},r=Math.max(3,r),i=Math.max(1,i);const o=[],l=[],u=[],c=[];let d=e;const h=(n-e)/i,f=new we,m=new dt;for(let x=0;x<=i;x++){for(let b=0;b<=r;b++){const y=a+b/r*s;f.x=d*Math.cos(y),f.y=d*Math.sin(y),l.push(f.x,f.y,f.z),u.push(0,0,1),m.x=(f.x/n+1)/2,m.y=(f.y/n+1)/2,c.push(m.x,m.y)}d+=h}for(let x=0;x<i;x++){const b=x*(r+1);for(let y=0;y<r;y++){const w=y+b,_=w,S=w+r+1,M=w+r+2,E=w+1;o.push(_,S,E),o.push(S,M,E)}}this.setIndex(o),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(u,3)),this.setAttribute("uv",new Wt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new U2(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class z2 extends bn{constructor(e=new Bh([new dt(0,.5),new dt(-.5,-.5),new dt(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const r=[],i=[],a=[],s=[];let o=0,l=0;if(Array.isArray(e)===!1)u(e);else for(let c=0;c<e.length;c++)u(e[c]),this.addGroup(o,l,c),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Wt(i,3)),this.setAttribute("normal",new Wt(a,3)),this.setAttribute("uv",new Wt(s,2));function u(c){const d=i.length/3,h=c.extractPoints(n);let f=h.shape;const m=h.holes;Ko.isClockWise(f)===!1&&(f=f.reverse());for(let b=0,y=m.length;b<y;b++){const w=m[b];Ko.isClockWise(w)===!0&&(m[b]=w.reverse())}const x=Ko.triangulateShape(f,m);for(let b=0,y=m.length;b<y;b++){const w=m[b];f=f.concat(w)}for(let b=0,y=f.length;b<y;b++){const w=f[b];i.push(w.x,w.y,0),a.push(0,0,1),s.push(w.x,w.y)}for(let b=0,y=x.length;b<y;b++){const w=x[b],_=w[0]+d,S=w[1]+d,M=w[2]+d;r.push(_,S,M),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return o0e(n,e)}static fromJSON(e,n){const r=[];for(let i=0,a=e.shapes.length;i<a;i++){const s=n[e.shapes[i]];r.push(s)}return new z2(r,e.curveSegments)}}function o0e(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}class _v extends bn{constructor(e=1,n=32,r=16,i=0,a=Math.PI*2,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:i,phiLength:a,thetaStart:s,thetaLength:o},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));const l=Math.min(s+o,Math.PI);let u=0;const c=[],d=new we,h=new we,f=[],m=[],x=[],b=[];for(let y=0;y<=r;y++){const w=[],_=y/r;let S=0;y===0&&s===0?S=.5/n:y===r&&l===Math.PI&&(S=-.5/n);for(let M=0;M<=n;M++){const E=M/n;d.x=-e*Math.cos(i+E*a)*Math.sin(s+_*o),d.y=e*Math.cos(s+_*o),d.z=e*Math.sin(i+E*a)*Math.sin(s+_*o),m.push(d.x,d.y,d.z),h.copy(d).normalize(),x.push(h.x,h.y,h.z),b.push(E+S,1-_),w.push(u++)}c.push(w)}for(let y=0;y<r;y++)for(let w=0;w<n;w++){const _=c[y][w+1],S=c[y][w],M=c[y+1][w],E=c[y+1][w+1];(y!==0||s>0)&&f.push(_,S,E),(y!==r-1||l<Math.PI)&&f.push(S,M,E)}this.setIndex(f),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(x,3)),this.setAttribute("uv",new Wt(b,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _v(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class j2 extends md{constructor(e=1,n=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new j2(e.radius,e.detail)}}class H2 extends bn{constructor(e=1,n=.4,r=12,i=48,a=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:i,arc:a},r=Math.floor(r),i=Math.floor(i);const s=[],o=[],l=[],u=[],c=new we,d=new we,h=new we;for(let f=0;f<=r;f++)for(let m=0;m<=i;m++){const x=m/i*a,b=f/r*Math.PI*2;d.x=(e+n*Math.cos(b))*Math.cos(x),d.y=(e+n*Math.cos(b))*Math.sin(x),d.z=n*Math.sin(b),o.push(d.x,d.y,d.z),c.x=e*Math.cos(x),c.y=e*Math.sin(x),h.subVectors(d,c).normalize(),l.push(h.x,h.y,h.z),u.push(m/i),u.push(f/r)}for(let f=1;f<=r;f++)for(let m=1;m<=i;m++){const x=(i+1)*f+m-1,b=(i+1)*(f-1)+m-1,y=(i+1)*(f-1)+m,w=(i+1)*f+m;s.push(x,b,w),s.push(b,y,w)}this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new H2(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class $2 extends bn{constructor(e=1,n=.4,r=64,i=8,a=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:a,q:s},r=Math.floor(r),i=Math.floor(i);const o=[],l=[],u=[],c=[],d=new we,h=new we,f=new we,m=new we,x=new we,b=new we,y=new we;for(let _=0;_<=r;++_){const S=_/r*a*Math.PI*2;w(S,a,s,e,f),w(S+.01,a,s,e,m),b.subVectors(m,f),y.addVectors(m,f),x.crossVectors(b,y),y.crossVectors(x,b),x.normalize(),y.normalize();for(let M=0;M<=i;++M){const E=M/i*Math.PI*2,C=-n*Math.cos(E),R=n*Math.sin(E);d.x=f.x+(C*y.x+R*x.x),d.y=f.y+(C*y.y+R*x.y),d.z=f.z+(C*y.z+R*x.z),l.push(d.x,d.y,d.z),h.subVectors(d,f).normalize(),u.push(h.x,h.y,h.z),c.push(_/r),c.push(M/i)}}for(let _=1;_<=r;_++)for(let S=1;S<=i;S++){const M=(i+1)*(_-1)+(S-1),E=(i+1)*_+(S-1),C=(i+1)*_+S,R=(i+1)*(_-1)+S;o.push(M,E,R),o.push(E,C,R)}this.setIndex(o),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(u,3)),this.setAttribute("uv",new Wt(c,2));function w(_,S,M,E,C){const R=Math.cos(_),k=Math.sin(_),I=M/S*_,N=Math.cos(I);C.x=E*(2+N)*.5*R,C.y=E*(2+N)*k*.5,C.z=E*Math.sin(I)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $2(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class V2 extends bn{constructor(e=new O2(new we(-1,-1,0),new we(-1,1,0),new we(1,1,0)),n=64,r=1,i=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:r,radialSegments:i,closed:a};const s=e.computeFrenetFrames(n,a);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new we,l=new we,u=new dt;let c=new we;const d=[],h=[],f=[],m=[];x(),this.setIndex(m),this.setAttribute("position",new Wt(d,3)),this.setAttribute("normal",new Wt(h,3)),this.setAttribute("uv",new Wt(f,2));function x(){for(let _=0;_<n;_++)b(_);b(a===!1?n:0),w(),y()}function b(_){c=e.getPointAt(_/n,c);const S=s.normals[_],M=s.binormals[_];for(let E=0;E<=i;E++){const C=E/i*Math.PI*2,R=Math.sin(C),k=-Math.cos(C);l.x=k*S.x+R*M.x,l.y=k*S.y+R*M.y,l.z=k*S.z+R*M.z,l.normalize(),h.push(l.x,l.y,l.z),o.x=c.x+r*l.x,o.y=c.y+r*l.y,o.z=c.z+r*l.z,d.push(o.x,o.y,o.z)}}function y(){for(let _=1;_<=n;_++)for(let S=1;S<=i;S++){const M=(i+1)*(_-1)+(S-1),E=(i+1)*_+(S-1),C=(i+1)*_+S,R=(i+1)*(_-1)+S;m.push(M,E,R),m.push(E,C,R)}}function w(){for(let _=0;_<=n;_++)for(let S=0;S<=i;S++)u.x=_/n,u.y=S/i,f.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new V2(new Q_[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class d8 extends bn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],r=new Set,i=new we,a=new we;if(e.index!==null){const s=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let u=0,c=l.length;u<c;++u){const d=l[u],h=d.start,f=d.count;for(let m=h,x=h+f;m<x;m+=3)for(let b=0;b<3;b++){const y=o.getX(m+b),w=o.getX(m+(b+1)%3);i.fromBufferAttribute(s,y),a.fromBufferAttribute(s,w),fO(i,a,r)===!0&&(n.push(i.x,i.y,i.z),n.push(a.x,a.y,a.z))}}}else{const s=e.attributes.position;for(let o=0,l=s.count/3;o<l;o++)for(let u=0;u<3;u++){const c=3*o+u,d=3*o+(u+1)%3;i.fromBufferAttribute(s,c),a.fromBufferAttribute(s,d),fO(i,a,r)===!0&&(n.push(i.x,i.y,i.z),n.push(a.x,a.y,a.z))}}this.setAttribute("position",new Wt(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function fO(t,e,n){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return n.has(r)===!0||n.has(i)===!0?!1:(n.add(r),n.add(i),!0)}var pO=Object.freeze({__proto__:null,BoxGeometry:pf,CapsuleGeometry:N2,CircleGeometry:R2,ConeGeometry:xv,CylinderGeometry:yv,DodecahedronGeometry:P2,EdgesGeometry:wK,ExtrudeGeometry:L2,IcosahedronGeometry:F2,LatheGeometry:B2,OctahedronGeometry:bv,PlaneGeometry:Wu,PolyhedronGeometry:md,RingGeometry:U2,ShapeGeometry:z2,SphereGeometry:_v,TetrahedronGeometry:j2,TorusGeometry:H2,TorusKnotGeometry:$2,TubeGeometry:V2,WireframeGeometry:d8});class RK extends Ua{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new zt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class h8 extends Ss{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class f8 extends Ua{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new zt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Js,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PK extends f8{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return gn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new zt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new zt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new zt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class DK extends Ua{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new zt(16777215),this.specular=new zt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Js,this.combine=mv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class OK extends Ua{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new zt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class LK extends Ua{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class FK extends Ua{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new zt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new zt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Js,this.combine=mv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class q2 extends Ua{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=KX,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class G2 extends Ua{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class BK extends Ua{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new zt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pd,this.normalScale=new dt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class UK extends is{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Th(t,e){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function zK(t){function e(i,a){return t[i]-t[a]}const n=t.length,r=new Array(n);for(let i=0;i!==n;++i)r[i]=i;return r.sort(e),r}function V6(t,e,n){const r=t.length,i=new t.constructor(r);for(let a=0,s=0;s!==r;++a){const o=n[a]*e;for(let l=0;l!==e;++l)i[s++]=t[o+l]}return i}function p8(t,e,n,r){let i=1,a=t[0];for(;a!==void 0&&a[r]===void 0;)a=t[i++];if(a===void 0)return;let s=a[r];if(s!==void 0)if(Array.isArray(s))do s=a[r],s!==void 0&&(e.push(a.time),n.push(...s)),a=t[i++];while(a!==void 0);else if(s.toArray!==void 0)do s=a[r],s!==void 0&&(e.push(a.time),s.toArray(n,n.length)),a=t[i++];while(a!==void 0);else do s=a[r],s!==void 0&&(e.push(a.time),n.push(s)),a=t[i++];while(a!==void 0)}function l0e(t,e,n,r,i=30){const a=t.clone();a.name=e;const s=[];for(let l=0;l<a.tracks.length;++l){const u=a.tracks[l],c=u.getValueSize(),d=[],h=[];for(let f=0;f<u.times.length;++f){const m=u.times[f]*i;if(!(m<n||m>=r)){d.push(u.times[f]);for(let x=0;x<c;++x)h.push(u.values[f*c+x])}}d.length!==0&&(u.times=Th(d,u.times.constructor),u.values=Th(h,u.values.constructor),s.push(u))}a.tracks=s;let o=1/0;for(let l=0;l<a.tracks.length;++l)o>a.tracks[l].times[0]&&(o=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*o);return a.resetDuration(),a}function u0e(t,e=0,n=t,r=30){r<=0&&(r=30);const i=n.tracks.length,a=e/r;for(let s=0;s<i;++s){const o=n.tracks[s],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const u=t.tracks.find(function(y){return y.name===o.name&&y.ValueTypeName===l});if(u===void 0)continue;let c=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=d/3);let h=0;const f=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);const m=o.times.length-1;let x;if(a<=o.times[0]){const y=c,w=d-c;x=o.values.slice(y,w)}else if(a>=o.times[m]){const y=m*d+c,w=y+d-c;x=o.values.slice(y,w)}else{const y=o.createInterpolant(),w=c,_=d-c;y.evaluate(a),x=y.resultBuffer.slice(w,_)}l==="quaternion"&&new xa().fromArray(x).normalize().conjugate().toArray(x);const b=u.times.length;for(let y=0;y<b;++y){const w=y*f+h;if(l==="quaternion")xa.multiplyQuaternionsFlat(u.values,w,x,0,u.values,w);else{const _=f-h*2;for(let S=0;S<_;++S)u.values[w+S]-=x[S]}}}return t.blendMode=YN,t}class c0e{static convertArray(e,n){return Th(e,n)}static isTypedArray(e){return sK(e)}static getKeyframeOrder(e){return zK(e)}static sortedArray(e,n,r){return V6(e,n,r)}static flattenJSON(e,n,r,i){p8(e,n,r,i)}static subclip(e,n,r,i,a=30){return l0e(e,n,r,i,a)}static makeClipAdditive(e,n=0,r=e,i=30){return u0e(e,n,r,i)}}class wv{constructor(e,n,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let r=this._cachedIndex,i=n[r],a=n[r-1];e:{t:{let s;n:{r:if(!(e<i)){for(let o=r+2;;){if(i===void 0){if(e<a)break r;return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(a=i,i=n[++r],e<i)break t}s=n.length;break n}if(!(e>=a)){const o=n[1];e<o&&(r=2,a=o);for(let l=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(i=a,a=n[--r-1],e>=a)break t}s=r,r=0;break n}break e}for(;r<s;){const o=r+s>>>1;e<n[o]?s=o:r=o+1}if(i=n[r],a=n[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,i)}return this.interpolate_(r,a,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=e*i;for(let s=0;s!==i;++s)n[s]=r[a+s];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class jK extends wv{constructor(e,n,r,i){super(e,n,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Sh,endingEnd:Sh}}intervalChanged_(e,n,r){const i=this.parameterPositions;let a=e-2,s=e+1,o=i[a],l=i[s];if(o===void 0)switch(this.getSettings_().endingStart){case Eh:a=e,o=2*n-r;break;case f1:a=i.length-2,o=n+i[a]-i[a+1];break;default:a=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Eh:s=e,l=2*r-n;break;case f1:s=1,l=r+i[1]-i[0];break;default:s=e-1,l=n}const u=(r-n)*.5,c=this.valueSize;this._weightPrev=u/(n-o),this._weightNext=u/(l-r),this._offsetPrev=a*c,this._offsetNext=s*c}interpolate_(e,n,r,i){const a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,c=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,m=(r-n)/(i-n),x=m*m,b=x*m,y=-h*b+2*h*x-h*m,w=(1+h)*b+(-1.5-2*h)*x+(-.5+h)*m+1,_=(-1-f)*b+(1.5+f)*x+.5*m,S=f*b-f*x;for(let M=0;M!==o;++M)a[M]=y*s[c+M]+w*s[u+M]+_*s[l+M]+S*s[d+M];return a}}class m8 extends wv{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e,n,r,i){const a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=e*o,u=l-o,c=(r-n)/(i-n),d=1-c;for(let h=0;h!==o;++h)a[h]=s[u+h]*d+s[l+h]*c;return a}}class HK extends wv{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class So{constructor(e,n,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Th(n,this.TimeBufferType),this.values=Th(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let r;if(n.toJSON!==this.toJSON)r=n.toJSON(e);else{r={name:e.name,times:Th(e.times,Array),values:Th(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new HK(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new m8(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new jK(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case h1:n=this.InterpolantFactoryMethodDiscrete;break;case K_:n=this.InterpolantFactoryMethodLinear;break;case Fb:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return Ut("KeyframeTrack:",r),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return h1;case this.InterpolantFactoryMethodLinear:return K_;case this.InterpolantFactoryMethodSmooth:return Fb}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let r=0,i=n.length;r!==i;++r)n[r]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let r=0,i=n.length;r!==i;++r)n[r]*=e}return this}trim(e,n){const r=this.times,i=r.length;let a=0,s=i-1;for(;a!==i&&r[a]<e;)++a;for(;s!==-1&&r[s]>n;)--s;if(++s,a!==0||s!==i){a>=s&&(s=Math.max(s,1),a=s-1);const o=this.getValueSize();this.times=r.slice(a,s),this.values=this.values.slice(a*o,s*o)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(tn("KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,a=r.length;a===0&&(tn("KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let o=0;o!==a;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){tn("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(s!==null&&s>l){tn("KeyframeTrack: Out of order keys.",this,o,l,s),e=!1;break}s=l}if(i!==void 0&&sK(i))for(let o=0,l=i.length;o!==l;++o){const u=i[o];if(isNaN(u)){tn("KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===Fb,a=e.length-1;let s=1;for(let o=1;o<a;++o){let l=!1;const u=e[o],c=e[o+1];if(u!==c&&(o!==1||u!==e[0]))if(i)l=!0;else{const d=o*r,h=d-r,f=d+r;for(let m=0;m!==r;++m){const x=n[d+m];if(x!==n[h+m]||x!==n[f+m]){l=!0;break}}}if(l){if(o!==s){e[s]=e[o];const d=o*r,h=s*r;for(let f=0;f!==r;++f)n[h+f]=n[d+f]}++s}}if(a>0){e[s]=e[a];for(let o=a*r,l=s*r,u=0;u!==r;++u)n[l+u]=n[o+u];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=n.slice(0,s*r)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),r=this.constructor,i=new r(this.name,e,n);return i.createInterpolant=this.createInterpolant,i}}So.prototype.ValueTypeName="";So.prototype.TimeBufferType=Float32Array;So.prototype.ValueBufferType=Float32Array;So.prototype.DefaultInterpolation=K_;class mf extends So{constructor(e,n,r){super(e,n,r)}}mf.prototype.ValueTypeName="bool";mf.prototype.ValueBufferType=Array;mf.prototype.DefaultInterpolation=h1;mf.prototype.InterpolantFactoryMethodLinear=void 0;mf.prototype.InterpolantFactoryMethodSmooth=void 0;class g8 extends So{constructor(e,n,r,i){super(e,n,r,i)}}g8.prototype.ValueTypeName="color";class w1 extends So{constructor(e,n,r,i){super(e,n,r,i)}}w1.prototype.ValueTypeName="number";class $K extends wv{constructor(e,n,r,i){super(e,n,r,i)}interpolate_(e,n,r,i){const a=this.resultBuffer,s=this.sampleValues,o=this.valueSize,l=(r-n)/(i-n);let u=e*o;for(let c=u+o;u!==c;u+=4)xa.slerpFlat(a,0,s,u-o,s,u,l);return a}}class Sv extends So{constructor(e,n,r,i){super(e,n,r,i)}InterpolantFactoryMethodLinear(e){return new $K(this.times,this.values,this.getValueSize(),e)}}Sv.prototype.ValueTypeName="quaternion";Sv.prototype.InterpolantFactoryMethodSmooth=void 0;class gf extends So{constructor(e,n,r){super(e,n,r)}}gf.prototype.ValueTypeName="string";gf.prototype.ValueBufferType=Array;gf.prototype.DefaultInterpolation=h1;gf.prototype.InterpolantFactoryMethodLinear=void 0;gf.prototype.InterpolantFactoryMethodSmooth=void 0;class S1 extends So{constructor(e,n,r,i){super(e,n,r,i)}}S1.prototype.ValueTypeName="vector";class E1{constructor(e="",n=-1,r=[],i=x2){this.name=e,this.tracks=r,this.duration=n,this.blendMode=i,this.uuid=Ws(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,i=1/(e.fps||1);for(let s=0,o=r.length;s!==o;++s)n.push(h0e(r[s]).scale(i));const a=new this(e.name,e.duration,n,e.blendMode);return a.uuid=e.uuid,a.userData=JSON.parse(e.userData||"{}"),a}static toJSON(e){const n=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let a=0,s=r.length;a!==s;++a)n.push(So.toJSON(r[a]));return i}static CreateFromMorphTargetSequence(e,n,r,i){const a=n.length,s=[];for(let o=0;o<a;o++){let l=[],u=[];l.push((o+a-1)%a,o,(o+1)%a),u.push(0,1,0);const c=zK(l);l=V6(l,1,c),u=V6(u,1,c),!i&&l[0]===0&&(l.push(a),u.push(u[0])),s.push(new w1(".morphTargetInfluences["+n[o].name+"]",l,u).scale(1/r))}return new this(e,-1,s)}static findByName(e,n){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===n)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,n,r){const i={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const u=e[o],c=u.name.match(a);if(c&&c.length>1){const d=c[1];let h=i[d];h||(i[d]=h=[]),h.push(u)}}const s=[];for(const o in i)s.push(this.CreateFromMorphTargetSequence(o,i[o],n,r));return s}static parseAnimation(e,n){if(Ut("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return tn("AnimationClip: No animation in JSONLoader data."),null;const r=function(d,h,f,m,x){if(f.length!==0){const b=[],y=[];p8(f,b,y,m),b.length!==0&&x.push(new d(h,b,y))}},i=[],a=e.name||"default",s=e.fps||30,o=e.blendMode;let l=e.length||-1;const u=e.hierarchy||[];for(let d=0;d<u.length;d++){const h=u[d].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const f={};let m;for(m=0;m<h.length;m++)if(h[m].morphTargets)for(let x=0;x<h[m].morphTargets.length;x++)f[h[m].morphTargets[x]]=-1;for(const x in f){const b=[],y=[];for(let w=0;w!==h[m].morphTargets.length;++w){const _=h[m];b.push(_.time),y.push(_.morphTarget===x?1:0)}i.push(new w1(".morphTargetInfluence["+x+"]",b,y))}l=f.length*s}else{const f=".bones["+n[d].name+"]";r(S1,f+".position",h,"pos",i),r(Sv,f+".quaternion",h,"rot",i),r(S1,f+".scale",h,"scl",i)}}return i.length===0?null:new this(a,l,i,o)}resetDuration(){const e=this.tracks;let n=0;for(let r=0,i=e.length;r!==i;++r){const a=this.tracks[r];n=Math.max(n,a.times[a.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let r=0;r<this.tracks.length;r++)e.push(this.tracks[r].clone());const n=new this.constructor(this.name,this.duration,e,this.blendMode);return n.userData=JSON.parse(JSON.stringify(this.userData)),n}toJSON(){return this.constructor.toJSON(this)}}function d0e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return w1;case"vector":case"vector2":case"vector3":case"vector4":return S1;case"color":return g8;case"quaternion":return Sv;case"bool":case"boolean":return mf;case"string":return gf}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function h0e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=d0e(t.type);if(t.times===void 0){const n=[],r=[];p8(t.keys,n,r,"value"),t.times=n,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Nl={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class v8{constructor(e,n,r){const i=this;let a=!1,s=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this._abortController=null,this.itemStart=function(c){o++,a===!1&&i.onStart!==void 0&&i.onStart(c,s,o),a=!0},this.itemEnd=function(c){s++,i.onProgress!==void 0&&i.onProgress(c,s,o),s===o&&(a=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(c){i.onError!==void 0&&i.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,d){return u.push(c,d),this},this.removeHandler=function(c){const d=u.indexOf(c);return d!==-1&&u.splice(d,2),this},this.getHandler=function(c){for(let d=0,h=u.length;d<h;d+=2){const f=u[d],m=u[d+1];if(f.global&&(f.lastIndex=0),f.test(c))return m}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const VK=new v8;class Es{constructor(e){this.manager=e!==void 0?e:VK,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,a){r.load(e,i,n,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Es.DEFAULT_MATERIAL_NAME="__DEFAULT";const wu={};class f0e extends Error{constructor(e,n){super(e),this.response=n}}class zu extends Es{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,n,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Nl.get(`file:${e}`);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(a),this.manager.itemEnd(e)},0),a;if(wu[e]!==void 0){wu[e].push({onLoad:n,onProgress:r,onError:i});return}wu[e]=[],wu[e].push({onLoad:n,onProgress:r,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(s).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&Ut("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const c=wu[e],d=u.body.getReader(),h=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),f=h?parseInt(h):0,m=f!==0;let x=0;const b=new ReadableStream({start(y){w();function w(){d.read().then(({done:_,value:S})=>{if(_)y.close();else{x+=S.byteLength;const M=new ProgressEvent("progress",{lengthComputable:m,loaded:x,total:f});for(let E=0,C=c.length;E<C;E++){const R=c[E];R.onProgress&&R.onProgress(M)}y.enqueue(S),w()}},_=>{y.error(_)})}}});return new Response(b)}else throw new f0e(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(c=>new DOMParser().parseFromString(c,o));case"json":return u.json();default:if(o==="")return u.text();{const d=/charset="?([^;"\s]*)"?/i.exec(o),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return u.arrayBuffer().then(m=>f.decode(m))}}}).then(u=>{Nl.add(`file:${e}`,u);const c=wu[e];delete wu[e];for(let d=0,h=c.length;d<h;d++){const f=c[d];f.onLoad&&f.onLoad(u)}}).catch(u=>{const c=wu[e];if(c===void 0)throw this.manager.itemError(e),u;delete wu[e];for(let d=0,h=c.length;d<h;d++){const f=c[d];f.onError&&f.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class p0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=new zu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(o){try{n(a.parse(JSON.parse(o)))}catch(l){i?i(l):tn(l),a.manager.itemError(e)}},r,i)}parse(e){const n=[];for(let r=0;r<e.length;r++){const i=E1.parse(e[r]);n.push(i)}return n}}class m0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=[],o=new I2,l=new zu(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(a.withCredentials);let u=0;function c(d){l.load(e[d],function(h){const f=a.parse(h,!0);s[d]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},u+=1,u===6&&(f.mipmapCount===1&&(o.minFilter=Pr),o.image=s,o.format=f.format,o.needsUpdate=!0,n&&n(o))},r,i)}if(Array.isArray(e))for(let d=0,h=e.length;d<h;++d)c(d);else l.load(e,function(d){const h=a.parse(d,!0);if(h.isCubemap){const f=h.mipmaps.length/h.mipmapCount;for(let m=0;m<f;m++){s[m]={mipmaps:[]};for(let x=0;x<h.mipmapCount;x++)s[m].mipmaps.push(h.mipmaps[m*h.mipmapCount+x]),s[m].format=h.format,s[m].width=h.width,s[m].height=h.height}o.image=s}else o.image.width=h.width,o.image.height=h.height,o.mipmaps=h.mipmaps;h.mipmapCount===1&&(o.minFilter=Pr),o.format=h.format,o.needsUpdate=!0,n&&n(o)},r,i);return o}}const Cp=new WeakMap;class T1 extends Es{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,s=Nl.get(`image:${e}`);if(s!==void 0){if(s.complete===!0)a.manager.itemStart(e),setTimeout(function(){n&&n(s),a.manager.itemEnd(e)},0);else{let d=Cp.get(s);d===void 0&&(d=[],Cp.set(s,d)),d.push({onLoad:n,onError:i})}return s}const o=g1("img");function l(){c(),n&&n(this);const d=Cp.get(this)||[];for(let h=0;h<d.length;h++){const f=d[h];f.onLoad&&f.onLoad(this)}Cp.delete(this),a.manager.itemEnd(e)}function u(d){c(),i&&i(d),Nl.remove(`image:${e}`);const h=Cp.get(this)||[];for(let f=0;f<h.length;f++){const m=h[f];m.onError&&m.onError(d)}Cp.delete(this),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Nl.add(`image:${e}`,o),a.manager.itemStart(e),o.src=e,o}}class g0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=new vv;a.colorSpace=Na;const s=new T1(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function l(u){s.load(e[u],function(c){a.images[u]=c,o++,o===6&&(a.needsUpdate=!0,n&&n(a))},void 0,i)}for(let u=0;u<e.length;++u)l(u);return a}}class v0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=new tl,o=new zu(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(a.withCredentials),o.load(e,function(l){let u;try{u=a.parse(l)}catch(c){if(i!==void 0)i(c);else{c(c);return}}u.image!==void 0?s.image=u.image:u.data!==void 0&&(s.image.width=u.width,s.image.height=u.height,s.image.data=u.data),s.wrapS=u.wrapS!==void 0?u.wrapS:bs,s.wrapT=u.wrapT!==void 0?u.wrapT:bs,s.magFilter=u.magFilter!==void 0?u.magFilter:Pr,s.minFilter=u.minFilter!==void 0?u.minFilter:Pr,s.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(s.colorSpace=u.colorSpace),u.flipY!==void 0&&(s.flipY=u.flipY),u.format!==void 0&&(s.format=u.format),u.type!==void 0&&(s.type=u.type),u.mipmaps!==void 0&&(s.mipmaps=u.mipmaps,s.minFilter=Il),u.mipmapCount===1&&(s.minFilter=Pr),u.generateMipmaps!==void 0&&(s.generateMipmaps=u.generateMipmaps),s.needsUpdate=!0,n&&n(s,u)},r,i),s}}class y0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=new hi,s=new T1(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(o){a.image=o,a.needsUpdate=!0,n!==void 0&&n(a)},r,i),a}}class gd extends nr{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new zt(e),this.intensity=n}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,n}}class qK extends gd{constructor(e,n,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(nr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new zt(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}toJSON(e){const n=super.toJSON(e);return n.object.groundColor=this.groundColor.getHex(),n}}const uE=new fn,mO=new we,gO=new we;class y8{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new dt(512,512),this.mapType=Ka,this.map=null,this.mapPass=null,this.matrix=new fn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new z0,this._frameExtents=new dt(1,1),this._viewportCount=1,this._viewports=[new er(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,r=this.matrix;mO.setFromMatrixPosition(e.matrixWorld),n.position.copy(mO),gO.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(gO),n.updateMatrixWorld(),uE.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uE,n.coordinateSystem,n.reversedDepth),n.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(uE)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class x0e extends y8{constructor(){super(new Si(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const n=this.camera,r=d0*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,a=e.distance||n.far;(r!==n.fov||i!==n.aspect||a!==n.far)&&(n.fov=r,n.aspect=i,n.far=a,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class GK extends gd{constructor(e,n,r=0,i=Math.PI/3,a=0,s=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(nr.DEFAULT_UP),this.updateMatrix(),this.target=new nr,this.distance=r,this.angle=i,this.penumbra=a,this.decay=s,this.map=null,this.shadow=new x0e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const n=super.toJSON(e);return n.object.distance=this.distance,n.object.angle=this.angle,n.object.decay=this.decay,n.object.penumbra=this.penumbra,n.object.target=this.target.uuid,this.map&&this.map.isTexture&&(n.object.map=this.map.toJSON(e).uuid),n.object.shadow=this.shadow.toJSON(),n}}class b0e extends y8{constructor(){super(new Si(90,1,.5,500)),this.isPointLightShadow=!0}}class WK extends gd{constructor(e,n,r=0,i=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new b0e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const n=super.toJSON(e);return n.object.distance=this.distance,n.object.decay=this.decay,n.object.shadow=this.shadow.toJSON(),n}}class Ou extends E2{constructor(e=-1,n=1,r=1,i=-1,a=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=a,this.far=s,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,a,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let a=r-e,s=r+e,o=i+n,l=i-n;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=u*this.view.offsetX,s=a+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(a,s,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class _0e extends y8{constructor(){super(new Ou(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class YK extends gd{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(nr.DEFAULT_UP),this.updateMatrix(),this.target=new nr,this.shadow=new _0e}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const n=super.toJSON(e);return n.object.shadow=this.shadow.toJSON(),n.object.target=this.target.uuid,n}}class XK extends gd{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class KK extends gd{constructor(e,n,r=10,i=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class x8{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new we)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const r=e.x,i=e.y,a=e.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.282095),n.addScaledVector(s[1],.488603*i),n.addScaledVector(s[2],.488603*a),n.addScaledVector(s[3],.488603*r),n.addScaledVector(s[4],1.092548*(r*i)),n.addScaledVector(s[5],1.092548*(i*a)),n.addScaledVector(s[6],.315392*(3*a*a-1)),n.addScaledVector(s[7],1.092548*(r*a)),n.addScaledVector(s[8],.546274*(r*r-i*i)),n}getIrradianceAt(e,n){const r=e.x,i=e.y,a=e.z,s=this.coefficients;return n.copy(s[0]).multiplyScalar(.886227),n.addScaledVector(s[1],2*.511664*i),n.addScaledVector(s[2],2*.511664*a),n.addScaledVector(s[3],2*.511664*r),n.addScaledVector(s[4],2*.429043*r*i),n.addScaledVector(s[5],2*.429043*i*a),n.addScaledVector(s[6],.743125*a*a-.247708),n.addScaledVector(s[7],2*.429043*r*a),n.addScaledVector(s[8],.429043*(r*r-i*i)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,n+i*3);return this}toArray(e=[],n=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,n+i*3);return e}static getBasisAt(e,n){const r=e.x,i=e.y,a=e.z;n[0]=.282095,n[1]=.488603*i,n[2]=.488603*a,n[3]=.488603*r,n[4]=1.092548*r*i,n[5]=1.092548*i*a,n[6]=.315392*(3*a*a-1),n[7]=1.092548*r*a,n[8]=.546274*(r*r-i*i)}}class ZK extends gd{constructor(e=new x8,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class W2 extends Es{constructor(e){super(e),this.textures={}}load(e,n,r,i){const a=this,s=new zu(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(o){try{n(a.parse(JSON.parse(o)))}catch(l){i?i(l):tn(l),a.manager.itemError(e)}},r,i)}parse(e){const n=this.textures;function r(a){return n[a]===void 0&&Ut("MaterialLoader: Undefined texture",a),n[a]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new zt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(i.allowOverride=e.allowOverride),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const s=e.uniforms[a];switch(i.uniforms[a]={},s.type){case"t":i.uniforms[a].value=r(s.value);break;case"c":i.uniforms[a].value=new zt().setHex(s.value);break;case"v2":i.uniforms[a].value=new dt().fromArray(s.value);break;case"v3":i.uniforms[a].value=new we().fromArray(s.value);break;case"v4":i.uniforms[a].value=new er().fromArray(s.value);break;case"m3":i.uniforms[a].value=new Sn().fromArray(s.value);break;case"m4":i.uniforms[a].value=new fn().fromArray(s.value);break;default:i.uniforms[a].value=s.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)i.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),i.normalScale=new dt().fromArray(a)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new dt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return W2.createMaterialFromType(e)}static createMaterialFromType(e){const n={ShadowMaterial:RK,SpriteMaterial:n8,RawShaderMaterial:h8,ShaderMaterial:Ss,PointsMaterial:i8,MeshPhysicalMaterial:PK,MeshStandardMaterial:f8,MeshPhongMaterial:DK,MeshToonMaterial:OK,MeshNormalMaterial:LK,MeshLambertMaterial:FK,MeshDepthMaterial:q2,MeshDistanceMaterial:G2,MeshBasicMaterial:Gu,MeshMatcapMaterial:BK,LineDashedMaterial:UK,LineBasicMaterial:is,Material:Ua};return new n[e]}}class q6{static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class Y2 extends bn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class JK extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=new zu(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(o){try{n(a.parse(JSON.parse(o)))}catch(l){i?i(l):tn(l),a.manager.itemError(e)}},r,i)}parse(e){const n={},r={};function i(f,m){if(n[m]!==void 0)return n[m];const b=f.interleavedBuffers[m],y=a(f,b.buffer),w=Vp(b.type,y),_=new M2(w,b.stride);return _.uuid=b.uuid,n[m]=_,_}function a(f,m){if(r[m]!==void 0)return r[m];const b=f.arrayBuffers[m],y=new Uint32Array(b).buffer;return r[m]=y,y}const s=e.isInstancedBufferGeometry?new Y2:new bn,o=e.data.index;if(o!==void 0){const f=Vp(o.type,o.array);s.setIndex(new Xn(f,1))}const l=e.data.attributes;for(const f in l){const m=l[f];let x;if(m.isInterleavedBufferAttribute){const b=i(e.data,m.data);x=new Gs(b,m.itemSize,m.offset,m.normalized)}else{const b=Vp(m.type,m.array),y=m.isInstancedBufferAttribute?Zh:Xn;x=new y(b,m.itemSize,m.normalized)}m.name!==void 0&&(x.name=m.name),m.usage!==void 0&&x.setUsage(m.usage),s.setAttribute(f,x)}const u=e.data.morphAttributes;if(u)for(const f in u){const m=u[f],x=[];for(let b=0,y=m.length;b<y;b++){const w=m[b];let _;if(w.isInterleavedBufferAttribute){const S=i(e.data,w.data);_=new Gs(S,w.itemSize,w.offset,w.normalized)}else{const S=Vp(w.type,w.array);_=new Xn(S,w.itemSize,w.normalized)}w.name!==void 0&&(_.name=w.name),x.push(_)}s.morphAttributes[f]=x}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let f=0,m=d.length;f!==m;++f){const x=d[f];s.addGroup(x.start,x.count,x.materialIndex)}const h=e.data.boundingSphere;return h!==void 0&&(s.boundingSphere=new Hi().fromJSON(h)),e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class w0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=this.path===""?q6.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new zu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let u=null;try{u=JSON.parse(l)}catch(d){i!==void 0&&i(d),d("ObjectLoader: Can't parse "+e+".",d.message);return}const c=u.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),tn("ObjectLoader: Can't load "+e);return}a.parse(u,n)},r,i)}async loadAsync(e,n){const r=this,i=this.path===""?q6.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const a=new zu(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const s=await a.loadAsync(e,n),o=JSON.parse(s),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,n){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){n!==void 0&&n(u)}),o=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,a,l,o,r),c=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,c),this.bindLightTargets(u),n!==void 0){let d=!1;for(const h in s)if(s[h].data instanceof HTMLImageElement){d=!0;break}d===!1&&n(u)}return u}async parseAsync(e){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,o,s,n),u=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,u),this.bindLightTargets(l),l}parseShapes(e){const n={};if(e!==void 0)for(let r=0,i=e.length;r<i;r++){const a=new Bh().fromJSON(e[r]);n[a.uuid]=a}return n}parseSkeletons(e,n){const r={},i={};if(n.traverse(function(a){a.isBone&&(i[a.uuid]=a)}),e!==void 0)for(let a=0,s=e.length;a<s;a++){const o=new A2().fromJSON(e[a],i);r[o.uuid]=o}return r}parseGeometries(e,n){const r={};if(e!==void 0){const i=new JK;for(let a=0,s=e.length;a<s;a++){let o;const l=e[a];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(l);break;default:l.type in pO?o=pO[l.type].fromJSON(l,n):Ut(`ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(e,n){const r={},i={};if(e!==void 0){const a=new W2;a.setTextures(n);for(let s=0,o=e.length;s<o;s++){const l=e[s];r[l.uuid]===void 0&&(r[l.uuid]=a.parse(l)),i[l.uuid]=r[l.uuid]}}return i}parseAnimations(e){const n={};if(e!==void 0)for(let r=0;r<e.length;r++){const i=e[r],a=E1.parse(i);n[a.uuid]=a}return n}parseImages(e,n){const r=this,i={};let a;function s(l){return r.manager.itemStart(l),a.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const u=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:r.resourcePath+u;return s(c)}else return l.data?{data:Vp(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new v8(n);a=new T1(l),a.setCrossOrigin(this.crossOrigin);for(let u=0,c=e.length;u<c;u++){const d=e[u],h=d.url;if(Array.isArray(h)){const f=[];for(let m=0,x=h.length;m<x;m++){const b=h[m],y=o(b);y!==null&&(y instanceof HTMLImageElement?f.push(y):f.push(new tl(y.data,y.width,y.height)))}i[d.uuid]=new qc(f)}else{const f=o(d.url);i[d.uuid]=new qc(f)}}}return i}async parseImagesAsync(e){const n=this,r={};let i;async function a(s){if(typeof s=="string"){const o=s,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:n.resourcePath+o;return await i.loadAsync(l)}else return s.data?{data:Vp(s.type,s.data),width:s.width,height:s.height}:null}if(e!==void 0&&e.length>0){i=new T1(this.manager),i.setCrossOrigin(this.crossOrigin);for(let s=0,o=e.length;s<o;s++){const l=e[s],u=l.url;if(Array.isArray(u)){const c=[];for(let d=0,h=u.length;d<h;d++){const f=u[d],m=await a(f);m!==null&&(m instanceof HTMLImageElement?c.push(m):c.push(new tl(m.data,m.width,m.height)))}r[l.uuid]=new qc(c)}else{const c=await a(l.url);r[l.uuid]=new qc(c)}}}return r}parseTextures(e,n){function r(a,s){return typeof a=="number"?a:(Ut("ObjectLoader.parseTexture: Constant should be in numeric form.",a),s[a])}const i={};if(e!==void 0)for(let a=0,s=e.length;a<s;a++){const o=e[a];o.image===void 0&&Ut('ObjectLoader: No "image" specified for',o.uuid),n[o.image]===void 0&&Ut("ObjectLoader: Undefined image",o.image);const l=n[o.image],u=l.data;let c;Array.isArray(u)?(c=new vv,u.length===6&&(c.needsUpdate=!0)):(u&&u.data?c=new tl:c=new hi,u&&(c.needsUpdate=!0)),c.source=l,c.uuid=o.uuid,o.name!==void 0&&(c.name=o.name),o.mapping!==void 0&&(c.mapping=r(o.mapping,S0e)),o.channel!==void 0&&(c.channel=o.channel),o.offset!==void 0&&c.offset.fromArray(o.offset),o.repeat!==void 0&&c.repeat.fromArray(o.repeat),o.center!==void 0&&c.center.fromArray(o.center),o.rotation!==void 0&&(c.rotation=o.rotation),o.wrap!==void 0&&(c.wrapS=r(o.wrap[0],vO),c.wrapT=r(o.wrap[1],vO)),o.format!==void 0&&(c.format=o.format),o.internalFormat!==void 0&&(c.internalFormat=o.internalFormat),o.type!==void 0&&(c.type=o.type),o.colorSpace!==void 0&&(c.colorSpace=o.colorSpace),o.minFilter!==void 0&&(c.minFilter=r(o.minFilter,yO)),o.magFilter!==void 0&&(c.magFilter=r(o.magFilter,yO)),o.anisotropy!==void 0&&(c.anisotropy=o.anisotropy),o.flipY!==void 0&&(c.flipY=o.flipY),o.generateMipmaps!==void 0&&(c.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(c.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(c.compareFunction=o.compareFunction),o.userData!==void 0&&(c.userData=o.userData),i[o.uuid]=c}return i}parseObject(e,n,r,i,a){let s;function o(h){return n[h]===void 0&&Ut("ObjectLoader: Undefined geometry",h),n[h]}function l(h){if(h!==void 0){if(Array.isArray(h)){const f=[];for(let m=0,x=h.length;m<x;m++){const b=h[m];r[b]===void 0&&Ut("ObjectLoader: Undefined material",b),f.push(r[b])}return f}return r[h]===void 0&&Ut("ObjectLoader: Undefined material",h),r[h]}}function u(h){return i[h]===void 0&&Ut("ObjectLoader: Undefined texture",h),i[h]}let c,d;switch(e.type){case"Scene":s=new t8,e.background!==void 0&&(Number.isInteger(e.background)?s.background=new zt(e.background):s.background=u(e.background)),e.environment!==void 0&&(s.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?s.fog=new C2(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(s.fog=new T2(e.fog.color,e.fog.density)),e.fog.name!==""&&(s.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(s.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(s.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&s.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(s.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&s.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":s=new Si(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(s.focus=e.focus),e.zoom!==void 0&&(s.zoom=e.zoom),e.filmGauge!==void 0&&(s.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(s.filmOffset=e.filmOffset),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new Ou(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(s.zoom=e.zoom),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new XK(e.color,e.intensity);break;case"DirectionalLight":s=new YK(e.color,e.intensity),s.target=e.target||"";break;case"PointLight":s=new WK(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new KK(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new GK(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),s.target=e.target||"";break;case"HemisphereLight":s=new qK(e.color,e.groundColor,e.intensity);break;case"LightProbe":const h=new x8().fromArray(e.sh);s=new ZK(h,e.intensity);break;case"SkinnedMesh":c=o(e.geometry),d=l(e.material),s=new mK(c,d),e.bindMode!==void 0&&(s.bindMode=e.bindMode),e.bindMatrix!==void 0&&s.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(s.skeleton=e.skeleton);break;case"Mesh":c=o(e.geometry),d=l(e.material),s=new Kr(c,d);break;case"InstancedMesh":c=o(e.geometry),d=l(e.material);const f=e.count,m=e.instanceMatrix,x=e.instanceColor;s=new gK(c,d,f),s.instanceMatrix=new Zh(new Float32Array(m.array),16),x!==void 0&&(s.instanceColor=new Zh(new Float32Array(x.array),x.itemSize));break;case"BatchedMesh":c=o(e.geometry),d=l(e.material),s=new vK(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,d),s.geometry=c,s.perObjectFrustumCulled=e.perObjectFrustumCulled,s.sortObjects=e.sortObjects,s._drawRanges=e.drawRanges,s._reservedRanges=e.reservedRanges,s._geometryInfo=e.geometryInfo.map(b=>{let y=null,w=null;return b.boundingBox!==void 0&&(y=new Ai().fromJSON(b.boundingBox)),b.boundingSphere!==void 0&&(w=new Hi().fromJSON(b.boundingSphere)),{...b,boundingBox:y,boundingSphere:w}}),s._instanceInfo=e.instanceInfo,s._availableInstanceIds=e._availableInstanceIds,s._availableGeometryIds=e._availableGeometryIds,s._nextIndexStart=e.nextIndexStart,s._nextVertexStart=e.nextVertexStart,s._geometryCount=e.geometryCount,s._maxInstanceCount=e.maxInstanceCount,s._maxVertexCount=e.maxVertexCount,s._maxIndexCount=e.maxIndexCount,s._geometryInitialized=e.geometryInitialized,s._matricesTexture=u(e.matricesTexture.uuid),s._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(s._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(s.boundingSphere=new Hi().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(s.boundingBox=new Ai().fromJSON(e.boundingBox));break;case"LOD":s=new pK;break;case"Line":s=new nd(o(e.geometry),l(e.material));break;case"LineLoop":s=new yK(o(e.geometry),l(e.material));break;case"LineSegments":s=new Yl(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new xK(o(e.geometry),l(e.material));break;case"Sprite":s=new fK(l(e.material));break;case"Group":s=new qp;break;case"Bone":s=new r8;break;default:s=new nr}if(s.uuid=e.uuid,e.name!==void 0&&(s.name=e.name),e.matrix!==void 0?(s.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(e.position!==void 0&&s.position.fromArray(e.position),e.rotation!==void 0&&s.rotation.fromArray(e.rotation),e.quaternion!==void 0&&s.quaternion.fromArray(e.quaternion),e.scale!==void 0&&s.scale.fromArray(e.scale)),e.up!==void 0&&s.up.fromArray(e.up),e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(s.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(s.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(s.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(s.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(s.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(s.visible=e.visible),e.frustumCulled!==void 0&&(s.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(s.renderOrder=e.renderOrder),e.userData!==void 0&&(s.userData=e.userData),e.layers!==void 0&&(s.layers.mask=e.layers),e.children!==void 0){const h=e.children;for(let f=0;f<h.length;f++)s.add(this.parseObject(h[f],n,r,i,a))}if(e.animations!==void 0){const h=e.animations;for(let f=0;f<h.length;f++){const m=h[f];s.animations.push(a[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(s.autoUpdate=e.autoUpdate);const h=e.levels;for(let f=0;f<h.length;f++){const m=h[f],x=s.getObjectByProperty("uuid",m.object);x!==void 0&&s.addLevel(x,m.distance,m.hysteresis)}}return s}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const i=n[r.skeleton];i===void 0?Ut("ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(i,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(n){if(n.isDirectionalLight||n.isSpotLight){const r=n.target,i=e.getObjectByProperty("uuid",r);i!==void 0?n.target=i:n.target=new nr}})}}const S0e={UVMapping:h2,CubeReflectionMapping:Hl,CubeRefractionMapping:Qc,EquirectangularReflectionMapping:l1,EquirectangularRefractionMapping:u1,CubeUVReflectionMapping:U0},vO={RepeatWrapping:c1,ClampToEdgeWrapping:bs,MirroredRepeatWrapping:d1},yO={NearestFilter:Ti,NearestMipmapNearestFilter:jN,NearestMipmapLinearFilter:$p,LinearFilter:Pr,LinearMipmapNearestFilter:Ng,LinearMipmapLinearFilter:Il},cE=new WeakMap;class E0e extends Es{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Ut("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Ut("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,n,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,s=Nl.get(`image-bitmap:${e}`);if(s!==void 0){if(a.manager.itemStart(e),s.then){s.then(u=>{if(cE.has(s)===!0)i&&i(cE.get(s)),a.manager.itemError(e),a.manager.itemEnd(e);else return n&&n(u),a.manager.itemEnd(e),u});return}return setTimeout(function(){n&&n(s),a.manager.itemEnd(e)},0),s}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(u){return Nl.add(`image-bitmap:${e}`,u),n&&n(u),a.manager.itemEnd(e),u}).catch(function(u){i&&i(u),cE.set(l,u),Nl.remove(`image-bitmap:${e}`),a.manager.itemError(e),a.manager.itemEnd(e)});Nl.add(`image-bitmap:${e}`,l),a.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let Ix;class b8{static getContext(){return Ix===void 0&&(Ix=new(window.AudioContext||window.webkitAudioContext)),Ix}static setContext(e){Ix=e}}class T0e extends Es{constructor(e){super(e)}load(e,n,r,i){const a=this,s=new zu(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(l){try{const u=l.slice(0);b8.getContext().decodeAudioData(u,function(d){n(d)}).catch(o)}catch(u){o(u)}},r,i);function o(l){i?i(l):tn(l),a.manager.itemError(e)}}}const xO=new fn,bO=new fn,Zd=new fn;class C0e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Si,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Si,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,Zd.copy(e.projectionMatrix);const i=n.eyeSep/2,a=i*n.near/n.focus,s=n.near*Math.tan(Fh*n.fov*.5)/n.zoom;let o,l;bO.elements[12]=-i,xO.elements[12]=i,o=-s*n.aspect+a,l=s*n.aspect+a,Zd.elements[0]=2*n.near/(l-o),Zd.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Zd),o=-s*n.aspect-a,l=s*n.aspect-a,Zd.elements[0]=2*n.near/(l-o),Zd.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Zd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(bO),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(xO)}}class QK extends Si{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class _8{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=performance.now();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}const Jd=new we,dE=new xa,M0e=new we,Qd=new we,eh=new we;class A0e extends nr{constructor(){super(),this.type="AudioListener",this.context=b8.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _8}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Jd,dE,M0e),Qd.set(0,0,-1).applyQuaternion(dE),eh.set(0,1,0).applyQuaternion(dE),n.positionX){const r=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Jd.x,r),n.positionY.linearRampToValueAtTime(Jd.y,r),n.positionZ.linearRampToValueAtTime(Jd.z,r),n.forwardX.linearRampToValueAtTime(Qd.x,r),n.forwardY.linearRampToValueAtTime(Qd.y,r),n.forwardZ.linearRampToValueAtTime(Qd.z,r),n.upX.linearRampToValueAtTime(eh.x,r),n.upY.linearRampToValueAtTime(eh.y,r),n.upZ.linearRampToValueAtTime(eh.z,r)}else n.setPosition(Jd.x,Jd.y,Jd.z),n.setOrientation(Qd.x,Qd.y,Qd.z,eh.x,eh.y,eh.z)}}class eZ extends nr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Ut("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Ut("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Ut("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Ut("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Ut("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Ut("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Ut("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,n){return super.copy(e,n),e.sourceType!=="buffer"?(Ut("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const th=new we,_O=new xa,k0e=new we,nh=new we;class I0e extends eZ{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(th,_O,k0e),nh.set(0,0,1).applyQuaternion(_O);const n=this.panner;if(n.positionX){const r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(th.x,r),n.positionY.linearRampToValueAtTime(th.y,r),n.positionZ.linearRampToValueAtTime(th.z,r),n.orientationX.linearRampToValueAtTime(nh.x,r),n.orientationY.linearRampToValueAtTime(nh.y,r),n.orientationZ.linearRampToValueAtTime(nh.z,r)}else n.setPosition(th.x,th.y,th.z),n.setOrientation(nh.x,nh.y,nh.z)}}class N0e{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let r=0;r<n.length;r++)e+=n[r];return e/n.length}}class tZ{constructor(e,n,r){this.binding=e,this.valueSize=r;let i,a,s;switch(n){case"quaternion":i=this._slerp,a=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,a=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,a=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=a,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const r=this.buffer,i=this.valueSize,a=e*i+i;let s=this.cumulativeWeight;if(s===0){for(let o=0;o!==i;++o)r[a+o]=r[o];s=n}else{s+=n;const o=n/s;this._mixBufferRegion(r,a,0,o,i)}this.cumulativeWeight=s}accumulateAdditive(e){const n=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,r=this.buffer,i=e*n+n,a=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const l=n*this._origIndex;this._mixBufferRegion(r,i,l,1-a,n)}s>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*n,1,n);for(let l=n,u=n+n;l!==u;++l)if(r[l]!==r[l+n]){o.setValue(r,i);break}}saveOriginalState(){const e=this.binding,n=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(n,i);for(let a=r,s=i;a!==s;++a)n[a]=n[i+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let r=e;r<n;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[n+r]=this.buffer[e+r]}_select(e,n,r,i,a){if(i>=.5)for(let s=0;s!==a;++s)e[n+s]=e[r+s]}_slerp(e,n,r,i){xa.slerpFlat(e,n,e,n,e,r,i)}_slerpAdditive(e,n,r,i,a){const s=this._workIndex*a;xa.multiplyQuaternionsFlat(e,s,e,n,e,r),xa.slerpFlat(e,n,e,n,e,s,i)}_lerp(e,n,r,i,a){const s=1-i;for(let o=0;o!==a;++o){const l=n+o;e[l]=e[l]*s+e[r+o]*i}}_lerpAdditive(e,n,r,i,a){for(let s=0;s!==a;++s){const o=n+s;e[o]=e[o]+e[r+s]*i}}}const w8="\\[\\]\\.:\\/",R0e=new RegExp("["+w8+"]","g"),S8="[^"+w8+"]",P0e="[^"+w8.replace("\\.","")+"]",D0e=/((?:WC+[\/:])*)/.source.replace("WC",S8),O0e=/(WCOD+)?/.source.replace("WCOD",P0e),L0e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",S8),F0e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",S8),B0e=new RegExp("^"+D0e+O0e+L0e+F0e+"$"),U0e=["material","materials","bones","map"];class z0e{constructor(e,n,r){const i=r||ir.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,i)}getValue(e,n){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,n)}setValue(e,n){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,a=r.length;i!==a;++i)r[i].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].unbind()}}class ir{constructor(e,n,r){this.path=n,this.parsedPath=r||ir.parseTrackName(n),this.node=ir.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new ir.Composite(e,n,r):new ir(e,n,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(R0e,"")}static parseTrackName(e){const n=B0e.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const a=r.nodeName.substring(i+1);U0e.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(n);if(r!==void 0)return r}if(e.children){const r=function(a){for(let s=0;s<a.length;s++){const o=a[s];if(o.name===n||o.uuid===n)return o;const l=r(o.children);if(l)return l}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const r=this.resolvedProperty;for(let i=0,a=r.length;i!==a;++i)e[n++]=r[i]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const r=this.resolvedProperty;for(let i=0,a=r.length;i!==a;++i)r[i]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const r=this.resolvedProperty;for(let i=0,a=r.length;i!==a;++i)r[i]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const r=this.resolvedProperty;for(let i=0,a=r.length;i!==a;++i)r[i]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,r=n.objectName,i=n.propertyName;let a=n.propertyIndex;if(e||(e=ir.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Ut("PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let u=n.objectIndex;switch(r){case"materials":if(!e.material){tn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){tn("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){tn("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===u){u=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){tn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){tn("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){tn("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(u!==void 0){if(e[u]===void 0){tn("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const s=e[i];if(s===void 0){const u=n.nodeName;tn("PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(a!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){tn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){tn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ir.Composite=z0e;ir.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ir.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ir.prototype.GetterByBindingType=[ir.prototype._getValue_direct,ir.prototype._getValue_array,ir.prototype._getValue_arrayElement,ir.prototype._getValue_toArray];ir.prototype.SetterByBindingTypeAndVersioning=[[ir.prototype._setValue_direct,ir.prototype._setValue_direct_setNeedsUpdate,ir.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ir.prototype._setValue_array,ir.prototype._setValue_array_setNeedsUpdate,ir.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ir.prototype._setValue_arrayElement,ir.prototype._setValue_arrayElement_setNeedsUpdate,ir.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ir.prototype._setValue_fromArray,ir.prototype._setValue_fromArray_setNeedsUpdate,ir.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class j0e{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ws(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,r=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length;let o,l=e.length,u=this.nCachedObjects_;for(let c=0,d=arguments.length;c!==d;++c){const h=arguments[c],f=h.uuid;let m=n[f];if(m===void 0){m=l++,n[f]=m,e.push(h);for(let x=0,b=s;x!==b;++x)a[x].push(new ir(h,r[x],i[x]))}else if(m<u){o=e[m];const x=--u,b=e[x];n[b.uuid]=m,e[m]=b,n[f]=x,e[x]=h;for(let y=0,w=s;y!==w;++y){const _=a[y],S=_[x];let M=_[m];_[m]=S,M===void 0&&(M=new ir(h,r[y],i[y])),_[x]=M}}else e[m]!==o&&tn("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length;let a=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const l=arguments[s],u=l.uuid,c=n[u];if(c!==void 0&&c>=a){const d=a++,h=e[d];n[h.uuid]=c,e[c]=h,n[u]=d,e[d]=l;for(let f=0,m=i;f!==m;++f){const x=r[f],b=x[d],y=x[c];x[c]=b,x[d]=y}}}this.nCachedObjects_=a}uncache(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length;let a=this.nCachedObjects_,s=e.length;for(let o=0,l=arguments.length;o!==l;++o){const u=arguments[o],c=u.uuid,d=n[c];if(d!==void 0)if(delete n[c],d<a){const h=--a,f=e[h],m=--s,x=e[m];n[f.uuid]=d,e[d]=f,n[x.uuid]=h,e[h]=x,e.pop();for(let b=0,y=i;b!==y;++b){const w=r[b],_=w[h],S=w[m];w[d]=_,w[h]=S,w.pop()}}else{const h=--s,f=e[h];h>0&&(n[f.uuid]=d),e[d]=f,e.pop();for(let m=0,x=i;m!==x;++m){const b=r[m];b[d]=b[h],b.pop()}}}this.nCachedObjects_=a}subscribe_(e,n){const r=this._bindingsIndicesByPath;let i=r[e];const a=this._bindings;if(i!==void 0)return a[i];const s=this._paths,o=this._parsedPaths,l=this._objects,u=l.length,c=this.nCachedObjects_,d=new Array(u);i=a.length,r[e]=i,s.push(e),o.push(n),a.push(d);for(let h=c,f=l.length;h!==f;++h){const m=l[h];d[h]=new ir(m,e,n)}return d}unsubscribe_(e){const n=this._bindingsIndicesByPath,r=n[e];if(r!==void 0){const i=this._paths,a=this._parsedPaths,s=this._bindings,o=s.length-1,l=s[o],u=e[o];n[u]=r,s[r]=l,s.pop(),a[r]=a[o],a.pop(),i[r]=i[o],i.pop()}}}class nZ{constructor(e,n,r=null,i=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=r,this.blendMode=i;const a=n.tracks,s=a.length,o=new Array(s),l={endingStart:Sh,endingEnd:Sh};for(let u=0;u!==s;++u){const c=a[u].createInterpolant(null);o[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=YX,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,r=!1){if(e.fadeOut(n),this.fadeIn(n),r===!0){const i=this._clip.duration,a=e._clip.duration,s=a/i,o=i/a;e.warp(1,s,n),this.warp(o,1,n)}return this}crossFadeTo(e,n,r=!1){return e.crossFadeFrom(this,n,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,r){const i=this._mixer,a=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,u=o.sampleValues;return l[0]=a,l[1]=a+r,u[0]=e/s,u[1]=n/s,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,r,i){if(!this.enabled){this._updateWeight(e);return}const a=this._startTime;if(a!==null){const l=(e-a)*r;l<0||r===0?n=0:(this._startTime=null,n=r*l)}n*=this._updateTimeScale(e);const s=this._updateTime(n),o=this._updateWeight(e);if(o>0){const l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case YN:for(let c=0,d=l.length;c!==d;++c)l[c].evaluate(s),u[c].accumulateAdditive(o);break;case x2:default:for(let c=0,d=l.length;c!==d;++c)l[c].evaluate(s),u[c].accumulate(i,o)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];n*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const i=r.evaluate(e)[0];n*=i,e>r.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,r=this.loop;let i=this.time+e,a=this._loopCount;const s=r===XX;if(e===0)return a===-1?i:s&&(a&1)===1?n-i:i;if(r===WX){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=n)i=n;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=n||i<0){const o=Math.floor(i/n);i-=n*o,a+=Math.abs(o);const l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?n:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const u=e<0;this._setEndings(u,!u,s)}else this._setEndings(!1,!1,s);this._loopCount=a,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(s&&(a&1)===1)return n-i}return i}_setEndings(e,n,r){const i=this._interpolantSettings;r?(i.endingStart=Eh,i.endingEnd=Eh):(e?i.endingStart=this.zeroSlopeAtStart?Eh:Sh:i.endingStart=f1,n?i.endingEnd=this.zeroSlopeAtEnd?Eh:Sh:i.endingEnd=f1)}_scheduleFading(e,n,r){const i=this._mixer,a=i.time;let s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=a,l[0]=n,o[1]=a+e,l[1]=r,this}}const H0e=new Float32Array(1);class $0e extends Wl{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const r=e._localRoot||this._root,i=e._clip.tracks,a=i.length,s=e._propertyBindings,o=e._interpolants,l=r.uuid,u=this._bindingsByRootAndName;let c=u[l];c===void 0&&(c={},u[l]=c);for(let d=0;d!==a;++d){const h=i[d],f=h.name;let m=c[f];if(m!==void 0)++m.referenceCount,s[d]=m;else{if(m=s[d],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,f));continue}const x=n&&n._propertyBindings[d].binding.parsedPath;m=new tZ(ir.create(r,f,x),h.ValueTypeName,h.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,f),s[d]=m}o[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,a=this._actionsByClip[i];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,i,r)}const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const a=n[r];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const a=n[r];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,r){const i=this._actions,a=this._actionsByClip;let s=a[n];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[n]=s;else{const o=s.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){const n=this._actions,r=n[n.length-1],i=e._cacheIndex;r._cacheIndex=i,n[i]=r,n.pop(),e._cacheIndex=null;const a=e._clip.uuid,s=this._actionsByClip,o=s[a],l=o.knownActions,u=l[l.length-1],c=e._byClipCacheIndex;u._byClipCacheIndex=c,l[c]=u,l.pop(),e._byClipCacheIndex=null;const d=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete d[h],l.length===0&&delete s[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let r=0,i=n.length;r!==i;++r){const a=n[r];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(e){const n=this._actions,r=e._cacheIndex,i=this._nActiveActions++,a=n[i];e._cacheIndex=i,n[i]=e,a._cacheIndex=r,n[r]=a}_takeBackAction(e){const n=this._actions,r=e._cacheIndex,i=--this._nActiveActions,a=n[i];e._cacheIndex=i,n[i]=e,a._cacheIndex=r,n[r]=a}_addInactiveBinding(e,n,r){const i=this._bindingsByRootAndName,a=this._bindings;let s=i[n];s===void 0&&(s={},i[n]=s),s[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const n=this._bindings,r=e.binding,i=r.rootNode.uuid,a=r.path,s=this._bindingsByRootAndName,o=s[i],l=n[n.length-1],u=e._cacheIndex;l._cacheIndex=u,n[u]=l,n.pop(),delete o[a],Object.keys(o).length===0&&delete s[i]}_lendBinding(e){const n=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,a=n[i];e._cacheIndex=i,n[i]=e,a._cacheIndex=r,n[r]=a}_takeBackBinding(e){const n=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,a=n[i];e._cacheIndex=i,n[i]=e,a._cacheIndex=r,n[r]=a}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let r=e[n];return r===void 0&&(r=new m8(new Float32Array(2),new Float32Array(2),1,H0e),r.__cacheIndex=n,e[n]=r),r}_takeBackControlInterpolant(e){const n=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,a=n[i];e.__cacheIndex=i,n[i]=e,a.__cacheIndex=r,n[r]=a}clipAction(e,n,r){const i=n||this._root,a=i.uuid;let s=typeof e=="string"?E1.findByName(i,e):e;const o=s!==null?s.uuid:e,l=this._actionsByClip[o];let u=null;if(r===void 0&&(s!==null?r=s.blendMode:r=x2),l!==void 0){const d=l.actionByRoot[a];if(d!==void 0&&d.blendMode===r)return d;u=l.knownActions[0],s===null&&(s=u._clip)}if(s===null)return null;const c=new nZ(this,s,n,r);return this._bindAction(c,u),this._addInactiveAction(c,o,a),c}existingAction(e,n){const r=n||this._root,i=r.uuid,a=typeof e=="string"?E1.findByName(r,e):e,s=a?a.uuid:e,o=this._actionsByClip[s];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let r=n-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const n=this._actions,r=this._nActiveActions,i=this.time+=e,a=Math.sign(e),s=this._accuIndex^=1;for(let u=0;u!==r;++u)n[u]._update(i,e,a,s);const o=this._bindings,l=this._nActiveBindings;for(let u=0;u!==l;++u)o[u].apply(s);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,r=e.uuid,i=this._actionsByClip,a=i[r];if(a!==void 0){const s=a.knownActions;for(let o=0,l=s.length;o!==l;++o){const u=s[o];this._deactivateAction(u);const c=u._cacheIndex,d=n[n.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,d._cacheIndex=c,n[c]=d,n.pop(),this._removeInactiveBindingsForAction(u)}delete i[r]}}uncacheRoot(e){const n=e.uuid,r=this._actionsByClip;for(const s in r){const o=r[s].actionByRoot,l=o[n];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const i=this._bindingsByRootAndName,a=i[n];if(a!==void 0)for(const s in a){const o=a[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,n){const r=this.existingAction(e,n);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class V0e extends ZN{constructor(e=1,n=1,r=1,i={}){super(e,n,i),this.isRenderTarget3D=!0,this.depth=r,this.texture=new S2(null,e,n,r),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class E8{constructor(e){this.value=e}clone(){return new E8(this.value.clone===void 0?this.value:this.value.clone())}}let q0e=0;class G0e extends Wl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:q0e++}),this.name="",this.usage=m1,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let r=0,i=n.length;r<i;r++){const a=Array.isArray(n[r])?n[r]:[n[r]];for(let s=0;s<a.length;s++)this.uniforms.push(a[s].clone())}return this}clone(){return new this.constructor().copy(this)}}class tw extends M2{constructor(e,n,r=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class W0e{constructor(e,n,r,i,a,s=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=r,this.elementSize=i,this.count=a,this.normalized=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const wO=new fn;class T8{constructor(e,n,r=0,i=1/0){this.ray=new ff(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new h0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):tn("Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return wO.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(wO),this}intersectObject(e,n=!0,r=[]){return G6(e,this,r,n),r.sort(SO),r}intersectObjects(e,n=!0,r=[]){for(let i=0,a=e.length;i<a;i++)G6(e[i],this,r,n);return r.sort(SO),r}}function SO(t,e){return t.distance-e.distance}function G6(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const a=t.children;for(let s=0,o=a.length;s<o;s++)G6(a[s],e,n,!0)}}let Y0e=class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=X0e.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}};function X0e(){this._document.hidden===!1&&this.reset()}class W6{constructor(e=1,n=0,r=0){this.radius=e,this.phi=n,this.theta=r}set(e,n,r){return this.radius=e,this.phi=n,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=gn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+n*n+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(gn(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class K0e{constructor(e=1,n=0,r=0){this.radius=e,this.theta=n,this.y=r}set(e,n,r){return this.radius=e,this.theta=n,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=n,this}clone(){return new this.constructor().copy(this)}}class C8{constructor(e,n,r,i){C8.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,n,r,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,n=0){for(let r=0;r<4;r++)this.elements[r]=e[r+n];return this}set(e,n,r,i){const a=this.elements;return a[0]=e,a[2]=n,a[1]=r,a[3]=i,this}}const EO=new dt;class Z0e{constructor(e=new dt(1/0,1/0),n=new dt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=EO.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,EO).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const TO=new we,Nx=new we,Mp=new we,Ap=new we,hE=new we,J0e=new we,Q0e=new we;class rZ{constructor(e=new we,n=new we){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){TO.subVectors(e,this.start),Nx.subVectors(this.end,this.start);const r=Nx.dot(Nx);let a=Nx.dot(TO)/r;return n&&(a=gn(a,0,1)),a}closestPointToPoint(e,n,r){const i=this.closestPointToPointParameter(e,n);return this.delta(r).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,n=J0e,r=Q0e){const i=10000000000000001e-32;let a,s;const o=this.start,l=e.start,u=this.end,c=e.end;Mp.subVectors(u,o),Ap.subVectors(c,l),hE.subVectors(o,l);const d=Mp.dot(Mp),h=Ap.dot(Ap),f=Ap.dot(hE);if(d<=i&&h<=i)return n.copy(o),r.copy(l),n.sub(r),n.dot(n);if(d<=i)a=0,s=f/h,s=gn(s,0,1);else{const m=Mp.dot(hE);if(h<=i)s=0,a=gn(-m/d,0,1);else{const x=Mp.dot(Ap),b=d*h-x*x;b!==0?a=gn((x*f-m*h)/b,0,1):a=0,s=(x*a+f)/h,s<0?(s=0,a=gn(-m/d,0,1)):s>1&&(s=1,a=gn((x-m)/d,0,1))}}return n.copy(o).add(Mp.multiplyScalar(a)),r.copy(l).add(Ap.multiplyScalar(s)),n.sub(r),n.dot(n)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const CO=new we;class eme extends nr{constructor(e,n){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const r=new bn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,o=1,l=32;s<l;s++,o++){const u=s/l*Math.PI*2,c=o/l*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}r.setAttribute("position",new Wt(i,3));const a=new is({fog:!1,toneMapped:!1});this.cone=new Yl(r,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),CO.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(CO),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ac=new we,Rx=new fn,fE=new fn;class tme extends Yl{constructor(e){const n=iZ(e),r=new bn,i=[],a=[];for(let u=0;u<n.length;u++){const c=n[u];c.parent&&c.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),a.push(0,0,0),a.push(0,0,0))}r.setAttribute("position",new Wt(i,3)),r.setAttribute("color",new Wt(a,3));const s=new is({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,s),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new zt(255),l=new zt(65280);this.setColors(o,l)}updateMatrixWorld(e){const n=this.bones,r=this.geometry,i=r.getAttribute("position");fE.copy(this.root.matrixWorld).invert();for(let a=0,s=0;a<n.length;a++){const o=n[a];o.parent&&o.parent.isBone&&(Rx.multiplyMatrices(fE,o.matrixWorld),Ac.setFromMatrixPosition(Rx),i.setXYZ(s,Ac.x,Ac.y,Ac.z),Rx.multiplyMatrices(fE,o.parent.matrixWorld),Ac.setFromMatrixPosition(Rx),i.setXYZ(s+1,Ac.x,Ac.y,Ac.z),s+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,n){const i=this.geometry.getAttribute("color");for(let a=0;a<i.count;a+=2)i.setXYZ(a,e.r,e.g,e.b),i.setXYZ(a+1,n.r,n.g,n.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function iZ(t){const e=[];t.isBone===!0&&e.push(t);for(let n=0;n<t.children.length;n++)e.push(...iZ(t.children[n]));return e}class nme extends Kr{constructor(e,n,r){const i=new _v(n,4,2),a=new Gu({wireframe:!0,fog:!1,toneMapped:!1});super(i,a),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const rme=new we,MO=new zt,AO=new zt;class ime extends nr{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new bv(n);i.rotateY(Math.PI*.5),this.material=new Gu({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const a=i.getAttribute("position"),s=new Float32Array(a.count*3);i.setAttribute("color",new Xn(s,3)),this.add(new Kr(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");MO.copy(this.light.color),AO.copy(this.light.groundColor);for(let r=0,i=n.count;r<i;r++){const a=r<i/2?MO:AO;n.setXYZ(r,a.r,a.g,a.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(rme.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ame extends Yl{constructor(e=10,n=10,r=4473924,i=8947848){r=new zt(r),i=new zt(i);const a=n/2,s=e/n,o=e/2,l=[],u=[];for(let h=0,f=0,m=-o;h<=n;h++,m+=s){l.push(-o,0,m,o,0,m),l.push(m,0,-o,m,0,o);const x=h===a?r:i;x.toArray(u,f),f+=3,x.toArray(u,f),f+=3,x.toArray(u,f),f+=3,x.toArray(u,f),f+=3}const c=new bn;c.setAttribute("position",new Wt(l,3)),c.setAttribute("color",new Wt(u,3));const d=new is({vertexColors:!0,toneMapped:!1});super(c,d),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class sme extends Yl{constructor(e=10,n=16,r=8,i=64,a=4473924,s=8947848){a=new zt(a),s=new zt(s);const o=[],l=[];if(n>1)for(let d=0;d<n;d++){const h=d/n*(Math.PI*2),f=Math.sin(h)*e,m=Math.cos(h)*e;o.push(0,0,0),o.push(f,0,m);const x=d&1?a:s;l.push(x.r,x.g,x.b),l.push(x.r,x.g,x.b)}for(let d=0;d<r;d++){const h=d&1?a:s,f=e-e/r*d;for(let m=0;m<i;m++){let x=m/i*(Math.PI*2),b=Math.sin(x)*f,y=Math.cos(x)*f;o.push(b,0,y),l.push(h.r,h.g,h.b),x=(m+1)/i*(Math.PI*2),b=Math.sin(x)*f,y=Math.cos(x)*f,o.push(b,0,y),l.push(h.r,h.g,h.b)}}const u=new bn;u.setAttribute("position",new Wt(o,3)),u.setAttribute("color",new Wt(l,3));const c=new is({vertexColors:!0,toneMapped:!1});super(u,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const kO=new we,Px=new we,IO=new we;class ome extends nr{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",n===void 0&&(n=1);let i=new bn;i.setAttribute("position",new Wt([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const a=new is({fog:!1,toneMapped:!1});this.lightPlane=new nd(i,a),this.add(this.lightPlane),i=new bn,i.setAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new nd(i,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),kO.setFromMatrixPosition(this.light.matrixWorld),Px.setFromMatrixPosition(this.light.target.matrixWorld),IO.subVectors(Px,kO),this.lightPlane.lookAt(Px),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Px),this.targetLine.scale.z=IO.length()}}const Dx=new we,vi=new E2;class lme extends Yl{constructor(e){const n=new bn,r=new is({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],a=[],s={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(m,x){l(m),l(x)}function l(m){i.push(0,0,0),a.push(0,0,0),s[m]===void 0&&(s[m]=[]),s[m].push(i.length/3-1)}n.setAttribute("position",new Wt(i,3)),n.setAttribute("color",new Wt(a,3)),super(n,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const u=new zt(16755200),c=new zt(16711680),d=new zt(43775),h=new zt(16777215),f=new zt(3355443);this.setColors(u,c,d,h,f)}setColors(e,n,r,i,a){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,n.r,n.g,n.b),o.setXYZ(25,n.r,n.g,n.b),o.setXYZ(26,n.r,n.g,n.b),o.setXYZ(27,n.r,n.g,n.b),o.setXYZ(28,n.r,n.g,n.b),o.setXYZ(29,n.r,n.g,n.b),o.setXYZ(30,n.r,n.g,n.b),o.setXYZ(31,n.r,n.g,n.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,a.r,a.g,a.b),o.setXYZ(41,a.r,a.g,a.b),o.setXYZ(42,a.r,a.g,a.b),o.setXYZ(43,a.r,a.g,a.b),o.setXYZ(44,a.r,a.g,a.b),o.setXYZ(45,a.r,a.g,a.b),o.setXYZ(46,a.r,a.g,a.b),o.setXYZ(47,a.r,a.g,a.b),o.setXYZ(48,a.r,a.g,a.b),o.setXYZ(49,a.r,a.g,a.b),o.needsUpdate=!0,this}update(){const e=this.geometry,n=this.pointMap,r=1,i=1;let a,s;if(vi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)a=1,s=0;else if(this.camera.coordinateSystem===qs)a=-1,s=1;else if(this.camera.coordinateSystem===u0)a=0,s=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);_i("c",n,e,vi,0,0,a),_i("t",n,e,vi,0,0,s),_i("n1",n,e,vi,-r,-i,a),_i("n2",n,e,vi,r,-i,a),_i("n3",n,e,vi,-r,i,a),_i("n4",n,e,vi,r,i,a),_i("f1",n,e,vi,-r,-i,s),_i("f2",n,e,vi,r,-i,s),_i("f3",n,e,vi,-r,i,s),_i("f4",n,e,vi,r,i,s),_i("u1",n,e,vi,r*.7,i*1.1,a),_i("u2",n,e,vi,-r*.7,i*1.1,a),_i("u3",n,e,vi,0,i*2,a),_i("cf1",n,e,vi,-r,0,s),_i("cf2",n,e,vi,r,0,s),_i("cf3",n,e,vi,0,-i,s),_i("cf4",n,e,vi,0,i,s),_i("cn1",n,e,vi,-r,0,a),_i("cn2",n,e,vi,r,0,a),_i("cn3",n,e,vi,0,-i,a),_i("cn4",n,e,vi,0,i,a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function _i(t,e,n,r,i,a,s){Dx.set(i,a,s).unproject(r);const o=e[t];if(o!==void 0){const l=n.getAttribute("position");for(let u=0,c=o.length;u<c;u++)l.setXYZ(o[u],Dx.x,Dx.y,Dx.z)}}const Ox=new Ai;class ume extends Yl{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),a=new bn;a.setIndex(new Xn(r,1)),a.setAttribute("position",new Xn(i,3)),super(a,new is({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&Ox.setFromObject(this.object),Ox.isEmpty())return;const e=Ox.min,n=Ox.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class cme extends Yl{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new bn;a.setIndex(new Xn(r,1)),a.setAttribute("position",new Wt(i,3)),super(a,new is({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class dme extends nd{constructor(e,n=1,r=16776960){const i=r,a=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],s=new bn;s.setAttribute("position",new Wt(a,3)),s.computeBoundingSphere(),super(s,new is({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new bn;l.setAttribute("position",new Wt(o,3)),l.computeBoundingSphere(),this.add(new Kr(l,new Gu({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const NO=new we;let Lx,pE;class hme extends nr{constructor(e=new we(0,0,1),n=new we(0,0,0),r=1,i=16776960,a=r*.2,s=a*.2){super(),this.type="ArrowHelper",Lx===void 0&&(Lx=new bn,Lx.setAttribute("position",new Wt([0,0,0,0,1,0],3)),pE=new xv(.5,1,5,1),pE.translate(0,-.5,0)),this.position.copy(n),this.line=new nd(Lx,new is({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kr(pE,new Gu({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,a,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{NO.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(NO,n)}}setLength(e,n=e*.2,r=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(r,n,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class fme extends Yl{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new bn;i.setAttribute("position",new Wt(n,3)),i.setAttribute("color",new Wt(r,3));const a=new is({vertexColors:!0,toneMapped:!1});super(i,a),this.type="AxesHelper"}setColors(e,n,r){const i=new zt,a=this.geometry.attributes.color.array;return i.set(e),i.toArray(a,0),i.toArray(a,3),i.set(n),i.toArray(a,6),i.toArray(a,9),i.set(r),i.toArray(a,12),i.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class pme{constructor(){this.type="ShapePath",this.color=new zt,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new ew,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,r,i){return this.currentPath.quadraticCurveTo(e,n,r,i),this}bezierCurveTo(e,n,r,i,a,s){return this.currentPath.bezierCurveTo(e,n,r,i,a,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(y){const w=[];for(let _=0,S=y.length;_<S;_++){const M=y[_],E=new Bh;E.curves=M.curves,w.push(E)}return w}function r(y,w){const _=w.length;let S=!1;for(let M=_-1,E=0;E<_;M=E++){let C=w[M],R=w[E],k=R.x-C.x,I=R.y-C.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(C=w[E],k=-k,R=w[M],I=-I),y.y<C.y||y.y>R.y)continue;if(y.y===C.y){if(y.x===C.x)return!0}else{const N=I*(y.x-C.x)-k*(y.y-C.y);if(N===0)return!0;if(N<0)continue;S=!S}}else{if(y.y!==C.y)continue;if(R.x<=y.x&&y.x<=C.x||C.x<=y.x&&y.x<=R.x)return!0}}return S}const i=Ko.isClockWise,a=this.subPaths;if(a.length===0)return[];let s,o,l;const u=[];if(a.length===1)return o=a[0],l=new Bh,l.curves=o.curves,u.push(l),u;let c=!i(a[0].getPoints());c=e?!c:c;const d=[],h=[];let f=[],m=0,x;h[m]=void 0,f[m]=[];for(let y=0,w=a.length;y<w;y++)o=a[y],x=o.getPoints(),s=i(x),s=e?!s:s,s?(!c&&h[m]&&m++,h[m]={s:new Bh,p:x},h[m].s.curves=o.curves,c&&m++,f[m]=[]):f[m].push({h:o,p:x[0]});if(!h[0])return n(a);if(h.length>1){let y=!1,w=0;for(let _=0,S=h.length;_<S;_++)d[_]=[];for(let _=0,S=h.length;_<S;_++){const M=f[_];for(let E=0;E<M.length;E++){const C=M[E];let R=!0;for(let k=0;k<h.length;k++)r(C.p,h[k].p)&&(_!==k&&w++,R?(R=!1,d[k].push(C)):y=!0);R&&d[_].push(C)}}w>0&&y===!1&&(f=d)}let b;for(let y=0,w=h.length;y<w;y++){l=h[y].s,u.push(l),b=f[y];for(let _=0,S=b.length;_<S;_++)l.holes.push(b[_].h)}return u}}let mme=class extends Wl{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ut("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}};function gme(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function vme(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function yme(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function Y6(t,e,n,r){const i=xme(r);switch(n){case GN:return t*e;case g2:return t*e/i.components*i.byteLength;case gv:return t*e/i.components*i.byteLength;case Kh:return t*e*2/i.components*i.byteLength;case v2:return t*e*2/i.components*i.byteLength;case WN:return t*e*3/i.components*i.byteLength;case Da:return t*e*4/i.components*i.byteLength;case y2:return t*e*4/i.components*i.byteLength;case Rg:case Pg:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Dg:case Og:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case x_:case __:return Math.max(t,16)*Math.max(e,8)/4;case y_:case b_:return Math.max(t,8)*Math.max(e,8)/2;case w_:case S_:case T_:case C_:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case E_:case M_:case A_:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case k_:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case I_:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case N_:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case R_:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case P_:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case D_:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case O_:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case L_:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case F_:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case B_:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case U_:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case z_:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case j_:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case H_:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case $_:case V_:case q_:return Math.ceil(t/4)*Math.ceil(e/4)*16;case G_:case W_:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Y_:case X_:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function xme(t){switch(t){case Ka:case HN:return{byteLength:1,components:1};case o0:case $N:case $l:return{byteLength:2,components:1};case p2:case m2:return{byteLength:2,components:4};case yo:case f2:case Qa:return{byteLength:4,components:1};case VN:case qN:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class bme{static contain(e,n){return gme(e,n)}static cover(e,n){return vme(e,n)}static fill(e){return yme(e)}static getByteLength(e,n,r,i){return Y6(e,n,r,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:B0}}));typeof window<"u"&&(window.__THREE__?Ut("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=B0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function aZ(){let t=null,e=!1,n=null,r=null;function i(a,s){n(a,s),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){n=a},setContext:function(a){t=a}}}function _me(t){const e=new WeakMap;function n(o,l){const u=o.array,c=o.usage,d=u.byteLength,h=t.createBuffer();t.bindBuffer(l,h),t.bufferData(l,u,c),o.onUploadCallback();let f;if(u instanceof Float32Array)f=t.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)f=t.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?f=t.HALF_FLOAT:f=t.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=t.SHORT;else if(u instanceof Uint32Array)f=t.UNSIGNED_INT;else if(u instanceof Int32Array)f=t.INT;else if(u instanceof Int8Array)f=t.BYTE;else if(u instanceof Uint8Array)f=t.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:h,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:d}}function r(o,l,u){const c=l.array,d=l.updateRanges;if(t.bindBuffer(u,o),d.length===0)t.bufferSubData(u,0,c);else{d.sort((f,m)=>f.start-m.start);let h=0;for(let f=1;f<d.length;f++){const m=d[h],x=d[f];x.start<=m.start+m.count+1?m.count=Math.max(m.count,x.start+x.count-m.start):(++h,d[h]=x)}d.length=h+1;for(let f=0,m=d.length;f<m;f++){const x=d[f];t.bufferSubData(u,x.start*c.BYTES_PER_ELEMENT,c,x.start,x.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function a(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(t.deleteBuffer(l.buffer),e.delete(o))}function s(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const c=e.get(o);(!c||c.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,n(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(u.buffer,o,l),u.version=o.version}}return{get:i,remove:a,update:s}}var wme=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Sme=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Eme=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Tme=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Cme=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Mme=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Ame=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,kme=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ime=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Nme=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Rme=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Pme=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Dme=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Ome=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Lme=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Fme=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Bme=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ume=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,zme=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,jme=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Hme=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,$me=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Vme=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,qme=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Gme=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Wme=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Yme=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Xme=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Kme=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Zme=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Jme="gl_FragColor = linearToOutputTexel( gl_FragColor );",Qme=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,ege=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tge=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,nge=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rge=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,ige=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,age=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,sge=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,oge=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,lge=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,uge=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,cge=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,dge=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,hge=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,fge=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,pge=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,mge=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gge=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,vge=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yge=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,xge=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,bge=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_ge=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,wge=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Sge=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Ege=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Tge=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Cge=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Mge=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Age=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,kge=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Ige=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Nge=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Rge=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Pge=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Dge=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Oge=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Lge=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Fge=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Bge=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Uge=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,zge=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,jge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Hge=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,$ge=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Vge=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,qge=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Gge=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Wge=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Yge=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Xge=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Kge=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Zge=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Jge=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Qge=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,e1e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,t1e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,n1e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,r1e=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,i1e=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,a1e=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,s1e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,o1e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,l1e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,u1e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,c1e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,d1e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,h1e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,f1e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,p1e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,m1e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,g1e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,v1e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,y1e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,x1e=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,b1e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _1e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,w1e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,S1e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,E1e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,T1e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,C1e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,M1e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,A1e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,k1e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,I1e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,N1e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,R1e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,P1e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,D1e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,O1e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,L1e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F1e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,B1e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,U1e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,z1e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,j1e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,H1e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,$1e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,V1e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q1e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,G1e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,W1e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Y1e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,X1e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,K1e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Z1e=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,J1e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Q1e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eve=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,kn={alphahash_fragment:wme,alphahash_pars_fragment:Sme,alphamap_fragment:Eme,alphamap_pars_fragment:Tme,alphatest_fragment:Cme,alphatest_pars_fragment:Mme,aomap_fragment:Ame,aomap_pars_fragment:kme,batching_pars_vertex:Ime,batching_vertex:Nme,begin_vertex:Rme,beginnormal_vertex:Pme,bsdfs:Dme,iridescence_fragment:Ome,bumpmap_pars_fragment:Lme,clipping_planes_fragment:Fme,clipping_planes_pars_fragment:Bme,clipping_planes_pars_vertex:Ume,clipping_planes_vertex:zme,color_fragment:jme,color_pars_fragment:Hme,color_pars_vertex:$me,color_vertex:Vme,common:qme,cube_uv_reflection_fragment:Gme,defaultnormal_vertex:Wme,displacementmap_pars_vertex:Yme,displacementmap_vertex:Xme,emissivemap_fragment:Kme,emissivemap_pars_fragment:Zme,colorspace_fragment:Jme,colorspace_pars_fragment:Qme,envmap_fragment:ege,envmap_common_pars_fragment:tge,envmap_pars_fragment:nge,envmap_pars_vertex:rge,envmap_physical_pars_fragment:pge,envmap_vertex:ige,fog_vertex:age,fog_pars_vertex:sge,fog_fragment:oge,fog_pars_fragment:lge,gradientmap_pars_fragment:uge,lightmap_pars_fragment:cge,lights_lambert_fragment:dge,lights_lambert_pars_fragment:hge,lights_pars_begin:fge,lights_toon_fragment:mge,lights_toon_pars_fragment:gge,lights_phong_fragment:vge,lights_phong_pars_fragment:yge,lights_physical_fragment:xge,lights_physical_pars_fragment:bge,lights_fragment_begin:_ge,lights_fragment_maps:wge,lights_fragment_end:Sge,logdepthbuf_fragment:Ege,logdepthbuf_pars_fragment:Tge,logdepthbuf_pars_vertex:Cge,logdepthbuf_vertex:Mge,map_fragment:Age,map_pars_fragment:kge,map_particle_fragment:Ige,map_particle_pars_fragment:Nge,metalnessmap_fragment:Rge,metalnessmap_pars_fragment:Pge,morphinstance_vertex:Dge,morphcolor_vertex:Oge,morphnormal_vertex:Lge,morphtarget_pars_vertex:Fge,morphtarget_vertex:Bge,normal_fragment_begin:Uge,normal_fragment_maps:zge,normal_pars_fragment:jge,normal_pars_vertex:Hge,normal_vertex:$ge,normalmap_pars_fragment:Vge,clearcoat_normal_fragment_begin:qge,clearcoat_normal_fragment_maps:Gge,clearcoat_pars_fragment:Wge,iridescence_pars_fragment:Yge,opaque_fragment:Xge,packing:Kge,premultiplied_alpha_fragment:Zge,project_vertex:Jge,dithering_fragment:Qge,dithering_pars_fragment:e1e,roughnessmap_fragment:t1e,roughnessmap_pars_fragment:n1e,shadowmap_pars_fragment:r1e,shadowmap_pars_vertex:i1e,shadowmap_vertex:a1e,shadowmask_pars_fragment:s1e,skinbase_vertex:o1e,skinning_pars_vertex:l1e,skinning_vertex:u1e,skinnormal_vertex:c1e,specularmap_fragment:d1e,specularmap_pars_fragment:h1e,tonemapping_fragment:f1e,tonemapping_pars_fragment:p1e,transmission_fragment:m1e,transmission_pars_fragment:g1e,uv_pars_fragment:v1e,uv_pars_vertex:y1e,uv_vertex:x1e,worldpos_vertex:b1e,background_vert:_1e,background_frag:w1e,backgroundCube_vert:S1e,backgroundCube_frag:E1e,cube_vert:T1e,cube_frag:C1e,depth_vert:M1e,depth_frag:A1e,distance_vert:k1e,distance_frag:I1e,equirect_vert:N1e,equirect_frag:R1e,linedashed_vert:P1e,linedashed_frag:D1e,meshbasic_vert:O1e,meshbasic_frag:L1e,meshlambert_vert:F1e,meshlambert_frag:B1e,meshmatcap_vert:U1e,meshmatcap_frag:z1e,meshnormal_vert:j1e,meshnormal_frag:H1e,meshphong_vert:$1e,meshphong_frag:V1e,meshphysical_vert:q1e,meshphysical_frag:G1e,meshtoon_vert:W1e,meshtoon_frag:Y1e,points_vert:X1e,points_frag:K1e,shadow_vert:Z1e,shadow_frag:J1e,sprite_vert:Q1e,sprite_frag:eve},Bt={common:{diffuse:{value:new zt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Sn},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Sn}},envmap:{envMap:{value:null},envMapRotation:{value:new Sn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Sn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Sn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Sn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Sn},normalScale:{value:new dt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Sn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Sn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Sn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Sn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new zt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new zt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0},uvTransform:{value:new Sn}},sprite:{diffuse:{value:new zt(16777215)},opacity:{value:1},center:{value:new dt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Sn},alphaMap:{value:null},alphaMapTransform:{value:new Sn},alphaTest:{value:0}}},Wo={basic:{uniforms:Xa([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:kn.meshbasic_vert,fragmentShader:kn.meshbasic_frag},lambert:{uniforms:Xa([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new zt(0)}}]),vertexShader:kn.meshlambert_vert,fragmentShader:kn.meshlambert_frag},phong:{uniforms:Xa([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new zt(0)},specular:{value:new zt(1118481)},shininess:{value:30}}]),vertexShader:kn.meshphong_vert,fragmentShader:kn.meshphong_frag},standard:{uniforms:Xa([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new zt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:kn.meshphysical_vert,fragmentShader:kn.meshphysical_frag},toon:{uniforms:Xa([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new zt(0)}}]),vertexShader:kn.meshtoon_vert,fragmentShader:kn.meshtoon_frag},matcap:{uniforms:Xa([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:kn.meshmatcap_vert,fragmentShader:kn.meshmatcap_frag},points:{uniforms:Xa([Bt.points,Bt.fog]),vertexShader:kn.points_vert,fragmentShader:kn.points_frag},dashed:{uniforms:Xa([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:kn.linedashed_vert,fragmentShader:kn.linedashed_frag},depth:{uniforms:Xa([Bt.common,Bt.displacementmap]),vertexShader:kn.depth_vert,fragmentShader:kn.depth_frag},normal:{uniforms:Xa([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:kn.meshnormal_vert,fragmentShader:kn.meshnormal_frag},sprite:{uniforms:Xa([Bt.sprite,Bt.fog]),vertexShader:kn.sprite_vert,fragmentShader:kn.sprite_frag},background:{uniforms:{uvTransform:{value:new Sn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:kn.background_vert,fragmentShader:kn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Sn}},vertexShader:kn.backgroundCube_vert,fragmentShader:kn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:kn.cube_vert,fragmentShader:kn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:kn.equirect_vert,fragmentShader:kn.equirect_frag},distance:{uniforms:Xa([Bt.common,Bt.displacementmap,{referencePosition:{value:new we},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:kn.distance_vert,fragmentShader:kn.distance_frag},shadow:{uniforms:Xa([Bt.lights,Bt.fog,{color:{value:new zt(0)},opacity:{value:1}}]),vertexShader:kn.shadow_vert,fragmentShader:kn.shadow_frag}};Wo.physical={uniforms:Xa([Wo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Sn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Sn},clearcoatNormalScale:{value:new dt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Sn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Sn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Sn},sheen:{value:0},sheenColor:{value:new zt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Sn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Sn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Sn},transmissionSamplerSize:{value:new dt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Sn},attenuationDistance:{value:0},attenuationColor:{value:new zt(0)},specularColor:{value:new zt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Sn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Sn},anisotropyVector:{value:new dt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Sn}}]),vertexShader:kn.meshphysical_vert,fragmentShader:kn.meshphysical_frag};const Fx={r:0,b:0,g:0},rh=new Js,tve=new fn;function nve(t,e,n,r,i,a,s){const o=new zt(0);let l=a===!0?0:1,u,c,d=null,h=0,f=null;function m(_){let S=_.isScene===!0?_.background:null;return S&&S.isTexture&&(S=(_.backgroundBlurriness>0?n:e).get(S)),S}function x(_){let S=!1;const M=m(_);M===null?y(o,l):M&&M.isColor&&(y(M,1),S=!0);const E=t.xr.getEnvironmentBlendMode();E==="additive"?r.buffers.color.setClear(0,0,0,1,s):E==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(t.autoClear||S)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function b(_,S){const M=m(S);M&&(M.isCubeTexture||M.mapping===U0)?(c===void 0&&(c=new Kr(new pf(1,1,1),new Ss({name:"BackgroundCubeMaterial",uniforms:f0(Wo.backgroundCube.uniforms),vertexShader:Wo.backgroundCube.vertexShader,fragmentShader:Wo.backgroundCube.fragmentShader,side:rs,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(E,C,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),rh.copy(S.backgroundRotation),rh.x*=-1,rh.y*=-1,rh.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(rh.y*=-1,rh.z*=-1),c.material.uniforms.envMap.value=M,c.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(tve.makeRotationFromEuler(rh)),c.material.toneMapped=Yn.getTransfer(M.colorSpace)!==xr,(d!==M||h!==M.version||f!==t.toneMapping)&&(c.material.needsUpdate=!0,d=M,h=M.version,f=t.toneMapping),c.layers.enableAll(),_.unshift(c,c.geometry,c.material,0,0,null)):M&&M.isTexture&&(u===void 0&&(u=new Kr(new Wu(2,2),new Ss({name:"BackgroundMaterial",uniforms:f0(Wo.background.uniforms),vertexShader:Wo.background.vertexShader,fragmentShader:Wo.background.fragmentShader,side:Uu,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=M,u.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,u.material.toneMapped=Yn.getTransfer(M.colorSpace)!==xr,M.matrixAutoUpdate===!0&&M.updateMatrix(),u.material.uniforms.uvTransform.value.copy(M.matrix),(d!==M||h!==M.version||f!==t.toneMapping)&&(u.material.needsUpdate=!0,d=M,h=M.version,f=t.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null))}function y(_,S){_.getRGB(Fx,cK(t)),r.buffers.color.setClear(Fx.r,Fx.g,Fx.b,S,s)}function w(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(_,S=1){o.set(_),l=S,y(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(_){l=_,y(o,l)},render:x,addToRenderList:b,dispose:w}}function rve(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=h(null);let a=i,s=!1;function o(I,N,D,F,L){let U=!1;const j=d(F,D,N);a!==j&&(a=j,u(a.object)),U=f(I,F,D,L),U&&m(I,F,D,L),L!==null&&e.update(L,t.ELEMENT_ARRAY_BUFFER),(U||s)&&(s=!1,S(I,N,D,F),L!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(L).buffer))}function l(){return t.createVertexArray()}function u(I){return t.bindVertexArray(I)}function c(I){return t.deleteVertexArray(I)}function d(I,N,D){const F=D.wireframe===!0;let L=r[I.id];L===void 0&&(L={},r[I.id]=L);let U=L[N.id];U===void 0&&(U={},L[N.id]=U);let j=U[F];return j===void 0&&(j=h(l()),U[F]=j),j}function h(I){const N=[],D=[],F=[];for(let L=0;L<n;L++)N[L]=0,D[L]=0,F[L]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:D,attributeDivisors:F,object:I,attributes:{},index:null}}function f(I,N,D,F){const L=a.attributes,U=N.attributes;let j=0;const q=D.getAttributes();for(const Z in q)if(q[Z].location>=0){const z=L[Z];let W=U[Z];if(W===void 0&&(Z==="instanceMatrix"&&I.instanceMatrix&&(W=I.instanceMatrix),Z==="instanceColor"&&I.instanceColor&&(W=I.instanceColor)),z===void 0||z.attribute!==W||W&&z.data!==W.data)return!0;j++}return a.attributesNum!==j||a.index!==F}function m(I,N,D,F){const L={},U=N.attributes;let j=0;const q=D.getAttributes();for(const Z in q)if(q[Z].location>=0){let z=U[Z];z===void 0&&(Z==="instanceMatrix"&&I.instanceMatrix&&(z=I.instanceMatrix),Z==="instanceColor"&&I.instanceColor&&(z=I.instanceColor));const W={};W.attribute=z,z&&z.data&&(W.data=z.data),L[Z]=W,j++}a.attributes=L,a.attributesNum=j,a.index=F}function x(){const I=a.newAttributes;for(let N=0,D=I.length;N<D;N++)I[N]=0}function b(I){y(I,0)}function y(I,N){const D=a.newAttributes,F=a.enabledAttributes,L=a.attributeDivisors;D[I]=1,F[I]===0&&(t.enableVertexAttribArray(I),F[I]=1),L[I]!==N&&(t.vertexAttribDivisor(I,N),L[I]=N)}function w(){const I=a.newAttributes,N=a.enabledAttributes;for(let D=0,F=N.length;D<F;D++)N[D]!==I[D]&&(t.disableVertexAttribArray(D),N[D]=0)}function _(I,N,D,F,L,U,j){j===!0?t.vertexAttribIPointer(I,N,D,L,U):t.vertexAttribPointer(I,N,D,F,L,U)}function S(I,N,D,F){x();const L=F.attributes,U=D.getAttributes(),j=N.defaultAttributeValues;for(const q in U){const Z=U[q];if(Z.location>=0){let Q=L[q];if(Q===void 0&&(q==="instanceMatrix"&&I.instanceMatrix&&(Q=I.instanceMatrix),q==="instanceColor"&&I.instanceColor&&(Q=I.instanceColor)),Q!==void 0){const z=Q.normalized,W=Q.itemSize,X=e.get(Q);if(X===void 0)continue;const H=X.buffer,J=X.type,te=X.bytesPerElement,ee=J===t.INT||J===t.UNSIGNED_INT||Q.gpuType===f2;if(Q.isInterleavedBufferAttribute){const se=Q.data,ue=se.stride,oe=Q.offset;if(se.isInstancedInterleavedBuffer){for(let Te=0;Te<Z.locationSize;Te++)y(Z.location+Te,se.meshPerAttribute);I.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let Te=0;Te<Z.locationSize;Te++)b(Z.location+Te);t.bindBuffer(t.ARRAY_BUFFER,H);for(let Te=0;Te<Z.locationSize;Te++)_(Z.location+Te,W/Z.locationSize,J,z,ue*te,(oe+W/Z.locationSize*Te)*te,ee)}else{if(Q.isInstancedBufferAttribute){for(let se=0;se<Z.locationSize;se++)y(Z.location+se,Q.meshPerAttribute);I.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let se=0;se<Z.locationSize;se++)b(Z.location+se);t.bindBuffer(t.ARRAY_BUFFER,H);for(let se=0;se<Z.locationSize;se++)_(Z.location+se,W/Z.locationSize,J,z,W*te,W/Z.locationSize*se*te,ee)}}else if(j!==void 0){const z=j[q];if(z!==void 0)switch(z.length){case 2:t.vertexAttrib2fv(Z.location,z);break;case 3:t.vertexAttrib3fv(Z.location,z);break;case 4:t.vertexAttrib4fv(Z.location,z);break;default:t.vertexAttrib1fv(Z.location,z)}}}}w()}function M(){R();for(const I in r){const N=r[I];for(const D in N){const F=N[D];for(const L in F)c(F[L].object),delete F[L];delete N[D]}delete r[I]}}function E(I){if(r[I.id]===void 0)return;const N=r[I.id];for(const D in N){const F=N[D];for(const L in F)c(F[L].object),delete F[L];delete N[D]}delete r[I.id]}function C(I){for(const N in r){const D=r[N];if(D[I.id]===void 0)continue;const F=D[I.id];for(const L in F)c(F[L].object),delete F[L];delete D[I.id]}}function R(){k(),s=!0,a!==i&&(a=i,u(a.object))}function k(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:R,resetDefaultState:k,dispose:M,releaseStatesOfGeometry:E,releaseStatesOfProgram:C,initAttributes:x,enableAttribute:b,disableUnusedAttributes:w}}function ive(t,e,n){let r;function i(u){r=u}function a(u,c){t.drawArrays(r,u,c),n.update(c,r,1)}function s(u,c,d){d!==0&&(t.drawArraysInstanced(r,u,c,d),n.update(c,r,d))}function o(u,c,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,u,0,c,0,d);let f=0;for(let m=0;m<d;m++)f+=c[m];n.update(f,r,1)}function l(u,c,d,h){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<u.length;m++)s(u[m],c[m],h[m]);else{f.multiDrawArraysInstancedWEBGL(r,u,0,c,0,h,0,d);let m=0;for(let x=0;x<d;x++)m+=c[x]*h[x];n.update(m,r,1)}}this.setMode=i,this.render=a,this.renderInstances=s,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function ave(t,e,n,r){let i;function a(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(C){return!(C!==Da&&r.convert(C)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(C){const R=C===$l&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(C!==Ka&&r.convert(C)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&C!==Qa&&!R)}function l(C){if(C==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=n.precision!==void 0?n.precision:"highp";const c=l(u);c!==u&&(Ut("WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const d=n.logarithmicDepthBuffer===!0,h=n.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),m=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=t.getParameter(t.MAX_TEXTURE_SIZE),b=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),y=t.getParameter(t.MAX_VERTEX_ATTRIBS),w=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),_=t.getParameter(t.MAX_VARYING_VECTORS),S=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),M=t.getParameter(t.MAX_SAMPLES),E=t.getParameter(t.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:a,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:d,reversedDepthBuffer:h,maxTextures:f,maxVertexTextures:m,maxTextureSize:x,maxCubemapSize:b,maxAttributes:y,maxVertexUniforms:w,maxVaryings:_,maxFragmentUniforms:S,maxSamples:M,samples:E}}function sve(t){const e=this;let n=null,r=0,i=!1,a=!1;const s=new Tu,o=new Sn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=d.length!==0||h||r!==0||i;return i=h,r=d.length,f},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(d,h){n=c(d,h,0)},this.setState=function(d,h,f){const m=d.clippingPlanes,x=d.clipIntersection,b=d.clipShadows,y=t.get(d);if(!i||m===null||m.length===0||a&&!b)a?c(null):u();else{const w=a?0:r,_=w*4;let S=y.clippingState||null;l.value=S,S=c(m,h,_,f);for(let M=0;M!==_;++M)S[M]=n[M];y.clippingState=S,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=w}};function u(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(d,h,f,m){const x=d!==null?d.length:0;let b=null;if(x!==0){if(b=l.value,m!==!0||b===null){const y=f+x*4,w=h.matrixWorldInverse;o.getNormalMatrix(w),(b===null||b.length<y)&&(b=new Float32Array(y));for(let _=0,S=f;_!==x;++_,S+=4)s.copy(d[_]).applyMatrix4(w,o),s.normal.toArray(b,S),b[S+3]=s.constant}l.value=b,l.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,b}}function ove(t){let e=new WeakMap;function n(s,o){return o===l1?s.mapping=Hl:o===u1&&(s.mapping=Qc),s}function r(s){if(s&&s.isTexture){const o=s.mapping;if(o===l1||o===u1)if(e.has(s)){const l=e.get(s).texture;return n(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const u=new e8(l.height);return u.fromEquirectangularTexture(t,s),e.set(s,u),s.addEventListener("dispose",i),n(u.texture,s.mapping)}else return null}}return s}function i(s){const o=s.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function a(){e=new WeakMap}return{get:r,dispose:a}}const Gc=4,RO=[.125,.215,.35,.446,.526,.582],bh=20,lve=256,Wm=new Ou,PO=new zt;let mE=null,gE=0,vE=0,yE=!1;const uve=new we;class X6{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,n=0,r=.1,i=100,a={}){const{size:s=256,position:o=uve}=a;mE=this._renderer.getRenderTarget(),gE=this._renderer.getActiveCubeFace(),vE=this._renderer.getActiveMipmapLevel(),yE=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,i,l,o),n>0&&this._blur(l,0,0,n),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LO(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=OO(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(mE,gE,vE),this._renderer.xr.enabled=yE,e.scissorTest=!1,kp(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Hl||e.mapping===Qc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mE=this._renderer.getRenderTarget(),gE=this._renderer.getActiveCubeFace(),vE=this._renderer.getActiveMipmapLevel(),yE=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:Pr,minFilter:Pr,generateMipmaps:!1,type:$l,format:Da,colorSpace:ed,depthBuffer:!1},i=DO(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=DO(e,n,r);const{_lodMax:a}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=cve(a)),this._blurMaterial=hve(a,e,n),this._ggxMaterial=dve(a,e,n)}return i}_compileMaterial(e){const n=new Kr(new bn,e);this._renderer.compile(n,Wm)}_sceneToCubeUV(e,n,r,i,a){const l=new Si(90,1,n,r),u=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],d=this._renderer,h=d.autoClear,f=d.toneMapping;d.getClearColor(PO),d.toneMapping=vo,d.autoClear=!1,d.state.buffers.depth.getReversed()&&(d.setRenderTarget(i),d.clearDepth(),d.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Kr(new pf,new Gu({name:"PMREM.Background",side:rs,depthWrite:!1,depthTest:!1})));const x=this._backgroundBox,b=x.material;let y=!1;const w=e.background;w?w.isColor&&(b.color.copy(w),e.background=null,y=!0):(b.color.copy(PO),y=!0);for(let _=0;_<6;_++){const S=_%3;S===0?(l.up.set(0,u[_],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x+c[_],a.y,a.z)):S===1?(l.up.set(0,0,u[_]),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y+c[_],a.z)):(l.up.set(0,u[_],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y,a.z+c[_]));const M=this._cubeSize;kp(i,S*M,_>2?M:0,M,M),d.setRenderTarget(i),y&&d.render(x,l),d.render(e,l)}d.toneMapping=f,d.autoClear=h,e.background=w}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===Hl||e.mapping===Qc;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=LO()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=OO());const a=i?this._cubemapMaterial:this._equirectMaterial,s=this._lodMeshes[0];s.material=a;const o=a.uniforms;o.envMap.value=e;const l=this._cubeSize;kp(n,0,0,3*l,2*l),r.setRenderTarget(n),r.render(s,Wm)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodMeshes.length;for(let a=1;a<i;a++)this._applyGGXFilter(e,a-1,a);n.autoClear=r}_applyGGXFilter(e,n,r){const i=this._renderer,a=this._pingPongRenderTarget,s=this._ggxMaterial,o=this._lodMeshes[r];o.material=s;const l=s.uniforms,u=r/(this._lodMeshes.length-1),c=n/(this._lodMeshes.length-1),d=Math.sqrt(u*u-c*c),h=0+u*1.25,f=d*h,{_lodMax:m}=this,x=this._sizeLods[r],b=3*x*(r>m-Gc?r-m+Gc:0),y=4*(this._cubeSize-x);l.envMap.value=e.texture,l.roughness.value=f,l.mipInt.value=m-n,kp(a,b,y,3*x,2*x),i.setRenderTarget(a),i.render(o,Wm),l.envMap.value=a.texture,l.roughness.value=0,l.mipInt.value=m-r,kp(e,b,y,3*x,2*x),i.setRenderTarget(e),i.render(o,Wm)}_blur(e,n,r,i,a){const s=this._pingPongRenderTarget;this._halfBlur(e,s,n,r,i,"latitudinal",a),this._halfBlur(s,e,r,r,i,"longitudinal",a)}_halfBlur(e,n,r,i,a,s,o){const l=this._renderer,u=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&tn("blur direction must be either latitudinal or longitudinal!");const c=3,d=this._lodMeshes[i];d.material=u;const h=u.uniforms,f=this._sizeLods[r]-1,m=isFinite(a)?Math.PI/(2*f):2*Math.PI/(2*bh-1),x=a/m,b=isFinite(a)?1+Math.floor(c*x):bh;b>bh&&Ut(`sigmaRadians, ${a}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${bh}`);const y=[];let w=0;for(let C=0;C<bh;++C){const R=C/x,k=Math.exp(-R*R/2);y.push(k),C===0?w+=k:C<b&&(w+=2*k)}for(let C=0;C<y.length;C++)y[C]=y[C]/w;h.envMap.value=e.texture,h.samples.value=b,h.weights.value=y,h.latitudinal.value=s==="latitudinal",o&&(h.poleAxis.value=o);const{_lodMax:_}=this;h.dTheta.value=m,h.mipInt.value=_-r;const S=this._sizeLods[i],M=3*S*(i>_-Gc?i-_+Gc:0),E=4*(this._cubeSize-S);kp(n,M,E,3*S,2*S),l.setRenderTarget(n),l.render(d,Wm)}}function cve(t){const e=[],n=[],r=[];let i=t;const a=t-Gc+1+RO.length;for(let s=0;s<a;s++){const o=Math.pow(2,i);e.push(o);let l=1/o;s>t-Gc?l=RO[s-t+Gc-1]:s===0&&(l=0),n.push(l);const u=1/(o-2),c=-u,d=1+u,h=[c,c,d,c,d,d,c,c,d,d,c,d],f=6,m=6,x=3,b=2,y=1,w=new Float32Array(x*m*f),_=new Float32Array(b*m*f),S=new Float32Array(y*m*f);for(let E=0;E<f;E++){const C=E%3*2/3-1,R=E>2?0:-1,k=[C,R,0,C+2/3,R,0,C+2/3,R+1,0,C,R,0,C+2/3,R+1,0,C,R+1,0];w.set(k,x*m*E),_.set(h,b*m*E);const I=[E,E,E,E,E,E];S.set(I,y*m*E)}const M=new bn;M.setAttribute("position",new Xn(w,x)),M.setAttribute("uv",new Xn(_,b)),M.setAttribute("faceIndex",new Xn(S,y)),r.push(new Kr(M,null)),i>Gc&&i--}return{lodMeshes:r,sizeLods:e,sigmas:n}}function DO(t,e,n){const r=new Ys(t,e,n);return r.texture.mapping=U0,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function kp(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function dve(t,e,n){return new Ss({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:lve,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:X2(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:Fl,depthTest:!1,depthWrite:!1})}function hve(t,e,n){const r=new Float32Array(bh),i=new we(0,1,0);return new Ss({name:"SphericalGaussianBlur",defines:{n:bh,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Fl,depthTest:!1,depthWrite:!1})}function OO(){return new Ss({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Fl,depthTest:!1,depthWrite:!1})}function LO(){return new Ss({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:X2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Fl,depthTest:!1,depthWrite:!1})}function X2(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fve(t){let e=new WeakMap,n=null;function r(o){if(o&&o.isTexture){const l=o.mapping,u=l===l1||l===u1,c=l===Hl||l===Qc;if(u||c){let d=e.get(o);const h=d!==void 0?d.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==h)return n===null&&(n=new X6(t)),d=u?n.fromEquirectangular(o,d):n.fromCubemap(o,d),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),d.texture;if(d!==void 0)return d.texture;{const f=o.image;return u&&f&&f.height>0||c&&f&&i(f)?(n===null&&(n=new X6(t)),d=u?n.fromEquirectangular(o):n.fromCubemap(o),d.texture.pmremVersion=o.pmremVersion,e.set(o,d),o.addEventListener("dispose",a),d.texture):null}}}return o}function i(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function a(o){const l=o.target;l.removeEventListener("dispose",a);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function s(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:s}}function pve(t){const e={};function n(r){if(e[r]!==void 0)return e[r];const i=t.getExtension(r);return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&c0("WebGLRenderer: "+r+" extension not supported."),i}}}function mve(t,e,n,r){const i={},a=new WeakMap;function s(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const m in h.attributes)e.remove(h.attributes[m]);h.removeEventListener("dispose",s),delete i[h.id];const f=a.get(h);f&&(e.remove(f),a.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,n.memory.geometries--}function o(d,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,n.memory.geometries++),h}function l(d){const h=d.attributes;for(const f in h)e.update(h[f],t.ARRAY_BUFFER)}function u(d){const h=[],f=d.index,m=d.attributes.position;let x=0;if(f!==null){const w=f.array;x=f.version;for(let _=0,S=w.length;_<S;_+=3){const M=w[_+0],E=w[_+1],C=w[_+2];h.push(M,E,E,C,C,M)}}else if(m!==void 0){const w=m.array;x=m.version;for(let _=0,S=w.length/3-1;_<S;_+=3){const M=_+0,E=_+1,C=_+2;h.push(M,E,E,C,C,M)}}else return;const b=new(aK(h)?QN:JN)(h,1);b.version=x;const y=a.get(d);y&&e.remove(y),a.set(d,b)}function c(d){const h=a.get(d);if(h){const f=d.index;f!==null&&h.version<f.version&&u(d)}else u(d);return a.get(d)}return{get:o,update:l,getWireframeAttribute:c}}function gve(t,e,n){let r;function i(h){r=h}let a,s;function o(h){a=h.type,s=h.bytesPerElement}function l(h,f){t.drawElements(r,f,a,h*s),n.update(f,r,1)}function u(h,f,m){m!==0&&(t.drawElementsInstanced(r,f,a,h*s,m),n.update(f,r,m))}function c(h,f,m){if(m===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,f,0,a,h,0,m);let b=0;for(let y=0;y<m;y++)b+=f[y];n.update(b,r,1)}function d(h,f,m,x){if(m===0)return;const b=e.get("WEBGL_multi_draw");if(b===null)for(let y=0;y<h.length;y++)u(h[y]/s,f[y],x[y]);else{b.multiDrawElementsInstancedWEBGL(r,f,0,a,h,0,x,0,m);let y=0;for(let w=0;w<m;w++)y+=f[w]*x[w];n.update(y,r,1)}}this.setMode=i,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=d}function vve(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(a,s,o){switch(n.calls++,s){case t.TRIANGLES:n.triangles+=o*(a/3);break;case t.LINES:n.lines+=o*(a/2);break;case t.LINE_STRIP:n.lines+=o*(a-1);break;case t.LINE_LOOP:n.lines+=o*a;break;case t.POINTS:n.points+=o*a;break;default:tn("WebGLInfo: Unknown draw mode:",s);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function yve(t,e,n){const r=new WeakMap,i=new er;function a(s,o,l){const u=s.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,d=c!==void 0?c.length:0;let h=r.get(o);if(h===void 0||h.count!==d){let k=function(){C.dispose(),r.delete(o),o.removeEventListener("dispose",k)};h!==void 0&&h.texture.dispose();const f=o.morphAttributes.position!==void 0,m=o.morphAttributes.normal!==void 0,x=o.morphAttributes.color!==void 0,b=o.morphAttributes.position||[],y=o.morphAttributes.normal||[],w=o.morphAttributes.color||[];let _=0;f===!0&&(_=1),m===!0&&(_=2),x===!0&&(_=3);let S=o.attributes.position.count*_,M=1;S>e.maxTextureSize&&(M=Math.ceil(S/e.maxTextureSize),S=e.maxTextureSize);const E=new Float32Array(S*M*4*d),C=new w2(E,S,M,d);C.type=Qa,C.needsUpdate=!0;const R=_*4;for(let I=0;I<d;I++){const N=b[I],D=y[I],F=w[I],L=S*M*4*I;for(let U=0;U<N.count;U++){const j=U*R;f===!0&&(i.fromBufferAttribute(N,U),E[L+j+0]=i.x,E[L+j+1]=i.y,E[L+j+2]=i.z,E[L+j+3]=0),m===!0&&(i.fromBufferAttribute(D,U),E[L+j+4]=i.x,E[L+j+5]=i.y,E[L+j+6]=i.z,E[L+j+7]=0),x===!0&&(i.fromBufferAttribute(F,U),E[L+j+8]=i.x,E[L+j+9]=i.y,E[L+j+10]=i.z,E[L+j+11]=F.itemSize===4?i.w:1)}}h={count:d,texture:C,size:new dt(S,M)},r.set(o,h),o.addEventListener("dispose",k)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let f=0;for(let x=0;x<u.length;x++)f+=u[x];const m=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(t,"morphTargetBaseInfluence",m),l.getUniforms().setValue(t,"morphTargetInfluences",u)}l.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),l.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}return{update:a}}function xve(t,e,n,r){let i=new WeakMap;function a(l){const u=r.render.frame,c=l.geometry,d=e.get(l,c);if(i.get(d)!==u&&(e.update(d),i.set(d,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.get(l)!==u&&(n.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&n.update(l.instanceColor,t.ARRAY_BUFFER),i.set(l,u))),l.isSkinnedMesh){const h=l.skeleton;i.get(h)!==u&&(h.update(),i.set(h,u))}return d}function s(){i=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),n.remove(u.instanceMatrix),u.instanceColor!==null&&n.remove(u.instanceColor)}return{update:a,dispose:s}}const bve={[ON]:"LINEAR_TONE_MAPPING",[LN]:"REINHARD_TONE_MAPPING",[FN]:"CINEON_TONE_MAPPING",[d2]:"ACES_FILMIC_TONE_MAPPING",[UN]:"AGX_TONE_MAPPING",[zN]:"NEUTRAL_TONE_MAPPING",[BN]:"CUSTOM_TONE_MAPPING"};function _ve(t,e,n,r,i){const a=new Ys(e,n,{type:t,depthBuffer:r,stencilBuffer:i}),s=new Ys(e,n,{type:$l,depthBuffer:!1,stencilBuffer:!1}),o=new bn;o.setAttribute("position",new Wt([-1,3,0,-1,-1,0,3,-1,0],3)),o.setAttribute("uv",new Wt([0,2,0,0,2,0],2));const l=new h8({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),u=new Kr(o,l),c=new Ou(-1,1,1,-1,0,1);let d=null,h=null,f=!1,m,x=null,b=[],y=!1;this.setSize=function(w,_){a.setSize(w,_),s.setSize(w,_);for(let S=0;S<b.length;S++){const M=b[S];M.setSize&&M.setSize(w,_)}},this.setEffects=function(w){b=w,y=b.length>0&&b[0].isRenderPass===!0;const _=a.width,S=a.height;for(let M=0;M<b.length;M++){const E=b[M];E.setSize&&E.setSize(_,S)}},this.begin=function(w,_){if(f||w.toneMapping===vo&&b.length===0)return!1;if(x=_,_!==null){const S=_.width,M=_.height;(a.width!==S||a.height!==M)&&this.setSize(S,M)}return y===!1&&w.setRenderTarget(a),m=w.toneMapping,w.toneMapping=vo,!0},this.hasRenderPass=function(){return y},this.end=function(w,_){w.toneMapping=m,f=!0;let S=a,M=s;for(let E=0;E<b.length;E++){const C=b[E];if(C.enabled!==!1&&(C.render(w,M,S,_),C.needsSwap!==!1)){const R=S;S=M,M=R}}if(d!==w.outputColorSpace||h!==w.toneMapping){d=w.outputColorSpace,h=w.toneMapping,l.defines={},Yn.getTransfer(d)===xr&&(l.defines.SRGB_TRANSFER="");const E=bve[h];E&&(l.defines[E]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=S.texture,w.setRenderTarget(x),w.render(u,c),x=null,f=!1},this.isCompositing=function(){return f},this.dispose=function(){a.dispose(),s.dispose(),o.dispose(),l.dispose()}}const sZ=new hi,K6=new p0(1,1),oZ=new w2,lZ=new S2,uZ=new vv,FO=[],BO=[],UO=new Float32Array(16),zO=new Float32Array(9),jO=new Float32Array(4);function j0(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let a=FO[i];if(a===void 0&&(a=new Float32Array(i),FO[i]=a),e!==0){r.toArray(a,0);for(let s=1,o=0;s!==e;++s)o+=n,t[s].toArray(a,o)}return a}function Ji(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Qi(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function K2(t,e){let n=BO[e];n===void 0&&(n=new Int32Array(e),BO[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function wve(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Sve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ji(n,e))return;t.uniform2fv(this.addr,e),Qi(n,e)}}function Eve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Ji(n,e))return;t.uniform3fv(this.addr,e),Qi(n,e)}}function Tve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ji(n,e))return;t.uniform4fv(this.addr,e),Qi(n,e)}}function Cve(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Ji(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Qi(n,e)}else{if(Ji(n,r))return;jO.set(r),t.uniformMatrix2fv(this.addr,!1,jO),Qi(n,r)}}function Mve(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Ji(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Qi(n,e)}else{if(Ji(n,r))return;zO.set(r),t.uniformMatrix3fv(this.addr,!1,zO),Qi(n,r)}}function Ave(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Ji(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Qi(n,e)}else{if(Ji(n,r))return;UO.set(r),t.uniformMatrix4fv(this.addr,!1,UO),Qi(n,r)}}function kve(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ive(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ji(n,e))return;t.uniform2iv(this.addr,e),Qi(n,e)}}function Nve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ji(n,e))return;t.uniform3iv(this.addr,e),Qi(n,e)}}function Rve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ji(n,e))return;t.uniform4iv(this.addr,e),Qi(n,e)}}function Pve(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Dve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Ji(n,e))return;t.uniform2uiv(this.addr,e),Qi(n,e)}}function Ove(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Ji(n,e))return;t.uniform3uiv(this.addr,e),Qi(n,e)}}function Lve(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Ji(n,e))return;t.uniform4uiv(this.addr,e),Qi(n,e)}}function Fve(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let a;this.type===t.SAMPLER_2D_SHADOW?(K6.compareFunction=n.isReversedDepthBuffer()?_2:b2,a=K6):a=sZ,n.setTexture2D(e||a,i)}function Bve(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||lZ,i)}function Uve(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||uZ,i)}function zve(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||oZ,i)}function jve(t){switch(t){case 5126:return wve;case 35664:return Sve;case 35665:return Eve;case 35666:return Tve;case 35674:return Cve;case 35675:return Mve;case 35676:return Ave;case 5124:case 35670:return kve;case 35667:case 35671:return Ive;case 35668:case 35672:return Nve;case 35669:case 35673:return Rve;case 5125:return Pve;case 36294:return Dve;case 36295:return Ove;case 36296:return Lve;case 35678:case 36198:case 36298:case 36306:case 35682:return Fve;case 35679:case 36299:case 36307:return Bve;case 35680:case 36300:case 36308:case 36293:return Uve;case 36289:case 36303:case 36311:case 36292:return zve}}function Hve(t,e){t.uniform1fv(this.addr,e)}function $ve(t,e){const n=j0(e,this.size,2);t.uniform2fv(this.addr,n)}function Vve(t,e){const n=j0(e,this.size,3);t.uniform3fv(this.addr,n)}function qve(t,e){const n=j0(e,this.size,4);t.uniform4fv(this.addr,n)}function Gve(t,e){const n=j0(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Wve(t,e){const n=j0(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Yve(t,e){const n=j0(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Xve(t,e){t.uniform1iv(this.addr,e)}function Kve(t,e){t.uniform2iv(this.addr,e)}function Zve(t,e){t.uniform3iv(this.addr,e)}function Jve(t,e){t.uniform4iv(this.addr,e)}function Qve(t,e){t.uniform1uiv(this.addr,e)}function eye(t,e){t.uniform2uiv(this.addr,e)}function tye(t,e){t.uniform3uiv(this.addr,e)}function nye(t,e){t.uniform4uiv(this.addr,e)}function rye(t,e,n){const r=this.cache,i=e.length,a=K2(n,i);Ji(r,a)||(t.uniform1iv(this.addr,a),Qi(r,a));let s;this.type===t.SAMPLER_2D_SHADOW?s=K6:s=sZ;for(let o=0;o!==i;++o)n.setTexture2D(e[o]||s,a[o])}function iye(t,e,n){const r=this.cache,i=e.length,a=K2(n,i);Ji(r,a)||(t.uniform1iv(this.addr,a),Qi(r,a));for(let s=0;s!==i;++s)n.setTexture3D(e[s]||lZ,a[s])}function aye(t,e,n){const r=this.cache,i=e.length,a=K2(n,i);Ji(r,a)||(t.uniform1iv(this.addr,a),Qi(r,a));for(let s=0;s!==i;++s)n.setTextureCube(e[s]||uZ,a[s])}function sye(t,e,n){const r=this.cache,i=e.length,a=K2(n,i);Ji(r,a)||(t.uniform1iv(this.addr,a),Qi(r,a));for(let s=0;s!==i;++s)n.setTexture2DArray(e[s]||oZ,a[s])}function oye(t){switch(t){case 5126:return Hve;case 35664:return $ve;case 35665:return Vve;case 35666:return qve;case 35674:return Gve;case 35675:return Wve;case 35676:return Yve;case 5124:case 35670:return Xve;case 35667:case 35671:return Kve;case 35668:case 35672:return Zve;case 35669:case 35673:return Jve;case 5125:return Qve;case 36294:return eye;case 36295:return tye;case 36296:return nye;case 35678:case 36198:case 36298:case 36306:case 35682:return rye;case 35679:case 36299:case 36307:return iye;case 35680:case 36300:case 36308:case 36293:return aye;case 36289:case 36303:case 36311:case 36292:return sye}}class lye{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=jve(n.type)}}class uye{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=oye(n.type)}}class cye{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let a=0,s=i.length;a!==s;++a){const o=i[a];o.setValue(e,n[o.id],r)}}}const xE=/(\w+)(\])?(\[|\.)?/g;function HO(t,e){t.seq.push(e),t.map[e.id]=e}function dye(t,e,n){const r=t.name,i=r.length;for(xE.lastIndex=0;;){const a=xE.exec(r),s=xE.lastIndex;let o=a[1];const l=a[2]==="]",u=a[3];if(l&&(o=o|0),u===void 0||u==="["&&s+2===i){HO(n,u===void 0?new lye(o,t,e):new uye(o,t,e));break}else{let d=n.map[o];d===void 0&&(d=new cye(o),HO(n,d)),n=d}}}class Ub{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const o=e.getActiveUniform(n,s),l=e.getUniformLocation(n,o.name);dye(o,l,this)}const i=[],a=[];for(const s of this.seq)s.type===e.SAMPLER_2D_SHADOW||s.type===e.SAMPLER_CUBE_SHADOW||s.type===e.SAMPLER_2D_ARRAY_SHADOW?i.push(s):a.push(s);i.length>0&&(this.seq=i.concat(a))}setValue(e,n,r,i){const a=this.map[n];a!==void 0&&a.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let a=0,s=n.length;a!==s;++a){const o=n[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,a=e.length;i!==a;++i){const s=e[i];s.id in n&&r.push(s)}return r}}function $O(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const hye=37297;let fye=0;function pye(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let s=i;s<a;s++){const o=s+1;r.push(`${o===e?">":" "} ${o}: ${n[s]}`)}return r.join(`
`)}const VO=new Sn;function mye(t){Yn._getMatrix(VO,Yn.workingColorSpace,t);const e=`mat3( ${VO.elements.map(n=>n.toFixed(4))} )`;switch(Yn.getTransfer(t)){case p1:return[e,"LinearTransferOETF"];case xr:return[e,"sRGBTransferOETF"];default:return Ut("WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function qO(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),a=(t.getShaderInfoLog(e)||"").trim();if(r&&a==="")return"";const s=/ERROR: 0:(\d+)/.exec(a);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+a+`

`+pye(t.getShaderSource(e),o)}else return a}function gye(t,e){const n=mye(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}const vye={[ON]:"Linear",[LN]:"Reinhard",[FN]:"Cineon",[d2]:"ACESFilmic",[UN]:"AgX",[zN]:"Neutral",[BN]:"Custom"};function yye(t,e){const n=vye[e];return n===void 0?(Ut("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+t+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Bx=new we;function xye(){Yn.getLuminanceCoefficients(Bx);const t=Bx.x.toFixed(4),e=Bx.y.toFixed(4),n=Bx.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function bye(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(gg).join(`
`)}function _ye(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function wye(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const a=t.getActiveAttrib(e,i),s=a.name;let o=1;a.type===t.FLOAT_MAT2&&(o=2),a.type===t.FLOAT_MAT3&&(o=3),a.type===t.FLOAT_MAT4&&(o=4),n[s]={type:a.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}function gg(t){return t!==""}function GO(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function WO(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Sye=/^[ \t]*#include +<([\w\d./]+)>/gm;function Z6(t){return t.replace(Sye,Tye)}const Eye=new Map;function Tye(t,e){let n=kn[e];if(n===void 0){const r=Eye.get(e);if(r!==void 0)n=kn[r],Ut('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return Z6(n)}const Cye=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function YO(t){return t.replace(Cye,Mye)}function Mye(t,e,n,r){let i="";for(let a=parseInt(e);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function XO(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const Aye={[Zp]:"SHADOWMAP_TYPE_PCF",[wh]:"SHADOWMAP_TYPE_VSM"};function kye(t){return Aye[t.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const Iye={[Hl]:"ENVMAP_TYPE_CUBE",[Qc]:"ENVMAP_TYPE_CUBE",[U0]:"ENVMAP_TYPE_CUBE_UV"};function Nye(t){return t.envMap===!1?"ENVMAP_TYPE_CUBE":Iye[t.envMapMode]||"ENVMAP_TYPE_CUBE"}const Rye={[Qc]:"ENVMAP_MODE_REFRACTION"};function Pye(t){return t.envMap===!1?"ENVMAP_MODE_REFLECTION":Rye[t.envMapMode]||"ENVMAP_MODE_REFLECTION"}const Dye={[mv]:"ENVMAP_BLENDING_MULTIPLY",[VX]:"ENVMAP_BLENDING_MIX",[qX]:"ENVMAP_BLENDING_ADD"};function Oye(t){return t.envMap===!1?"ENVMAP_BLENDING_NONE":Dye[t.combine]||"ENVMAP_BLENDING_NONE"}function Lye(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}function Fye(t,e,n,r){const i=t.getContext(),a=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=kye(n),u=Nye(n),c=Pye(n),d=Oye(n),h=Lye(n),f=bye(n),m=_ye(a),x=i.createProgram();let b,y,w=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(b=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(gg).join(`
`),b.length>0&&(b+=`
`),y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m].filter(gg).join(`
`),y.length>0&&(y+=`
`)):(b=[XO(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(gg).join(`
`),y=[XO(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==vo?"#define TONE_MAPPING":"",n.toneMapping!==vo?kn.tonemapping_pars_fragment:"",n.toneMapping!==vo?yye("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",kn.colorspace_pars_fragment,gye("linearToOutputTexel",n.outputColorSpace),xye(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(gg).join(`
`)),s=Z6(s),s=GO(s,n),s=WO(s,n),o=Z6(o),o=GO(o,n),o=WO(o,n),s=YO(s),o=YO(o),n.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,b=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",n.glslVersion===z6?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===z6?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=w+b+s,S=w+y+o,M=$O(i,i.VERTEX_SHADER,_),E=$O(i,i.FRAGMENT_SHADER,S);i.attachShader(x,M),i.attachShader(x,E),n.index0AttributeName!==void 0?i.bindAttribLocation(x,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(x,0,"position"),i.linkProgram(x);function C(N){if(t.debug.checkShaderErrors){const D=i.getProgramInfoLog(x)||"",F=i.getShaderInfoLog(M)||"",L=i.getShaderInfoLog(E)||"",U=D.trim(),j=F.trim(),q=L.trim();let Z=!0,Q=!0;if(i.getProgramParameter(x,i.LINK_STATUS)===!1)if(Z=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,x,M,E);else{const z=qO(i,M,"vertex"),W=qO(i,E,"fragment");tn("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(x,i.VALIDATE_STATUS)+`

Material Name: `+N.name+`
Material Type: `+N.type+`

Program Info Log: `+U+`
`+z+`
`+W)}else U!==""?Ut("WebGLProgram: Program Info Log:",U):(j===""||q==="")&&(Q=!1);Q&&(N.diagnostics={runnable:Z,programLog:U,vertexShader:{log:j,prefix:b},fragmentShader:{log:q,prefix:y}})}i.deleteShader(M),i.deleteShader(E),R=new Ub(i,x),k=wye(i,x)}let R;this.getUniforms=function(){return R===void 0&&C(this),R};let k;this.getAttributes=function(){return k===void 0&&C(this),k};let I=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=i.getProgramParameter(x,hye)),I},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(x),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=fye++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=M,this.fragmentShader=E,this}let Bye=0;class Uye{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),a=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(a)===!1&&(s.add(a),a.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new zye(e),n.set(e,r)),r}}class zye{constructor(e){this.id=Bye++,this.code=e,this.usedTimes=0}}function jye(t,e,n,r,i,a,s){const o=new h0,l=new Uye,u=new Set,c=[],d=new Map,h=i.logarithmicDepthBuffer;let f=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(k){return u.add(k),k===0?"uv":`uv${k}`}function b(k,I,N,D,F){const L=D.fog,U=F.geometry,j=k.isMeshStandardMaterial?D.environment:null,q=(k.isMeshStandardMaterial?n:e).get(k.envMap||j),Z=q&&q.mapping===U0?q.image.height:null,Q=m[k.type];k.precision!==null&&(f=i.getMaxPrecision(k.precision),f!==k.precision&&Ut("WebGLProgram.getParameters:",k.precision,"not supported, using",f,"instead."));const z=U.morphAttributes.position||U.morphAttributes.normal||U.morphAttributes.color,W=z!==void 0?z.length:0;let X=0;U.morphAttributes.position!==void 0&&(X=1),U.morphAttributes.normal!==void 0&&(X=2),U.morphAttributes.color!==void 0&&(X=3);let H,J,te,ee;if(Q){const Ht=Wo[Q];H=Ht.vertexShader,J=Ht.fragmentShader}else H=k.vertexShader,J=k.fragmentShader,l.update(k),te=l.getVertexShaderID(k),ee=l.getFragmentShaderID(k);const se=t.getRenderTarget(),ue=t.state.buffers.depth.getReversed(),oe=F.isInstancedMesh===!0,Te=F.isBatchedMesh===!0,Ne=!!k.map,be=!!k.matcap,De=!!q,ke=!!k.aoMap,Me=!!k.lightMap,Ie=!!k.bumpMap,ce=!!k.normalMap,G=!!k.displacementMap,xe=!!k.emissiveMap,Oe=!!k.metalnessMap,Fe=!!k.roughnessMap,ze=k.anisotropy>0,le=k.clearcoat>0,re=k.dispersion>0,me=k.iridescence>0,de=k.sheen>0,ve=k.transmission>0,_e=ze&&!!k.anisotropyMap,Be=le&&!!k.clearcoatMap,He=le&&!!k.clearcoatNormalMap,pt=le&&!!k.clearcoatRoughnessMap,gt=me&&!!k.iridescenceMap,We=me&&!!k.iridescenceThicknessMap,Je=de&&!!k.sheenColorMap,ot=de&&!!k.sheenRoughnessMap,Ee=!!k.specularMap,je=!!k.specularColorMap,mt=!!k.specularIntensityMap,fe=ve&&!!k.transmissionMap,$e=ve&&!!k.thicknessMap,Ge=!!k.gradientMap,st=!!k.alphaMap,Qe=k.alphaTest>0,Ye=!!k.alphaHash,ft=!!k.extensions;let Ct=vo;k.toneMapped&&(se===null||se.isXRRenderTarget===!0)&&(Ct=t.toneMapping);const At={shaderID:Q,shaderType:k.type,shaderName:k.name,vertexShader:H,fragmentShader:J,defines:k.defines,customVertexShaderID:te,customFragmentShaderID:ee,isRawShaderMaterial:k.isRawShaderMaterial===!0,glslVersion:k.glslVersion,precision:f,batching:Te,batchingColor:Te&&F._colorsTexture!==null,instancing:oe,instancingColor:oe&&F.instanceColor!==null,instancingMorph:oe&&F.morphTexture!==null,outputColorSpace:se===null?t.outputColorSpace:se.isXRRenderTarget===!0?se.texture.colorSpace:ed,alphaToCoverage:!!k.alphaToCoverage,map:Ne,matcap:be,envMap:De,envMapMode:De&&q.mapping,envMapCubeUVHeight:Z,aoMap:ke,lightMap:Me,bumpMap:Ie,normalMap:ce,displacementMap:G,emissiveMap:xe,normalMapObjectSpace:ce&&k.normalMapType===JX,normalMapTangentSpace:ce&&k.normalMapType===pd,metalnessMap:Oe,roughnessMap:Fe,anisotropy:ze,anisotropyMap:_e,clearcoat:le,clearcoatMap:Be,clearcoatNormalMap:He,clearcoatRoughnessMap:pt,dispersion:re,iridescence:me,iridescenceMap:gt,iridescenceThicknessMap:We,sheen:de,sheenColorMap:Je,sheenRoughnessMap:ot,specularMap:Ee,specularColorMap:je,specularIntensityMap:mt,transmission:ve,transmissionMap:fe,thicknessMap:$e,gradientMap:Ge,opaque:k.transparent===!1&&k.blending===Lh&&k.alphaToCoverage===!1,alphaMap:st,alphaTest:Qe,alphaHash:Ye,combine:k.combine,mapUv:Ne&&x(k.map.channel),aoMapUv:ke&&x(k.aoMap.channel),lightMapUv:Me&&x(k.lightMap.channel),bumpMapUv:Ie&&x(k.bumpMap.channel),normalMapUv:ce&&x(k.normalMap.channel),displacementMapUv:G&&x(k.displacementMap.channel),emissiveMapUv:xe&&x(k.emissiveMap.channel),metalnessMapUv:Oe&&x(k.metalnessMap.channel),roughnessMapUv:Fe&&x(k.roughnessMap.channel),anisotropyMapUv:_e&&x(k.anisotropyMap.channel),clearcoatMapUv:Be&&x(k.clearcoatMap.channel),clearcoatNormalMapUv:He&&x(k.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:pt&&x(k.clearcoatRoughnessMap.channel),iridescenceMapUv:gt&&x(k.iridescenceMap.channel),iridescenceThicknessMapUv:We&&x(k.iridescenceThicknessMap.channel),sheenColorMapUv:Je&&x(k.sheenColorMap.channel),sheenRoughnessMapUv:ot&&x(k.sheenRoughnessMap.channel),specularMapUv:Ee&&x(k.specularMap.channel),specularColorMapUv:je&&x(k.specularColorMap.channel),specularIntensityMapUv:mt&&x(k.specularIntensityMap.channel),transmissionMapUv:fe&&x(k.transmissionMap.channel),thicknessMapUv:$e&&x(k.thicknessMap.channel),alphaMapUv:st&&x(k.alphaMap.channel),vertexTangents:!!U.attributes.tangent&&(ce||ze),vertexColors:k.vertexColors,vertexAlphas:k.vertexColors===!0&&!!U.attributes.color&&U.attributes.color.itemSize===4,pointsUvs:F.isPoints===!0&&!!U.attributes.uv&&(Ne||st),fog:!!L,useFog:k.fog===!0,fogExp2:!!L&&L.isFogExp2,flatShading:k.flatShading===!0&&k.wireframe===!1,sizeAttenuation:k.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:ue,skinning:F.isSkinnedMesh===!0,morphTargets:U.morphAttributes.position!==void 0,morphNormals:U.morphAttributes.normal!==void 0,morphColors:U.morphAttributes.color!==void 0,morphTargetsCount:W,morphTextureStride:X,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:k.dithering,shadowMapEnabled:t.shadowMap.enabled&&N.length>0,shadowMapType:t.shadowMap.type,toneMapping:Ct,decodeVideoTexture:Ne&&k.map.isVideoTexture===!0&&Yn.getTransfer(k.map.colorSpace)===xr,decodeVideoTextureEmissive:xe&&k.emissiveMap.isVideoTexture===!0&&Yn.getTransfer(k.emissiveMap.colorSpace)===xr,premultipliedAlpha:k.premultipliedAlpha,doubleSided:k.side===po,flipSided:k.side===rs,useDepthPacking:k.depthPacking>=0,depthPacking:k.depthPacking||0,index0AttributeName:k.index0AttributeName,extensionClipCullDistance:ft&&k.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ft&&k.extensions.multiDraw===!0||Te)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:k.customProgramCacheKey()};return At.vertexUv1s=u.has(1),At.vertexUv2s=u.has(2),At.vertexUv3s=u.has(3),u.clear(),At}function y(k){const I=[];if(k.shaderID?I.push(k.shaderID):(I.push(k.customVertexShaderID),I.push(k.customFragmentShaderID)),k.defines!==void 0)for(const N in k.defines)I.push(N),I.push(k.defines[N]);return k.isRawShaderMaterial===!1&&(w(I,k),_(I,k),I.push(t.outputColorSpace)),I.push(k.customProgramCacheKey),I.join()}function w(k,I){k.push(I.precision),k.push(I.outputColorSpace),k.push(I.envMapMode),k.push(I.envMapCubeUVHeight),k.push(I.mapUv),k.push(I.alphaMapUv),k.push(I.lightMapUv),k.push(I.aoMapUv),k.push(I.bumpMapUv),k.push(I.normalMapUv),k.push(I.displacementMapUv),k.push(I.emissiveMapUv),k.push(I.metalnessMapUv),k.push(I.roughnessMapUv),k.push(I.anisotropyMapUv),k.push(I.clearcoatMapUv),k.push(I.clearcoatNormalMapUv),k.push(I.clearcoatRoughnessMapUv),k.push(I.iridescenceMapUv),k.push(I.iridescenceThicknessMapUv),k.push(I.sheenColorMapUv),k.push(I.sheenRoughnessMapUv),k.push(I.specularMapUv),k.push(I.specularColorMapUv),k.push(I.specularIntensityMapUv),k.push(I.transmissionMapUv),k.push(I.thicknessMapUv),k.push(I.combine),k.push(I.fogExp2),k.push(I.sizeAttenuation),k.push(I.morphTargetsCount),k.push(I.morphAttributeCount),k.push(I.numDirLights),k.push(I.numPointLights),k.push(I.numSpotLights),k.push(I.numSpotLightMaps),k.push(I.numHemiLights),k.push(I.numRectAreaLights),k.push(I.numDirLightShadows),k.push(I.numPointLightShadows),k.push(I.numSpotLightShadows),k.push(I.numSpotLightShadowsWithMaps),k.push(I.numLightProbes),k.push(I.shadowMapType),k.push(I.toneMapping),k.push(I.numClippingPlanes),k.push(I.numClipIntersection),k.push(I.depthPacking)}function _(k,I){o.disableAll(),I.instancing&&o.enable(0),I.instancingColor&&o.enable(1),I.instancingMorph&&o.enable(2),I.matcap&&o.enable(3),I.envMap&&o.enable(4),I.normalMapObjectSpace&&o.enable(5),I.normalMapTangentSpace&&o.enable(6),I.clearcoat&&o.enable(7),I.iridescence&&o.enable(8),I.alphaTest&&o.enable(9),I.vertexColors&&o.enable(10),I.vertexAlphas&&o.enable(11),I.vertexUv1s&&o.enable(12),I.vertexUv2s&&o.enable(13),I.vertexUv3s&&o.enable(14),I.vertexTangents&&o.enable(15),I.anisotropy&&o.enable(16),I.alphaHash&&o.enable(17),I.batching&&o.enable(18),I.dispersion&&o.enable(19),I.batchingColor&&o.enable(20),I.gradientMap&&o.enable(21),k.push(o.mask),o.disableAll(),I.fog&&o.enable(0),I.useFog&&o.enable(1),I.flatShading&&o.enable(2),I.logarithmicDepthBuffer&&o.enable(3),I.reversedDepthBuffer&&o.enable(4),I.skinning&&o.enable(5),I.morphTargets&&o.enable(6),I.morphNormals&&o.enable(7),I.morphColors&&o.enable(8),I.premultipliedAlpha&&o.enable(9),I.shadowMapEnabled&&o.enable(10),I.doubleSided&&o.enable(11),I.flipSided&&o.enable(12),I.useDepthPacking&&o.enable(13),I.dithering&&o.enable(14),I.transmission&&o.enable(15),I.sheen&&o.enable(16),I.opaque&&o.enable(17),I.pointsUvs&&o.enable(18),I.decodeVideoTexture&&o.enable(19),I.decodeVideoTextureEmissive&&o.enable(20),I.alphaToCoverage&&o.enable(21),k.push(o.mask)}function S(k){const I=m[k.type];let N;if(I){const D=Wo[I];N=y1.clone(D.uniforms)}else N=k.uniforms;return N}function M(k,I){let N=d.get(I);return N!==void 0?++N.usedTimes:(N=new Fye(t,I,k,a),c.push(N),d.set(I,N)),N}function E(k){if(--k.usedTimes===0){const I=c.indexOf(k);c[I]=c[c.length-1],c.pop(),d.delete(k.cacheKey),k.destroy()}}function C(k){l.remove(k)}function R(){l.dispose()}return{getParameters:b,getProgramCacheKey:y,getUniforms:S,acquireProgram:M,releaseProgram:E,releaseShaderCache:C,programs:c,dispose:R}}function Hye(){let t=new WeakMap;function e(s){return t.has(s)}function n(s){let o=t.get(s);return o===void 0&&(o={},t.set(s,o)),o}function r(s){t.delete(s)}function i(s,o,l){t.get(s)[o]=l}function a(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:a}}function $ye(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function KO(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ZO(){const t=[];let e=0;const n=[],r=[],i=[];function a(){e=0,n.length=0,r.length=0,i.length=0}function s(d,h,f,m,x,b){let y=t[e];return y===void 0?(y={id:d.id,object:d,geometry:h,material:f,groupOrder:m,renderOrder:d.renderOrder,z:x,group:b},t[e]=y):(y.id=d.id,y.object=d,y.geometry=h,y.material=f,y.groupOrder=m,y.renderOrder=d.renderOrder,y.z=x,y.group=b),e++,y}function o(d,h,f,m,x,b){const y=s(d,h,f,m,x,b);f.transmission>0?r.push(y):f.transparent===!0?i.push(y):n.push(y)}function l(d,h,f,m,x,b){const y=s(d,h,f,m,x,b);f.transmission>0?r.unshift(y):f.transparent===!0?i.unshift(y):n.unshift(y)}function u(d,h){n.length>1&&n.sort(d||$ye),r.length>1&&r.sort(h||KO),i.length>1&&i.sort(h||KO)}function c(){for(let d=e,h=t.length;d<h;d++){const f=t[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:n,transmissive:r,transparent:i,init:a,push:o,unshift:l,finish:c,sort:u}}function Vye(){let t=new WeakMap;function e(r,i){const a=t.get(r);let s;return a===void 0?(s=new ZO,t.set(r,[s])):i>=a.length?(s=new ZO,a.push(s)):s=a[i],s}function n(){t=new WeakMap}return{get:e,dispose:n}}function qye(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new we,color:new zt};break;case"SpotLight":n={position:new we,direction:new we,color:new zt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new we,color:new zt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new we,skyColor:new zt,groundColor:new zt};break;case"RectAreaLight":n={color:new zt,position:new we,halfWidth:new we,halfHeight:new we};break}return t[e.id]=n,n}}}function Gye(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dt};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let Wye=0;function Yye(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Xye(t){const e=new qye,n=Gye(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new we);const i=new we,a=new fn,s=new fn;function o(u){let c=0,d=0,h=0;for(let k=0;k<9;k++)r.probe[k].set(0,0,0);let f=0,m=0,x=0,b=0,y=0,w=0,_=0,S=0,M=0,E=0,C=0;u.sort(Yye);for(let k=0,I=u.length;k<I;k++){const N=u[k],D=N.color,F=N.intensity,L=N.distance;let U=null;if(N.shadow&&N.shadow.map&&(N.shadow.map.texture.format===Kh?U=N.shadow.map.texture:U=N.shadow.map.depthTexture||N.shadow.map.texture),N.isAmbientLight)c+=D.r*F,d+=D.g*F,h+=D.b*F;else if(N.isLightProbe){for(let j=0;j<9;j++)r.probe[j].addScaledVector(N.sh.coefficients[j],F);C++}else if(N.isDirectionalLight){const j=e.get(N);if(j.color.copy(N.color).multiplyScalar(N.intensity),N.castShadow){const q=N.shadow,Z=n.get(N);Z.shadowIntensity=q.intensity,Z.shadowBias=q.bias,Z.shadowNormalBias=q.normalBias,Z.shadowRadius=q.radius,Z.shadowMapSize=q.mapSize,r.directionalShadow[f]=Z,r.directionalShadowMap[f]=U,r.directionalShadowMatrix[f]=N.shadow.matrix,w++}r.directional[f]=j,f++}else if(N.isSpotLight){const j=e.get(N);j.position.setFromMatrixPosition(N.matrixWorld),j.color.copy(D).multiplyScalar(F),j.distance=L,j.coneCos=Math.cos(N.angle),j.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),j.decay=N.decay,r.spot[x]=j;const q=N.shadow;if(N.map&&(r.spotLightMap[M]=N.map,M++,q.updateMatrices(N),N.castShadow&&E++),r.spotLightMatrix[x]=q.matrix,N.castShadow){const Z=n.get(N);Z.shadowIntensity=q.intensity,Z.shadowBias=q.bias,Z.shadowNormalBias=q.normalBias,Z.shadowRadius=q.radius,Z.shadowMapSize=q.mapSize,r.spotShadow[x]=Z,r.spotShadowMap[x]=U,S++}x++}else if(N.isRectAreaLight){const j=e.get(N);j.color.copy(D).multiplyScalar(F),j.halfWidth.set(N.width*.5,0,0),j.halfHeight.set(0,N.height*.5,0),r.rectArea[b]=j,b++}else if(N.isPointLight){const j=e.get(N);if(j.color.copy(N.color).multiplyScalar(N.intensity),j.distance=N.distance,j.decay=N.decay,N.castShadow){const q=N.shadow,Z=n.get(N);Z.shadowIntensity=q.intensity,Z.shadowBias=q.bias,Z.shadowNormalBias=q.normalBias,Z.shadowRadius=q.radius,Z.shadowMapSize=q.mapSize,Z.shadowCameraNear=q.camera.near,Z.shadowCameraFar=q.camera.far,r.pointShadow[m]=Z,r.pointShadowMap[m]=U,r.pointShadowMatrix[m]=N.shadow.matrix,_++}r.point[m]=j,m++}else if(N.isHemisphereLight){const j=e.get(N);j.skyColor.copy(N.color).multiplyScalar(F),j.groundColor.copy(N.groundColor).multiplyScalar(F),r.hemi[y]=j,y++}}b>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Bt.LTC_FLOAT_1,r.rectAreaLTC2=Bt.LTC_FLOAT_2):(r.rectAreaLTC1=Bt.LTC_HALF_1,r.rectAreaLTC2=Bt.LTC_HALF_2)),r.ambient[0]=c,r.ambient[1]=d,r.ambient[2]=h;const R=r.hash;(R.directionalLength!==f||R.pointLength!==m||R.spotLength!==x||R.rectAreaLength!==b||R.hemiLength!==y||R.numDirectionalShadows!==w||R.numPointShadows!==_||R.numSpotShadows!==S||R.numSpotMaps!==M||R.numLightProbes!==C)&&(r.directional.length=f,r.spot.length=x,r.rectArea.length=b,r.point.length=m,r.hemi.length=y,r.directionalShadow.length=w,r.directionalShadowMap.length=w,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=S,r.spotShadowMap.length=S,r.directionalShadowMatrix.length=w,r.pointShadowMatrix.length=_,r.spotLightMatrix.length=S+M-E,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=E,r.numLightProbes=C,R.directionalLength=f,R.pointLength=m,R.spotLength=x,R.rectAreaLength=b,R.hemiLength=y,R.numDirectionalShadows=w,R.numPointShadows=_,R.numSpotShadows=S,R.numSpotMaps=M,R.numLightProbes=C,r.version=Wye++)}function l(u,c){let d=0,h=0,f=0,m=0,x=0;const b=c.matrixWorldInverse;for(let y=0,w=u.length;y<w;y++){const _=u[y];if(_.isDirectionalLight){const S=r.directional[d];S.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(b),d++}else if(_.isSpotLight){const S=r.spot[f];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(b),S.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),S.direction.sub(i),S.direction.transformDirection(b),f++}else if(_.isRectAreaLight){const S=r.rectArea[m];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(b),s.identity(),a.copy(_.matrixWorld),a.premultiply(b),s.extractRotation(a),S.halfWidth.set(_.width*.5,0,0),S.halfHeight.set(0,_.height*.5,0),S.halfWidth.applyMatrix4(s),S.halfHeight.applyMatrix4(s),m++}else if(_.isPointLight){const S=r.point[h];S.position.setFromMatrixPosition(_.matrixWorld),S.position.applyMatrix4(b),h++}else if(_.isHemisphereLight){const S=r.hemi[x];S.direction.setFromMatrixPosition(_.matrixWorld),S.direction.transformDirection(b),x++}}}return{setup:o,setupView:l,state:r}}function JO(t){const e=new Xye(t),n=[],r=[];function i(c){u.camera=c,n.length=0,r.length=0}function a(c){n.push(c)}function s(c){r.push(c)}function o(){e.setup(n)}function l(c){e.setupView(n,c)}const u={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:o,setupLightsView:l,pushLight:a,pushShadow:s}}function Kye(t){let e=new WeakMap;function n(i,a=0){const s=e.get(i);let o;return s===void 0?(o=new JO(t),e.set(i,[o])):a>=s.length?(o=new JO(t),s.push(o)):o=s[a],o}function r(){e=new WeakMap}return{get:n,dispose:r}}const Zye=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Jye=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,Qye=[new we(1,0,0),new we(-1,0,0),new we(0,1,0),new we(0,-1,0),new we(0,0,1),new we(0,0,-1)],exe=[new we(0,-1,0),new we(0,-1,0),new we(0,0,1),new we(0,0,-1),new we(0,-1,0),new we(0,-1,0)],QO=new fn,Ym=new we,bE=new we;function txe(t,e,n){let r=new z0;const i=new dt,a=new dt,s=new er,o=new q2,l=new G2,u={},c=n.maxTextureSize,d={[Uu]:rs,[rs]:Uu,[po]:po},h=new Ss({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new dt},radius:{value:4}},vertexShader:Zye,fragmentShader:Jye}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const m=new bn;m.setAttribute("position",new Xn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Kr(m,h),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Zp;let y=this.type;this.render=function(E,C,R){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||E.length===0)return;E.type===Ig&&(Ut("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),E.type=Zp);const k=t.getRenderTarget(),I=t.getActiveCubeFace(),N=t.getActiveMipmapLevel(),D=t.state;D.setBlending(Fl),D.buffers.depth.getReversed()===!0?D.buffers.color.setClear(0,0,0,0):D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);const F=y!==this.type;F&&C.traverse(function(L){L.material&&(Array.isArray(L.material)?L.material.forEach(U=>U.needsUpdate=!0):L.material.needsUpdate=!0)});for(let L=0,U=E.length;L<U;L++){const j=E[L],q=j.shadow;if(q===void 0){Ut("WebGLShadowMap:",j,"has no shadow.");continue}if(q.autoUpdate===!1&&q.needsUpdate===!1)continue;i.copy(q.mapSize);const Z=q.getFrameExtents();if(i.multiply(Z),a.copy(q.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/Z.x),i.x=a.x*Z.x,q.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/Z.y),i.y=a.y*Z.y,q.mapSize.y=a.y)),q.map===null||F===!0){if(q.map!==null&&(q.map.depthTexture!==null&&(q.map.depthTexture.dispose(),q.map.depthTexture=null),q.map.dispose()),this.type===wh){if(j.isPointLight){Ut("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}q.map=new Ys(i.x,i.y,{format:Kh,type:$l,minFilter:Pr,magFilter:Pr,generateMipmaps:!1}),q.map.texture.name=j.name+".shadowMap",q.map.depthTexture=new p0(i.x,i.y,Qa),q.map.depthTexture.name=j.name+".shadowMapDepth",q.map.depthTexture.format=Vl,q.map.depthTexture.compareFunction=null,q.map.depthTexture.minFilter=Ti,q.map.depthTexture.magFilter=Ti}else{j.isPointLight?(q.map=new e8(i.x),q.map.depthTexture=new _K(i.x,yo)):(q.map=new Ys(i.x,i.y),q.map.depthTexture=new p0(i.x,i.y,yo)),q.map.depthTexture.name=j.name+".shadowMap",q.map.depthTexture.format=Vl;const z=t.state.buffers.depth.getReversed();this.type===Zp?(q.map.depthTexture.compareFunction=z?_2:b2,q.map.depthTexture.minFilter=Pr,q.map.depthTexture.magFilter=Pr):(q.map.depthTexture.compareFunction=null,q.map.depthTexture.minFilter=Ti,q.map.depthTexture.magFilter=Ti)}q.camera.updateProjectionMatrix()}const Q=q.map.isWebGLCubeRenderTarget?6:1;for(let z=0;z<Q;z++){if(q.map.isWebGLCubeRenderTarget)t.setRenderTarget(q.map,z),t.clear();else{z===0&&(t.setRenderTarget(q.map),t.clear());const W=q.getViewport(z);s.set(a.x*W.x,a.y*W.y,a.x*W.z,a.y*W.w),D.viewport(s)}if(j.isPointLight){const W=q.camera,X=q.matrix,H=j.distance||W.far;H!==W.far&&(W.far=H,W.updateProjectionMatrix()),Ym.setFromMatrixPosition(j.matrixWorld),W.position.copy(Ym),bE.copy(W.position),bE.add(Qye[z]),W.up.copy(exe[z]),W.lookAt(bE),W.updateMatrixWorld(),X.makeTranslation(-Ym.x,-Ym.y,-Ym.z),QO.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),q._frustum.setFromProjectionMatrix(QO,W.coordinateSystem,W.reversedDepth)}else q.updateMatrices(j);r=q.getFrustum(),S(C,R,q.camera,j,this.type)}q.isPointLightShadow!==!0&&this.type===wh&&w(q,R),q.needsUpdate=!1}y=this.type,b.needsUpdate=!1,t.setRenderTarget(k,I,N)};function w(E,C){const R=e.update(x);h.defines.VSM_SAMPLES!==E.blurSamples&&(h.defines.VSM_SAMPLES=E.blurSamples,f.defines.VSM_SAMPLES=E.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new Ys(i.x,i.y,{format:Kh,type:$l})),h.uniforms.shadow_pass.value=E.map.depthTexture,h.uniforms.resolution.value=E.mapSize,h.uniforms.radius.value=E.radius,t.setRenderTarget(E.mapPass),t.clear(),t.renderBufferDirect(C,null,R,h,x,null),f.uniforms.shadow_pass.value=E.mapPass.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,t.setRenderTarget(E.map),t.clear(),t.renderBufferDirect(C,null,R,f,x,null)}function _(E,C,R,k){let I=null;const N=R.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(N!==void 0)I=N;else if(I=R.isPointLight===!0?l:o,t.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0||C.alphaToCoverage===!0){const D=I.uuid,F=C.uuid;let L=u[D];L===void 0&&(L={},u[D]=L);let U=L[F];U===void 0&&(U=I.clone(),L[F]=U,C.addEventListener("dispose",M)),I=U}if(I.visible=C.visible,I.wireframe=C.wireframe,k===wh?I.side=C.shadowSide!==null?C.shadowSide:C.side:I.side=C.shadowSide!==null?C.shadowSide:d[C.side],I.alphaMap=C.alphaMap,I.alphaTest=C.alphaToCoverage===!0?.5:C.alphaTest,I.map=C.map,I.clipShadows=C.clipShadows,I.clippingPlanes=C.clippingPlanes,I.clipIntersection=C.clipIntersection,I.displacementMap=C.displacementMap,I.displacementScale=C.displacementScale,I.displacementBias=C.displacementBias,I.wireframeLinewidth=C.wireframeLinewidth,I.linewidth=C.linewidth,R.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const D=t.properties.get(I);D.light=R}return I}function S(E,C,R,k,I){if(E.visible===!1)return;if(E.layers.test(C.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&I===wh)&&(!E.frustumCulled||r.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,E.matrixWorld);const F=e.update(E),L=E.material;if(Array.isArray(L)){const U=F.groups;for(let j=0,q=U.length;j<q;j++){const Z=U[j],Q=L[Z.materialIndex];if(Q&&Q.visible){const z=_(E,Q,k,I);E.onBeforeShadow(t,E,C,R,F,z,Z),t.renderBufferDirect(R,null,F,z,E,Z),E.onAfterShadow(t,E,C,R,F,z,Z)}}}else if(L.visible){const U=_(E,L,k,I);E.onBeforeShadow(t,E,C,R,F,U,null),t.renderBufferDirect(R,null,F,U,E,null),E.onAfterShadow(t,E,C,R,F,U,null)}}const D=E.children;for(let F=0,L=D.length;F<L;F++)S(D[F],C,R,k,I)}function M(E){E.target.removeEventListener("dispose",M);for(const R in u){const k=u[R],I=E.target.uuid;I in k&&(k[I].dispose(),delete k[I])}}}const nxe={[d_]:h_,[f_]:g_,[p_]:v_,[Xh]:m_,[h_]:d_,[g_]:f_,[v_]:p_,[m_]:Xh};function rxe(t,e){function n(){let fe=!1;const $e=new er;let Ge=null;const st=new er(0,0,0,0);return{setMask:function(Qe){Ge!==Qe&&!fe&&(t.colorMask(Qe,Qe,Qe,Qe),Ge=Qe)},setLocked:function(Qe){fe=Qe},setClear:function(Qe,Ye,ft,Ct,At){At===!0&&(Qe*=Ct,Ye*=Ct,ft*=Ct),$e.set(Qe,Ye,ft,Ct),st.equals($e)===!1&&(t.clearColor(Qe,Ye,ft,Ct),st.copy($e))},reset:function(){fe=!1,Ge=null,st.set(-1,0,0,0)}}}function r(){let fe=!1,$e=!1,Ge=null,st=null,Qe=null;return{setReversed:function(Ye){if($e!==Ye){const ft=e.get("EXT_clip_control");Ye?ft.clipControlEXT(ft.LOWER_LEFT_EXT,ft.ZERO_TO_ONE_EXT):ft.clipControlEXT(ft.LOWER_LEFT_EXT,ft.NEGATIVE_ONE_TO_ONE_EXT),$e=Ye;const Ct=Qe;Qe=null,this.setClear(Ct)}},getReversed:function(){return $e},setTest:function(Ye){Ye?se(t.DEPTH_TEST):ue(t.DEPTH_TEST)},setMask:function(Ye){Ge!==Ye&&!fe&&(t.depthMask(Ye),Ge=Ye)},setFunc:function(Ye){if($e&&(Ye=nxe[Ye]),st!==Ye){switch(Ye){case d_:t.depthFunc(t.NEVER);break;case h_:t.depthFunc(t.ALWAYS);break;case f_:t.depthFunc(t.LESS);break;case Xh:t.depthFunc(t.LEQUAL);break;case p_:t.depthFunc(t.EQUAL);break;case m_:t.depthFunc(t.GEQUAL);break;case g_:t.depthFunc(t.GREATER);break;case v_:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}st=Ye}},setLocked:function(Ye){fe=Ye},setClear:function(Ye){Qe!==Ye&&($e&&(Ye=1-Ye),t.clearDepth(Ye),Qe=Ye)},reset:function(){fe=!1,Ge=null,st=null,Qe=null,$e=!1}}}function i(){let fe=!1,$e=null,Ge=null,st=null,Qe=null,Ye=null,ft=null,Ct=null,At=null;return{setTest:function(Ht){fe||(Ht?se(t.STENCIL_TEST):ue(t.STENCIL_TEST))},setMask:function(Ht){$e!==Ht&&!fe&&(t.stencilMask(Ht),$e=Ht)},setFunc:function(Ht,wn,Vt){(Ge!==Ht||st!==wn||Qe!==Vt)&&(t.stencilFunc(Ht,wn,Vt),Ge=Ht,st=wn,Qe=Vt)},setOp:function(Ht,wn,Vt){(Ye!==Ht||ft!==wn||Ct!==Vt)&&(t.stencilOp(Ht,wn,Vt),Ye=Ht,ft=wn,Ct=Vt)},setLocked:function(Ht){fe=Ht},setClear:function(Ht){At!==Ht&&(t.clearStencil(Ht),At=Ht)},reset:function(){fe=!1,$e=null,Ge=null,st=null,Qe=null,Ye=null,ft=null,Ct=null,At=null}}}const a=new n,s=new r,o=new i,l=new WeakMap,u=new WeakMap;let c={},d={},h=new WeakMap,f=[],m=null,x=!1,b=null,y=null,w=null,_=null,S=null,M=null,E=null,C=new zt(0,0,0),R=0,k=!1,I=null,N=null,D=null,F=null,L=null;const U=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,q=0;const Z=t.getParameter(t.VERSION);Z.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(Z)[1]),j=q>=1):Z.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(Z)[1]),j=q>=2);let Q=null,z={};const W=t.getParameter(t.SCISSOR_BOX),X=t.getParameter(t.VIEWPORT),H=new er().fromArray(W),J=new er().fromArray(X);function te(fe,$e,Ge,st){const Qe=new Uint8Array(4),Ye=t.createTexture();t.bindTexture(fe,Ye),t.texParameteri(fe,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(fe,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let ft=0;ft<Ge;ft++)fe===t.TEXTURE_3D||fe===t.TEXTURE_2D_ARRAY?t.texImage3D($e,0,t.RGBA,1,1,st,0,t.RGBA,t.UNSIGNED_BYTE,Qe):t.texImage2D($e+ft,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Qe);return Ye}const ee={};ee[t.TEXTURE_2D]=te(t.TEXTURE_2D,t.TEXTURE_2D,1),ee[t.TEXTURE_CUBE_MAP]=te(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),ee[t.TEXTURE_2D_ARRAY]=te(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),ee[t.TEXTURE_3D]=te(t.TEXTURE_3D,t.TEXTURE_3D,1,1),a.setClear(0,0,0,1),s.setClear(1),o.setClear(0),se(t.DEPTH_TEST),s.setFunc(Xh),Ie(!1),ce(O6),se(t.CULL_FACE),ke(Fl);function se(fe){c[fe]!==!0&&(t.enable(fe),c[fe]=!0)}function ue(fe){c[fe]!==!1&&(t.disable(fe),c[fe]=!1)}function oe(fe,$e){return d[fe]!==$e?(t.bindFramebuffer(fe,$e),d[fe]=$e,fe===t.DRAW_FRAMEBUFFER&&(d[t.FRAMEBUFFER]=$e),fe===t.FRAMEBUFFER&&(d[t.DRAW_FRAMEBUFFER]=$e),!0):!1}function Te(fe,$e){let Ge=f,st=!1;if(fe){Ge=h.get($e),Ge===void 0&&(Ge=[],h.set($e,Ge));const Qe=fe.textures;if(Ge.length!==Qe.length||Ge[0]!==t.COLOR_ATTACHMENT0){for(let Ye=0,ft=Qe.length;Ye<ft;Ye++)Ge[Ye]=t.COLOR_ATTACHMENT0+Ye;Ge.length=Qe.length,st=!0}}else Ge[0]!==t.BACK&&(Ge[0]=t.BACK,st=!0);st&&t.drawBuffers(Ge)}function Ne(fe){return m!==fe?(t.useProgram(fe),m=fe,!0):!1}const be={[zc]:t.FUNC_ADD,[MX]:t.FUNC_SUBTRACT,[AX]:t.FUNC_REVERSE_SUBTRACT};be[kX]=t.MIN,be[IX]=t.MAX;const De={[NX]:t.ZERO,[RX]:t.ONE,[PX]:t.SRC_COLOR,[u_]:t.SRC_ALPHA,[UX]:t.SRC_ALPHA_SATURATE,[FX]:t.DST_COLOR,[OX]:t.DST_ALPHA,[DX]:t.ONE_MINUS_SRC_COLOR,[c_]:t.ONE_MINUS_SRC_ALPHA,[BX]:t.ONE_MINUS_DST_COLOR,[LX]:t.ONE_MINUS_DST_ALPHA,[zX]:t.CONSTANT_COLOR,[jX]:t.ONE_MINUS_CONSTANT_COLOR,[HX]:t.CONSTANT_ALPHA,[$X]:t.ONE_MINUS_CONSTANT_ALPHA};function ke(fe,$e,Ge,st,Qe,Ye,ft,Ct,At,Ht){if(fe===Fl){x===!0&&(ue(t.BLEND),x=!1);return}if(x===!1&&(se(t.BLEND),x=!0),fe!==CX){if(fe!==b||Ht!==k){if((y!==zc||S!==zc)&&(t.blendEquation(t.FUNC_ADD),y=zc,S=zc),Ht)switch(fe){case Lh:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case l_:t.blendFunc(t.ONE,t.ONE);break;case L6:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case F6:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:tn("WebGLState: Invalid blending: ",fe);break}else switch(fe){case Lh:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case l_:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case L6:tn("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case F6:tn("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:tn("WebGLState: Invalid blending: ",fe);break}w=null,_=null,M=null,E=null,C.set(0,0,0),R=0,b=fe,k=Ht}return}Qe=Qe||$e,Ye=Ye||Ge,ft=ft||st,($e!==y||Qe!==S)&&(t.blendEquationSeparate(be[$e],be[Qe]),y=$e,S=Qe),(Ge!==w||st!==_||Ye!==M||ft!==E)&&(t.blendFuncSeparate(De[Ge],De[st],De[Ye],De[ft]),w=Ge,_=st,M=Ye,E=ft),(Ct.equals(C)===!1||At!==R)&&(t.blendColor(Ct.r,Ct.g,Ct.b,At),C.copy(Ct),R=At),b=fe,k=!1}function Me(fe,$e){fe.side===po?ue(t.CULL_FACE):se(t.CULL_FACE);let Ge=fe.side===rs;$e&&(Ge=!Ge),Ie(Ge),fe.blending===Lh&&fe.transparent===!1?ke(Fl):ke(fe.blending,fe.blendEquation,fe.blendSrc,fe.blendDst,fe.blendEquationAlpha,fe.blendSrcAlpha,fe.blendDstAlpha,fe.blendColor,fe.blendAlpha,fe.premultipliedAlpha),s.setFunc(fe.depthFunc),s.setTest(fe.depthTest),s.setMask(fe.depthWrite),a.setMask(fe.colorWrite);const st=fe.stencilWrite;o.setTest(st),st&&(o.setMask(fe.stencilWriteMask),o.setFunc(fe.stencilFunc,fe.stencilRef,fe.stencilFuncMask),o.setOp(fe.stencilFail,fe.stencilZFail,fe.stencilZPass)),xe(fe.polygonOffset,fe.polygonOffsetFactor,fe.polygonOffsetUnits),fe.alphaToCoverage===!0?se(t.SAMPLE_ALPHA_TO_COVERAGE):ue(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ie(fe){I!==fe&&(fe?t.frontFace(t.CW):t.frontFace(t.CCW),I=fe)}function ce(fe){fe!==SX?(se(t.CULL_FACE),fe!==N&&(fe===O6?t.cullFace(t.BACK):fe===EX?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):ue(t.CULL_FACE),N=fe}function G(fe){fe!==D&&(j&&t.lineWidth(fe),D=fe)}function xe(fe,$e,Ge){fe?(se(t.POLYGON_OFFSET_FILL),(F!==$e||L!==Ge)&&(t.polygonOffset($e,Ge),F=$e,L=Ge)):ue(t.POLYGON_OFFSET_FILL)}function Oe(fe){fe?se(t.SCISSOR_TEST):ue(t.SCISSOR_TEST)}function Fe(fe){fe===void 0&&(fe=t.TEXTURE0+U-1),Q!==fe&&(t.activeTexture(fe),Q=fe)}function ze(fe,$e,Ge){Ge===void 0&&(Q===null?Ge=t.TEXTURE0+U-1:Ge=Q);let st=z[Ge];st===void 0&&(st={type:void 0,texture:void 0},z[Ge]=st),(st.type!==fe||st.texture!==$e)&&(Q!==Ge&&(t.activeTexture(Ge),Q=Ge),t.bindTexture(fe,$e||ee[fe]),st.type=fe,st.texture=$e)}function le(){const fe=z[Q];fe!==void 0&&fe.type!==void 0&&(t.bindTexture(fe.type,null),fe.type=void 0,fe.texture=void 0)}function re(){try{t.compressedTexImage2D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function me(){try{t.compressedTexImage3D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function de(){try{t.texSubImage2D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function ve(){try{t.texSubImage3D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function _e(){try{t.compressedTexSubImage2D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function Be(){try{t.compressedTexSubImage3D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function He(){try{t.texStorage2D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function pt(){try{t.texStorage3D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function gt(){try{t.texImage2D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function We(){try{t.texImage3D(...arguments)}catch(fe){tn("WebGLState:",fe)}}function Je(fe){H.equals(fe)===!1&&(t.scissor(fe.x,fe.y,fe.z,fe.w),H.copy(fe))}function ot(fe){J.equals(fe)===!1&&(t.viewport(fe.x,fe.y,fe.z,fe.w),J.copy(fe))}function Ee(fe,$e){let Ge=u.get($e);Ge===void 0&&(Ge=new WeakMap,u.set($e,Ge));let st=Ge.get(fe);st===void 0&&(st=t.getUniformBlockIndex($e,fe.name),Ge.set(fe,st))}function je(fe,$e){const st=u.get($e).get(fe);l.get($e)!==st&&(t.uniformBlockBinding($e,st,fe.__bindingPointIndex),l.set($e,st))}function mt(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),s.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},Q=null,z={},d={},h=new WeakMap,f=[],m=null,x=!1,b=null,y=null,w=null,_=null,S=null,M=null,E=null,C=new zt(0,0,0),R=0,k=!1,I=null,N=null,D=null,F=null,L=null,H.set(0,0,t.canvas.width,t.canvas.height),J.set(0,0,t.canvas.width,t.canvas.height),a.reset(),s.reset(),o.reset()}return{buffers:{color:a,depth:s,stencil:o},enable:se,disable:ue,bindFramebuffer:oe,drawBuffers:Te,useProgram:Ne,setBlending:ke,setMaterial:Me,setFlipSided:Ie,setCullFace:ce,setLineWidth:G,setPolygonOffset:xe,setScissorTest:Oe,activeTexture:Fe,bindTexture:ze,unbindTexture:le,compressedTexImage2D:re,compressedTexImage3D:me,texImage2D:gt,texImage3D:We,updateUBOMapping:Ee,uniformBlockBinding:je,texStorage2D:He,texStorage3D:pt,texSubImage2D:de,texSubImage3D:ve,compressedTexSubImage2D:_e,compressedTexSubImage3D:Be,scissor:Je,viewport:ot,reset:mt}}function ixe(t,e,n,r,i,a,s){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new dt,c=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(le,re){return f?new OffscreenCanvas(le,re):g1("canvas")}function x(le,re,me){let de=1;const ve=ze(le);if((ve.width>me||ve.height>me)&&(de=me/Math.max(ve.width,ve.height)),de<1)if(typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&le instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&le instanceof ImageBitmap||typeof VideoFrame<"u"&&le instanceof VideoFrame){const _e=Math.floor(de*ve.width),Be=Math.floor(de*ve.height);d===void 0&&(d=m(_e,Be));const He=re?m(_e,Be):d;return He.width=_e,He.height=Be,He.getContext("2d").drawImage(le,0,0,_e,Be),Ut("WebGLRenderer: Texture has been resized from ("+ve.width+"x"+ve.height+") to ("+_e+"x"+Be+")."),He}else return"data"in le&&Ut("WebGLRenderer: Image in DataTexture is too big ("+ve.width+"x"+ve.height+")."),le;return le}function b(le){return le.generateMipmaps}function y(le){t.generateMipmap(le)}function w(le){return le.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:le.isWebGL3DRenderTarget?t.TEXTURE_3D:le.isWebGLArrayRenderTarget||le.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function _(le,re,me,de,ve=!1){if(le!==null){if(t[le]!==void 0)return t[le];Ut("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+le+"'")}let _e=re;if(re===t.RED&&(me===t.FLOAT&&(_e=t.R32F),me===t.HALF_FLOAT&&(_e=t.R16F),me===t.UNSIGNED_BYTE&&(_e=t.R8)),re===t.RED_INTEGER&&(me===t.UNSIGNED_BYTE&&(_e=t.R8UI),me===t.UNSIGNED_SHORT&&(_e=t.R16UI),me===t.UNSIGNED_INT&&(_e=t.R32UI),me===t.BYTE&&(_e=t.R8I),me===t.SHORT&&(_e=t.R16I),me===t.INT&&(_e=t.R32I)),re===t.RG&&(me===t.FLOAT&&(_e=t.RG32F),me===t.HALF_FLOAT&&(_e=t.RG16F),me===t.UNSIGNED_BYTE&&(_e=t.RG8)),re===t.RG_INTEGER&&(me===t.UNSIGNED_BYTE&&(_e=t.RG8UI),me===t.UNSIGNED_SHORT&&(_e=t.RG16UI),me===t.UNSIGNED_INT&&(_e=t.RG32UI),me===t.BYTE&&(_e=t.RG8I),me===t.SHORT&&(_e=t.RG16I),me===t.INT&&(_e=t.RG32I)),re===t.RGB_INTEGER&&(me===t.UNSIGNED_BYTE&&(_e=t.RGB8UI),me===t.UNSIGNED_SHORT&&(_e=t.RGB16UI),me===t.UNSIGNED_INT&&(_e=t.RGB32UI),me===t.BYTE&&(_e=t.RGB8I),me===t.SHORT&&(_e=t.RGB16I),me===t.INT&&(_e=t.RGB32I)),re===t.RGBA_INTEGER&&(me===t.UNSIGNED_BYTE&&(_e=t.RGBA8UI),me===t.UNSIGNED_SHORT&&(_e=t.RGBA16UI),me===t.UNSIGNED_INT&&(_e=t.RGBA32UI),me===t.BYTE&&(_e=t.RGBA8I),me===t.SHORT&&(_e=t.RGBA16I),me===t.INT&&(_e=t.RGBA32I)),re===t.RGB&&(me===t.UNSIGNED_INT_5_9_9_9_REV&&(_e=t.RGB9_E5),me===t.UNSIGNED_INT_10F_11F_11F_REV&&(_e=t.R11F_G11F_B10F)),re===t.RGBA){const Be=ve?p1:Yn.getTransfer(de);me===t.FLOAT&&(_e=t.RGBA32F),me===t.HALF_FLOAT&&(_e=t.RGBA16F),me===t.UNSIGNED_BYTE&&(_e=Be===xr?t.SRGB8_ALPHA8:t.RGBA8),me===t.UNSIGNED_SHORT_4_4_4_4&&(_e=t.RGBA4),me===t.UNSIGNED_SHORT_5_5_5_1&&(_e=t.RGB5_A1)}return(_e===t.R16F||_e===t.R32F||_e===t.RG16F||_e===t.RG32F||_e===t.RGBA16F||_e===t.RGBA32F)&&e.get("EXT_color_buffer_float"),_e}function S(le,re){let me;return le?re===null||re===yo||re===l0?me=t.DEPTH24_STENCIL8:re===Qa?me=t.DEPTH32F_STENCIL8:re===o0&&(me=t.DEPTH24_STENCIL8,Ut("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):re===null||re===yo||re===l0?me=t.DEPTH_COMPONENT24:re===Qa?me=t.DEPTH_COMPONENT32F:re===o0&&(me=t.DEPTH_COMPONENT16),me}function M(le,re){return b(le)===!0||le.isFramebufferTexture&&le.minFilter!==Ti&&le.minFilter!==Pr?Math.log2(Math.max(re.width,re.height))+1:le.mipmaps!==void 0&&le.mipmaps.length>0?le.mipmaps.length:le.isCompressedTexture&&Array.isArray(le.image)?re.mipmaps.length:1}function E(le){const re=le.target;re.removeEventListener("dispose",E),R(re),re.isVideoTexture&&c.delete(re)}function C(le){const re=le.target;re.removeEventListener("dispose",C),I(re)}function R(le){const re=r.get(le);if(re.__webglInit===void 0)return;const me=le.source,de=h.get(me);if(de){const ve=de[re.__cacheKey];ve.usedTimes--,ve.usedTimes===0&&k(le),Object.keys(de).length===0&&h.delete(me)}r.remove(le)}function k(le){const re=r.get(le);t.deleteTexture(re.__webglTexture);const me=le.source,de=h.get(me);delete de[re.__cacheKey],s.memory.textures--}function I(le){const re=r.get(le);if(le.depthTexture&&(le.depthTexture.dispose(),r.remove(le.depthTexture)),le.isWebGLCubeRenderTarget)for(let de=0;de<6;de++){if(Array.isArray(re.__webglFramebuffer[de]))for(let ve=0;ve<re.__webglFramebuffer[de].length;ve++)t.deleteFramebuffer(re.__webglFramebuffer[de][ve]);else t.deleteFramebuffer(re.__webglFramebuffer[de]);re.__webglDepthbuffer&&t.deleteRenderbuffer(re.__webglDepthbuffer[de])}else{if(Array.isArray(re.__webglFramebuffer))for(let de=0;de<re.__webglFramebuffer.length;de++)t.deleteFramebuffer(re.__webglFramebuffer[de]);else t.deleteFramebuffer(re.__webglFramebuffer);if(re.__webglDepthbuffer&&t.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&t.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let de=0;de<re.__webglColorRenderbuffer.length;de++)re.__webglColorRenderbuffer[de]&&t.deleteRenderbuffer(re.__webglColorRenderbuffer[de]);re.__webglDepthRenderbuffer&&t.deleteRenderbuffer(re.__webglDepthRenderbuffer)}const me=le.textures;for(let de=0,ve=me.length;de<ve;de++){const _e=r.get(me[de]);_e.__webglTexture&&(t.deleteTexture(_e.__webglTexture),s.memory.textures--),r.remove(me[de])}r.remove(le)}let N=0;function D(){N=0}function F(){const le=N;return le>=i.maxTextures&&Ut("WebGLTextures: Trying to use "+le+" texture units while this GPU supports only "+i.maxTextures),N+=1,le}function L(le){const re=[];return re.push(le.wrapS),re.push(le.wrapT),re.push(le.wrapR||0),re.push(le.magFilter),re.push(le.minFilter),re.push(le.anisotropy),re.push(le.internalFormat),re.push(le.format),re.push(le.type),re.push(le.generateMipmaps),re.push(le.premultiplyAlpha),re.push(le.flipY),re.push(le.unpackAlignment),re.push(le.colorSpace),re.join()}function U(le,re){const me=r.get(le);if(le.isVideoTexture&&Oe(le),le.isRenderTargetTexture===!1&&le.isExternalTexture!==!0&&le.version>0&&me.__version!==le.version){const de=le.image;if(de===null)Ut("WebGLRenderer: Texture marked for update but no image data found.");else if(de.complete===!1)Ut("WebGLRenderer: Texture marked for update but image is incomplete");else{ee(me,le,re);return}}else le.isExternalTexture&&(me.__webglTexture=le.sourceTexture?le.sourceTexture:null);n.bindTexture(t.TEXTURE_2D,me.__webglTexture,t.TEXTURE0+re)}function j(le,re){const me=r.get(le);if(le.isRenderTargetTexture===!1&&le.version>0&&me.__version!==le.version){ee(me,le,re);return}else le.isExternalTexture&&(me.__webglTexture=le.sourceTexture?le.sourceTexture:null);n.bindTexture(t.TEXTURE_2D_ARRAY,me.__webglTexture,t.TEXTURE0+re)}function q(le,re){const me=r.get(le);if(le.isRenderTargetTexture===!1&&le.version>0&&me.__version!==le.version){ee(me,le,re);return}n.bindTexture(t.TEXTURE_3D,me.__webglTexture,t.TEXTURE0+re)}function Z(le,re){const me=r.get(le);if(le.isCubeDepthTexture!==!0&&le.version>0&&me.__version!==le.version){se(me,le,re);return}n.bindTexture(t.TEXTURE_CUBE_MAP,me.__webglTexture,t.TEXTURE0+re)}const Q={[c1]:t.REPEAT,[bs]:t.CLAMP_TO_EDGE,[d1]:t.MIRRORED_REPEAT},z={[Ti]:t.NEAREST,[jN]:t.NEAREST_MIPMAP_NEAREST,[$p]:t.NEAREST_MIPMAP_LINEAR,[Pr]:t.LINEAR,[Ng]:t.LINEAR_MIPMAP_NEAREST,[Il]:t.LINEAR_MIPMAP_LINEAR},W={[QX]:t.NEVER,[iK]:t.ALWAYS,[eK]:t.LESS,[b2]:t.LEQUAL,[tK]:t.EQUAL,[_2]:t.GEQUAL,[nK]:t.GREATER,[rK]:t.NOTEQUAL};function X(le,re){if(re.type===Qa&&e.has("OES_texture_float_linear")===!1&&(re.magFilter===Pr||re.magFilter===Ng||re.magFilter===$p||re.magFilter===Il||re.minFilter===Pr||re.minFilter===Ng||re.minFilter===$p||re.minFilter===Il)&&Ut("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(le,t.TEXTURE_WRAP_S,Q[re.wrapS]),t.texParameteri(le,t.TEXTURE_WRAP_T,Q[re.wrapT]),(le===t.TEXTURE_3D||le===t.TEXTURE_2D_ARRAY)&&t.texParameteri(le,t.TEXTURE_WRAP_R,Q[re.wrapR]),t.texParameteri(le,t.TEXTURE_MAG_FILTER,z[re.magFilter]),t.texParameteri(le,t.TEXTURE_MIN_FILTER,z[re.minFilter]),re.compareFunction&&(t.texParameteri(le,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(le,t.TEXTURE_COMPARE_FUNC,W[re.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(re.magFilter===Ti||re.minFilter!==$p&&re.minFilter!==Il||re.type===Qa&&e.has("OES_texture_float_linear")===!1)return;if(re.anisotropy>1||r.get(re).__currentAnisotropy){const me=e.get("EXT_texture_filter_anisotropic");t.texParameterf(le,me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(re.anisotropy,i.getMaxAnisotropy())),r.get(re).__currentAnisotropy=re.anisotropy}}}function H(le,re){let me=!1;le.__webglInit===void 0&&(le.__webglInit=!0,re.addEventListener("dispose",E));const de=re.source;let ve=h.get(de);ve===void 0&&(ve={},h.set(de,ve));const _e=L(re);if(_e!==le.__cacheKey){ve[_e]===void 0&&(ve[_e]={texture:t.createTexture(),usedTimes:0},s.memory.textures++,me=!0),ve[_e].usedTimes++;const Be=ve[le.__cacheKey];Be!==void 0&&(ve[le.__cacheKey].usedTimes--,Be.usedTimes===0&&k(re)),le.__cacheKey=_e,le.__webglTexture=ve[_e].texture}return me}function J(le,re,me){return Math.floor(Math.floor(le/me)/re)}function te(le,re,me,de){const _e=le.updateRanges;if(_e.length===0)n.texSubImage2D(t.TEXTURE_2D,0,0,0,re.width,re.height,me,de,re.data);else{_e.sort((We,Je)=>We.start-Je.start);let Be=0;for(let We=1;We<_e.length;We++){const Je=_e[Be],ot=_e[We],Ee=Je.start+Je.count,je=J(ot.start,re.width,4),mt=J(Je.start,re.width,4);ot.start<=Ee+1&&je===mt&&J(ot.start+ot.count-1,re.width,4)===je?Je.count=Math.max(Je.count,ot.start+ot.count-Je.start):(++Be,_e[Be]=ot)}_e.length=Be+1;const He=t.getParameter(t.UNPACK_ROW_LENGTH),pt=t.getParameter(t.UNPACK_SKIP_PIXELS),gt=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,re.width);for(let We=0,Je=_e.length;We<Je;We++){const ot=_e[We],Ee=Math.floor(ot.start/4),je=Math.ceil(ot.count/4),mt=Ee%re.width,fe=Math.floor(Ee/re.width),$e=je,Ge=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,mt),t.pixelStorei(t.UNPACK_SKIP_ROWS,fe),n.texSubImage2D(t.TEXTURE_2D,0,mt,fe,$e,Ge,me,de,re.data)}le.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,He),t.pixelStorei(t.UNPACK_SKIP_PIXELS,pt),t.pixelStorei(t.UNPACK_SKIP_ROWS,gt)}}function ee(le,re,me){let de=t.TEXTURE_2D;(re.isDataArrayTexture||re.isCompressedArrayTexture)&&(de=t.TEXTURE_2D_ARRAY),re.isData3DTexture&&(de=t.TEXTURE_3D);const ve=H(le,re),_e=re.source;n.bindTexture(de,le.__webglTexture,t.TEXTURE0+me);const Be=r.get(_e);if(_e.version!==Be.__version||ve===!0){n.activeTexture(t.TEXTURE0+me);const He=Yn.getPrimaries(Yn.workingColorSpace),pt=re.colorSpace===ku?null:Yn.getPrimaries(re.colorSpace),gt=re.colorSpace===ku||He===pt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,re.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,re.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,gt);let We=x(re.image,!1,i.maxTextureSize);We=Fe(re,We);const Je=a.convert(re.format,re.colorSpace),ot=a.convert(re.type);let Ee=_(re.internalFormat,Je,ot,re.colorSpace,re.isVideoTexture);X(de,re);let je;const mt=re.mipmaps,fe=re.isVideoTexture!==!0,$e=Be.__version===void 0||ve===!0,Ge=_e.dataReady,st=M(re,We);if(re.isDepthTexture)Ee=S(re.format===Vc,re.type),$e&&(fe?n.texStorage2D(t.TEXTURE_2D,1,Ee,We.width,We.height):n.texImage2D(t.TEXTURE_2D,0,Ee,We.width,We.height,0,Je,ot,null));else if(re.isDataTexture)if(mt.length>0){fe&&$e&&n.texStorage2D(t.TEXTURE_2D,st,Ee,mt[0].width,mt[0].height);for(let Qe=0,Ye=mt.length;Qe<Ye;Qe++)je=mt[Qe],fe?Ge&&n.texSubImage2D(t.TEXTURE_2D,Qe,0,0,je.width,je.height,Je,ot,je.data):n.texImage2D(t.TEXTURE_2D,Qe,Ee,je.width,je.height,0,Je,ot,je.data);re.generateMipmaps=!1}else fe?($e&&n.texStorage2D(t.TEXTURE_2D,st,Ee,We.width,We.height),Ge&&te(re,We,Je,ot)):n.texImage2D(t.TEXTURE_2D,0,Ee,We.width,We.height,0,Je,ot,We.data);else if(re.isCompressedTexture)if(re.isCompressedArrayTexture){fe&&$e&&n.texStorage3D(t.TEXTURE_2D_ARRAY,st,Ee,mt[0].width,mt[0].height,We.depth);for(let Qe=0,Ye=mt.length;Qe<Ye;Qe++)if(je=mt[Qe],re.format!==Da)if(Je!==null)if(fe){if(Ge)if(re.layerUpdates.size>0){const ft=Y6(je.width,je.height,re.format,re.type);for(const Ct of re.layerUpdates){const At=je.data.subarray(Ct*ft/je.data.BYTES_PER_ELEMENT,(Ct+1)*ft/je.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Qe,0,0,Ct,je.width,je.height,1,Je,At)}re.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Qe,0,0,0,je.width,je.height,We.depth,Je,je.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Qe,Ee,je.width,je.height,We.depth,0,je.data,0,0);else Ut("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else fe?Ge&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,Qe,0,0,0,je.width,je.height,We.depth,Je,ot,je.data):n.texImage3D(t.TEXTURE_2D_ARRAY,Qe,Ee,je.width,je.height,We.depth,0,Je,ot,je.data)}else{fe&&$e&&n.texStorage2D(t.TEXTURE_2D,st,Ee,mt[0].width,mt[0].height);for(let Qe=0,Ye=mt.length;Qe<Ye;Qe++)je=mt[Qe],re.format!==Da?Je!==null?fe?Ge&&n.compressedTexSubImage2D(t.TEXTURE_2D,Qe,0,0,je.width,je.height,Je,je.data):n.compressedTexImage2D(t.TEXTURE_2D,Qe,Ee,je.width,je.height,0,je.data):Ut("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fe?Ge&&n.texSubImage2D(t.TEXTURE_2D,Qe,0,0,je.width,je.height,Je,ot,je.data):n.texImage2D(t.TEXTURE_2D,Qe,Ee,je.width,je.height,0,Je,ot,je.data)}else if(re.isDataArrayTexture)if(fe){if($e&&n.texStorage3D(t.TEXTURE_2D_ARRAY,st,Ee,We.width,We.height,We.depth),Ge)if(re.layerUpdates.size>0){const Qe=Y6(We.width,We.height,re.format,re.type);for(const Ye of re.layerUpdates){const ft=We.data.subarray(Ye*Qe/We.data.BYTES_PER_ELEMENT,(Ye+1)*Qe/We.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Ye,We.width,We.height,1,Je,ot,ft)}re.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,We.width,We.height,We.depth,Je,ot,We.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ee,We.width,We.height,We.depth,0,Je,ot,We.data);else if(re.isData3DTexture)fe?($e&&n.texStorage3D(t.TEXTURE_3D,st,Ee,We.width,We.height,We.depth),Ge&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,We.width,We.height,We.depth,Je,ot,We.data)):n.texImage3D(t.TEXTURE_3D,0,Ee,We.width,We.height,We.depth,0,Je,ot,We.data);else if(re.isFramebufferTexture){if($e)if(fe)n.texStorage2D(t.TEXTURE_2D,st,Ee,We.width,We.height);else{let Qe=We.width,Ye=We.height;for(let ft=0;ft<st;ft++)n.texImage2D(t.TEXTURE_2D,ft,Ee,Qe,Ye,0,Je,ot,null),Qe>>=1,Ye>>=1}}else if(mt.length>0){if(fe&&$e){const Qe=ze(mt[0]);n.texStorage2D(t.TEXTURE_2D,st,Ee,Qe.width,Qe.height)}for(let Qe=0,Ye=mt.length;Qe<Ye;Qe++)je=mt[Qe],fe?Ge&&n.texSubImage2D(t.TEXTURE_2D,Qe,0,0,Je,ot,je):n.texImage2D(t.TEXTURE_2D,Qe,Ee,Je,ot,je);re.generateMipmaps=!1}else if(fe){if($e){const Qe=ze(We);n.texStorage2D(t.TEXTURE_2D,st,Ee,Qe.width,Qe.height)}Ge&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,Je,ot,We)}else n.texImage2D(t.TEXTURE_2D,0,Ee,Je,ot,We);b(re)&&y(de),Be.__version=_e.version,re.onUpdate&&re.onUpdate(re)}le.__version=re.version}function se(le,re,me){if(re.image.length!==6)return;const de=H(le,re),ve=re.source;n.bindTexture(t.TEXTURE_CUBE_MAP,le.__webglTexture,t.TEXTURE0+me);const _e=r.get(ve);if(ve.version!==_e.__version||de===!0){n.activeTexture(t.TEXTURE0+me);const Be=Yn.getPrimaries(Yn.workingColorSpace),He=re.colorSpace===ku?null:Yn.getPrimaries(re.colorSpace),pt=re.colorSpace===ku||Be===He?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,re.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,re.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,pt);const gt=re.isCompressedTexture||re.image[0].isCompressedTexture,We=re.image[0]&&re.image[0].isDataTexture,Je=[];for(let Ye=0;Ye<6;Ye++)!gt&&!We?Je[Ye]=x(re.image[Ye],!0,i.maxCubemapSize):Je[Ye]=We?re.image[Ye].image:re.image[Ye],Je[Ye]=Fe(re,Je[Ye]);const ot=Je[0],Ee=a.convert(re.format,re.colorSpace),je=a.convert(re.type),mt=_(re.internalFormat,Ee,je,re.colorSpace),fe=re.isVideoTexture!==!0,$e=_e.__version===void 0||de===!0,Ge=ve.dataReady;let st=M(re,ot);X(t.TEXTURE_CUBE_MAP,re);let Qe;if(gt){fe&&$e&&n.texStorage2D(t.TEXTURE_CUBE_MAP,st,mt,ot.width,ot.height);for(let Ye=0;Ye<6;Ye++){Qe=Je[Ye].mipmaps;for(let ft=0;ft<Qe.length;ft++){const Ct=Qe[ft];re.format!==Da?Ee!==null?fe?Ge&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft,0,0,Ct.width,Ct.height,Ee,Ct.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft,mt,Ct.width,Ct.height,0,Ct.data):Ut("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):fe?Ge&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft,0,0,Ct.width,Ct.height,Ee,je,Ct.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft,mt,Ct.width,Ct.height,0,Ee,je,Ct.data)}}}else{if(Qe=re.mipmaps,fe&&$e){Qe.length>0&&st++;const Ye=ze(Je[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,st,mt,Ye.width,Ye.height)}for(let Ye=0;Ye<6;Ye++)if(We){fe?Ge&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,0,0,Je[Ye].width,Je[Ye].height,Ee,je,Je[Ye].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,mt,Je[Ye].width,Je[Ye].height,0,Ee,je,Je[Ye].data);for(let ft=0;ft<Qe.length;ft++){const At=Qe[ft].image[Ye].image;fe?Ge&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft+1,0,0,At.width,At.height,Ee,je,At.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft+1,mt,At.width,At.height,0,Ee,je,At.data)}}else{fe?Ge&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,0,0,Ee,je,Je[Ye]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,mt,Ee,je,Je[Ye]);for(let ft=0;ft<Qe.length;ft++){const Ct=Qe[ft];fe?Ge&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft+1,0,0,Ee,je,Ct.image[Ye]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ft+1,mt,Ee,je,Ct.image[Ye])}}}b(re)&&y(t.TEXTURE_CUBE_MAP),_e.__version=ve.version,re.onUpdate&&re.onUpdate(re)}le.__version=re.version}function ue(le,re,me,de,ve,_e){const Be=a.convert(me.format,me.colorSpace),He=a.convert(me.type),pt=_(me.internalFormat,Be,He,me.colorSpace),gt=r.get(re),We=r.get(me);if(We.__renderTarget=re,!gt.__hasExternalTextures){const Je=Math.max(1,re.width>>_e),ot=Math.max(1,re.height>>_e);ve===t.TEXTURE_3D||ve===t.TEXTURE_2D_ARRAY?n.texImage3D(ve,_e,pt,Je,ot,re.depth,0,Be,He,null):n.texImage2D(ve,_e,pt,Je,ot,0,Be,He,null)}n.bindFramebuffer(t.FRAMEBUFFER,le),xe(re)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,de,ve,We.__webglTexture,0,G(re)):(ve===t.TEXTURE_2D||ve>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&ve<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,de,ve,We.__webglTexture,_e),n.bindFramebuffer(t.FRAMEBUFFER,null)}function oe(le,re,me){if(t.bindRenderbuffer(t.RENDERBUFFER,le),re.depthBuffer){const de=re.depthTexture,ve=de&&de.isDepthTexture?de.type:null,_e=S(re.stencilBuffer,ve),Be=re.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;xe(re)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,G(re),_e,re.width,re.height):me?t.renderbufferStorageMultisample(t.RENDERBUFFER,G(re),_e,re.width,re.height):t.renderbufferStorage(t.RENDERBUFFER,_e,re.width,re.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Be,t.RENDERBUFFER,le)}else{const de=re.textures;for(let ve=0;ve<de.length;ve++){const _e=de[ve],Be=a.convert(_e.format,_e.colorSpace),He=a.convert(_e.type),pt=_(_e.internalFormat,Be,He,_e.colorSpace);xe(re)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,G(re),pt,re.width,re.height):me?t.renderbufferStorageMultisample(t.RENDERBUFFER,G(re),pt,re.width,re.height):t.renderbufferStorage(t.RENDERBUFFER,pt,re.width,re.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Te(le,re,me){const de=re.isWebGLCubeRenderTarget===!0;if(n.bindFramebuffer(t.FRAMEBUFFER,le),!(re.depthTexture&&re.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ve=r.get(re.depthTexture);if(ve.__renderTarget=re,(!ve.__webglTexture||re.depthTexture.image.width!==re.width||re.depthTexture.image.height!==re.height)&&(re.depthTexture.image.width=re.width,re.depthTexture.image.height=re.height,re.depthTexture.needsUpdate=!0),de){if(ve.__webglInit===void 0&&(ve.__webglInit=!0,re.depthTexture.addEventListener("dispose",E)),ve.__webglTexture===void 0){ve.__webglTexture=t.createTexture(),n.bindTexture(t.TEXTURE_CUBE_MAP,ve.__webglTexture),X(t.TEXTURE_CUBE_MAP,re.depthTexture);const gt=a.convert(re.depthTexture.format),We=a.convert(re.depthTexture.type);let Je;re.depthTexture.format===Vl?Je=t.DEPTH_COMPONENT24:re.depthTexture.format===Vc&&(Je=t.DEPTH24_STENCIL8);for(let ot=0;ot<6;ot++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,Je,re.width,re.height,0,gt,We,null)}}else U(re.depthTexture,0);const _e=ve.__webglTexture,Be=G(re),He=de?t.TEXTURE_CUBE_MAP_POSITIVE_X+me:t.TEXTURE_2D,pt=re.depthTexture.format===Vc?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(re.depthTexture.format===Vl)xe(re)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,pt,He,_e,0,Be):t.framebufferTexture2D(t.FRAMEBUFFER,pt,He,_e,0);else if(re.depthTexture.format===Vc)xe(re)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,pt,He,_e,0,Be):t.framebufferTexture2D(t.FRAMEBUFFER,pt,He,_e,0);else throw new Error("Unknown depthTexture format")}function Ne(le){const re=r.get(le),me=le.isWebGLCubeRenderTarget===!0;if(re.__boundDepthTexture!==le.depthTexture){const de=le.depthTexture;if(re.__depthDisposeCallback&&re.__depthDisposeCallback(),de){const ve=()=>{delete re.__boundDepthTexture,delete re.__depthDisposeCallback,de.removeEventListener("dispose",ve)};de.addEventListener("dispose",ve),re.__depthDisposeCallback=ve}re.__boundDepthTexture=de}if(le.depthTexture&&!re.__autoAllocateDepthBuffer)if(me)for(let de=0;de<6;de++)Te(re.__webglFramebuffer[de],le,de);else{const de=le.texture.mipmaps;de&&de.length>0?Te(re.__webglFramebuffer[0],le,0):Te(re.__webglFramebuffer,le,0)}else if(me){re.__webglDepthbuffer=[];for(let de=0;de<6;de++)if(n.bindFramebuffer(t.FRAMEBUFFER,re.__webglFramebuffer[de]),re.__webglDepthbuffer[de]===void 0)re.__webglDepthbuffer[de]=t.createRenderbuffer(),oe(re.__webglDepthbuffer[de],le,!1);else{const ve=le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,_e=re.__webglDepthbuffer[de];t.bindRenderbuffer(t.RENDERBUFFER,_e),t.framebufferRenderbuffer(t.FRAMEBUFFER,ve,t.RENDERBUFFER,_e)}}else{const de=le.texture.mipmaps;if(de&&de.length>0?n.bindFramebuffer(t.FRAMEBUFFER,re.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,re.__webglFramebuffer),re.__webglDepthbuffer===void 0)re.__webglDepthbuffer=t.createRenderbuffer(),oe(re.__webglDepthbuffer,le,!1);else{const ve=le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,_e=re.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,_e),t.framebufferRenderbuffer(t.FRAMEBUFFER,ve,t.RENDERBUFFER,_e)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function be(le,re,me){const de=r.get(le);re!==void 0&&ue(de.__webglFramebuffer,le,le.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),me!==void 0&&Ne(le)}function De(le){const re=le.texture,me=r.get(le),de=r.get(re);le.addEventListener("dispose",C);const ve=le.textures,_e=le.isWebGLCubeRenderTarget===!0,Be=ve.length>1;if(Be||(de.__webglTexture===void 0&&(de.__webglTexture=t.createTexture()),de.__version=re.version,s.memory.textures++),_e){me.__webglFramebuffer=[];for(let He=0;He<6;He++)if(re.mipmaps&&re.mipmaps.length>0){me.__webglFramebuffer[He]=[];for(let pt=0;pt<re.mipmaps.length;pt++)me.__webglFramebuffer[He][pt]=t.createFramebuffer()}else me.__webglFramebuffer[He]=t.createFramebuffer()}else{if(re.mipmaps&&re.mipmaps.length>0){me.__webglFramebuffer=[];for(let He=0;He<re.mipmaps.length;He++)me.__webglFramebuffer[He]=t.createFramebuffer()}else me.__webglFramebuffer=t.createFramebuffer();if(Be)for(let He=0,pt=ve.length;He<pt;He++){const gt=r.get(ve[He]);gt.__webglTexture===void 0&&(gt.__webglTexture=t.createTexture(),s.memory.textures++)}if(le.samples>0&&xe(le)===!1){me.__webglMultisampledFramebuffer=t.createFramebuffer(),me.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,me.__webglMultisampledFramebuffer);for(let He=0;He<ve.length;He++){const pt=ve[He];me.__webglColorRenderbuffer[He]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,me.__webglColorRenderbuffer[He]);const gt=a.convert(pt.format,pt.colorSpace),We=a.convert(pt.type),Je=_(pt.internalFormat,gt,We,pt.colorSpace,le.isXRRenderTarget===!0),ot=G(le);t.renderbufferStorageMultisample(t.RENDERBUFFER,ot,Je,le.width,le.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+He,t.RENDERBUFFER,me.__webglColorRenderbuffer[He])}t.bindRenderbuffer(t.RENDERBUFFER,null),le.depthBuffer&&(me.__webglDepthRenderbuffer=t.createRenderbuffer(),oe(me.__webglDepthRenderbuffer,le,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(_e){n.bindTexture(t.TEXTURE_CUBE_MAP,de.__webglTexture),X(t.TEXTURE_CUBE_MAP,re);for(let He=0;He<6;He++)if(re.mipmaps&&re.mipmaps.length>0)for(let pt=0;pt<re.mipmaps.length;pt++)ue(me.__webglFramebuffer[He][pt],le,re,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+He,pt);else ue(me.__webglFramebuffer[He],le,re,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+He,0);b(re)&&y(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Be){for(let He=0,pt=ve.length;He<pt;He++){const gt=ve[He],We=r.get(gt);let Je=t.TEXTURE_2D;(le.isWebGL3DRenderTarget||le.isWebGLArrayRenderTarget)&&(Je=le.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Je,We.__webglTexture),X(Je,gt),ue(me.__webglFramebuffer,le,gt,t.COLOR_ATTACHMENT0+He,Je,0),b(gt)&&y(Je)}n.unbindTexture()}else{let He=t.TEXTURE_2D;if((le.isWebGL3DRenderTarget||le.isWebGLArrayRenderTarget)&&(He=le.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(He,de.__webglTexture),X(He,re),re.mipmaps&&re.mipmaps.length>0)for(let pt=0;pt<re.mipmaps.length;pt++)ue(me.__webglFramebuffer[pt],le,re,t.COLOR_ATTACHMENT0,He,pt);else ue(me.__webglFramebuffer,le,re,t.COLOR_ATTACHMENT0,He,0);b(re)&&y(He),n.unbindTexture()}le.depthBuffer&&Ne(le)}function ke(le){const re=le.textures;for(let me=0,de=re.length;me<de;me++){const ve=re[me];if(b(ve)){const _e=w(le),Be=r.get(ve).__webglTexture;n.bindTexture(_e,Be),y(_e),n.unbindTexture()}}}const Me=[],Ie=[];function ce(le){if(le.samples>0){if(xe(le)===!1){const re=le.textures,me=le.width,de=le.height;let ve=t.COLOR_BUFFER_BIT;const _e=le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Be=r.get(le),He=re.length>1;if(He)for(let gt=0;gt<re.length;gt++)n.bindFramebuffer(t.FRAMEBUFFER,Be.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+gt,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Be.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+gt,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Be.__webglMultisampledFramebuffer);const pt=le.texture.mipmaps;pt&&pt.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Be.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Be.__webglFramebuffer);for(let gt=0;gt<re.length;gt++){if(le.resolveDepthBuffer&&(le.depthBuffer&&(ve|=t.DEPTH_BUFFER_BIT),le.stencilBuffer&&le.resolveStencilBuffer&&(ve|=t.STENCIL_BUFFER_BIT)),He){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Be.__webglColorRenderbuffer[gt]);const We=r.get(re[gt]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,We,0)}t.blitFramebuffer(0,0,me,de,0,0,me,de,ve,t.NEAREST),l===!0&&(Me.length=0,Ie.length=0,Me.push(t.COLOR_ATTACHMENT0+gt),le.depthBuffer&&le.resolveDepthBuffer===!1&&(Me.push(_e),Ie.push(_e),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Ie)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Me))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),He)for(let gt=0;gt<re.length;gt++){n.bindFramebuffer(t.FRAMEBUFFER,Be.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+gt,t.RENDERBUFFER,Be.__webglColorRenderbuffer[gt]);const We=r.get(re[gt]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Be.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+gt,t.TEXTURE_2D,We,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Be.__webglMultisampledFramebuffer)}else if(le.depthBuffer&&le.resolveDepthBuffer===!1&&l){const re=le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[re])}}}function G(le){return Math.min(i.maxSamples,le.samples)}function xe(le){const re=r.get(le);return le.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&re.__useRenderToTexture!==!1}function Oe(le){const re=s.render.frame;c.get(le)!==re&&(c.set(le,re),le.update())}function Fe(le,re){const me=le.colorSpace,de=le.format,ve=le.type;return le.isCompressedTexture===!0||le.isVideoTexture===!0||me!==ed&&me!==ku&&(Yn.getTransfer(me)===xr?(de!==Da||ve!==Ka)&&Ut("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tn("WebGLTextures: Unsupported texture color space:",me)),re}function ze(le){return typeof HTMLImageElement<"u"&&le instanceof HTMLImageElement?(u.width=le.naturalWidth||le.width,u.height=le.naturalHeight||le.height):typeof VideoFrame<"u"&&le instanceof VideoFrame?(u.width=le.displayWidth,u.height=le.displayHeight):(u.width=le.width,u.height=le.height),u}this.allocateTextureUnit=F,this.resetTextureUnits=D,this.setTexture2D=U,this.setTexture2DArray=j,this.setTexture3D=q,this.setTextureCube=Z,this.rebindTextures=be,this.setupRenderTarget=De,this.updateRenderTargetMipmap=ke,this.updateMultisampleRenderTarget=ce,this.setupDepthRenderbuffer=Ne,this.setupFrameBufferTexture=ue,this.useMultisampledRTT=xe,this.isReversedDepthBuffer=function(){return n.buffers.depth.getReversed()}}function cZ(t,e){function n(r,i=ku){let a;const s=Yn.getTransfer(i);if(r===Ka)return t.UNSIGNED_BYTE;if(r===p2)return t.UNSIGNED_SHORT_4_4_4_4;if(r===m2)return t.UNSIGNED_SHORT_5_5_5_1;if(r===VN)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===qN)return t.UNSIGNED_INT_10F_11F_11F_REV;if(r===HN)return t.BYTE;if(r===$N)return t.SHORT;if(r===o0)return t.UNSIGNED_SHORT;if(r===f2)return t.INT;if(r===yo)return t.UNSIGNED_INT;if(r===Qa)return t.FLOAT;if(r===$l)return t.HALF_FLOAT;if(r===GN)return t.ALPHA;if(r===WN)return t.RGB;if(r===Da)return t.RGBA;if(r===Vl)return t.DEPTH_COMPONENT;if(r===Vc)return t.DEPTH_STENCIL;if(r===g2)return t.RED;if(r===gv)return t.RED_INTEGER;if(r===Kh)return t.RG;if(r===v2)return t.RG_INTEGER;if(r===y2)return t.RGBA_INTEGER;if(r===Rg||r===Pg||r===Dg||r===Og)if(s===xr)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Rg)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Pg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Dg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Og)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Rg)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Pg)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Dg)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Og)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===y_||r===x_||r===b_||r===__)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===y_)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===x_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===b_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===__)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===w_||r===S_||r===E_||r===T_||r===C_||r===M_||r===A_)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===w_||r===S_)return s===xr?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===E_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC;if(r===T_)return a.COMPRESSED_R11_EAC;if(r===C_)return a.COMPRESSED_SIGNED_R11_EAC;if(r===M_)return a.COMPRESSED_RG11_EAC;if(r===A_)return a.COMPRESSED_SIGNED_RG11_EAC}else return null;if(r===k_||r===I_||r===N_||r===R_||r===P_||r===D_||r===O_||r===L_||r===F_||r===B_||r===U_||r===z_||r===j_||r===H_)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===k_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===I_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===N_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===R_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===P_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===D_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===O_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===L_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===F_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===B_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===U_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===z_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===j_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===H_)return s===xr?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===$_||r===V_||r===q_)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===$_)return s===xr?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===V_)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===q_)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===G_||r===W_||r===Y_||r===X_)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===G_)return a.COMPRESSED_RED_RGTC1_EXT;if(r===W_)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Y_)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===X_)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===l0?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}const axe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,sxe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class oxe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n){if(this.texture===null){const r=new a8(e.texture);(e.depthNear!==n.depthNear||e.depthFar!==n.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new Ss({vertexShader:axe,fragmentShader:sxe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Kr(new Wu(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class lxe extends Wl{constructor(e,n){super();const r=this;let i=null,a=1,s=null,o="local-floor",l=1,u=null,c=null,d=null,h=null,f=null,m=null;const x=typeof XRWebGLBinding<"u",b=new oxe,y={},w=n.getContextAttributes();let _=null,S=null;const M=[],E=[],C=new dt;let R=null;const k=new Si;k.viewport=new er;const I=new Si;I.viewport=new er;const N=[k,I],D=new QK;let F=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ee){let se=M[ee];return se===void 0&&(se=new Bb,M[ee]=se),se.getTargetRaySpace()},this.getControllerGrip=function(ee){let se=M[ee];return se===void 0&&(se=new Bb,M[ee]=se),se.getGripSpace()},this.getHand=function(ee){let se=M[ee];return se===void 0&&(se=new Bb,M[ee]=se),se.getHandSpace()};function U(ee){const se=E.indexOf(ee.inputSource);if(se===-1)return;const ue=M[se];ue!==void 0&&(ue.update(ee.inputSource,ee.frame,u||s),ue.dispatchEvent({type:ee.type,data:ee.inputSource}))}function j(){i.removeEventListener("select",U),i.removeEventListener("selectstart",U),i.removeEventListener("selectend",U),i.removeEventListener("squeeze",U),i.removeEventListener("squeezestart",U),i.removeEventListener("squeezeend",U),i.removeEventListener("end",j),i.removeEventListener("inputsourceschange",q);for(let ee=0;ee<M.length;ee++){const se=E[ee];se!==null&&(E[ee]=null,M[ee].disconnect(se))}F=null,L=null,b.reset();for(const ee in y)delete y[ee];e.setRenderTarget(_),f=null,h=null,d=null,i=null,S=null,te.stop(),r.isPresenting=!1,e.setPixelRatio(R),e.setSize(C.width,C.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ee){a=ee,r.isPresenting===!0&&Ut("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ee){o=ee,r.isPresenting===!0&&Ut("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||s},this.setReferenceSpace=function(ee){u=ee},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return d===null&&x&&(d=new XRWebGLBinding(i,n)),d},this.getFrame=function(){return m},this.getSession=function(){return i},this.setSession=async function(ee){if(i=ee,i!==null){if(_=e.getRenderTarget(),i.addEventListener("select",U),i.addEventListener("selectstart",U),i.addEventListener("selectend",U),i.addEventListener("squeeze",U),i.addEventListener("squeezestart",U),i.addEventListener("squeezeend",U),i.addEventListener("end",j),i.addEventListener("inputsourceschange",q),w.xrCompatible!==!0&&await n.makeXRCompatible(),R=e.getPixelRatio(),e.getSize(C),x&&"createProjectionLayer"in XRWebGLBinding.prototype){let ue=null,oe=null,Te=null;w.depth&&(Te=w.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,ue=w.stencil?Vc:Vl,oe=w.stencil?l0:yo);const Ne={colorFormat:n.RGBA8,depthFormat:Te,scaleFactor:a};d=this.getBinding(),h=d.createProjectionLayer(Ne),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),S=new Ys(h.textureWidth,h.textureHeight,{format:Da,type:Ka,depthTexture:new p0(h.textureWidth,h.textureHeight,oe,void 0,void 0,void 0,void 0,void 0,void 0,ue),stencilBuffer:w.stencil,colorSpace:e.outputColorSpace,samples:w.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1,resolveStencilBuffer:h.ignoreDepthValues===!1})}else{const ue={antialias:w.antialias,alpha:!0,depth:w.depth,stencil:w.stencil,framebufferScaleFactor:a};f=new XRWebGLLayer(i,n,ue),i.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),S=new Ys(f.framebufferWidth,f.framebufferHeight,{format:Da,type:Ka,colorSpace:e.outputColorSpace,stencilBuffer:w.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}S.isXRRenderTarget=!0,this.setFoveation(l),u=null,s=await i.requestReferenceSpace(o),te.setContext(i),te.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function q(ee){for(let se=0;se<ee.removed.length;se++){const ue=ee.removed[se],oe=E.indexOf(ue);oe>=0&&(E[oe]=null,M[oe].disconnect(ue))}for(let se=0;se<ee.added.length;se++){const ue=ee.added[se];let oe=E.indexOf(ue);if(oe===-1){for(let Ne=0;Ne<M.length;Ne++)if(Ne>=E.length){E.push(ue),oe=Ne;break}else if(E[Ne]===null){E[Ne]=ue,oe=Ne;break}if(oe===-1)break}const Te=M[oe];Te&&Te.connect(ue)}}const Z=new we,Q=new we;function z(ee,se,ue){Z.setFromMatrixPosition(se.matrixWorld),Q.setFromMatrixPosition(ue.matrixWorld);const oe=Z.distanceTo(Q),Te=se.projectionMatrix.elements,Ne=ue.projectionMatrix.elements,be=Te[14]/(Te[10]-1),De=Te[14]/(Te[10]+1),ke=(Te[9]+1)/Te[5],Me=(Te[9]-1)/Te[5],Ie=(Te[8]-1)/Te[0],ce=(Ne[8]+1)/Ne[0],G=be*Ie,xe=be*ce,Oe=oe/(-Ie+ce),Fe=Oe*-Ie;if(se.matrixWorld.decompose(ee.position,ee.quaternion,ee.scale),ee.translateX(Fe),ee.translateZ(Oe),ee.matrixWorld.compose(ee.position,ee.quaternion,ee.scale),ee.matrixWorldInverse.copy(ee.matrixWorld).invert(),Te[10]===-1)ee.projectionMatrix.copy(se.projectionMatrix),ee.projectionMatrixInverse.copy(se.projectionMatrixInverse);else{const ze=be+Oe,le=De+Oe,re=G-Fe,me=xe+(oe-Fe),de=ke*De/le*ze,ve=Me*De/le*ze;ee.projectionMatrix.makePerspective(re,me,de,ve,ze,le),ee.projectionMatrixInverse.copy(ee.projectionMatrix).invert()}}function W(ee,se){se===null?ee.matrixWorld.copy(ee.matrix):ee.matrixWorld.multiplyMatrices(se.matrixWorld,ee.matrix),ee.matrixWorldInverse.copy(ee.matrixWorld).invert()}this.updateCamera=function(ee){if(i===null)return;let se=ee.near,ue=ee.far;b.texture!==null&&(b.depthNear>0&&(se=b.depthNear),b.depthFar>0&&(ue=b.depthFar)),D.near=I.near=k.near=se,D.far=I.far=k.far=ue,(F!==D.near||L!==D.far)&&(i.updateRenderState({depthNear:D.near,depthFar:D.far}),F=D.near,L=D.far),D.layers.mask=ee.layers.mask|6,k.layers.mask=D.layers.mask&3,I.layers.mask=D.layers.mask&5;const oe=ee.parent,Te=D.cameras;W(D,oe);for(let Ne=0;Ne<Te.length;Ne++)W(Te[Ne],oe);Te.length===2?z(D,k,I):D.projectionMatrix.copy(k.projectionMatrix),X(ee,D,oe)};function X(ee,se,ue){ue===null?ee.matrix.copy(se.matrixWorld):(ee.matrix.copy(ue.matrixWorld),ee.matrix.invert(),ee.matrix.multiply(se.matrixWorld)),ee.matrix.decompose(ee.position,ee.quaternion,ee.scale),ee.updateMatrixWorld(!0),ee.projectionMatrix.copy(se.projectionMatrix),ee.projectionMatrixInverse.copy(se.projectionMatrixInverse),ee.isPerspectiveCamera&&(ee.fov=d0*2*Math.atan(1/ee.projectionMatrix.elements[5]),ee.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(h===null&&f===null))return l},this.setFoveation=function(ee){l=ee,h!==null&&(h.fixedFoveation=ee),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=ee)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(D)},this.getCameraTexture=function(ee){return y[ee]};let H=null;function J(ee,se){if(c=se.getViewerPose(u||s),m=se,c!==null){const ue=c.views;f!==null&&(e.setRenderTargetFramebuffer(S,f.framebuffer),e.setRenderTarget(S));let oe=!1;ue.length!==D.cameras.length&&(D.cameras.length=0,oe=!0);for(let De=0;De<ue.length;De++){const ke=ue[De];let Me=null;if(f!==null)Me=f.getViewport(ke);else{const ce=d.getViewSubImage(h,ke);Me=ce.viewport,De===0&&(e.setRenderTargetTextures(S,ce.colorTexture,ce.depthStencilTexture),e.setRenderTarget(S))}let Ie=N[De];Ie===void 0&&(Ie=new Si,Ie.layers.enable(De),Ie.viewport=new er,N[De]=Ie),Ie.matrix.fromArray(ke.transform.matrix),Ie.matrix.decompose(Ie.position,Ie.quaternion,Ie.scale),Ie.projectionMatrix.fromArray(ke.projectionMatrix),Ie.projectionMatrixInverse.copy(Ie.projectionMatrix).invert(),Ie.viewport.set(Me.x,Me.y,Me.width,Me.height),De===0&&(D.matrix.copy(Ie.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),oe===!0&&D.cameras.push(Ie)}const Te=i.enabledFeatures;if(Te&&Te.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&x){d=r.getBinding();const De=d.getDepthInformation(ue[0]);De&&De.isValid&&De.texture&&b.init(De,i.renderState)}if(Te&&Te.includes("camera-access")&&x){e.state.unbindTexture(),d=r.getBinding();for(let De=0;De<ue.length;De++){const ke=ue[De].camera;if(ke){let Me=y[ke];Me||(Me=new a8,y[ke]=Me);const Ie=d.getCameraImage(ke);Me.sourceTexture=Ie}}}}for(let ue=0;ue<M.length;ue++){const oe=E[ue],Te=M[ue];oe!==null&&Te!==void 0&&Te.update(oe,se,u||s)}H&&H(ee,se),se.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:se}),m=null}const te=new aZ;te.setAnimationLoop(J),this.setAnimationLoop=function(ee){H=ee},this.dispose=function(){}}}const ih=new Js,uxe=new fn;function cxe(t,e){function n(b,y){b.matrixAutoUpdate===!0&&b.updateMatrix(),y.value.copy(b.matrix)}function r(b,y){y.color.getRGB(b.fogColor.value,cK(t)),y.isFog?(b.fogNear.value=y.near,b.fogFar.value=y.far):y.isFogExp2&&(b.fogDensity.value=y.density)}function i(b,y,w,_,S){y.isMeshBasicMaterial||y.isMeshLambertMaterial?a(b,y):y.isMeshToonMaterial?(a(b,y),d(b,y)):y.isMeshPhongMaterial?(a(b,y),c(b,y)):y.isMeshStandardMaterial?(a(b,y),h(b,y),y.isMeshPhysicalMaterial&&f(b,y,S)):y.isMeshMatcapMaterial?(a(b,y),m(b,y)):y.isMeshDepthMaterial?a(b,y):y.isMeshDistanceMaterial?(a(b,y),x(b,y)):y.isMeshNormalMaterial?a(b,y):y.isLineBasicMaterial?(s(b,y),y.isLineDashedMaterial&&o(b,y)):y.isPointsMaterial?l(b,y,w,_):y.isSpriteMaterial?u(b,y):y.isShadowMaterial?(b.color.value.copy(y.color),b.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function a(b,y){b.opacity.value=y.opacity,y.color&&b.diffuse.value.copy(y.color),y.emissive&&b.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(b.map.value=y.map,n(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,n(y.alphaMap,b.alphaMapTransform)),y.bumpMap&&(b.bumpMap.value=y.bumpMap,n(y.bumpMap,b.bumpMapTransform),b.bumpScale.value=y.bumpScale,y.side===rs&&(b.bumpScale.value*=-1)),y.normalMap&&(b.normalMap.value=y.normalMap,n(y.normalMap,b.normalMapTransform),b.normalScale.value.copy(y.normalScale),y.side===rs&&b.normalScale.value.negate()),y.displacementMap&&(b.displacementMap.value=y.displacementMap,n(y.displacementMap,b.displacementMapTransform),b.displacementScale.value=y.displacementScale,b.displacementBias.value=y.displacementBias),y.emissiveMap&&(b.emissiveMap.value=y.emissiveMap,n(y.emissiveMap,b.emissiveMapTransform)),y.specularMap&&(b.specularMap.value=y.specularMap,n(y.specularMap,b.specularMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest);const w=e.get(y),_=w.envMap,S=w.envMapRotation;_&&(b.envMap.value=_,ih.copy(S),ih.x*=-1,ih.y*=-1,ih.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(ih.y*=-1,ih.z*=-1),b.envMapRotation.value.setFromMatrix4(uxe.makeRotationFromEuler(ih)),b.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,b.reflectivity.value=y.reflectivity,b.ior.value=y.ior,b.refractionRatio.value=y.refractionRatio),y.lightMap&&(b.lightMap.value=y.lightMap,b.lightMapIntensity.value=y.lightMapIntensity,n(y.lightMap,b.lightMapTransform)),y.aoMap&&(b.aoMap.value=y.aoMap,b.aoMapIntensity.value=y.aoMapIntensity,n(y.aoMap,b.aoMapTransform))}function s(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,y.map&&(b.map.value=y.map,n(y.map,b.mapTransform))}function o(b,y){b.dashSize.value=y.dashSize,b.totalSize.value=y.dashSize+y.gapSize,b.scale.value=y.scale}function l(b,y,w,_){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.size.value=y.size*w,b.scale.value=_*.5,y.map&&(b.map.value=y.map,n(y.map,b.uvTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,n(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function u(b,y){b.diffuse.value.copy(y.color),b.opacity.value=y.opacity,b.rotation.value=y.rotation,y.map&&(b.map.value=y.map,n(y.map,b.mapTransform)),y.alphaMap&&(b.alphaMap.value=y.alphaMap,n(y.alphaMap,b.alphaMapTransform)),y.alphaTest>0&&(b.alphaTest.value=y.alphaTest)}function c(b,y){b.specular.value.copy(y.specular),b.shininess.value=Math.max(y.shininess,1e-4)}function d(b,y){y.gradientMap&&(b.gradientMap.value=y.gradientMap)}function h(b,y){b.metalness.value=y.metalness,y.metalnessMap&&(b.metalnessMap.value=y.metalnessMap,n(y.metalnessMap,b.metalnessMapTransform)),b.roughness.value=y.roughness,y.roughnessMap&&(b.roughnessMap.value=y.roughnessMap,n(y.roughnessMap,b.roughnessMapTransform)),y.envMap&&(b.envMapIntensity.value=y.envMapIntensity)}function f(b,y,w){b.ior.value=y.ior,y.sheen>0&&(b.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),b.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(b.sheenColorMap.value=y.sheenColorMap,n(y.sheenColorMap,b.sheenColorMapTransform)),y.sheenRoughnessMap&&(b.sheenRoughnessMap.value=y.sheenRoughnessMap,n(y.sheenRoughnessMap,b.sheenRoughnessMapTransform))),y.clearcoat>0&&(b.clearcoat.value=y.clearcoat,b.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(b.clearcoatMap.value=y.clearcoatMap,n(y.clearcoatMap,b.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(b.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,n(y.clearcoatRoughnessMap,b.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(b.clearcoatNormalMap.value=y.clearcoatNormalMap,n(y.clearcoatNormalMap,b.clearcoatNormalMapTransform),b.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===rs&&b.clearcoatNormalScale.value.negate())),y.dispersion>0&&(b.dispersion.value=y.dispersion),y.iridescence>0&&(b.iridescence.value=y.iridescence,b.iridescenceIOR.value=y.iridescenceIOR,b.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(b.iridescenceMap.value=y.iridescenceMap,n(y.iridescenceMap,b.iridescenceMapTransform)),y.iridescenceThicknessMap&&(b.iridescenceThicknessMap.value=y.iridescenceThicknessMap,n(y.iridescenceThicknessMap,b.iridescenceThicknessMapTransform))),y.transmission>0&&(b.transmission.value=y.transmission,b.transmissionSamplerMap.value=w.texture,b.transmissionSamplerSize.value.set(w.width,w.height),y.transmissionMap&&(b.transmissionMap.value=y.transmissionMap,n(y.transmissionMap,b.transmissionMapTransform)),b.thickness.value=y.thickness,y.thicknessMap&&(b.thicknessMap.value=y.thicknessMap,n(y.thicknessMap,b.thicknessMapTransform)),b.attenuationDistance.value=y.attenuationDistance,b.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(b.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(b.anisotropyMap.value=y.anisotropyMap,n(y.anisotropyMap,b.anisotropyMapTransform))),b.specularIntensity.value=y.specularIntensity,b.specularColor.value.copy(y.specularColor),y.specularColorMap&&(b.specularColorMap.value=y.specularColorMap,n(y.specularColorMap,b.specularColorMapTransform)),y.specularIntensityMap&&(b.specularIntensityMap.value=y.specularIntensityMap,n(y.specularIntensityMap,b.specularIntensityMapTransform))}function m(b,y){y.matcap&&(b.matcap.value=y.matcap)}function x(b,y){const w=e.get(y).light;b.referencePosition.value.setFromMatrixPosition(w.matrixWorld),b.nearDistance.value=w.shadow.camera.near,b.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function dxe(t,e,n,r){let i={},a={},s=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(w,_){const S=_.program;r.uniformBlockBinding(w,S)}function u(w,_){let S=i[w.id];S===void 0&&(m(w),S=c(w),i[w.id]=S,w.addEventListener("dispose",b));const M=_.program;r.updateUBOMapping(w,M);const E=e.render.frame;a[w.id]!==E&&(h(w),a[w.id]=E)}function c(w){const _=d();w.__bindingPointIndex=_;const S=t.createBuffer(),M=w.__size,E=w.usage;return t.bindBuffer(t.UNIFORM_BUFFER,S),t.bufferData(t.UNIFORM_BUFFER,M,E),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,_,S),S}function d(){for(let w=0;w<o;w++)if(s.indexOf(w)===-1)return s.push(w),w;return tn("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(w){const _=i[w.id],S=w.uniforms,M=w.__cache;t.bindBuffer(t.UNIFORM_BUFFER,_);for(let E=0,C=S.length;E<C;E++){const R=Array.isArray(S[E])?S[E]:[S[E]];for(let k=0,I=R.length;k<I;k++){const N=R[k];if(f(N,E,k,M)===!0){const D=N.__offset,F=Array.isArray(N.value)?N.value:[N.value];let L=0;for(let U=0;U<F.length;U++){const j=F[U],q=x(j);typeof j=="number"||typeof j=="boolean"?(N.__data[0]=j,t.bufferSubData(t.UNIFORM_BUFFER,D+L,N.__data)):j.isMatrix3?(N.__data[0]=j.elements[0],N.__data[1]=j.elements[1],N.__data[2]=j.elements[2],N.__data[3]=0,N.__data[4]=j.elements[3],N.__data[5]=j.elements[4],N.__data[6]=j.elements[5],N.__data[7]=0,N.__data[8]=j.elements[6],N.__data[9]=j.elements[7],N.__data[10]=j.elements[8],N.__data[11]=0):(j.toArray(N.__data,L),L+=q.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,D,N.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function f(w,_,S,M){const E=w.value,C=_+"_"+S;if(M[C]===void 0)return typeof E=="number"||typeof E=="boolean"?M[C]=E:M[C]=E.clone(),!0;{const R=M[C];if(typeof E=="number"||typeof E=="boolean"){if(R!==E)return M[C]=E,!0}else if(R.equals(E)===!1)return R.copy(E),!0}return!1}function m(w){const _=w.uniforms;let S=0;const M=16;for(let C=0,R=_.length;C<R;C++){const k=Array.isArray(_[C])?_[C]:[_[C]];for(let I=0,N=k.length;I<N;I++){const D=k[I],F=Array.isArray(D.value)?D.value:[D.value];for(let L=0,U=F.length;L<U;L++){const j=F[L],q=x(j),Z=S%M,Q=Z%q.boundary,z=Z+Q;S+=Q,z!==0&&M-z<q.storage&&(S+=M-z),D.__data=new Float32Array(q.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=S,S+=q.storage}}}const E=S%M;return E>0&&(S+=M-E),w.__size=S,w.__cache={},this}function x(w){const _={boundary:0,storage:0};return typeof w=="number"||typeof w=="boolean"?(_.boundary=4,_.storage=4):w.isVector2?(_.boundary=8,_.storage=8):w.isVector3||w.isColor?(_.boundary=16,_.storage=12):w.isVector4?(_.boundary=16,_.storage=16):w.isMatrix3?(_.boundary=48,_.storage=48):w.isMatrix4?(_.boundary=64,_.storage=64):w.isTexture?Ut("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ut("WebGLRenderer: Unsupported uniform value type.",w),_}function b(w){const _=w.target;_.removeEventListener("dispose",b);const S=s.indexOf(_.__bindingPointIndex);s.splice(S,1),t.deleteBuffer(i[_.id]),delete i[_.id],delete a[_.id]}function y(){for(const w in i)t.deleteBuffer(i[w]);s=[],i={},a={}}return{bind:l,update:u,dispose:y}}const hxe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let xl=null;function fxe(){return xl===null&&(xl=new tl(hxe,16,16,Kh,$l),xl.name="DFG_LUT",xl.minFilter=Pr,xl.magFilter=Pr,xl.wrapS=bs,xl.wrapT=bs,xl.generateMipmaps=!1,xl.needsUpdate=!0),xl}class dZ{constructor(e={}){const{canvas:n=oK(),context:r=null,depth:i=!0,stencil:a=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:d=!1,reversedDepthBuffer:h=!1,outputBufferType:f=Ka}=e;this.isWebGLRenderer=!0;let m;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=r.getContextAttributes().alpha}else m=s;const x=f,b=new Set([y2,v2,gv]),y=new Set([Ka,yo,o0,l0,p2,m2]),w=new Uint32Array(4),_=new Int32Array(4);let S=null,M=null;const E=[],C=[];let R=null;this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=vo,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const k=this;let I=!1;this._outputColorSpace=Na;let N=0,D=0,F=null,L=-1,U=null;const j=new er,q=new er;let Z=null;const Q=new zt(0);let z=0,W=n.width,X=n.height,H=1,J=null,te=null;const ee=new er(0,0,W,X),se=new er(0,0,W,X);let ue=!1;const oe=new z0;let Te=!1,Ne=!1;const be=new fn,De=new we,ke=new er,Me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ie=!1;function ce(){return F===null?H:1}let G=r;function xe(ge,qe){return n.getContext(ge,qe)}try{const ge={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:d};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${B0}`),n.addEventListener("webglcontextlost",Ct,!1),n.addEventListener("webglcontextrestored",At,!1),n.addEventListener("webglcontextcreationerror",Ht,!1),G===null){const qe="webgl2";if(G=xe(qe,ge),G===null)throw xe(qe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ge){throw tn("WebGLRenderer: "+ge.message),ge}let Oe,Fe,ze,le,re,me,de,ve,_e,Be,He,pt,gt,We,Je,ot,Ee,je,mt,fe,$e,Ge,st,Qe;function Ye(){Oe=new pve(G),Oe.init(),Ge=new cZ(G,Oe),Fe=new ave(G,Oe,e,Ge),ze=new rxe(G,Oe),Fe.reversedDepthBuffer&&h&&ze.buffers.depth.setReversed(!0),le=new vve(G),re=new Hye,me=new ixe(G,Oe,ze,re,Fe,Ge,le),de=new ove(k),ve=new fve(k),_e=new _me(G),st=new rve(G,_e),Be=new mve(G,_e,le,st),He=new xve(G,Be,_e,le),mt=new yve(G,Fe,me),ot=new sve(re),pt=new jye(k,de,ve,Oe,Fe,st,ot),gt=new cxe(k,re),We=new Vye,Je=new Kye(Oe),je=new nve(k,de,ve,ze,He,m,l),Ee=new txe(k,He,Fe),Qe=new dxe(G,le,Fe,ze),fe=new ive(G,Oe,le),$e=new gve(G,Oe,le),le.programs=pt.programs,k.capabilities=Fe,k.extensions=Oe,k.properties=re,k.renderLists=We,k.shadowMap=Ee,k.state=ze,k.info=le}Ye(),x!==Ka&&(R=new _ve(x,n.width,n.height,i,a));const ft=new lxe(k,G);this.xr=ft,this.getContext=function(){return G},this.getContextAttributes=function(){return G.getContextAttributes()},this.forceContextLoss=function(){const ge=Oe.get("WEBGL_lose_context");ge&&ge.loseContext()},this.forceContextRestore=function(){const ge=Oe.get("WEBGL_lose_context");ge&&ge.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(ge){ge!==void 0&&(H=ge,this.setSize(W,X,!1))},this.getSize=function(ge){return ge.set(W,X)},this.setSize=function(ge,qe,Xe=!0){if(ft.isPresenting){Ut("WebGLRenderer: Can't change size while VR device is presenting.");return}W=ge,X=qe,n.width=Math.floor(ge*H),n.height=Math.floor(qe*H),Xe===!0&&(n.style.width=ge+"px",n.style.height=qe+"px"),R!==null&&R.setSize(n.width,n.height),this.setViewport(0,0,ge,qe)},this.getDrawingBufferSize=function(ge){return ge.set(W*H,X*H).floor()},this.setDrawingBufferSize=function(ge,qe,Xe){W=ge,X=qe,H=Xe,n.width=Math.floor(ge*Xe),n.height=Math.floor(qe*Xe),this.setViewport(0,0,ge,qe)},this.setEffects=function(ge){if(x===Ka){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(ge){for(let qe=0;qe<ge.length;qe++)if(ge[qe].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}R.setEffects(ge||[])},this.getCurrentViewport=function(ge){return ge.copy(j)},this.getViewport=function(ge){return ge.copy(ee)},this.setViewport=function(ge,qe,Xe,nt){ge.isVector4?ee.set(ge.x,ge.y,ge.z,ge.w):ee.set(ge,qe,Xe,nt),ze.viewport(j.copy(ee).multiplyScalar(H).round())},this.getScissor=function(ge){return ge.copy(se)},this.setScissor=function(ge,qe,Xe,nt){ge.isVector4?se.set(ge.x,ge.y,ge.z,ge.w):se.set(ge,qe,Xe,nt),ze.scissor(q.copy(se).multiplyScalar(H).round())},this.getScissorTest=function(){return ue},this.setScissorTest=function(ge){ze.setScissorTest(ue=ge)},this.setOpaqueSort=function(ge){J=ge},this.setTransparentSort=function(ge){te=ge},this.getClearColor=function(ge){return ge.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor(...arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha(...arguments)},this.clear=function(ge=!0,qe=!0,Xe=!0){let nt=0;if(ge){let Ke=!1;if(F!==null){const St=F.texture.format;Ke=b.has(St)}if(Ke){const St=F.texture.type,Lt=y.has(St),yt=je.getClearColor(),$t=je.getClearAlpha(),Gt=yt.r,nn=yt.g,Qt=yt.b;Lt?(w[0]=Gt,w[1]=nn,w[2]=Qt,w[3]=$t,G.clearBufferuiv(G.COLOR,0,w)):(_[0]=Gt,_[1]=nn,_[2]=Qt,_[3]=$t,G.clearBufferiv(G.COLOR,0,_))}else nt|=G.COLOR_BUFFER_BIT}qe&&(nt|=G.DEPTH_BUFFER_BIT),Xe&&(nt|=G.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),G.clear(nt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ct,!1),n.removeEventListener("webglcontextrestored",At,!1),n.removeEventListener("webglcontextcreationerror",Ht,!1),je.dispose(),We.dispose(),Je.dispose(),re.dispose(),de.dispose(),ve.dispose(),He.dispose(),st.dispose(),Qe.dispose(),pt.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",Gr),ft.removeEventListener("sessionend",pi),fr.stop()};function Ct(ge){ge.preventDefault(),v1("WebGLRenderer: Context Lost."),I=!0}function At(){v1("WebGLRenderer: Context Restored."),I=!1;const ge=le.autoReset,qe=Ee.enabled,Xe=Ee.autoUpdate,nt=Ee.needsUpdate,Ke=Ee.type;Ye(),le.autoReset=ge,Ee.enabled=qe,Ee.autoUpdate=Xe,Ee.needsUpdate=nt,Ee.type=Ke}function Ht(ge){tn("WebGLRenderer: A WebGL context could not be created. Reason: ",ge.statusMessage)}function wn(ge){const qe=ge.target;qe.removeEventListener("dispose",wn),Vt(qe)}function Vt(ge){En(ge),re.remove(ge)}function En(ge){const qe=re.get(ge).programs;qe!==void 0&&(qe.forEach(function(Xe){pt.releaseProgram(Xe)}),ge.isShaderMaterial&&pt.releaseShaderCache(ge))}this.renderBufferDirect=function(ge,qe,Xe,nt,Ke,St){qe===null&&(qe=Me);const Lt=Ke.isMesh&&Ke.matrixWorld.determinant()<0,yt=Kt(ge,qe,Xe,nt,Ke);ze.setMaterial(nt,Lt);let $t=Xe.index,Gt=1;if(nt.wireframe===!0){if($t=Be.getWireframeAttribute(Xe),$t===void 0)return;Gt=2}const nn=Xe.drawRange,Qt=Xe.attributes.position;let _n=nn.start*Gt,Dn=(nn.start+nn.count)*Gt;St!==null&&(_n=Math.max(_n,St.start*Gt),Dn=Math.min(Dn,(St.start+St.count)*Gt)),$t!==null?(_n=Math.max(_n,0),Dn=Math.min(Dn,$t.count)):Qt!=null&&(_n=Math.max(_n,0),Dn=Math.min(Dn,Qt.count));const lr=Dn-_n;if(lr<0||lr===1/0)return;st.setup(Ke,nt,yt,Xe,$t);let qn,mn=fe;if($t!==null&&(qn=_e.get($t),mn=$e,mn.setIndex(qn)),Ke.isMesh)nt.wireframe===!0?(ze.setLineWidth(nt.wireframeLinewidth*ce()),mn.setMode(G.LINES)):mn.setMode(G.TRIANGLES);else if(Ke.isLine){let Dt=nt.linewidth;Dt===void 0&&(Dt=1),ze.setLineWidth(Dt*ce()),Ke.isLineSegments?mn.setMode(G.LINES):Ke.isLineLoop?mn.setMode(G.LINE_LOOP):mn.setMode(G.LINE_STRIP)}else Ke.isPoints?mn.setMode(G.POINTS):Ke.isSprite&&mn.setMode(G.TRIANGLES);if(Ke.isBatchedMesh)if(Ke._multiDrawInstances!==null)c0("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),mn.renderMultiDrawInstances(Ke._multiDrawStarts,Ke._multiDrawCounts,Ke._multiDrawCount,Ke._multiDrawInstances);else if(Oe.get("WEBGL_multi_draw"))mn.renderMultiDraw(Ke._multiDrawStarts,Ke._multiDrawCounts,Ke._multiDrawCount);else{const Dt=Ke._multiDrawStarts,On=Ke._multiDrawCounts,cn=Ke._multiDrawCount,Yr=$t?_e.get($t).bytesPerElement:1,ua=re.get(nt).currentProgram.getUniforms();for(let pr=0;pr<cn;pr++)ua.setValue(G,"_gl_DrawID",pr),mn.render(Dt[pr]/Yr,On[pr])}else if(Ke.isInstancedMesh)mn.renderInstances(_n,lr,Ke.count);else if(Xe.isInstancedBufferGeometry){const Dt=Xe._maxInstanceCount!==void 0?Xe._maxInstanceCount:1/0,On=Math.min(Xe.instanceCount,Dt);mn.renderInstances(_n,lr,On)}else mn.render(_n,lr)};function kr(ge,qe,Xe){ge.transparent===!0&&ge.side===po&&ge.forceSinglePass===!1?(ge.side=rs,ge.needsUpdate=!0,mi(ge,qe,Xe),ge.side=Uu,ge.needsUpdate=!0,mi(ge,qe,Xe),ge.side=po):mi(ge,qe,Xe)}this.compile=function(ge,qe,Xe=null){Xe===null&&(Xe=ge),M=Je.get(Xe),M.init(qe),C.push(M),Xe.traverseVisible(function(Ke){Ke.isLight&&Ke.layers.test(qe.layers)&&(M.pushLight(Ke),Ke.castShadow&&M.pushShadow(Ke))}),ge!==Xe&&ge.traverseVisible(function(Ke){Ke.isLight&&Ke.layers.test(qe.layers)&&(M.pushLight(Ke),Ke.castShadow&&M.pushShadow(Ke))}),M.setupLights();const nt=new Set;return ge.traverse(function(Ke){if(!(Ke.isMesh||Ke.isPoints||Ke.isLine||Ke.isSprite))return;const St=Ke.material;if(St)if(Array.isArray(St))for(let Lt=0;Lt<St.length;Lt++){const yt=St[Lt];kr(yt,Xe,Ke),nt.add(yt)}else kr(St,Xe,Ke),nt.add(St)}),M=C.pop(),nt},this.compileAsync=function(ge,qe,Xe=null){const nt=this.compile(ge,qe,Xe);return new Promise(Ke=>{function St(){if(nt.forEach(function(Lt){re.get(Lt).currentProgram.isReady()&&nt.delete(Lt)}),nt.size===0){Ke(ge);return}setTimeout(St,10)}Oe.get("KHR_parallel_shader_compile")!==null?St():setTimeout(St,10)})};let Yi=null;function ki(ge){Yi&&Yi(ge)}function Gr(){fr.stop()}function pi(){fr.start()}const fr=new aZ;fr.setAnimationLoop(ki),typeof self<"u"&&fr.setContext(self),this.setAnimationLoop=function(ge){Yi=ge,ft.setAnimationLoop(ge),ge===null?fr.stop():fr.start()},ft.addEventListener("sessionstart",Gr),ft.addEventListener("sessionend",pi),this.render=function(ge,qe){if(qe!==void 0&&qe.isCamera!==!0){tn("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(I===!0)return;const Xe=ft.enabled===!0&&ft.isPresenting===!0,nt=R!==null&&(F===null||Xe)&&R.begin(k,F);if(ge.matrixWorldAutoUpdate===!0&&ge.updateMatrixWorld(),qe.parent===null&&qe.matrixWorldAutoUpdate===!0&&qe.updateMatrixWorld(),ft.enabled===!0&&ft.isPresenting===!0&&(R===null||R.isCompositing()===!1)&&(ft.cameraAutoUpdate===!0&&ft.updateCamera(qe),qe=ft.getCamera()),ge.isScene===!0&&ge.onBeforeRender(k,ge,qe,F),M=Je.get(ge,C.length),M.init(qe),C.push(M),be.multiplyMatrices(qe.projectionMatrix,qe.matrixWorldInverse),oe.setFromProjectionMatrix(be,qs,qe.reversedDepth),Ne=this.localClippingEnabled,Te=ot.init(this.clippingPlanes,Ne),S=We.get(ge,E.length),S.init(),E.push(S),ft.enabled===!0&&ft.isPresenting===!0){const Lt=k.xr.getDepthSensingMesh();Lt!==null&&Tr(Lt,qe,-1/0,k.sortObjects)}Tr(ge,qe,0,k.sortObjects),S.finish(),k.sortObjects===!0&&S.sort(J,te),Ie=ft.enabled===!1||ft.isPresenting===!1||ft.hasDepthSensing()===!1,Ie&&je.addToRenderList(S,ge),this.info.render.frame++,Te===!0&&ot.beginShadows();const Ke=M.state.shadowsArray;if(Ee.render(Ke,ge,qe),Te===!0&&ot.endShadows(),this.info.autoReset===!0&&this.info.reset(),(nt&&R.hasRenderPass())===!1){const Lt=S.opaque,yt=S.transmissive;if(M.setupLights(),qe.isArrayCamera){const $t=qe.cameras;if(yt.length>0)for(let Gt=0,nn=$t.length;Gt<nn;Gt++){const Qt=$t[Gt];Ha(Lt,yt,ge,Qt)}Ie&&je.render(ge);for(let Gt=0,nn=$t.length;Gt<nn;Gt++){const Qt=$t[Gt];Wr(S,ge,Qt,Qt.viewport)}}else yt.length>0&&Ha(Lt,yt,ge,qe),Ie&&je.render(ge),Wr(S,ge,qe)}F!==null&&D===0&&(me.updateMultisampleRenderTarget(F),me.updateRenderTargetMipmap(F)),nt&&R.end(k),ge.isScene===!0&&ge.onAfterRender(k,ge,qe),st.resetDefaultState(),L=-1,U=null,C.pop(),C.length>0?(M=C[C.length-1],Te===!0&&ot.setGlobalState(k.clippingPlanes,M.state.camera)):M=null,E.pop(),E.length>0?S=E[E.length-1]:S=null};function Tr(ge,qe,Xe,nt){if(ge.visible===!1)return;if(ge.layers.test(qe.layers)){if(ge.isGroup)Xe=ge.renderOrder;else if(ge.isLOD)ge.autoUpdate===!0&&ge.update(qe);else if(ge.isLight)M.pushLight(ge),ge.castShadow&&M.pushShadow(ge);else if(ge.isSprite){if(!ge.frustumCulled||oe.intersectsSprite(ge)){nt&&ke.setFromMatrixPosition(ge.matrixWorld).applyMatrix4(be);const Lt=He.update(ge),yt=ge.material;yt.visible&&S.push(ge,Lt,yt,Xe,ke.z,null)}}else if((ge.isMesh||ge.isLine||ge.isPoints)&&(!ge.frustumCulled||oe.intersectsObject(ge))){const Lt=He.update(ge),yt=ge.material;if(nt&&(ge.boundingSphere!==void 0?(ge.boundingSphere===null&&ge.computeBoundingSphere(),ke.copy(ge.boundingSphere.center)):(Lt.boundingSphere===null&&Lt.computeBoundingSphere(),ke.copy(Lt.boundingSphere.center)),ke.applyMatrix4(ge.matrixWorld).applyMatrix4(be)),Array.isArray(yt)){const $t=Lt.groups;for(let Gt=0,nn=$t.length;Gt<nn;Gt++){const Qt=$t[Gt],_n=yt[Qt.materialIndex];_n&&_n.visible&&S.push(ge,Lt,_n,Xe,ke.z,Qt)}}else yt.visible&&S.push(ge,Lt,yt,Xe,ke.z,null)}}const St=ge.children;for(let Lt=0,yt=St.length;Lt<yt;Lt++)Tr(St[Lt],qe,Xe,nt)}function Wr(ge,qe,Xe,nt){const{opaque:Ke,transmissive:St,transparent:Lt}=ge;M.setupLightsView(Xe),Te===!0&&ot.setGlobalState(k.clippingPlanes,Xe),nt&&ze.viewport(j.copy(nt)),Ke.length>0&&Ir(Ke,qe,Xe),St.length>0&&Ir(St,qe,Xe),Lt.length>0&&Ir(Lt,qe,Xe),ze.buffers.depth.setTest(!0),ze.buffers.depth.setMask(!0),ze.buffers.color.setMask(!0),ze.setPolygonOffset(!1)}function Ha(ge,qe,Xe,nt){if((Xe.isScene===!0?Xe.overrideMaterial:null)!==null)return;if(M.state.transmissionRenderTarget[nt.id]===void 0){const _n=Oe.has("EXT_color_buffer_half_float")||Oe.has("EXT_color_buffer_float");M.state.transmissionRenderTarget[nt.id]=new Ys(1,1,{generateMipmaps:!0,type:_n?$l:Ka,minFilter:Il,samples:Fe.samples,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Yn.workingColorSpace})}const St=M.state.transmissionRenderTarget[nt.id],Lt=nt.viewport||j;St.setSize(Lt.z*k.transmissionResolutionScale,Lt.w*k.transmissionResolutionScale);const yt=k.getRenderTarget(),$t=k.getActiveCubeFace(),Gt=k.getActiveMipmapLevel();k.setRenderTarget(St),k.getClearColor(Q),z=k.getClearAlpha(),z<1&&k.setClearColor(16777215,.5),k.clear(),Ie&&je.render(Xe);const nn=k.toneMapping;k.toneMapping=vo;const Qt=nt.viewport;if(nt.viewport!==void 0&&(nt.viewport=void 0),M.setupLightsView(nt),Te===!0&&ot.setGlobalState(k.clippingPlanes,nt),Ir(ge,Xe,nt),me.updateMultisampleRenderTarget(St),me.updateRenderTargetMipmap(St),Oe.has("WEBGL_multisampled_render_to_texture")===!1){let _n=!1;for(let Dn=0,lr=qe.length;Dn<lr;Dn++){const qn=qe[Dn],{object:mn,geometry:Dt,material:On,group:cn}=qn;if(On.side===po&&mn.layers.test(nt.layers)){const Yr=On.side;On.side=rs,On.needsUpdate=!0,Ii(mn,Xe,nt,Dt,On,cn),On.side=Yr,On.needsUpdate=!0,_n=!0}}_n===!0&&(me.updateMultisampleRenderTarget(St),me.updateRenderTargetMipmap(St))}k.setRenderTarget(yt,$t,Gt),k.setClearColor(Q,z),Qt!==void 0&&(nt.viewport=Qt),k.toneMapping=nn}function Ir(ge,qe,Xe){const nt=qe.isScene===!0?qe.overrideMaterial:null;for(let Ke=0,St=ge.length;Ke<St;Ke++){const Lt=ge[Ke],{object:yt,geometry:$t,group:Gt}=Lt;let nn=Lt.material;nn.allowOverride===!0&&nt!==null&&(nn=nt),yt.layers.test(Xe.layers)&&Ii(yt,qe,Xe,$t,nn,Gt)}}function Ii(ge,qe,Xe,nt,Ke,St){ge.onBeforeRender(k,qe,Xe,nt,Ke,St),ge.modelViewMatrix.multiplyMatrices(Xe.matrixWorldInverse,ge.matrixWorld),ge.normalMatrix.getNormalMatrix(ge.modelViewMatrix),Ke.onBeforeRender(k,qe,Xe,nt,ge,St),Ke.transparent===!0&&Ke.side===po&&Ke.forceSinglePass===!1?(Ke.side=rs,Ke.needsUpdate=!0,k.renderBufferDirect(Xe,qe,nt,Ke,ge,St),Ke.side=Uu,Ke.needsUpdate=!0,k.renderBufferDirect(Xe,qe,nt,Ke,ge,St),Ke.side=po):k.renderBufferDirect(Xe,qe,nt,Ke,ge,St),ge.onAfterRender(k,qe,Xe,nt,Ke,St)}function mi(ge,qe,Xe){qe.isScene!==!0&&(qe=Me);const nt=re.get(ge),Ke=M.state.lights,St=M.state.shadowsArray,Lt=Ke.state.version,yt=pt.getParameters(ge,Ke.state,St,qe,Xe),$t=pt.getProgramCacheKey(yt);let Gt=nt.programs;nt.environment=ge.isMeshStandardMaterial?qe.environment:null,nt.fog=qe.fog,nt.envMap=(ge.isMeshStandardMaterial?ve:de).get(ge.envMap||nt.environment),nt.envMapRotation=nt.environment!==null&&ge.envMap===null?qe.environmentRotation:ge.envMapRotation,Gt===void 0&&(ge.addEventListener("dispose",wn),Gt=new Map,nt.programs=Gt);let nn=Gt.get($t);if(nn!==void 0){if(nt.currentProgram===nn&&nt.lightsStateVersion===Lt)return $a(ge,yt),nn}else yt.uniforms=pt.getUniforms(ge),ge.onBeforeCompile(yt,k),nn=pt.acquireProgram(yt,$t),Gt.set($t,nn),nt.uniforms=yt.uniforms;const Qt=nt.uniforms;return(!ge.isShaderMaterial&&!ge.isRawShaderMaterial||ge.clipping===!0)&&(Qt.clippingPlanes=ot.uniform),$a(ge,yt),nt.needsLights=la(ge),nt.lightsStateVersion=Lt,nt.needsLights&&(Qt.ambientLightColor.value=Ke.state.ambient,Qt.lightProbe.value=Ke.state.probe,Qt.directionalLights.value=Ke.state.directional,Qt.directionalLightShadows.value=Ke.state.directionalShadow,Qt.spotLights.value=Ke.state.spot,Qt.spotLightShadows.value=Ke.state.spotShadow,Qt.rectAreaLights.value=Ke.state.rectArea,Qt.ltc_1.value=Ke.state.rectAreaLTC1,Qt.ltc_2.value=Ke.state.rectAreaLTC2,Qt.pointLights.value=Ke.state.point,Qt.pointLightShadows.value=Ke.state.pointShadow,Qt.hemisphereLights.value=Ke.state.hemi,Qt.directionalShadowMap.value=Ke.state.directionalShadowMap,Qt.directionalShadowMatrix.value=Ke.state.directionalShadowMatrix,Qt.spotShadowMap.value=Ke.state.spotShadowMap,Qt.spotLightMatrix.value=Ke.state.spotLightMatrix,Qt.spotLightMap.value=Ke.state.spotLightMap,Qt.pointShadowMap.value=Ke.state.pointShadowMap,Qt.pointShadowMatrix.value=Ke.state.pointShadowMatrix),nt.currentProgram=nn,nt.uniformsList=null,nn}function Ur(ge){if(ge.uniformsList===null){const qe=ge.currentProgram.getUniforms();ge.uniformsList=Ub.seqWithValue(qe.seq,ge.uniforms)}return ge.uniformsList}function $a(ge,qe){const Xe=re.get(ge);Xe.outputColorSpace=qe.outputColorSpace,Xe.batching=qe.batching,Xe.batchingColor=qe.batchingColor,Xe.instancing=qe.instancing,Xe.instancingColor=qe.instancingColor,Xe.instancingMorph=qe.instancingMorph,Xe.skinning=qe.skinning,Xe.morphTargets=qe.morphTargets,Xe.morphNormals=qe.morphNormals,Xe.morphColors=qe.morphColors,Xe.morphTargetsCount=qe.morphTargetsCount,Xe.numClippingPlanes=qe.numClippingPlanes,Xe.numIntersection=qe.numClipIntersection,Xe.vertexAlphas=qe.vertexAlphas,Xe.vertexTangents=qe.vertexTangents,Xe.toneMapping=qe.toneMapping}function Kt(ge,qe,Xe,nt,Ke){qe.isScene!==!0&&(qe=Me),me.resetTextureUnits();const St=qe.fog,Lt=nt.isMeshStandardMaterial?qe.environment:null,yt=F===null?k.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:ed,$t=(nt.isMeshStandardMaterial?ve:de).get(nt.envMap||Lt),Gt=nt.vertexColors===!0&&!!Xe.attributes.color&&Xe.attributes.color.itemSize===4,nn=!!Xe.attributes.tangent&&(!!nt.normalMap||nt.anisotropy>0),Qt=!!Xe.morphAttributes.position,_n=!!Xe.morphAttributes.normal,Dn=!!Xe.morphAttributes.color;let lr=vo;nt.toneMapped&&(F===null||F.isXRRenderTarget===!0)&&(lr=k.toneMapping);const qn=Xe.morphAttributes.position||Xe.morphAttributes.normal||Xe.morphAttributes.color,mn=qn!==void 0?qn.length:0,Dt=re.get(nt),On=M.state.lights;if(Te===!0&&(Ne===!0||ge!==U)){const xi=ge===U&&nt.id===L;ot.setState(nt,ge,xi)}let cn=!1;nt.version===Dt.__version?(Dt.needsLights&&Dt.lightsStateVersion!==On.state.version||Dt.outputColorSpace!==yt||Ke.isBatchedMesh&&Dt.batching===!1||!Ke.isBatchedMesh&&Dt.batching===!0||Ke.isBatchedMesh&&Dt.batchingColor===!0&&Ke.colorTexture===null||Ke.isBatchedMesh&&Dt.batchingColor===!1&&Ke.colorTexture!==null||Ke.isInstancedMesh&&Dt.instancing===!1||!Ke.isInstancedMesh&&Dt.instancing===!0||Ke.isSkinnedMesh&&Dt.skinning===!1||!Ke.isSkinnedMesh&&Dt.skinning===!0||Ke.isInstancedMesh&&Dt.instancingColor===!0&&Ke.instanceColor===null||Ke.isInstancedMesh&&Dt.instancingColor===!1&&Ke.instanceColor!==null||Ke.isInstancedMesh&&Dt.instancingMorph===!0&&Ke.morphTexture===null||Ke.isInstancedMesh&&Dt.instancingMorph===!1&&Ke.morphTexture!==null||Dt.envMap!==$t||nt.fog===!0&&Dt.fog!==St||Dt.numClippingPlanes!==void 0&&(Dt.numClippingPlanes!==ot.numPlanes||Dt.numIntersection!==ot.numIntersection)||Dt.vertexAlphas!==Gt||Dt.vertexTangents!==nn||Dt.morphTargets!==Qt||Dt.morphNormals!==_n||Dt.morphColors!==Dn||Dt.toneMapping!==lr||Dt.morphTargetsCount!==mn)&&(cn=!0):(cn=!0,Dt.__version=nt.version);let Yr=Dt.currentProgram;cn===!0&&(Yr=mi(nt,qe,Ke));let ua=!1,pr=!1,wa=!1;const Jn=Yr.getUniforms(),ri=Dt.uniforms;if(ze.useProgram(Yr.program)&&(ua=!0,pr=!0,wa=!0),nt.id!==L&&(L=nt.id,pr=!0),ua||U!==ge){ze.buffers.depth.getReversed()&&ge.reversedDepth!==!0&&(ge._reversedDepth=!0,ge.updateProjectionMatrix()),Jn.setValue(G,"projectionMatrix",ge.projectionMatrix),Jn.setValue(G,"viewMatrix",ge.matrixWorldInverse);const Ni=Jn.map.cameraPosition;Ni!==void 0&&Ni.setValue(G,De.setFromMatrixPosition(ge.matrixWorld)),Fe.logarithmicDepthBuffer&&Jn.setValue(G,"logDepthBufFC",2/(Math.log(ge.far+1)/Math.LN2)),(nt.isMeshPhongMaterial||nt.isMeshToonMaterial||nt.isMeshLambertMaterial||nt.isMeshBasicMaterial||nt.isMeshStandardMaterial||nt.isShaderMaterial)&&Jn.setValue(G,"isOrthographic",ge.isOrthographicCamera===!0),U!==ge&&(U=ge,pr=!0,wa=!0)}if(Dt.needsLights&&(On.state.directionalShadowMap.length>0&&Jn.setValue(G,"directionalShadowMap",On.state.directionalShadowMap,me),On.state.spotShadowMap.length>0&&Jn.setValue(G,"spotShadowMap",On.state.spotShadowMap,me),On.state.pointShadowMap.length>0&&Jn.setValue(G,"pointShadowMap",On.state.pointShadowMap,me)),Ke.isSkinnedMesh){Jn.setOptional(G,Ke,"bindMatrix"),Jn.setOptional(G,Ke,"bindMatrixInverse");const xi=Ke.skeleton;xi&&(xi.boneTexture===null&&xi.computeBoneTexture(),Jn.setValue(G,"boneTexture",xi.boneTexture,me))}Ke.isBatchedMesh&&(Jn.setOptional(G,Ke,"batchingTexture"),Jn.setValue(G,"batchingTexture",Ke._matricesTexture,me),Jn.setOptional(G,Ke,"batchingIdTexture"),Jn.setValue(G,"batchingIdTexture",Ke._indirectTexture,me),Jn.setOptional(G,Ke,"batchingColorTexture"),Ke._colorsTexture!==null&&Jn.setValue(G,"batchingColorTexture",Ke._colorsTexture,me));const Xi=Xe.morphAttributes;if((Xi.position!==void 0||Xi.normal!==void 0||Xi.color!==void 0)&&mt.update(Ke,Xe,Yr),(pr||Dt.receiveShadow!==Ke.receiveShadow)&&(Dt.receiveShadow=Ke.receiveShadow,Jn.setValue(G,"receiveShadow",Ke.receiveShadow)),nt.isMeshGouraudMaterial&&nt.envMap!==null&&(ri.envMap.value=$t,ri.flipEnvMap.value=$t.isCubeTexture&&$t.isRenderTargetTexture===!1?-1:1),nt.isMeshStandardMaterial&&nt.envMap===null&&qe.environment!==null&&(ri.envMapIntensity.value=qe.environmentIntensity),ri.dfgLUT!==void 0&&(ri.dfgLUT.value=fxe()),pr&&(Jn.setValue(G,"toneMappingExposure",k.toneMappingExposure),Dt.needsLights&&yr(ri,wa),St&&nt.fog===!0&&gt.refreshFogUniforms(ri,St),gt.refreshMaterialUniforms(ri,nt,H,X,M.state.transmissionRenderTarget[ge.id]),Ub.upload(G,Ur(Dt),ri,me)),nt.isShaderMaterial&&nt.uniformsNeedUpdate===!0&&(Ub.upload(G,Ur(Dt),ri,me),nt.uniformsNeedUpdate=!1),nt.isSpriteMaterial&&Jn.setValue(G,"center",Ke.center),Jn.setValue(G,"modelViewMatrix",Ke.modelViewMatrix),Jn.setValue(G,"normalMatrix",Ke.normalMatrix),Jn.setValue(G,"modelMatrix",Ke.matrixWorld),nt.isShaderMaterial||nt.isRawShaderMaterial){const xi=nt.uniformsGroups;for(let Ni=0,hl=xi.length;Ni<hl;Ni++){const Sa=xi[Ni];Qe.update(Sa,Yr),Qe.bind(Sa,Yr)}}return Yr}function yr(ge,qe){ge.ambientLightColor.needsUpdate=qe,ge.lightProbe.needsUpdate=qe,ge.directionalLights.needsUpdate=qe,ge.directionalLightShadows.needsUpdate=qe,ge.pointLights.needsUpdate=qe,ge.pointLightShadows.needsUpdate=qe,ge.spotLights.needsUpdate=qe,ge.spotLightShadows.needsUpdate=qe,ge.rectAreaLights.needsUpdate=qe,ge.hemisphereLights.needsUpdate=qe}function la(ge){return ge.isMeshLambertMaterial||ge.isMeshToonMaterial||ge.isMeshPhongMaterial||ge.isMeshStandardMaterial||ge.isShadowMaterial||ge.isShaderMaterial&&ge.lights===!0}this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(ge,qe,Xe){const nt=re.get(ge);nt.__autoAllocateDepthBuffer=ge.resolveDepthBuffer===!1,nt.__autoAllocateDepthBuffer===!1&&(nt.__useRenderToTexture=!1),re.get(ge.texture).__webglTexture=qe,re.get(ge.depthTexture).__webglTexture=nt.__autoAllocateDepthBuffer?void 0:Xe,nt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ge,qe){const Xe=re.get(ge);Xe.__webglFramebuffer=qe,Xe.__useDefaultFramebuffer=qe===void 0};const ba=G.createFramebuffer();this.setRenderTarget=function(ge,qe=0,Xe=0){F=ge,N=qe,D=Xe;let nt=null,Ke=!1,St=!1;if(ge){const yt=re.get(ge);if(yt.__useDefaultFramebuffer!==void 0){ze.bindFramebuffer(G.FRAMEBUFFER,yt.__webglFramebuffer),j.copy(ge.viewport),q.copy(ge.scissor),Z=ge.scissorTest,ze.viewport(j),ze.scissor(q),ze.setScissorTest(Z),L=-1;return}else if(yt.__webglFramebuffer===void 0)me.setupRenderTarget(ge);else if(yt.__hasExternalTextures)me.rebindTextures(ge,re.get(ge.texture).__webglTexture,re.get(ge.depthTexture).__webglTexture);else if(ge.depthBuffer){const nn=ge.depthTexture;if(yt.__boundDepthTexture!==nn){if(nn!==null&&re.has(nn)&&(ge.width!==nn.image.width||ge.height!==nn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");me.setupDepthRenderbuffer(ge)}}const $t=ge.texture;($t.isData3DTexture||$t.isDataArrayTexture||$t.isCompressedArrayTexture)&&(St=!0);const Gt=re.get(ge).__webglFramebuffer;ge.isWebGLCubeRenderTarget?(Array.isArray(Gt[qe])?nt=Gt[qe][Xe]:nt=Gt[qe],Ke=!0):ge.samples>0&&me.useMultisampledRTT(ge)===!1?nt=re.get(ge).__webglMultisampledFramebuffer:Array.isArray(Gt)?nt=Gt[Xe]:nt=Gt,j.copy(ge.viewport),q.copy(ge.scissor),Z=ge.scissorTest}else j.copy(ee).multiplyScalar(H).floor(),q.copy(se).multiplyScalar(H).floor(),Z=ue;if(Xe!==0&&(nt=ba),ze.bindFramebuffer(G.FRAMEBUFFER,nt)&&ze.drawBuffers(ge,nt),ze.viewport(j),ze.scissor(q),ze.setScissorTest(Z),Ke){const yt=re.get(ge.texture);G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_CUBE_MAP_POSITIVE_X+qe,yt.__webglTexture,Xe)}else if(St){const yt=qe;for(let $t=0;$t<ge.textures.length;$t++){const Gt=re.get(ge.textures[$t]);G.framebufferTextureLayer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0+$t,Gt.__webglTexture,Xe,yt)}}else if(ge!==null&&Xe!==0){const yt=re.get(ge.texture);G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,yt.__webglTexture,Xe)}L=-1},this.readRenderTargetPixels=function(ge,qe,Xe,nt,Ke,St,Lt,yt=0){if(!(ge&&ge.isWebGLRenderTarget)){tn("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $t=re.get(ge).__webglFramebuffer;if(ge.isWebGLCubeRenderTarget&&Lt!==void 0&&($t=$t[Lt]),$t){ze.bindFramebuffer(G.FRAMEBUFFER,$t);try{const Gt=ge.textures[yt],nn=Gt.format,Qt=Gt.type;if(!Fe.textureFormatReadable(nn)){tn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Fe.textureTypeReadable(Qt)){tn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}qe>=0&&qe<=ge.width-nt&&Xe>=0&&Xe<=ge.height-Ke&&(ge.textures.length>1&&G.readBuffer(G.COLOR_ATTACHMENT0+yt),G.readPixels(qe,Xe,nt,Ke,Ge.convert(nn),Ge.convert(Qt),St))}finally{const Gt=F!==null?re.get(F).__webglFramebuffer:null;ze.bindFramebuffer(G.FRAMEBUFFER,Gt)}}},this.readRenderTargetPixelsAsync=async function(ge,qe,Xe,nt,Ke,St,Lt,yt=0){if(!(ge&&ge.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let $t=re.get(ge).__webglFramebuffer;if(ge.isWebGLCubeRenderTarget&&Lt!==void 0&&($t=$t[Lt]),$t)if(qe>=0&&qe<=ge.width-nt&&Xe>=0&&Xe<=ge.height-Ke){ze.bindFramebuffer(G.FRAMEBUFFER,$t);const Gt=ge.textures[yt],nn=Gt.format,Qt=Gt.type;if(!Fe.textureFormatReadable(nn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Fe.textureTypeReadable(Qt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const _n=G.createBuffer();G.bindBuffer(G.PIXEL_PACK_BUFFER,_n),G.bufferData(G.PIXEL_PACK_BUFFER,St.byteLength,G.STREAM_READ),ge.textures.length>1&&G.readBuffer(G.COLOR_ATTACHMENT0+yt),G.readPixels(qe,Xe,nt,Ke,Ge.convert(nn),Ge.convert(Qt),0);const Dn=F!==null?re.get(F).__webglFramebuffer:null;ze.bindFramebuffer(G.FRAMEBUFFER,Dn);const lr=G.fenceSync(G.SYNC_GPU_COMMANDS_COMPLETE,0);return G.flush(),await Tfe(G,lr,4),G.bindBuffer(G.PIXEL_PACK_BUFFER,_n),G.getBufferSubData(G.PIXEL_PACK_BUFFER,0,St),G.deleteBuffer(_n),G.deleteSync(lr),St}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ge,qe=null,Xe=0){const nt=Math.pow(2,-Xe),Ke=Math.floor(ge.image.width*nt),St=Math.floor(ge.image.height*nt),Lt=qe!==null?qe.x:0,yt=qe!==null?qe.y:0;me.setTexture2D(ge,0),G.copyTexSubImage2D(G.TEXTURE_2D,Xe,0,0,Lt,yt,Ke,St),ze.unbindTexture()};const _a=G.createFramebuffer(),Pt=G.createFramebuffer();this.copyTextureToTexture=function(ge,qe,Xe=null,nt=null,Ke=0,St=null){St===null&&(Ke!==0?(c0("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),St=Ke,Ke=0):St=0);let Lt,yt,$t,Gt,nn,Qt,_n,Dn,lr;const qn=ge.isCompressedTexture?ge.mipmaps[St]:ge.image;if(Xe!==null)Lt=Xe.max.x-Xe.min.x,yt=Xe.max.y-Xe.min.y,$t=Xe.isBox3?Xe.max.z-Xe.min.z:1,Gt=Xe.min.x,nn=Xe.min.y,Qt=Xe.isBox3?Xe.min.z:0;else{const Xi=Math.pow(2,-Ke);Lt=Math.floor(qn.width*Xi),yt=Math.floor(qn.height*Xi),ge.isDataArrayTexture?$t=qn.depth:ge.isData3DTexture?$t=Math.floor(qn.depth*Xi):$t=1,Gt=0,nn=0,Qt=0}nt!==null?(_n=nt.x,Dn=nt.y,lr=nt.z):(_n=0,Dn=0,lr=0);const mn=Ge.convert(qe.format),Dt=Ge.convert(qe.type);let On;qe.isData3DTexture?(me.setTexture3D(qe,0),On=G.TEXTURE_3D):qe.isDataArrayTexture||qe.isCompressedArrayTexture?(me.setTexture2DArray(qe,0),On=G.TEXTURE_2D_ARRAY):(me.setTexture2D(qe,0),On=G.TEXTURE_2D),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,qe.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,qe.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,qe.unpackAlignment);const cn=G.getParameter(G.UNPACK_ROW_LENGTH),Yr=G.getParameter(G.UNPACK_IMAGE_HEIGHT),ua=G.getParameter(G.UNPACK_SKIP_PIXELS),pr=G.getParameter(G.UNPACK_SKIP_ROWS),wa=G.getParameter(G.UNPACK_SKIP_IMAGES);G.pixelStorei(G.UNPACK_ROW_LENGTH,qn.width),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,qn.height),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Gt),G.pixelStorei(G.UNPACK_SKIP_ROWS,nn),G.pixelStorei(G.UNPACK_SKIP_IMAGES,Qt);const Jn=ge.isDataArrayTexture||ge.isData3DTexture,ri=qe.isDataArrayTexture||qe.isData3DTexture;if(ge.isDepthTexture){const Xi=re.get(ge),xi=re.get(qe),Ni=re.get(Xi.__renderTarget),hl=re.get(xi.__renderTarget);ze.bindFramebuffer(G.READ_FRAMEBUFFER,Ni.__webglFramebuffer),ze.bindFramebuffer(G.DRAW_FRAMEBUFFER,hl.__webglFramebuffer);for(let Sa=0;Sa<$t;Sa++)Jn&&(G.framebufferTextureLayer(G.READ_FRAMEBUFFER,G.COLOR_ATTACHMENT0,re.get(ge).__webglTexture,Ke,Qt+Sa),G.framebufferTextureLayer(G.DRAW_FRAMEBUFFER,G.COLOR_ATTACHMENT0,re.get(qe).__webglTexture,St,lr+Sa)),G.blitFramebuffer(Gt,nn,Lt,yt,_n,Dn,Lt,yt,G.DEPTH_BUFFER_BIT,G.NEAREST);ze.bindFramebuffer(G.READ_FRAMEBUFFER,null),ze.bindFramebuffer(G.DRAW_FRAMEBUFFER,null)}else if(Ke!==0||ge.isRenderTargetTexture||re.has(ge)){const Xi=re.get(ge),xi=re.get(qe);ze.bindFramebuffer(G.READ_FRAMEBUFFER,_a),ze.bindFramebuffer(G.DRAW_FRAMEBUFFER,Pt);for(let Ni=0;Ni<$t;Ni++)Jn?G.framebufferTextureLayer(G.READ_FRAMEBUFFER,G.COLOR_ATTACHMENT0,Xi.__webglTexture,Ke,Qt+Ni):G.framebufferTexture2D(G.READ_FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,Xi.__webglTexture,Ke),ri?G.framebufferTextureLayer(G.DRAW_FRAMEBUFFER,G.COLOR_ATTACHMENT0,xi.__webglTexture,St,lr+Ni):G.framebufferTexture2D(G.DRAW_FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,xi.__webglTexture,St),Ke!==0?G.blitFramebuffer(Gt,nn,Lt,yt,_n,Dn,Lt,yt,G.COLOR_BUFFER_BIT,G.NEAREST):ri?G.copyTexSubImage3D(On,St,_n,Dn,lr+Ni,Gt,nn,Lt,yt):G.copyTexSubImage2D(On,St,_n,Dn,Gt,nn,Lt,yt);ze.bindFramebuffer(G.READ_FRAMEBUFFER,null),ze.bindFramebuffer(G.DRAW_FRAMEBUFFER,null)}else ri?ge.isDataTexture||ge.isData3DTexture?G.texSubImage3D(On,St,_n,Dn,lr,Lt,yt,$t,mn,Dt,qn.data):qe.isCompressedArrayTexture?G.compressedTexSubImage3D(On,St,_n,Dn,lr,Lt,yt,$t,mn,qn.data):G.texSubImage3D(On,St,_n,Dn,lr,Lt,yt,$t,mn,Dt,qn):ge.isDataTexture?G.texSubImage2D(G.TEXTURE_2D,St,_n,Dn,Lt,yt,mn,Dt,qn.data):ge.isCompressedTexture?G.compressedTexSubImage2D(G.TEXTURE_2D,St,_n,Dn,qn.width,qn.height,mn,qn.data):G.texSubImage2D(G.TEXTURE_2D,St,_n,Dn,Lt,yt,mn,Dt,qn);G.pixelStorei(G.UNPACK_ROW_LENGTH,cn),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,Yr),G.pixelStorei(G.UNPACK_SKIP_PIXELS,ua),G.pixelStorei(G.UNPACK_SKIP_ROWS,pr),G.pixelStorei(G.UNPACK_SKIP_IMAGES,wa),St===0&&qe.generateMipmaps&&G.generateMipmap(On),ze.unbindTexture()},this.initRenderTarget=function(ge){re.get(ge).__webglFramebuffer===void 0&&me.setupRenderTarget(ge)},this.initTexture=function(ge){ge.isCubeTexture?me.setTextureCube(ge,0):ge.isData3DTexture?me.setTexture3D(ge,0):ge.isDataArrayTexture||ge.isCompressedArrayTexture?me.setTexture2DArray(ge,0):me.setTexture2D(ge,0),ze.unbindTexture()},this.resetState=function(){N=0,D=0,F=null,ze.reset(),st.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return qs}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=Yn._getDrawingBufferColorSpace(e),n.unpackColorSpace=Yn._getUnpackColorSpace()}}const pxe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:d2,AddEquation:zc,AddOperation:qX,AdditiveAnimationBlendMode:YN,AdditiveBlending:l_,AgXToneMapping:UN,AlphaFormat:GN,AlwaysCompare:iK,AlwaysDepth:h_,AlwaysStencilFunc:U6,AmbientLight:XK,AnimationAction:nZ,AnimationClip:E1,AnimationLoader:p0e,AnimationMixer:$0e,AnimationObjectGroup:j0e,AnimationUtils:c0e,ArcCurve:SK,ArrayCamera:QK,ArrowHelper:hme,AttachedBindMode:B6,Audio:eZ,AudioAnalyser:N0e,AudioContext:b8,AudioListener:A0e,AudioLoader:T0e,AxesHelper:fme,BackSide:rs,BasicDepthPacking:KX,BasicShadowMap:TX,BatchedMesh:vK,Bone:r8,BooleanKeyframeTrack:mf,Box2:Z0e,Box3:Ai,Box3Helper:cme,BoxGeometry:pf,BoxHelper:ume,BufferAttribute:Xn,BufferGeometry:bn,BufferGeometryLoader:JK,ByteType:HN,Cache:Nl,Camera:E2,CameraHelper:lme,CanvasTexture:Ppe,CapsuleGeometry:N2,CatmullRomCurve3:EK,CineonToneMapping:FN,CircleGeometry:R2,ClampToEdgeWrapping:bs,Clock:_8,Color:zt,ColorKeyframeTrack:g8,ColorManagement:Yn,CompressedArrayTexture:Npe,CompressedCubeTexture:Rpe,CompressedTexture:I2,CompressedTextureLoader:m0e,ConeGeometry:xv,ConstantAlphaFactor:HX,ConstantColorFactor:zX,Controls:mme,CubeCamera:dK,CubeDepthTexture:_K,CubeReflectionMapping:Hl,CubeRefractionMapping:Qc,CubeTexture:vv,CubeTextureLoader:g0e,CubeUVReflectionMapping:U0,CubicBezierCurve:o8,CubicBezierCurve3:TK,CubicInterpolant:jK,CullFaceBack:O6,CullFaceFront:EX,CullFaceFrontBack:Lhe,CullFaceNone:SX,Curve:ol,CurvePath:MK,CustomBlending:CX,CustomToneMapping:BN,CylinderGeometry:yv,Cylindrical:K0e,Data3DTexture:S2,DataArrayTexture:w2,DataTexture:tl,DataTextureLoader:v0e,DataUtils:npe,DecrementStencilOp:Qhe,DecrementWrapStencilOp:tfe,DefaultLoadingManager:VK,DepthFormat:Vl,DepthStencilFormat:Vc,DepthTexture:p0,DetachedBindMode:GX,DirectionalLight:YK,DirectionalLightHelper:ome,DiscreteInterpolant:HK,DodecahedronGeometry:P2,DoubleSide:po,DstAlphaFactor:OX,DstColorFactor:FX,DynamicCopyUsage:gfe,DynamicDrawUsage:cfe,DynamicReadUsage:ffe,EdgesGeometry:wK,EllipseCurve:D2,EqualCompare:tK,EqualDepth:p_,EqualStencilFunc:afe,EquirectangularReflectionMapping:l1,EquirectangularRefractionMapping:u1,Euler:Js,EventDispatcher:Wl,ExternalTexture:a8,ExtrudeGeometry:L2,FileLoader:zu,Float16BufferAttribute:upe,Float32BufferAttribute:Wt,FloatType:Qa,Fog:C2,FogExp2:T2,FramebufferTexture:Ipe,FrontSide:Uu,Frustum:z0,FrustumArray:k2,GLBufferAttribute:W0e,GLSL1:yfe,GLSL3:z6,GreaterCompare:nK,GreaterDepth:g_,GreaterEqualCompare:_2,GreaterEqualDepth:m_,GreaterEqualStencilFunc:ufe,GreaterStencilFunc:ofe,GridHelper:ame,Group:qp,HalfFloatType:$l,HemisphereLight:qK,HemisphereLightHelper:ime,IcosahedronGeometry:F2,ImageBitmapLoader:E0e,ImageLoader:T1,ImageUtils:lK,IncrementStencilOp:Jhe,IncrementWrapStencilOp:efe,InstancedBufferAttribute:Zh,InstancedBufferGeometry:Y2,InstancedInterleavedBuffer:tw,InstancedMesh:gK,Int16BufferAttribute:ope,Int32BufferAttribute:lpe,Int8BufferAttribute:ipe,IntType:f2,InterleavedBuffer:M2,InterleavedBufferAttribute:Gs,Interpolant:wv,InterpolateDiscrete:h1,InterpolateLinear:K_,InterpolateSmooth:Fb,InterpolationSamplingMode:_fe,InterpolationSamplingType:bfe,InvertStencilOp:nfe,KeepStencilOp:ph,KeyframeTrack:So,LOD:pK,LatheGeometry:B2,Layers:h0,LessCompare:eK,LessDepth:f_,LessEqualCompare:b2,LessEqualDepth:Xh,LessEqualStencilFunc:sfe,LessStencilFunc:ife,Light:gd,LightProbe:ZK,Line:nd,Line3:rZ,LineBasicMaterial:is,LineCurve:l8,LineCurve3:CK,LineDashedMaterial:UK,LineLoop:yK,LineSegments:Yl,LinearFilter:Pr,LinearInterpolant:m8,LinearMipMapLinearFilter:zhe,LinearMipMapNearestFilter:Uhe,LinearMipmapLinearFilter:Il,LinearMipmapNearestFilter:Ng,LinearSRGBColorSpace:ed,LinearToneMapping:ON,LinearTransfer:p1,Loader:Es,LoaderUtils:q6,LoadingManager:v8,LoopOnce:WX,LoopPingPong:XX,LoopRepeat:YX,MOUSE:hh,Material:Ua,MaterialLoader:W2,MathUtils:KN,Matrix2:C8,Matrix3:Sn,Matrix4:fn,MaxEquation:IX,Mesh:Kr,MeshBasicMaterial:Gu,MeshDepthMaterial:q2,MeshDistanceMaterial:G2,MeshLambertMaterial:FK,MeshMatcapMaterial:BK,MeshNormalMaterial:LK,MeshPhongMaterial:DK,MeshPhysicalMaterial:PK,MeshStandardMaterial:f8,MeshToonMaterial:OK,MinEquation:kX,MirroredRepeatWrapping:d1,MixOperation:VX,MultiplyBlending:F6,MultiplyOperation:mv,NearestFilter:Ti,NearestMipMapLinearFilter:Bhe,NearestMipMapNearestFilter:Fhe,NearestMipmapLinearFilter:$p,NearestMipmapNearestFilter:jN,NeutralToneMapping:zN,NeverCompare:QX,NeverDepth:d_,NeverStencilFunc:rfe,NoBlending:Fl,NoColorSpace:ku,NoNormalPacking:Whe,NoToneMapping:vo,NormalAnimationBlendMode:x2,NormalBlending:Lh,NormalGAPacking:Xhe,NormalRGPacking:Yhe,NotEqualCompare:rK,NotEqualDepth:v_,NotEqualStencilFunc:lfe,NumberKeyframeTrack:w1,Object3D:nr,ObjectLoader:w0e,ObjectSpaceNormalMap:JX,OctahedronGeometry:bv,OneFactor:RX,OneMinusConstantAlphaFactor:$X,OneMinusConstantColorFactor:jX,OneMinusDstAlphaFactor:LX,OneMinusDstColorFactor:BX,OneMinusSrcAlphaFactor:c_,OneMinusSrcColorFactor:DX,OrthographicCamera:Ou,PCFShadowMap:Zp,PCFSoftShadowMap:Ig,PMREMGenerator:X6,Path:ew,PerspectiveCamera:Si,Plane:Tu,PlaneGeometry:Wu,PlaneHelper:dme,PointLight:WK,PointLightHelper:nme,Points:xK,PointsMaterial:i8,PolarGridHelper:sme,PolyhedronGeometry:md,PositionalAudio:I0e,PropertyBinding:ir,PropertyMixer:tZ,QuadraticBezierCurve:u8,QuadraticBezierCurve3:O2,Quaternion:xa,QuaternionKeyframeTrack:Sv,QuaternionLinearInterpolant:$K,R11_EAC_Format:T_,RED_GREEN_RGTC2_Format:Y_,RED_RGTC1_Format:G_,REVISION:B0,RG11_EAC_Format:M_,RGBADepthPacking:ZX,RGBAFormat:Da,RGBAIntegerFormat:y2,RGBA_ASTC_10x10_Format:z_,RGBA_ASTC_10x5_Format:F_,RGBA_ASTC_10x6_Format:B_,RGBA_ASTC_10x8_Format:U_,RGBA_ASTC_12x10_Format:j_,RGBA_ASTC_12x12_Format:H_,RGBA_ASTC_4x4_Format:k_,RGBA_ASTC_5x4_Format:I_,RGBA_ASTC_5x5_Format:N_,RGBA_ASTC_6x5_Format:R_,RGBA_ASTC_6x6_Format:P_,RGBA_ASTC_8x5_Format:D_,RGBA_ASTC_8x6_Format:O_,RGBA_ASTC_8x8_Format:L_,RGBA_BPTC_Format:$_,RGBA_ETC2_EAC_Format:E_,RGBA_PVRTC_2BPPV1_Format:__,RGBA_PVRTC_4BPPV1_Format:b_,RGBA_S3TC_DXT1_Format:Pg,RGBA_S3TC_DXT3_Format:Dg,RGBA_S3TC_DXT5_Format:Og,RGBDepthPacking:qhe,RGBFormat:WN,RGBIntegerFormat:jhe,RGB_BPTC_SIGNED_Format:V_,RGB_BPTC_UNSIGNED_Format:q_,RGB_ETC1_Format:w_,RGB_ETC2_Format:S_,RGB_PVRTC_2BPPV1_Format:x_,RGB_PVRTC_4BPPV1_Format:y_,RGB_S3TC_DXT1_Format:Rg,RGDepthPacking:Ghe,RGFormat:Kh,RGIntegerFormat:v2,RawShaderMaterial:h8,Ray:ff,Raycaster:T8,RectAreaLight:KK,RedFormat:g2,RedIntegerFormat:gv,ReinhardToneMapping:LN,RenderTarget:ZN,RenderTarget3D:V0e,RepeatWrapping:c1,ReplaceStencilOp:Zhe,ReverseSubtractEquation:AX,RingGeometry:U2,SIGNED_R11_EAC_Format:C_,SIGNED_RED_GREEN_RGTC2_Format:X_,SIGNED_RED_RGTC1_Format:W_,SIGNED_RG11_EAC_Format:A_,SRGBColorSpace:Na,SRGBTransfer:xr,Scene:t8,ShaderChunk:kn,ShaderLib:Wo,ShaderMaterial:Ss,ShadowMaterial:RK,Shape:Bh,ShapeGeometry:z2,ShapePath:pme,ShapeUtils:Ko,ShortType:$N,Skeleton:A2,SkeletonHelper:tme,SkinnedMesh:mK,Source:qc,Sphere:Hi,SphereGeometry:_v,Spherical:W6,SphericalHarmonics3:x8,SplineCurve:c8,SpotLight:GK,SpotLightHelper:eme,Sprite:fK,SpriteMaterial:n8,SrcAlphaFactor:u_,SrcAlphaSaturateFactor:UX,SrcColorFactor:PX,StaticCopyUsage:mfe,StaticDrawUsage:m1,StaticReadUsage:hfe,StereoCamera:C0e,StreamCopyUsage:vfe,StreamDrawUsage:dfe,StreamReadUsage:pfe,StringKeyframeTrack:gf,SubtractEquation:MX,SubtractiveBlending:L6,TOUCH:fh,TangentSpaceNormalMap:pd,TetrahedronGeometry:j2,Texture:hi,TextureLoader:y0e,TextureUtils:bme,Timer:Y0e,TimestampQuery:xfe,TorusGeometry:H2,TorusKnotGeometry:$2,Triangle:xs,TriangleFanDrawMode:Vhe,TriangleStripDrawMode:$he,TrianglesDrawMode:Hhe,TubeGeometry:V2,UVMapping:h2,Uint16BufferAttribute:JN,Uint32BufferAttribute:QN,Uint8BufferAttribute:ape,Uint8ClampedBufferAttribute:spe,Uniform:E8,UniformsGroup:G0e,UniformsLib:Bt,UniformsUtils:y1,UnsignedByteType:Ka,UnsignedInt101111Type:qN,UnsignedInt248Type:l0,UnsignedInt5999Type:VN,UnsignedIntType:yo,UnsignedShort4444Type:p2,UnsignedShort5551Type:m2,UnsignedShortType:o0,VSMShadowMap:wh,Vector2:dt,Vector3:we,Vector4:er,VectorKeyframeTrack:S1,VideoFrameTexture:kpe,VideoTexture:bK,WebGL3DRenderTarget:Gfe,WebGLArrayRenderTarget:qfe,WebGLCoordinateSystem:qs,WebGLCubeRenderTarget:e8,WebGLRenderTarget:Ys,WebGLRenderer:dZ,WebGLUtils:cZ,WebGPUCoordinateSystem:u0,WebXRController:Bb,WireframeGeometry:d8,WrapAroundEnding:f1,ZeroCurvatureEnding:Sh,ZeroFactor:NX,ZeroSlopeEnding:Eh,ZeroStencilOp:Khe,createCanvasElement:oK,error:tn,getConsoleFunction:Efe,log:v1,setConsoleFunction:Sfe,warn:Ut,warnOnce:c0},Symbol.toStringTag,{value:"Module"}));var _E={exports:{}},wE={},SE={exports:{}},EE={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eL;function mxe(){if(eL)return EE;eL=1;var t=DN();function e(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,i=t.useEffect,a=t.useLayoutEffect,s=t.useDebugValue;function o(d,h){var f=h(),m=r({inst:{value:f,getSnapshot:h}}),x=m[0].inst,b=m[1];return a(function(){x.value=f,x.getSnapshot=h,l(x)&&b({inst:x})},[d,f,h]),i(function(){return l(x)&&b({inst:x}),d(function(){l(x)&&b({inst:x})})},[d]),s(f),f}function l(d){var h=d.getSnapshot;d=d.value;try{var f=h();return!n(d,f)}catch{return!0}}function u(d,h){return h()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return EE.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,EE}var tL;function gxe(){return tL||(tL=1,SE.exports=mxe()),SE.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nL;function vxe(){if(nL)return wE;nL=1;var t=DN(),e=gxe();function n(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var r=typeof Object.is=="function"?Object.is:n,i=e.useSyncExternalStore,a=t.useRef,s=t.useEffect,o=t.useMemo,l=t.useDebugValue;return wE.useSyncExternalStoreWithSelector=function(u,c,d,h,f){var m=a(null);if(m.current===null){var x={hasValue:!1,value:null};m.current=x}else x=m.current;m=o(function(){function y(E){if(!w){if(w=!0,_=E,E=h(E),f!==void 0&&x.hasValue){var C=x.value;if(f(C,E))return S=C}return S=E}if(C=S,r(_,E))return C;var R=h(E);return f!==void 0&&f(C,R)?(_=E,C):(_=E,S=R)}var w=!1,_,S,M=d===void 0?null:d;return[function(){return y(c())},M===null?void 0:function(){return y(M())}]},[c,d,h,f]);var b=i(u,m[0],m[1]);return s(function(){x.hasValue=!0,x.value=b},[b]),l(b),b},wE}var rL;function yxe(){return rL||(rL=1,_E.exports=vxe()),_E.exports}var xxe=yxe();const hZ=pv(xxe),iL=t=>{let e;const n=new Set,r=(u,c)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const h=e;e=c??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(f=>f(e,h))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>l,subscribe:u=>(n.add(u),()=>n.delete(u))},l=e=t(r,i,o);return o},bxe=(t=>t?iL(t):iL),{useSyncExternalStoreWithSelector:_xe}=hZ,wxe=t=>t;function Sxe(t,e=wxe,n){const r=_xe(t.subscribe,t.getState,t.getInitialState,e,n);return Xt.useDebugValue(r),r}const aL=(t,e)=>{const n=bxe(t),r=(i,a=e)=>Sxe(n,i,a);return Object.assign(r,n),r},fZ=((t,e)=>t?aL(t,e):aL),Exe=t=>typeof t=="object"&&typeof t.then=="function",Ux=[];function Txe(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function Cxe(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const a of Ux)if(Txe(e,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return r.lifespan&&r.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,r.lifespan)),a.response;if(!n)throw a.promise}const i={keys:e,equal:r.equal,remove:()=>{const a=Ux.indexOf(i);a!==-1&&Ux.splice(a,1)},promise:(Exe(t)?t:t(...e)).then(a=>{i.response=a,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(a=>i.error=a)};if(Ux.push(i),!n)throw i.promise}const Mxe=(t,e,n)=>Cxe(t,e,!1,n);var J6=Mhe();const Axe=pv(J6);function M8(t,e,n){if(!t)return;if(n(t)===!0)return t;let r=e?t.return:t.child;for(;r;){const i=M8(r,e,n);if(i)return i;r=e?null:r.sibling}}function pZ(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const A8=pZ(P.createContext(null));let mZ=class extends P.Component{render(){return P.createElement(A8.Provider,{value:this._reactInternals},this.props.children)}};function gZ(){const t=P.useContext(A8);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=P.useId();return P.useMemo(()=>{for(const n of[t,t?.alternate]){if(!n)continue;const r=M8(n,!1,i=>{let a=i.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(r)return r}},[t,e])}const kxe=Symbol.for("react.context"),Ixe=t=>t!==null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===kxe;function Nxe(){const t=gZ(),[e]=P.useState(()=>new Map);e.clear();let n=t;for(;n;){const r=n.type;Ixe(r)&&r!==A8&&!e.has(r)&&e.set(r,P.use(pZ(r))),n=n.return}return e}function Rxe(){const t=Nxe();return P.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>P.createElement(e,null,P.createElement(n.Provider,{...r,value:t.get(n)})),e=>P.createElement(mZ,{...e})),[t])}function vZ(t){let e=t.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const yZ=t=>t&&t.isOrthographicCamera,Pxe=t=>t&&t.hasOwnProperty("current"),Dxe=t=>t!=null&&(typeof t=="string"||typeof t=="number"||t.isColor),Ev=((t,e)=>typeof window<"u"&&(((t=window.document)==null?void 0:t.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?P.useLayoutEffect:P.useEffect;function k8(t){const e=P.useRef(t);return Ev(()=>void(e.current=t),[t]),e}function Oxe(){const t=gZ(),e=Rxe();return P.useMemo(()=>({children:n})=>{const i=!!M8(t,!0,a=>a.type===P.StrictMode)?P.StrictMode:P.Fragment;return g.jsx(i,{children:g.jsx(e,{children:n})})},[t,e])}function Lxe({set:t}){return Ev(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}const Fxe=(t=>(t=class extends P.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},t.getDerivedStateFromError=()=>({error:!0}),t))();function xZ(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}function Ip(t){var e;return(e=t.__r3f)==null?void 0:e.root.getState()}const ui={obj:t=>t===Object(t)&&!ui.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,nul:t=>t===null,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(ui.str(t)||ui.num(t)||ui.boo(t))return t===e;const a=ui.obj(t);if(a&&r==="reference")return t===e;const s=ui.arr(t);if(s&&n==="reference")return t===e;if((s||a)&&t===e)return!0;let o;for(o in t)if(!(o in e))return!1;if(a&&n==="shallow"&&r==="shallow"){for(o in i?e:t)if(!ui.equ(t[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:t)if(t[o]!==e[o])return!1;if(ui.und(o)){if(s&&t.length===0&&e.length===0||a&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function Bxe(t){t.type!=="Scene"&&(t.dispose==null||t.dispose());for(const e in t){const n=t[e];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const bZ=["children","key","ref"];function Uxe(t){const e={};for(const n in t)bZ.includes(n)||(e[n]=t[n]);return e}function nw(t,e,n,r){const i=t;let a=i?.__r3f;return a||(a={root:e,type:n,parent:null,children:[],props:Uxe(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=a)),a}function C1(t,e){if(!e.includes("-"))return{root:t,key:e,target:t[e]};if(e in t)return{root:t,key:e,target:t[e]};let n=t;const r=e.split("-");for(const i of r){if(typeof n!="object"||n===null){if(n!==void 0){const a=r.slice(r.indexOf(i)).join("-");return{root:n,key:a,target:void 0}}return{root:t,key:e,target:void 0}}e=i,t=n,n=n[e]}return{root:t,key:e,target:n}}const sL=/-\d+$/;function rw(t,e){if(ui.str(e.props.attach)){if(sL.test(e.props.attach)){const i=e.props.attach.replace(sL,""),{root:a,key:s}=C1(t.object,i);Array.isArray(a[s])||(a[s]=[])}const{root:n,key:r}=C1(t.object,e.props.attach);e.previousAttach=n[r],n[r]=e.object}else ui.fun(e.props.attach)&&(e.previousAttach=e.props.attach(t.object,e.object))}function iw(t,e){if(ui.str(e.props.attach)){const{root:n,key:r}=C1(t.object,e.props.attach),i=e.previousAttach;i===void 0?delete n[r]:n[r]=i}else e.previousAttach==null||e.previousAttach(t.object,e.object);delete e.previousAttach}const Q6=[...bZ,"args","dispose","attach","object","onUpdate","dispose"],oL=new Map;function zxe(t){let e=oL.get(t.constructor);try{e||(e=new t.constructor,oL.set(t.constructor,e))}catch{}return e}function jxe(t,e){const n={};for(const r in e)if(!Q6.includes(r)&&!ui.equ(e[r],t.props[r])){n[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(n[i]=e[i])}for(const r in t.props){if(Q6.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:a}=C1(t.object,r);if(i.constructor&&i.constructor.length===0){const s=zxe(i);ui.und(s)||(n[a]=s[a])}else n[a]=0}return n}const Hxe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],$xe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function jc(t,e){var n;const r=t.__r3f,i=r&&vZ(r).getState(),a=r?.eventCount;for(const o in e){let l=e[o];if(Q6.includes(o))continue;if(r&&$xe.test(o)){typeof l=="function"?r.handlers[o]=l:delete r.handlers[o],r.eventCount=Object.keys(r.handlers).length;continue}if(l===void 0)continue;let{root:u,key:c,target:d}=C1(t,o);if(d===void 0&&(typeof u!="object"||u===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${c}".`);if(d instanceof h0&&l instanceof h0)d.mask=l.mask;else if(d instanceof zt&&Dxe(l))d.set(l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof d.copy=="function"&&l!=null&&l.constructor&&d.constructor===l.constructor)d.copy(l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&Array.isArray(l))typeof d.fromArray=="function"?d.fromArray(l):d.set(...l);else if(d!==null&&typeof d=="object"&&typeof d.set=="function"&&typeof l=="number")typeof d.setScalar=="function"?d.setScalar(l):d.set(l);else{var s;u[c]=l,i&&!i.linear&&Hxe.includes(c)&&(s=u[c])!=null&&s.isTexture&&u[c].format===Da&&u[c].type===Ka&&(u[c].colorSpace=Na)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(n=r.object)!=null&&n.isObject3D&&a!==r.eventCount){const o=r.object,l=i.internal.interaction.indexOf(o);l>-1&&i.internal.interaction.splice(l,1),r.eventCount&&o.raycast!==null&&i.internal.interaction.push(o)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&H0(r),t}function H0(t){var e;if(!t.parent)return;t.props.onUpdate==null||t.props.onUpdate(t.object);const n=(e=t.root)==null||e.getState==null?void 0:e.getState();n&&n.internal.frames===0&&n.invalidate()}function _Z(t,e){t.manual||(yZ(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix())}const gs=t=>t?.isObject3D;function zx(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function wZ(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function Vxe(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{wZ(n.capturedMap,e,r,i)})}function qxe(t){function e(l){const{internal:u}=t.getState(),c=l.offsetX-u.initialClick[0],d=l.offsetY-u.initialClick[1];return Math.round(Math.sqrt(c*c+d*d))}function n(l){return l.filter(u=>["Move","Over","Enter","Out","Leave"].some(c=>{var d;return(d=u.__r3f)==null?void 0:d.handlers["onPointer"+c]}))}function r(l,u){const c=t.getState(),d=new Set,h=[],f=u?u(c.internal.interaction):c.internal.interaction;for(let y=0;y<f.length;y++){const w=Ip(f[y]);w&&(w.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function m(y){const w=Ip(y);if(!w||!w.events.enabled||w.raycaster.camera===null)return[];if(w.raycaster.camera===void 0){var _;w.events.compute==null||w.events.compute(l,w,(_=w.previousRoot)==null?void 0:_.getState()),w.raycaster.camera===void 0&&(w.raycaster.camera=null)}return w.raycaster.camera?w.raycaster.intersectObject(y,!0):[]}let x=f.flatMap(m).sort((y,w)=>{const _=Ip(y.object),S=Ip(w.object);return!_||!S?y.distance-w.distance:S.events.priority-_.events.priority||y.distance-w.distance}).filter(y=>{const w=zx(y);return d.has(w)?!1:(d.add(w),!0)});c.events.filter&&(x=c.events.filter(x,c));for(const y of x){let w=y.object;for(;w;){var b;(b=w.__r3f)!=null&&b.eventCount&&h.push({...y,eventObject:w}),w=w.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let y of c.internal.capturedMap.get(l.pointerId).values())d.has(zx(y.intersection))||h.push(y.intersection);return h}function i(l,u,c,d){if(l.length){const h={stopped:!1};for(const f of l){let m=Ip(f.object);if(m||f.object.traverseAncestors(x=>{const b=Ip(x);if(b)return m=b,!1}),m){const{raycaster:x,pointer:b,camera:y,internal:w}=m,_=new we(b.x,b.y,0).unproject(y),S=k=>{var I,N;return(I=(N=w.capturedMap.get(k))==null?void 0:N.has(f.eventObject))!=null?I:!1},M=k=>{const I={intersection:f,target:u.target};w.capturedMap.has(k)?w.capturedMap.get(k).set(f.eventObject,I):w.capturedMap.set(k,new Map([[f.eventObject,I]])),u.target.setPointerCapture(k)},E=k=>{const I=w.capturedMap.get(k);I&&wZ(w.capturedMap,f.eventObject,I,k)};let C={};for(let k in u){let I=u[k];typeof I!="function"&&(C[k]=I)}let R={...f,...C,pointer:b,intersections:l,stopped:h.stopped,delta:c,unprojectedPoint:_,ray:x.ray,camera:y,stopPropagation(){const k="pointerId"in u&&w.capturedMap.get(u.pointerId);if((!k||k.has(f.eventObject))&&(R.stopped=h.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(I=>I.eventObject===f.eventObject))){const I=l.slice(0,l.indexOf(f));a([...I,f])}},target:{hasPointerCapture:S,setPointerCapture:M,releasePointerCapture:E},currentTarget:{hasPointerCapture:S,setPointerCapture:M,releasePointerCapture:E},nativeEvent:u};if(d(R),h.stopped===!0)break}}}return l}function a(l){const{internal:u}=t.getState();for(const c of u.hovered.values())if(!l.length||!l.find(d=>d.object===c.object&&d.index===c.index&&d.instanceId===c.instanceId)){const h=c.eventObject.__r3f;if(u.hovered.delete(zx(c)),h!=null&&h.eventCount){const f=h.handlers,m={...c,intersections:l};f.onPointerOut==null||f.onPointerOut(m),f.onPointerLeave==null||f.onPointerLeave(m)}}}function s(l,u){for(let c=0;c<u.length;c++){const d=u[c].__r3f;d==null||d.handlers.onPointerMissed==null||d.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return u=>{const{internal:c}=t.getState();"pointerId"in u&&c.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(u.pointerId)&&(c.capturedMap.delete(u.pointerId),a([]))})}}return function(c){const{onPointerMissed:d,internal:h}=t.getState();h.lastEvent.current=c;const f=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",b=r(c,f?n:void 0),y=m?e(c):0;l==="onPointerDown"&&(h.initialClick=[c.offsetX,c.offsetY],h.initialHits=b.map(_=>_.eventObject)),m&&!b.length&&y<=2&&(s(c,h.interaction),d&&d(c)),f&&a(b);function w(_){const S=_.eventObject,M=S.__r3f;if(!(M!=null&&M.eventCount))return;const E=M.handlers;if(f){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const C=zx(_),R=h.hovered.get(C);R?R.stopped&&_.stopPropagation():(h.hovered.set(C,_),E.onPointerOver==null||E.onPointerOver(_),E.onPointerEnter==null||E.onPointerEnter(_))}E.onPointerMove==null||E.onPointerMove(_)}else{const C=E[l];C?(!m||h.initialHits.includes(S))&&(s(c,h.interaction.filter(R=>!h.initialHits.includes(R))),C(_)):m&&h.initialHits.includes(S)&&s(c,h.interaction.filter(R=>!h.initialHits.includes(R)))}}i(b,c,y,w)}}return{handlePointer:o}}const lL=t=>!!(t!=null&&t.render),I8=P.createContext(null),Gxe=(t,e)=>{const n=fZ((o,l)=>{const u=new we,c=new we,d=new we;function h(y=l().camera,w=c,_=l().size){const{width:S,height:M,top:E,left:C}=_,R=S/M;w.isVector3?d.copy(w):d.set(...w);const k=y.getWorldPosition(u).distanceTo(d);if(yZ(y))return{width:S/y.zoom,height:M/y.zoom,top:E,left:C,factor:1,distance:k,aspect:R};{const I=y.fov*Math.PI/180,N=2*Math.tan(I/2)*k,D=N*(S/M);return{width:D,height:N,top:E,left:C,factor:S/D,distance:k,aspect:R}}}let f;const m=y=>o(w=>({performance:{...w.performance,current:y}})),x=new dt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(y=1)=>t(l(),y),advance:(y,w)=>e(y,w,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new _8,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const y=l();f&&clearTimeout(f),y.performance.current!==y.performance.min&&m(y.performance.min),f=setTimeout(()=>m(l().performance.max),y.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:y=>o(w=>({...w,events:{...w.events,...y}})),setSize:(y,w,_=0,S=0)=>{const M=l().camera,E={width:y,height:w,top:_,left:S};o(C=>({size:E,viewport:{...C.viewport,...h(M,c,E)}}))},setDpr:y=>o(w=>{const _=xZ(y);return{viewport:{...w.viewport,dpr:_,initialDpr:w.viewport.initialDpr||_}}}),setFrameloop:(y="always")=>{const w=l().clock;w.stop(),w.elapsedTime=0,y!=="never"&&(w.start(),w.elapsedTime=0),o(()=>({frameloop:y}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:P.createRef(),active:!1,frames:0,priority:0,subscribe:(y,w,_)=>{const S=l().internal;return S.priority=S.priority+(w>0?1:0),S.subscribers.push({ref:y,priority:w,store:_}),S.subscribers=S.subscribers.sort((M,E)=>M.priority-E.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(w>0?1:0),M.subscribers=M.subscribers.filter(E=>E.ref!==y))}}}}}),r=n.getState();let i=r.size,a=r.viewport.dpr,s=r.camera;return n.subscribe(()=>{const{camera:o,size:l,viewport:u,gl:c,set:d}=n.getState();if(l.width!==i.width||l.height!==i.height||u.dpr!==a){i=l,a=u.dpr,_Z(o,l),u.dpr>0&&c.setPixelRatio(u.dpr);const h=typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,h)}o!==s&&(s=o,d(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(o)}})))}),n.subscribe(o=>t(o)),n};function N8(){const t=P.useContext(I8);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function vs(t=n=>n,e){return N8()(t,e)}function vf(t,e=0){const n=N8(),r=n.getState().internal.subscribe,i=k8(t);return Ev(()=>r(i,e,n),[e,r,n]),null}/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */const Wxe=1,Yxe=8,Xxe=32,Kxe=2;var Zxe={version:"9.5.0"};function Jxe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var uL={exports:{}},cL={exports:{}},dL;function Qxe(){return dL||(dL=1,(function(t){t.exports=function(e){function n(p,v,T,O){return new Rce(p,v,T,O)}function r(){}function i(p){var v="https://react.dev/errors/"+p;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var T=2;T<arguments.length;T++)v+="&args[]="+encodeURIComponent(arguments[T])}return"Minified React error #"+p+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(p){var v=p,T=p;if(p.alternate)for(;v.return;)v=v.return;else{p=v;do v=p,(v.flags&4098)!==0&&(T=v.return),p=v.return;while(p)}return v.tag===3?T:null}function s(p){if(a(p)!==p)throw Error(i(188))}function o(p){var v=p.alternate;if(!v){if(v=a(p),v===null)throw Error(i(188));return v!==p?null:p}for(var T=p,O=v;;){var V=T.return;if(V===null)break;var K=V.alternate;if(K===null){if(O=V.return,O!==null){T=O;continue}break}if(V.child===K.child){for(K=V.child;K;){if(K===T)return s(V),p;if(K===O)return s(V),v;K=K.sibling}throw Error(i(188))}if(T.return!==O.return)T=V,O=K;else{for(var pe=!1,Ue=V.child;Ue;){if(Ue===T){pe=!0,T=V,O=K;break}if(Ue===O){pe=!0,O=V,T=K;break}Ue=Ue.sibling}if(!pe){for(Ue=K.child;Ue;){if(Ue===T){pe=!0,T=K,O=V;break}if(Ue===O){pe=!0,O=K,T=V;break}Ue=Ue.sibling}if(!pe)throw Error(i(189))}}if(T.alternate!==O)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?p:v}function l(p){var v=p.tag;if(v===5||v===26||v===27||v===6)return p;for(p=p.child;p!==null;){if(v=l(p),v!==null)return v;p=p.sibling}return null}function u(p){var v=p.tag;if(v===5||v===26||v===27||v===6)return p;for(p=p.child;p!==null;){if(p.tag!==4&&(v=u(p),v!==null))return v;p=p.sibling}return null}function c(p){return p===null||typeof p!="object"?null:(p=HD&&p[HD]||p["@@iterator"],typeof p=="function"?p:null)}function d(p){if(p==null)return null;if(typeof p=="function")return p.$$typeof===Fce?null:p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Hf:return"Fragment";case JS:return"Profiler";case zD:return"StrictMode";case e4:return"Suspense";case t4:return"SuspenseList";case r4:return"Activity"}if(typeof p=="object")switch(p.$$typeof){case jf:return"Portal";case dc:return p.displayName||"Context";case jD:return(p._context.displayName||"Context")+".Consumer";case QS:var v=p.render;return p=p.displayName,p||(p=v.displayName||v.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case n4:return v=p.displayName||null,v!==null?v:d(p.type)||"Memo";case hc:v=p._payload,p=p._init;try{return d(p(v))}catch{}}return null}function h(p){return{current:p}}function f(p){0>qf||(p.current=u4[qf],u4[qf]=null,qf--)}function m(p,v){qf++,u4[qf]=p.current,p.current=v}function x(p){return p>>>=0,p===0?32:31-(dhe(p)/hhe|0)|0}function b(p){var v=p&42;if(v!==0)return v;switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return p&261888;case 262144:case 524288:case 1048576:case 2097152:return p&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return p&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return p}}function y(p,v,T){var O=p.pendingLanes;if(O===0)return 0;var V=0,K=p.suspendedLanes,pe=p.pingedLanes;p=p.warmLanes;var Ue=O&134217727;return Ue!==0?(O=Ue&~K,O!==0?V=b(O):(pe&=Ue,pe!==0?V=b(pe):T||(T=Ue&~p,T!==0&&(V=b(T))))):(Ue=O&~K,Ue!==0?V=b(Ue):pe!==0?V=b(pe):T||(T=O&~p,T!==0&&(V=b(T)))),V===0?0:v!==0&&v!==V&&(v&K)===0&&(K=V&-V,T=v&-v,K>=T||K===32&&(T&4194048)!==0)?v:V}function w(p,v){return(p.pendingLanes&~(p.suspendedLanes&~p.pingedLanes)&v)===0}function _(p,v){switch(p){case 1:case 2:case 4:case 8:case 64:return v+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function S(){var p=ky;return ky<<=1,(ky&62914560)===0&&(ky=4194304),p}function M(p){for(var v=[],T=0;31>T;T++)v.push(p);return v}function E(p,v){p.pendingLanes|=v,v!==268435456&&(p.suspendedLanes=0,p.pingedLanes=0,p.warmLanes=0)}function C(p,v,T,O,V,K){var pe=p.pendingLanes;p.pendingLanes=T,p.suspendedLanes=0,p.pingedLanes=0,p.warmLanes=0,p.expiredLanes&=T,p.entangledLanes&=T,p.errorRecoveryDisabledLanes&=T,p.shellSuspendCounter=0;var Ue=p.entanglements,ut=p.expirationTimes,xt=p.hiddenUpdates;for(T=pe&~T;0<T;){var Ft=31-Ps(T),It=1<<Ft;Ue[Ft]=0,ut[Ft]=-1;var Yt=xt[Ft];if(Yt!==null)for(xt[Ft]=null,Ft=0;Ft<Yt.length;Ft++){var Tn=Yt[Ft];Tn!==null&&(Tn.lane&=-536870913)}T&=~It}O!==0&&R(p,O,0),K!==0&&V===0&&p.tag!==0&&(p.suspendedLanes|=K&~(pe&~v))}function R(p,v,T){p.pendingLanes|=v,p.suspendedLanes&=~v;var O=31-Ps(v);p.entangledLanes|=v,p.entanglements[O]=p.entanglements[O]|1073741824|T&261930}function k(p,v){var T=p.entangledLanes|=v;for(p=p.entanglements;T;){var O=31-Ps(T),V=1<<O;V&v|p[O]&v&&(p[O]|=v),T&=~V}}function I(p,v){var T=v&-v;return T=(T&42)!==0?1:N(T),(T&(p.suspendedLanes|v))!==0?0:T}function N(p){switch(p){case 2:p=1;break;case 8:p=4;break;case 32:p=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:p=128;break;case 268435456:p=134217728;break;default:p=0}return p}function D(p){return p&=-p,2<p?8<p?(p&134217727)!==0?32:268435456:8:2}function F(p){if(typeof vhe=="function"&&yhe(p),Ds&&typeof Ds.setStrictMode=="function")try{Ds.setStrictMode(Em,p)}catch{}}function L(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}function U(p){if(h4===void 0)try{throw Error()}catch(T){var v=T.stack.trim().match(/\n( *(at )?)/);h4=v&&v[1]||"",p9=-1<T.stack.indexOf(`
    at`)?" (<anonymous>)":-1<T.stack.indexOf("@")?"@unknown:0:0":""}return`
`+h4+p+p9}function j(p,v){if(!p||f4)return"";f4=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var O={DetermineComponentFrameRoot:function(){try{if(v){var It=function(){throw Error()};if(Object.defineProperty(It.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(It,[])}catch(Tn){var Yt=Tn}Reflect.construct(p,[],It)}else{try{It.call()}catch(Tn){Yt=Tn}p.call(It.prototype)}}else{try{throw Error()}catch(Tn){Yt=Tn}(It=p())&&typeof It.catch=="function"&&It.catch(function(){})}}catch(Tn){if(Tn&&Yt&&typeof Tn.stack=="string")return[Tn.stack,Yt.stack]}return[null,null]}};O.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var V=Object.getOwnPropertyDescriptor(O.DetermineComponentFrameRoot,"name");V&&V.configurable&&Object.defineProperty(O.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var K=O.DetermineComponentFrameRoot(),pe=K[0],Ue=K[1];if(pe&&Ue){var ut=pe.split(`
`),xt=Ue.split(`
`);for(V=O=0;O<ut.length&&!ut[O].includes("DetermineComponentFrameRoot");)O++;for(;V<xt.length&&!xt[V].includes("DetermineComponentFrameRoot");)V++;if(O===ut.length||V===xt.length)for(O=ut.length-1,V=xt.length-1;1<=O&&0<=V&&ut[O]!==xt[V];)V--;for(;1<=O&&0<=V;O--,V--)if(ut[O]!==xt[V]){if(O!==1||V!==1)do if(O--,V--,0>V||ut[O]!==xt[V]){var Ft=`
`+ut[O].replace(" at new "," at ");return p.displayName&&Ft.includes("<anonymous>")&&(Ft=Ft.replace("<anonymous>",p.displayName)),Ft}while(1<=O&&0<=V);break}}}finally{f4=!1,Error.prepareStackTrace=T}return(T=p?p.displayName||p.name:"")?U(T):""}function q(p,v){switch(p.tag){case 26:case 27:case 5:return U(p.type);case 16:return U("Lazy");case 13:return p.child!==v&&v!==null?U("Suspense Fallback"):U("Suspense");case 19:return U("SuspenseList");case 0:case 15:return j(p.type,!1);case 11:return j(p.type.render,!1);case 1:return j(p.type,!0);case 31:return U("Activity");default:return""}}function Z(p){try{var v="",T=null;do v+=q(p,T),T=p,p=p.return;while(p);return v}catch(O){return`
Error generating stack: `+O.message+`
`+O.stack}}function Q(p,v){if(typeof p=="object"&&p!==null){var T=m9.get(p);return T!==void 0?T:(v={value:p,source:v,stack:Z(v)},m9.set(p,v),v)}return{value:p,source:v,stack:Z(v)}}function z(p,v){Wf[Yf++]=Tm,Wf[Yf++]=Ny,Ny=p,Tm=v}function W(p,v,T){io[ao++]=ml,io[ao++]=gl,io[ao++]=fc,fc=p;var O=ml;p=gl;var V=32-Ps(O)-1;O&=~(1<<V),T+=1;var K=32-Ps(v)+V;if(30<K){var pe=V-V%5;K=(O&(1<<pe)-1).toString(32),O>>=pe,V-=pe,ml=1<<32-Ps(v)+V|T<<V|O,gl=K+p}else ml=1<<K|T<<V|O,gl=p}function X(p){p.return!==null&&(z(p,1),W(p,1,0))}function H(p){for(;p===Ny;)Ny=Wf[--Yf],Wf[Yf]=null,Tm=Wf[--Yf],Wf[Yf]=null;for(;p===fc;)fc=io[--ao],io[ao]=null,gl=io[--ao],io[ao]=null,ml=io[--ao],io[ao]=null}function J(p,v){io[ao++]=ml,io[ao++]=gl,io[ao++]=fc,ml=v.id,gl=v.overflow,fc=p}function te(p,v){m(pc,v),m(Cm,p),m(fa,null),p=zce(v),f(fa),m(fa,p)}function ee(){f(fa),f(Cm),f(pc)}function se(p){p.memoizedState!==null&&m(Ry,p);var v=fa.current,T=jce(v,p.type);v!==T&&(m(Cm,p),m(fa,T))}function ue(p){Cm.current===p&&(f(fa),f(Cm)),Ry.current===p&&(f(Ry),cu?Ld._currentValue=$f:Ld._currentValue2=$f)}function oe(p){var v=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Me(Q(v,p)),p4}function Te(p,v){if(!Ma)throw Error(i(175));jde(p.stateNode,p.type,p.memoizedProps,v,p)||oe(p,!0)}function Ne(p){for(pa=p.return;pa;)switch(pa.tag){case 5:case 31:case 13:so=!1;return;case 27:case 3:so=!0;return;default:pa=pa.return}}function be(p){if(!Ma||p!==pa)return!1;if(!Qn)return Ne(p),Qn=!0,!1;var v=p.tag;if(Ki?v!==3&&v!==27&&(v!==5||t9(p.type)&&!Cy(p.type,p.memoizedProps))&&ii&&oe(p):v!==3&&(v!==5||t9(p.type)&&!Cy(p.type,p.memoizedProps))&&ii&&oe(p),Ne(p),v===13){if(!Ma)throw Error(i(316));if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));ii=Gde(p)}else if(v===31){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));ii=qde(p)}else ii=Ki&&v===27?Nde(p.type,ii):pa?e9(p.stateNode):null;return!0}function De(){Ma&&(ii=pa=null,Qn=!1)}function ke(){var p=mc;return p!==null&&(cs===null?cs=p:cs.push.apply(cs,p),mc=null),p}function Me(p){mc===null?mc=[p]:mc.push(p)}function Ie(p,v,T){cu?(m(Py,v._currentValue),v._currentValue=T):(m(Py,v._currentValue2),v._currentValue2=T)}function ce(p){var v=Py.current;cu?p._currentValue=v:p._currentValue2=v,f(Py)}function G(p,v,T){for(;p!==null;){var O=p.alternate;if((p.childLanes&v)!==v?(p.childLanes|=v,O!==null&&(O.childLanes|=v)):O!==null&&(O.childLanes&v)!==v&&(O.childLanes|=v),p===T)break;p=p.return}}function xe(p,v,T,O){var V=p.child;for(V!==null&&(V.return=p);V!==null;){var K=V.dependencies;if(K!==null){var pe=V.child;K=K.firstContext;e:for(;K!==null;){var Ue=K;K=V;for(var ut=0;ut<v.length;ut++)if(Ue.context===v[ut]){K.lanes|=T,Ue=K.alternate,Ue!==null&&(Ue.lanes|=T),G(K.return,T,p),O||(pe=null);break e}K=Ue.next}}else if(V.tag===18){if(pe=V.return,pe===null)throw Error(i(341));pe.lanes|=T,K=pe.alternate,K!==null&&(K.lanes|=T),G(pe,T,p),pe=null}else pe=V.child;if(pe!==null)pe.return=V;else for(pe=V;pe!==null;){if(pe===p){pe=null;break}if(V=pe.sibling,V!==null){V.return=pe.return,pe=V;break}pe=pe.return}V=pe}}function Oe(p,v,T,O){p=null;for(var V=v,K=!1;V!==null;){if(!K){if((V.flags&524288)!==0)K=!0;else if((V.flags&262144)!==0)break}if(V.tag===10){var pe=V.alternate;if(pe===null)throw Error(i(387));if(pe=pe.memoizedProps,pe!==null){var Ue=V.type;Os(V.pendingProps.value,pe.value)||(p!==null?p.push(Ue):p=[Ue])}}else if(V===Ry.current){if(pe=V.alternate,pe===null)throw Error(i(387));pe.memoizedState.memoizedState!==V.memoizedState.memoizedState&&(p!==null?p.push(Ld):p=[Ld])}V=V.return}p!==null&&xe(v,p,T,O),v.flags|=262144}function Fe(p){for(p=p.firstContext;p!==null;){var v=p.context;if(!Os(cu?v._currentValue:v._currentValue2,p.memoizedValue))return!0;p=p.next}return!1}function ze(p){Fd=p,hu=null,p=p.dependencies,p!==null&&(p.firstContext=null)}function le(p){return me(Fd,p)}function re(p,v){return Fd===null&&ze(p),me(p,v)}function me(p,v){var T=cu?v._currentValue:v._currentValue2;if(v={context:v,memoizedValue:T,next:null},hu===null){if(p===null)throw Error(i(308));hu=v,p.dependencies={lanes:0,firstContext:v},p.flags|=524288}else hu=hu.next=v;return T}function de(){return{controller:new bhe,data:new Map,refCount:0}}function ve(p){p.refCount--,p.refCount===0&&_he(whe,function(){p.controller.abort()})}function _e(){}function Be(p){p!==Xf&&p.next===null&&(Xf===null?Dy=Xf=p:Xf=Xf.next=p),Oy=!0,m4||(m4=!0,Ee())}function He(p,v){if(!g4&&Oy){g4=!0;do for(var T=!1,O=Dy;O!==null;){if(p!==0){var V=O.pendingLanes;if(V===0)var K=0;else{var pe=O.suspendedLanes,Ue=O.pingedLanes;K=(1<<31-Ps(42|p)+1)-1,K&=V&~(pe&~Ue),K=K&201326741?K&201326741|1:K?K|2:0}K!==0&&(T=!0,ot(O,K))}else K=Gn,K=y(O,O===Nr?K:0,O.cancelPendingCommit!==null||O.timeoutHandle!==Od),(K&3)===0||w(O,K)||(T=!0,ot(O,K));O=O.next}while(T);g4=!1}}function pt(){gt()}function gt(){Oy=m4=!1;var p=0;Bd!==0&&Kce()&&(p=Bd);for(var v=ls(),T=null,O=Dy;O!==null;){var V=O.next,K=We(O,v);K===0?(O.next=null,T===null?Dy=V:T.next=V,V===null&&(Xf=T)):(T=O,(p!==0||(K&3)!==0)&&(Oy=!0)),O=V}Zi!==0&&Zi!==5||He(p),Bd!==0&&(Bd=0)}function We(p,v){for(var T=p.suspendedLanes,O=p.pingedLanes,V=p.expirationTimes,K=p.pendingLanes&-62914561;0<K;){var pe=31-Ps(K),Ue=1<<pe,ut=V[pe];ut===-1?((Ue&T)===0||(Ue&O)!==0)&&(V[pe]=_(Ue,v)):ut<=v&&(p.expiredLanes|=Ue),K&=~Ue}if(v=Nr,T=Gn,T=y(p,p===v?T:0,p.cancelPendingCommit!==null||p.timeoutHandle!==Od),O=p.callbackNode,T===0||p===v&&(br===2||br===9)||p.cancelPendingCommit!==null)return O!==null&&O!==null&&c4(O),p.callbackNode=null,p.callbackPriority=0;if((T&3)===0||w(p,T)){if(v=T&-T,v===p.callbackPriority)return v;switch(O!==null&&c4(O),D(T)){case 2:case 8:T=mhe;break;case 32:T=d4;break;case 268435456:T=ghe;break;default:T=d4}return O=Je.bind(null,p),T=Iy(T,O),p.callbackPriority=v,p.callbackNode=T,v}return O!==null&&O!==null&&c4(O),p.callbackPriority=2,p.callbackNode=null,2}function Je(p,v){if(Zi!==0&&Zi!==5)return p.callbackNode=null,p.callbackPriority=0,null;var T=p.callbackNode;if(bm()&&p.callbackNode!==T)return null;var O=Gn;return O=y(p,p===Nr?O:0,p.cancelPendingCommit!==null||p.timeoutHandle!==Od),O===0?null:(mD(p,O,v),We(p,ls()),p.callbackNode!=null&&p.callbackNode===T?Je.bind(null,p):null)}function ot(p,v){if(bm())return null;mD(p,v,!0)}function Ee(){rde?ide(function(){(Hn&6)!==0?Iy(h9,pt):gt()}):Iy(h9,pt)}function je(){if(Bd===0){var p=Kf;p===0&&(p=My,My<<=1,(My&261888)===0&&(My=256)),Bd=p}return Bd}function mt(p,v){if(Mm===null){var T=Mm=[];v4=0,Kf=je(),Zf={status:"pending",value:void 0,then:function(O){T.push(O)}}}return v4++,v.then(fe,fe),v}function fe(){if(--v4===0&&Mm!==null){Zf!==null&&(Zf.status="fulfilled");var p=Mm;Mm=null,Kf=0,Zf=null;for(var v=0;v<p.length;v++)(0,p[v])()}}function $e(p,v){var T=[],O={status:"pending",value:null,reason:null,then:function(V){T.push(V)}};return p.then(function(){O.status="fulfilled",O.value=v;for(var V=0;V<T.length;V++)(0,T[V])(v)},function(V){for(O.status="rejected",O.reason=V,V=0;V<T.length;V++)(0,T[V])(void 0)}),O}function Ge(){var p=Ud.current;return p!==null?p:Nr.pooledCache}function st(p,v){v===null?m(Ud,Ud.current):m(Ud,v.pool)}function Qe(){var p=Ge();return p===null?null:{parent:cu?ai._currentValue:ai._currentValue2,pool:p}}function Ye(p,v){if(Os(p,v))return!0;if(typeof p!="object"||p===null||typeof v!="object"||v===null)return!1;var T=Object.keys(p),O=Object.keys(v);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var V=T[O];if(!xhe.call(v,V)||!Os(p[V],v[V]))return!1}return!0}function ft(p){return p=p.status,p==="fulfilled"||p==="rejected"}function Ct(p,v,T){switch(T=p[T],T===void 0?p.push(v):T!==v&&(v.then(_e,_e),v=T),v.status){case"fulfilled":return v.value;case"rejected":throw p=v.reason,wn(p),p;default:if(typeof v.status=="string")v.then(_e,_e);else{if(p=Nr,p!==null&&100<p.shellSuspendCounter)throw Error(i(482));p=v,p.status="pending",p.then(function(O){if(v.status==="pending"){var V=v;V.status="fulfilled",V.value=O}},function(O){if(v.status==="pending"){var V=v;V.status="rejected",V.reason=O}})}switch(v.status){case"fulfilled":return v.value;case"rejected":throw p=v.reason,wn(p),p}throw zd=v,Jf}}function At(p){try{var v=p._init;return v(p._payload)}catch(T){throw T!==null&&typeof T=="object"&&typeof T.then=="function"?(zd=T,Jf):T}}function Ht(){if(zd===null)throw Error(i(459));var p=zd;return zd=null,p}function wn(p){if(p===Jf||p===Ly)throw Error(i(483))}function Vt(p){var v=Am;return Am+=1,Qf===null&&(Qf=[]),Ct(Qf,p,v)}function En(p,v){v=v.props.ref,p.ref=v!==void 0?v:null}function kr(p,v){throw v.$$typeof===Oce?Error(i(525)):(p=Object.prototype.toString.call(v),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":p)))}function Yi(p){function v(rt,Ze){if(p){var lt=rt.deletions;lt===null?(rt.deletions=[Ze],rt.flags|=16):lt.push(Ze)}}function T(rt,Ze){if(!p)return null;for(;Ze!==null;)v(rt,Ze),Ze=Ze.sibling;return null}function O(rt){for(var Ze=new Map;rt!==null;)rt.key!==null?Ze.set(rt.key,rt):Ze.set(rt.index,rt),rt=rt.sibling;return Ze}function V(rt,Ze){return rt=uu(rt,Ze),rt.index=0,rt.sibling=null,rt}function K(rt,Ze,lt){return rt.index=lt,p?(lt=rt.alternate,lt!==null?(lt=lt.index,lt<Ze?(rt.flags|=67108866,Ze):lt):(rt.flags|=67108866,Ze)):(rt.flags|=1048576,Ze)}function pe(rt){return p&&rt.alternate===null&&(rt.flags|=67108866),rt}function Ue(rt,Ze,lt,Nt){return Ze===null||Ze.tag!==6?(Ze=YS(lt,rt.mode,Nt),Ze.return=rt,Ze):(Ze=V(Ze,lt),Ze.return=rt,Ze)}function ut(rt,Ze,lt,Nt){var hn=lt.type;return hn===Hf?Ft(rt,Ze,lt.props.children,Nt,lt.key):Ze!==null&&(Ze.elementType===hn||typeof hn=="object"&&hn!==null&&hn.$$typeof===hc&&At(hn)===Ze.type)?(Ze=V(Ze,lt.props),En(Ze,lt),Ze.return=rt,Ze):(Ze=Sy(lt.type,lt.key,lt.props,null,rt.mode,Nt),En(Ze,lt),Ze.return=rt,Ze)}function xt(rt,Ze,lt,Nt){return Ze===null||Ze.tag!==4||Ze.stateNode.containerInfo!==lt.containerInfo||Ze.stateNode.implementation!==lt.implementation?(Ze=XS(lt,rt.mode,Nt),Ze.return=rt,Ze):(Ze=V(Ze,lt.children||[]),Ze.return=rt,Ze)}function Ft(rt,Ze,lt,Nt,hn){return Ze===null||Ze.tag!==7?(Ze=Dd(lt,rt.mode,Nt,hn),Ze.return=rt,Ze):(Ze=V(Ze,lt),Ze.return=rt,Ze)}function It(rt,Ze,lt){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return Ze=YS(""+Ze,rt.mode,lt),Ze.return=rt,Ze;if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case Ey:return lt=Sy(Ze.type,Ze.key,Ze.props,null,rt.mode,lt),En(lt,Ze),lt.return=rt,lt;case jf:return Ze=XS(Ze,rt.mode,lt),Ze.return=rt,Ze;case hc:return Ze=At(Ze),It(rt,Ze,lt)}if(Ty(Ze)||c(Ze))return Ze=Dd(Ze,rt.mode,lt,null),Ze.return=rt,Ze;if(typeof Ze.then=="function")return It(rt,Vt(Ze),lt);if(Ze.$$typeof===dc)return It(rt,re(rt,Ze),lt);kr(rt,Ze)}return null}function Yt(rt,Ze,lt,Nt){var hn=Ze!==null?Ze.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return hn!==null?null:Ue(rt,Ze,""+lt,Nt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case Ey:return lt.key===hn?ut(rt,Ze,lt,Nt):null;case jf:return lt.key===hn?xt(rt,Ze,lt,Nt):null;case hc:return lt=At(lt),Yt(rt,Ze,lt,Nt)}if(Ty(lt)||c(lt))return hn!==null?null:Ft(rt,Ze,lt,Nt,null);if(typeof lt.then=="function")return Yt(rt,Ze,Vt(lt),Nt);if(lt.$$typeof===dc)return Yt(rt,Ze,re(rt,lt),Nt);kr(rt,lt)}return null}function Tn(rt,Ze,lt,Nt,hn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number"||typeof Nt=="bigint")return rt=rt.get(lt)||null,Ue(Ze,rt,""+Nt,hn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case Ey:return rt=rt.get(Nt.key===null?lt:Nt.key)||null,ut(Ze,rt,Nt,hn);case jf:return rt=rt.get(Nt.key===null?lt:Nt.key)||null,xt(Ze,rt,Nt,hn);case hc:return Nt=At(Nt),Tn(rt,Ze,lt,Nt,hn)}if(Ty(Nt)||c(Nt))return rt=rt.get(lt)||null,Ft(Ze,rt,Nt,hn,null);if(typeof Nt.then=="function")return Tn(rt,Ze,lt,Vt(Nt),hn);if(Nt.$$typeof===dc)return Tn(rt,Ze,lt,re(Ze,Nt),hn);kr(Ze,Nt)}return null}function Li(rt,Ze,lt,Nt){for(var hn=null,si=null,vn=Ze,cr=Ze=0,ra=null;vn!==null&&cr<lt.length;cr++){vn.index>cr?(ra=vn,vn=null):ra=vn.sibling;var dr=Yt(rt,vn,lt[cr],Nt);if(dr===null){vn===null&&(vn=ra);break}p&&vn&&dr.alternate===null&&v(rt,vn),Ze=K(dr,Ze,cr),si===null?hn=dr:si.sibling=dr,si=dr,vn=ra}if(cr===lt.length)return T(rt,vn),Qn&&z(rt,cr),hn;if(vn===null){for(;cr<lt.length;cr++)vn=It(rt,lt[cr],Nt),vn!==null&&(Ze=K(vn,Ze,cr),si===null?hn=vn:si.sibling=vn,si=vn);return Qn&&z(rt,cr),hn}for(vn=O(vn);cr<lt.length;cr++)ra=Tn(vn,rt,cr,lt[cr],Nt),ra!==null&&(p&&ra.alternate!==null&&vn.delete(ra.key===null?cr:ra.key),Ze=K(ra,Ze,cr),si===null?hn=ra:si.sibling=ra,si=ra);return p&&vn.forEach(function(_c){return v(rt,_c)}),Qn&&z(rt,cr),hn}function Om(rt,Ze,lt,Nt){if(lt==null)throw Error(i(151));for(var hn=null,si=null,vn=Ze,cr=Ze=0,ra=null,dr=lt.next();vn!==null&&!dr.done;cr++,dr=lt.next()){vn.index>cr?(ra=vn,vn=null):ra=vn.sibling;var _c=Yt(rt,vn,dr.value,Nt);if(_c===null){vn===null&&(vn=ra);break}p&&vn&&_c.alternate===null&&v(rt,vn),Ze=K(_c,Ze,cr),si===null?hn=_c:si.sibling=_c,si=_c,vn=ra}if(dr.done)return T(rt,vn),Qn&&z(rt,cr),hn;if(vn===null){for(;!dr.done;cr++,dr=lt.next())dr=It(rt,dr.value,Nt),dr!==null&&(Ze=K(dr,Ze,cr),si===null?hn=dr:si.sibling=dr,si=dr);return Qn&&z(rt,cr),hn}for(vn=O(vn);!dr.done;cr++,dr=lt.next())dr=Tn(vn,rt,cr,dr.value,Nt),dr!==null&&(p&&dr.alternate!==null&&vn.delete(dr.key===null?cr:dr.key),Ze=K(dr,Ze,cr),si===null?hn=dr:si.sibling=dr,si=dr);return p&&vn.forEach(function(Che){return v(rt,Che)}),Qn&&z(rt,cr),hn}function Vd(rt,Ze,lt,Nt){if(typeof lt=="object"&&lt!==null&&lt.type===Hf&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case Ey:e:{for(var hn=lt.key;Ze!==null;){if(Ze.key===hn){if(hn=lt.type,hn===Hf){if(Ze.tag===7){T(rt,Ze.sibling),Nt=V(Ze,lt.props.children),Nt.return=rt,rt=Nt;break e}}else if(Ze.elementType===hn||typeof hn=="object"&&hn!==null&&hn.$$typeof===hc&&At(hn)===Ze.type){T(rt,Ze.sibling),Nt=V(Ze,lt.props),En(Nt,lt),Nt.return=rt,rt=Nt;break e}T(rt,Ze);break}else v(rt,Ze);Ze=Ze.sibling}lt.type===Hf?(Nt=Dd(lt.props.children,rt.mode,Nt,lt.key),Nt.return=rt,rt=Nt):(Nt=Sy(lt.type,lt.key,lt.props,null,rt.mode,Nt),En(Nt,lt),Nt.return=rt,rt=Nt)}return pe(rt);case jf:e:{for(hn=lt.key;Ze!==null;){if(Ze.key===hn)if(Ze.tag===4&&Ze.stateNode.containerInfo===lt.containerInfo&&Ze.stateNode.implementation===lt.implementation){T(rt,Ze.sibling),Nt=V(Ze,lt.children||[]),Nt.return=rt,rt=Nt;break e}else{T(rt,Ze);break}else v(rt,Ze);Ze=Ze.sibling}Nt=XS(lt,rt.mode,Nt),Nt.return=rt,rt=Nt}return pe(rt);case hc:return lt=At(lt),Vd(rt,Ze,lt,Nt)}if(Ty(lt))return Li(rt,Ze,lt,Nt);if(c(lt)){if(hn=c(lt),typeof hn!="function")throw Error(i(150));return lt=hn.call(lt),Om(rt,Ze,lt,Nt)}if(typeof lt.then=="function")return Vd(rt,Ze,Vt(lt),Nt);if(lt.$$typeof===dc)return Vd(rt,Ze,re(rt,lt),Nt);kr(rt,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint"?(lt=""+lt,Ze!==null&&Ze.tag===6?(T(rt,Ze.sibling),Nt=V(Ze,lt),Nt.return=rt,rt=Nt):(T(rt,Ze),Nt=YS(lt,rt.mode,Nt),Nt.return=rt,rt=Nt),pe(rt)):T(rt,Ze)}return function(rt,Ze,lt,Nt){try{Am=0;var hn=Vd(rt,Ze,lt,Nt);return Qf=null,hn}catch(vn){if(vn===Jf||vn===Ly)throw vn;var si=n(29,vn,null,rt.mode);return si.lanes=Nt,si.return=rt,si}finally{}}}function ki(){for(var p=ep,v=x4=ep=0;v<p;){var T=oo[v];oo[v++]=null;var O=oo[v];oo[v++]=null;var V=oo[v];oo[v++]=null;var K=oo[v];if(oo[v++]=null,O!==null&&V!==null){var pe=O.pending;pe===null?V.next=V:(V.next=pe.next,pe.next=V),O.pending=V}K!==0&&Tr(T,V,K)}}function Gr(p,v,T,O){oo[ep++]=p,oo[ep++]=v,oo[ep++]=T,oo[ep++]=O,x4|=O,p.lanes|=O,p=p.alternate,p!==null&&(p.lanes|=O)}function pi(p,v,T,O){return Gr(p,v,T,O),Wr(p)}function fr(p,v){return Gr(p,null,null,v),Wr(p)}function Tr(p,v,T){p.lanes|=T;var O=p.alternate;O!==null&&(O.lanes|=T);for(var V=!1,K=p.return;K!==null;)K.childLanes|=T,O=K.alternate,O!==null&&(O.childLanes|=T),K.tag===22&&(p=K.stateNode,p===null||p._visibility&1||(V=!0)),p=K,K=K.return;return p.tag===3?(K=p.stateNode,V&&v!==null&&(V=31-Ps(T),p=K.hiddenUpdates,O=p[V],O===null?p[V]=[v]:O.push(v),v.lane=T|536870912),K):null}function Wr(p){if(50<Dm)throw Dm=0,N4=null,Error(i(185));for(var v=p.return;v!==null;)p=v,v=p.return;return p.tag===3?p.stateNode:null}function Ha(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ir(p,v){p=p.updateQueue,v.updateQueue===p&&(v.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,callbacks:null})}function Ii(p){return{lane:p,tag:0,payload:null,callback:null,next:null}}function mi(p,v,T){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Hn&2)!==0){var V=O.pending;return V===null?v.next=v:(v.next=V.next,V.next=v),O.pending=v,v=Wr(p),Tr(p,null,T),v}return Gr(p,O,v,T),Wr(p)}function Ur(p,v,T){if(v=v.updateQueue,v!==null&&(v=v.shared,(T&4194048)!==0)){var O=v.lanes;O&=p.pendingLanes,T|=O,v.lanes=T,k(p,T)}}function $a(p,v){var T=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var V=null,K=null;if(T=T.firstBaseUpdate,T!==null){do{var pe={lane:T.lane,tag:T.tag,payload:T.payload,callback:null,next:null};K===null?V=K=pe:K=K.next=pe,T=T.next}while(T!==null);K===null?V=K=v:K=K.next=v}else V=K=v;T={baseState:O.baseState,firstBaseUpdate:V,lastBaseUpdate:K,shared:O.shared,callbacks:O.callbacks},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=v:p.next=v,T.lastBaseUpdate=v}function Kt(){if(b4){var p=Zf;if(p!==null)throw p}}function yr(p,v,T,O){b4=!1;var V=p.updateQueue;gc=!1;var K=V.firstBaseUpdate,pe=V.lastBaseUpdate,Ue=V.shared.pending;if(Ue!==null){V.shared.pending=null;var ut=Ue,xt=ut.next;ut.next=null,pe===null?K=xt:pe.next=xt,pe=ut;var Ft=p.alternate;Ft!==null&&(Ft=Ft.updateQueue,Ue=Ft.lastBaseUpdate,Ue!==pe&&(Ue===null?Ft.firstBaseUpdate=xt:Ue.next=xt,Ft.lastBaseUpdate=ut))}if(K!==null){var It=V.baseState;pe=0,Ft=xt=ut=null,Ue=K;do{var Yt=Ue.lane&-536870913,Tn=Yt!==Ue.lane;if(Tn?(Gn&Yt)===Yt:(O&Yt)===Yt){Yt!==0&&Yt===Kf&&(b4=!0),Ft!==null&&(Ft=Ft.next={lane:0,tag:Ue.tag,payload:Ue.payload,callback:null,next:null});e:{var Li=p,Om=Ue;Yt=v;var Vd=T;switch(Om.tag){case 1:if(Li=Om.payload,typeof Li=="function"){It=Li.call(Vd,It,Yt);break e}It=Li;break e;case 3:Li.flags=Li.flags&-65537|128;case 0:if(Li=Om.payload,Yt=typeof Li=="function"?Li.call(Vd,It,Yt):Li,Yt==null)break e;It=ZS({},It,Yt);break e;case 2:gc=!0}}Yt=Ue.callback,Yt!==null&&(p.flags|=64,Tn&&(p.flags|=8192),Tn=V.callbacks,Tn===null?V.callbacks=[Yt]:Tn.push(Yt))}else Tn={lane:Yt,tag:Ue.tag,payload:Ue.payload,callback:Ue.callback,next:null},Ft===null?(xt=Ft=Tn,ut=It):Ft=Ft.next=Tn,pe|=Yt;if(Ue=Ue.next,Ue===null){if(Ue=V.shared.pending,Ue===null)break;Tn=Ue,Ue=Tn.next,Tn.next=null,V.lastBaseUpdate=Tn,V.shared.pending=null}}while(!0);Ft===null&&(ut=It),V.baseState=ut,V.firstBaseUpdate=xt,V.lastBaseUpdate=Ft,K===null&&(V.shared.lanes=0),yc|=pe,p.lanes=pe,p.memoizedState=It}}function la(p,v){if(typeof p!="function")throw Error(i(191,p));p.call(v)}function ba(p,v){var T=p.callbacks;if(T!==null)for(p.callbacks=null,p=0;p<T.length;p++)la(T[p],v)}function _a(p,v){p=mu,m(By,p),m(tp,v),mu=p|v.baseLanes}function Pt(){m(By,mu),m(tp,tp.current)}function ge(){mu=By.current,f(tp),f(By)}function qe(p){var v=p.alternate;m(bi,bi.current&1),m(Ls,p),Do===null&&(v===null||tp.current!==null||v.memoizedState!==null)&&(Do=p)}function Xe(p){m(bi,bi.current),m(Ls,p),Do===null&&(Do=p)}function nt(p){p.tag===22?(m(bi,bi.current),m(Ls,p),Do===null&&(Do=p)):Ke()}function Ke(){m(bi,bi.current),m(Ls,Ls.current)}function St(p){f(Ls),Do===p&&(Do=null),f(bi)}function Lt(p){for(var v=p;v!==null;){if(v.tag===13){var T=v.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||s4(T)||o4(T)))return v}else if(v.tag===19&&(v.memoizedProps.revealOrder==="forwards"||v.memoizedProps.revealOrder==="backwards"||v.memoizedProps.revealOrder==="unstable_legacy-backwards"||v.memoizedProps.revealOrder==="together")){if((v.flags&128)!==0)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}function yt(){throw Error(i(321))}function $t(p,v){if(v===null)return!1;for(var T=0;T<v.length&&T<p.length;T++)if(!Os(p[T],v[T]))return!1;return!0}function Gt(p,v,T,O,V,K){return fu=K,An=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,dn.H=p===null||p.memoizedState===null?y9:_4,Hd=!1,K=T(O,V),Hd=!1,np&&(K=Qt(v,T,O,V)),nn(p),K}function nn(p){dn.H=Im;var v=Cr!==null&&Cr.next!==null;if(fu=0,Ri=Cr=An=null,Uy=!1,km=0,rp=null,v)throw Error(i(300));p===null||Pi||(p=p.dependencies,p!==null&&Fe(p)&&(Pi=!0))}function Qt(p,v,T,O){An=p;var V=0;do{if(np&&(rp=null),km=0,np=!1,25<=V)throw Error(i(301));if(V+=1,Ri=Cr=null,p.updateQueue!=null){var K=p.updateQueue;K.lastEffect=null,K.events=null,K.stores=null,K.memoCache!=null&&(K.memoCache.index=0)}dn.H=x9,K=v(T,O)}while(np);return K}function _n(){var p=dn.H,v=p.useState()[0];return v=typeof v.then=="function"?cn(v):v,p=p.useState()[0],(Cr!==null?Cr.memoizedState:null)!==p&&(An.flags|=1024),v}function Dn(){var p=zy!==0;return zy=0,p}function lr(p,v,T){v.updateQueue=p.updateQueue,v.flags&=-2053,p.lanes&=~T}function qn(p){if(Uy){for(p=p.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Uy=!1}fu=0,Ri=Cr=An=null,np=!1,km=zy=0,rp=null}function mn(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ri===null?An.memoizedState=Ri=p:Ri=Ri.next=p,Ri}function Dt(){if(Cr===null){var p=An.alternate;p=p!==null?p.memoizedState:null}else p=Cr.next;var v=Ri===null?An.memoizedState:Ri.next;if(v!==null)Ri=v,Cr=p;else{if(p===null)throw An.alternate===null?Error(i(467)):Error(i(310));Cr=p,p={memoizedState:Cr.memoizedState,baseState:Cr.baseState,baseQueue:Cr.baseQueue,queue:Cr.queue,next:null},Ri===null?An.memoizedState=Ri=p:Ri=Ri.next=p}return Ri}function On(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function cn(p){var v=km;return km+=1,rp===null&&(rp=[]),p=Ct(rp,p,v),v=An,(Ri===null?v.memoizedState:Ri.next)===null&&(v=v.alternate,dn.H=v===null||v.memoizedState===null?y9:_4),p}function Yr(p){if(p!==null&&typeof p=="object"){if(typeof p.then=="function")return cn(p);if(p.$$typeof===dc)return le(p)}throw Error(i(438,String(p)))}function ua(p){var v=null,T=An.updateQueue;if(T!==null&&(v=T.memoCache),v==null){var O=An.alternate;O!==null&&(O=O.updateQueue,O!==null&&(O=O.memoCache,O!=null&&(v={data:O.data.map(function(V){return V.slice()}),index:0})))}if(v==null&&(v={data:[],index:0}),T===null&&(T=On(),An.updateQueue=T),T.memoCache=v,T=v.data[v.index],T===void 0)for(T=v.data[v.index]=Array(p),O=0;O<p;O++)T[O]=Lce;return v.index++,T}function pr(p,v){return typeof v=="function"?v(p):v}function wa(p){var v=Dt();return Jn(v,Cr,p)}function Jn(p,v,T){var O=p.queue;if(O===null)throw Error(i(311));O.lastRenderedReducer=T;var V=p.baseQueue,K=O.pending;if(K!==null){if(V!==null){var pe=V.next;V.next=K.next,K.next=pe}v.baseQueue=V=K,O.pending=null}if(K=p.baseState,V===null)p.memoizedState=K;else{v=V.next;var Ue=pe=null,ut=null,xt=v,Ft=!1;do{var It=xt.lane&-536870913;if(It!==xt.lane?(Gn&It)===It:(fu&It)===It){var Yt=xt.revertLane;if(Yt===0)ut!==null&&(ut=ut.next={lane:0,revertLane:0,gesture:null,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null}),It===Kf&&(Ft=!0);else if((fu&Yt)===Yt){xt=xt.next,Yt===Kf&&(Ft=!0);continue}else It={lane:0,revertLane:xt.revertLane,gesture:null,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null},ut===null?(Ue=ut=It,pe=K):ut=ut.next=It,An.lanes|=Yt,yc|=Yt;It=xt.action,Hd&&T(K,It),K=xt.hasEagerState?xt.eagerState:T(K,It)}else Yt={lane:It,revertLane:xt.revertLane,gesture:xt.gesture,action:xt.action,hasEagerState:xt.hasEagerState,eagerState:xt.eagerState,next:null},ut===null?(Ue=ut=Yt,pe=K):ut=ut.next=Yt,An.lanes|=It,yc|=It;xt=xt.next}while(xt!==null&&xt!==v);if(ut===null?pe=K:ut.next=Ue,!Os(K,p.memoizedState)&&(Pi=!0,Ft&&(T=Zf,T!==null)))throw T;p.memoizedState=K,p.baseState=pe,p.baseQueue=ut,O.lastRenderedState=K}return V===null&&(O.lanes=0),[p.memoizedState,O.dispatch]}function ri(p){var v=Dt(),T=v.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var O=T.dispatch,V=T.pending,K=v.memoizedState;if(V!==null){T.pending=null;var pe=V=V.next;do K=p(K,pe.action),pe=pe.next;while(pe!==V);Os(K,v.memoizedState)||(Pi=!0),v.memoizedState=K,v.baseQueue===null&&(v.baseState=K),T.lastRenderedState=K}return[K,O]}function Xi(p,v,T){var O=An,V=Dt(),K=Qn;if(K){if(T===void 0)throw Error(i(407));T=T()}else T=v();var pe=!Os((Cr||V).memoizedState,T);if(pe&&(V.memoizedState=T,Pi=!0),V=V.queue,au(hl.bind(null,O,V,p),[p]),V.getSnapshot!==v||pe||Ri!==null&&Ri.memoizedState.tag&1){if(O.flags|=2048,iu(9,{destroy:void 0},Ni.bind(null,O,V,T,v),null),Nr===null)throw Error(i(349));K||(fu&127)!==0||xi(O,v,T)}return T}function xi(p,v,T){p.flags|=16384,p={getSnapshot:v,value:T},v=An.updateQueue,v===null?(v=On(),An.updateQueue=v,v.stores=[p]):(T=v.stores,T===null?v.stores=[p]:T.push(p))}function Ni(p,v,T,O){v.value=T,v.getSnapshot=O,Sa(v)&&om(p)}function hl(p,v,T){return T(function(){Sa(v)&&om(p)})}function Sa(p){var v=p.getSnapshot;p=p.value;try{var T=v();return!Os(p,T)}catch{return!0}}function om(p){var v=fr(p,2);v!==null&&os(v,p,2)}function tc(p){var v=mn();if(typeof p=="function"){var T=p;if(p=T(),Hd){F(!0);try{T()}finally{F(!1)}}}return v.memoizedState=v.baseState=p,v.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pr,lastRenderedState:p},v}function ru(p,v,T,O){return p.baseState=T,Jn(p,Cr,typeof O=="function"?O:pr)}function nc(p,v,T,O,V){if(dy(p))throw Error(i(485));if(p=v.action,p!==null){var K={payload:V,action:p,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(pe){K.listeners.push(pe)}};dn.T!==null?T(!0):K.isTransition=!1,O(K),T=v.pending,T===null?(K.next=v.pending=K,rc(v,K)):(K.next=T.next,v.pending=T.next=K)}}function rc(p,v){var T=v.action,O=v.payload,V=p.state;if(v.isTransition){var K=dn.T,pe={};dn.T=pe;try{var Ue=T(V,O),ut=dn.S;ut!==null&&ut(pe,Ue),lm(p,v,Ue)}catch(xt){Td(p,v,xt)}finally{K!==null&&pe.types!==null&&(K.types=pe.types),dn.T=K}}else try{K=T(V,O),lm(p,v,K)}catch(xt){Td(p,v,xt)}}function lm(p,v,T){T!==null&&typeof T=="object"&&typeof T.then=="function"?T.then(function(O){ic(p,v,O)},function(O){return Td(p,v,O)}):ic(p,v,T)}function ic(p,v,T){v.status="fulfilled",v.value=T,If(v),p.state=T,v=p.pending,v!==null&&(T=v.next,T===v?p.pending=null:(T=T.next,v.next=T,rc(p,T)))}function Td(p,v,T){var O=p.pending;if(p.pending=null,O!==null){O=O.next;do v.status="rejected",v.reason=T,If(v),v=v.next;while(v!==O)}p.action=null}function If(p){p=p.listeners;for(var v=0;v<p.length;v++)(0,p[v])()}function um(p,v){return v}function Cd(p,v){if(Qn){var T=Nr.formState;if(T!==null){e:{var O=An;if(Qn){if(ii){var V=kde(ii,so);if(V){ii=e9(V),O=Ide(V);break e}}oe(O)}O=!1}O&&(v=T[0])}}T=mn(),T.memoizedState=T.baseState=v,O={pending:null,lanes:0,dispatch:null,lastRenderedReducer:um,lastRenderedState:v},T.queue=O,T=ko.bind(null,An,O),O.dispatch=T,O=tc(!1);var K=_S.bind(null,An,!1,O.queue);return O=mn(),V={state:v,dispatch:null,action:p,pending:null},O.queue=V,T=nc.bind(null,An,V,K,T),V.dispatch=T,O.memoizedState=p,[v,T,!1]}function Nf(p){var v=Dt();return cm(v,Cr,p)}function cm(p,v,T){if(v=Jn(p,v,um)[0],p=wa(pr)[0],typeof v=="object"&&v!==null&&typeof v.then=="function")try{var O=cn(v)}catch(pe){throw pe===Jf?Ly:pe}else O=v;v=Dt();var V=v.queue,K=V.dispatch;return T!==v.memoizedState&&(An.flags|=2048,iu(9,{destroy:void 0},ks.bind(null,V,T),null)),[O,K,p]}function ks(p,v){p.action=v}function Rf(p){var v=Dt(),T=Cr;if(T!==null)return cm(v,T,p);Dt(),v=v.memoizedState,T=Dt();var O=T.queue.dispatch;return T.memoizedState=p,[v,O,!1]}function iu(p,v,T,O){return p={tag:p,create:T,deps:O,inst:v,next:null},v=An.updateQueue,v===null&&(v=On(),An.updateQueue=v),T=v.lastEffect,T===null?v.lastEffect=p.next=p:(O=T.next,T.next=p,p.next=O,v.lastEffect=p),p}function dm(){return Dt().memoizedState}function ac(p,v,T,O){var V=mn();An.flags|=p,V.memoizedState=iu(1|v,{destroy:void 0},T,O===void 0?null:O)}function Md(p,v,T,O){var V=Dt();O=O===void 0?null:O;var K=V.memoizedState.inst;Cr!==null&&O!==null&&$t(O,Cr.memoizedState.deps)?V.memoizedState=iu(v,K,T,O):(An.flags|=p,V.memoizedState=iu(1|v,K,T,O))}function hm(p,v){ac(8390656,8,p,v)}function au(p,v){Md(2048,8,p,v)}function Ad(p){An.flags|=4;var v=An.updateQueue;if(v===null)v=On(),An.updateQueue=v,v.events=[p];else{var T=v.events;T===null?v.events=[p]:T.push(p)}}function Ao(p){var v=Dt().memoizedState;return Ad({ref:v,nextImpl:p}),function(){if((Hn&2)!==0)throw Error(i(440));return v.impl.apply(void 0,arguments)}}function fm(p,v){return Md(4,2,p,v)}function Pf(p,v){return Md(4,4,p,v)}function Df(p,v){if(typeof v=="function"){p=p();var T=v(p);return function(){typeof T=="function"?T():v(null)}}if(v!=null)return p=p(),v.current=p,function(){v.current=null}}function sc(p,v,T){T=T!=null?T.concat([p]):null,Md(4,4,Df.bind(null,v,p),T)}function Of(){}function oc(p,v){var T=Dt();v=v===void 0?null:v;var O=T.memoizedState;return v!==null&&$t(v,O[1])?O[0]:(T.memoizedState=[p,v],p)}function Lf(p,v){var T=Dt();v=v===void 0?null:v;var O=T.memoizedState;if(v!==null&&$t(v,O[1]))return O[0];if(O=p(),Hd){F(!0);try{p()}finally{F(!1)}}return T.memoizedState=[O,v],O}function ca(p,v,T){return T===void 0||(fu&1073741824)!==0&&(Gn&261930)===0?p.memoizedState=v:(p.memoizedState=T,p=pD(),An.lanes|=p,yc|=p,T)}function uy(p,v,T,O){return Os(T,v)?T:tp.current!==null?(p=ca(p,T,O),Os(p,v)||(Pi=!0),p):(fu&42)===0||(fu&1073741824)!==0&&(Gn&261930)===0?(Pi=!0,p.memoizedState=T):(p=pD(),An.lanes|=p,yc|=p,v)}function kd(p,v,T,O,V){var K=du();ta(K!==0&&8>K?K:8);var pe=dn.T,Ue={};dn.T=Ue,_S(p,!1,v,T);try{var ut=V(),xt=dn.S;if(xt!==null&&xt(Ue,ut),ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var Ft=$e(ut,O);lc(p,v,Ft,Ns(p))}else lc(p,v,O,Ns(p))}catch(It){lc(p,v,{then:function(){},status:"rejected",reason:It},Ns())}finally{ta(K),pe!==null&&Ue.types!==null&&(pe.types=Ue.types),dn.T=pe}}function Id(p){var v=p.memoizedState;if(v!==null)return v;v={memoizedState:$f,baseState:$f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pr,lastRenderedState:$f},next:null};var T={};return v.next={memoizedState:T,baseState:T,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pr,lastRenderedState:T},next:null},p.memoizedState=v,p=p.alternate,p!==null&&(p.memoizedState=v),v}function Ff(){return le(Ld)}function cy(){return Dt().memoizedState}function da(){return Dt().memoizedState}function Is(p){for(var v=p.return;v!==null;){switch(v.tag){case 24:case 3:var T=Ns();p=Ii(T);var O=mi(v,p,T);O!==null&&(os(O,v,T),Ur(O,v,T)),v={cache:de()},p.payload=v;return}v=v.return}}function Ea(p,v,T){var O=Ns();T={lane:O,revertLane:0,gesture:null,action:T,hasEagerState:!1,eagerState:null,next:null},dy(p)?TP(v,T):(T=pi(p,v,T,O),T!==null&&(os(T,p,O),CP(T,v,O)))}function ko(p,v,T){var O=Ns();lc(p,v,T,O)}function lc(p,v,T,O){var V={lane:O,revertLane:0,gesture:null,action:T,hasEagerState:!1,eagerState:null,next:null};if(dy(p))TP(v,V);else{var K=p.alternate;if(p.lanes===0&&(K===null||K.lanes===0)&&(K=v.lastRenderedReducer,K!==null))try{var pe=v.lastRenderedState,Ue=K(pe,T);if(V.hasEagerState=!0,V.eagerState=Ue,Os(Ue,pe))return Gr(p,v,V,0),Nr===null&&ki(),!1}catch{}finally{}if(T=pi(p,v,V,O),T!==null)return os(T,p,O),CP(T,v,O),!0}return!1}function _S(p,v,T,O){if(O={lane:2,revertLane:je(),gesture:null,action:O,hasEagerState:!1,eagerState:null,next:null},dy(p)){if(v)throw Error(i(479))}else v=pi(p,T,O,2),v!==null&&os(v,p,2)}function dy(p){var v=p.alternate;return p===An||v!==null&&v===An}function TP(p,v){np=Uy=!0;var T=p.pending;T===null?v.next=v:(v.next=T.next,T.next=v),p.pending=v}function CP(p,v,T){if((T&4194048)!==0){var O=v.lanes;O&=p.pendingLanes,T|=O,v.lanes=T,k(p,T)}}function wS(p,v,T,O){v=p.memoizedState,T=T(O,v),T=T==null?v:ZS({},v,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}function MP(p,v,T,O,V,K,pe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,K,pe):v.prototype&&v.prototype.isPureReactComponent?!Ye(T,O)||!Ye(V,K):!0}function AP(p,v,T,O){p=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(T,O),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(T,O),v.state!==p&&w4.enqueueReplaceState(v,v.state,null)}function Nd(p,v){var T=v;if("ref"in v){T={};for(var O in v)O!=="ref"&&(T[O]=v[O])}if(p=p.defaultProps){T===v&&(T=ZS({},T));for(var V in p)T[V]===void 0&&(T[V]=p[V])}return T}function hy(p,v){try{var T=p.onUncaughtError;T(v.value,{componentStack:v.stack})}catch(O){setTimeout(function(){throw O})}}function kP(p,v,T){try{var O=p.onCaughtError;O(T.value,{componentStack:T.stack,errorBoundary:v.tag===1?v.stateNode:null})}catch(V){setTimeout(function(){throw V})}}function SS(p,v,T){return T=Ii(T),T.tag=3,T.payload={element:null},T.callback=function(){hy(p,v)},T}function IP(p){return p=Ii(p),p.tag=3,p}function NP(p,v,T,O){var V=T.type.getDerivedStateFromError;if(typeof V=="function"){var K=O.value;p.payload=function(){return V(K)},p.callback=function(){kP(v,T,O)}}var pe=T.stateNode;pe!==null&&typeof pe.componentDidCatch=="function"&&(p.callback=function(){kP(v,T,O),typeof V!="function"&&(xc===null?xc=new Set([this]):xc.add(this));var Ue=O.stack;this.componentDidCatch(O.value,{componentStack:Ue!==null?Ue:""})})}function vce(p,v,T,O,V){if(T.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){if(v=T.alternate,v!==null&&Oe(v,T,V,!0),T=Ls.current,T!==null){switch(T.tag){case 31:case 13:return Do===null?_y():T.alternate===null&&gi===0&&(gi=3),T.flags&=-257,T.flags|=65536,T.lanes=V,O===Fy?T.flags|=16384:(v=T.updateQueue,v===null?T.updateQueue=new Set([O]):v.add(O),GS(p,O,V)),!1;case 22:return T.flags|=65536,O===Fy?T.flags|=16384:(v=T.updateQueue,v===null?(v={transitions:null,markerInstances:null,retryQueue:new Set([O])},T.updateQueue=v):(T=v.retryQueue,T===null?v.retryQueue=new Set([O]):T.add(O)),GS(p,O,V)),!1}throw Error(i(435,T.tag))}return GS(p,O,V),_y(),!1}if(Qn)return v=Ls.current,v!==null?((v.flags&65536)===0&&(v.flags|=256),v.flags|=65536,v.lanes=V,O!==p4&&(p=Error(i(422),{cause:O}),Me(Q(p,T)))):(O!==p4&&(v=Error(i(423),{cause:O}),Me(Q(v,T))),p=p.current.alternate,p.flags|=65536,V&=-V,p.lanes|=V,O=Q(O,T),V=SS(p.stateNode,O,V),$a(p,V),gi!==4&&(gi=2)),!1;var K=Error(i(520),{cause:O});if(K=Q(K,T),Rm===null?Rm=[K]:Rm.push(K),gi!==4&&(gi=2),v===null)return!0;O=Q(O,T),T=v;do{switch(T.tag){case 3:return T.flags|=65536,p=V&-V,T.lanes|=p,p=SS(T.stateNode,O,p),$a(T,p),!1;case 1:if(v=T.type,K=T.stateNode,(T.flags&128)===0&&(typeof v.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(xc===null||!xc.has(K))))return T.flags|=65536,V&=-V,T.lanes|=V,V=IP(V),NP(V,p,T,O),$a(T,V),!1}T=T.return}while(T!==null);return!1}function ha(p,v,T,O){v.child=p===null?v9(v,null,T,O):jd(v,p.child,T,O)}function RP(p,v,T,O,V){T=T.render;var K=v.ref;if("ref"in O){var pe={};for(var Ue in O)Ue!=="ref"&&(pe[Ue]=O[Ue])}else pe=O;return ze(v),O=Gt(p,v,T,pe,K,V),Ue=Dn(),p!==null&&!Pi?(lr(p,v,V),su(p,v,V)):(Qn&&Ue&&X(v),v.flags|=1,ha(p,v,O,V),v.child)}function PP(p,v,T,O,V){if(p===null){var K=T.type;return typeof K=="function"&&!WS(K)&&K.defaultProps===void 0&&T.compare===null?(v.tag=15,v.type=K,DP(p,v,K,O,V)):(p=Sy(T.type,null,O,v,v.mode,V),p.ref=v.ref,p.return=v,v.child=p)}if(K=p.child,!IS(p,V)){var pe=K.memoizedProps;if(T=T.compare,T=T!==null?T:Ye,T(pe,O)&&p.ref===v.ref)return su(p,v,V)}return v.flags|=1,p=uu(K,O),p.ref=v.ref,p.return=v,v.child=p}function DP(p,v,T,O,V){if(p!==null){var K=p.memoizedProps;if(Ye(K,O)&&p.ref===v.ref)if(Pi=!1,v.pendingProps=O=K,IS(p,V))(p.flags&131072)!==0&&(Pi=!0);else return v.lanes=p.lanes,su(p,v,V)}return ES(p,v,T,O,V)}function OP(p,v,T,O){var V=O.children,K=p!==null?p.memoizedState:null;if(p===null&&v.stateNode===null&&(v.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),O.mode==="hidden"){if((v.flags&128)!==0){if(K=K!==null?K.baseLanes|T:T,p!==null){for(O=v.child=p.child,V=0;O!==null;)V=V|O.lanes|O.childLanes,O=O.sibling;O=V&~K}else O=0,v.child=null;return LP(p,v,K,T,O)}if((T&536870912)!==0)v.memoizedState={baseLanes:0,cachePool:null},p!==null&&st(v,K!==null?K.cachePool:null),K!==null?_a(v,K):Pt(),nt(v);else return O=v.lanes=536870912,LP(p,v,K!==null?K.baseLanes|T:T,T,O)}else K!==null?(st(v,K.cachePool),_a(v,K),Ke(),v.memoizedState=null):(p!==null&&st(v,null),Pt(),Ke());return ha(p,v,V,T),v.child}function pm(p,v){return p!==null&&p.tag===22||v.stateNode!==null||(v.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),v.sibling}function LP(p,v,T,O,V){var K=Ge();return K=K===null?null:{parent:cu?ai._currentValue:ai._currentValue2,pool:K},v.memoizedState={baseLanes:T,cachePool:K},p!==null&&st(v,null),Pt(),nt(v),p!==null&&Oe(p,v,O,!0),v.childLanes=V,null}function fy(p,v){return v=my({mode:v.mode,children:v.children},p.mode),v.ref=p.ref,p.child=v,v.return=p,v}function FP(p,v,T){return jd(v,p.child,null,T),p=fy(v,v.pendingProps),p.flags|=2,St(v),v.memoizedState=null,p}function yce(p,v,T){var O=v.pendingProps,V=(v.flags&128)!==0;if(v.flags&=-129,p===null){if(Qn){if(O.mode==="hidden")return p=fy(v,O),v.lanes=536870912,pm(null,p);if(Xe(v),(p=ii)?(p=Ude(p,so),p!==null&&(v.memoizedState={dehydrated:p,treeContext:fc!==null?{id:ml,overflow:gl}:null,retryLane:536870912,hydrationErrors:null},T=DD(p),T.return=v,v.child=T,pa=v,ii=null)):p=null,p===null)throw oe(v);return v.lanes=536870912,null}return fy(v,O)}var K=p.memoizedState;if(K!==null){var pe=K.dehydrated;if(Xe(v),V)if(v.flags&256)v.flags&=-257,v=FP(p,v,T);else if(v.memoizedState!==null)v.child=p.child,v.flags|=128,v=null;else throw Error(i(558));else if(Pi||Oe(p,v,T,!1),V=(T&p.childLanes)!==0,Pi||V){if(O=Nr,O!==null&&(pe=I(O,T),pe!==0&&pe!==K.retryLane))throw K.retryLane=pe,fr(p,pe),os(O,p,pe),S4;_y(),v=FP(p,v,T)}else p=K.treeContext,Ma&&(ii=Dde(pe),pa=v,Qn=!0,mc=null,so=!1,p!==null&&J(v,p)),v=fy(v,O),v.flags|=4096;return v}return p=uu(p.child,{mode:O.mode,children:O.children}),p.ref=v.ref,v.child=p,p.return=v,p}function py(p,v){var T=v.ref;if(T===null)p!==null&&p.ref!==null&&(v.flags|=4194816);else{if(typeof T!="function"&&typeof T!="object")throw Error(i(284));(p===null||p.ref!==T)&&(v.flags|=4194816)}}function ES(p,v,T,O,V){return ze(v),T=Gt(p,v,T,O,void 0,V),O=Dn(),p!==null&&!Pi?(lr(p,v,V),su(p,v,V)):(Qn&&O&&X(v),v.flags|=1,ha(p,v,T,V),v.child)}function BP(p,v,T,O,V,K){return ze(v),v.updateQueue=null,T=Qt(v,O,T,V),nn(p),O=Dn(),p!==null&&!Pi?(lr(p,v,K),su(p,v,K)):(Qn&&O&&X(v),v.flags|=1,ha(p,v,T,K),v.child)}function UP(p,v,T,O,V){if(ze(v),v.stateNode===null){var K=Gf,pe=T.contextType;typeof pe=="object"&&pe!==null&&(K=le(pe)),K=new T(O,K),v.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,K.updater=w4,v.stateNode=K,K._reactInternals=v,K=v.stateNode,K.props=O,K.state=v.memoizedState,K.refs={},Ha(v),pe=T.contextType,K.context=typeof pe=="object"&&pe!==null?le(pe):Gf,K.state=v.memoizedState,pe=T.getDerivedStateFromProps,typeof pe=="function"&&(wS(v,T,pe,O),K.state=v.memoizedState),typeof T.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(pe=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),pe!==K.state&&w4.enqueueReplaceState(K,K.state,null),yr(v,O,K,V),Kt(),K.state=v.memoizedState),typeof K.componentDidMount=="function"&&(v.flags|=4194308),O=!0}else if(p===null){K=v.stateNode;var Ue=v.memoizedProps,ut=Nd(T,Ue);K.props=ut;var xt=K.context,Ft=T.contextType;pe=Gf,typeof Ft=="object"&&Ft!==null&&(pe=le(Ft));var It=T.getDerivedStateFromProps;Ft=typeof It=="function"||typeof K.getSnapshotBeforeUpdate=="function",Ue=v.pendingProps!==Ue,Ft||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(Ue||xt!==pe)&&AP(v,K,O,pe),gc=!1;var Yt=v.memoizedState;K.state=Yt,yr(v,O,K,V),Kt(),xt=v.memoizedState,Ue||Yt!==xt||gc?(typeof It=="function"&&(wS(v,T,It,O),xt=v.memoizedState),(ut=gc||MP(v,T,ut,O,Yt,xt,pe))?(Ft||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount()),typeof K.componentDidMount=="function"&&(v.flags|=4194308)):(typeof K.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=O,v.memoizedState=xt),K.props=O,K.state=xt,K.context=pe,O=ut):(typeof K.componentDidMount=="function"&&(v.flags|=4194308),O=!1)}else{K=v.stateNode,Ir(p,v),pe=v.memoizedProps,Ft=Nd(T,pe),K.props=Ft,It=v.pendingProps,Yt=K.context,xt=T.contextType,ut=Gf,typeof xt=="object"&&xt!==null&&(ut=le(xt)),Ue=T.getDerivedStateFromProps,(xt=typeof Ue=="function"||typeof K.getSnapshotBeforeUpdate=="function")||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(pe!==It||Yt!==ut)&&AP(v,K,O,ut),gc=!1,Yt=v.memoizedState,K.state=Yt,yr(v,O,K,V),Kt();var Tn=v.memoizedState;pe!==It||Yt!==Tn||gc||p!==null&&p.dependencies!==null&&Fe(p.dependencies)?(typeof Ue=="function"&&(wS(v,T,Ue,O),Tn=v.memoizedState),(Ft=gc||MP(v,T,Ft,O,Yt,Tn,ut)||p!==null&&p.dependencies!==null&&Fe(p.dependencies))?(xt||typeof K.UNSAFE_componentWillUpdate!="function"&&typeof K.componentWillUpdate!="function"||(typeof K.componentWillUpdate=="function"&&K.componentWillUpdate(O,Tn,ut),typeof K.UNSAFE_componentWillUpdate=="function"&&K.UNSAFE_componentWillUpdate(O,Tn,ut)),typeof K.componentDidUpdate=="function"&&(v.flags|=4),typeof K.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof K.componentDidUpdate!="function"||pe===p.memoizedProps&&Yt===p.memoizedState||(v.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||pe===p.memoizedProps&&Yt===p.memoizedState||(v.flags|=1024),v.memoizedProps=O,v.memoizedState=Tn),K.props=O,K.state=Tn,K.context=ut,O=Ft):(typeof K.componentDidUpdate!="function"||pe===p.memoizedProps&&Yt===p.memoizedState||(v.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||pe===p.memoizedProps&&Yt===p.memoizedState||(v.flags|=1024),O=!1)}return K=O,py(p,v),O=(v.flags&128)!==0,K||O?(K=v.stateNode,T=O&&typeof T.getDerivedStateFromError!="function"?null:K.render(),v.flags|=1,p!==null&&O?(v.child=jd(v,p.child,null,V),v.child=jd(v,null,T,V)):ha(p,v,T,V),v.memoizedState=K.state,p=v.child):p=su(p,v,V),p}function zP(p,v,T,O){return De(),v.flags|=256,ha(p,v,T,O),v.child}function TS(p){return{baseLanes:p,cachePool:Qe()}}function CS(p,v,T){return p=p!==null?p.childLanes&~T:0,v&&(p|=Bs),p}function jP(p,v,T){var O=v.pendingProps,V=!1,K=(v.flags&128)!==0,pe;if((pe=K)||(pe=p!==null&&p.memoizedState===null?!1:(bi.current&2)!==0),pe&&(V=!0,v.flags&=-129),pe=(v.flags&32)!==0,v.flags&=-33,p===null){if(Qn){if(V?qe(v):Ke(),(p=ii)?(p=zde(p,so),p!==null&&(v.memoizedState={dehydrated:p,treeContext:fc!==null?{id:ml,overflow:gl}:null,retryLane:536870912,hydrationErrors:null},T=DD(p),T.return=v,v.child=T,pa=v,ii=null)):p=null,p===null)throw oe(v);return o4(p)?v.lanes=32:v.lanes=536870912,null}var Ue=O.children;return O=O.fallback,V?(Ke(),V=v.mode,Ue=my({mode:"hidden",children:Ue},V),O=Dd(O,V,T,null),Ue.return=v,O.return=v,Ue.sibling=O,v.child=Ue,O=v.child,O.memoizedState=TS(T),O.childLanes=CS(p,pe,T),v.memoizedState=E4,pm(null,O)):(qe(v),MS(v,Ue))}var ut=p.memoizedState;if(ut!==null&&(Ue=ut.dehydrated,Ue!==null)){if(K)v.flags&256?(qe(v),v.flags&=-257,v=AS(p,v,T)):v.memoizedState!==null?(Ke(),v.child=p.child,v.flags|=128,v=null):(Ke(),Ue=O.fallback,V=v.mode,O=my({mode:"visible",children:O.children},V),Ue=Dd(Ue,V,T,null),Ue.flags|=2,O.return=v,Ue.return=v,O.sibling=Ue,v.child=O,jd(v,p.child,null,T),O=v.child,O.memoizedState=TS(T),O.childLanes=CS(p,pe,T),v.memoizedState=E4,v=pm(null,O));else if(qe(v),o4(Ue))pe=Mde(Ue).digest,O=Error(i(419)),O.stack="",O.digest=pe,Me({value:O,source:null,stack:null}),v=AS(p,v,T);else if(Pi||Oe(p,v,T,!1),pe=(T&p.childLanes)!==0,Pi||pe){if(pe=Nr,pe!==null&&(O=I(pe,T),O!==0&&O!==ut.retryLane))throw ut.retryLane=O,fr(p,O),os(pe,p,O),S4;s4(Ue)||_y(),v=AS(p,v,T)}else s4(Ue)?(v.flags|=192,v.child=p.child,v=null):(p=ut.treeContext,Ma&&(ii=Ode(Ue),pa=v,Qn=!0,mc=null,so=!1,p!==null&&J(v,p)),v=MS(v,O.children),v.flags|=4096);return v}return V?(Ke(),Ue=O.fallback,V=v.mode,ut=p.child,K=ut.sibling,O=uu(ut,{mode:"hidden",children:O.children}),O.subtreeFlags=ut.subtreeFlags&65011712,K!==null?Ue=uu(K,Ue):(Ue=Dd(Ue,V,T,null),Ue.flags|=2),Ue.return=v,O.return=v,O.sibling=Ue,v.child=O,pm(null,O),O=v.child,Ue=p.child.memoizedState,Ue===null?Ue=TS(T):(V=Ue.cachePool,V!==null?(ut=cu?ai._currentValue:ai._currentValue2,V=V.parent!==ut?{parent:ut,pool:ut}:V):V=Qe(),Ue={baseLanes:Ue.baseLanes|T,cachePool:V}),O.memoizedState=Ue,O.childLanes=CS(p,pe,T),v.memoizedState=E4,pm(p.child,O)):(qe(v),T=p.child,p=T.sibling,T=uu(T,{mode:"visible",children:O.children}),T.return=v,T.sibling=null,p!==null&&(pe=v.deletions,pe===null?(v.deletions=[p],v.flags|=16):pe.push(p)),v.child=T,v.memoizedState=null,T)}function MS(p,v){return v=my({mode:"visible",children:v},p.mode),v.return=p,p.child=v}function my(p,v){return p=n(22,p,null,v),p.lanes=0,p}function AS(p,v,T){return jd(v,p.child,null,T),p=MS(v,v.pendingProps.children),p.flags|=2,v.memoizedState=null,p}function HP(p,v,T){p.lanes|=v;var O=p.alternate;O!==null&&(O.lanes|=v),G(p.return,v,T)}function kS(p,v,T,O,V,K){var pe=p.memoizedState;pe===null?p.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:V,treeForkCount:K}:(pe.isBackwards=v,pe.rendering=null,pe.renderingStartTime=0,pe.last=O,pe.tail=T,pe.tailMode=V,pe.treeForkCount=K)}function $P(p,v,T){var O=v.pendingProps,V=O.revealOrder,K=O.tail;O=O.children;var pe=bi.current,Ue=(pe&2)!==0;if(Ue?(pe=pe&1|2,v.flags|=128):pe&=1,m(bi,pe),ha(p,v,O,T),O=Qn?Tm:0,!Ue&&p!==null&&(p.flags&128)!==0)e:for(p=v.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&HP(p,T,v);else if(p.tag===19)HP(p,T,v);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===v)break e;for(;p.sibling===null;){if(p.return===null||p.return===v)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}switch(V){case"forwards":for(T=v.child,V=null;T!==null;)p=T.alternate,p!==null&&Lt(p)===null&&(V=T),T=T.sibling;T=V,T===null?(V=v.child,v.child=null):(V=T.sibling,T.sibling=null),kS(v,!1,V,T,K,O);break;case"backwards":case"unstable_legacy-backwards":for(T=null,V=v.child,v.child=null;V!==null;){if(p=V.alternate,p!==null&&Lt(p)===null){v.child=V;break}p=V.sibling,V.sibling=T,T=V,V=p}kS(v,!0,T,null,K,O);break;case"together":kS(v,!1,null,null,void 0,O);break;default:v.memoizedState=null}return v.child}function su(p,v,T){if(p!==null&&(v.dependencies=p.dependencies),yc|=v.lanes,(T&v.childLanes)===0)if(p!==null){if(Oe(p,v,T,!1),(T&v.childLanes)===0)return null}else return null;if(p!==null&&v.child!==p.child)throw Error(i(153));if(v.child!==null){for(p=v.child,T=uu(p,p.pendingProps),v.child=T,T.return=v;p.sibling!==null;)p=p.sibling,T=T.sibling=uu(p,p.pendingProps),T.return=v;T.sibling=null}return v.child}function IS(p,v){return(p.lanes&v)!==0?!0:(p=p.dependencies,!!(p!==null&&Fe(p)))}function xce(p,v,T){switch(v.tag){case 3:te(v,v.stateNode.containerInfo),Ie(v,ai,p.memoizedState.cache),De();break;case 27:case 5:se(v);break;case 4:te(v,v.stateNode.containerInfo);break;case 10:Ie(v,v.type,v.memoizedProps.value);break;case 31:if(v.memoizedState!==null)return v.flags|=128,Xe(v),null;break;case 13:var O=v.memoizedState;if(O!==null)return O.dehydrated!==null?(qe(v),v.flags|=128,null):(T&v.child.childLanes)!==0?jP(p,v,T):(qe(v),p=su(p,v,T),p!==null?p.sibling:null);qe(v);break;case 19:var V=(p.flags&128)!==0;if(O=(T&v.childLanes)!==0,O||(Oe(p,v,T,!1),O=(T&v.childLanes)!==0),V){if(O)return $P(p,v,T);v.flags|=128}if(V=v.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),m(bi,bi.current),O)break;return null;case 22:return v.lanes=0,OP(p,v,T,v.pendingProps);case 24:Ie(v,ai,p.memoizedState.cache)}return su(p,v,T)}function VP(p,v,T){if(p!==null)if(p.memoizedProps!==v.pendingProps)Pi=!0;else{if(!IS(p,T)&&(v.flags&128)===0)return Pi=!1,xce(p,v,T);Pi=(p.flags&131072)!==0}else Pi=!1,Qn&&(v.flags&1048576)!==0&&W(v,Tm,v.index);switch(v.lanes=0,v.tag){case 16:e:{var O=v.pendingProps;if(p=At(v.elementType),v.type=p,typeof p=="function")WS(p)?(O=Nd(p,O),v.tag=1,v=UP(null,v,p,O,T)):(v.tag=0,v=ES(null,v,p,O,T));else{if(p!=null){var V=p.$$typeof;if(V===QS){v.tag=11,v=RP(null,v,p,O,T);break e}else if(V===n4){v.tag=14,v=PP(null,v,p,O,T);break e}}throw v=d(p)||p,Error(i(306,v,""))}}return v;case 0:return ES(p,v,v.type,v.pendingProps,T);case 1:return O=v.type,V=Nd(O,v.pendingProps),UP(p,v,O,V,T);case 3:e:{if(te(v,v.stateNode.containerInfo),p===null)throw Error(i(387));var K=v.pendingProps;V=v.memoizedState,O=V.element,Ir(p,v),yr(v,K,null,T);var pe=v.memoizedState;if(K=pe.cache,Ie(v,ai,K),K!==V.cache&&xe(v,[ai],T,!0),Kt(),K=pe.element,Ma&&V.isDehydrated)if(V={element:K,isDehydrated:!1,cache:pe.cache},v.updateQueue.baseState=V,v.memoizedState=V,v.flags&256){v=zP(p,v,K,T);break e}else if(K!==O){O=Q(Error(i(424)),v),Me(O),v=zP(p,v,K,T);break e}else for(Ma&&(ii=Pde(v.stateNode.containerInfo),pa=v,Qn=!0,mc=null,so=!0),T=v9(v,null,K,T),v.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(De(),K===O){v=su(p,v,T);break e}ha(p,v,K,T)}v=v.child}return v;case 26:if(Po)return py(p,v),p===null?(T=r9(v.type,null,v.pendingProps,null))?v.memoizedState=T:Qn||(v.stateNode=she(v.type,v.pendingProps,pc.current,v)):v.memoizedState=r9(v.type,p.memoizedProps,v.pendingProps,p.memoizedState),null;case 27:if(Ki)return se(v),p===null&&Ki&&Qn&&(O=v.stateNode=u9(v.type,v.pendingProps,pc.current,fa.current,!1),pa=v,so=!0,ii=Lde(v.type,O,ii)),ha(p,v,v.pendingProps.children,T),py(p,v),p===null&&(v.flags|=4194304),v.child;case 5:return p===null&&Qn&&(rhe(v.type,v.pendingProps,fa.current),(V=O=ii)&&(O=Fde(O,v.type,v.pendingProps,so),O!==null?(v.stateNode=O,pa=v,ii=Rde(O),so=!1,V=!0):V=!1),V||oe(v)),se(v),V=v.type,K=v.pendingProps,pe=p!==null?p.memoizedProps:null,O=K.children,Cy(V,K)?O=null:pe!==null&&Cy(V,pe)&&(v.flags|=32),v.memoizedState!==null&&(V=Gt(p,v,_n,null,null,T),cu?Ld._currentValue=V:Ld._currentValue2=V),py(p,v),ha(p,v,O,T),v.child;case 6:return p===null&&Qn&&(ihe(v.pendingProps,fa.current),(p=T=ii)&&(T=Bde(T,v.pendingProps,so),T!==null?(v.stateNode=T,pa=v,ii=null,p=!0):p=!1),p||oe(v)),null;case 13:return jP(p,v,T);case 4:return te(v,v.stateNode.containerInfo),O=v.pendingProps,p===null?v.child=jd(v,null,O,T):ha(p,v,O,T),v.child;case 11:return RP(p,v,v.type,v.pendingProps,T);case 7:return ha(p,v,v.pendingProps,T),v.child;case 8:return ha(p,v,v.pendingProps.children,T),v.child;case 12:return ha(p,v,v.pendingProps.children,T),v.child;case 10:return O=v.pendingProps,Ie(v,v.type,O.value),ha(p,v,O.children,T),v.child;case 9:return V=v.type._context,O=v.pendingProps.children,ze(v),V=le(V),O=O(V),v.flags|=1,ha(p,v,O,T),v.child;case 14:return PP(p,v,v.type,v.pendingProps,T);case 15:return DP(p,v,v.type,v.pendingProps,T);case 19:return $P(p,v,T);case 31:return yce(p,v,T);case 22:return OP(p,v,T,v.pendingProps);case 24:return ze(v),O=le(ai),p===null?(V=Ge(),V===null&&(V=Nr,K=de(),V.pooledCache=K,K.refCount++,K!==null&&(V.pooledCacheLanes|=T),V=K),v.memoizedState={parent:O,cache:V},Ha(v),Ie(v,ai,V)):((p.lanes&T)!==0&&(Ir(p,v),yr(v,null,null,T),Kt()),V=p.memoizedState,K=v.memoizedState,V.parent!==O?(V={parent:O,cache:O},v.memoizedState=V,v.lanes===0&&(v.memoizedState=v.updateQueue.baseState=V),Ie(v,ai,O)):(O=K.cache,Ie(v,ai,O),O!==V.cache&&xe(v,[ai],T,!0))),ha(p,v,v.pendingProps.children,T),v.child;case 29:throw v.pendingProps}throw Error(i(156,v.tag))}function Io(p){p.flags|=4}function gy(p){pl&&(p.flags|=8)}function qP(p,v){if(p!==null&&p.child===v.child)return!1;if((v.flags&16)!==0)return!0;for(p=v.child;p!==null;){if((p.flags&8218)!==0||(p.subtreeFlags&8218)!==0)return!0;p=p.sibling}return!1}function NS(p,v,T,O){if(Ca)for(T=v.child;T!==null;){if(T.tag===5||T.tag===6)i4(p,T.stateNode);else if(!(T.tag===4||Ki&&T.tag===27)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===v)break;for(;T.sibling===null;){if(T.return===null||T.return===v)return;T=T.return}T.sibling.return=T.return,T=T.sibling}else if(pl)for(var V=v.child;V!==null;){if(V.tag===5){var K=V.stateNode;T&&O&&(K=JD(K,V.type,V.memoizedProps)),i4(p,K)}else if(V.tag===6)K=V.stateNode,T&&O&&(K=QD(K,V.memoizedProps)),i4(p,K);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)K=V.child,K!==null&&(K.return=V),NS(p,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===v)break;for(;V.sibling===null;){if(V.return===null||V.return===v)return;V=V.return}V.sibling.return=V.return,V=V.sibling}}function GP(p,v,T,O){var V=!1;if(pl)for(var K=v.child;K!==null;){if(K.tag===5){var pe=K.stateNode;T&&O&&(pe=JD(pe,K.type,K.memoizedProps)),KD(p,pe)}else if(K.tag===6)pe=K.stateNode,T&&O&&(pe=QD(pe,K.memoizedProps)),KD(p,pe);else if(K.tag!==4){if(K.tag===22&&K.memoizedState!==null)V=K.child,V!==null&&(V.return=K),GP(p,K,!0,!0),V=!0;else if(K.child!==null){K.child.return=K,K=K.child;continue}}if(K===v)break;for(;K.sibling===null;){if(K.return===null||K.return===v)return V;K=K.return}K.sibling.return=K.return,K=K.sibling}return V}function WP(p,v){if(pl&&qP(p,v)){p=v.stateNode;var T=p.containerInfo,O=XD();GP(O,v,!1,!1),p.pendingChildren=O,Io(v),Cde(T,O)}}function RS(p,v,T,O){if(Ca)p.memoizedProps!==O&&Io(v);else if(pl){var V=p.stateNode,K=p.memoizedProps;if((p=qP(p,v))||K!==O){var pe=fa.current;K=Tde(V,T,K,O,!p,null),K===V?v.stateNode=V:(gy(v),VD(K,T,O,pe)&&Io(v),v.stateNode=K,p&&NS(K,v,!1,!1))}else v.stateNode=V}}function PS(p,v,T,O,V){if((p.mode&32)!==0&&(T===null?Jce(v,O):Qce(v,T,O))){if(p.flags|=16777216,(V&335544128)===V||a4(v,O))if(GD(p.stateNode,v,O))p.flags|=8192;else if(xD())p.flags|=8192;else throw zd=Fy,y4}else p.flags&=-16777217}function YP(p,v){if(lhe(v)){if(p.flags|=16777216,!l9(v))if(xD())p.flags|=8192;else throw zd=Fy,y4}else p.flags&=-16777217}function vy(p,v){v!==null&&(p.flags|=4),p.flags&16384&&(v=p.tag!==22?S():536870912,p.lanes|=v,sp|=v)}function mm(p,v){if(!Qn)switch(p.tailMode){case"hidden":v=p.tail;for(var T=null;v!==null;)v.alternate!==null&&(T=v),v=v.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?v||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function $r(p){var v=p.alternate!==null&&p.alternate.child===p.child,T=0,O=0;if(v)for(var V=p.child;V!==null;)T|=V.lanes|V.childLanes,O|=V.subtreeFlags&65011712,O|=V.flags&65011712,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)T|=V.lanes|V.childLanes,O|=V.subtreeFlags,O|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=O,p.childLanes=T,v}function bce(p,v,T){var O=v.pendingProps;switch(H(v),v.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $r(v),null;case 1:return $r(v),null;case 3:return T=v.stateNode,O=null,p!==null&&(O=p.memoizedState.cache),v.memoizedState.cache!==O&&(v.flags|=2048),ce(ai),ee(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(p===null||p.child===null)&&(be(v)?Io(v):p===null||p.memoizedState.isDehydrated&&(v.flags&256)===0||(v.flags|=1024,ke())),WP(p,v),$r(v),null;case 26:if(Po){var V=v.type,K=v.memoizedState;return p===null?(Io(v),K!==null?($r(v),YP(v,K)):($r(v),PS(v,V,null,O,T))):K?K!==p.memoizedState?(Io(v),$r(v),YP(v,K)):($r(v),v.flags&=-16777217):(K=p.memoizedProps,Ca?K!==O&&Io(v):RS(p,v,V,O),$r(v),PS(v,V,K,O,T)),null}case 27:if(Ki){if(ue(v),T=pc.current,V=v.type,p!==null&&v.stateNode!=null)Ca?p.memoizedProps!==O&&Io(v):RS(p,v,V,O);else{if(!O){if(v.stateNode===null)throw Error(i(166));return $r(v),null}p=fa.current,be(v)?Te(v,p):(p=u9(V,O,T,p,!0),v.stateNode=p,Io(v))}return $r(v),null}case 5:if(ue(v),V=v.type,p!==null&&v.stateNode!=null)RS(p,v,V,O);else{if(!O){if(v.stateNode===null)throw Error(i(166));return $r(v),null}if(K=fa.current,be(v))Te(v,K),Zde(v.stateNode,V,O,K)&&(v.flags|=64);else{var pe=Vce(V,O,pc.current,K,v);gy(v),NS(pe,v,!1,!1),v.stateNode=pe,VD(pe,V,O,K)&&Io(v)}}return $r(v),PS(v,v.type,p===null?null:p.memoizedProps,v.pendingProps,T),null;case 6:if(p&&v.stateNode!=null)T=p.memoizedProps,Ca?T!==O&&Io(v):pl&&(T!==O?(p=pc.current,T=fa.current,gy(v),v.stateNode=qD(O,p,T,v)):v.stateNode=p.stateNode);else{if(typeof O!="string"&&v.stateNode===null)throw Error(i(166));if(p=pc.current,T=fa.current,be(v)){if(!Ma)throw Error(i(176));if(p=v.stateNode,T=v.memoizedProps,O=null,V=pa,V!==null)switch(V.tag){case 27:case 5:O=V.memoizedProps}Hde(p,T,v,O)||oe(v,!0)}else gy(v),v.stateNode=qD(O,p,T,v)}return $r(v),null;case 31:if(T=v.memoizedState,p===null||p.memoizedState!==null){if(O=be(v),T!==null){if(p===null){if(!O)throw Error(i(318));if(!Ma)throw Error(i(556));if(p=v.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(557));$de(p,v)}else De(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;$r(v),p=!1}else T=ke(),p!==null&&p.memoizedState!==null&&(p.memoizedState.hydrationErrors=T),p=!0;if(!p)return v.flags&256?(St(v),v):(St(v),null);if((v.flags&128)!==0)throw Error(i(558))}return $r(v),null;case 13:if(O=v.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(V=be(v),O!==null&&O.dehydrated!==null){if(p===null){if(!V)throw Error(i(318));if(!Ma)throw Error(i(344));if(V=v.memoizedState,V=V!==null?V.dehydrated:null,!V)throw Error(i(317));Vde(V,v)}else De(),(v.flags&128)===0&&(v.memoizedState=null),v.flags|=4;$r(v),V=!1}else V=ke(),p!==null&&p.memoizedState!==null&&(p.memoizedState.hydrationErrors=V),V=!0;if(!V)return v.flags&256?(St(v),v):(St(v),null)}return St(v),(v.flags&128)!==0?(v.lanes=T,v):(T=O!==null,p=p!==null&&p.memoizedState!==null,T&&(O=v.child,V=null,O.alternate!==null&&O.alternate.memoizedState!==null&&O.alternate.memoizedState.cachePool!==null&&(V=O.alternate.memoizedState.cachePool.pool),K=null,O.memoizedState!==null&&O.memoizedState.cachePool!==null&&(K=O.memoizedState.cachePool.pool),K!==V&&(O.flags|=2048)),T!==p&&T&&(v.child.flags|=8192),vy(v,v.updateQueue),$r(v),null);case 4:return ee(),WP(p,v),p===null&&Yce(v.stateNode.containerInfo),$r(v),null;case 10:return ce(v.type),$r(v),null;case 19:if(f(bi),O=v.memoizedState,O===null)return $r(v),null;if(V=(v.flags&128)!==0,K=O.rendering,K===null)if(V)mm(O,!1);else{if(gi!==0||p!==null&&(p.flags&128)!==0)for(p=v.child;p!==null;){if(K=Lt(p),K!==null){for(v.flags|=128,mm(O,!1),p=K.updateQueue,v.updateQueue=p,vy(v,p),v.subtreeFlags=0,p=T,T=v.child;T!==null;)PD(T,p),T=T.sibling;return m(bi,bi.current&1|2),Qn&&z(v,O.treeForkCount),v.child}p=p.sibling}O.tail!==null&&ls()>Pm&&(v.flags|=128,V=!0,mm(O,!1),v.lanes=4194304)}else{if(!V)if(p=Lt(K),p!==null){if(v.flags|=128,V=!0,p=p.updateQueue,v.updateQueue=p,vy(v,p),mm(O,!0),O.tail===null&&O.tailMode==="hidden"&&!K.alternate&&!Qn)return $r(v),null}else 2*ls()-O.renderingStartTime>Pm&&T!==536870912&&(v.flags|=128,V=!0,mm(O,!1),v.lanes=4194304);O.isBackwards?(K.sibling=v.child,v.child=K):(p=O.last,p!==null?p.sibling=K:v.child=K,O.last=K)}return O.tail!==null?(p=O.tail,O.rendering=p,O.tail=p.sibling,O.renderingStartTime=ls(),p.sibling=null,T=bi.current,m(bi,V?T&1|2:T&1),Qn&&z(v,O.treeForkCount),p):($r(v),null);case 22:case 23:return St(v),ge(),O=v.memoizedState!==null,p!==null?p.memoizedState!==null!==O&&(v.flags|=8192):O&&(v.flags|=8192),O?(T&536870912)!==0&&(v.flags&128)===0&&($r(v),v.subtreeFlags&6&&(v.flags|=8192)):$r(v),T=v.updateQueue,T!==null&&vy(v,T.retryQueue),T=null,p!==null&&p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(T=p.memoizedState.cachePool.pool),O=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(O=v.memoizedState.cachePool.pool),O!==T&&(v.flags|=2048),p!==null&&f(Ud),null;case 24:return T=null,p!==null&&(T=p.memoizedState.cache),v.memoizedState.cache!==T&&(v.flags|=2048),ce(ai),$r(v),null;case 25:return null;case 30:return null}throw Error(i(156,v.tag))}function _ce(p,v){switch(H(v),v.tag){case 1:return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 3:return ce(ai),ee(),p=v.flags,(p&65536)!==0&&(p&128)===0?(v.flags=p&-65537|128,v):null;case 26:case 27:case 5:return ue(v),null;case 31:if(v.memoizedState!==null){if(St(v),v.alternate===null)throw Error(i(340));De()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 13:if(St(v),p=v.memoizedState,p!==null&&p.dehydrated!==null){if(v.alternate===null)throw Error(i(340));De()}return p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 19:return f(bi),null;case 4:return ee(),null;case 10:return ce(v.type),null;case 22:case 23:return St(v),ge(),p!==null&&f(Ud),p=v.flags,p&65536?(v.flags=p&-65537|128,v):null;case 24:return ce(ai),null;case 25:return null;default:return null}}function XP(p,v){switch(H(v),v.tag){case 3:ce(ai),ee();break;case 26:case 27:case 5:ue(v);break;case 4:ee();break;case 31:v.memoizedState!==null&&St(v);break;case 13:St(v);break;case 19:f(bi);break;case 10:ce(v.type);break;case 22:case 23:St(v),ge(),p!==null&&f(Ud);break;case 24:ce(ai)}}function gm(p,v){try{var T=v.updateQueue,O=T!==null?T.lastEffect:null;if(O!==null){var V=O.next;T=V;do{if((T.tag&p)===p){O=void 0;var K=T.create,pe=T.inst;O=K(),pe.destroy=O}T=T.next}while(T!==V)}}catch(Ue){ur(v,v.return,Ue)}}function uc(p,v,T){try{var O=v.updateQueue,V=O!==null?O.lastEffect:null;if(V!==null){var K=V.next;O=K;do{if((O.tag&p)===p){var pe=O.inst,Ue=pe.destroy;if(Ue!==void 0){pe.destroy=void 0,V=v;var ut=T,xt=Ue;try{xt()}catch(Ft){ur(V,ut,Ft)}}}O=O.next}while(O!==K)}}catch(Ft){ur(v,v.return,Ft)}}function KP(p){var v=p.updateQueue;if(v!==null){var T=p.stateNode;try{ba(v,T)}catch(O){ur(p,p.return,O)}}}function ZP(p,v,T){T.props=Nd(p.type,p.memoizedProps),T.state=p.memoizedState;try{T.componentWillUnmount()}catch(O){ur(p,v,O)}}function vm(p,v){try{var T=p.ref;if(T!==null){switch(p.tag){case 26:case 27:case 5:var O=_m(p.stateNode);break;case 30:O=p.stateNode;break;default:O=p.stateNode}typeof T=="function"?p.refCleanup=T(O):T.current=O}}catch(V){ur(p,v,V)}}function fl(p,v){var T=p.ref,O=p.refCleanup;if(T!==null)if(typeof O=="function")try{O()}catch(V){ur(p,v,V)}finally{p.refCleanup=null,p=p.alternate,p!=null&&(p.refCleanup=null)}else if(typeof T=="function")try{T(null)}catch(V){ur(p,v,V)}else T.current=null}function JP(p){var v=p.type,T=p.memoizedProps,O=p.stateNode;try{pde(O,v,T,p)}catch(V){ur(p,p.return,V)}}function DS(p,v,T){try{mde(p.stateNode,p.type,T,v,p)}catch(O){ur(p,p.return,O)}}function QP(p){return p.tag===5||p.tag===3||(Po?p.tag===26:!1)||(Ki?p.tag===27&&Vf(p.type):!1)||p.tag===4}function OS(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||QP(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(Ki&&p.tag===27&&Vf(p.type)||p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function LS(p,v,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,v?vde(T,p,v):hde(T,p);else if(O!==4&&(Ki&&O===27&&Vf(p.type)&&(T=p.stateNode,v=null),p=p.child,p!==null))for(LS(p,v,T),p=p.sibling;p!==null;)LS(p,v,T),p=p.sibling}function yy(p,v,T){var O=p.tag;if(O===5||O===6)p=p.stateNode,v?gde(T,p,v):dde(T,p);else if(O!==4&&(Ki&&O===27&&Vf(p.type)&&(T=p.stateNode),p=p.child,p!==null))for(yy(p,v,T),p=p.sibling;p!==null;)yy(p,v,T),p=p.sibling}function eD(p,v,T){p=p.containerInfo;try{ZD(p,T)}catch(O){ur(v,v.return,O)}}function tD(p){var v=p.stateNode,T=p.memoizedProps;try{che(p.type,T,v,p)}catch(O){ur(p,p.return,O)}}function wce(p,v){for(Hce(p.containerInfo),na=v;na!==null;)if(p=na,v=p.child,(p.subtreeFlags&1028)!==0&&v!==null)v.return=p,na=v;else for(;na!==null;){p=na;var T=p.alternate;switch(v=p.flags,p.tag){case 0:if((v&4)!==0&&(v=p.updateQueue,v=v!==null?v.events:null,v!==null))for(var O=0;O<v.length;O++){var V=v[O];V.ref.impl=V.nextImpl}break;case 11:case 15:break;case 1:if((v&1024)!==0&&T!==null){v=void 0,O=p,V=T.memoizedProps,T=T.memoizedState;var K=O.stateNode;try{var pe=Nd(O.type,V);v=K.getSnapshotBeforeUpdate(pe,T),K.__reactInternalSnapshotBeforeUpdate=v}catch(Ue){ur(O,O.return,Ue)}}break;case 3:(v&1024)!==0&&Ca&&Ede(p.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((v&1024)!==0)throw Error(i(163))}if(v=p.sibling,v!==null){v.return=p.return,na=v;break}na=p.return}}function nD(p,v,T){var O=T.flags;switch(T.tag){case 0:case 11:case 15:ou(p,T),O&4&&gm(5,T);break;case 1:if(ou(p,T),O&4)if(p=T.stateNode,v===null)try{p.componentDidMount()}catch(pe){ur(T,T.return,pe)}else{var V=Nd(T.type,v.memoizedProps);v=v.memoizedState;try{p.componentDidUpdate(V,v,p.__reactInternalSnapshotBeforeUpdate)}catch(pe){ur(T,T.return,pe)}}O&64&&KP(T),O&512&&vm(T,T.return);break;case 3:if(ou(p,T),O&64&&(O=T.updateQueue,O!==null)){if(p=null,T.child!==null)switch(T.child.tag){case 27:case 5:p=_m(T.child.stateNode);break;case 1:p=T.child.stateNode}try{ba(O,p)}catch(pe){ur(T,T.return,pe)}}break;case 27:Ki&&v===null&&O&4&&tD(T);case 26:case 5:if(ou(p,T),v===null){if(O&4)JP(T);else if(O&64){p=T.type,v=T.memoizedProps,V=T.stateNode;try{Wde(V,p,v,T)}catch(pe){ur(T,T.return,pe)}}}O&512&&vm(T,T.return);break;case 12:ou(p,T);break;case 31:ou(p,T),O&4&&iD(p,T);break;case 13:ou(p,T),O&4&&aD(p,T),O&64&&(O=T.memoizedState,O!==null&&(O=O.dehydrated,O!==null&&(T=kce.bind(null,T),Ade(O,T))));break;case 22:if(O=T.memoizedState!==null||pu,!O){v=v!==null&&v.memoizedState!==null||Di,V=pu;var K=Di;pu=O,(Di=v)&&!K?lu(p,T,(T.subtreeFlags&8772)!==0):ou(p,T),pu=V,Di=K}break;case 30:break;default:ou(p,T)}}function rD(p){var v=p.alternate;v!==null&&(p.alternate=null,rD(v)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(v=p.stateNode,v!==null&&Zce(v)),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function No(p,v,T){for(T=T.child;T!==null;)FS(p,v,T),T=T.sibling}function FS(p,v,T){if(Ds&&typeof Ds.onCommitFiberUnmount=="function")try{Ds.onCommitFiberUnmount(Em,T)}catch{}switch(T.tag){case 26:if(Po){Di||fl(T,v),No(p,v,T),T.memoizedState?a9(T.memoizedState):T.stateNode&&o9(T.stateNode);break}case 27:if(Ki){Di||fl(T,v);var O=Oi,V=us;Vf(T.type)&&(Oi=T.stateNode,us=!1),No(p,v,T),c9(T.stateNode),Oi=O,us=V;break}case 5:Di||fl(T,v);case 6:if(Ca){if(O=Oi,V=us,Oi=null,No(p,v,T),Oi=O,us=V,Oi!==null)if(us)try{xde(Oi,T.stateNode)}catch(K){ur(T,v,K)}else try{yde(Oi,T.stateNode)}catch(K){ur(T,v,K)}}else No(p,v,T);break;case 18:Ca&&Oi!==null&&(us?ehe(Oi,T.stateNode):Qde(Oi,T.stateNode));break;case 4:Ca?(O=Oi,V=us,Oi=T.stateNode.containerInfo,us=!0,No(p,v,T),Oi=O,us=V):(pl&&eD(T.stateNode,T,XD()),No(p,v,T));break;case 0:case 11:case 14:case 15:uc(2,T,v),Di||uc(4,T,v),No(p,v,T);break;case 1:Di||(fl(T,v),O=T.stateNode,typeof O.componentWillUnmount=="function"&&ZP(T,v,O)),No(p,v,T);break;case 21:No(p,v,T);break;case 22:Di=(O=Di)||T.memoizedState!==null,No(p,v,T),Di=O;break;default:No(p,v,T)}}function iD(p,v){if(Ma&&v.memoizedState===null&&(p=v.alternate,p!==null&&(p=p.memoizedState,p!==null))){p=p.dehydrated;try{Xde(p)}catch(T){ur(v,v.return,T)}}}function aD(p,v){if(Ma&&v.memoizedState===null&&(p=v.alternate,p!==null&&(p=p.memoizedState,p!==null&&(p=p.dehydrated,p!==null))))try{Kde(p)}catch(T){ur(v,v.return,T)}}function Sce(p){switch(p.tag){case 31:case 13:case 19:var v=p.stateNode;return v===null&&(v=p.stateNode=new b9),v;case 22:return p=p.stateNode,v=p._retryCache,v===null&&(v=p._retryCache=new b9),v;default:throw Error(i(435,p.tag))}}function xy(p,v){var T=Sce(p);v.forEach(function(O){if(!T.has(O)){T.add(O);var V=Ice.bind(null,p,O);O.then(V,V)}})}function Ta(p,v){var T=v.deletions;if(T!==null)for(var O=0;O<T.length;O++){var V=T[O],K=p,pe=v;if(Ca){var Ue=pe;e:for(;Ue!==null;){switch(Ue.tag){case 27:if(Ki){if(Vf(Ue.type)){Oi=Ue.stateNode,us=!1;break e}break}case 5:Oi=Ue.stateNode,us=!1;break e;case 3:case 4:Oi=Ue.stateNode.containerInfo,us=!0;break e}Ue=Ue.return}if(Oi===null)throw Error(i(160));FS(K,pe,V),Oi=null,us=!1}else FS(K,pe,V);K=V.alternate,K!==null&&(K.return=null),V.return=null}if(v.subtreeFlags&13886)for(v=v.child;v!==null;)sD(v,p),v=v.sibling}function sD(p,v){var T=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:Ta(v,p),Va(p),O&4&&(uc(3,p,p.return),gm(3,p),uc(5,p,p.return));break;case 1:Ta(v,p),Va(p),O&512&&(Di||T===null||fl(T,T.return)),O&64&&pu&&(p=p.updateQueue,p!==null&&(O=p.callbacks,O!==null&&(T=p.shared.hiddenCallbacks,p.shared.hiddenCallbacks=T===null?O:T.concat(O))));break;case 26:if(Po){var V=Oo;if(Ta(v,p),Va(p),O&512&&(Di||T===null||fl(T,T.return)),O&4){O=T!==null?T.memoizedState:null;var K=p.memoizedState;T===null?K===null?p.stateNode===null?p.stateNode=ahe(V,p.type,p.memoizedProps,p):s9(V,p.type,p.stateNode):p.stateNode=i9(V,K,p.memoizedProps):O!==K?(O===null?T.stateNode!==null&&o9(T.stateNode):a9(O),K===null?s9(V,p.type,p.stateNode):i9(V,K,p.memoizedProps)):K===null&&p.stateNode!==null&&DS(p,p.memoizedProps,T.memoizedProps)}break}case 27:if(Ki){Ta(v,p),Va(p),O&512&&(Di||T===null||fl(T,T.return)),T!==null&&O&4&&DS(p,p.memoizedProps,T.memoizedProps);break}case 5:if(Ta(v,p),Va(p),O&512&&(Di||T===null||fl(T,T.return)),Ca){if(p.flags&32){V=p.stateNode;try{YD(V)}catch(It){ur(p,p.return,It)}}O&4&&p.stateNode!=null&&(V=p.memoizedProps,DS(p,V,T!==null?T.memoizedProps:V)),O&1024&&(T4=!0)}else pl&&p.alternate!==null&&(p.alternate.stateNode=p.stateNode);break;case 6:if(Ta(v,p),Va(p),O&4&&Ca){if(p.stateNode===null)throw Error(i(162));O=p.memoizedProps,T=T!==null?T.memoizedProps:O,V=p.stateNode;try{fde(V,T,O)}catch(It){ur(p,p.return,It)}}break;case 3:if(Po?(ohe(),V=Oo,Oo=l4(v.containerInfo),Ta(v,p),Oo=V):Ta(v,p),Va(p),O&4){if(Ca&&Ma&&T!==null&&T.memoizedState.isDehydrated)try{Yde(v.containerInfo)}catch(It){ur(p,p.return,It)}if(pl){O=v.containerInfo,T=v.pendingChildren;try{ZD(O,T)}catch(It){ur(p,p.return,It)}}}T4&&(T4=!1,oD(p));break;case 4:Po?(T=Oo,Oo=l4(p.stateNode.containerInfo),Ta(v,p),Va(p),Oo=T):(Ta(v,p),Va(p)),O&4&&pl&&eD(p.stateNode,p,p.stateNode.pendingChildren);break;case 12:Ta(v,p),Va(p);break;case 31:Ta(v,p),Va(p),O&4&&(O=p.updateQueue,O!==null&&(p.updateQueue=null,xy(p,O)));break;case 13:Ta(v,p),Va(p),p.child.flags&8192&&p.memoizedState!==null!=(T!==null&&T.memoizedState!==null)&&(Gy=ls()),O&4&&(O=p.updateQueue,O!==null&&(p.updateQueue=null,xy(p,O)));break;case 22:V=p.memoizedState!==null;var pe=T!==null&&T.memoizedState!==null,Ue=pu,ut=Di;if(pu=Ue||V,Di=ut||pe,Ta(v,p),Di=ut,pu=Ue,Va(p),O&8192&&(v=p.stateNode,v._visibility=V?v._visibility&-2:v._visibility|1,V&&(T===null||pe||pu||Di||Rd(p)),Ca)){e:if(T=null,Ca)for(v=p;;){if(v.tag===5||Po&&v.tag===26){if(T===null){pe=T=v;try{K=pe.stateNode,V?bde(K):wde(pe.stateNode,pe.memoizedProps)}catch(It){ur(pe,pe.return,It)}}}else if(v.tag===6){if(T===null){pe=v;try{var xt=pe.stateNode;V?_de(xt):Sde(xt,pe.memoizedProps)}catch(It){ur(pe,pe.return,It)}}}else if(v.tag===18){if(T===null){pe=v;try{var Ft=pe.stateNode;V?the(Ft):nhe(pe.stateNode)}catch(It){ur(pe,pe.return,It)}}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===p)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===p)break e;for(;v.sibling===null;){if(v.return===null||v.return===p)break e;T===v&&(T=null),v=v.return}T===v&&(T=null),v.sibling.return=v.return,v=v.sibling}}O&4&&(O=p.updateQueue,O!==null&&(T=O.retryQueue,T!==null&&(O.retryQueue=null,xy(p,T))));break;case 19:Ta(v,p),Va(p),O&4&&(O=p.updateQueue,O!==null&&(p.updateQueue=null,xy(p,O)));break;case 30:break;case 21:break;default:Ta(v,p),Va(p)}}function Va(p){var v=p.flags;if(v&2){try{for(var T,O=p.return;O!==null;){if(QP(O)){T=O;break}O=O.return}if(Ca){if(T==null)throw Error(i(160));switch(T.tag){case 27:if(Ki){var V=T.stateNode,K=OS(p);yy(p,K,V);break}case 5:var pe=T.stateNode;T.flags&32&&(YD(pe),T.flags&=-33);var Ue=OS(p);yy(p,Ue,pe);break;case 3:case 4:var ut=T.stateNode.containerInfo,xt=OS(p);LS(p,xt,ut);break;default:throw Error(i(161))}}}catch(Ft){ur(p,p.return,Ft)}p.flags&=-3}v&4096&&(p.flags&=-4097)}function oD(p){if(p.subtreeFlags&1024)for(p=p.child;p!==null;){var v=p;oD(v),v.tag===5&&v.flags&1024&&nde(v.stateNode),p=p.sibling}}function ou(p,v){if(v.subtreeFlags&8772)for(v=v.child;v!==null;)nD(p,v.alternate,v),v=v.sibling}function Rd(p){for(p=p.child;p!==null;){var v=p;switch(v.tag){case 0:case 11:case 14:case 15:uc(4,v,v.return),Rd(v);break;case 1:fl(v,v.return);var T=v.stateNode;typeof T.componentWillUnmount=="function"&&ZP(v,v.return,T),Rd(v);break;case 27:Ki&&c9(v.stateNode);case 26:case 5:fl(v,v.return),Rd(v);break;case 22:v.memoizedState===null&&Rd(v);break;case 30:Rd(v);break;default:Rd(v)}p=p.sibling}}function lu(p,v,T){for(T=T&&(v.subtreeFlags&8772)!==0,v=v.child;v!==null;){var O=v.alternate,V=p,K=v,pe=K.flags;switch(K.tag){case 0:case 11:case 15:lu(V,K,T),gm(4,K);break;case 1:if(lu(V,K,T),O=K,V=O.stateNode,typeof V.componentDidMount=="function")try{V.componentDidMount()}catch(xt){ur(O,O.return,xt)}if(O=K,V=O.updateQueue,V!==null){var Ue=O.stateNode;try{var ut=V.shared.hiddenCallbacks;if(ut!==null)for(V.shared.hiddenCallbacks=null,V=0;V<ut.length;V++)la(ut[V],Ue)}catch(xt){ur(O,O.return,xt)}}T&&pe&64&&KP(K),vm(K,K.return);break;case 27:Ki&&tD(K);case 26:case 5:lu(V,K,T),T&&O===null&&pe&4&&JP(K),vm(K,K.return);break;case 12:lu(V,K,T);break;case 31:lu(V,K,T),T&&pe&4&&iD(V,K);break;case 13:lu(V,K,T),T&&pe&4&&aD(V,K);break;case 22:K.memoizedState===null&&lu(V,K,T),vm(K,K.return);break;case 30:break;default:lu(V,K,T)}v=v.sibling}}function BS(p,v){var T=null;p!==null&&p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(T=p.memoizedState.cachePool.pool),p=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(p=v.memoizedState.cachePool.pool),p!==T&&(p!=null&&p.refCount++,T!=null&&ve(T))}function US(p,v){p=null,v.alternate!==null&&(p=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==p&&(v.refCount++,p!=null&&ve(p))}function Ro(p,v,T,O){if(v.subtreeFlags&10256)for(v=v.child;v!==null;)lD(p,v,T,O),v=v.sibling}function lD(p,v,T,O){var V=v.flags;switch(v.tag){case 0:case 11:case 15:Ro(p,v,T,O),V&2048&&gm(9,v);break;case 1:Ro(p,v,T,O);break;case 3:Ro(p,v,T,O),V&2048&&(p=null,v.alternate!==null&&(p=v.alternate.memoizedState.cache),v=v.memoizedState.cache,v!==p&&(v.refCount++,p!=null&&ve(p)));break;case 12:if(V&2048){Ro(p,v,T,O),p=v.stateNode;try{var K=v.memoizedProps,pe=K.id,Ue=K.onPostCommit;typeof Ue=="function"&&Ue(pe,v.alternate===null?"mount":"update",p.passiveEffectDuration,-0)}catch(ut){ur(v,v.return,ut)}}else Ro(p,v,T,O);break;case 31:Ro(p,v,T,O);break;case 13:Ro(p,v,T,O);break;case 23:break;case 22:K=v.stateNode,pe=v.alternate,v.memoizedState!==null?K._visibility&2?Ro(p,v,T,O):ym(p,v):K._visibility&2?Ro(p,v,T,O):(K._visibility|=2,Bf(p,v,T,O,(v.subtreeFlags&10256)!==0||!1)),V&2048&&BS(pe,v);break;case 24:Ro(p,v,T,O),V&2048&&US(v.alternate,v);break;default:Ro(p,v,T,O)}}function Bf(p,v,T,O,V){for(V=V&&((v.subtreeFlags&10256)!==0||!1),v=v.child;v!==null;){var K=p,pe=v,Ue=T,ut=O,xt=pe.flags;switch(pe.tag){case 0:case 11:case 15:Bf(K,pe,Ue,ut,V),gm(8,pe);break;case 23:break;case 22:var Ft=pe.stateNode;pe.memoizedState!==null?Ft._visibility&2?Bf(K,pe,Ue,ut,V):ym(K,pe):(Ft._visibility|=2,Bf(K,pe,Ue,ut,V)),V&&xt&2048&&BS(pe.alternate,pe);break;case 24:Bf(K,pe,Ue,ut,V),V&&xt&2048&&US(pe.alternate,pe);break;default:Bf(K,pe,Ue,ut,V)}v=v.sibling}}function ym(p,v){if(v.subtreeFlags&10256)for(v=v.child;v!==null;){var T=p,O=v,V=O.flags;switch(O.tag){case 22:ym(T,O),V&2048&&BS(O.alternate,O);break;case 24:ym(T,O),V&2048&&US(O.alternate,O);break;default:ym(T,O)}v=v.sibling}}function Pd(p,v,T){if(p.subtreeFlags&ip)for(p=p.child;p!==null;)uD(p,v,T),p=p.sibling}function uD(p,v,T){switch(p.tag){case 26:if(Pd(p,v,T),p.flags&ip)if(p.memoizedState!==null)uhe(T,Oo,p.memoizedState,p.memoizedProps);else{var O=p.stateNode,V=p.type;p=p.memoizedProps,((v&335544128)===v||a4(V,p))&&WD(T,O,V,p)}break;case 5:Pd(p,v,T),p.flags&ip&&(O=p.stateNode,V=p.type,p=p.memoizedProps,((v&335544128)===v||a4(V,p))&&WD(T,O,V,p));break;case 3:case 4:Po?(O=Oo,Oo=l4(p.stateNode.containerInfo),Pd(p,v,T),Oo=O):Pd(p,v,T);break;case 22:p.memoizedState===null&&(O=p.alternate,O!==null&&O.memoizedState!==null?(O=ip,ip=16777216,Pd(p,v,T),ip=O):Pd(p,v,T));break;default:Pd(p,v,T)}}function cD(p){var v=p.alternate;if(v!==null&&(p=v.child,p!==null)){v.child=null;do v=p.sibling,p.sibling=null,p=v;while(p!==null)}}function xm(p){var v=p.deletions;if((p.flags&16)!==0){if(v!==null)for(var T=0;T<v.length;T++){var O=v[T];na=O,hD(O,p)}cD(p)}if(p.subtreeFlags&10256)for(p=p.child;p!==null;)dD(p),p=p.sibling}function dD(p){switch(p.tag){case 0:case 11:case 15:xm(p),p.flags&2048&&uc(9,p,p.return);break;case 3:xm(p);break;case 12:xm(p);break;case 22:var v=p.stateNode;p.memoizedState!==null&&v._visibility&2&&(p.return===null||p.return.tag!==13)?(v._visibility&=-3,by(p)):xm(p);break;default:xm(p)}}function by(p){var v=p.deletions;if((p.flags&16)!==0){if(v!==null)for(var T=0;T<v.length;T++){var O=v[T];na=O,hD(O,p)}cD(p)}for(p=p.child;p!==null;){switch(v=p,v.tag){case 0:case 11:case 15:uc(8,v,v.return),by(v);break;case 22:T=v.stateNode,T._visibility&2&&(T._visibility&=-3,by(v));break;default:by(v)}p=p.sibling}}function hD(p,v){for(;na!==null;){var T=na;switch(T.tag){case 0:case 11:case 15:uc(8,T,v);break;case 23:case 22:if(T.memoizedState!==null&&T.memoizedState.cachePool!==null){var O=T.memoizedState.cachePool.pool;O!=null&&O.refCount++}break;case 24:ve(T.memoizedState.cache)}if(O=T.child,O!==null)O.return=T,na=O;else e:for(T=p;na!==null;){O=na;var V=O.sibling,K=O.return;if(rD(O),O===T){na=null;break e}if(V!==null){V.return=K,na=V;break e}na=K}}}function zS(p){var v=Wce(p);if(v!=null){if(typeof v.memoizedProps["data-testname"]!="string")throw Error(i(364));return v}if(p=ade(p),p===null)throw Error(i(362));return p.stateNode.current}function jS(p,v){var T=p.tag;switch(v.$$typeof){case jy:if(p.type===v.value)return!0;break;case Hy:e:{for(v=v.value,p=[p,0],T=0;T<p.length;){var O=p[T++],V=O.tag,K=p[T++],pe=v[K];if(V!==5&&V!==26&&V!==27||!Sm(O)){for(;pe!=null&&jS(O,pe);)K++,pe=v[K];if(K===v.length){v=!0;break e}else for(O=O.child;O!==null;)p.push(O,K),O=O.sibling}}v=!1}return v;case $y:if((T===5||T===26||T===27)&&lde(p.stateNode,v.value))return!0;break;case qy:if((T===5||T===6||T===26||T===27)&&(p=ode(p),p!==null&&0<=p.indexOf(v.value)))return!0;break;case Vy:if((T===5||T===26||T===27)&&(p=p.memoizedProps["data-testname"],typeof p=="string"&&p.toLowerCase()===v.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function HS(p){switch(p.$$typeof){case jy:return"<"+(d(p.value)||"Unknown")+">";case Hy:return":has("+(HS(p)||"")+")";case $y:return'[role="'+p.value+'"]';case qy:return'"'+p.value+'"';case Vy:return'[data-testname="'+p.value+'"]';default:throw Error(i(365))}}function fD(p,v){var T=[];p=[p,0];for(var O=0;O<p.length;){var V=p[O++],K=V.tag,pe=p[O++],Ue=v[pe];if(K!==5&&K!==26&&K!==27||!Sm(V)){for(;Ue!=null&&jS(V,Ue);)pe++,Ue=v[pe];if(pe===v.length)T.push(V);else for(V=V.child;V!==null;)p.push(V,pe),V=V.sibling}}return T}function $S(p,v){if(!wm)throw Error(i(363));p=zS(p),p=fD(p,v),v=[],p=Array.from(p);for(var T=0;T<p.length;){var O=p[T++],V=O.tag;if(V===5||V===26||V===27)Sm(O)||v.push(O.stateNode);else for(O=O.child;O!==null;)p.push(O),O=O.sibling}return v}function Ns(){return(Hn&2)!==0&&Gn!==0?Gn&-Gn:dn.T!==null?je():Xce()}function pD(){if(Bs===0)if((Gn&536870912)===0||Qn){var p=Ay;Ay<<=1,(Ay&3932160)===0&&(Ay=262144),Bs=p}else Bs=536870912;return p=Ls.current,p!==null&&(p.flags|=32),Bs}function os(p,v,T){(p===Nr&&(br===2||br===9)||p.cancelPendingCommit!==null)&&(Uf(p,0),cc(p,Gn,Bs,!1)),E(p,T),((Hn&2)===0||p!==Nr)&&(p===Nr&&((Hn&2)===0&&($d|=T),gi===4&&cc(p,Gn,Bs,!1)),Be(p))}function mD(p,v,T){if((Hn&6)!==0)throw Error(i(327));var O=!T&&(v&127)===0&&(v&p.expiredLanes)===0||w(p,v),V=O?Cce(p,v):qS(p,v,!0),K=O;do{if(V===0){ap&&!O&&cc(p,v,0,!1);break}else{if(T=p.current.alternate,K&&!Ece(T)){V=qS(p,v,!1),K=!1;continue}if(V===2){if(K=v,p.errorRecoveryDisabledLanes&K)var pe=0;else pe=p.pendingLanes&-536870913,pe=pe!==0?pe:pe&536870912?536870912:0;if(pe!==0){v=pe;e:{var Ue=p;V=Rm;var ut=Ma&&Ue.current.memoizedState.isDehydrated;if(ut&&(Uf(Ue,pe).flags|=256),pe=qS(Ue,pe,!1),pe!==2){if(C4&&!ut){Ue.errorRecoveryDisabledLanes|=K,$d|=K,V=4;break e}K=cs,cs=V,K!==null&&(cs===null?cs=K:cs.push.apply(cs,K))}V=pe}if(K=!1,V!==2)continue}}if(V===1){Uf(p,0),cc(p,v,0,!0);break}e:{switch(O=p,K=V,K){case 0:case 1:throw Error(i(345));case 4:if((v&4194048)!==v)break;case 6:cc(O,v,Bs,!vc);break e;case 2:cs=null;break;case 3:case 5:break;default:throw Error(i(329))}if((v&62914560)===v&&(V=Gy+300-ls(),10<V)){if(cc(O,v,Bs,!vc),y(O,0,!0)!==0)break e;gu=v,O.timeoutHandle=qce(gD.bind(null,O,T,cs,Wy,A4,v,Bs,$d,sp,vc,K,"Throttled",-0,0),V);break e}gD(O,T,cs,Wy,A4,v,Bs,$d,sp,vc,K,null,-0,0)}}break}while(!0);Be(p)}function gD(p,v,T,O,V,K,pe,Ue,ut,xt,Ft,It,Yt,Tn){if(p.timeoutHandle=Od,It=v.subtreeFlags,It&8192||(It&16785408)===16785408){It=ede(),uD(v,K,It);var Li=(K&62914560)===K?Gy-ls():(K&4194048)===K?_9-ls():0;if(Li=tde(It,Li),Li!==null){gu=K,p.cancelPendingCommit=Li(TD.bind(null,p,v,K,T,O,V,pe,Ue,ut,Ft,It,null,Yt,Tn)),cc(p,K,pe,!xt);return}}TD(p,v,K,T,O,V,pe,Ue,ut)}function Ece(p){for(var v=p;;){var T=v.tag;if((T===0||T===11||T===15)&&v.flags&16384&&(T=v.updateQueue,T!==null&&(T=T.stores,T!==null)))for(var O=0;O<T.length;O++){var V=T[O],K=V.getSnapshot;V=V.value;try{if(!Os(K(),V))return!1}catch{return!1}}if(T=v.child,v.subtreeFlags&16384&&T!==null)T.return=v,v=T;else{if(v===p)break;for(;v.sibling===null;){if(v.return===null||v.return===p)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function cc(p,v,T,O){v&=~M4,v&=~$d,p.suspendedLanes|=v,p.pingedLanes&=~v,O&&(p.warmLanes|=v),O=p.expirationTimes;for(var V=v;0<V;){var K=31-Ps(V),pe=1<<K;O[K]=-1,V&=~pe}T!==0&&R(p,T,v)}function vD(){return(Hn&6)===0?(He(0),!1):!0}function VS(){if($n!==null){if(br===0)var p=$n.return;else p=$n,hu=Fd=null,qn(p),Qf=null,Am=0,p=$n;for(;p!==null;)XP(p.alternate,p),p=p.return;$n=null}}function Uf(p,v){var T=p.timeoutHandle;T!==Od&&(p.timeoutHandle=Od,Gce(T)),T=p.cancelPendingCommit,T!==null&&(p.cancelPendingCommit=null,T()),gu=0,VS(),Nr=p,$n=T=uu(p.current,null),Gn=v,br=0,Fs=null,vc=!1,ap=w(p,v),C4=!1,sp=Bs=M4=$d=yc=gi=0,cs=Rm=null,A4=!1,(v&8)!==0&&(v|=v&32);var O=p.entangledLanes;if(O!==0)for(p=p.entanglements,O&=v;0<O;){var V=31-Ps(O),K=1<<V;v|=p[V],O&=~K}return mu=v,ki(),T}function yD(p,v){An=null,dn.H=Im,v===Jf||v===Ly?(v=Ht(),br=3):v===y4?(v=Ht(),br=4):br=v===S4?8:v!==null&&typeof v=="object"&&typeof v.then=="function"?6:1,Fs=v,$n===null&&(gi=1,hy(p,Q(v,p.current)))}function xD(){var p=Ls.current;return p===null?!0:(Gn&4194048)===Gn?Do===null:(Gn&62914560)===Gn||(Gn&536870912)!==0?p===Do:!1}function bD(){var p=dn.H;return dn.H=Im,p===null?Im:p}function _D(){var p=dn.A;return dn.A=Ehe,p}function _y(){gi=4,vc||(Gn&4194048)!==Gn&&Ls.current!==null||(ap=!0),(yc&134217727)===0&&($d&134217727)===0||Nr===null||cc(Nr,Gn,Bs,!1)}function qS(p,v,T){var O=Hn;Hn|=2;var V=bD(),K=_D();(Nr!==p||Gn!==v)&&(Wy=null,Uf(p,v)),v=!1;var pe=gi;e:do try{if(br!==0&&$n!==null){var Ue=$n,ut=Fs;switch(br){case 8:VS(),pe=6;break e;case 3:case 2:case 9:case 6:Ls.current===null&&(v=!0);var xt=br;if(br=0,Fs=null,zf(p,Ue,ut,xt),T&&ap){pe=0;break e}break;default:xt=br,br=0,Fs=null,zf(p,Ue,ut,xt)}}Tce(),pe=gi;break}catch(Ft){yD(p,Ft)}while(!0);return v&&p.shellSuspendCounter++,hu=Fd=null,Hn=O,dn.H=V,dn.A=K,$n===null&&(Nr=null,Gn=0,ki()),pe}function Tce(){for(;$n!==null;)wD($n)}function Cce(p,v){var T=Hn;Hn|=2;var O=bD(),V=_D();Nr!==p||Gn!==v?(Wy=null,Pm=ls()+500,Uf(p,v)):ap=w(p,v);e:do try{if(br!==0&&$n!==null){v=$n;var K=Fs;t:switch(br){case 1:br=0,Fs=null,zf(p,v,K,1);break;case 2:case 9:if(ft(K)){br=0,Fs=null,SD(v);break}v=function(){br!==2&&br!==9||Nr!==p||(br=7),Be(p)},K.then(v,v);break e;case 3:br=7;break e;case 4:br=5;break e;case 7:ft(K)?(br=0,Fs=null,SD(v)):(br=0,Fs=null,zf(p,v,K,7));break;case 5:var pe=null;switch($n.tag){case 26:pe=$n.memoizedState;case 5:case 27:var Ue=$n,ut=Ue.type,xt=Ue.pendingProps;if(pe?l9(pe):GD(Ue.stateNode,ut,xt)){br=0,Fs=null;var Ft=Ue.sibling;if(Ft!==null)$n=Ft;else{var It=Ue.return;It!==null?($n=It,wy(It)):$n=null}break t}}br=0,Fs=null,zf(p,v,K,5);break;case 6:br=0,Fs=null,zf(p,v,K,6);break;case 8:VS(),gi=6;break e;default:throw Error(i(462))}}Mce();break}catch(Yt){yD(p,Yt)}while(!0);return hu=Fd=null,dn.H=O,dn.A=V,Hn=T,$n!==null?0:(Nr=null,Gn=0,ki(),gi)}function Mce(){for(;$n!==null&&!fhe();)wD($n)}function wD(p){var v=VP(p.alternate,p,mu);p.memoizedProps=p.pendingProps,v===null?wy(p):$n=v}function SD(p){var v=p,T=v.alternate;switch(v.tag){case 15:case 0:v=BP(T,v,v.pendingProps,v.type,void 0,Gn);break;case 11:v=BP(T,v,v.pendingProps,v.type.render,v.ref,Gn);break;case 5:qn(v);default:XP(T,v),v=$n=PD(v,mu),v=VP(T,v,mu)}p.memoizedProps=p.pendingProps,v===null?wy(p):$n=v}function zf(p,v,T,O){hu=Fd=null,qn(v),Qf=null,Am=0;var V=v.return;try{if(vce(p,V,v,T,Gn)){gi=1,hy(p,Q(T,p.current)),$n=null;return}}catch(K){if(V!==null)throw $n=V,K;gi=1,hy(p,Q(T,p.current)),$n=null;return}v.flags&32768?(Qn||O===1?p=!0:ap||(Gn&536870912)!==0?p=!1:(vc=p=!0,(O===2||O===9||O===3||O===6)&&(O=Ls.current,O!==null&&O.tag===13&&(O.flags|=16384))),ED(v,p)):wy(v)}function wy(p){var v=p;do{if((v.flags&32768)!==0){ED(v,vc);return}p=v.return;var T=bce(v.alternate,v,mu);if(T!==null){$n=T;return}if(v=v.sibling,v!==null){$n=v;return}$n=v=p}while(v!==null);gi===0&&(gi=5)}function ED(p,v){do{var T=_ce(p.alternate,p);if(T!==null){T.flags&=32767,$n=T;return}if(T=p.return,T!==null&&(T.flags|=32768,T.subtreeFlags=0,T.deletions=null),!v&&(p=p.sibling,p!==null)){$n=p;return}$n=p=T}while(p!==null);gi=6,$n=null}function TD(p,v,T,O,V,K,pe,Ue,ut){p.cancelPendingCommit=null;do bm();while(Zi!==0);if((Hn&6)!==0)throw Error(i(327));if(v!==null){if(v===p.current)throw Error(i(177));if(K=v.lanes|v.childLanes,K|=x4,C(p,T,K,pe,Ue,ut),p===Nr&&($n=Nr=null,Gn=0),op=v,bc=p,gu=T,k4=K,I4=V,w9=O,(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?(p.callbackNode=null,p.callbackPriority=0,Nce(d4,function(){return ID(),null})):(p.callbackNode=null,p.callbackPriority=0),O=(v.flags&13878)!==0,(v.subtreeFlags&13878)!==0||O){O=dn.T,dn.T=null,V=du(),ta(2),pe=Hn,Hn|=4;try{wce(p,v,T)}finally{Hn=pe,ta(V),dn.T=O}}Zi=1,CD(),MD(),AD()}}function CD(){if(Zi===1){Zi=0;var p=bc,v=op,T=(v.flags&13878)!==0;if((v.subtreeFlags&13878)!==0||T){T=dn.T,dn.T=null;var O=du();ta(2);var V=Hn;Hn|=4;try{sD(v,p),$ce(p.containerInfo)}finally{Hn=V,ta(O),dn.T=T}}p.current=v,Zi=2}}function MD(){if(Zi===2){Zi=0;var p=bc,v=op,T=(v.flags&8772)!==0;if((v.subtreeFlags&8772)!==0||T){T=dn.T,dn.T=null;var O=du();ta(2);var V=Hn;Hn|=4;try{nD(p,v.alternate,v)}finally{Hn=V,ta(O),dn.T=T}}Zi=3}}function AD(){if(Zi===4||Zi===3){Zi=0,phe();var p=bc,v=op,T=gu,O=w9;(v.subtreeFlags&10256)!==0||(v.flags&10256)!==0?Zi=5:(Zi=0,op=bc=null,kD(p,p.pendingLanes));var V=p.pendingLanes;if(V===0&&(xc=null),D(T),v=v.stateNode,Ds&&typeof Ds.onCommitFiberRoot=="function")try{Ds.onCommitFiberRoot(Em,v,void 0,(v.current.flags&128)===128)}catch{}if(O!==null){v=dn.T,V=du(),ta(2),dn.T=null;try{for(var K=p.onRecoverableError,pe=0;pe<O.length;pe++){var Ue=O[pe];K(Ue.value,{componentStack:Ue.stack})}}finally{dn.T=v,ta(V)}}(gu&3)!==0&&bm(),Be(p),V=p.pendingLanes,(T&261930)!==0&&(V&42)!==0?p===N4?Dm++:(Dm=0,N4=p):Dm=0,Ma&&Jde(),He(0)}}function kD(p,v){(p.pooledCacheLanes&=v)===0&&(v=p.pooledCache,v!=null&&(p.pooledCache=null,ve(v)))}function bm(){return CD(),MD(),AD(),ID()}function ID(){if(Zi!==5)return!1;var p=bc,v=k4;k4=0;var T=D(gu),O=32>T?32:T;T=dn.T;var V=du();try{ta(O),dn.T=null,O=I4,I4=null;var K=bc,pe=gu;if(Zi=0,op=bc=null,gu=0,(Hn&6)!==0)throw Error(i(331));var Ue=Hn;if(Hn|=4,dD(K.current),lD(K,K.current,pe,O),Hn=Ue,He(0,!1),Ds&&typeof Ds.onPostCommitFiberRoot=="function")try{Ds.onPostCommitFiberRoot(Em,K)}catch{}return!0}finally{ta(V),dn.T=T,kD(p,v)}}function ND(p,v,T){v=Q(T,v),v=SS(p.stateNode,v,2),p=mi(p,v,2),p!==null&&(E(p,2),Be(p))}function ur(p,v,T){if(p.tag===3)ND(p,p,T);else for(;v!==null;){if(v.tag===3){ND(v,p,T);break}else if(v.tag===1){var O=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(xc===null||!xc.has(O))){p=Q(T,p),T=IP(2),O=mi(v,T,2),O!==null&&(NP(T,O,v,p),E(O,2),Be(O));break}}v=v.return}}function GS(p,v,T){var O=p.pingCache;if(O===null){O=p.pingCache=new The;var V=new Set;O.set(v,V)}else V=O.get(v),V===void 0&&(V=new Set,O.set(v,V));V.has(T)||(C4=!0,V.add(T),p=Ace.bind(null,p,v,T),v.then(p,p))}function Ace(p,v,T){var O=p.pingCache;O!==null&&O.delete(v),p.pingedLanes|=p.suspendedLanes&T,p.warmLanes&=~T,Nr===p&&(Gn&T)===T&&(gi===4||gi===3&&(Gn&62914560)===Gn&&300>ls()-Gy?(Hn&2)===0&&Uf(p,0):M4|=T,sp===Gn&&(sp=0)),Be(p)}function RD(p,v){v===0&&(v=S()),p=fr(p,v),p!==null&&(E(p,v),Be(p))}function kce(p){var v=p.memoizedState,T=0;v!==null&&(T=v.retryLane),RD(p,T)}function Ice(p,v){var T=0;switch(p.tag){case 31:case 13:var O=p.stateNode,V=p.memoizedState;V!==null&&(T=V.retryLane);break;case 19:O=p.stateNode;break;case 22:O=p.stateNode._retryCache;break;default:throw Error(i(314))}O!==null&&O.delete(v),RD(p,T)}function Nce(p,v){return Iy(p,v)}function Rce(p,v,T,O){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function WS(p){return p=p.prototype,!(!p||!p.isReactComponent)}function uu(p,v){var T=p.alternate;return T===null?(T=n(p.tag,v,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=v,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&65011712,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,v=p.dependencies,T.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T.refCleanup=p.refCleanup,T}function PD(p,v){p.flags&=65011714;var T=p.alternate;return T===null?(p.childLanes=0,p.lanes=v,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=T.childLanes,p.lanes=T.lanes,p.child=T.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=T.memoizedProps,p.memoizedState=T.memoizedState,p.updateQueue=T.updateQueue,p.type=T.type,v=T.dependencies,p.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),p}function Sy(p,v,T,O,V,K){var pe=0;if(O=p,typeof p=="function")WS(p)&&(pe=1);else if(typeof p=="string")pe=Po&&Ki?n9(p,T,fa.current)?26:d9(p)?27:5:Po?n9(p,T,fa.current)?26:5:Ki&&d9(p)?27:5;else e:switch(p){case r4:return p=n(31,T,v,V),p.elementType=r4,p.lanes=K,p;case Hf:return Dd(T.children,V,K,v);case zD:pe=8,V|=24;break;case JS:return p=n(12,T,v,V|2),p.elementType=JS,p.lanes=K,p;case e4:return p=n(13,T,v,V),p.elementType=e4,p.lanes=K,p;case t4:return p=n(19,T,v,V),p.elementType=t4,p.lanes=K,p;default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case dc:pe=10;break e;case jD:pe=9;break e;case QS:pe=11;break e;case n4:pe=14;break e;case hc:pe=16,O=null;break e}pe=29,T=Error(i(130,p===null?"null":typeof p,"")),O=null}return v=n(pe,T,v,V),v.elementType=p,v.type=O,v.lanes=K,v}function Dd(p,v,T,O){return p=n(7,p,O,v),p.lanes=T,p}function YS(p,v,T){return p=n(6,p,null,v),p.lanes=T,p}function DD(p){var v=n(18,null,null,0);return v.stateNode=p,v}function XS(p,v,T){return v=n(4,p.children!==null?p.children:[],p.key,v),v.lanes=T,v.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},v}function Pce(p,v,T,O,V,K,pe,Ue,ut){this.tag=1,this.containerInfo=p,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Od,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=M(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=M(0),this.hiddenUpdates=M(null),this.identifierPrefix=O,this.onUncaughtError=V,this.onCaughtError=K,this.onRecoverableError=pe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ut,this.incompleteTransitions=new Map}function OD(p,v,T,O,V,K,pe,Ue,ut,xt,Ft,It){return p=new Pce(p,v,T,pe,ut,xt,Ft,It,Ue),v=1,K===!0&&(v|=24),K=n(3,null,null,v),p.current=K,K.stateNode=p,v=de(),v.refCount++,p.pooledCache=v,v.refCount++,K.memoizedState={element:O,isDehydrated:T,cache:v},Ha(K),p}function LD(p){return p?(p=Gf,p):Gf}function FD(p){var v=p._reactInternals;if(v===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=o(v),p=p!==null?l(p):null,p===null?null:_m(p.stateNode)}function BD(p,v,T,O,V,K){V=LD(V),O.context===null?O.context=V:O.pendingContext=V,O=Ii(v),O.payload={element:T},K=K===void 0?null:K,K!==null&&(O.callback=K),T=mi(p,O,v),T!==null&&(os(T,p,v),Ur(T,p,v))}function UD(p,v){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<v?T:v}}function KS(p,v){UD(p,v),(p=p.alternate)&&UD(p,v)}var jn={},Dce=Xt,Rs=Axe,ZS=Object.assign,Oce=Symbol.for("react.element"),Ey=Symbol.for("react.transitional.element"),jf=Symbol.for("react.portal"),Hf=Symbol.for("react.fragment"),zD=Symbol.for("react.strict_mode"),JS=Symbol.for("react.profiler"),jD=Symbol.for("react.consumer"),dc=Symbol.for("react.context"),QS=Symbol.for("react.forward_ref"),e4=Symbol.for("react.suspense"),t4=Symbol.for("react.suspense_list"),n4=Symbol.for("react.memo"),hc=Symbol.for("react.lazy"),r4=Symbol.for("react.activity"),Lce=Symbol.for("react.memo_cache_sentinel"),HD=Symbol.iterator,Fce=Symbol.for("react.client.reference"),Ty=Array.isArray,dn=Dce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Bce=e.rendererVersion,Uce=e.rendererPackageName,$D=e.extraDevToolsConfig,_m=e.getPublicInstance,zce=e.getRootHostContext,jce=e.getChildHostContext,Hce=e.prepareForCommit,$ce=e.resetAfterCommit,Vce=e.createInstance;e.cloneMutableInstance;var i4=e.appendInitialChild,VD=e.finalizeInitialChildren,Cy=e.shouldSetTextContent,qD=e.createTextInstance;e.cloneMutableTextInstance;var qce=e.scheduleTimeout,Gce=e.cancelTimeout,Od=e.noTimeout,cu=e.isPrimaryRenderer;e.warnsIfNotActing;var Ca=e.supportsMutation,pl=e.supportsPersistence,Ma=e.supportsHydration,Wce=e.getInstanceFromNode;e.beforeActiveInstanceBlur;var Yce=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var ta=e.setCurrentUpdatePriority,du=e.getCurrentUpdatePriority,Xce=e.resolveUpdatePriority;e.trackSchedulerEvent,e.resolveEventType,e.resolveEventTimeStamp;var Kce=e.shouldAttemptEagerTransition,Zce=e.detachDeletedInstance;e.requestPostPaintCallback;var Jce=e.maySuspendCommit,Qce=e.maySuspendCommitOnUpdate,a4=e.maySuspendCommitInSyncRender,GD=e.preloadInstance,ede=e.startSuspendingCommit,WD=e.suspendInstance;e.suspendOnActiveViewTransition;var tde=e.waitForCommitToBeReady;e.getSuspendedCommitReason;var $f=e.NotPendingTransition,Ld=e.HostTransitionContext,nde=e.resetFormInstance;e.bindToConsole;var rde=e.supportsMicrotasks,ide=e.scheduleMicrotask,wm=e.supportsTestSelectors,ade=e.findFiberRoot,sde=e.getBoundingRect,ode=e.getTextContent,Sm=e.isHiddenSubtree,lde=e.matchAccessibilityRole,ude=e.setFocusIfFocusable,cde=e.setupIntersectionObserver,dde=e.appendChild,hde=e.appendChildToContainer,fde=e.commitTextUpdate,pde=e.commitMount,mde=e.commitUpdate,gde=e.insertBefore,vde=e.insertInContainerBefore,yde=e.removeChild,xde=e.removeChildFromContainer,YD=e.resetTextContent,bde=e.hideInstance,_de=e.hideTextInstance,wde=e.unhideInstance,Sde=e.unhideTextInstance;e.cancelViewTransitionName,e.cancelRootViewTransitionName,e.restoreRootViewTransitionName,e.cloneRootViewTransitionContainer,e.removeRootViewTransitionClone,e.measureClonedInstance,e.hasInstanceChanged,e.hasInstanceAffectedParent,e.startViewTransition,e.startGestureTransition,e.stopViewTransition,e.getCurrentGestureOffset,e.createViewTransitionInstance;var Ede=e.clearContainer;e.createFragmentInstance,e.updateFragmentInstanceFiber,e.commitNewChildToFragmentInstance,e.deleteChildFromFragmentInstance;var Tde=e.cloneInstance,XD=e.createContainerChildSet,KD=e.appendChildToContainerChildSet,Cde=e.finalizeContainerChildren,ZD=e.replaceContainerChildren,JD=e.cloneHiddenInstance,QD=e.cloneHiddenTextInstance,s4=e.isSuspenseInstancePending,o4=e.isSuspenseInstanceFallback,Mde=e.getSuspenseInstanceFallbackErrorDetails,Ade=e.registerSuspenseInstanceRetry,kde=e.canHydrateFormStateMarker,Ide=e.isFormStateMarkerMatching,e9=e.getNextHydratableSibling,Nde=e.getNextHydratableSiblingAfterSingleton,Rde=e.getFirstHydratableChild,Pde=e.getFirstHydratableChildWithinContainer,Dde=e.getFirstHydratableChildWithinActivityInstance,Ode=e.getFirstHydratableChildWithinSuspenseInstance,Lde=e.getFirstHydratableChildWithinSingleton,Fde=e.canHydrateInstance,Bde=e.canHydrateTextInstance,Ude=e.canHydrateActivityInstance,zde=e.canHydrateSuspenseInstance,jde=e.hydrateInstance,Hde=e.hydrateTextInstance,$de=e.hydrateActivityInstance,Vde=e.hydrateSuspenseInstance,qde=e.getNextHydratableInstanceAfterActivityInstance,Gde=e.getNextHydratableInstanceAfterSuspenseInstance,Wde=e.commitHydratedInstance,Yde=e.commitHydratedContainer,Xde=e.commitHydratedActivityInstance,Kde=e.commitHydratedSuspenseInstance,Zde=e.finalizeHydratedChildren,Jde=e.flushHydrationEvents;e.clearActivityBoundary;var Qde=e.clearSuspenseBoundary;e.clearActivityBoundaryFromContainer;var ehe=e.clearSuspenseBoundaryFromContainer,the=e.hideDehydratedBoundary,nhe=e.unhideDehydratedBoundary,t9=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var rhe=e.validateHydratableInstance,ihe=e.validateHydratableTextInstance,Po=e.supportsResources,n9=e.isHostHoistableType,l4=e.getHoistableRoot,r9=e.getResource,i9=e.acquireResource,a9=e.releaseResource,ahe=e.hydrateHoistable,s9=e.mountHoistable,o9=e.unmountHoistable,she=e.createHoistableInstance,ohe=e.prepareToCommitHoistables,lhe=e.mayResourceSuspendCommit,l9=e.preloadResource,uhe=e.suspendResource,Ki=e.supportsSingletons,u9=e.resolveSingletonInstance,che=e.acquireSingletonInstance,c9=e.releaseSingletonInstance,d9=e.isHostSingletonType,Vf=e.isSingletonScope,u4=[],qf=-1,Gf={},Ps=Math.clz32?Math.clz32:x,dhe=Math.log,hhe=Math.LN2,My=256,Ay=262144,ky=4194304,Iy=Rs.unstable_scheduleCallback,c4=Rs.unstable_cancelCallback,fhe=Rs.unstable_shouldYield,phe=Rs.unstable_requestPaint,ls=Rs.unstable_now,h9=Rs.unstable_ImmediatePriority,mhe=Rs.unstable_UserBlockingPriority,d4=Rs.unstable_NormalPriority,ghe=Rs.unstable_IdlePriority,vhe=Rs.log,yhe=Rs.unstable_setDisableYieldValue,Em=null,Ds=null,Os=typeof Object.is=="function"?Object.is:L,f9=typeof reportError=="function"?reportError:function(p){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var v=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof p=="object"&&p!==null&&typeof p.message=="string"?String(p.message):String(p),error:p});if(!window.dispatchEvent(v))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",p);return}console.error(p)},xhe=Object.prototype.hasOwnProperty,h4,p9,f4=!1,m9=new WeakMap,Wf=[],Yf=0,Ny=null,Tm=0,io=[],ao=0,fc=null,ml=1,gl="",fa=h(null),Cm=h(null),pc=h(null),Ry=h(null),pa=null,ii=null,Qn=!1,mc=null,so=!1,p4=Error(i(519)),Py=h(null),Fd=null,hu=null,bhe=typeof AbortController<"u"?AbortController:function(){var p=[],v=this.signal={aborted:!1,addEventListener:function(T,O){p.push(O)}};this.abort=function(){v.aborted=!0,p.forEach(function(T){return T()})}},_he=Rs.unstable_scheduleCallback,whe=Rs.unstable_NormalPriority,ai={$$typeof:dc,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},Dy=null,Xf=null,m4=!1,Oy=!1,g4=!1,Bd=0,Mm=null,v4=0,Kf=0,Zf=null,g9=dn.S;dn.S=function(p,v){_9=ls(),typeof v=="object"&&v!==null&&typeof v.then=="function"&&mt(p,v),g9!==null&&g9(p,v)};var Ud=h(null),Jf=Error(i(460)),y4=Error(i(474)),Ly=Error(i(542)),Fy={then:function(){}},zd=null,Qf=null,Am=0,jd=Yi(!0),v9=Yi(!1),oo=[],ep=0,x4=0,gc=!1,b4=!1,tp=h(null),By=h(0),Ls=h(null),Do=null,bi=h(0),fu=0,An=null,Cr=null,Ri=null,Uy=!1,np=!1,Hd=!1,zy=0,km=0,rp=null,She=0,Im={readContext:le,use:Yr,useCallback:yt,useContext:yt,useEffect:yt,useImperativeHandle:yt,useLayoutEffect:yt,useInsertionEffect:yt,useMemo:yt,useReducer:yt,useRef:yt,useState:yt,useDebugValue:yt,useDeferredValue:yt,useTransition:yt,useSyncExternalStore:yt,useId:yt,useHostTransitionStatus:yt,useFormState:yt,useActionState:yt,useOptimistic:yt,useMemoCache:yt,useCacheRefresh:yt};Im.useEffectEvent=yt;var y9={readContext:le,use:Yr,useCallback:function(p,v){return mn().memoizedState=[p,v===void 0?null:v],p},useContext:le,useEffect:hm,useImperativeHandle:function(p,v,T){T=T!=null?T.concat([p]):null,ac(4194308,4,Df.bind(null,v,p),T)},useLayoutEffect:function(p,v){return ac(4194308,4,p,v)},useInsertionEffect:function(p,v){ac(4,2,p,v)},useMemo:function(p,v){var T=mn();v=v===void 0?null:v;var O=p();if(Hd){F(!0);try{p()}finally{F(!1)}}return T.memoizedState=[O,v],O},useReducer:function(p,v,T){var O=mn();if(T!==void 0){var V=T(v);if(Hd){F(!0);try{T(v)}finally{F(!1)}}}else V=v;return O.memoizedState=O.baseState=V,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:V},O.queue=p,p=p.dispatch=Ea.bind(null,An,p),[O.memoizedState,p]},useRef:function(p){var v=mn();return p={current:p},v.memoizedState=p},useState:function(p){p=tc(p);var v=p.queue,T=ko.bind(null,An,v);return v.dispatch=T,[p.memoizedState,T]},useDebugValue:Of,useDeferredValue:function(p,v){var T=mn();return ca(T,p,v)},useTransition:function(){var p=tc(!1);return p=kd.bind(null,An,p.queue,!0,!1),mn().memoizedState=p,[!1,p]},useSyncExternalStore:function(p,v,T){var O=An,V=mn();if(Qn){if(T===void 0)throw Error(i(407));T=T()}else{if(T=v(),Nr===null)throw Error(i(349));(Gn&127)!==0||xi(O,v,T)}V.memoizedState=T;var K={value:T,getSnapshot:v};return V.queue=K,hm(hl.bind(null,O,K,p),[p]),O.flags|=2048,iu(9,{destroy:void 0},Ni.bind(null,O,K,T,v),null),T},useId:function(){var p=mn(),v=Nr.identifierPrefix;if(Qn){var T=gl,O=ml;T=(O&~(1<<32-Ps(O)-1)).toString(32)+T,v="_"+v+"R_"+T,T=zy++,0<T&&(v+="H"+T.toString(32)),v+="_"}else T=She++,v="_"+v+"r_"+T.toString(32)+"_";return p.memoizedState=v},useHostTransitionStatus:Ff,useFormState:Cd,useActionState:Cd,useOptimistic:function(p){var v=mn();v.memoizedState=v.baseState=p;var T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return v.queue=T,v=_S.bind(null,An,!0,T),T.dispatch=v,[p,v]},useMemoCache:ua,useCacheRefresh:function(){return mn().memoizedState=Is.bind(null,An)},useEffectEvent:function(p){var v=mn(),T={impl:p};return v.memoizedState=T,function(){if((Hn&2)!==0)throw Error(i(440));return T.impl.apply(void 0,arguments)}}},_4={readContext:le,use:Yr,useCallback:oc,useContext:le,useEffect:au,useImperativeHandle:sc,useInsertionEffect:fm,useLayoutEffect:Pf,useMemo:Lf,useReducer:wa,useRef:dm,useState:function(){return wa(pr)},useDebugValue:Of,useDeferredValue:function(p,v){var T=Dt();return uy(T,Cr.memoizedState,p,v)},useTransition:function(){var p=wa(pr)[0],v=Dt().memoizedState;return[typeof p=="boolean"?p:cn(p),v]},useSyncExternalStore:Xi,useId:cy,useHostTransitionStatus:Ff,useFormState:Nf,useActionState:Nf,useOptimistic:function(p,v){var T=Dt();return ru(T,Cr,p,v)},useMemoCache:ua,useCacheRefresh:da};_4.useEffectEvent=Ao;var x9={readContext:le,use:Yr,useCallback:oc,useContext:le,useEffect:au,useImperativeHandle:sc,useInsertionEffect:fm,useLayoutEffect:Pf,useMemo:Lf,useReducer:ri,useRef:dm,useState:function(){return ri(pr)},useDebugValue:Of,useDeferredValue:function(p,v){var T=Dt();return Cr===null?ca(T,p,v):uy(T,Cr.memoizedState,p,v)},useTransition:function(){var p=ri(pr)[0],v=Dt().memoizedState;return[typeof p=="boolean"?p:cn(p),v]},useSyncExternalStore:Xi,useId:cy,useHostTransitionStatus:Ff,useFormState:Rf,useActionState:Rf,useOptimistic:function(p,v){var T=Dt();return Cr!==null?ru(T,Cr,p,v):(T.baseState=p,[p,T.queue.dispatch])},useMemoCache:ua,useCacheRefresh:da};x9.useEffectEvent=Ao;var w4={enqueueSetState:function(p,v,T){p=p._reactInternals;var O=Ns(),V=Ii(O);V.payload=v,T!=null&&(V.callback=T),v=mi(p,V,O),v!==null&&(os(v,p,O),Ur(v,p,O))},enqueueReplaceState:function(p,v,T){p=p._reactInternals;var O=Ns(),V=Ii(O);V.tag=1,V.payload=v,T!=null&&(V.callback=T),v=mi(p,V,O),v!==null&&(os(v,p,O),Ur(v,p,O))},enqueueForceUpdate:function(p,v){p=p._reactInternals;var T=Ns(),O=Ii(T);O.tag=2,v!=null&&(O.callback=v),v=mi(p,O,T),v!==null&&(os(v,p,T),Ur(v,p,T))}},S4=Error(i(461)),Pi=!1,E4={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},pu=!1,Di=!1,T4=!1,b9=typeof WeakSet=="function"?WeakSet:Set,na=null,Oi=null,us=!1,Oo=null,ip=8192,Ehe={getCacheForType:function(p){var v=le(ai),T=v.data.get(p);return T===void 0&&(T=p(),v.data.set(p,T)),T},cacheSignal:function(){return le(ai).controller.signal}},jy=0,Hy=1,$y=2,Vy=3,qy=4;if(typeof Symbol=="function"&&Symbol.for){var Nm=Symbol.for;jy=Nm("selector.component"),Hy=Nm("selector.has_pseudo_class"),$y=Nm("selector.role"),Vy=Nm("selector.test_id"),qy=Nm("selector.text")}var The=typeof WeakMap=="function"?WeakMap:Map,Hn=0,Nr=null,$n=null,Gn=0,br=0,Fs=null,vc=!1,ap=!1,C4=!1,mu=0,gi=0,yc=0,$d=0,M4=0,Bs=0,sp=0,Rm=null,cs=null,A4=!1,Gy=0,_9=0,Pm=1/0,Wy=null,xc=null,Zi=0,bc=null,op=null,gu=0,k4=0,I4=null,w9=null,Dm=0,N4=null;return jn.attemptContinuousHydration=function(p){if(p.tag===13||p.tag===31){var v=fr(p,67108864);v!==null&&os(v,p,67108864),KS(p,67108864)}},jn.attemptHydrationAtCurrentPriority=function(p){if(p.tag===13||p.tag===31){var v=Ns();v=N(v);var T=fr(p,v);T!==null&&os(T,p,v),KS(p,v)}},jn.attemptSynchronousHydration=function(p){switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var v=b(p.pendingLanes);if(v!==0){for(p.pendingLanes|=2,p.entangledLanes|=2;v;){var T=1<<31-Ps(v);p.entanglements[1]|=T,v&=~T}Be(p),(Hn&6)===0&&(Pm=ls()+500,He(0))}}break;case 31:case 13:v=fr(p,2),v!==null&&os(v,p,2),vD(),KS(p,2)}},jn.batchedUpdates=function(p,v){return p(v)},jn.createComponentSelector=function(p){return{$$typeof:jy,value:p}},jn.createContainer=function(p,v,T,O,V,K,pe,Ue,ut,xt){return OD(p,v,!1,null,T,O,K,null,pe,Ue,ut,xt)},jn.createHasPseudoClassSelector=function(p){return{$$typeof:Hy,value:p}},jn.createHydrationContainer=function(p,v,T,O,V,K,pe,Ue,ut,xt,Ft,It,Yt,Tn){var Li;return p=OD(T,O,!0,p,V,K,Ue,Tn,ut,xt,Ft,It),p.context=LD(null),T=p.current,O=Ns(),O=N(O),V=Ii(O),V.callback=(Li=v)!=null?Li:null,mi(T,V,O),v=O,p.current.lanes=v,E(p,v),Be(p),p},jn.createPortal=function(p,v,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jf,key:O==null?null:""+O,children:p,containerInfo:v,implementation:T}},jn.createRoleSelector=function(p){return{$$typeof:$y,value:p}},jn.createTestNameSelector=function(p){return{$$typeof:Vy,value:p}},jn.createTextSelector=function(p){return{$$typeof:qy,value:p}},jn.defaultOnCaughtError=function(p){console.error(p)},jn.defaultOnRecoverableError=function(p){f9(p)},jn.defaultOnUncaughtError=function(p){f9(p)},jn.deferredUpdates=function(p){var v=dn.T,T=du();try{return ta(32),dn.T=null,p()}finally{ta(T),dn.T=v}},jn.discreteUpdates=function(p,v,T,O,V){var K=dn.T,pe=du();try{return ta(2),dn.T=null,p(v,T,O,V)}finally{ta(pe),dn.T=K,Hn===0&&(Pm=ls()+500)}},jn.findAllNodes=$S,jn.findBoundingRects=function(p,v){if(!wm)throw Error(i(363));v=$S(p,v),p=[];for(var T=0;T<v.length;T++)p.push(sde(v[T]));for(v=p.length-1;0<v;v--){T=p[v];for(var O=T.x,V=O+T.width,K=T.y,pe=K+T.height,Ue=v-1;0<=Ue;Ue--)if(v!==Ue){var ut=p[Ue],xt=ut.x,Ft=xt+ut.width,It=ut.y,Yt=It+ut.height;if(O>=xt&&K>=It&&V<=Ft&&pe<=Yt){p.splice(v,1);break}else if(O!==xt||T.width!==ut.width||Yt<K||It>pe){if(!(K!==It||T.height!==ut.height||Ft<O||xt>V)){xt>O&&(ut.width+=xt-O,ut.x=O),Ft<V&&(ut.width=V-xt),p.splice(v,1);break}}else{It>K&&(ut.height+=It-K,ut.y=K),Yt<pe&&(ut.height=pe-It),p.splice(v,1);break}}}return p},jn.findHostInstance=FD,jn.findHostInstanceWithNoPortals=function(p){return p=o(p),p=p!==null?u(p):null,p===null?null:_m(p.stateNode)},jn.findHostInstanceWithWarning=function(p){return FD(p)},jn.flushPassiveEffects=bm,jn.flushSyncFromReconciler=function(p){var v=Hn;Hn|=1;var T=dn.T,O=du();try{if(ta(2),dn.T=null,p)return p()}finally{ta(O),dn.T=T,Hn=v,(Hn&6)===0&&He(0)}},jn.flushSyncWork=vD,jn.focusWithin=function(p,v){if(!wm)throw Error(i(363));for(p=zS(p),v=fD(p,v),v=Array.from(v),p=0;p<v.length;){var T=v[p++],O=T.tag;if(!Sm(T)){if((O===5||O===26||O===27)&&ude(T.stateNode))return!0;for(T=T.child;T!==null;)v.push(T),T=T.sibling}}return!1},jn.getFindAllNodesFailureDescription=function(p,v){if(!wm)throw Error(i(363));var T=0,O=[];p=[zS(p),0];for(var V=0;V<p.length;){var K=p[V++],pe=K.tag,Ue=p[V++],ut=v[Ue];if((pe!==5&&pe!==26&&pe!==27||!Sm(K))&&(jS(K,ut)&&(O.push(HS(ut)),Ue++,Ue>T&&(T=Ue)),Ue<v.length))for(K=K.child;K!==null;)p.push(K,Ue),K=K.sibling}if(T<v.length){for(p=[];T<v.length;T++)p.push(HS(v[T]));return`findAllNodes was able to match part of the selector:
  `+(O.join(" > ")+`

No matching component was found for:
  `)+p.join(" > ")}return null},jn.getPublicRootInstance=function(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 27:case 5:return _m(p.child.stateNode);default:return p.child.stateNode}},jn.injectIntoDevTools=function(){var p={bundleType:0,version:Bce,rendererPackageName:Uce,currentDispatcherRef:dn,reconcilerVersion:"19.2.0"};if($D!==null&&(p.rendererConfig=$D),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")p=!1;else{var v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(v.isDisabled||!v.supportsFiber)p=!0;else{try{Em=v.inject(p),Ds=v}catch{}p=!!v.checkDCE}}return p},jn.isAlreadyRendering=function(){return(Hn&6)!==0},jn.observeVisibleRects=function(p,v,T,O){if(!wm)throw Error(i(363));p=$S(p,v);var V=cde(p,T,O).disconnect;return{disconnect:function(){V()}}},jn.shouldError=function(){return null},jn.shouldSuspend=function(){return!1},jn.startHostTransition=function(p,v,T,O){if(p.tag!==5)throw Error(i(476));var V=Id(p).queue;kd(p,V,v,$f,T===null?r:function(){var K=Id(p);return K.next===null&&(K=p.alternate.memoizedState),lc(p,K.next.queue,{},Ns()),T(O)})},jn.updateContainer=function(p,v,T,O){var V=v.current,K=Ns();return BD(V,K,p,v,T,O),K},jn.updateContainerSync=function(p,v,T,O){return BD(v.current,2,p,v,T,O),2},jn},t.exports.default=t.exports,Object.defineProperty(t.exports,"__esModule",{value:!0})})(cL)),cL.exports}var hL;function ebe(){return hL||(hL=1,uL.exports=Qxe()),uL.exports}var tbe=ebe();const nbe=Jxe(tbe);function rbe(t){const e=nbe(t);return e.injectIntoDevTools(),e}const SZ=0,g0={},ibe=/^three(?=[A-Z])/,Z2=t=>`${t[0].toUpperCase()}${t.slice(1)}`;let abe=0;const sbe=t=>typeof t=="function";function obe(t){if(sbe(t)){const e=`${abe++}`;return g0[e]=t,e}else Object.assign(g0,t)}function EZ(t,e){const n=Z2(t),r=g0[n];if(t!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(t==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function lbe(t,e,n){var r;return t=Z2(t)in g0?t:t.replace(ibe,""),EZ(t,e),t==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,nw(e.object,n,t,e)}function ube(t){if(!t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?iw(t.parent,t):gs(t.object)&&(t.object.visible=!1),t.isHidden=!0,H0(t)}}function TZ(t){if(t.isHidden){var e;t.props.attach&&(e=t.parent)!=null&&e.object?rw(t.parent,t):gs(t.object)&&t.props.visible!==!1&&(t.object.visible=!0),t.isHidden=!1,H0(t)}}function R8(t,e,n){const r=e.root.getState();if(!(!t.parent&&t.object!==r.scene)){if(!e.object){var i,a;const s=g0[Z2(e.type)];e.object=(i=e.props.object)!=null?i:new s(...(a=e.props.args)!=null?a:[]),e.object.__r3f=e}if(jc(e.object,e.props),e.props.attach)rw(t,e);else if(gs(e.object)&&gs(t.object)){const s=t.object.children.indexOf(n?.object);if(n&&s!==-1){const o=t.object.children.indexOf(e.object);if(o!==-1){t.object.children.splice(o,1);const l=o<s?s-1:s;t.object.children.splice(l,0,e.object)}else e.object.parent=t.object,t.object.children.splice(s,0,e.object),e.object.dispatchEvent({type:"added"}),t.object.dispatchEvent({type:"childadded",child:e.object})}else t.object.add(e.object)}for(const s of e.children)R8(e,s);H0(e)}}function TE(t,e){e&&(e.parent=t,t.children.push(e),R8(t,e))}function fL(t,e,n){if(!e||!n)return;e.parent=t;const r=t.children.indexOf(n);r!==-1?t.children.splice(r,0,e):t.children.push(e),R8(t,e,n)}function CZ(t){if(typeof t.dispose=="function"){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():J6.unstable_scheduleCallback(J6.unstable_IdlePriority,e)}}function eI(t,e,n){if(!e)return;e.parent=null;const r=t.children.indexOf(e);r!==-1&&t.children.splice(r,1),e.props.attach?iw(t,e):gs(e.object)&&gs(t.object)&&(t.object.remove(e.object),Vxe(vZ(e),e.object));const i=e.props.dispose!==null&&n!==!1;for(let a=e.children.length-1;a>=0;a--){const s=e.children[a];eI(e,s,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&CZ(e.object),n===void 0&&H0(e)}function cbe(t,e){for(const n of[t,t.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(e);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=e)}const zb=[];function dbe(){for(const[n]of zb){const r=n.parent;if(r){n.props.attach?iw(r,n):gs(n.object)&&gs(r.object)&&r.object.remove(n.object);for(const i of n.children)i.props.attach?iw(n,i):gs(i.object)&&gs(n.object)&&n.object.remove(i.object)}n.isHidden&&TZ(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&CZ(n.object)}for(const[n,r,i]of zb){n.props=r;const a=n.parent;if(a){var t,e;const s=g0[Z2(n.type)];n.object=(t=n.props.object)!=null?t:new s(...(e=n.props.args)!=null?e:[]),n.object.__r3f=n,cbe(i,n.object),jc(n.object,n.props),n.props.attach?rw(a,n):gs(n.object)&&gs(a.object)&&a.object.add(n.object);for(const o of n.children)o.props.attach?rw(n,o):gs(o.object)&&gs(n.object)&&n.object.add(o.object);H0(n)}}zb.length=0}const CE=()=>{},pL={};let jx=SZ;const hbe=0,fbe=4,aw=rbe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:lbe,removeChild:eI,appendChild:TE,appendInitialChild:TE,insertBefore:fL,appendChildToContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||TE(n,e)},removeChildFromContainer(t,e){const n=t.getState().scene.__r3f;!e||!n||eI(n,e)},insertInContainerBefore(t,e,n){const r=t.getState().scene.__r3f;!e||!n||!r||fL(r,e,n)},getRootHostContext:()=>pL,getChildHostContext:()=>pL,commitUpdate(t,e,n,r,i){var a,s,o;EZ(e,r);let l=!1;if((t.type==="primitive"&&n.object!==r.object||((a=r.args)==null?void 0:a.length)!==((s=n.args)==null?void 0:s.length)||(o=r.args)!=null&&o.some((c,d)=>{var h;return c!==((h=n.args)==null?void 0:h[d])}))&&(l=!0),l)zb.push([t,{...r},i]);else{const c=jxe(t,r);Object.keys(c).length&&(Object.assign(t.props,c),jc(t.object,c))}(i.sibling===null||(i.flags&fbe)===hbe)&&dbe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:t=>t?.object,prepareForCommit:()=>null,preparePortalMount:t=>nw(t.getState().scene,t,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:ube,unhideInstance:TZ,createTextInstance:CE,hideTextInstance:CE,unhideTextInstance:CE,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:P.createContext(null),setCurrentUpdatePriority(t){jx=t},getCurrentUpdatePriority(){return jx},resolveUpdatePriority(){var t;if(jx!==SZ)return jx;switch(typeof window<"u"&&((t=window.event)==null?void 0:t.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Kxe;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Yxe;default:return Xxe}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:Zxe.version,applyViewTransitionName(t,e,n){},restoreViewTransitionName(t,e){},cancelViewTransitionName(t,e,n){},cancelRootViewTransitionName(t){},restoreRootViewTransitionName(t){},InstanceMeasurement:null,measureInstance:t=>null,wasInstanceInViewport:t=>!0,hasInstanceChanged:(t,e)=>!1,hasInstanceAffectedParent:(t,e)=>!1,suspendOnActiveViewTransition(t,e){},startGestureTransition:()=>null,startViewTransition:()=>null,stopViewTransition(t){},createViewTransitionInstance:t=>null,getCurrentGestureOffset(t){throw new Error("startGestureTransition is not yet supported in react-three-fiber.")},cloneMutableInstance(t,e){return t},cloneMutableTextInstance(t){return t},cloneRootViewTransitionContainer(t){throw new Error("Not implemented.")},removeRootViewTransitionClone(t,e){throw new Error("Not implemented.")},createFragmentInstance:t=>null,updateFragmentInstanceFiber(t,e){},commitNewChildToFragmentInstance(t,e){},deleteChildFromFragmentInstance(t,e){},measureClonedInstance:t=>null,maySuspendCommitOnUpdate:(t,e,n)=>!1,maySuspendCommitInSyncRender:(t,e)=>!1,startSuspendingCommit:()=>null,getSuspendedCommitReason:(t,e)=>null}),Qh=new Map,Np={objects:"shallow",strict:!1};function pbe(t,e){if(!e&&typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:n,height:r,top:i,left:a}=t.parentElement.getBoundingClientRect();return{width:n,height:r,top:i,left:a}}else if(!e&&typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function mbe(t){const e=Qh.get(t),n=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,a=r||Gxe(rI,gL),s=n||aw.createContainer(a,Wxe,null,!1,null,"",i,i,i,null);e||Qh.set(t,{fiber:s,store:a});let o,l,u=!1,c=null;return{async configure(d={}){let h;c=new Promise(W=>h=W);let{gl:f,size:m,scene:x,events:b,onCreated:y,shadows:w=!1,linear:_=!1,flat:S=!1,legacy:M=!1,orthographic:E=!1,frameloop:C="always",dpr:R=[1,2],performance:k,raycaster:I,camera:N,onPointerMissed:D}=d,F=a.getState(),L=F.gl;if(!F.gl){const W={canvas:t,powerPreference:"high-performance",antialias:!0,alpha:!0},X=typeof f=="function"?await f(W):f;lL(X)?L=X:L=new dZ({...W,...f}),F.set({gl:L})}let U=F.raycaster;U||F.set({raycaster:U=new T8});const{params:j,...q}=I||{};if(ui.equ(q,U,Np)||jc(U,{...q}),ui.equ(j,U.params,Np)||jc(U,{params:{...U.params,...j}}),!F.camera||F.camera===l&&!ui.equ(l,N,Np)){l=N;const W=N?.isCamera,X=W?N:E?new Ou(0,0,0,0,.1,1e3):new Si(75,0,.1,1e3);W||(X.position.z=5,N&&(jc(X,N),X.manual||("aspect"in N||"left"in N||"right"in N||"bottom"in N||"top"in N)&&(X.manual=!0,X.updateProjectionMatrix())),!F.camera&&!(N!=null&&N.rotation)&&X.lookAt(0,0,0)),F.set({camera:X}),U.camera=X}if(!F.scene){let W;x!=null&&x.isScene?(W=x,nw(W,a,"",{})):(W=new t8,nw(W,a,"",{}),x&&jc(W,x)),F.set({scene:W})}b&&!F.events.handlers&&F.set({events:b(a)});const Z=pbe(t,m);if(ui.equ(Z,F.size,Np)||F.setSize(Z.width,Z.height,Z.top,Z.left),R&&F.viewport.dpr!==xZ(R)&&F.setDpr(R),F.frameloop!==C&&F.setFrameloop(C),F.onPointerMissed||F.set({onPointerMissed:D}),k&&!ui.equ(k,F.performance,Np)&&F.set(W=>({performance:{...W.performance,...k}})),!F.xr){var Q;const W=(J,te)=>{const ee=a.getState();ee.frameloop!=="never"&&gL(J,!0,ee,te)},X=()=>{const J=a.getState();J.gl.xr.enabled=J.gl.xr.isPresenting,J.gl.xr.setAnimationLoop(J.gl.xr.isPresenting?W:null),J.gl.xr.isPresenting||rI(J)},H={connect(){const J=a.getState().gl;J.xr.addEventListener("sessionstart",X),J.xr.addEventListener("sessionend",X)},disconnect(){const J=a.getState().gl;J.xr.removeEventListener("sessionstart",X),J.xr.removeEventListener("sessionend",X)}};typeof((Q=L.xr)==null?void 0:Q.addEventListener)=="function"&&H.connect(),F.set({xr:H})}if(L.shadowMap){const W=L.shadowMap.enabled,X=L.shadowMap.type;if(L.shadowMap.enabled=!!w,ui.boo(w))L.shadowMap.type=Ig;else if(ui.str(w)){var z;const H={basic:TX,percentage:Zp,soft:Ig,variance:wh};L.shadowMap.type=(z=H[w])!=null?z:Ig}else ui.obj(w)&&Object.assign(L.shadowMap,w);(W!==L.shadowMap.enabled||X!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}return Yn.enabled=!M,u||(L.outputColorSpace=_?ed:Na,L.toneMapping=S?vo:d2),F.legacy!==M&&F.set(()=>({legacy:M})),F.linear!==_&&F.set(()=>({linear:_})),F.flat!==S&&F.set(()=>({flat:S})),f&&!ui.fun(f)&&!lL(f)&&!ui.equ(f,L,Np)&&jc(L,f),o=y,u=!0,h(),this},render(d){return!u&&!c&&this.configure(),c.then(()=>{aw.updateContainer(g.jsx(gbe,{store:a,children:d,onCreated:o,rootElement:t}),s,null,()=>{})}),a},unmount(){MZ(t)}}}function gbe({store:t,children:e,onCreated:n,rootElement:r}){return Ev(()=>{const i=t.getState();i.set(a=>({internal:{...a.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),g.jsx(I8.Provider,{value:t,children:e})}function MZ(t,e){const n=Qh.get(t),r=n?.fiber;if(r){const i=n?.store.getState();i&&(i.internal.active=!1),aw.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var a,s,o,l;i.events.disconnect==null||i.events.disconnect(),(a=i.gl)==null||(s=a.renderLists)==null||s.dispose==null||s.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=i.gl)!=null&&l.xr&&i.xr.disconnect(),Bxe(i.scene),Qh.delete(t)}catch{}},500)})}}function vbe(t,e,n){return g.jsx(ybe,{children:t,container:e,state:n})}function ybe({state:t={},children:e,container:n}){const{events:r,size:i,...a}=t,s=N8(),[o]=P.useState(()=>new T8),[l]=P.useState(()=>new dt),u=k8((d,h)=>{let f;if(h.camera&&i){const m=h.camera;f=d.viewport.getCurrentViewport(m,new we,i),m!==d.camera&&_Z(m,i)}return{...d,...h,scene:n,raycaster:o,pointer:l,mouse:l,previousRoot:s,events:{...d.events,...h.events,...r},size:{...d.size,...i},viewport:{...d.viewport,...f},setEvents:m=>h.set(x=>({...x,events:{...x.events,...m}}))}}),c=P.useMemo(()=>{const d=fZ((f,m)=>({...a,set:f,get:m})),h=f=>d.setState(m=>u.current(f,m));return h(s.getState()),s.subscribe(h),d},[s,n]);return g.jsx(g.Fragment,{children:aw.createPortal(g.jsx(I8.Provider,{value:c,children:e}),c,null)})}const xbe=new Set,bbe=new Set,_be=new Set;function ME(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function Ug(t,e){switch(t){case"before":return ME(xbe,e);case"after":return ME(bbe,e);case"tail":return ME(_be,e)}}let AE,kE;function tI(t,e,n){let r=e.clock.getDelta();e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),AE=e.internal.subscribers;for(let i=0;i<AE.length;i++)kE=AE[i],kE.ref.current(kE.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let sw=!1,nI=!1,IE,mL,Rp;function AZ(t){mL=requestAnimationFrame(AZ),sw=!0,IE=0,Ug("before",t),nI=!0;for(const n of Qh.values()){var e;Rp=n.store.getState(),Rp.internal.active&&(Rp.frameloop==="always"||Rp.internal.frames>0)&&!((e=Rp.gl.xr)!=null&&e.isPresenting)&&(IE+=tI(t,Rp))}if(nI=!1,Ug("after",t),IE===0)return Ug("tail",t),sw=!1,cancelAnimationFrame(mL)}function rI(t,e=1){var n;if(!t)return Qh.forEach(r=>rI(r.store.getState(),e));(n=t.gl.xr)!=null&&n.isPresenting||!t.internal.active||t.frameloop==="never"||(e>1?t.internal.frames=Math.min(60,t.internal.frames+e):nI?t.internal.frames=2:t.internal.frames=1,sw||(sw=!0,requestAnimationFrame(AZ)))}function gL(t,e=!0,n,r){if(e&&Ug("before",t),n)tI(t,n,r);else for(const i of Qh.values())tI(t,i.store.getState());e&&Ug("after",t)}const NE={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function wbe(t){const{handlePointer:e}=qxe(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(NE).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{const{set:r,events:i}=t.getState();if(i.disconnect==null||i.disconnect(),r(a=>({events:{...a.events,connected:n}})),i.handlers)for(const a in i.handlers){const s=i.handlers[a],[o,l]=NE[a];n.addEventListener(o,s,{passive:l})}},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const a=r.handlers[i],[s]=NE[i];r.connected.removeEventListener(s,a)}n(i=>({events:{...i.events,connected:void 0}}))}}}}function vL(t,e){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function Sbe({debounce:t,scroll:e,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,s]=P.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=P.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a,orientationHandler:null}),l=t?typeof t=="number"?t:t.scroll:null,u=t?typeof t=="number"?t:t.resize:null,c=P.useRef(!1);P.useEffect(()=>(c.current=!0,()=>void(c.current=!1)));const[d,h,f]=P.useMemo(()=>{const y=()=>{if(!o.current.element)return;const{left:w,top:_,width:S,height:M,bottom:E,right:C,x:R,y:k}=o.current.element.getBoundingClientRect(),I={left:w,top:_,width:S,height:M,bottom:E,right:C,x:R,y:k};o.current.element instanceof HTMLElement&&r&&(I.height=o.current.element.offsetHeight,I.width=o.current.element.offsetWidth),Object.freeze(I),c.current&&!Mbe(o.current.lastBounds,I)&&s(o.current.lastBounds=I)};return[y,u?vL(y,u):y,l?vL(y,l):y]},[s,r,l,u]);function m(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(y=>y.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function x(){o.current.element&&(o.current.resizeObserver=new i(f),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(y=>y.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const b=y=>{!y||y===o.current.element||(m(),o.current.element=y,o.current.scrollContainers=kZ(y),x())};return Tbe(f,!!e),Ebe(h),P.useEffect(()=>{m(),x()},[e,f,h]),P.useEffect(()=>m,[]),[b,a,d]}function Ebe(t){P.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function Tbe(t,e){P.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function kZ(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(a=>a==="auto"||a==="scroll")&&e.push(t),[...e,...kZ(t.parentElement)]}const Cbe=["x","y","top","bottom","left","right","width","height"],Mbe=(t,e)=>Cbe.every(n=>t[n]===e[n]);function Abe({ref:t,children:e,fallback:n,resize:r,style:i,gl:a,events:s=wbe,eventSource:o,eventPrefix:l,shadows:u,linear:c,flat:d,legacy:h,orthographic:f,frameloop:m,dpr:x,performance:b,raycaster:y,camera:w,scene:_,onPointerMissed:S,onCreated:M,...E}){P.useMemo(()=>obe(pxe),[]);const C=Oxe(),[R,k]=Sbe({scroll:!0,debounce:{scroll:50,resize:0},...r}),I=P.useRef(null),N=P.useRef(null);P.useImperativeHandle(t,()=>I.current);const D=k8(S),[F,L]=P.useState(!1),[U,j]=P.useState(!1);if(F)throw F;if(U)throw U;const q=P.useRef(null);Ev(()=>{const Q=I.current;if(k.width>0&&k.height>0&&Q){q.current||(q.current=mbe(Q));async function z(){await q.current.configure({gl:a,scene:_,events:s,shadows:u,linear:c,flat:d,legacy:h,orthographic:f,frameloop:m,dpr:x,performance:b,raycaster:y,camera:w,size:k,onPointerMissed:(...W)=>D.current==null?void 0:D.current(...W),onCreated:W=>{W.events.connect==null||W.events.connect(o?Pxe(o)?o.current:o:N.current),l&&W.setEvents({compute:(X,H)=>{const J=X[l+"X"],te=X[l+"Y"];H.pointer.set(J/H.size.width*2-1,-(te/H.size.height)*2+1),H.raycaster.setFromCamera(H.pointer,H.camera)}}),M?.(W)}}),q.current.render(g.jsx(C,{children:g.jsx(Fxe,{set:j,children:g.jsx(P.Suspense,{fallback:g.jsx(Lxe,{set:L}),children:e??null})})}))}z()}}),P.useEffect(()=>{const Q=I.current;if(Q)return()=>MZ(Q)},[]);const Z=o?"none":"auto";return g.jsx("div",{ref:N,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Z,...i},...E,children:g.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:g.jsx("canvas",{ref:I,style:{display:"block"},children:n})})})}function kbe(t){return g.jsx(mZ,{children:g.jsx(Abe,{...t})})}function rd(){return rd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rd.apply(null,arguments)}const IZ=parseInt(B0.replace(/\D+/g,"")),NZ=IZ>=125?"uv1":"uv2";var Ibe=Object.defineProperty,Nbe=(t,e,n)=>e in t?Ibe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rbe=(t,e,n)=>(Nbe(t,e+"",n),n);class Pbe{constructor(){Rbe(this,"_listeners")}addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const a=i.indexOf(n);a!==-1&&i.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let a=0,s=i.length;a<s;a++)i[a].call(this,e);e.target=null}}}var Dbe=Object.defineProperty,Obe=(t,e,n)=>e in t?Dbe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,on=(t,e,n)=>(Obe(t,typeof e!="symbol"?e+"":e,n),n);const Hx=new ff,yL=new Tu,Lbe=Math.cos(70*(Math.PI/180)),xL=(t,e)=>(t%e+e)%e;let Fbe=class extends Pbe{constructor(e,n){super(),on(this,"object"),on(this,"domElement"),on(this,"enabled",!0),on(this,"target",new we),on(this,"minDistance",0),on(this,"maxDistance",1/0),on(this,"minZoom",0),on(this,"maxZoom",1/0),on(this,"minPolarAngle",0),on(this,"maxPolarAngle",Math.PI),on(this,"minAzimuthAngle",-1/0),on(this,"maxAzimuthAngle",1/0),on(this,"enableDamping",!1),on(this,"dampingFactor",.05),on(this,"enableZoom",!0),on(this,"zoomSpeed",1),on(this,"enableRotate",!0),on(this,"rotateSpeed",1),on(this,"enablePan",!0),on(this,"panSpeed",1),on(this,"screenSpacePanning",!0),on(this,"keyPanSpeed",7),on(this,"zoomToCursor",!1),on(this,"autoRotate",!1),on(this,"autoRotateSpeed",2),on(this,"reverseOrbit",!1),on(this,"reverseHorizontalOrbit",!1),on(this,"reverseVerticalOrbit",!1),on(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),on(this,"mouseButtons",{LEFT:hh.ROTATE,MIDDLE:hh.DOLLY,RIGHT:hh.PAN}),on(this,"touches",{ONE:fh.ROTATE,TWO:fh.DOLLY_PAN}),on(this,"target0"),on(this,"position0"),on(this,"zoom0"),on(this,"_domElementKeyEvents",null),on(this,"getPolarAngle"),on(this,"getAzimuthalAngle"),on(this,"setPolarAngle"),on(this,"setAzimuthalAngle"),on(this,"getDistance"),on(this,"getZoomScale"),on(this,"listenToKeyEvents"),on(this,"stopListenToKeyEvents"),on(this,"saveState"),on(this,"reset"),on(this,"update"),on(this,"connect"),on(this,"dispose"),on(this,"dollyIn"),on(this,"dollyOut"),on(this,"getScale"),on(this,"setScale"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=Ee=>{let je=xL(Ee,2*Math.PI),mt=c.phi;mt<0&&(mt+=2*Math.PI),je<0&&(je+=2*Math.PI);let fe=Math.abs(je-mt);2*Math.PI-fe<fe&&(je<mt?je+=2*Math.PI:mt+=2*Math.PI),d.phi=je-mt,r.update()},this.setAzimuthalAngle=Ee=>{let je=xL(Ee,2*Math.PI),mt=c.theta;mt<0&&(mt+=2*Math.PI),je<0&&(je+=2*Math.PI);let fe=Math.abs(je-mt);2*Math.PI-fe<fe&&(je<mt?je+=2*Math.PI:mt+=2*Math.PI),d.theta=je-mt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=Ee=>{Ee.addEventListener("keydown",_e),this._domElementKeyEvents=Ee},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",_e),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),l=o.NONE},this.update=(()=>{const Ee=new we,je=new we(0,1,0),mt=new xa().setFromUnitVectors(e.up,je),fe=mt.clone().invert(),$e=new we,Ge=new xa,st=2*Math.PI;return function(){const Ye=r.object.position;mt.setFromUnitVectors(e.up,je),fe.copy(mt).invert(),Ee.copy(Ye).sub(r.target),Ee.applyQuaternion(mt),c.setFromVector3(Ee),r.autoRotate&&l===o.NONE&&L(D()),r.enableDamping?(c.theta+=d.theta*r.dampingFactor,c.phi+=d.phi*r.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi);let ft=r.minAzimuthAngle,Ct=r.maxAzimuthAngle;isFinite(ft)&&isFinite(Ct)&&(ft<-Math.PI?ft+=st:ft>Math.PI&&(ft-=st),Ct<-Math.PI?Ct+=st:Ct>Math.PI&&(Ct-=st),ft<=Ct?c.theta=Math.max(ft,Math.min(Ct,c.theta)):c.theta=c.theta>(ft+Ct)/2?Math.max(ft,c.theta):Math.min(Ct,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),r.zoomToCursor&&k||r.object.isOrthographicCamera?c.radius=H(c.radius):c.radius=H(c.radius*h),Ee.setFromSpherical(c),Ee.applyQuaternion(fe),Ye.copy(r.target).add(Ee),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(d.theta*=1-r.dampingFactor,d.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(d.set(0,0,0),f.set(0,0,0));let At=!1;if(r.zoomToCursor&&k){let Ht=null;if(r.object instanceof Si&&r.object.isPerspectiveCamera){const wn=Ee.length();Ht=H(wn*h);const Vt=wn-Ht;r.object.position.addScaledVector(C,Vt),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const wn=new we(R.x,R.y,0);wn.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix(),At=!0;const Vt=new we(R.x,R.y,0);Vt.unproject(r.object),r.object.position.sub(Vt).add(wn),r.object.updateMatrixWorld(),Ht=Ee.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Ht!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Ht).add(r.object.position):(Hx.origin.copy(r.object.position),Hx.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Hx.direction))<Lbe?e.lookAt(r.target):(yL.setFromNormalAndCoplanarPoint(r.object.up,r.target),Hx.intersectPlane(yL,r.target))))}else r.object instanceof Ou&&r.object.isOrthographicCamera&&(At=h!==1,At&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix()));return h=1,k=!1,At||$e.distanceToSquared(r.object.position)>u||8*(1-Ge.dot(r.object.quaternion))>u?(r.dispatchEvent(i),$e.copy(r.object.position),Ge.copy(r.object.quaternion),At=!1,!0):!1}})(),this.connect=Ee=>{r.domElement=Ee,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",pt),r.domElement.addEventListener("pointerdown",ze),r.domElement.addEventListener("pointercancel",re),r.domElement.addEventListener("wheel",ve)},this.dispose=()=>{var Ee,je,mt,fe,$e,Ge;r.domElement&&(r.domElement.style.touchAction="auto"),(Ee=r.domElement)==null||Ee.removeEventListener("contextmenu",pt),(je=r.domElement)==null||je.removeEventListener("pointerdown",ze),(mt=r.domElement)==null||mt.removeEventListener("pointercancel",re),(fe=r.domElement)==null||fe.removeEventListener("wheel",ve),($e=r.domElement)==null||$e.ownerDocument.removeEventListener("pointermove",le),(Ge=r.domElement)==null||Ge.ownerDocument.removeEventListener("pointerup",re),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",_e)};const r=this,i={type:"change"},a={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const u=1e-6,c=new W6,d=new W6;let h=1;const f=new we,m=new dt,x=new dt,b=new dt,y=new dt,w=new dt,_=new dt,S=new dt,M=new dt,E=new dt,C=new we,R=new dt;let k=!1;const I=[],N={};function D(){return 2*Math.PI/60/60*r.autoRotateSpeed}function F(){return Math.pow(.95,r.zoomSpeed)}function L(Ee){r.reverseOrbit||r.reverseHorizontalOrbit?d.theta+=Ee:d.theta-=Ee}function U(Ee){r.reverseOrbit||r.reverseVerticalOrbit?d.phi+=Ee:d.phi-=Ee}const j=(()=>{const Ee=new we;return function(mt,fe){Ee.setFromMatrixColumn(fe,0),Ee.multiplyScalar(-mt),f.add(Ee)}})(),q=(()=>{const Ee=new we;return function(mt,fe){r.screenSpacePanning===!0?Ee.setFromMatrixColumn(fe,1):(Ee.setFromMatrixColumn(fe,0),Ee.crossVectors(r.object.up,Ee)),Ee.multiplyScalar(mt),f.add(Ee)}})(),Z=(()=>{const Ee=new we;return function(mt,fe){const $e=r.domElement;if($e&&r.object instanceof Si&&r.object.isPerspectiveCamera){const Ge=r.object.position;Ee.copy(Ge).sub(r.target);let st=Ee.length();st*=Math.tan(r.object.fov/2*Math.PI/180),j(2*mt*st/$e.clientHeight,r.object.matrix),q(2*fe*st/$e.clientHeight,r.object.matrix)}else $e&&r.object instanceof Ou&&r.object.isOrthographicCamera?(j(mt*(r.object.right-r.object.left)/r.object.zoom/$e.clientWidth,r.object.matrix),q(fe*(r.object.top-r.object.bottom)/r.object.zoom/$e.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function Q(Ee){r.object instanceof Si&&r.object.isPerspectiveCamera||r.object instanceof Ou&&r.object.isOrthographicCamera?h=Ee:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function z(Ee){Q(h/Ee)}function W(Ee){Q(h*Ee)}function X(Ee){if(!r.zoomToCursor||!r.domElement)return;k=!0;const je=r.domElement.getBoundingClientRect(),mt=Ee.clientX-je.left,fe=Ee.clientY-je.top,$e=je.width,Ge=je.height;R.x=mt/$e*2-1,R.y=-(fe/Ge)*2+1,C.set(R.x,R.y,1).unproject(r.object).sub(r.object.position).normalize()}function H(Ee){return Math.max(r.minDistance,Math.min(r.maxDistance,Ee))}function J(Ee){m.set(Ee.clientX,Ee.clientY)}function te(Ee){X(Ee),S.set(Ee.clientX,Ee.clientY)}function ee(Ee){y.set(Ee.clientX,Ee.clientY)}function se(Ee){x.set(Ee.clientX,Ee.clientY),b.subVectors(x,m).multiplyScalar(r.rotateSpeed);const je=r.domElement;je&&(L(2*Math.PI*b.x/je.clientHeight),U(2*Math.PI*b.y/je.clientHeight)),m.copy(x),r.update()}function ue(Ee){M.set(Ee.clientX,Ee.clientY),E.subVectors(M,S),E.y>0?z(F()):E.y<0&&W(F()),S.copy(M),r.update()}function oe(Ee){w.set(Ee.clientX,Ee.clientY),_.subVectors(w,y).multiplyScalar(r.panSpeed),Z(_.x,_.y),y.copy(w),r.update()}function Te(Ee){X(Ee),Ee.deltaY<0?W(F()):Ee.deltaY>0&&z(F()),r.update()}function Ne(Ee){let je=!1;switch(Ee.code){case r.keys.UP:Z(0,r.keyPanSpeed),je=!0;break;case r.keys.BOTTOM:Z(0,-r.keyPanSpeed),je=!0;break;case r.keys.LEFT:Z(r.keyPanSpeed,0),je=!0;break;case r.keys.RIGHT:Z(-r.keyPanSpeed,0),je=!0;break}je&&(Ee.preventDefault(),r.update())}function be(){if(I.length==1)m.set(I[0].pageX,I[0].pageY);else{const Ee=.5*(I[0].pageX+I[1].pageX),je=.5*(I[0].pageY+I[1].pageY);m.set(Ee,je)}}function De(){if(I.length==1)y.set(I[0].pageX,I[0].pageY);else{const Ee=.5*(I[0].pageX+I[1].pageX),je=.5*(I[0].pageY+I[1].pageY);y.set(Ee,je)}}function ke(){const Ee=I[0].pageX-I[1].pageX,je=I[0].pageY-I[1].pageY,mt=Math.sqrt(Ee*Ee+je*je);S.set(0,mt)}function Me(){r.enableZoom&&ke(),r.enablePan&&De()}function Ie(){r.enableZoom&&ke(),r.enableRotate&&be()}function ce(Ee){if(I.length==1)x.set(Ee.pageX,Ee.pageY);else{const mt=ot(Ee),fe=.5*(Ee.pageX+mt.x),$e=.5*(Ee.pageY+mt.y);x.set(fe,$e)}b.subVectors(x,m).multiplyScalar(r.rotateSpeed);const je=r.domElement;je&&(L(2*Math.PI*b.x/je.clientHeight),U(2*Math.PI*b.y/je.clientHeight)),m.copy(x)}function G(Ee){if(I.length==1)w.set(Ee.pageX,Ee.pageY);else{const je=ot(Ee),mt=.5*(Ee.pageX+je.x),fe=.5*(Ee.pageY+je.y);w.set(mt,fe)}_.subVectors(w,y).multiplyScalar(r.panSpeed),Z(_.x,_.y),y.copy(w)}function xe(Ee){const je=ot(Ee),mt=Ee.pageX-je.x,fe=Ee.pageY-je.y,$e=Math.sqrt(mt*mt+fe*fe);M.set(0,$e),E.set(0,Math.pow(M.y/S.y,r.zoomSpeed)),z(E.y),S.copy(M)}function Oe(Ee){r.enableZoom&&xe(Ee),r.enablePan&&G(Ee)}function Fe(Ee){r.enableZoom&&xe(Ee),r.enableRotate&&ce(Ee)}function ze(Ee){var je,mt;r.enabled!==!1&&(I.length===0&&((je=r.domElement)==null||je.ownerDocument.addEventListener("pointermove",le),(mt=r.domElement)==null||mt.ownerDocument.addEventListener("pointerup",re)),gt(Ee),Ee.pointerType==="touch"?Be(Ee):me(Ee))}function le(Ee){r.enabled!==!1&&(Ee.pointerType==="touch"?He(Ee):de(Ee))}function re(Ee){var je,mt,fe;We(Ee),I.length===0&&((je=r.domElement)==null||je.releasePointerCapture(Ee.pointerId),(mt=r.domElement)==null||mt.ownerDocument.removeEventListener("pointermove",le),(fe=r.domElement)==null||fe.ownerDocument.removeEventListener("pointerup",re)),r.dispatchEvent(s),l=o.NONE}function me(Ee){let je;switch(Ee.button){case 0:je=r.mouseButtons.LEFT;break;case 1:je=r.mouseButtons.MIDDLE;break;case 2:je=r.mouseButtons.RIGHT;break;default:je=-1}switch(je){case hh.DOLLY:if(r.enableZoom===!1)return;te(Ee),l=o.DOLLY;break;case hh.ROTATE:if(Ee.ctrlKey||Ee.metaKey||Ee.shiftKey){if(r.enablePan===!1)return;ee(Ee),l=o.PAN}else{if(r.enableRotate===!1)return;J(Ee),l=o.ROTATE}break;case hh.PAN:if(Ee.ctrlKey||Ee.metaKey||Ee.shiftKey){if(r.enableRotate===!1)return;J(Ee),l=o.ROTATE}else{if(r.enablePan===!1)return;ee(Ee),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(a)}function de(Ee){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;se(Ee);break;case o.DOLLY:if(r.enableZoom===!1)return;ue(Ee);break;case o.PAN:if(r.enablePan===!1)return;oe(Ee);break}}function ve(Ee){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(Ee.preventDefault(),r.dispatchEvent(a),Te(Ee),r.dispatchEvent(s))}function _e(Ee){r.enabled===!1||r.enablePan===!1||Ne(Ee)}function Be(Ee){switch(Je(Ee),I.length){case 1:switch(r.touches.ONE){case fh.ROTATE:if(r.enableRotate===!1)return;be(),l=o.TOUCH_ROTATE;break;case fh.PAN:if(r.enablePan===!1)return;De(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case fh.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Me(),l=o.TOUCH_DOLLY_PAN;break;case fh.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ie(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(a)}function He(Ee){switch(Je(Ee),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;ce(Ee),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;G(Ee),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Oe(Ee),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Fe(Ee),r.update();break;default:l=o.NONE}}function pt(Ee){r.enabled!==!1&&Ee.preventDefault()}function gt(Ee){I.push(Ee)}function We(Ee){delete N[Ee.pointerId];for(let je=0;je<I.length;je++)if(I[je].pointerId==Ee.pointerId){I.splice(je,1);return}}function Je(Ee){let je=N[Ee.pointerId];je===void 0&&(je=new dt,N[Ee.pointerId]=je),je.set(Ee.pageX,Ee.pageY)}function ot(Ee){const je=Ee.pointerId===I[0].pointerId?I[1]:I[0];return N[je.pointerId]}this.dollyIn=(Ee=F())=>{W(Ee),r.update()},this.dollyOut=(Ee=F())=>{z(Ee),r.update()},this.getScale=()=>h,this.setScale=Ee=>{Q(Ee),r.update()},this.getZoomScale=()=>F(),n!==void 0&&this.connect(n),this.update()}};const bL=new Ai,$x=new we;class P8 extends Y2{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Wt(e,3)),this.setAttribute("uv",new Wt(n,2))}applyMatrix4(e){const n=this.attributes.instanceStart,r=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(e),r.applyMatrix4(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new tw(n,6,1);return this.setAttribute("instanceStart",new Gs(r,3,0)),this.setAttribute("instanceEnd",new Gs(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,n=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));const i=new tw(r,n*2,1);return this.setAttribute("instanceColorStart",new Gs(i,n,0)),this.setAttribute("instanceColorEnd",new Gs(i,n,n)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new d8(e.geometry)),this}fromLineSegments(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ai);const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;e!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(e),bL.setFromBufferAttribute(n),this.boundingBox.union(bL))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(e!==void 0&&n!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let a=0,s=e.count;a<s;a++)$x.fromBufferAttribute(e,a),i=Math.max(i,r.distanceToSquared($x)),$x.fromBufferAttribute(n,a),i=Math.max(i,r.distanceToSquared($x));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class RZ extends P8{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const n=e.length-3,r=new Float32Array(2*n);for(let i=0;i<n;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e,n=3){const r=e.length-n,i=new Float32Array(2*r);if(n===3)for(let a=0;a<r;a+=n)i[2*a]=e[a],i[2*a+1]=e[a+1],i[2*a+2]=e[a+2],i[2*a+3]=e[a+3],i[2*a+4]=e[a+4],i[2*a+5]=e[a+5];else for(let a=0;a<r;a+=n)i[2*a]=e[a],i[2*a+1]=e[a+1],i[2*a+2]=e[a+2],i[2*a+3]=e[a+3],i[2*a+4]=e[a+4],i[2*a+5]=e[a+5],i[2*a+6]=e[a+6],i[2*a+7]=e[a+7];return super.setColors(i,n),this}fromLine(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}}class D8 extends Ss{constructor(e){super({type:"LineMaterial",uniforms:y1.clone(y1.merge([Bt.common,Bt.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new dt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${IZ>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const RE=new er,_L=new we,wL=new we,ma=new er,ga=new er,bl=new er,PE=new we,DE=new fn,ya=new rZ,SL=new we,Vx=new Ai,qx=new Hi,_l=new er;let kl,Uh;function EL(t,e,n){return _l.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),_l.multiplyScalar(1/_l.w),_l.x=Uh/n.width,_l.y=Uh/n.height,_l.applyMatrix4(t.projectionMatrixInverse),_l.multiplyScalar(1/_l.w),Math.abs(Math.max(_l.x,_l.y))}function Bbe(t,e){const n=t.matrixWorld,r=t.geometry,i=r.attributes.instanceStart,a=r.attributes.instanceEnd,s=Math.min(r.instanceCount,i.count);for(let o=0,l=s;o<l;o++){ya.start.fromBufferAttribute(i,o),ya.end.fromBufferAttribute(a,o),ya.applyMatrix4(n);const u=new we,c=new we;kl.distanceSqToSegment(ya.start,ya.end,c,u),c.distanceTo(u)<Uh*.5&&e.push({point:c,pointOnLine:u,distance:kl.origin.distanceTo(c),object:t,face:null,faceIndex:o,uv:null,[NZ]:null})}}function Ube(t,e,n){const r=e.projectionMatrix,a=t.material.resolution,s=t.matrixWorld,o=t.geometry,l=o.attributes.instanceStart,u=o.attributes.instanceEnd,c=Math.min(o.instanceCount,l.count),d=-e.near;kl.at(1,bl),bl.w=1,bl.applyMatrix4(e.matrixWorldInverse),bl.applyMatrix4(r),bl.multiplyScalar(1/bl.w),bl.x*=a.x/2,bl.y*=a.y/2,bl.z=0,PE.copy(bl),DE.multiplyMatrices(e.matrixWorldInverse,s);for(let h=0,f=c;h<f;h++){if(ma.fromBufferAttribute(l,h),ga.fromBufferAttribute(u,h),ma.w=1,ga.w=1,ma.applyMatrix4(DE),ga.applyMatrix4(DE),ma.z>d&&ga.z>d)continue;if(ma.z>d){const _=ma.z-ga.z,S=(ma.z-d)/_;ma.lerp(ga,S)}else if(ga.z>d){const _=ga.z-ma.z,S=(ga.z-d)/_;ga.lerp(ma,S)}ma.applyMatrix4(r),ga.applyMatrix4(r),ma.multiplyScalar(1/ma.w),ga.multiplyScalar(1/ga.w),ma.x*=a.x/2,ma.y*=a.y/2,ga.x*=a.x/2,ga.y*=a.y/2,ya.start.copy(ma),ya.start.z=0,ya.end.copy(ga),ya.end.z=0;const x=ya.closestPointToPointParameter(PE,!0);ya.at(x,SL);const b=KN.lerp(ma.z,ga.z,x),y=b>=-1&&b<=1,w=PE.distanceTo(SL)<Uh*.5;if(y&&w){ya.start.fromBufferAttribute(l,h),ya.end.fromBufferAttribute(u,h),ya.start.applyMatrix4(s),ya.end.applyMatrix4(s);const _=new we,S=new we;kl.distanceSqToSegment(ya.start,ya.end,S,_),n.push({point:S,pointOnLine:_,distance:kl.origin.distanceTo(S),object:t,face:null,faceIndex:h,uv:null,[NZ]:null})}}}class PZ extends Kr{constructor(e=new P8,n=new D8({color:Math.random()*16777215})){super(e,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,n=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*n.count);for(let s=0,o=0,l=n.count;s<l;s++,o+=2)_L.fromBufferAttribute(n,s),wL.fromBufferAttribute(r,s),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+_L.distanceTo(wL);const a=new tw(i,2,1);return e.setAttribute("instanceDistanceStart",new Gs(a,1,0)),e.setAttribute("instanceDistanceEnd",new Gs(a,1,1)),this}raycast(e,n){const r=this.material.worldUnits,i=e.camera;i===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const a=e.params.Line2!==void 0&&e.params.Line2.threshold||0;kl=e.ray;const s=this.matrixWorld,o=this.geometry,l=this.material;Uh=l.linewidth+a,o.boundingSphere===null&&o.computeBoundingSphere(),qx.copy(o.boundingSphere).applyMatrix4(s);let u;if(r)u=Uh*.5;else{const d=Math.max(i.near,qx.distanceToPoint(kl.origin));u=EL(i,d,l.resolution)}if(qx.radius+=u,kl.intersectsSphere(qx)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),Vx.copy(o.boundingBox).applyMatrix4(s);let c;if(r)c=Uh*.5;else{const d=Math.max(i.near,Vx.distanceToPoint(kl.origin));c=EL(i,d,l.resolution)}Vx.expandByScalar(c),kl.intersectsBox(Vx)!==!1&&(r?Bbe(this,n):Ube(this,i,n))}onBeforeRender(e){const n=this.material.uniforms;n&&n.resolution&&(e.getViewport(RE),this.material.uniforms.resolution.value.set(RE.z,RE.w))}}class zbe extends PZ{constructor(e=new RZ,n=new D8({color:Math.random()*16777215})){super(e,n),this.isLine2=!0,this.type="Line2"}}const jbe=P.forwardRef(function({children:e,follow:n=!0,lockX:r=!1,lockY:i=!1,lockZ:a=!1,...s},o){const l=P.useRef(null),u=P.useRef(null),c=new xa;return vf(({camera:d})=>{if(!n||!u.current)return;const h=l.current.rotation.clone();u.current.updateMatrix(),u.current.updateWorldMatrix(!1,!1),u.current.getWorldQuaternion(c),d.getWorldQuaternion(l.current.quaternion).premultiply(c.invert()),r&&(l.current.rotation.x=h.x),i&&(l.current.rotation.y=h.y),a&&(l.current.rotation.z=h.z)}),P.useImperativeHandle(o,()=>u.current,[]),P.createElement("group",rd({ref:u},s),P.createElement("group",{ref:l},e))}),jb=P.forwardRef(function({points:e,color:n=16777215,vertexColors:r,linewidth:i,lineWidth:a,segments:s,dashed:o,...l},u){var c,d;const h=vs(y=>y.size),f=P.useMemo(()=>s?new PZ:new zbe,[s]),[m]=P.useState(()=>new D8),x=(r==null||(c=r[0])==null?void 0:c.length)===4?4:3,b=P.useMemo(()=>{const y=s?new P8:new RZ,w=e.map(_=>{const S=Array.isArray(_);return _ instanceof we||_ instanceof er?[_.x,_.y,_.z]:_ instanceof dt?[_.x,_.y,0]:S&&_.length===3?[_[0],_[1],_[2]]:S&&_.length===2?[_[0],_[1],0]:_});if(y.setPositions(w.flat()),r){n=16777215;const _=r.map(S=>S instanceof zt?S.toArray():S);y.setColors(_.flat(),x)}return y},[e,s,r,x]);return P.useLayoutEffect(()=>{f.computeLineDistances()},[e,f]),P.useLayoutEffect(()=>{o?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[o,m]),P.useEffect(()=>()=>{b.dispose(),m.dispose()},[b]),P.createElement("primitive",rd({object:f,ref:u},l),P.createElement("primitive",{object:b,attach:"geometry"}),P.createElement("primitive",rd({object:m,attach:"material",color:n,vertexColors:!!r,resolution:[h.width,h.height],linewidth:(d=i??a)!==null&&d!==void 0?d:1,dashed:o,transparent:x===4},l)))});function Hbe(){var t=Object.create(null);function e(i,a){var s=i.id,o=i.name,l=i.dependencies;l===void 0&&(l=[]);var u=i.init;u===void 0&&(u=function(){});var c=i.getTransferables;if(c===void 0&&(c=null),!t[s])try{l=l.map(function(h){return h&&h.isWorkerModule&&(e(h,function(f){if(f instanceof Error)throw f}),h=t[h.id].value),h}),u=r("<"+o+">.init",u),c&&(c=r("<"+o+">.getTransferables",c));var d=null;typeof u=="function"?d=u.apply(void 0,l):console.error("worker module init function failed to rehydrate"),t[s]={id:s,value:d,getTransferables:c},a(d)}catch(h){h&&h.noLog||console.error(h),a(h)}}function n(i,a){var s,o=i.id,l=i.args;(!t[o]||typeof t[o].value!="function")&&a(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var u=(s=t[o]).value.apply(s,l);u&&typeof u.then=="function"?u.then(c,function(d){return a(d instanceof Error?d:new Error(""+d))}):c(u)}catch(d){a(d)}function c(d){try{var h=t[o].getTransferables&&t[o].getTransferables(d);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),a(d,h)}catch(f){console.error(f),a(f)}}}function r(i,a){var s=void 0;self.troikaDefine=function(l){return s=l};var o=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+a+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(l){console.error(l)}return URL.revokeObjectURL(o),delete self.troikaDefine,s}self.addEventListener("message",function(i){var a=i.data,s=a.messageId,o=a.action,l=a.data;try{o==="registerModule"&&e(l,function(u){u instanceof Error?postMessage({messageId:s,success:!1,error:u.message}):postMessage({messageId:s,success:!0,result:{isCallable:typeof u=="function"}})}),o==="callModule"&&n(l,function(u,c){u instanceof Error?postMessage({messageId:s,success:!1,error:u.message}):postMessage({messageId:s,success:!0,result:u},c||void 0)})}catch(u){postMessage({messageId:s,success:!1,error:u.stack})}})}function $be(t){var e=function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return e._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,n);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=t.dependencies,r=t.init;n=Array.isArray(n)?n.map(function(a){return a&&(a=a.onMainThread||a,a._getInitResult&&(a=a._getInitResult())),a}):[];var i=Promise.all(n).then(function(a){return r.apply(null,a)});return e._getInitResult=function(){return i},i},e}var DZ=function(){var t=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),t=!0}catch(n){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+n.message+"]")}return DZ=function(){return t},t},Vbe=0,qbe=0,OE=!1,zg=Object.create(null),jg=Object.create(null),iI=Object.create(null);function $0(t){if((!t||typeof t.init!="function")&&!OE)throw new Error("requires `options.init` function");var e=t.dependencies,n=t.init,r=t.getTransferables,i=t.workerId,a=$be(t);i==null&&(i="#default");var s="workerModule"+ ++Vbe,o=t.name||s,l=null;e=e&&e.map(function(c){return typeof c=="function"&&!c.workerModuleData&&(OE=!0,c=$0({workerId:i,name:"<"+o+"> function dependency: "+c.name,init:`function(){return (
`+Hb(c)+`
)}`}),OE=!1),c&&c.workerModuleData&&(c=c.workerModuleData),c});function u(){for(var c=[],d=arguments.length;d--;)c[d]=arguments[d];if(!DZ())return a.apply(void 0,c);if(!l){l=TL(i,"registerModule",u.workerModuleData);var h=function(){l=null,jg[i].delete(h)};(jg[i]||(jg[i]=new Set)).add(h)}return l.then(function(f){var m=f.isCallable;if(m)return TL(i,"callModule",{id:s,args:c});throw new Error("Worker module function was called but `init` did not return a callable function")})}return u.workerModuleData={isWorkerModule:!0,id:s,name:o,dependencies:e,init:Hb(n),getTransferables:r&&Hb(r)},u.onMainThread=a,u}function Gbe(t){jg[t]&&jg[t].forEach(function(e){e()}),zg[t]&&(zg[t].terminate(),delete zg[t])}function Hb(t){var e=t.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function Wbe(t){var e=zg[t];if(!e){var n=Hb(Hbe);e=zg[t]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+t.replace(/\*/g,"")+` **/

;(`+n+")()"],{type:"application/javascript"}))),e.onmessage=function(r){var i=r.data,a=i.messageId,s=iI[a];if(!s)throw new Error("WorkerModule response with empty or unknown messageId");delete iI[a],s(i)}}return e}function TL(t,e,n){return new Promise(function(r,i){var a=++qbe;iI[a]=function(s){s.success?r(s.result):i(new Error("Error in worker "+e+" call: "+s.error))},Wbe(t).postMessage({messageId:a,action:e,data:n})})}function OZ(){var t=(function(e){function n(Q,z,W,X,H,J,te,ee){var se=1-te;ee.x=se*se*Q+2*se*te*W+te*te*H,ee.y=se*se*z+2*se*te*X+te*te*J}function r(Q,z,W,X,H,J,te,ee,se,ue){var oe=1-se;ue.x=oe*oe*oe*Q+3*oe*oe*se*W+3*oe*se*se*H+se*se*se*te,ue.y=oe*oe*oe*z+3*oe*oe*se*X+3*oe*se*se*J+se*se*se*ee}function i(Q,z){for(var W=/([MLQCZ])([^MLQCZ]*)/g,X,H,J,te,ee;X=W.exec(Q);){var se=X[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ue){return parseFloat(ue)});switch(X[1]){case"M":te=H=se[0],ee=J=se[1];break;case"L":(se[0]!==te||se[1]!==ee)&&z("L",te,ee,te=se[0],ee=se[1]);break;case"Q":{z("Q",te,ee,te=se[2],ee=se[3],se[0],se[1]);break}case"C":{z("C",te,ee,te=se[4],ee=se[5],se[0],se[1],se[2],se[3]);break}case"Z":(te!==H||ee!==J)&&z("L",te,ee,H,J);break}}}function a(Q,z,W){W===void 0&&(W=16);var X={x:0,y:0};i(Q,function(H,J,te,ee,se,ue,oe,Te,Ne){switch(H){case"L":z(J,te,ee,se);break;case"Q":{for(var be=J,De=te,ke=1;ke<W;ke++)n(J,te,ue,oe,ee,se,ke/(W-1),X),z(be,De,X.x,X.y),be=X.x,De=X.y;break}case"C":{for(var Me=J,Ie=te,ce=1;ce<W;ce++)r(J,te,ue,oe,Te,Ne,ee,se,ce/(W-1),X),z(Me,Ie,X.x,X.y),Me=X.x,Ie=X.y;break}}})}var s="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,u={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function c(Q,z){var W=Q.getContext?Q.getContext("webgl",u):Q,X=l.get(W);if(!X){let oe=function(Me){var Ie=J[Me];if(!Ie&&(Ie=J[Me]=W.getExtension(Me),!Ie))throw new Error(Me+" not supported");return Ie},Te=function(Me,Ie){var ce=W.createShader(Ie);return W.shaderSource(ce,Me),W.compileShader(ce),ce},Ne=function(Me,Ie,ce,G){if(!te[Me]){var xe={},Oe={},Fe=W.createProgram();W.attachShader(Fe,Te(Ie,W.VERTEX_SHADER)),W.attachShader(Fe,Te(ce,W.FRAGMENT_SHADER)),W.linkProgram(Fe),te[Me]={program:Fe,transaction:function(le){W.useProgram(Fe),le({setUniform:function(me,de){for(var ve=[],_e=arguments.length-2;_e-- >0;)ve[_e]=arguments[_e+2];var Be=Oe[de]||(Oe[de]=W.getUniformLocation(Fe,de));W["uniform"+me].apply(W,[Be].concat(ve))},setAttribute:function(me,de,ve,_e,Be){var He=xe[me];He||(He=xe[me]={buf:W.createBuffer(),loc:W.getAttribLocation(Fe,me),data:null}),W.bindBuffer(W.ARRAY_BUFFER,He.buf),W.vertexAttribPointer(He.loc,de,W.FLOAT,!1,0,0),W.enableVertexAttribArray(He.loc),H?W.vertexAttribDivisor(He.loc,_e):oe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(He.loc,_e),Be!==He.data&&(W.bufferData(W.ARRAY_BUFFER,Be,ve),He.data=Be)}})}}}te[Me].transaction(G)},be=function(Me,Ie){se++;try{W.activeTexture(W.TEXTURE0+se);var ce=ee[Me];ce||(ce=ee[Me]=W.createTexture(),W.bindTexture(W.TEXTURE_2D,ce),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.NEAREST),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.NEAREST)),W.bindTexture(W.TEXTURE_2D,ce),Ie(ce,se)}finally{se--}},De=function(Me,Ie,ce){var G=W.createFramebuffer();ue.push(G),W.bindFramebuffer(W.FRAMEBUFFER,G),W.activeTexture(W.TEXTURE0+Ie),W.bindTexture(W.TEXTURE_2D,Me),W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,Me,0);try{ce(G)}finally{W.deleteFramebuffer(G),W.bindFramebuffer(W.FRAMEBUFFER,ue[--ue.length-1]||null)}},ke=function(){J={},te={},ee={},se=-1,ue.length=0};var H=typeof WebGL2RenderingContext<"u"&&W instanceof WebGL2RenderingContext,J={},te={},ee={},se=-1,ue=[];W.canvas.addEventListener("webglcontextlost",function(Me){ke(),Me.preventDefault()},!1),l.set(W,X={gl:W,isWebGL2:H,getExtension:oe,withProgram:Ne,withTexture:be,withTextureFramebuffer:De,handleContextLoss:ke})}z(X)}function d(Q,z,W,X,H,J,te,ee){te===void 0&&(te=15),ee===void 0&&(ee=null),c(Q,function(se){var ue=se.gl,oe=se.withProgram,Te=se.withTexture;Te("copy",function(Ne,be){ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,H,J,0,ue.RGBA,ue.UNSIGNED_BYTE,z),oe("copy",s,o,function(De){var ke=De.setUniform,Me=De.setAttribute;Me("aUV",2,ue.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ke("1i","image",be),ue.bindFramebuffer(ue.FRAMEBUFFER,ee||null),ue.disable(ue.BLEND),ue.colorMask(te&8,te&4,te&2,te&1),ue.viewport(W,X,H,J),ue.scissor(W,X,H,J),ue.drawArrays(ue.TRIANGLES,0,3)})})})}function h(Q,z,W){var X=Q.width,H=Q.height;c(Q,function(J){var te=J.gl,ee=new Uint8Array(X*H*4);te.readPixels(0,0,X,H,te.RGBA,te.UNSIGNED_BYTE,ee),Q.width=z,Q.height=W,d(te,ee,0,0,X,H)})}var f=Object.freeze({__proto__:null,withWebGLContext:c,renderImageData:d,resizeWebGLCanvasWithoutClearing:h});function m(Q,z,W,X,H,J){J===void 0&&(J=1);var te=new Uint8Array(Q*z),ee=X[2]-X[0],se=X[3]-X[1],ue=[];a(W,function(Me,Ie,ce,G){ue.push({x1:Me,y1:Ie,x2:ce,y2:G,minX:Math.min(Me,ce),minY:Math.min(Ie,G),maxX:Math.max(Me,ce),maxY:Math.max(Ie,G)})}),ue.sort(function(Me,Ie){return Me.maxX-Ie.maxX});for(var oe=0;oe<Q;oe++)for(var Te=0;Te<z;Te++){var Ne=De(X[0]+ee*(oe+.5)/Q,X[1]+se*(Te+.5)/z),be=Math.pow(1-Math.abs(Ne)/H,J)/2;Ne<0&&(be=1-be),be=Math.max(0,Math.min(255,Math.round(be*255))),te[Te*Q+oe]=be}return te;function De(Me,Ie){for(var ce=1/0,G=1/0,xe=ue.length;xe--;){var Oe=ue[xe];if(Oe.maxX+G<=Me)break;if(Me+G>Oe.minX&&Ie-G<Oe.maxY&&Ie+G>Oe.minY){var Fe=y(Me,Ie,Oe.x1,Oe.y1,Oe.x2,Oe.y2);Fe<ce&&(ce=Fe,G=Math.sqrt(ce))}}return ke(Me,Ie)&&(G=-G),G}function ke(Me,Ie){for(var ce=0,G=ue.length;G--;){var xe=ue[G];if(xe.maxX<=Me)break;var Oe=xe.y1>Ie!=xe.y2>Ie&&Me<(xe.x2-xe.x1)*(Ie-xe.y1)/(xe.y2-xe.y1)+xe.x1;Oe&&(ce+=xe.y1<xe.y2?1:-1)}return ce!==0}}function x(Q,z,W,X,H,J,te,ee,se,ue){J===void 0&&(J=1),ee===void 0&&(ee=0),se===void 0&&(se=0),ue===void 0&&(ue=0),b(Q,z,W,X,H,J,te,null,ee,se,ue)}function b(Q,z,W,X,H,J,te,ee,se,ue,oe){J===void 0&&(J=1),se===void 0&&(se=0),ue===void 0&&(ue=0),oe===void 0&&(oe=0);for(var Te=m(Q,z,W,X,H,J),Ne=new Uint8Array(Te.length*4),be=0;be<Te.length;be++)Ne[be*4+oe]=Te[be];d(te,Ne,se,ue,Q,z,1<<3-oe,ee)}function y(Q,z,W,X,H,J){var te=H-W,ee=J-X,se=te*te+ee*ee,ue=se?Math.max(0,Math.min(1,((Q-W)*te+(z-X)*ee)/se)):0,oe=Q-(W+ue*te),Te=z-(X+ue*ee);return oe*oe+Te*Te}var w=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:x,generateIntoFramebuffer:b}),_="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",S="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",M="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",E=new Float32Array([0,0,2,0,0,2]),C=null,R=!1,k={},I=new WeakMap;function N(Q){if(!R&&!U(Q))throw new Error("WebGL generation not supported")}function D(Q,z,W,X,H,J,te){if(J===void 0&&(J=1),te===void 0&&(te=null),!te&&(te=C,!te)){var ee=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!ee)throw new Error("OffscreenCanvas or DOM canvas not supported");te=C=ee.getContext("webgl",{depth:!1})}N(te);var se=new Uint8Array(Q*z*4);c(te,function(Ne){var be=Ne.gl,De=Ne.withTexture,ke=Ne.withTextureFramebuffer;De("readable",function(Me,Ie){be.texImage2D(be.TEXTURE_2D,0,be.RGBA,Q,z,0,be.RGBA,be.UNSIGNED_BYTE,null),ke(Me,Ie,function(ce){L(Q,z,W,X,H,J,be,ce,0,0,0),be.readPixels(0,0,Q,z,be.RGBA,be.UNSIGNED_BYTE,se)})})});for(var ue=new Uint8Array(Q*z),oe=0,Te=0;oe<se.length;oe+=4)ue[Te++]=se[oe];return ue}function F(Q,z,W,X,H,J,te,ee,se,ue){J===void 0&&(J=1),ee===void 0&&(ee=0),se===void 0&&(se=0),ue===void 0&&(ue=0),L(Q,z,W,X,H,J,te,null,ee,se,ue)}function L(Q,z,W,X,H,J,te,ee,se,ue,oe){J===void 0&&(J=1),se===void 0&&(se=0),ue===void 0&&(ue=0),oe===void 0&&(oe=0),N(te);var Te=[];a(W,function(Ne,be,De,ke){Te.push(Ne,be,De,ke)}),Te=new Float32Array(Te),c(te,function(Ne){var be=Ne.gl,De=Ne.isWebGL2,ke=Ne.getExtension,Me=Ne.withProgram,Ie=Ne.withTexture,ce=Ne.withTextureFramebuffer,G=Ne.handleContextLoss;if(Ie("rawDistances",function(xe,Oe){(Q!==xe._lastWidth||z!==xe._lastHeight)&&be.texImage2D(be.TEXTURE_2D,0,be.RGBA,xe._lastWidth=Q,xe._lastHeight=z,0,be.RGBA,be.UNSIGNED_BYTE,null),Me("main",_,S,function(Fe){var ze=Fe.setAttribute,le=Fe.setUniform,re=!De&&ke("ANGLE_instanced_arrays"),me=!De&&ke("EXT_blend_minmax");ze("aUV",2,be.STATIC_DRAW,0,E),ze("aLineSegment",4,be.DYNAMIC_DRAW,1,Te),le.apply(void 0,["4f","uGlyphBounds"].concat(X)),le("1f","uMaxDistance",H),le("1f","uExponent",J),ce(xe,Oe,function(de){be.enable(be.BLEND),be.colorMask(!0,!0,!0,!0),be.viewport(0,0,Q,z),be.scissor(0,0,Q,z),be.blendFunc(be.ONE,be.ONE),be.blendEquationSeparate(be.FUNC_ADD,De?be.MAX:me.MAX_EXT),be.clear(be.COLOR_BUFFER_BIT),De?be.drawArraysInstanced(be.TRIANGLES,0,3,Te.length/4):re.drawArraysInstancedANGLE(be.TRIANGLES,0,3,Te.length/4)})}),Me("post",s,M,function(Fe){Fe.setAttribute("aUV",2,be.STATIC_DRAW,0,E),Fe.setUniform("1i","tex",Oe),be.bindFramebuffer(be.FRAMEBUFFER,ee),be.disable(be.BLEND),be.colorMask(oe===0,oe===1,oe===2,oe===3),be.viewport(se,ue,Q,z),be.scissor(se,ue,Q,z),be.drawArrays(be.TRIANGLES,0,3)})}),be.isContextLost())throw G(),new Error("webgl context lost")})}function U(Q){var z=!Q||Q===C?k:Q.canvas||Q,W=I.get(z);if(W===void 0){R=!0;var X=null;try{var H=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],J=D(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,Q);W=J&&H.length===J.length&&J.every(function(te,ee){return te===H[ee]}),W||(X="bad trial run results",console.info(H,J))}catch(te){W=!1,X=te.message}X&&console.warn("WebGL SDF generation not supported:",X),R=!1,I.set(z,W)}return W}var j=Object.freeze({__proto__:null,generate:D,generateIntoCanvas:F,generateIntoFramebuffer:L,isSupported:U});function q(Q,z,W,X,H,J){H===void 0&&(H=Math.max(X[2]-X[0],X[3]-X[1])/2),J===void 0&&(J=1);try{return D.apply(j,arguments)}catch(te){return console.info("WebGL SDF generation failed, falling back to JS",te),m.apply(w,arguments)}}function Z(Q,z,W,X,H,J,te,ee,se,ue){H===void 0&&(H=Math.max(X[2]-X[0],X[3]-X[1])/2),J===void 0&&(J=1),ee===void 0&&(ee=0),se===void 0&&(se=0),ue===void 0&&(ue=0);try{return F.apply(j,arguments)}catch(oe){return console.info("WebGL SDF generation failed, falling back to JS",oe),x.apply(w,arguments)}}return e.forEachPathCommand=i,e.generate=q,e.generateIntoCanvas=Z,e.javascript=w,e.pathToLineSegments=a,e.webgl=j,e.webglUtils=f,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return t}function Ybe(){var t=(function(e){var n={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},i={};r.L=1,i[1]="L",Object.keys(n).forEach(function(G,xe){r[G]=1<<xe+1,i[r[G]]=G}),Object.freeze(r);var a=r.LRI|r.RLI|r.FSI,s=r.L|r.R|r.AL,o=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,l=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,u=r.S|r.WS|r.B|a|r.PDI|l,c=null;function d(){if(!c){c=new Map;var G=function(Oe){if(n.hasOwnProperty(Oe)){var Fe=0;n[Oe].split(",").forEach(function(ze){var le=ze.split("+"),re=le[0],me=le[1];re=parseInt(re,36),me=me?parseInt(me,36):0,c.set(Fe+=re,r[Oe]);for(var de=0;de<me;de++)c.set(++Fe,r[Oe])})}};for(var xe in n)G(xe)}}function h(G){return d(),c.get(G.codePointAt(0))||r.L}function f(G){return i[h(G)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function x(G,xe){var Oe=36,Fe=0,ze=new Map,le=xe&&new Map,re;return G.split(",").forEach(function me(de){if(de.indexOf("+")!==-1)for(var ve=+de;ve--;)me(re);else{re=de;var _e=de.split(">"),Be=_e[0],He=_e[1];Be=String.fromCodePoint(Fe+=parseInt(Be,Oe)),He=String.fromCodePoint(Fe+=parseInt(He,Oe)),ze.set(Be,He),xe&&le.set(He,Be)}}),{map:ze,reverseMap:le}}var b,y,w;function _(){if(!b){var G=x(m.pairs,!0),xe=G.map,Oe=G.reverseMap;b=xe,y=Oe,w=x(m.canonical,!1).map}}function S(G){return _(),b.get(G)||null}function M(G){return _(),y.get(G)||null}function E(G){return _(),w.get(G)||null}var C=r.L,R=r.R,k=r.EN,I=r.ES,N=r.ET,D=r.AN,F=r.CS,L=r.B,U=r.S,j=r.ON,q=r.BN,Z=r.NSM,Q=r.AL,z=r.LRO,W=r.RLO,X=r.LRE,H=r.RLE,J=r.PDF,te=r.LRI,ee=r.RLI,se=r.FSI,ue=r.PDI;function oe(G,xe){for(var Oe=125,Fe=new Uint32Array(G.length),ze=0;ze<G.length;ze++)Fe[ze]=h(G[ze]);var le=new Map;function re(da,Is){var Ea=Fe[da];Fe[da]=Is,le.set(Ea,le.get(Ea)-1),Ea&o&&le.set(o,le.get(o)-1),le.set(Is,(le.get(Is)||0)+1),Is&o&&le.set(o,(le.get(o)||0)+1)}for(var me=new Uint8Array(G.length),de=new Map,ve=[],_e=null,Be=0;Be<G.length;Be++)_e||ve.push(_e={start:Be,end:G.length-1,level:xe==="rtl"?1:xe==="ltr"?0:Ff(Be,!1)}),Fe[Be]&L&&(_e.end=Be,_e=null);for(var He=H|X|W|z|a|ue|J|L,pt=function(da){return da+(da&1?1:2)},gt=function(da){return da+(da&1?2:1)},We=0;We<ve.length;We++){_e=ve[We];var Je=[{_level:_e.level,_override:0,_isolate:0}],ot=void 0,Ee=0,je=0,mt=0;le.clear();for(var fe=_e.start;fe<=_e.end;fe++){var $e=Fe[fe];if(ot=Je[Je.length-1],le.set($e,(le.get($e)||0)+1),$e&o&&le.set(o,(le.get(o)||0)+1),$e&He)if($e&(H|X)){me[fe]=ot._level;var Ge=($e===H?gt:pt)(ot._level);Ge<=Oe&&!Ee&&!je?Je.push({_level:Ge,_override:0,_isolate:0}):Ee||je++}else if($e&(W|z)){me[fe]=ot._level;var st=($e===W?gt:pt)(ot._level);st<=Oe&&!Ee&&!je?Je.push({_level:st,_override:$e&W?R:C,_isolate:0}):Ee||je++}else if($e&a){$e&se&&($e=Ff(fe+1,!0)===1?ee:te),me[fe]=ot._level,ot._override&&re(fe,ot._override);var Qe=($e===ee?gt:pt)(ot._level);Qe<=Oe&&Ee===0&&je===0?(mt++,Je.push({_level:Qe,_override:0,_isolate:1,_isolInitIndex:fe})):Ee++}else if($e&ue){if(Ee>0)Ee--;else if(mt>0){for(je=0;!Je[Je.length-1]._isolate;)Je.pop();var Ye=Je[Je.length-1]._isolInitIndex;Ye!=null&&(de.set(Ye,fe),de.set(fe,Ye)),Je.pop(),mt--}ot=Je[Je.length-1],me[fe]=ot._level,ot._override&&re(fe,ot._override)}else $e&J?(Ee===0&&(je>0?je--:!ot._isolate&&Je.length>1&&(Je.pop(),ot=Je[Je.length-1])),me[fe]=ot._level):$e&L&&(me[fe]=_e.level);else me[fe]=ot._level,ot._override&&$e!==q&&re(fe,ot._override)}for(var ft=[],Ct=null,At=_e.start;At<=_e.end;At++){var Ht=Fe[At];if(!(Ht&l)){var wn=me[At],Vt=Ht&a,En=Ht===ue;Ct&&wn===Ct._level?(Ct._end=At,Ct._endsWithIsolInit=Vt):ft.push(Ct={_start:At,_end:At,_level:wn,_startsWithPDI:En,_endsWithIsolInit:Vt})}}for(var kr=[],Yi=0;Yi<ft.length;Yi++){var ki=ft[Yi];if(!ki._startsWithPDI||ki._startsWithPDI&&!de.has(ki._start)){for(var Gr=[Ct=ki],pi=void 0;Ct&&Ct._endsWithIsolInit&&(pi=de.get(Ct._end))!=null;)for(var fr=Yi+1;fr<ft.length;fr++)if(ft[fr]._start===pi){Gr.push(Ct=ft[fr]);break}for(var Tr=[],Wr=0;Wr<Gr.length;Wr++)for(var Ha=Gr[Wr],Ir=Ha._start;Ir<=Ha._end;Ir++)Tr.push(Ir);for(var Ii=me[Tr[0]],mi=_e.level,Ur=Tr[0]-1;Ur>=0;Ur--)if(!(Fe[Ur]&l)){mi=me[Ur];break}var $a=Tr[Tr.length-1],Kt=me[$a],yr=_e.level;if(!(Fe[$a]&a)){for(var la=$a+1;la<=_e.end;la++)if(!(Fe[la]&l)){yr=me[la];break}}kr.push({_seqIndices:Tr,_sosType:Math.max(mi,Ii)%2?R:C,_eosType:Math.max(yr,Kt)%2?R:C})}}for(var ba=0;ba<kr.length;ba++){var _a=kr[ba],Pt=_a._seqIndices,ge=_a._sosType,qe=_a._eosType,Xe=me[Pt[0]]&1?R:C;if(le.get(Z))for(var nt=0;nt<Pt.length;nt++){var Ke=Pt[nt];if(Fe[Ke]&Z){for(var St=ge,Lt=nt-1;Lt>=0;Lt--)if(!(Fe[Pt[Lt]]&l)){St=Fe[Pt[Lt]];break}re(Ke,St&(a|ue)?j:St)}}if(le.get(k))for(var yt=0;yt<Pt.length;yt++){var $t=Pt[yt];if(Fe[$t]&k)for(var Gt=yt-1;Gt>=-1;Gt--){var nn=Gt===-1?ge:Fe[Pt[Gt]];if(nn&s){nn===Q&&re($t,D);break}}}if(le.get(Q))for(var Qt=0;Qt<Pt.length;Qt++){var _n=Pt[Qt];Fe[_n]&Q&&re(_n,R)}if(le.get(I)||le.get(F))for(var Dn=1;Dn<Pt.length-1;Dn++){var lr=Pt[Dn];if(Fe[lr]&(I|F)){for(var qn=0,mn=0,Dt=Dn-1;Dt>=0&&(qn=Fe[Pt[Dt]],!!(qn&l));Dt--);for(var On=Dn+1;On<Pt.length&&(mn=Fe[Pt[On]],!!(mn&l));On++);qn===mn&&(Fe[lr]===I?qn===k:qn&(k|D))&&re(lr,qn)}}if(le.get(k))for(var cn=0;cn<Pt.length;cn++){var Yr=Pt[cn];if(Fe[Yr]&k){for(var ua=cn-1;ua>=0&&Fe[Pt[ua]]&(N|l);ua--)re(Pt[ua],k);for(cn++;cn<Pt.length&&Fe[Pt[cn]]&(N|l|k);cn++)Fe[Pt[cn]]!==k&&re(Pt[cn],k)}}if(le.get(N)||le.get(I)||le.get(F))for(var pr=0;pr<Pt.length;pr++){var wa=Pt[pr];if(Fe[wa]&(N|I|F)){re(wa,j);for(var Jn=pr-1;Jn>=0&&Fe[Pt[Jn]]&l;Jn--)re(Pt[Jn],j);for(var ri=pr+1;ri<Pt.length&&Fe[Pt[ri]]&l;ri++)re(Pt[ri],j)}}if(le.get(k))for(var Xi=0,xi=ge;Xi<Pt.length;Xi++){var Ni=Pt[Xi],hl=Fe[Ni];hl&k?xi===C&&re(Ni,C):hl&s&&(xi=hl)}if(le.get(o)){var Sa=R|k|D,om=Sa|C,tc=[];{for(var ru=[],nc=0;nc<Pt.length;nc++)if(Fe[Pt[nc]]&o){var rc=G[Pt[nc]],lm=void 0;if(S(rc)!==null)if(ru.length<63)ru.push({char:rc,seqIndex:nc});else break;else if((lm=M(rc))!==null)for(var ic=ru.length-1;ic>=0;ic--){var Td=ru[ic].char;if(Td===lm||Td===M(E(rc))||S(E(Td))===rc){tc.push([ru[ic].seqIndex,nc]),ru.length=ic;break}}}tc.sort(function(da,Is){return da[0]-Is[0]})}for(var If=0;If<tc.length;If++){for(var um=tc[If],Cd=um[0],Nf=um[1],cm=!1,ks=0,Rf=Cd+1;Rf<Nf;Rf++){var iu=Pt[Rf];if(Fe[iu]&om){cm=!0;var dm=Fe[iu]&Sa?R:C;if(dm===Xe){ks=dm;break}}}if(cm&&!ks){ks=ge;for(var ac=Cd-1;ac>=0;ac--){var Md=Pt[ac];if(Fe[Md]&om){var hm=Fe[Md]&Sa?R:C;hm!==Xe?ks=hm:ks=Xe;break}}}if(ks){if(Fe[Pt[Cd]]=Fe[Pt[Nf]]=ks,ks!==Xe){for(var au=Cd+1;au<Pt.length;au++)if(!(Fe[Pt[au]]&l)){h(G[Pt[au]])&Z&&(Fe[Pt[au]]=ks);break}}if(ks!==Xe){for(var Ad=Nf+1;Ad<Pt.length;Ad++)if(!(Fe[Pt[Ad]]&l)){h(G[Pt[Ad]])&Z&&(Fe[Pt[Ad]]=ks);break}}}}for(var Ao=0;Ao<Pt.length;Ao++)if(Fe[Pt[Ao]]&o){for(var fm=Ao,Pf=Ao,Df=ge,sc=Ao-1;sc>=0;sc--)if(Fe[Pt[sc]]&l)fm=sc;else{Df=Fe[Pt[sc]]&Sa?R:C;break}for(var Of=qe,oc=Ao+1;oc<Pt.length;oc++)if(Fe[Pt[oc]]&(o|l))Pf=oc;else{Of=Fe[Pt[oc]]&Sa?R:C;break}for(var Lf=fm;Lf<=Pf;Lf++)Fe[Pt[Lf]]=Df===Of?Df:Xe;Ao=Pf}}}for(var ca=_e.start;ca<=_e.end;ca++){var uy=me[ca],kd=Fe[ca];if(uy&1?kd&(C|k|D)&&me[ca]++:kd&R?me[ca]++:kd&(D|k)&&(me[ca]+=2),kd&l&&(me[ca]=ca===0?_e.level:me[ca-1]),ca===_e.end||h(G[ca])&(U|L))for(var Id=ca;Id>=0&&h(G[Id])&u;Id--)me[Id]=_e.level}}return{levels:me,paragraphs:ve};function Ff(da,Is){for(var Ea=da;Ea<G.length;Ea++){var ko=Fe[Ea];if(ko&(R|Q))return 1;if(ko&(L|C)||Is&&ko===ue)return 0;if(ko&a){var lc=cy(Ea);Ea=lc===-1?G.length:lc}}return 0}function cy(da){for(var Is=1,Ea=da+1;Ea<G.length;Ea++){var ko=Fe[Ea];if(ko&L)break;if(ko&ue){if(--Is===0)return Ea}else ko&a&&Is++}return-1}}var Te="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Ne;function be(){if(!Ne){var G=x(Te,!0),xe=G.map,Oe=G.reverseMap;Oe.forEach(function(Fe,ze){xe.set(ze,Fe)}),Ne=xe}}function De(G){return be(),Ne.get(G)||null}function ke(G,xe,Oe,Fe){var ze=G.length;Oe=Math.max(0,Oe==null?0:+Oe),Fe=Math.min(ze-1,Fe==null?ze-1:+Fe);for(var le=new Map,re=Oe;re<=Fe;re++)if(xe[re]&1){var me=De(G[re]);me!==null&&le.set(re,me)}return le}function Me(G,xe,Oe,Fe){var ze=G.length;Oe=Math.max(0,Oe==null?0:+Oe),Fe=Math.min(ze-1,Fe==null?ze-1:+Fe);var le=[];return xe.paragraphs.forEach(function(re){var me=Math.max(Oe,re.start),de=Math.min(Fe,re.end);if(me<de){for(var ve=xe.levels.slice(me,de+1),_e=de;_e>=me&&h(G[_e])&u;_e--)ve[_e]=re.level;for(var Be=re.level,He=1/0,pt=0;pt<ve.length;pt++){var gt=ve[pt];gt>Be&&(Be=gt),gt<He&&(He=gt|1)}for(var We=Be;We>=He;We--)for(var Je=0;Je<ve.length;Je++)if(ve[Je]>=We){for(var ot=Je;Je+1<ve.length&&ve[Je+1]>=We;)Je++;Je>ot&&le.push([ot+me,Je+me])}}}),le}function Ie(G,xe,Oe,Fe){var ze=ce(G,xe,Oe,Fe),le=[].concat(G);return ze.forEach(function(re,me){le[me]=(xe.levels[re]&1?De(G[re]):null)||G[re]}),le.join("")}function ce(G,xe,Oe,Fe){for(var ze=Me(G,xe,Oe,Fe),le=[],re=0;re<G.length;re++)le[re]=re;return ze.forEach(function(me){for(var de=me[0],ve=me[1],_e=le.slice(de,ve+1),Be=_e.length;Be--;)le[ve-Be]=_e[Be]}),le}return e.closingToOpeningBracket=M,e.getBidiCharType=h,e.getBidiCharTypeName=f,e.getCanonicalBracket=E,e.getEmbeddingLevels=oe,e.getMirroredCharacter=De,e.getMirroredCharactersMap=ke,e.getReorderSegments=Me,e.getReorderedIndices=ce,e.getReorderedString=Ie,e.openingToClosingBracket=S,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return t}const LZ=/\bvoid\s+main\s*\(\s*\)\s*{/g;function aI(t){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function n(r,i){let a=kn[i];return a?aI(a):r}return t.replace(e,n)}const va=[];for(let t=0;t<256;t++)va[t]=(t<16?"0":"")+t.toString(16);function Xbe(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(va[t&255]+va[t>>8&255]+va[t>>16&255]+va[t>>24&255]+"-"+va[e&255]+va[e>>8&255]+"-"+va[e>>16&15|64]+va[e>>24&255]+"-"+va[n&63|128]+va[n>>8&255]+"-"+va[n>>16&255]+va[n>>24&255]+va[r&255]+va[r>>8&255]+va[r>>16&255]+va[r>>24&255]).toUpperCase()}const ah=Object.assign||function(){let t=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let r=arguments[e];if(r)for(let i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},Kbe=Date.now(),CL=new WeakMap,ML=new Map;let Zbe=1e10;function sI(t,e){const n=t_e(e);let r=CL.get(t);if(r||CL.set(t,r=Object.create(null)),r[n])return new r[n];const i=`_onBeforeCompile${n}`,a=function(u,c){t.onBeforeCompile.call(this,u,c);const d=this.customProgramCacheKey()+"|"+u.vertexShader+"|"+u.fragmentShader;let h=ML[d];if(!h){const f=Jbe(this,u,e,n);h=ML[d]=f}u.vertexShader=h.vertexShader,u.fragmentShader=h.fragmentShader,ah(u.uniforms,this.uniforms),e.timeUniform&&(u.uniforms[e.timeUniform]={get value(){return Date.now()-Kbe}}),this[i]&&this[i](u)},s=function(){return o(e.chained?t:t.clone())},o=function(u){const c=Object.create(u,l);return Object.defineProperty(c,"baseMaterial",{value:t}),Object.defineProperty(c,"id",{value:Zbe++}),c.uuid=Xbe(),c.uniforms=ah({},u.uniforms,e.uniforms),c.defines=ah({},u.defines,e.defines),c.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",c.extensions=ah({},u.extensions,e.extensions),c._listeners=void 0,c},l={constructor:{value:s},isDerivedMaterial:{value:!0},type:{get:()=>t.type,set:u=>{t.type=u}},isDerivedFrom:{writable:!0,configurable:!0,value:function(u){const c=this.baseMaterial;return u===c||c.isDerivedMaterial&&c.isDerivedFrom(u)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return t.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get(){return a},set(u){this[i]=u}},copy:{writable:!0,configurable:!0,value:function(u){return t.copy.call(this,u),!t.isShaderMaterial&&!t.isDerivedMaterial&&(ah(this.extensions,u.extensions),ah(this.defines,u.defines),ah(this.uniforms,y1.clone(u.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const u=new t.constructor;return o(u).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let u=this._depthMaterial;return u||(u=this._depthMaterial=sI(t.isDerivedMaterial?t.getDepthMaterial():new q2({depthPacking:ZX}),e),u.defines.IS_DEPTH_MATERIAL="",u.uniforms=this.uniforms),u}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let u=this._distanceMaterial;return u||(u=this._distanceMaterial=sI(t.isDerivedMaterial?t.getDistanceMaterial():new G2,e),u.defines.IS_DISTANCE_MATERIAL="",u.uniforms=this.uniforms),u}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:u,_distanceMaterial:c}=this;u&&u.dispose(),c&&c.dispose(),t.dispose.call(this)}}};return r[n]=s,new s}function Jbe(t,{vertexShader:e,fragmentShader:n},r,i){let{vertexDefs:a,vertexMainIntro:s,vertexMainOutro:o,vertexTransform:l,fragmentDefs:u,fragmentMainIntro:c,fragmentMainOutro:d,fragmentColorTransform:h,customRewriter:f,timeUniform:m}=r;if(a=a||"",s=s||"",o=o||"",u=u||"",c=c||"",d=d||"",(l||f)&&(e=aI(e)),(h||f)&&(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),n=aI(n)),f){let x=f({vertexShader:e,fragmentShader:n});e=x.vertexShader,n=x.fragmentShader}if(h){let x=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,b=>(x.push(b),"")),d=`${h}
${x.join(`
`)}
${d}`}if(m){const x=`
uniform float ${m};
`;a=x+a,u=x+u}return l&&(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`,a=`${a}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,s=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${s}
`,e=e.replace(/\b(position|normal|uv)\b/g,(x,b,y,w)=>/\battribute\s+vec[23]\s+$/.test(w.substr(0,y))?b:`troika_${b}_${i}`),t.map&&t.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`))),e=AL(e,i,a,s,o),n=AL(n,i,u,c,d),{vertexShader:e,fragmentShader:n}}function AL(t,e,n,r,i){return(r||i||n)&&(t=t.replace(LZ,`
${n}
void troikaOrigMain${e}() {`),t+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${i}
}`),t}function Qbe(t,e){return t==="uniforms"?void 0:typeof e=="function"?e.toString():e}let e_e=0;const kL=new Map;function t_e(t){const e=JSON.stringify(t,Qbe);let n=kL.get(e);return n==null&&kL.set(e,n=++e_e),n}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function n_e(){return typeof window>"u"&&(self.window=self),(function(t){var e={parse:function(i){var a=e._bin,s=new Uint8Array(i);if(a.readASCII(s,0,4)=="ttcf"){var o=4;a.readUshort(s,o),o+=2,a.readUshort(s,o),o+=2;var l=a.readUint(s,o);o+=4;for(var u=[],c=0;c<l;c++){var d=a.readUint(s,o);o+=4,u.push(e._readFont(s,d))}return u}return[e._readFont(s,0)]},_readFont:function(i,a){var s=e._bin,o=a;s.readFixed(i,a),a+=4;var l=s.readUshort(i,a);a+=2,s.readUshort(i,a),a+=2,s.readUshort(i,a),a+=2,s.readUshort(i,a),a+=2;for(var u=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],c={_data:i,_offset:o},d={},h=0;h<l;h++){var f=s.readASCII(i,a,4);a+=4,s.readUint(i,a),a+=4;var m=s.readUint(i,a);a+=4;var x=s.readUint(i,a);a+=4,d[f]={offset:m,length:x}}for(h=0;h<u.length;h++){var b=u[h];d[b]&&(c[b.trim()]=e[b.trim()].parse(i,d[b].offset,d[b].length,c))}return c},_tabOffset:function(i,a,s){for(var o=e._bin,l=o.readUshort(i,s+4),u=s+12,c=0;c<l;c++){var d=o.readASCII(i,u,4);u+=4,o.readUint(i,u),u+=4;var h=o.readUint(i,u);if(u+=4,o.readUint(i,u),u+=4,d==a)return h}return 0}};e._bin={readFixed:function(i,a){return(i[a]<<8|i[a+1])+(i[a+2]<<8|i[a+3])/65540},readF2dot14:function(i,a){return e._bin.readShort(i,a)/16384},readInt:function(i,a){return e._bin._view(i).getInt32(a)},readInt8:function(i,a){return e._bin._view(i).getInt8(a)},readShort:function(i,a){return e._bin._view(i).getInt16(a)},readUshort:function(i,a){return e._bin._view(i).getUint16(a)},readUshorts:function(i,a,s){for(var o=[],l=0;l<s;l++)o.push(e._bin.readUshort(i,a+2*l));return o},readUint:function(i,a){return e._bin._view(i).getUint32(a)},readUint64:function(i,a){return 4294967296*e._bin.readUint(i,a)+e._bin.readUint(i,a+4)},readASCII:function(i,a,s){for(var o="",l=0;l<s;l++)o+=String.fromCharCode(i[a+l]);return o},readUnicode:function(i,a,s){for(var o="",l=0;l<s;l++){var u=i[a++]<<8|i[a++];o+=String.fromCharCode(u)}return o},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(i,a,s){var o=e._bin._tdec;return o&&a==0&&s==i.length?o.decode(i):e._bin.readASCII(i,a,s)},readBytes:function(i,a,s){for(var o=[],l=0;l<s;l++)o.push(i[a+l]);return o},readASCIIArray:function(i,a,s){for(var o=[],l=0;l<s;l++)o.push(String.fromCharCode(i[a+l]));return o},_view:function(i){return i._dataView||(i._dataView=i.buffer?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(new Uint8Array(i).buffer))}},e._lctf={},e._lctf.parse=function(i,a,s,o,l){var u=e._bin,c={},d=a;u.readFixed(i,a),a+=4;var h=u.readUshort(i,a);a+=2;var f=u.readUshort(i,a);a+=2;var m=u.readUshort(i,a);return a+=2,c.scriptList=e._lctf.readScriptList(i,d+h),c.featureList=e._lctf.readFeatureList(i,d+f),c.lookupList=e._lctf.readLookupList(i,d+m,l),c},e._lctf.readLookupList=function(i,a,s){var o=e._bin,l=a,u=[],c=o.readUshort(i,a);a+=2;for(var d=0;d<c;d++){var h=o.readUshort(i,a);a+=2;var f=e._lctf.readLookupTable(i,l+h,s);u.push(f)}return u},e._lctf.readLookupTable=function(i,a,s){var o=e._bin,l=a,u={tabs:[]};u.ltype=o.readUshort(i,a),a+=2,u.flag=o.readUshort(i,a),a+=2;var c=o.readUshort(i,a);a+=2;for(var d=u.ltype,h=0;h<c;h++){var f=o.readUshort(i,a);a+=2;var m=s(i,d,l+f,u);u.tabs.push(m)}return u},e._lctf.numOfOnes=function(i){for(var a=0,s=0;s<32;s++)(i>>>s&1)!=0&&a++;return a},e._lctf.readClassDef=function(i,a){var s=e._bin,o=[],l=s.readUshort(i,a);if(a+=2,l==1){var u=s.readUshort(i,a);a+=2;var c=s.readUshort(i,a);a+=2;for(var d=0;d<c;d++)o.push(u+d),o.push(u+d),o.push(s.readUshort(i,a)),a+=2}if(l==2){var h=s.readUshort(i,a);for(a+=2,d=0;d<h;d++)o.push(s.readUshort(i,a)),a+=2,o.push(s.readUshort(i,a)),a+=2,o.push(s.readUshort(i,a)),a+=2}return o},e._lctf.getInterval=function(i,a){for(var s=0;s<i.length;s+=3){var o=i[s],l=i[s+1];if(i[s+2],o<=a&&a<=l)return s}return-1},e._lctf.readCoverage=function(i,a){var s=e._bin,o={};o.fmt=s.readUshort(i,a),a+=2;var l=s.readUshort(i,a);return a+=2,o.fmt==1&&(o.tab=s.readUshorts(i,a,l)),o.fmt==2&&(o.tab=s.readUshorts(i,a,3*l)),o},e._lctf.coverageIndex=function(i,a){var s=i.tab;if(i.fmt==1)return s.indexOf(a);if(i.fmt==2){var o=e._lctf.getInterval(s,a);if(o!=-1)return s[o+2]+(a-s[o])}return-1},e._lctf.readFeatureList=function(i,a){var s=e._bin,o=a,l=[],u=s.readUshort(i,a);a+=2;for(var c=0;c<u;c++){var d=s.readASCII(i,a,4);a+=4;var h=s.readUshort(i,a);a+=2;var f=e._lctf.readFeatureTable(i,o+h);f.tag=d.trim(),l.push(f)}return l},e._lctf.readFeatureTable=function(i,a){var s=e._bin,o=a,l={},u=s.readUshort(i,a);a+=2,u>0&&(l.featureParams=o+u);var c=s.readUshort(i,a);a+=2,l.tab=[];for(var d=0;d<c;d++)l.tab.push(s.readUshort(i,a+2*d));return l},e._lctf.readScriptList=function(i,a){var s=e._bin,o=a,l={},u=s.readUshort(i,a);a+=2;for(var c=0;c<u;c++){var d=s.readASCII(i,a,4);a+=4;var h=s.readUshort(i,a);a+=2,l[d.trim()]=e._lctf.readScriptTable(i,o+h)}return l},e._lctf.readScriptTable=function(i,a){var s=e._bin,o=a,l={},u=s.readUshort(i,a);a+=2,u>0&&(l.default=e._lctf.readLangSysTable(i,o+u));var c=s.readUshort(i,a);a+=2;for(var d=0;d<c;d++){var h=s.readASCII(i,a,4);a+=4;var f=s.readUshort(i,a);a+=2,l[h.trim()]=e._lctf.readLangSysTable(i,o+f)}return l},e._lctf.readLangSysTable=function(i,a){var s=e._bin,o={};s.readUshort(i,a),a+=2,o.reqFeature=s.readUshort(i,a),a+=2;var l=s.readUshort(i,a);return a+=2,o.features=s.readUshorts(i,a,l),o},e.CFF={},e.CFF.parse=function(i,a,s){var o=e._bin;(i=new Uint8Array(i.buffer,a,s))[a=0],i[++a],i[++a],i[++a],a++;var l=[];a=e.CFF.readIndex(i,a,l);for(var u=[],c=0;c<l.length-1;c++)u.push(o.readASCII(i,a+l[c],l[c+1]-l[c]));a+=l[l.length-1];var d=[];a=e.CFF.readIndex(i,a,d);var h=[];for(c=0;c<d.length-1;c++)h.push(e.CFF.readDict(i,a+d[c],a+d[c+1]));a+=d[d.length-1];var f=h[0],m=[];a=e.CFF.readIndex(i,a,m);var x=[];for(c=0;c<m.length-1;c++)x.push(o.readASCII(i,a+m[c],m[c+1]-m[c]));if(a+=m[m.length-1],e.CFF.readSubrs(i,a,f),f.CharStrings){a=f.CharStrings,m=[],a=e.CFF.readIndex(i,a,m);var b=[];for(c=0;c<m.length-1;c++)b.push(o.readBytes(i,a+m[c],m[c+1]-m[c]));f.CharStrings=b}if(f.ROS){a=f.FDArray;var y=[];for(a=e.CFF.readIndex(i,a,y),f.FDArray=[],c=0;c<y.length-1;c++){var w=e.CFF.readDict(i,a+y[c],a+y[c+1]);e.CFF._readFDict(i,w,x),f.FDArray.push(w)}a+=y[y.length-1],a=f.FDSelect,f.FDSelect=[];var _=i[a];if(a++,_!=3)throw _;var S=o.readUshort(i,a);for(a+=2,c=0;c<S+1;c++)f.FDSelect.push(o.readUshort(i,a),i[a+2]),a+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(i,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(i,f.charset,f.CharStrings.length)),e.CFF._readFDict(i,f,x),f},e.CFF._readFDict=function(i,a,s){var o;for(var l in a.Private&&(o=a.Private[1],a.Private=e.CFF.readDict(i,o,o+a.Private[0]),a.Private.Subrs&&e.CFF.readSubrs(i,o+a.Private.Subrs,a.Private)),a)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(a[l]=s[a[l]-426+35])},e.CFF.readSubrs=function(i,a,s){var o=e._bin,l=[];a=e.CFF.readIndex(i,a,l);var u,c=l.length;u=c<1240?107:c<33900?1131:32768,s.Bias=u,s.Subrs=[];for(var d=0;d<l.length-1;d++)s.Subrs.push(o.readBytes(i,a+l[d],l[d+1]-l[d]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(i,a){for(var s=0;s<i.charset.length;s++)if(i.charset[s]==a)return s;return-1},e.CFF.glyphBySE=function(i,a){return a<0||a>255?-1:e.CFF.glyphByUnicode(i,e.CFF.tableSE[a])},e.CFF.readEncoding=function(i,a,s){e._bin;var o=[".notdef"],l=i[a];if(a++,l!=0)throw"error: unknown encoding format: "+l;var u=i[a];a++;for(var c=0;c<u;c++)o.push(i[a+c]);return o},e.CFF.readCharset=function(i,a,s){var o=e._bin,l=[".notdef"],u=i[a];if(a++,u==0)for(var c=0;c<s;c++){var d=o.readUshort(i,a);a+=2,l.push(d)}else{if(u!=1&&u!=2)throw"error: format: "+u;for(;l.length<s;){d=o.readUshort(i,a),a+=2;var h=0;for(u==1?(h=i[a],a++):(h=o.readUshort(i,a),a+=2),c=0;c<=h;c++)l.push(d),d++}}return l},e.CFF.readIndex=function(i,a,s){var o=e._bin,l=o.readUshort(i,a)+1,u=i[a+=2];if(a++,u==1)for(var c=0;c<l;c++)s.push(i[a+c]);else if(u==2)for(c=0;c<l;c++)s.push(o.readUshort(i,a+2*c));else if(u==3)for(c=0;c<l;c++)s.push(16777215&o.readUint(i,a+3*c-1));else if(l!=1)throw"unsupported offset size: "+u+", count: "+l;return(a+=l*u)-1},e.CFF.getCharString=function(i,a,s){var o=e._bin,l=i[a],u=i[a+1];i[a+2],i[a+3],i[a+4];var c=1,d=null,h=null;l<=20&&(d=l,c=1),l==12&&(d=100*l+u,c=2),21<=l&&l<=27&&(d=l,c=1),l==28&&(h=o.readShort(i,a+1),c=3),29<=l&&l<=31&&(d=l,c=1),32<=l&&l<=246&&(h=l-139,c=1),247<=l&&l<=250&&(h=256*(l-247)+u+108,c=2),251<=l&&l<=254&&(h=256*-(l-251)-u-108,c=2),l==255&&(h=o.readInt(i,a+1)/65535,c=5),s.val=h??"o"+d,s.size=c},e.CFF.readCharString=function(i,a,s){for(var o=a+s,l=e._bin,u=[];a<o;){var c=i[a],d=i[a+1];i[a+2],i[a+3],i[a+4];var h=1,f=null,m=null;c<=20&&(f=c,h=1),c==12&&(f=100*c+d,h=2),c!=19&&c!=20||(f=c,h=2),21<=c&&c<=27&&(f=c,h=1),c==28&&(m=l.readShort(i,a+1),h=3),29<=c&&c<=31&&(f=c,h=1),32<=c&&c<=246&&(m=c-139,h=1),247<=c&&c<=250&&(m=256*(c-247)+d+108,h=2),251<=c&&c<=254&&(m=256*-(c-251)-d-108,h=2),c==255&&(m=l.readInt(i,a+1)/65535,h=5),u.push(m??"o"+f),a+=h}return u},e.CFF.readDict=function(i,a,s){for(var o=e._bin,l={},u=[];a<s;){var c=i[a],d=i[a+1];i[a+2],i[a+3],i[a+4];var h=1,f=null,m=null;if(c==28&&(m=o.readShort(i,a+1),h=3),c==29&&(m=o.readInt(i,a+1),h=5),32<=c&&c<=246&&(m=c-139,h=1),247<=c&&c<=250&&(m=256*(c-247)+d+108,h=2),251<=c&&c<=254&&(m=256*-(c-251)-d-108,h=2),c==255)throw m=o.readInt(i,a+1)/65535,h=5,"unknown number";if(c==30){var x=[];for(h=1;;){var b=i[a+h];h++;var y=b>>4,w=15&b;if(y!=15&&x.push(y),w!=15&&x.push(w),w==15)break}for(var _="",S=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],M=0;M<x.length;M++)_+=S[x[M]];m=parseFloat(_)}c<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][c],h=1,c==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][d],h=2)),f!=null?(l[f]=u.length==1?u[0]:u,u=[]):u.push(m),a+=h}return l},e.cmap={},e.cmap.parse=function(i,a,s){i=new Uint8Array(i.buffer,a,s),a=0;var o=e._bin,l={};o.readUshort(i,a),a+=2;var u=o.readUshort(i,a);a+=2;var c=[];l.tables=[];for(var d=0;d<u;d++){var h=o.readUshort(i,a);a+=2;var f=o.readUshort(i,a);a+=2;var m=o.readUint(i,a);a+=4;var x="p"+h+"e"+f,b=c.indexOf(m);if(b==-1){var y;b=l.tables.length,c.push(m);var w=o.readUshort(i,m);w==0?y=e.cmap.parse0(i,m):w==4?y=e.cmap.parse4(i,m):w==6?y=e.cmap.parse6(i,m):w==12?y=e.cmap.parse12(i,m):console.debug("unknown format: "+w,h,f,m),l.tables.push(y)}if(l[x]!=null)throw"multiple tables for one platform+encoding";l[x]=b}return l},e.cmap.parse0=function(i,a){var s=e._bin,o={};o.format=s.readUshort(i,a),a+=2;var l=s.readUshort(i,a);a+=2,s.readUshort(i,a),a+=2,o.map=[];for(var u=0;u<l-6;u++)o.map.push(i[a+u]);return o},e.cmap.parse4=function(i,a){var s=e._bin,o=a,l={};l.format=s.readUshort(i,a),a+=2;var u=s.readUshort(i,a);a+=2,s.readUshort(i,a),a+=2;var c=s.readUshort(i,a);a+=2;var d=c/2;l.searchRange=s.readUshort(i,a),a+=2,l.entrySelector=s.readUshort(i,a),a+=2,l.rangeShift=s.readUshort(i,a),a+=2,l.endCount=s.readUshorts(i,a,d),a+=2*d,a+=2,l.startCount=s.readUshorts(i,a,d),a+=2*d,l.idDelta=[];for(var h=0;h<d;h++)l.idDelta.push(s.readShort(i,a)),a+=2;for(l.idRangeOffset=s.readUshorts(i,a,d),a+=2*d,l.glyphIdArray=[];a<o+u;)l.glyphIdArray.push(s.readUshort(i,a)),a+=2;return l},e.cmap.parse6=function(i,a){var s=e._bin,o={};o.format=s.readUshort(i,a),a+=2,s.readUshort(i,a),a+=2,s.readUshort(i,a),a+=2,o.firstCode=s.readUshort(i,a),a+=2;var l=s.readUshort(i,a);a+=2,o.glyphIdArray=[];for(var u=0;u<l;u++)o.glyphIdArray.push(s.readUshort(i,a)),a+=2;return o},e.cmap.parse12=function(i,a){var s=e._bin,o={};o.format=s.readUshort(i,a),a+=2,a+=2,s.readUint(i,a),a+=4,s.readUint(i,a),a+=4;var l=s.readUint(i,a);a+=4,o.groups=[];for(var u=0;u<l;u++){var c=a+12*u,d=s.readUint(i,c+0),h=s.readUint(i,c+4),f=s.readUint(i,c+8);o.groups.push([d,h,f])}return o},e.glyf={},e.glyf.parse=function(i,a,s,o){for(var l=[],u=0;u<o.maxp.numGlyphs;u++)l.push(null);return l},e.glyf._parseGlyf=function(i,a){var s=e._bin,o=i._data,l=e._tabOffset(o,"glyf",i._offset)+i.loca[a];if(i.loca[a]==i.loca[a+1])return null;var u={};if(u.noc=s.readShort(o,l),l+=2,u.xMin=s.readShort(o,l),l+=2,u.yMin=s.readShort(o,l),l+=2,u.xMax=s.readShort(o,l),l+=2,u.yMax=s.readShort(o,l),l+=2,u.xMin>=u.xMax||u.yMin>=u.yMax)return null;if(u.noc>0){u.endPts=[];for(var c=0;c<u.noc;c++)u.endPts.push(s.readUshort(o,l)),l+=2;var d=s.readUshort(o,l);if(l+=2,o.length-l<d)return null;u.instructions=s.readBytes(o,l,d),l+=d;var h=u.endPts[u.noc-1]+1;for(u.flags=[],c=0;c<h;c++){var f=o[l];if(l++,u.flags.push(f),(8&f)!=0){var m=o[l];l++;for(var x=0;x<m;x++)u.flags.push(f),c++}}for(u.xs=[],c=0;c<h;c++){var b=(2&u.flags[c])!=0,y=(16&u.flags[c])!=0;b?(u.xs.push(y?o[l]:-o[l]),l++):y?u.xs.push(0):(u.xs.push(s.readShort(o,l)),l+=2)}for(u.ys=[],c=0;c<h;c++)b=(4&u.flags[c])!=0,y=(32&u.flags[c])!=0,b?(u.ys.push(y?o[l]:-o[l]),l++):y?u.ys.push(0):(u.ys.push(s.readShort(o,l)),l+=2);var w=0,_=0;for(c=0;c<h;c++)w+=u.xs[c],_+=u.ys[c],u.xs[c]=w,u.ys[c]=_}else{var S;u.parts=[];do{S=s.readUshort(o,l),l+=2;var M={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(u.parts.push(M),M.glyphIndex=s.readUshort(o,l),l+=2,1&S){var E=s.readShort(o,l);l+=2;var C=s.readShort(o,l);l+=2}else E=s.readInt8(o,l),l++,C=s.readInt8(o,l),l++;2&S?(M.m.tx=E,M.m.ty=C):(M.p1=E,M.p2=C),8&S?(M.m.a=M.m.d=s.readF2dot14(o,l),l+=2):64&S?(M.m.a=s.readF2dot14(o,l),l+=2,M.m.d=s.readF2dot14(o,l),l+=2):128&S&&(M.m.a=s.readF2dot14(o,l),l+=2,M.m.b=s.readF2dot14(o,l),l+=2,M.m.c=s.readF2dot14(o,l),l+=2,M.m.d=s.readF2dot14(o,l),l+=2)}while(32&S);if(256&S){var R=s.readUshort(o,l);for(l+=2,u.instr=[],c=0;c<R;c++)u.instr.push(o[l]),l++}}return u},e.GDEF={},e.GDEF.parse=function(i,a,s,o){var l=a;a+=4;var u=e._bin.readUshort(i,a);return{glyphClassDef:u===0?null:e._lctf.readClassDef(i,l+u)}},e.GPOS={},e.GPOS.parse=function(i,a,s,o){return e._lctf.parse(i,a,s,o,e.GPOS.subt)},e.GPOS.subt=function(i,a,s,o){var l=e._bin,u=s,c={};if(c.fmt=l.readUshort(i,s),s+=2,a==1||a==2||a==3||a==7||a==8&&c.fmt<=2){var d=l.readUshort(i,s);s+=2,c.coverage=e._lctf.readCoverage(i,d+u)}if(a==1&&c.fmt==1){var h=l.readUshort(i,s);s+=2,h!=0&&(c.pos=e.GPOS.readValueRecord(i,s,h))}else if(a==2&&c.fmt>=1&&c.fmt<=2){h=l.readUshort(i,s),s+=2;var f=l.readUshort(i,s);s+=2;var m=e._lctf.numOfOnes(h),x=e._lctf.numOfOnes(f);if(c.fmt==1){c.pairsets=[];var b=l.readUshort(i,s);s+=2;for(var y=0;y<b;y++){var w=u+l.readUshort(i,s);s+=2;var _=l.readUshort(i,w);w+=2;for(var S=[],M=0;M<_;M++){var E=l.readUshort(i,w);w+=2,h!=0&&(D=e.GPOS.readValueRecord(i,w,h),w+=2*m),f!=0&&(F=e.GPOS.readValueRecord(i,w,f),w+=2*x),S.push({gid2:E,val1:D,val2:F})}c.pairsets.push(S)}}if(c.fmt==2){var C=l.readUshort(i,s);s+=2;var R=l.readUshort(i,s);s+=2;var k=l.readUshort(i,s);s+=2;var I=l.readUshort(i,s);for(s+=2,c.classDef1=e._lctf.readClassDef(i,u+C),c.classDef2=e._lctf.readClassDef(i,u+R),c.matrix=[],y=0;y<k;y++){var N=[];for(M=0;M<I;M++){var D=null,F=null;h!=0&&(D=e.GPOS.readValueRecord(i,s,h),s+=2*m),f!=0&&(F=e.GPOS.readValueRecord(i,s,f),s+=2*x),N.push({val1:D,val2:F})}c.matrix.push(N)}}}else if(a==4&&c.fmt==1)c.markCoverage=e._lctf.readCoverage(i,l.readUshort(i,s)+u),c.baseCoverage=e._lctf.readCoverage(i,l.readUshort(i,s+2)+u),c.markClassCount=l.readUshort(i,s+4),c.markArray=e.GPOS.readMarkArray(i,l.readUshort(i,s+6)+u),c.baseArray=e.GPOS.readBaseArray(i,l.readUshort(i,s+8)+u,c.markClassCount);else if(a==6&&c.fmt==1)c.mark1Coverage=e._lctf.readCoverage(i,l.readUshort(i,s)+u),c.mark2Coverage=e._lctf.readCoverage(i,l.readUshort(i,s+2)+u),c.markClassCount=l.readUshort(i,s+4),c.mark1Array=e.GPOS.readMarkArray(i,l.readUshort(i,s+6)+u),c.mark2Array=e.GPOS.readBaseArray(i,l.readUshort(i,s+8)+u,c.markClassCount);else{if(a==9&&c.fmt==1){var L=l.readUshort(i,s);s+=2;var U=l.readUint(i,s);if(s+=4,o.ltype==9)o.ltype=L;else if(o.ltype!=L)throw"invalid extension substitution";return e.GPOS.subt(i,o.ltype,u+U)}console.debug("unsupported GPOS table LookupType",a,"format",c.fmt)}return c},e.GPOS.readValueRecord=function(i,a,s){var o=e._bin,l=[];return l.push(1&s?o.readShort(i,a):0),a+=1&s?2:0,l.push(2&s?o.readShort(i,a):0),a+=2&s?2:0,l.push(4&s?o.readShort(i,a):0),a+=4&s?2:0,l.push(8&s?o.readShort(i,a):0),a+=8&s?2:0,l},e.GPOS.readBaseArray=function(i,a,s){var o=e._bin,l=[],u=a,c=o.readUshort(i,a);a+=2;for(var d=0;d<c;d++){for(var h=[],f=0;f<s;f++)h.push(e.GPOS.readAnchorRecord(i,u+o.readUshort(i,a))),a+=2;l.push(h)}return l},e.GPOS.readMarkArray=function(i,a){var s=e._bin,o=[],l=a,u=s.readUshort(i,a);a+=2;for(var c=0;c<u;c++){var d=e.GPOS.readAnchorRecord(i,s.readUshort(i,a+2)+l);d.markClass=s.readUshort(i,a),o.push(d),a+=4}return o},e.GPOS.readAnchorRecord=function(i,a){var s=e._bin,o={};return o.fmt=s.readUshort(i,a),o.x=s.readShort(i,a+2),o.y=s.readShort(i,a+4),o},e.GSUB={},e.GSUB.parse=function(i,a,s,o){return e._lctf.parse(i,a,s,o,e.GSUB.subt)},e.GSUB.subt=function(i,a,s,o){var l=e._bin,u=s,c={};if(c.fmt=l.readUshort(i,s),s+=2,a!=1&&a!=2&&a!=4&&a!=5&&a!=6)return null;if(a==1||a==2||a==4||a==5&&c.fmt<=2||a==6&&c.fmt<=2){var d=l.readUshort(i,s);s+=2,c.coverage=e._lctf.readCoverage(i,u+d)}if(a==1&&c.fmt>=1&&c.fmt<=2){if(c.fmt==1)c.delta=l.readShort(i,s),s+=2;else if(c.fmt==2){var h=l.readUshort(i,s);s+=2,c.newg=l.readUshorts(i,s,h),s+=2*c.newg.length}}else if(a==2&&c.fmt==1){h=l.readUshort(i,s),s+=2,c.seqs=[];for(var f=0;f<h;f++){var m=l.readUshort(i,s)+u;s+=2;var x=l.readUshort(i,m);c.seqs.push(l.readUshorts(i,m+2,x))}}else if(a==4)for(c.vals=[],h=l.readUshort(i,s),s+=2,f=0;f<h;f++){var b=l.readUshort(i,s);s+=2,c.vals.push(e.GSUB.readLigatureSet(i,u+b))}else if(a==5&&c.fmt==2){if(c.fmt==2){var y=l.readUshort(i,s);s+=2,c.cDef=e._lctf.readClassDef(i,u+y),c.scset=[];var w=l.readUshort(i,s);for(s+=2,f=0;f<w;f++){var _=l.readUshort(i,s);s+=2,c.scset.push(_==0?null:e.GSUB.readSubClassSet(i,u+_))}}}else if(a==6&&c.fmt==3){if(c.fmt==3){for(f=0;f<3;f++){h=l.readUshort(i,s),s+=2;for(var S=[],M=0;M<h;M++)S.push(e._lctf.readCoverage(i,u+l.readUshort(i,s+2*M)));s+=2*h,f==0&&(c.backCvg=S),f==1&&(c.inptCvg=S),f==2&&(c.ahedCvg=S)}h=l.readUshort(i,s),s+=2,c.lookupRec=e.GSUB.readSubstLookupRecords(i,s,h)}}else{if(a==7&&c.fmt==1){var E=l.readUshort(i,s);s+=2;var C=l.readUint(i,s);if(s+=4,o.ltype==9)o.ltype=E;else if(o.ltype!=E)throw"invalid extension substitution";return e.GSUB.subt(i,o.ltype,u+C)}console.debug("unsupported GSUB table LookupType",a,"format",c.fmt)}return c},e.GSUB.readSubClassSet=function(i,a){var s=e._bin.readUshort,o=a,l=[],u=s(i,a);a+=2;for(var c=0;c<u;c++){var d=s(i,a);a+=2,l.push(e.GSUB.readSubClassRule(i,o+d))}return l},e.GSUB.readSubClassRule=function(i,a){var s=e._bin.readUshort,o={},l=s(i,a),u=s(i,a+=2);a+=2,o.input=[];for(var c=0;c<l-1;c++)o.input.push(s(i,a)),a+=2;return o.substLookupRecords=e.GSUB.readSubstLookupRecords(i,a,u),o},e.GSUB.readSubstLookupRecords=function(i,a,s){for(var o=e._bin.readUshort,l=[],u=0;u<s;u++)l.push(o(i,a),o(i,a+2)),a+=4;return l},e.GSUB.readChainSubClassSet=function(i,a){var s=e._bin,o=a,l=[],u=s.readUshort(i,a);a+=2;for(var c=0;c<u;c++){var d=s.readUshort(i,a);a+=2,l.push(e.GSUB.readChainSubClassRule(i,o+d))}return l},e.GSUB.readChainSubClassRule=function(i,a){for(var s=e._bin,o={},l=["backtrack","input","lookahead"],u=0;u<l.length;u++){var c=s.readUshort(i,a);a+=2,u==1&&c--,o[l[u]]=s.readUshorts(i,a,c),a+=2*o[l[u]].length}return c=s.readUshort(i,a),a+=2,o.subst=s.readUshorts(i,a,2*c),a+=2*o.subst.length,o},e.GSUB.readLigatureSet=function(i,a){var s=e._bin,o=a,l=[],u=s.readUshort(i,a);a+=2;for(var c=0;c<u;c++){var d=s.readUshort(i,a);a+=2,l.push(e.GSUB.readLigature(i,o+d))}return l},e.GSUB.readLigature=function(i,a){var s=e._bin,o={chain:[]};o.nglyph=s.readUshort(i,a),a+=2;var l=s.readUshort(i,a);a+=2;for(var u=0;u<l-1;u++)o.chain.push(s.readUshort(i,a)),a+=2;return o},e.head={},e.head.parse=function(i,a,s){var o=e._bin,l={};return o.readFixed(i,a),a+=4,l.fontRevision=o.readFixed(i,a),a+=4,o.readUint(i,a),a+=4,o.readUint(i,a),a+=4,l.flags=o.readUshort(i,a),a+=2,l.unitsPerEm=o.readUshort(i,a),a+=2,l.created=o.readUint64(i,a),a+=8,l.modified=o.readUint64(i,a),a+=8,l.xMin=o.readShort(i,a),a+=2,l.yMin=o.readShort(i,a),a+=2,l.xMax=o.readShort(i,a),a+=2,l.yMax=o.readShort(i,a),a+=2,l.macStyle=o.readUshort(i,a),a+=2,l.lowestRecPPEM=o.readUshort(i,a),a+=2,l.fontDirectionHint=o.readShort(i,a),a+=2,l.indexToLocFormat=o.readShort(i,a),a+=2,l.glyphDataFormat=o.readShort(i,a),a+=2,l},e.hhea={},e.hhea.parse=function(i,a,s){var o=e._bin,l={};return o.readFixed(i,a),a+=4,l.ascender=o.readShort(i,a),a+=2,l.descender=o.readShort(i,a),a+=2,l.lineGap=o.readShort(i,a),a+=2,l.advanceWidthMax=o.readUshort(i,a),a+=2,l.minLeftSideBearing=o.readShort(i,a),a+=2,l.minRightSideBearing=o.readShort(i,a),a+=2,l.xMaxExtent=o.readShort(i,a),a+=2,l.caretSlopeRise=o.readShort(i,a),a+=2,l.caretSlopeRun=o.readShort(i,a),a+=2,l.caretOffset=o.readShort(i,a),a+=2,a+=8,l.metricDataFormat=o.readShort(i,a),a+=2,l.numberOfHMetrics=o.readUshort(i,a),a+=2,l},e.hmtx={},e.hmtx.parse=function(i,a,s,o){for(var l=e._bin,u={aWidth:[],lsBearing:[]},c=0,d=0,h=0;h<o.maxp.numGlyphs;h++)h<o.hhea.numberOfHMetrics&&(c=l.readUshort(i,a),a+=2,d=l.readShort(i,a),a+=2),u.aWidth.push(c),u.lsBearing.push(d);return u},e.kern={},e.kern.parse=function(i,a,s,o){var l=e._bin,u=l.readUshort(i,a);if(a+=2,u==1)return e.kern.parseV1(i,a-2,s,o);var c=l.readUshort(i,a);a+=2;for(var d={glyph1:[],rval:[]},h=0;h<c;h++){a+=2,s=l.readUshort(i,a),a+=2;var f=l.readUshort(i,a);a+=2;var m=f>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;a=e.kern.readFormat0(i,a,d)}return d},e.kern.parseV1=function(i,a,s,o){var l=e._bin;l.readFixed(i,a),a+=4;var u=l.readUint(i,a);a+=4;for(var c={glyph1:[],rval:[]},d=0;d<u;d++){l.readUint(i,a),a+=4;var h=l.readUshort(i,a);a+=2,l.readUshort(i,a),a+=2;var f=h>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;a=e.kern.readFormat0(i,a,c)}return c},e.kern.readFormat0=function(i,a,s){var o=e._bin,l=-1,u=o.readUshort(i,a);a+=2,o.readUshort(i,a),a+=2,o.readUshort(i,a),a+=2,o.readUshort(i,a),a+=2;for(var c=0;c<u;c++){var d=o.readUshort(i,a);a+=2;var h=o.readUshort(i,a);a+=2;var f=o.readShort(i,a);a+=2,d!=l&&(s.glyph1.push(d),s.rval.push({glyph2:[],vals:[]}));var m=s.rval[s.rval.length-1];m.glyph2.push(h),m.vals.push(f),l=d}return a},e.loca={},e.loca.parse=function(i,a,s,o){var l=e._bin,u=[],c=o.head.indexToLocFormat,d=o.maxp.numGlyphs+1;if(c==0)for(var h=0;h<d;h++)u.push(l.readUshort(i,a+(h<<1))<<1);if(c==1)for(h=0;h<d;h++)u.push(l.readUint(i,a+(h<<2)));return u},e.maxp={},e.maxp.parse=function(i,a,s){var o=e._bin,l={},u=o.readUint(i,a);return a+=4,l.numGlyphs=o.readUshort(i,a),a+=2,u==65536&&(l.maxPoints=o.readUshort(i,a),a+=2,l.maxContours=o.readUshort(i,a),a+=2,l.maxCompositePoints=o.readUshort(i,a),a+=2,l.maxCompositeContours=o.readUshort(i,a),a+=2,l.maxZones=o.readUshort(i,a),a+=2,l.maxTwilightPoints=o.readUshort(i,a),a+=2,l.maxStorage=o.readUshort(i,a),a+=2,l.maxFunctionDefs=o.readUshort(i,a),a+=2,l.maxInstructionDefs=o.readUshort(i,a),a+=2,l.maxStackElements=o.readUshort(i,a),a+=2,l.maxSizeOfInstructions=o.readUshort(i,a),a+=2,l.maxComponentElements=o.readUshort(i,a),a+=2,l.maxComponentDepth=o.readUshort(i,a),a+=2),l},e.name={},e.name.parse=function(i,a,s){var o=e._bin,l={};o.readUshort(i,a),a+=2;var u=o.readUshort(i,a);a+=2,o.readUshort(i,a);for(var c,d=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=a+=2,f=0;f<u;f++){var m=o.readUshort(i,a);a+=2;var x=o.readUshort(i,a);a+=2;var b=o.readUshort(i,a);a+=2;var y=o.readUshort(i,a);a+=2;var w=o.readUshort(i,a);a+=2;var _=o.readUshort(i,a);a+=2;var S,M=d[y],E=h+12*u+_;if(m==0)S=o.readUnicode(i,E,w/2);else if(m==3&&x==0)S=o.readUnicode(i,E,w/2);else if(x==0)S=o.readASCII(i,E,w);else if(x==1)S=o.readUnicode(i,E,w/2);else if(x==3)S=o.readUnicode(i,E,w/2);else{if(m!=1)throw"unknown encoding "+x+", platformID: "+m;S=o.readASCII(i,E,w),console.debug("reading unknown MAC encoding "+x+" as ASCII")}var C="p"+m+","+b.toString(16);l[C]==null&&(l[C]={}),l[C][M!==void 0?M:y]=S,l[C]._lang=b}for(var R in l)if(l[R].postScriptName!=null&&l[R]._lang==1033)return l[R];for(var R in l)if(l[R].postScriptName!=null&&l[R]._lang==0)return l[R];for(var R in l)if(l[R].postScriptName!=null&&l[R]._lang==3084)return l[R];for(var R in l)if(l[R].postScriptName!=null)return l[R];for(var R in l){c=R;break}return console.debug("returning name table with languageID "+l[c]._lang),l[c]},e["OS/2"]={},e["OS/2"].parse=function(i,a,s){var o=e._bin.readUshort(i,a);a+=2;var l={};if(o==0)e["OS/2"].version0(i,a,l);else if(o==1)e["OS/2"].version1(i,a,l);else if(o==2||o==3||o==4)e["OS/2"].version2(i,a,l);else{if(o!=5)throw"unknown OS/2 table version: "+o;e["OS/2"].version5(i,a,l)}return l},e["OS/2"].version0=function(i,a,s){var o=e._bin;return s.xAvgCharWidth=o.readShort(i,a),a+=2,s.usWeightClass=o.readUshort(i,a),a+=2,s.usWidthClass=o.readUshort(i,a),a+=2,s.fsType=o.readUshort(i,a),a+=2,s.ySubscriptXSize=o.readShort(i,a),a+=2,s.ySubscriptYSize=o.readShort(i,a),a+=2,s.ySubscriptXOffset=o.readShort(i,a),a+=2,s.ySubscriptYOffset=o.readShort(i,a),a+=2,s.ySuperscriptXSize=o.readShort(i,a),a+=2,s.ySuperscriptYSize=o.readShort(i,a),a+=2,s.ySuperscriptXOffset=o.readShort(i,a),a+=2,s.ySuperscriptYOffset=o.readShort(i,a),a+=2,s.yStrikeoutSize=o.readShort(i,a),a+=2,s.yStrikeoutPosition=o.readShort(i,a),a+=2,s.sFamilyClass=o.readShort(i,a),a+=2,s.panose=o.readBytes(i,a,10),a+=10,s.ulUnicodeRange1=o.readUint(i,a),a+=4,s.ulUnicodeRange2=o.readUint(i,a),a+=4,s.ulUnicodeRange3=o.readUint(i,a),a+=4,s.ulUnicodeRange4=o.readUint(i,a),a+=4,s.achVendID=[o.readInt8(i,a),o.readInt8(i,a+1),o.readInt8(i,a+2),o.readInt8(i,a+3)],a+=4,s.fsSelection=o.readUshort(i,a),a+=2,s.usFirstCharIndex=o.readUshort(i,a),a+=2,s.usLastCharIndex=o.readUshort(i,a),a+=2,s.sTypoAscender=o.readShort(i,a),a+=2,s.sTypoDescender=o.readShort(i,a),a+=2,s.sTypoLineGap=o.readShort(i,a),a+=2,s.usWinAscent=o.readUshort(i,a),a+=2,s.usWinDescent=o.readUshort(i,a),a+=2},e["OS/2"].version1=function(i,a,s){var o=e._bin;return a=e["OS/2"].version0(i,a,s),s.ulCodePageRange1=o.readUint(i,a),a+=4,s.ulCodePageRange2=o.readUint(i,a),a+=4},e["OS/2"].version2=function(i,a,s){var o=e._bin;return a=e["OS/2"].version1(i,a,s),s.sxHeight=o.readShort(i,a),a+=2,s.sCapHeight=o.readShort(i,a),a+=2,s.usDefault=o.readUshort(i,a),a+=2,s.usBreak=o.readUshort(i,a),a+=2,s.usMaxContext=o.readUshort(i,a),a+=2},e["OS/2"].version5=function(i,a,s){var o=e._bin;return a=e["OS/2"].version2(i,a,s),s.usLowerOpticalPointSize=o.readUshort(i,a),a+=2,s.usUpperOpticalPointSize=o.readUshort(i,a),a+=2},e.post={},e.post.parse=function(i,a,s){var o=e._bin,l={};return l.version=o.readFixed(i,a),a+=4,l.italicAngle=o.readFixed(i,a),a+=4,l.underlinePosition=o.readShort(i,a),a+=2,l.underlineThickness=o.readShort(i,a),a+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(i,a){var s=i.cmap,o=-1;if(s.p0e4!=null?o=s.p0e4:s.p3e1!=null?o=s.p3e1:s.p1e0!=null?o=s.p1e0:s.p0e3!=null&&(o=s.p0e3),o==-1)throw"no familiar platform and encoding!";var l=s.tables[o];if(l.format==0)return a>=l.map.length?0:l.map[a];if(l.format==4){for(var u=-1,c=0;c<l.endCount.length;c++)if(a<=l.endCount[c]){u=c;break}return u==-1||l.startCount[u]>a?0:65535&(l.idRangeOffset[u]!=0?l.glyphIdArray[a-l.startCount[u]+(l.idRangeOffset[u]>>1)-(l.idRangeOffset.length-u)]:a+l.idDelta[u])}if(l.format==12){if(a>l.groups[l.groups.length-1][1])return 0;for(c=0;c<l.groups.length;c++){var d=l.groups[c];if(d[0]<=a&&a<=d[1])return d[2]+(a-d[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(i,a){var s={cmds:[],crds:[]};if(i.SVG&&i.SVG.entries[a]){var o=i.SVG.entries[a];return o==null?s:(typeof o=="string"&&(o=e.SVG.toPath(o),i.SVG.entries[a]=o),o)}if(i.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:i.CFF.Private?i.CFF.Private.defaultWidthX:0,open:!1},u=i.CFF,c=i.CFF.Private;if(u.ROS){for(var d=0;u.FDSelect[d+2]<=a;)d+=2;c=u.FDArray[u.FDSelect[d+1]].Private}e.U._drawCFF(i.CFF.CharStrings[a],l,u,c,s)}else i.glyf&&e.U._drawGlyf(a,i,s);return s},e.U._drawGlyf=function(i,a,s){var o=a.glyf[i];o==null&&(o=a.glyf[i]=e.glyf._parseGlyf(a,i)),o!=null&&(o.noc>-1?e.U._simpleGlyph(o,s):e.U._compoGlyph(o,a,s))},e.U._simpleGlyph=function(i,a){for(var s=0;s<i.noc;s++){for(var o=s==0?0:i.endPts[s-1]+1,l=i.endPts[s],u=o;u<=l;u++){var c=u==o?l:u-1,d=u==l?o:u+1,h=1&i.flags[u],f=1&i.flags[c],m=1&i.flags[d],x=i.xs[u],b=i.ys[u];if(u==o)if(h){if(!f){e.U.P.moveTo(a,x,b);continue}e.U.P.moveTo(a,i.xs[c],i.ys[c])}else f?e.U.P.moveTo(a,i.xs[c],i.ys[c]):e.U.P.moveTo(a,(i.xs[c]+x)/2,(i.ys[c]+b)/2);h?f&&e.U.P.lineTo(a,x,b):m?e.U.P.qcurveTo(a,x,b,i.xs[d],i.ys[d]):e.U.P.qcurveTo(a,x,b,(x+i.xs[d])/2,(b+i.ys[d])/2)}e.U.P.closePath(a)}},e.U._compoGlyph=function(i,a,s){for(var o=0;o<i.parts.length;o++){var l={cmds:[],crds:[]},u=i.parts[o];e.U._drawGlyf(u.glyphIndex,a,l);for(var c=u.m,d=0;d<l.crds.length;d+=2){var h=l.crds[d],f=l.crds[d+1];s.crds.push(h*c.a+f*c.b+c.tx),s.crds.push(h*c.c+f*c.d+c.ty)}for(d=0;d<l.cmds.length;d++)s.cmds.push(l.cmds[d])}},e.U._getGlyphClass=function(i,a){var s=e._lctf.getInterval(a,i);return s==-1?0:a[s+2]},e.U._applySubs=function(i,a,s,o){for(var l=i.length-a-1,u=0;u<s.tabs.length;u++)if(s.tabs[u]!=null){var c,d=s.tabs[u];if(!d.coverage||(c=e._lctf.coverageIndex(d.coverage,i[a]))!=-1){if(s.ltype==1)i[a],d.fmt==1?i[a]=i[a]+d.delta:i[a]=d.newg[c];else if(s.ltype==4)for(var h=d.vals[c],f=0;f<h.length;f++){var m=h[f],x=m.chain.length;if(!(x>l)){for(var b=!0,y=0,w=0;w<x;w++){for(;i[a+y+(1+w)]==-1;)y++;m.chain[w]!=i[a+y+(1+w)]&&(b=!1)}if(b){for(i[a]=m.nglyph,w=0;w<x+y;w++)i[a+w+1]=-1;break}}}else if(s.ltype==5&&d.fmt==2)for(var _=e._lctf.getInterval(d.cDef,i[a]),S=d.cDef[_+2],M=d.scset[S],E=0;E<M.length;E++){var C=M[E],R=C.input;if(!(R.length>l)){for(b=!0,w=0;w<R.length;w++){var k=e._lctf.getInterval(d.cDef,i[a+1+w]);if(_==-1&&d.cDef[k+2]!=R[w]){b=!1;break}}if(b){var I=C.substLookupRecords;for(f=0;f<I.length;f+=2)I[f],I[f+1]}}}else if(s.ltype==6&&d.fmt==3){if(!e.U._glsCovered(i,d.backCvg,a-d.backCvg.length)||!e.U._glsCovered(i,d.inptCvg,a)||!e.U._glsCovered(i,d.ahedCvg,a+d.inptCvg.length))continue;var N=d.lookupRec;for(E=0;E<N.length;E+=2){_=N[E];var D=o[N[E+1]];e.U._applySubs(i,a+_,D,o)}}}}},e.U._glsCovered=function(i,a,s){for(var o=0;o<a.length;o++)if(e._lctf.coverageIndex(a[o],i[s+o])==-1)return!1;return!0},e.U.glyphsToPath=function(i,a,s){for(var o={cmds:[],crds:[]},l=0,u=0;u<a.length;u++){var c=a[u];if(c!=-1){for(var d=u<a.length-1&&a[u+1]!=-1?a[u+1]:0,h=e.U.glyphToPath(i,c),f=0;f<h.crds.length;f+=2)o.crds.push(h.crds[f]+l),o.crds.push(h.crds[f+1]);for(s&&o.cmds.push(s),f=0;f<h.cmds.length;f++)o.cmds.push(h.cmds[f]);s&&o.cmds.push("X"),l+=i.hmtx.aWidth[c],u<a.length-1&&(l+=e.U.getPairAdjustment(i,c,d))}}return o},e.U.P={},e.U.P.moveTo=function(i,a,s){i.cmds.push("M"),i.crds.push(a,s)},e.U.P.lineTo=function(i,a,s){i.cmds.push("L"),i.crds.push(a,s)},e.U.P.curveTo=function(i,a,s,o,l,u,c){i.cmds.push("C"),i.crds.push(a,s,o,l,u,c)},e.U.P.qcurveTo=function(i,a,s,o,l){i.cmds.push("Q"),i.crds.push(a,s,o,l)},e.U.P.closePath=function(i){i.cmds.push("Z")},e.U._drawCFF=function(i,a,s,o,l){for(var u=a.stack,c=a.nStems,d=a.haveWidth,h=a.width,f=a.open,m=0,x=a.x,b=a.y,y=0,w=0,_=0,S=0,M=0,E=0,C=0,R=0,k=0,I=0,N={val:0,size:0};m<i.length;){e.CFF.getCharString(i,m,N);var D=N.val;if(m+=N.size,D=="o1"||D=="o18")u.length%2!=0&&!d&&(h=u.shift()+o.nominalWidthX),c+=u.length>>1,u.length=0,d=!0;else if(D=="o3"||D=="o23")u.length%2!=0&&!d&&(h=u.shift()+o.nominalWidthX),c+=u.length>>1,u.length=0,d=!0;else if(D=="o4")u.length>1&&!d&&(h=u.shift()+o.nominalWidthX,d=!0),f&&e.U.P.closePath(l),b+=u.pop(),e.U.P.moveTo(l,x,b),f=!0;else if(D=="o5")for(;u.length>0;)x+=u.shift(),b+=u.shift(),e.U.P.lineTo(l,x,b);else if(D=="o6"||D=="o7")for(var F=u.length,L=D=="o6",U=0;U<F;U++){var j=u.shift();L?x+=j:b+=j,L=!L,e.U.P.lineTo(l,x,b)}else if(D=="o8"||D=="o24"){F=u.length;for(var q=0;q+6<=F;)y=x+u.shift(),w=b+u.shift(),_=y+u.shift(),S=w+u.shift(),x=_+u.shift(),b=S+u.shift(),e.U.P.curveTo(l,y,w,_,S,x,b),q+=6;D=="o24"&&(x+=u.shift(),b+=u.shift(),e.U.P.lineTo(l,x,b))}else{if(D=="o11")break;if(D=="o1234"||D=="o1235"||D=="o1236"||D=="o1237")D=="o1234"&&(w=b,_=(y=x+u.shift())+u.shift(),I=S=w+u.shift(),E=S,R=b,x=(C=(M=(k=_+u.shift())+u.shift())+u.shift())+u.shift(),e.U.P.curveTo(l,y,w,_,S,k,I),e.U.P.curveTo(l,M,E,C,R,x,b)),D=="o1235"&&(y=x+u.shift(),w=b+u.shift(),_=y+u.shift(),S=w+u.shift(),k=_+u.shift(),I=S+u.shift(),M=k+u.shift(),E=I+u.shift(),C=M+u.shift(),R=E+u.shift(),x=C+u.shift(),b=R+u.shift(),u.shift(),e.U.P.curveTo(l,y,w,_,S,k,I),e.U.P.curveTo(l,M,E,C,R,x,b)),D=="o1236"&&(y=x+u.shift(),w=b+u.shift(),_=y+u.shift(),I=S=w+u.shift(),E=S,C=(M=(k=_+u.shift())+u.shift())+u.shift(),R=E+u.shift(),x=C+u.shift(),e.U.P.curveTo(l,y,w,_,S,k,I),e.U.P.curveTo(l,M,E,C,R,x,b)),D=="o1237"&&(y=x+u.shift(),w=b+u.shift(),_=y+u.shift(),S=w+u.shift(),k=_+u.shift(),I=S+u.shift(),M=k+u.shift(),E=I+u.shift(),C=M+u.shift(),R=E+u.shift(),Math.abs(C-x)>Math.abs(R-b)?x=C+u.shift():b=R+u.shift(),e.U.P.curveTo(l,y,w,_,S,k,I),e.U.P.curveTo(l,M,E,C,R,x,b));else if(D=="o14"){if(u.length>0&&!d&&(h=u.shift()+s.nominalWidthX,d=!0),u.length==4){var Z=u.shift(),Q=u.shift(),z=u.shift(),W=u.shift(),X=e.CFF.glyphBySE(s,z),H=e.CFF.glyphBySE(s,W);e.U._drawCFF(s.CharStrings[X],a,s,o,l),a.x=Z,a.y=Q,e.U._drawCFF(s.CharStrings[H],a,s,o,l)}f&&(e.U.P.closePath(l),f=!1)}else if(D=="o19"||D=="o20")u.length%2!=0&&!d&&(h=u.shift()+o.nominalWidthX),c+=u.length>>1,u.length=0,d=!0,m+=c+7>>3;else if(D=="o21")u.length>2&&!d&&(h=u.shift()+o.nominalWidthX,d=!0),b+=u.pop(),x+=u.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,x,b),f=!0;else if(D=="o22")u.length>1&&!d&&(h=u.shift()+o.nominalWidthX,d=!0),x+=u.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,x,b),f=!0;else if(D=="o25"){for(;u.length>6;)x+=u.shift(),b+=u.shift(),e.U.P.lineTo(l,x,b);y=x+u.shift(),w=b+u.shift(),_=y+u.shift(),S=w+u.shift(),x=_+u.shift(),b=S+u.shift(),e.U.P.curveTo(l,y,w,_,S,x,b)}else if(D=="o26")for(u.length%2&&(x+=u.shift());u.length>0;)y=x,w=b+u.shift(),x=_=y+u.shift(),b=(S=w+u.shift())+u.shift(),e.U.P.curveTo(l,y,w,_,S,x,b);else if(D=="o27")for(u.length%2&&(b+=u.shift());u.length>0;)w=b,_=(y=x+u.shift())+u.shift(),S=w+u.shift(),x=_+u.shift(),b=S,e.U.P.curveTo(l,y,w,_,S,x,b);else if(D=="o10"||D=="o29"){var J=D=="o10"?o:s;if(u.length==0)console.debug("error: empty stack");else{var te=u.pop(),ee=J.Subrs[te+J.Bias];a.x=x,a.y=b,a.nStems=c,a.haveWidth=d,a.width=h,a.open=f,e.U._drawCFF(ee,a,s,o,l),x=a.x,b=a.y,c=a.nStems,d=a.haveWidth,h=a.width,f=a.open}}else if(D=="o30"||D=="o31"){var se=u.length,ue=(q=0,D=="o31");for(q+=se-(F=-3&se);q<F;)ue?(w=b,_=(y=x+u.shift())+u.shift(),b=(S=w+u.shift())+u.shift(),F-q==5?(x=_+u.shift(),q++):x=_,ue=!1):(y=x,w=b+u.shift(),_=y+u.shift(),S=w+u.shift(),x=_+u.shift(),F-q==5?(b=S+u.shift(),q++):b=S,ue=!0),e.U.P.curveTo(l,y,w,_,S,x,b),q+=4}else{if((D+"").charAt(0)=="o")throw console.debug("Unknown operation: "+D,i),D;u.push(D)}}}a.x=x,a.y=b,a.nStems=c,a.haveWidth=d,a.width=h,a.open=f};var n=e,r={Typr:n};return t.Typr=n,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t})({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function r_e(){return(function(t){var e=Uint8Array,n=Uint16Array,r=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(D,F){for(var L=new n(31),U=0;U<31;++U)L[U]=F+=1<<D[U-1];var j=new r(L[30]);for(U=1;U<30;++U)for(var q=L[U];q<L[U+1];++q)j[q]=q-L[U]<<5|U;return[L,j]},l=o(i,2),u=l[0],c=l[1];u[28]=258,c[258]=28;for(var d=o(a,0)[0],h=new n(32768),f=0;f<32768;++f){var m=(43690&f)>>>1|(21845&f)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,h[f]=((65280&m)>>>8|(255&m)<<8)>>>1}var x=function(D,F,L){for(var U=D.length,j=0,q=new n(F);j<U;++j)++q[D[j]-1];var Z,Q=new n(F);for(j=0;j<F;++j)Q[j]=Q[j-1]+q[j-1]<<1;{Z=new n(1<<F);var z=15-F;for(j=0;j<U;++j)if(D[j])for(var W=j<<4|D[j],X=F-D[j],H=Q[D[j]-1]++<<X,J=H|(1<<X)-1;H<=J;++H)Z[h[H]>>>z]=W}return Z},b=new e(288);for(f=0;f<144;++f)b[f]=8;for(f=144;f<256;++f)b[f]=9;for(f=256;f<280;++f)b[f]=7;for(f=280;f<288;++f)b[f]=8;var y=new e(32);for(f=0;f<32;++f)y[f]=5;var w=x(b,9),_=x(y,5),S=function(D){for(var F=D[0],L=1;L<D.length;++L)D[L]>F&&(F=D[L]);return F},M=function(D,F,L){var U=F/8|0;return(D[U]|D[U+1]<<8)>>(7&F)&L},E=function(D,F){var L=F/8|0;return(D[L]|D[L+1]<<8|D[L+2]<<16)>>(7&F)},C=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(D,F,L){var U=new Error(F||C[D]);if(U.code=D,Error.captureStackTrace&&Error.captureStackTrace(U,R),!L)throw U;return U},k=function(D,F,L){var U=D.length;if(!U||L&&!L.l&&U<5)return F||new e(0);var j=!F||L,q=!L||L.i;L||(L={}),F||(F=new e(3*U));var Z,Q=function(ot){var Ee=F.length;if(ot>Ee){var je=new e(Math.max(2*Ee,ot));je.set(F),F=je}},z=L.f||0,W=L.p||0,X=L.b||0,H=L.l,J=L.d,te=L.m,ee=L.n,se=8*U;do{if(!H){L.f=z=M(D,W,1);var ue=M(D,W+1,3);if(W+=3,!ue){var oe=D[(Oe=((Z=W)/8|0)+(7&Z&&1)+4)-4]|D[Oe-3]<<8,Te=Oe+oe;if(Te>U){q&&R(0);break}j&&Q(X+oe),F.set(D.subarray(Oe,Te),X),L.b=X+=oe,L.p=W=8*Te;continue}if(ue==1)H=w,J=_,te=9,ee=5;else if(ue==2){var Ne=M(D,W,31)+257,be=M(D,W+10,15)+4,De=Ne+M(D,W+5,31)+1;W+=14;for(var ke=new e(De),Me=new e(19),Ie=0;Ie<be;++Ie)Me[s[Ie]]=M(D,W+3*Ie,7);W+=3*be;var ce=S(Me),G=(1<<ce)-1,xe=x(Me,ce);for(Ie=0;Ie<De;){var Oe,Fe=xe[M(D,W,G)];if(W+=15&Fe,(Oe=Fe>>>4)<16)ke[Ie++]=Oe;else{var ze=0,le=0;for(Oe==16?(le=3+M(D,W,3),W+=2,ze=ke[Ie-1]):Oe==17?(le=3+M(D,W,7),W+=3):Oe==18&&(le=11+M(D,W,127),W+=7);le--;)ke[Ie++]=ze}}var re=ke.subarray(0,Ne),me=ke.subarray(Ne);te=S(re),ee=S(me),H=x(re,te),J=x(me,ee)}else R(1);if(W>se){q&&R(0);break}}j&&Q(X+131072);for(var de=(1<<te)-1,ve=(1<<ee)-1,_e=W;;_e=W){var Be=(ze=H[E(D,W)&de])>>>4;if((W+=15&ze)>se){q&&R(0);break}if(ze||R(2),Be<256)F[X++]=Be;else{if(Be==256){_e=W,H=null;break}var He=Be-254;if(Be>264){var pt=i[Ie=Be-257];He=M(D,W,(1<<pt)-1)+u[Ie],W+=pt}var gt=J[E(D,W)&ve],We=gt>>>4;if(gt||R(3),W+=15&gt,me=d[We],We>3&&(pt=a[We],me+=E(D,W)&(1<<pt)-1,W+=pt),W>se){q&&R(0);break}j&&Q(X+131072);for(var Je=X+He;X<Je;X+=4)F[X]=F[X-me],F[X+1]=F[X+1-me],F[X+2]=F[X+2-me],F[X+3]=F[X+3-me];X=Je}}L.l=H,L.p=_e,L.b=X,H&&(z=1,L.m=te,L.d=J,L.n=ee)}while(!z);return X==F.length?F:(function(ot,Ee,je){(je==null||je>ot.length)&&(je=ot.length);var mt=new(ot instanceof n?n:ot instanceof r?r:e)(je-Ee);return mt.set(ot.subarray(Ee,je)),mt})(F,0,X)},I=new e(0),N=typeof TextDecoder<"u"&&new TextDecoder;try{N.decode(I,{stream:!0})}catch{}return t.convert_streams=function(D){var F=new DataView(D),L=0;function U(){var Ne=F.getUint16(L);return L+=2,Ne}function j(){var Ne=F.getUint32(L);return L+=4,Ne}function q(Ne){oe.setUint16(Te,Ne),Te+=2}function Z(Ne){oe.setUint32(Te,Ne),Te+=4}for(var Q={signature:j(),flavor:j(),length:j(),numTables:U(),reserved:U(),totalSfntSize:j(),majorVersion:U(),minorVersion:U(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},z=0;Math.pow(2,z)<=Q.numTables;)z++;z--;for(var W=16*Math.pow(2,z),X=16*Q.numTables-W,H=12,J=[],te=0;te<Q.numTables;te++)J.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),H+=16;var ee,se=new Uint8Array(12+16*J.length+J.reduce((function(Ne,be){return Ne+be.origLength+4}),0)),ue=se.buffer,oe=new DataView(ue),Te=0;return Z(Q.flavor),q(Q.numTables),q(W),q(z),q(X),J.forEach((function(Ne){Z(Ne.tag),Z(Ne.origChecksum),Z(H),Z(Ne.origLength),Ne.outOffset=H,(H+=Ne.origLength)%4!=0&&(H+=4-H%4)})),J.forEach((function(Ne){var be,De=D.slice(Ne.offset,Ne.offset+Ne.compLength);if(Ne.compLength!=Ne.origLength){var ke=new Uint8Array(Ne.origLength);be=new Uint8Array(De,2),k(be,ke)}else ke=new Uint8Array(De);se.set(ke,Ne.outOffset);var Me=0;(H=Ne.outOffset+Ne.origLength)%4!=0&&(Me=4-H%4),se.set(new Uint8Array(Me).buffer,Ne.outOffset+Ne.origLength),ee=H+Me})),ue.slice(0,ee)},Object.defineProperty(t,"__esModule",{value:!0}),t})({}).convert_streams}function i_e(t,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=1,a=2,s=4,o=8,l=16,u=32;let c;function d(C){if(!c){const R={R:a,L:i,D:s,C:l,U:u,T:o};c=new Map;for(let k in r){let I=0;r[k].split(",").forEach(N=>{let[D,F]=N.split("+");D=parseInt(D,36),F=F?parseInt(F,36):0,c.set(I+=D,R[k]);for(let L=F;L--;)c.set(++I,R[k])})}}return c.get(C)||u}const h=1,f=2,m=3,x=4,b=[null,"isol","init","fina","medi"];function y(C){const R=new Uint8Array(C.length);let k=u,I=h,N=-1;for(let D=0;D<C.length;D++){const F=C.codePointAt(D);let L=d(F)|0,U=h;L&o||(k&(i|s|l)?L&(a|s|l)?(U=m,(I===h||I===m)&&R[N]++):L&(i|u)&&(I===f||I===x)&&R[N]--:k&(a|u)&&(I===f||I===x)&&R[N]--,I=R[D]=U,k=L,N=D,F>65535&&D++)}return R}function w(C,R){const k=[];for(let N=0;N<R.length;N++){const D=R.codePointAt(N);D>65535&&N++,k.push(t.U.codeToGlyph(C,D))}const I=C.GSUB;if(I){const{lookupList:N,featureList:D}=I;let F;const L=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,U=[];D.forEach(j=>{if(L.test(j.tag))for(let q=0;q<j.tab.length;q++){if(U[j.tab[q]])continue;U[j.tab[q]]=!0;const Z=N[j.tab[q]],Q=/^(isol|init|fina|medi)$/.test(j.tag);Q&&!F&&(F=y(R));for(let z=0;z<k.length;z++)(!F||!Q||b[F[z]]===j.tag)&&t.U._applySubs(k,z,Z,N)}})}return k}function _(C,R){const k=new Int16Array(R.length*3);let I=0;for(;I<R.length;I++){const L=R[I];if(L===-1)continue;k[I*3+2]=C.hmtx.aWidth[L];const U=C.GPOS;if(U){const j=U.lookupList;for(let q=0;q<j.length;q++){const Z=j[q];for(let Q=0;Q<Z.tabs.length;Q++){const z=Z.tabs[Q];if(Z.ltype===1){if(t._lctf.coverageIndex(z.coverage,L)!==-1&&z.pos){F(z.pos,I);break}}else if(Z.ltype===2){let W=null,X=N();if(X!==-1){const H=t._lctf.coverageIndex(z.coverage,R[X]);if(H!==-1){if(z.fmt===1){const J=z.pairsets[H];for(let te=0;te<J.length;te++)J[te].gid2===L&&(W=J[te])}else if(z.fmt===2){const J=t.U._getGlyphClass(R[X],z.classDef1),te=t.U._getGlyphClass(L,z.classDef2);W=z.matrix[J][te]}if(W){W.val1&&F(W.val1,X),W.val2&&F(W.val2,I);break}}}}else if(Z.ltype===4){const W=t._lctf.coverageIndex(z.markCoverage,L);if(W!==-1){const X=N(D),H=X===-1?-1:t._lctf.coverageIndex(z.baseCoverage,R[X]);if(H!==-1){const J=z.markArray[W],te=z.baseArray[H][J.markClass];k[I*3]=te.x-J.x+k[X*3]-k[X*3+2],k[I*3+1]=te.y-J.y+k[X*3+1];break}}}else if(Z.ltype===6){const W=t._lctf.coverageIndex(z.mark1Coverage,L);if(W!==-1){const X=N();if(X!==-1){const H=R[X];if(S(C,H)===3){const J=t._lctf.coverageIndex(z.mark2Coverage,H);if(J!==-1){const te=z.mark1Array[W],ee=z.mark2Array[J][te.markClass];k[I*3]=ee.x-te.x+k[X*3]-k[X*3+2],k[I*3+1]=ee.y-te.y+k[X*3+1];break}}}}}}}}else if(C.kern&&!C.cff){const j=N();if(j!==-1){const q=C.kern.glyph1.indexOf(R[j]);if(q!==-1){const Z=C.kern.rval[q].glyph2.indexOf(L);Z!==-1&&(k[j*3+2]+=C.kern.rval[q].vals[Z])}}}}return k;function N(L){for(let U=I-1;U>=0;U--)if(R[U]!==-1&&(!L||L(R[U])))return U;return-1}function D(L){return S(C,L)===1}function F(L,U){for(let j=0;j<3;j++)k[U*3+j]+=L[j]||0}}function S(C,R){const k=C.GDEF&&C.GDEF.glyphClassDef;return k?t.U._getGlyphClass(R,k):0}function M(...C){for(let R=0;R<C.length;R++)if(typeof C[R]=="number")return C[R]}function E(C){const R=Object.create(null),k=C["OS/2"],I=C.hhea,N=C.head.unitsPerEm,D=M(k&&k.sTypoAscender,I&&I.ascender,N),F={unitsPerEm:N,ascender:D,descender:M(k&&k.sTypoDescender,I&&I.descender,0),capHeight:M(k&&k.sCapHeight,D),xHeight:M(k&&k.sxHeight,D),lineGap:M(k&&k.sTypoLineGap,I&&I.lineGap),supportsCodePoint(L){return t.U.codeToGlyph(C,L)>0},forEachGlyph(L,U,j,q){let Z=0;const Q=1/F.unitsPerEm*U,z=w(C,L);let W=0;const X=_(C,z);return z.forEach((H,J)=>{if(H!==-1){let te=R[H];if(!te){const{cmds:ee,crds:se}=t.U.glyphToPath(C,H);let ue="",oe=0;for(let ke=0,Me=ee.length;ke<Me;ke++){const Ie=n[ee[ke]];ue+=ee[ke];for(let ce=1;ce<=Ie;ce++)ue+=(ce>1?",":"")+se[oe++]}let Te,Ne,be,De;if(se.length){Te=Ne=1/0,be=De=-1/0;for(let ke=0,Me=se.length;ke<Me;ke+=2){let Ie=se[ke],ce=se[ke+1];Ie<Te&&(Te=Ie),ce<Ne&&(Ne=ce),Ie>be&&(be=Ie),ce>De&&(De=ce)}}else Te=be=Ne=De=0;te=R[H]={index:H,advanceWidth:C.hmtx.aWidth[H],xMin:Te,yMin:Ne,xMax:be,yMax:De,path:ue}}q.call(null,te,Z+X[J*3]*Q,X[J*3+1]*Q,W),Z+=X[J*3+2]*Q,j&&(Z+=j*U)}W+=L.codePointAt(W)>65535?2:1}),Z}};return F}return function(R){const k=new Uint8Array(R,0,4),I=t._bin.readASCII(k,0,4);if(I==="wOFF")R=e(R);else if(I==="wOF2")throw new Error("woff2 fonts not supported");return E(t.parse(R)[0])}}const a_e=$0({name:"Typr Font Parser",dependencies:[n_e,r_e,i_e],init(t,e,n){const r=t(),i=e();return n(r,i)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function s_e(){return(function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(_){var S=_>>5;this.buckets.set(S,(this.buckets.get(S)||0)|1<<(31&_))},e.prototype.has=function(_){var S=this.buckets.get(_>>5);return S!==void 0&&(S&1<<(31&_))!=0},e.prototype.serialize=function(){var _=[];return this.buckets.forEach((function(S,M){_.push((+M).toString(36)+":"+S.toString(36))})),_.join(",")},e.prototype.deserialize=function(_){var S=this;this.buckets.clear(),_.split(",").forEach((function(M){var E=M.split(":");S.buckets.set(parseInt(E[0],36),parseInt(E[1],36))}))};var n=Math.pow(2,8),r=n-1,i=~r;function a(_){var S=(function(E){return E&i})(_).toString(16),M=(function(E){return(E&i)+n-1})(_).toString(16);return"codepoint-index/plane"+(_>>16)+"/"+S+"-"+M+".json"}function s(_,S){var M=_&r,E=S.codePointAt(M/6|0);return((E=(E||48)-48)&1<<M%6)!=0}function o(_,S){var M;(M=_,M.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(E){return E.split("-").map((function(C){return parseInt(C.trim(),16)}))}))).forEach((function(E){var C=E[0],R=E[1];R===void 0&&(R=C),S(C,R)}))}function l(_,S){o(_,(function(M,E){for(var C=M;C<=E;C++)S(C)}))}var u={},c={},d=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(_){var S=d.get(_);return S||(S=new e,l(_.ranges,(function(M){return S.add(M)})),d.set(_,S)),S}var m,x=new Map;function b(_,S,M){return _[S]?S:_[M]?M:(function(E){for(var C in E)return C})(_)}function y(_,S){var M=S;if(!_.includes(M)){M=1/0;for(var E=0;E<_.length;E++)Math.abs(_[E]-S)<Math.abs(M-S)&&(M=_[E])}return M}function w(_){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(S){m.add(S)}))),m.has(_)}return t.CodePointSet=e,t.clearCache=function(){u={},c={}},t.getFontsForString=function(_,S){S===void 0&&(S={});var M,E=S.lang;E===void 0&&(E=/\p{Script=Hangul}/u.test(M=_)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(M)?"ja":"en");var C=S.category;C===void 0&&(C="sans-serif");var R=S.style;R===void 0&&(R="normal");var k=S.weight;k===void 0&&(k=400);var I=(S.dataUrl||h).replace(/\/$/g,""),N=new Map,D=new Uint8Array(_.length),F={},L={},U=new Array(_.length),j=new Map,q=!1;function Z(W){var X=x.get(W);return X||(X=fetch(I+"/"+W).then((function(H){if(!H.ok)throw new Error(H.statusText);return H.json().then((function(J){if(!Array.isArray(J)||J[0]!==1)throw new Error("Incorrect schema version; need 1, got "+J[0]);return J[1]}))})).catch((function(H){if(I!==h)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+I+'", trying default CDN. '+H.message),q=!0),I=h,x.delete(W),Z(W);throw H})),x.set(W,X)),X}for(var Q=function(W){var X=_.codePointAt(W),H=a(X);U[W]=H,u[H]||j.has(H)||j.set(H,Z(H).then((function(J){u[H]=J}))),X>65535&&(W++,z=W)},z=0;z<_.length;z++)Q(z);return Promise.all(j.values()).then((function(){j.clear();for(var W=function(H){var J=_.codePointAt(H),te=null,ee=u[U[H]],se=void 0;for(var ue in ee){var oe=L[ue];if(oe===void 0&&(oe=L[ue]=new RegExp(ue).test(E||"en")),oe){for(var Te in se=ue,ee[ue])if(s(J,ee[ue][Te])){te=Te;break}break}}if(!te){e:for(var Ne in ee)if(Ne!==se){for(var be in ee[Ne])if(s(J,ee[Ne][be])){te=be;break e}}}te||(console.debug("No font coverage for U+"+J.toString(16)),te="latin"),U[H]=te,c[te]||j.has(te)||j.set(te,Z("font-meta/"+te+".json").then((function(De){c[te]=De}))),J>65535&&(H++,X=H)},X=0;X<_.length;X++)W(X);return Promise.all(j.values())})).then((function(){for(var W,X=null,H=0;H<_.length;H++){var J=_.codePointAt(H);if(X&&(w(J)||f(X).has(J)))D[H]=D[H-1];else{X=c[U[H]];var te=F[X.id];if(!te){var ee=X.typeforms,se=b(ee,C,"sans-serif"),ue=b(ee[se],R,"normal"),oe=y((W=ee[se])===null||W===void 0?void 0:W[ue],k);te=F[X.id]=I+"/font-files/"+X.id+"/"+se+"."+ue+"."+oe+".woff"}var Te=N.get(te);Te==null&&(Te=N.size,N.set(te,Te)),D[H]=Te}J>65535&&(H++,D[H]=D[H-1])}return{fontUrls:Array.from(N.keys()),chars:D}}))},Object.defineProperty(t,"__esModule",{value:!0}),t})({})}function o_e(t,e){const n=Object.create(null),r=Object.create(null);function i(s,o){const l=u=>{console.error(`Failure loading font ${s}`,u)};try{const u=new XMLHttpRequest;u.open("get",s,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status>=400)l(new Error(u.statusText));else if(u.status>0)try{const c=t(u.response);c.src=s,o(c)}catch(c){l(c)}},u.onerror=l,u.send()}catch(u){l(u)}}function a(s,o){let l=n[s];l?o(l):r[s]?r[s].push(o):(r[s]=[o],i(s,u=>{u.src=s,n[s]=u,r[s].forEach(c=>c(u)),delete r[s]}))}return function(s,o,{lang:l,fonts:u=[],style:c="normal",weight:d="normal",unicodeFontsURL:h}={}){const f=new Uint8Array(s.length),m=[];s.length||w();const x=new Map,b=[];if(c!=="italic"&&(c="normal"),typeof d!="number"&&(d=d==="bold"?700:400),u&&!Array.isArray(u)&&(u=[u]),u=u.slice().filter(S=>!S.lang||S.lang.test(l)).reverse(),u.length){let C=0;(function R(k=0){for(let I=k,N=s.length;I<N;I++){const D=s.codePointAt(I);if(C===1&&m[f[I-1]].supportsCodePoint(D)||I>0&&/\s/.test(s[I]))f[I]=f[I-1],C===2&&(b[b.length-1][1]=I);else for(let F=f[I],L=u.length;F<=L;F++)if(F===L){const U=C===2?b[b.length-1]:b[b.length]=[I,I];U[1]=I,C=2}else{f[I]=F;const{src:U,unicodeRange:j}=u[F];if(!j||_(D,j)){const q=n[U];if(!q){a(U,()=>{R(I)});return}if(q.supportsCodePoint(D)){let Z=x.get(q);typeof Z!="number"&&(Z=m.length,m.push(q),x.set(q,Z)),f[I]=Z,C=1;break}}}D>65535&&I+1<N&&(f[I+1]=f[I],I++,C===2&&(b[b.length-1][1]=I))}y()})()}else b.push([0,s.length-1]),y();function y(){if(b.length){const S=b.map(M=>s.substring(M[0],M[1]+1)).join(`
`);e.getFontsForString(S,{lang:l||void 0,style:c,weight:d,dataUrl:h}).then(({fontUrls:M,chars:E})=>{const C=m.length;let R=0;b.forEach(I=>{for(let N=0,D=I[1]-I[0];N<=D;N++)f[I[0]+N]=E[R++]+C;R++});let k=0;M.forEach((I,N)=>{a(I,D=>{m[N+C]=D,++k===M.length&&w()})})})}else w()}function w(){o({chars:f,fonts:m})}function _(S,M){for(let E=0;E<M.length;E++){const[C,R=C]=M[E];if(C<=S&&S<=R)return!0}return!1}}}const l_e=$0({name:"FontResolver",dependencies:[o_e,a_e,s_e],init(t,e,n){return t(e,n())}});function u_e(t,e){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",a=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function s({text:m,lang:x,fonts:b,style:y,weight:w,preResolvedFonts:_,unicodeFontsURL:S},M){const E=({chars:C,fonts:R})=>{let k,I;const N=[];for(let D=0;D<C.length;D++)C[D]!==I?(I=C[D],N.push(k={start:D,end:D,fontObj:R[C[D]]})):k.end=D;M(N)};_?E(_):t(m,E,{lang:x,fonts:b,style:y,weight:w,unicodeFontsURL:S})}function o({text:m="",font:x,lang:b,sdfGlyphSize:y=64,fontSize:w=400,fontWeight:_=1,fontStyle:S="normal",letterSpacing:M=0,lineHeight:E="normal",maxWidth:C=1/0,direction:R,textAlign:k="left",textIndent:I=0,whiteSpace:N="normal",overflowWrap:D="normal",anchorX:F=0,anchorY:L=0,metricsOnly:U=!1,unicodeFontsURL:j,preResolvedFonts:q=null,includeCaretPositions:Z=!1,chunkedBoundsSize:Q=8192,colorRanges:z=null},W){const X=d(),H={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,M=+M,C=+C,E=E||"normal",I=+I,s({text:m,lang:b,style:S,weight:_,fonts:typeof x=="string"?[{src:x}]:x,unicodeFontsURL:j,preResolvedFonts:q},J=>{H.fontLoad=d()-X;const te=isFinite(C);let ee=null,se=null,ue=null,oe=null,Te=null,Ne=null,be=null,De=null,ke=0,Me=0,Ie=N!=="nowrap";const ce=new Map,G=d();let xe=I,Oe=0,Fe=new h;const ze=[Fe];J.forEach(ve=>{const{fontObj:_e}=ve,{ascender:Be,descender:He,unitsPerEm:pt,lineGap:gt,capHeight:We,xHeight:Je}=_e;let ot=ce.get(_e);if(!ot){const $e=w/pt,Ge=E==="normal"?(Be-He+gt)*$e:E*w,st=(Ge-(Be-He)*$e)/2,Qe=Math.min(Ge,(Be-He)*$e),Ye=(Be+He)/2*$e+Qe/2;ot={index:ce.size,src:_e.src,fontObj:_e,fontSizeMult:$e,unitsPerEm:pt,ascender:Be*$e,descender:He*$e,capHeight:We*$e,xHeight:Je*$e,lineHeight:Ge,baseline:-st-Be*$e,caretTop:Ye,caretBottom:Ye-Qe},ce.set(_e,ot)}const{fontSizeMult:Ee}=ot,je=m.slice(ve.start,ve.end+1);let mt,fe;_e.forEachGlyph(je,w,M,($e,Ge,st,Qe)=>{Ge+=Oe,Qe+=ve.start,mt=Ge,fe=$e;const Ye=m.charAt(Qe),ft=$e.advanceWidth*Ee,Ct=Fe.count;let At;if("isEmpty"in $e||($e.isWhitespace=!!Ye&&new RegExp(i).test(Ye),$e.canBreakAfter=!!Ye&&a.test(Ye),$e.isEmpty=$e.xMin===$e.xMax||$e.yMin===$e.yMax||r.test(Ye)),!$e.isWhitespace&&!$e.isEmpty&&Me++,Ie&&te&&!$e.isWhitespace&&Ge+ft+xe>C&&Ct){if(Fe.glyphAt(Ct-1).glyphObj.canBreakAfter)At=new h,xe=-Ge;else for(let wn=Ct;wn--;)if(wn===0&&D==="break-word"){At=new h,xe=-Ge;break}else if(Fe.glyphAt(wn).glyphObj.canBreakAfter){At=Fe.splitAt(wn+1);const Vt=At.glyphAt(0).x;xe-=Vt;for(let En=At.count;En--;)At.glyphAt(En).x-=Vt;break}At&&(Fe.isSoftWrapped=!0,Fe=At,ze.push(Fe),ke=C)}let Ht=Fe.glyphAt(Fe.count);Ht.glyphObj=$e,Ht.x=Ge+xe,Ht.y=st,Ht.width=ft,Ht.charIndex=Qe,Ht.fontData=ot,Ye===`
`&&(Fe=new h,ze.push(Fe),xe=-(Ge+ft+M*w)+I)}),Oe=mt+fe.advanceWidth*Ee+M*w});let le=0;ze.forEach(ve=>{let _e=!0;for(let Be=ve.count;Be--;){const He=ve.glyphAt(Be);_e&&!He.glyphObj.isWhitespace&&(ve.width=He.x+He.width,ve.width>ke&&(ke=ve.width),_e=!1);let{lineHeight:pt,capHeight:gt,xHeight:We,baseline:Je}=He.fontData;pt>ve.lineHeight&&(ve.lineHeight=pt);const ot=Je-ve.baseline;ot<0&&(ve.baseline+=ot,ve.cap+=ot,ve.ex+=ot),ve.cap=Math.max(ve.cap,ve.baseline+gt),ve.ex=Math.max(ve.ex,ve.baseline+We)}ve.baseline-=le,ve.cap-=le,ve.ex-=le,le+=ve.lineHeight});let re=0,me=0;if(F&&(typeof F=="number"?re=-F:typeof F=="string"&&(re=-ke*(F==="left"?0:F==="center"?.5:F==="right"?1:u(F)))),L&&(typeof L=="number"?me=-L:typeof L=="string"&&(me=L==="top"?0:L==="top-baseline"?-ze[0].baseline:L==="top-cap"?-ze[0].cap:L==="top-ex"?-ze[0].ex:L==="middle"?le/2:L==="bottom"?le:L==="bottom-baseline"?-ze[ze.length-1].baseline:u(L)*le)),!U){const ve=e.getEmbeddingLevels(m,R);ee=new Uint16Array(Me),se=new Uint8Array(Me),ue=new Float32Array(Me*2),oe={},be=[1/0,1/0,-1/0,-1/0],De=[],Z&&(Ne=new Float32Array(m.length*4)),z&&(Te=new Uint8Array(Me*3));let _e=0,Be=-1,He=-1,pt,gt;if(ze.forEach((We,Je)=>{let{count:ot,width:Ee}=We;if(ot>0){let je=0;for(let Qe=ot;Qe--&&We.glyphAt(Qe).glyphObj.isWhitespace;)je++;let mt=0,fe=0;if(k==="center")mt=(ke-Ee)/2;else if(k==="right")mt=ke-Ee;else if(k==="justify"&&We.isSoftWrapped){let Qe=0;for(let Ye=ot-je;Ye--;)We.glyphAt(Ye).glyphObj.isWhitespace&&Qe++;fe=(ke-Ee)/Qe}if(fe||mt){let Qe=0;for(let Ye=0;Ye<ot;Ye++){let ft=We.glyphAt(Ye);const Ct=ft.glyphObj;ft.x+=mt+Qe,fe!==0&&Ct.isWhitespace&&Ye<ot-je&&(Qe+=fe,ft.width+=fe)}}const $e=e.getReorderSegments(m,ve,We.glyphAt(0).charIndex,We.glyphAt(We.count-1).charIndex);for(let Qe=0;Qe<$e.length;Qe++){const[Ye,ft]=$e[Qe];let Ct=1/0,At=-1/0;for(let Ht=0;Ht<ot;Ht++)if(We.glyphAt(Ht).charIndex>=Ye){let wn=Ht,Vt=Ht;for(;Vt<ot;Vt++){let En=We.glyphAt(Vt);if(En.charIndex>ft)break;Vt<ot-je&&(Ct=Math.min(Ct,En.x),At=Math.max(At,En.x+En.width))}for(let En=wn;En<Vt;En++){const kr=We.glyphAt(En);kr.x=At-(kr.x+kr.width-Ct)}break}}let Ge;const st=Qe=>Ge=Qe;for(let Qe=0;Qe<ot;Qe++){const Ye=We.glyphAt(Qe);Ge=Ye.glyphObj;const ft=Ge.index,Ct=ve.levels[Ye.charIndex]&1;if(Ct){const At=e.getMirroredCharacter(m[Ye.charIndex]);At&&Ye.fontData.fontObj.forEachGlyph(At,0,0,st)}if(Z){const{charIndex:At,fontData:Ht}=Ye,wn=Ye.x+re,Vt=Ye.x+Ye.width+re;Ne[At*4]=Ct?Vt:wn,Ne[At*4+1]=Ct?wn:Vt,Ne[At*4+2]=We.baseline+Ht.caretBottom+me,Ne[At*4+3]=We.baseline+Ht.caretTop+me;const En=At-Be;En>1&&c(Ne,Be,En),Be=At}if(z){const{charIndex:At}=Ye;for(;At>He;)He++,z.hasOwnProperty(He)&&(gt=z[He])}if(!Ge.isWhitespace&&!Ge.isEmpty){const At=_e++,{fontSizeMult:Ht,src:wn,index:Vt}=Ye.fontData,En=oe[wn]||(oe[wn]={});En[ft]||(En[ft]={path:Ge.path,pathBounds:[Ge.xMin,Ge.yMin,Ge.xMax,Ge.yMax]});const kr=Ye.x+re,Yi=Ye.y+We.baseline+me;ue[At*2]=kr,ue[At*2+1]=Yi;const ki=kr+Ge.xMin*Ht,Gr=Yi+Ge.yMin*Ht,pi=kr+Ge.xMax*Ht,fr=Yi+Ge.yMax*Ht;ki<be[0]&&(be[0]=ki),Gr<be[1]&&(be[1]=Gr),pi>be[2]&&(be[2]=pi),fr>be[3]&&(be[3]=fr),At%Q===0&&(pt={start:At,end:At,rect:[1/0,1/0,-1/0,-1/0]},De.push(pt)),pt.end++;const Tr=pt.rect;if(ki<Tr[0]&&(Tr[0]=ki),Gr<Tr[1]&&(Tr[1]=Gr),pi>Tr[2]&&(Tr[2]=pi),fr>Tr[3]&&(Tr[3]=fr),ee[At]=ft,se[At]=Vt,z){const Wr=At*3;Te[Wr]=gt>>16&255,Te[Wr+1]=gt>>8&255,Te[Wr+2]=gt&255}}}}}),Ne){const We=m.length-Be;We>1&&c(Ne,Be,We)}}const de=[];ce.forEach(({index:ve,src:_e,unitsPerEm:Be,ascender:He,descender:pt,lineHeight:gt,capHeight:We,xHeight:Je})=>{de[ve]={src:_e,unitsPerEm:Be,ascender:He,descender:pt,lineHeight:gt,capHeight:We,xHeight:Je}}),H.typesetting=d()-G,W({glyphIds:ee,glyphFontIndices:se,glyphPositions:ue,glyphData:oe,fontData:de,caretPositions:Ne,glyphColors:Te,chunkedBounds:De,fontSize:w,topBaseline:me+ze[0].baseline,blockBounds:[re,me-le,re+ke,me],visibleBounds:be,timings:H})})}function l(m,x){o({...m,metricsOnly:!0},b=>{const[y,w,_,S]=b.blockBounds;x({width:_-y,height:S-w})})}function u(m){let x=m.match(/^([\d.]+)%$/),b=x?parseFloat(x[1]):NaN;return isNaN(b)?0:b/100}function c(m,x,b){const y=m[x*4],w=m[x*4+1],_=m[x*4+2],S=m[x*4+3],M=(w-y)/b;for(let E=0;E<b;E++){const C=(x+E)*4;m[C]=y+M*E,m[C+1]=y+M*(E+1),m[C+2]=_,m[C+3]=S}}function d(){return(self.performance||Date).now()}function h(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(m){let x=h.flyweight;return x.data=this.data,x.index=m,x},splitAt(m){let x=new h;return x.data=this.data.splice(m*f.length),x}},h.flyweight=f.reduce((m,x,b,y)=>(Object.defineProperty(m,x,{get(){return this.data[this.index*f.length+b]},set(w){this.data[this.index*f.length+b]=w}}),m),{data:null,index:0}),{typeset:o,measure:l}}const zh=()=>(self.performance||Date).now(),J2=OZ();let IL;function c_e(t,e,n,r,i,a,s,o,l,u,c=!0){return c?h_e(t,e,n,r,i,a,s,o,l,u).then(null,d=>(IL||(console.warn("WebGL SDF generation failed, falling back to JS",d),IL=!0),RL(t,e,n,r,i,a,s,o,l,u))):RL(t,e,n,r,i,a,s,o,l,u)}const $b=[],d_e=5;let oI=0;function FZ(){const t=zh();for(;$b.length&&zh()-t<d_e;)$b.shift()();oI=$b.length?setTimeout(FZ,0):0}const h_e=(...t)=>new Promise((e,n)=>{$b.push(()=>{const r=zh();try{J2.webgl.generateIntoCanvas(...t),e({timing:zh()-r})}catch(i){n(i)}}),oI||(oI=setTimeout(FZ,0))}),f_e=4,p_e=2e3,NL={};let m_e=0;function RL(t,e,n,r,i,a,s,o,l,u){const c="TroikaTextSDFGenerator_JS_"+m_e++%f_e;let d=NL[c];return d||(d=NL[c]={workerModule:$0({name:c,workerId:c,dependencies:[OZ,zh],init(h,f){const m=h().javascript.generate;return function(...x){const b=f();return{textureData:m(...x),timing:f()-b}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(t,e,n,r,i,a).then(({textureData:h,timing:f})=>{const m=zh(),x=new Uint8Array(h.length*4);for(let b=0;b<h.length;b++)x[b*4+u]=h[b];return J2.webglUtils.renderImageData(s,x,o,l,t,e,1<<3-u),f+=zh()-m,--d.requests===0&&(d.idleTimer=setTimeout(()=>{Gbe(c)},p_e)),{timing:f}})}function g_e(t){t._warm||(J2.webgl.isSupported(t),t._warm=!0)}const v_e=J2.webglUtils.resizeWebGLCanvasWithoutClearing,vg={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},y_e=new zt;function Pp(){return(self.performance||Date).now()}const PL=Object.create(null);function BZ(t,e){t=__e({},t);const n=Pp(),r=[];if(t.font&&r.push({label:"user",src:w_e(t.font)}),t.font=r,t.text=""+t.text,t.sdfGlyphSize=t.sdfGlyphSize||vg.sdfGlyphSize,t.unicodeFontsURL=t.unicodeFontsURL||vg.unicodeFontsURL,t.colorRanges!=null){let h={};for(let f in t.colorRanges)if(t.colorRanges.hasOwnProperty(f)){let m=t.colorRanges[f];typeof m!="number"&&(m=y_e.set(m).getHex()),h[f]=m}t.colorRanges=h}Object.freeze(t);const{textureWidth:i,sdfExponent:a}=vg,{sdfGlyphSize:s}=t,o=i/s*4;let l=PL[s];if(!l){const h=document.createElement("canvas");h.width=i,h.height=s*256/o,l=PL[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:h,sdfTexture:new hi(h,void 0,void 0,void 0,Pr,Pr),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,x_e(l)}const{sdfTexture:u,sdfCanvas:c}=l;jZ(t).then(h=>{const{glyphIds:f,glyphFontIndices:m,fontData:x,glyphPositions:b,fontSize:y,timings:w}=h,_=[],S=new Float32Array(f.length*4);let M=0,E=0;const C=Pp(),R=x.map(F=>{let L=l.glyphsByFont.get(F.src);return L||l.glyphsByFont.set(F.src,L=new Map),L});f.forEach((F,L)=>{const U=m[L],{src:j,unitsPerEm:q}=x[U];let Z=R[U].get(F);if(!Z){const{path:H,pathBounds:J}=h.glyphData[j][F],te=Math.max(J[2]-J[0],J[3]-J[1])/s*(vg.sdfMargin*s+.5),ee=l.glyphCount++,se=[J[0]-te,J[1]-te,J[2]+te,J[3]+te];R[U].set(F,Z={path:H,atlasIndex:ee,sdfViewBox:se}),_.push(Z)}const{sdfViewBox:Q}=Z,z=b[E++],W=b[E++],X=y/q;S[M++]=z+Q[0]*X,S[M++]=W+Q[1]*X,S[M++]=z+Q[2]*X,S[M++]=W+Q[3]*X,f[L]=Z.atlasIndex}),w.quads=(w.quads||0)+(Pp()-C);const k=Pp();w.sdf={};const I=c.height,N=Math.ceil(l.glyphCount/o),D=Math.pow(2,Math.ceil(Math.log2(N*s)));D>I&&(console.info(`Increasing SDF texture size ${I}->${D}`),v_e(c,i,D),u.dispose()),Promise.all(_.map(F=>UZ(F,l,t.gpuAccelerateSDF).then(({timing:L})=>{w.sdf[F.atlasIndex]=L}))).then(()=>{_.length&&!l.contextLost&&(zZ(l),u.needsUpdate=!0),w.sdfTotal=Pp()-k,w.total=Pp()-n,e(Object.freeze({parameters:t,sdfTexture:u,sdfGlyphSize:s,sdfExponent:a,glyphBounds:S,glyphAtlasIndices:f,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{l.contextLost||g_e(c)})}function UZ({path:t,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:i,contextLost:a},s){if(a)return Promise.resolve({timing:-1});const{textureWidth:o,sdfExponent:l}=vg,u=Math.max(n[2]-n[0],n[3]-n[1]),c=Math.floor(e/4),d=c%(o/r)*r,h=Math.floor(c/(o/r))*r,f=e%4;return c_e(r,r,t,n,u,l,i,d,h,f,s)}function x_e(t){const e=t.sdfCanvas;e.addEventListener("webglcontextlost",n=>{console.log("Context Lost",n),n.preventDefault(),t.contextLost=!0}),e.addEventListener("webglcontextrestored",n=>{console.log("Context Restored",n),t.contextLost=!1;const r=[];t.glyphsByFont.forEach(i=>{i.forEach(a=>{r.push(UZ(a,t,!0))})}),Promise.all(r).then(()=>{zZ(t),t.sdfTexture.needsUpdate=!0})})}function b_e({font:t,characters:e,sdfGlyphSize:n},r){let i=Array.isArray(e)?e.join(`
`):""+e;BZ({font:t,sdfGlyphSize:n,text:i},r)}function __e(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}let Gx;function w_e(t){return Gx||(Gx=typeof document>"u"?{}:document.createElement("a")),Gx.href=t,Gx.href}function zZ(t){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:n}=t,{width:r,height:i}=e,a=t.sdfCanvas.getContext("webgl");let s=n.image.data;(!s||s.length!==r*i*4)&&(s=new Uint8Array(r*i*4),n.image={width:r,height:i,data:s},n.flipY=!1,n.isDataTexture=!0),a.readPixels(0,0,r,i,a.RGBA,a.UNSIGNED_BYTE,s)}}const S_e=$0({name:"Typesetter",dependencies:[u_e,l_e,Ybe],init(t,e,n){return t(e,n())}}),jZ=$0({name:"Typesetter",dependencies:[S_e],init(t){return function(e){return new Promise(n=>{t.typeset(e,n)})}},getTransferables(t){const e=[];for(let n in t)t[n]&&t[n].buffer&&e.push(t[n].buffer);return e}});jZ.onMainThread;const DL={};function E_e(t){let e=DL[t];return e||(e=DL[t]=new Wu(1,1,t,t).translate(.5,.5,0)),e}const T_e="aTroikaGlyphBounds",OL="aTroikaGlyphIndex",C_e="aTroikaGlyphColor";class M_e extends Y2{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Hi,this.boundingBox=new Ai}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let n=E_e(e);["position","normal","uv"].forEach(r=>{this.attributes[r]=n.attributes[r].clone()}),this.setIndex(n.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,n,r,i,a){this.updateAttributeData(T_e,e,4),this.updateAttributeData(OL,n,1),this.updateAttributeData(C_e,a,3),this._blockBounds=r,this._chunkedBounds=i,this.instanceCount=n.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:n,boundingBox:r}=this;if(n){const{PI:i,floor:a,min:s,max:o,sin:l,cos:u}=Math,c=i/2,d=i*2,h=Math.abs(n),f=e[0]/h,m=e[2]/h,x=a((f+c)/d)!==a((m+c)/d)?-h:s(l(f)*h,l(m)*h),b=a((f-c)/d)!==a((m-c)/d)?h:o(l(f)*h,l(m)*h),y=a((f+i)/d)!==a((m+i)/d)?h*2:o(h-u(f)*h,h-u(m)*h);r.min.set(x,e[1],n<0?-y:0),r.max.set(b,e[3],n<0?0:y)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let n=this.getAttribute(OL).count,r=this._chunkedBounds;if(r)for(let i=r.length;i--;){n=r[i].end;let a=r[i].rect;if(a[1]<e.w&&a[3]>e.y&&a[0]<e.z&&a[2]>e.x)break}this.instanceCount=n}updateAttributeData(e,n,r){const i=this.getAttribute(e);n?i&&i.array.length===n.length?(i.array.set(n),i.needsUpdate=!0):(this.setAttribute(e,new Zh(n,r)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}const A_e=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,k_e=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,I_e=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,N_e=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function R_e(t){const e=sI(t,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new dt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new er(0,0,0,0)},uTroikaClipRect:{value:new er(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new dt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new zt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Sn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:A_e,vertexTransform:k_e,fragmentDefs:I_e,fragmentColorTransform:N_e,customRewriter({vertexShader:n,fragmentShader:r}){let i=/\buniform\s+vec3\s+diffuse\b/;return i.test(r)&&(r=r.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(n)||(n=n.replace(LZ,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:n,fragmentShader:r}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const O8=new Gu({color:16777215,side:po,transparent:!0}),LL=8421504,FL=new fn,Wx=new we,LE=new we,Xm=[],P_e=new we,FE="+x+y";function BL(t){return Array.isArray(t)?t[0]:t}let HZ=()=>{const t=new Kr(new Wu(1,1),O8);return HZ=()=>t,t},$Z=()=>{const t=new Kr(new Wu(1,1,32,1),O8);return $Z=()=>t,t};const D_e={type:"syncstart"},O_e={type:"synccomplete"},VZ=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],L_e=VZ.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let qZ=class extends Kr{constructor(){const e=new M_e;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=LL,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=FE,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(D_e),BZ({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},n=>{this._isSyncing=!1,this._textRenderInfo=n,this.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(i=>i&&i())})),this.dispatchEvent(O_e),e&&e()})))}onBeforeRender(e,n,r,i,a,s){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return R_e(e)}get material(){let e=this._derivedMaterial;const n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=O8.clone());if((!e||!e.isDerivedFrom(n))&&(e=this._derivedMaterial=this.createDerivedMaterial(n),n.addEventListener("dispose",function r(){n.removeEventListener("dispose",r),e.dispose()})),this.hasOutline()){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function i(){e.removeEventListener("dispose",i),r.dispose()})),[r,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return BL(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return BL(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const n=e.isTextOutlineMaterial,r=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:o,blockBounds:l}=i;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,r.uTroikaSDFExponent.value=i.sdfExponent,r.uTroikaTotalBounds.value.fromArray(l),r.uTroikaUseGlyphColors.value=!n&&!!i.glyphColors;let u=0,c=0,d=0,h,f,m,x=0,b=0;if(n){let{outlineWidth:w,outlineOffsetX:_,outlineOffsetY:S,outlineBlur:M,outlineOpacity:E}=this;u=this._parsePercent(w)||0,c=Math.max(0,this._parsePercent(M)||0),h=E,x=this._parsePercent(_)||0,b=this._parsePercent(S)||0}else d=Math.max(0,this._parsePercent(this.strokeWidth)||0),d&&(m=this.strokeColor,r.uTroikaStrokeColor.value.set(m??LL),f=this.strokeOpacity,f==null&&(f=1)),h=this.fillOpacity;r.uTroikaEdgeOffset.value=u,r.uTroikaPositionOffset.value.set(x,b),r.uTroikaBlurRadius.value=c,r.uTroikaStrokeWidth.value=d,r.uTroikaStrokeOpacity.value=f,r.uTroikaFillOpacity.value=h??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let y=this.clipRect;if(y&&Array.isArray(y)&&y.length===4)r.uTroikaClipRect.value.fromArray(y);else{const w=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(l[0]-w,l[1]-w,l[2]+w,l[3]+w)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const a=n?this.outlineColor||0:this.color;if(a==null)delete e.color;else{const o=e.hasOwnProperty("color")?e.color:e.color=new zt;(a!==o._input||typeof a=="object")&&o.set(o._input=a)}let s=this.orientation||FE;if(s!==e._orientation){let o=r.uTroikaOrient.value;s=s.replace(/[^-+xyz]/g,"");let l=s!==FE&&s.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,u,c,d,h]=l;Wx.set(0,0,0)[c]=u==="-"?1:-1,LE.set(0,0,0)[h]=d==="-"?-1:1,FL.lookAt(P_e,Wx.cross(LE),LE),o.setFromMatrix4(FL)}else o.identity();e._orientation=s}}_parsePercent(e){if(typeof e=="string"){let n=e.match(/^(-?[\d.]+)%$/),r=n?parseFloat(n[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,n=new dt){n.copy(e);const r=this.curveRadius;return r&&(n.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),n}worldPositionToTextCoords(e,n=new dt){return Wx.copy(e),this.localPositionToTextCoords(this.worldToLocal(Wx),n)}raycast(e,n){const{textRenderInfo:r,curveRadius:i}=this;if(r){const a=r.blockBounds,s=i?$Z():HZ(),o=s.geometry,{position:l,uv:u}=o.attributes;for(let c=0;c<u.count;c++){let d=a[0]+u.getX(c)*(a[2]-a[0]);const h=a[1]+u.getY(c)*(a[3]-a[1]);let f=0;i&&(f=i-Math.cos(d/i)*i,d=Math.sin(d/i)*i),l.setXYZ(c,d,h,f)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,s.matrixWorld=this.matrixWorld,s.material.side=this.material.side,Xm.length=0,s.raycast(e,Xm);for(let c=0;c<Xm.length;c++)Xm[c].object=this,n.push(Xm[c])}}copy(e){const n=this.geometry;return super.copy(e),this.geometry=n,L_e.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};VZ.forEach(t=>{const e="_private_"+t;Object.defineProperty(qZ.prototype,t,{get(){return this[e]},set(n){n!==this[e]&&(this[e]=n,this._needsSync=!0)}})});new Ai;new zt;const Yx=P.forwardRef(({sdfGlyphSize:t=64,anchorX:e="center",anchorY:n="middle",font:r,fontSize:i=1,children:a,characters:s,onSync:o,...l},u)=>{const c=vs(({invalidate:m})=>m),[d]=P.useState(()=>new qZ),[h,f]=P.useMemo(()=>{const m=[];let x="";return P.Children.forEach(a,b=>{typeof b=="string"||typeof b=="number"?x+=b:m.push(b)}),[m,x]},[a]);return Mxe(()=>new Promise(m=>b_e({font:r,characters:s},m)),["troika-text",r,s]),P.useLayoutEffect(()=>void d.sync(()=>{c(),o&&o(d)})),P.useEffect(()=>()=>d.dispose(),[d]),P.createElement("primitive",rd({object:d,ref:u,font:r,text:f,anchorX:e,anchorY:n,fontSize:i,sdfGlyphSize:t},l),h)});var F_e=Object.defineProperty,B_e=(t,e,n)=>e in t?F_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mr=(t,e,n)=>(B_e(t,typeof e!="symbol"?e+"":e,n),n);function BE(t,e,n,r,i){let a;if(t=t.subarray||t.slice?t:t.buffer,n=n.subarray||n.slice?n:n.buffer,t=e?t.subarray?t.subarray(e,i&&e+i):t.slice(e,i&&e+i):t,n.set)n.set(t,r);else for(a=0;a<t.length;a++)n[a+r]=t[a];return n}function U_e(t){return t instanceof Float32Array?t:t instanceof bn?t.getAttribute("position").array:t.map(e=>{const n=Array.isArray(e);return e instanceof we?[e.x,e.y,e.z]:e instanceof dt?[e.x,e.y,0]:n&&e.length===3?[e[0],e[1],e[2]]:n&&e.length===2?[e[0],e[1],0]:e}).flat()}class z_e extends bn{constructor(){super(),mr(this,"type","MeshLine"),mr(this,"isMeshLine",!0),mr(this,"positions",[]),mr(this,"previous",[]),mr(this,"next",[]),mr(this,"side",[]),mr(this,"width",[]),mr(this,"indices_array",[]),mr(this,"uvs",[]),mr(this,"counters",[]),mr(this,"widthCallback",null),mr(this,"_attributes"),mr(this,"_points",[]),mr(this,"points"),mr(this,"matrixWorld",new fn),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,n){if(e=U_e(e),this._points=e,this.widthCallback=n??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof we)for(let r=0;r<e.length;r++){const i=e[r],a=r/(e.length-1);this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(a),this.counters.push(a)}else for(let r=0;r<e.length;r+=3){const i=r/(e.length-1);this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(i),this.counters.push(i)}this.process()}compareV3(e,n){const r=e*6,i=n*6;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]}copyV3(e){const n=e*6;return[this.positions[n],this.positions[n+1],this.positions[n+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let n,r;this.compareV3(0,e-1)?r=this.copyV3(e-2):r=this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(let i=0;i<e;i++){if(this.side.push(1),this.side.push(-1),this.widthCallback?n=this.widthCallback(i/(e-1)):n=1,this.width.push(n),this.width.push(n),this.uvs.push(i/(e-1),0),this.uvs.push(i/(e-1),1),i<e-1){r=this.copyV3(i),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);const a=i*2;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}i>0&&(r=this.copyV3(i),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]))}this.compareV3(e-1,0)?r=this.copyV3(1):r=this.copyV3(e-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new Xn(new Float32Array(this.positions),3),previous:new Xn(new Float32Array(this.previous),3),next:new Xn(new Float32Array(this.next),3),side:new Xn(new Float32Array(this.side),1),width:new Xn(new Float32Array(this.width),1),uv:new Xn(new Float32Array(this.uvs),2),index:new Xn(new Uint16Array(this.indices_array),1),counters:new Xn(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:n,z:r}){const i=this._attributes.position.array,a=this._attributes.previous.array,s=this._attributes.next.array,o=i.length;BE(i,0,a,0,o),BE(i,6,i,0,o-6),i[o-6]=e,i[o-5]=n,i[o-4]=r,i[o-3]=e,i[o-2]=n,i[o-1]=r,BE(i,6,s,0,o-6),s[o-6]=e,s[o-5]=n,s[o-4]=r,s[o-3]=e,s[o-2]=n,s[o-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const j_e=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,H_e=parseInt(B0.replace(/\D+/g,"")),$_e=H_e>=154?"colorspace_fragment":"encodings_fragment",V_e=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${$_e}>
  }
`;class q_e extends Ss{constructor(e){super({uniforms:{...Bt.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new zt(16777215)},gradient:{value:[new zt(16711680),new zt(65280)]},opacity:{value:1},resolution:{value:new dt(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new dt(1,1)}},vertexShader:j_e,fragmentShader:V_e}),mr(this,"lineWidth"),mr(this,"map"),mr(this,"useMap"),mr(this,"alphaMap"),mr(this,"useAlphaMap"),mr(this,"color"),mr(this,"gradient"),mr(this,"resolution"),mr(this,"sizeAttenuation"),mr(this,"dashArray"),mr(this,"dashOffset"),mr(this,"dashRatio"),mr(this,"useDash"),mr(this,"useGradient"),mr(this,"visibility"),mr(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(n){this.uniforms.lineWidth.value=n}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(n){this.uniforms.map.value=n}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(n){this.uniforms.useMap.value=n}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(n){this.uniforms.alphaMap.value=n}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(n){this.uniforms.useAlphaMap.value=n}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(n){this.uniforms.color.value=n}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(n){this.uniforms.gradient.value=n}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(n){this.uniforms.resolution.value.copy(n)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(n){this.uniforms.sizeAttenuation.value=n}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(n){this.uniforms.dashArray.value=n,this.useDash=n!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(n){this.uniforms.dashOffset.value=n}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(n){this.uniforms.dashRatio.value=n}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(n){this.uniforms.useDash.value=n}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(n){this.uniforms.useGradient.value=n}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(n){this.uniforms.visibility.value=n}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(n){this.uniforms.alphaTest.value=n}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(n){this.uniforms.repeat.value.copy(n)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const GZ={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},G_e=(t,e=1)=>(t.set(t.subarray(e)),t.fill(-1/0,-e),t);function W_e(t,e){const{length:n,local:r,decay:i,interval:a,stride:s}={...GZ,...e},o=P.useRef(null),[l]=P.useState(()=>new we);P.useLayoutEffect(()=>{t&&(o.current=Float32Array.from({length:n*10*3},(d,h)=>t.position.getComponent(h%3)))},[n,t]);const u=P.useRef(new we),c=P.useRef(0);return vf(()=>{if(t&&o.current){if(c.current===0){let d;r?d=t.position:(t.getWorldPosition(l),d=l);const h=1*i;for(let f=0;f<h;f++)d.distanceTo(u.current)<s||(G_e(o.current,3),o.current.set(d.toArray(),o.current.length-3));u.current.copy(d)}c.current++,c.current=c.current%a}}),o}const Y_e=P.forwardRef((t,e)=>{const{children:n}=t,{width:r,length:i,decay:a,local:s,stride:o,interval:l}={...GZ,...t},{color:u="hotpink",attenuation:c,target:d}=t,h=vs(S=>S.size),f=vs(S=>S.scene),m=P.useRef(null),[x,b]=P.useState(null),y=W_e(x,{length:i,decay:a,local:s,stride:o,interval:l});P.useEffect(()=>{const S=d?.current||m.current.children.find(M=>M instanceof nr);S&&b(S)},[y,d]);const w=P.useMemo(()=>new z_e,[]),_=P.useMemo(()=>{var S,M;const E=new q_e({lineWidth:.1*r,color:u,sizeAttenuation:1,resolution:new dt(h.width,h.height)});let C;if(n)if(Array.isArray(n))C=n.find(R=>{const k=R;return typeof k.type=="string"&&k.type==="meshLineMaterial"});else{const R=n;typeof R.type=="string"&&R.type==="meshLineMaterial"&&(C=R)}return typeof((S=C)==null?void 0:S.props)=="object"&&((M=C)==null?void 0:M.props)!==null&&E.setValues(C.props),E},[r,u,h,n]);return P.useEffect(()=>{_.uniforms.resolution.value.set(h.width,h.height)},[h]),vf(()=>{y.current&&w.setPoints(y.current,c)}),P.createElement("group",null,vbe(P.createElement("mesh",{ref:e,geometry:w,material:_}),f),P.createElement("group",{ref:m},n))}),X_e=P.forwardRef(({makeDefault:t,camera:e,regress:n,domElement:r,enableDamping:i=!0,keyEvents:a=!1,onChange:s,onStart:o,onEnd:l,...u},c)=>{const d=vs(E=>E.invalidate),h=vs(E=>E.camera),f=vs(E=>E.gl),m=vs(E=>E.events),x=vs(E=>E.setEvents),b=vs(E=>E.set),y=vs(E=>E.get),w=vs(E=>E.performance),_=e||h,S=r||m.connected||f.domElement,M=P.useMemo(()=>new Fbe(_),[_]);return vf(()=>{M.enabled&&M.update()},-1),P.useEffect(()=>(a&&M.connect(a===!0?S:a),M.connect(S),()=>void M.dispose()),[a,S,n,M,d]),P.useEffect(()=>{const E=k=>{d(),n&&w.regress(),s&&s(k)},C=k=>{o&&o(k)},R=k=>{l&&l(k)};return M.addEventListener("change",E),M.addEventListener("start",C),M.addEventListener("end",R),()=>{M.removeEventListener("start",C),M.removeEventListener("end",R),M.removeEventListener("change",E)}},[s,o,l,M,d,x]),P.useEffect(()=>{if(t){const E=y().controls;return b({controls:M}),()=>b({controls:E})}},[t,M]),P.createElement("primitive",rd({ref:c,object:M,enableDamping:i},u))});function K_e(t,e){const n=t+"Geometry";return P.forwardRef(({args:r,children:i,...a},s)=>{const o=P.useRef(null);return P.useImperativeHandle(s,()=>o.current),P.useLayoutEffect(()=>void e?.(o.current)),P.createElement("mesh",rd({ref:o},a),P.createElement(n,{attach:"geometry",args:r}),i)})}const UL=K_e("sphere"),Z_e={},zL=t=>{let e;const n=new Set,r=(c,d)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const f=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(m=>m(e,f))}},i=()=>e,l={setState:r,getState:i,getInitialState:()=>u,subscribe:c=>(n.add(c),()=>n.delete(c)),destroy:()=>{(Z_e?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=e=t(r,i,l);return l},J_e=t=>t?zL(t):zL;function Q_e({count:t=100}){const e=P.useRef(null),n=P.useMemo(()=>{const r=new Float32Array(t*3),i=new Float32Array(t*3);for(let a=0;a<t;a++){const s=Math.random()*Math.PI*2,o=Math.acos(2*Math.random()-1),l=8+Math.random()*12;r[a*3]=l*Math.sin(o)*Math.cos(s),r[a*3+1]=l*Math.sin(o)*Math.sin(s),r[a*3+2]=l*Math.cos(o);const u=Math.random();u<.3?(i[a*3]=.4,i[a*3+1]=.6,i[a*3+2]=1):u<.6?(i[a*3]=.8,i[a*3+1]=.4,i[a*3+2]=1):(i[a*3]=1,i[a*3+1]=1,i[a*3+2]=1)}return{positions:r,colors:i}},[t]);return vf(r=>{e.current&&(e.current.rotation.y=r.clock.elapsedTime*.02,e.current.rotation.x=Math.sin(r.clock.elapsedTime*.01)*.1)}),g.jsxs("points",{ref:e,children:[g.jsxs("bufferGeometry",{children:[g.jsx("bufferAttribute",{attach:"attributes-position",args:[n.positions,3]}),g.jsx("bufferAttribute",{attach:"attributes-color",args:[n.colors,3]})]}),g.jsx("pointsMaterial",{size:.1,vertexColors:!0,transparent:!0,opacity:.6,sizeAttenuation:!0,blending:l_})]})}function ewe({id:t,text:e,position:n,fontSize:r,isHighlighted:i=!1,hasRelations:a,type:s="memory",title:o,isGhost:l=!1,originalDate:u,onContextMenu:c,onDoubleClick:d,onGhostClick:h}){const[f,m]=P.useState(!1),x=P.useRef(null),b=P.useMemo(()=>{try{return window.matchMedia("(min-width: 768px)").matches?1.55:1.15}catch{return 1.2}},[]),y=r*b*(l?.85:1),w=s==="card",_=s==="index",M=l?"#60a5fa":s==="arena"||s==="arena-v2"?"#fb923c":w?"#fbbf24":_?"#a78bfa":i?"#fbbf24":f?"#93c5fd":"#f3f4f6",E=l?.5:1,C=(w||_)&&o?o:String(e||"").trim(),R=w||_?.15:f||i?.12:0,k=Math.floor(2.5/(y*.6)),I=Math.ceil(C.length/k),N=Math.max(1.2,I)*y*1.4,D=w?"#fbbf24":_?"#8b5cf6":"#000000",F=U=>{if(U.stopPropagation(),l&&u&&h){h(t,u);return}const j=new MouseEvent("contextmenu",{clientX:U.nativeEvent.clientX,clientY:U.nativeEvent.clientY});c(t,j)},L=U=>{U.stopPropagation(),d&&d(t,U.nativeEvent)};return g.jsx("group",{position:n,children:g.jsxs(jbe,{follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:[g.jsxs("mesh",{position:[0,0,-.01],children:[g.jsx("planeGeometry",{args:[2.25,N]}),g.jsx("meshBasicMaterial",{color:D,transparent:!0,opacity:R,depthWrite:!1})]}),w&&g.jsx(jb,{points:[[-1.125,N/2,0],[1.125,N/2,0],[1.125,-N/2,0],[-1.125,-N/2,0],[-1.125,N/2,0]],color:"#fbbf24",lineWidth:1.5,opacity:.6,transparent:!0}),_&&g.jsxs(g.Fragment,{children:[g.jsx(jb,{points:[[-1.225,N/2+.1,0],[1.225,N/2+.1,0],[1.225,-N/2-.1,0],[-1.225,-N/2-.1,0],[-1.225,N/2+.1,0]],color:"#a78bfa",lineWidth:2,opacity:.7,transparent:!0}),g.jsxs("mesh",{position:[0,0,-.02],children:[g.jsx("planeGeometry",{args:[2.5,N+.3]}),g.jsx("meshBasicMaterial",{color:"#8b5cf6",transparent:!0,opacity:.08,depthWrite:!1})]})]}),g.jsx(Yx,{fontSize:y,color:M,anchorX:"center",anchorY:"middle",maxWidth:2.8,textAlign:"center",outlineWidth:.03,outlineColor:"#000000",outlineOpacity:.85*E,fillOpacity:E,whiteSpace:"normal",overflowWrap:"break-word",font:"/fonts/LXGWWenKaiLite-Regular.ttf",children:C}),i&&g.jsx(jb,{points:[[-1.25,-(N/2)-y*.15,0],[1.25,-(N/2)-y*.15,0]],color:"#fbbf24",lineWidth:2,opacity:.7,transparent:!0}),_?g.jsx(Yx,{position:[0,N/2+y*.4,0],fontSize:y*.75,color:"#a78bfa",anchorX:"center",anchorY:"middle",children:"📚"}):w?g.jsx(Yx,{position:[0,N/2+y*.3,0],fontSize:y*.6,color:"#fbbf24",anchorX:"center",anchorY:"middle",children:"💎"}):a?g.jsx(Yx,{position:[0,-(N/2)-y*.25,0],fontSize:y*.55,color:"#93c5fd",anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",outlineOpacity:.7,children:"∞"}):null,g.jsxs("mesh",{ref:x,onClick:F,onDoubleClick:L,onPointerOver:()=>m(!0),onPointerOut:()=>m(!1),children:[g.jsx("planeGeometry",{args:[3.2,Math.max(N*1.3,y*2)]}),g.jsx("meshBasicMaterial",{transparent:!0,opacity:0,side:po,depthWrite:!1})]})]})})}function twe({fromPosition:t,toPosition:e,fromId:n,toId:r,onClick:i}){const[a,s]=P.useState(!1),[o,l]=P.useState(!1),u=P.useRef(null),{camera:c}=vs(),d=P.useMemo(()=>{const m=new we(...t),x=new we(...e),b=new we().addVectors(m,x).multiplyScalar(.5),y=m.distanceTo(x);return b.multiplyScalar(1+y*.05),new O2(m,b,x)},[t,e]),h=P.useMemo(()=>d.getPoints(50),[d]);vf(m=>{if(u.current&&o){const x=Math.sin(m.clock.elapsedTime*3)*.5+.5;u.current.material.opacity=.3+x*.4}});const f=m=>{m.stopPropagation(),l(!0),i?.(n,r),setTimeout(()=>l(!1),2e3)};return g.jsxs("group",{children:[g.jsx(jb,{ref:u,points:h,color:o?"#60a5fa":a?"#3b82f6":"#4b5563",lineWidth:a?3:o?4:1.5,transparent:!0,opacity:a?.8:o?.9:.4,onClick:f,onPointerOver:()=>s(!0),onPointerOut:()=>s(!1)}),o&&g.jsx(Y_e,{width:2,length:6,color:"#60a5fa",attenuation:m=>m*m,children:g.jsxs("mesh",{position:t,children:[g.jsx("sphereGeometry",{args:[.1,16,16]}),g.jsx("meshBasicMaterial",{color:"#60a5fa"})]})}),(a||o)&&g.jsxs(g.Fragment,{children:[g.jsxs("mesh",{position:t,children:[g.jsx("sphereGeometry",{args:[.08,16,16]}),g.jsx("meshBasicMaterial",{color:"#60a5fa",transparent:!0,opacity:.6})]}),g.jsxs("mesh",{position:e,children:[g.jsx("sphereGeometry",{args:[.08,16,16]}),g.jsx("meshBasicMaterial",{color:"#60a5fa",transparent:!0,opacity:.6})]})]})]})}function nwe(){const{camera:t,controls:e}=vs(),n=P.useCallback((a,s,o=1e3)=>{const l=t.position.clone(),u=Date.now(),c=()=>{const d=Date.now()-u,h=Math.min(d/o,1),f=1-Math.pow(1-h,3);if(t.position.lerpVectors(l,a,f),t.lookAt(s),e&&"target"in e&&"update"in e){const m=e;m.target.copy(s),m.update()}h<1&&requestAnimationFrame(c)};c()},[t,e]),r=P.useCallback((a,s,o=15)=>{const l=new we(...a),u=new we(...s),c=new we().addVectors(l,u).multiplyScalar(.5),d=l.distanceTo(u),h=Math.max(o,d*1.5),f=c.clone().add(new we(0,0,h));n(f,c,1e3)},[n]),i=P.useCallback((a,s=10)=>{const u=new we(...a).clone().normalize().multiplyScalar(s),c=new we(0,0,0);n(u,c,800)},[n]);return{animateToPosition:n,viewTwoPoints:r,focusPoint:i}}function rwe(t,e){const n=t.length;return e==="index"?n<5?.2:n<10?.16:n<20?.13:n<40?.1:n<60?.08:.07:n<5?.32:n<10?.24:n<20?.18:n<40?.14:n<60?.11:.1}function iwe({memories:t,relations:e=[],hasRelations:n,onMemoryContextMenu:r,onMemoryDoubleClick:i,onGhostClick:a,focusMemoryId:s,isPaused:o=!1}){const l=P.useRef(null),u=P.useRef(null),{viewTwoPoints:c,focusPoint:d}=nwe();vf(()=>{u.current&&!o&&(u.current.rotation.y+=.001)});const h=x=>{const[y,w,_]=x;if(!Number.isFinite(y)||!Number.isFinite(w)||!Number.isFinite(_)){console.warn("⚠️ 检测到无效坐标，使用随机位置",x);const M=Math.random()*Math.PI*2,E=Math.acos(2*Math.random()-1);return[5.3*Math.sin(E)*Math.cos(M),5.3*Math.sin(E)*Math.sin(M),5.3*Math.cos(E)]}const S=Math.sqrt(y*y+w*w+_*_);return S===0||!Number.isFinite(S)?(console.warn("⚠️ 检测到零向量，使用默认位置"),[5.3,0,0]):[y/S*5.3,w/S*5.3,_/S*5.3]},f=new Map;t.forEach(x=>{f.set(x.id,h(x.position))}),P.useEffect(()=>{if(!s)return;const x=f.get(s);x&&d(x,11)},[s,d]);const m=(x,b)=>{const y=f.get(x),w=f.get(b);y&&w&&c(y,w,12)};return g.jsxs("group",{ref:u,children:[g.jsx(UL,{ref:l,args:[5,64,64],children:g.jsx("meshStandardMaterial",{color:"#1a1a2e",transparent:!0,opacity:.3,wireframe:!1,depthWrite:!1})}),g.jsx(UL,{args:[5.01,32,32],children:g.jsx("meshBasicMaterial",{color:"#4a5568",wireframe:!0,transparent:!0,opacity:.15,depthWrite:!1})}),e.map((x,b)=>{const y=f.get(x.fromId),w=f.get(x.toId);return!y||!w?null:g.jsx(twe,{fromPosition:y,toPosition:w,fromId:x.fromId,toId:x.toId,onClick:m},`${x.fromId}-${x.toId}-${b}`)}),t.map(x=>{const b=h(x.position),y=(()=>{if(!x.highlightUntil)return!1;const w=new Date(x.highlightUntil).getTime();return!w||Number.isNaN(w)?!1:Date.now()<=w})();return g.jsx(ewe,{id:x.id,text:x.text,position:b,fontSize:x.fontSize,isHighlighted:y,hasRelations:n?.(x.id)||!1,type:x.type,title:x.title,isGhost:x.isGhost,originalDate:x.originalDate,onContextMenu:r||(()=>{}),onDoubleClick:i||(()=>{}),onGhostClick:a},x.id)})]})}const awe=Xt.forwardRef(function({memories:e,relations:n,hasRelations:r,onMemoryContextMenu:i,onMemoryDoubleClick:a,onGhostClick:s,focusMemoryId:o,isPaused:l},u){const c=P.useRef(null),d=h=>{const f=c.current;if(!f)return;const m=f.object,x=f.target;if(!m||!x)return;const b=m,y=b.position.clone().sub(x),w=y.length(),_=KN.clamp(w*h,7,22);y.normalize().multiplyScalar(_),b.position.copy(x.clone().add(y)),f.update?.()};return P.useImperativeHandle(u,()=>({zoomIn:()=>d(.88),zoomOut:()=>d(1.12)})),g.jsxs(kbe,{camera:{position:[0,0,12.5],fov:58},style:{background:"linear-gradient(to bottom, #0f0f1e 0%, #1a1a2e 100%)"},gl:{antialias:!0,alpha:!1,powerPreference:"high-performance"},dpr:typeof window<"u"&&window.devicePixelRatio>2?2:[1,2],onCreated:({gl:h})=>{h.setClearColor("#0f0f1e")},children:[g.jsx("ambientLight",{intensity:.5}),g.jsx("directionalLight",{position:[10,10,5],intensity:1}),g.jsx("directionalLight",{position:[-10,-10,-5],intensity:.5}),g.jsx("pointLight",{position:[0,0,0],intensity:.5,color:"#4299e1"}),g.jsx(Q_e,{count:150}),g.jsx(iwe,{memories:e,relations:n,hasRelations:r,onMemoryContextMenu:i,onMemoryDoubleClick:a,onGhostClick:s,focusMemoryId:o,isPaused:l}),g.jsx(X_e,{ref:c,enableZoom:!0,enablePan:!1,enableRotate:!0,minDistance:6,maxDistance:18,rotateSpeed:.6,enableDamping:!0,dampingFactor:.05,zoomSpeed:.8,screenSpacePanning:!1,makeDefault:!0})]})});function Cu(t,e,n){const r=globalThis.crypto?.randomUUID?.()??`${Date.now().toString()}-${Math.random().toString(36).slice(2)}`,i=rwe(e,n);let a,s,o,l=0;const u=50,c=.3;do{let b,y,w;do b=Math.random()*2-1,y=Math.random()*2-1,w=b*b+y*y;while(w>=1||w===0);const _=Math.sqrt(1-w);a=2*b*_,s=2*y*_,o=1-2*w;let S=!1;if(l<u-10){for(const M of t)if(M.position){const E=(a*100-M.position[0])/100,C=(s*100-M.position[1])/100,R=(o*100-M.position[2])/100;if(Math.sqrt(E*E+C*C+R*R)<c){S=!0;break}}}if(!S)break;l++}while(l<u);const d=Math.asin(Math.max(-1,Math.min(1,s)))*(180/Math.PI),h=Math.atan2(o,a)*(180/Math.PI),f=a*100,m=s*100,x=o*100;if(!Number.isFinite(f)||!Number.isFinite(m)||!Number.isFinite(x)){console.error("⚠️ 生成了无效坐标！",{x:a,y:s,z:o});let b,y,w;do b=Math.random()*2-1,y=Math.random()*2-1,w=b*b+y*y;while(w>=1||w===0);const _=Math.sqrt(1-w);return{id:r,text:e,position:[200*b*_,200*y*_,100*(1-2*w)],rotation:[0,0],fontSize:i}}return{id:r,text:e,position:[f,m,x],rotation:[d,h],fontSize:i}}function jh(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}function jL(t){return jh(t,new Date)}function swe(t){const{memories:e,setMemories:n,relations:r,selectedDate:i,setSelectedDate:a,inputRef:s,inputText:o,setInputText:l,onShowToast:u,onRemoveRelationsForMemory:c,onOpenCardDetail:d,onOpenIndexDetail:h,onOpenArena:f,onOpenSearchModal:m,onCloseCardDetailModal:x,onCloseIndexDetailModal:b}=t,[y,w]=P.useState(!1),[_,S]=P.useState(null),[M,E]=P.useState(!1),C=P.useCallback(()=>{if(o&&o.trim()){const z={...Cu(e,o.trim(),"memory"),date:new Date,type:"memory"};n([...e,z]),l?.(""),setTimeout(()=>{s?.current?.focus()},u2.INPUT_FOCUS_DELAY_MS)}},[o,e,n,l,s]),R=P.useCallback(async z=>{if(confirm("确定要删除这条记忆吗？此操作不可恢复。")){try{const{storageManager:X}=await Yh(async()=>{const{storageManager:H}=await import("./index.CRO4pM4d.js").then(J=>J.i);return{storageManager:H}},__vite__mapDeps([1,2]));await X.addDeletedRecord?.(z,"user-action"),console.log(`🪦 已记录删除记录（墓碑）: ${z}`)}catch(X){console.error("记录删除记录失败:",X)}n(X=>X.filter(H=>H.id!==z)),c?.(z),u?.("已删除记忆","success",2e3)}},[n,c,u]),k=P.useCallback((z,W)=>{n(X=>X.map(H=>H.id===z?{...H,...W}:H))},[n]),I=P.useCallback((z,W)=>{const X=W instanceof Date?W:new Date(W);a?.(X),S(z);const H=X.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});u?.(`已跳转到 ${H}`,"info",2e3)},[a,u]),N=P.useCallback((z,W)=>{W.preventDefault();const X=e.find(H=>H.id===z);X&&(X.type==="index"?h?.(z,{x:W.clientX,y:W.clientY}):X.type==="card"?d?.(z,{x:W.clientX,y:W.clientY}):X.type==="arena"||X.type==="arena-v2"?f?.(z):m?.(z,{x:W.clientX,y:W.clientY}))},[e,d,h,f,m]),D=P.useCallback((z,W)=>{W.preventDefault(),W.stopPropagation()},[]),F=P.useCallback(z=>{const W=e.find(X=>X.id===z);W&&(W.date&&a?.(new Date(W.date)),S(z),x?.(),u?.("已定位到源记忆","success",2e3))},[e,a,u,x]),L=P.useCallback(z=>{const W=e.find(X=>X.id===z);if(W){if(W.date){const X=new Date(W.date);jh(X,i||new Date)?S(z):(a?.(X),setTimeout(()=>{S(z)},300))}else S(z);b?.(),u?.("已导航到目标内容","info")}},[e,i,a,u,b]),U=P.useCallback(async z=>{const W={...Cu(e,z.title,"card"),date:new Date,type:"card",title:z.title,content:z.content,text:z.title,sourceMemoryIds:z.sourceMemoryIds};n([...e,W]),u?.("知识卡片已创建 💎","success",2500)},[e,n,u]),j=P.useCallback(async z=>{const W={...Cu(e,z.title,"index"),date:new Date,type:"index",title:z.title,description:z.description,text:z.title,linkedIds:z.linkedIds};n([...e,W]),u?.("索引入口已创建 📚","success",2500)},[e,n,u]),q=P.useMemo(()=>{const z=Date.now();return e.filter(W=>{const X=!!W?.isHidden,H=(()=>{if(!W?.isTemporary)return!1;const J=W.expiresAt?new Date(W.expiresAt).getTime():0;return!J||Number.isNaN(J)?!1:z>J})();return y?!0:!X&&!H})},[e,y]),Z=P.useMemo(()=>{if(!i)return q;const z=q.filter(H=>{const J=H.date instanceof Date?H.date:new Date(H.date);return jh(J,i)}),X=q.filter(H=>{const J=H.date instanceof Date?H.date:new Date(H.date);return jh(J,i)?!1:z.some(te=>r.some(ee=>ee.fromId===te.id&&ee.toId===H.id||ee.toId===te.id&&ee.fromId===H.id))}).slice(0,15).map(H=>({...H,isGhost:!0,originalDate:H.date instanceof Date?H.date:new Date(H.date)}));return[...z,...X]},[i,q,r]),Q=P.useMemo(()=>Z.some(z=>z.isGhost),[Z]);return{showHidden:y,setShowHidden:w,focusMemoryId:_,setFocusMemoryId:S,focusMode:M,setFocusMode:E,visibleMemories:q,filteredMemories:Z,hasGhostNodes:Q,handleAddMemory:C,handleDeleteMemory:R,handleUpdateMemory:k,handleGhostClick:I,handleMemoryContextMenu:N,handleMemoryDoubleClick:D,handleNavigateToSourceMemory:F,handleNavigateToIndexedMemory:L,handleConfirmCreateCard:U,handleConfirmCreateIndex:j}}function owe(t){const{memories:e,setMemories:n,onShowToast:r,onAddRelation:i,onOpenArenaEditor:a,onCloseArenaEditor:s,onOpenArenaV2Editor:o,onCloseArenaV2Editor:l,onSetArenaV2Editor:u,onCloseSearchModal:c,onOpenCreateArenaModal:d}=t,h=P.useCallback((N,D,F,L)=>{Yh(async()=>{const{getTemplateById:U}=await Promise.resolve().then(()=>tot);return{getTemplateById:U}},void 0).then(({getTemplateById:U})=>{const j=L?U(L):void 0,q=`arena-root-${Date.now()}`,Z=(H,J,te,ee)=>{const se=`arena-node-${Date.now()}-${Math.random().toString(36).slice(2)}`,ue={id:se,text:H.text.replace("[填写你的问题]",N).replace("[填写你的主题]",N).replace("[填写你想学习的概念]",N).replace("[填写你要分析的对象]",N).replace("[填写你的决策问题]",N),parentId:J,status:"exploring",children:[],depth:te,order:ee,createdAt:new Date};let oe={[se]:ue};if(H.children&&H.children.length>0){const Te=[];H.children.forEach((Ne,be)=>{const De=Z(Ne,se,te+1,be);Te.push(De.id),oe={...oe,...De.nodes}}),ue.children=Te}return{id:se,nodes:oe}};let Q,z;if(j&&j.id!=="blank"){const H=Z(j.structure,null,0,0);z=H.id,Q=H.nodes}else{const H={id:q,text:F||N,parentId:null,status:"exploring",children:[],depth:0,order:0,createdAt:new Date};z=q,Q={[q]:H}}const W=sessionStorage.getItem("arenaSourceMemoryId");W&&sessionStorage.removeItem("arenaSourceMemoryId");const X={...Cu(e,N,"arena"),date:new Date,type:"arena",title:N.trim(),description:D||void 0,text:N.trim(),arenaRootNodeId:z,arenaNodes:Q,arenaValidPaths:[],metadata:{templateId:j?.id,templateName:j?.name,triggerQuestion:N.trim(),sourceMemoryIds:W?[W]:void 0}};n([...e,X]),r?.(`演武场已创建 ${j?.emoji||"🥋"}`,"success",2500),W&&i?.(X.id,W),setTimeout(()=>{a?.(X.id)},100)})},[e,n,r,i,a]),f=P.useCallback(N=>{const D=e.find(F=>F.id===N);D&&(D.type==="arena-v2"?(o?.(D),typeof window<"u"&&window.history.pushState({arenaId:N,type:"arena-v2"},"",`/memories/arena-v2?id=${N}`)):(a?.(N),typeof window<"u"&&window.history.pushState({arenaId:N},"",`/memories/arena?id=${N}`)))},[e,a,o]),m=P.useCallback(async N=>{n(D=>D.map(F=>F.id===N.id?N:F))},[n]),x=P.useCallback(async N=>{const D=e.filter(F=>F.id!==N);n(D),s?.();try{await Bi.save(D),r?.("演武场已删除","success",2e3)}catch(F){console.error("删除演武场失败:",F),r?.("删除失败，请重试","error",3e3),n(e)}},[e,n,s,r]),b=P.useCallback(()=>{s?.(),typeof window<"u"&&window.history.pushState({},"","/memories")},[s]),y=P.useCallback(async(N,D)=>{if(!e.find(U=>U.id===N))return;const L={...Cu(e,D.title,"card"),id:`card-${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"card",title:D.title,content:D.content,text:D.title,sourceMemoryIds:[N],date:new Date,lastEditedAt:new Date};n(U=>[...U,L]),i?.(L.id,N),r?.("✅ 已提炼为知识卡片","success",2500)},[e,n,i,r]),w=P.useCallback(async N=>{const D={...Cu(e,N.text,"memory"),id:`memory-${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"memory",text:N.text,date:new Date};if(n(F=>[...F,D]),i?.(D.id,N.arenaId),N.evidenceIds&&N.evidenceIds.length>0)for(const F of N.evidenceIds)i?.(D.id,F);r?.("✅ 已转为记忆","success",2500)},[e,n,i,r]),_=P.useCallback(N=>{const D={id:"root",text:N,type:"goal",px:0,py:0,level:0,parent:null,universeId:"u1",expanded:!1,createdAt:new Date},F={...Cu(e,N,"arena-v2"),date:new Date,type:"arena-v2",title:N,text:N,arenaV2Nodes:{[D.id]:D},arenaV2Universes:[{id:"u1",name:"主宇宙",active:!0,createdAt:new Date}],arenaV2Snapshots:[],arenaV2ViewMode:"free",arenaV2ActiveUniverseId:"u1"};n([...e,F]),r?.("🔥 演武场V2已创建","success",2500),setTimeout(()=>{o?.(F)},100)},[e,n,r,o]),S=P.useCallback(async N=>{n(D=>D.map(F=>F.id===N.id?N:F)),u?.(D=>D.visible?{...D,arenaMemory:N}:D)},[n,u]),M=P.useCallback(()=>{l?.(),typeof window<"u"&&window.history.pushState({},"","/memories")},[l]),E=P.useCallback(N=>{n(D=>D.filter(F=>F.id!==N)),M(),r?.("✅ 演武场已删除","success")},[n,M,r]),C=P.useCallback(async N=>{const F={fact:"事实",assumption:"假设",risk:"风险",goal:"目标",question:"疑问"}[N.type]||N.type,L={...Cu(e,N.text,"memory"),id:`memory-${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"memory",text:`[${F}] ${N.text}`,content:N.note,date:new Date};if(n(U=>[...U,L]),i?.(L.id,N.arenaId),N.evidenceIds&&N.evidenceIds.length>0)for(const U of N.evidenceIds)i?.(L.id,U);r?.("✅ 节点已导出为记忆","success",2500)},[e,n,i,r]),R=P.useCallback(async(N,D)=>{const F={...Cu(e,D.title,"card"),id:`card-${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"card",title:D.title,content:D.content,text:D.title,sourceMemoryIds:[N],date:new Date};n(L=>[...L,F]),i?.(F.id,N),r?.("✅ 已提炼为知识卡片","success",2500)},[e,n,i,r]),k=P.useCallback(N=>{const D=e.find(F=>F.id===N);D&&(c?.(),setTimeout(()=>{d?.(),sessionStorage.setItem("arenaSourceMemoryId",N),sessionStorage.setItem("arenaSourceMemoryText",D.text)},100))},[e,c,d]),I=P.useCallback((N,D)=>{n(F=>F.map(L=>L.id===N?{...L,arenaArchived:D}:L))},[n]);return{handleCreateArena:h,handleOpenArena:f,handleSaveArena:m,handleDeleteArena:x,handleCloseArena:b,handleDistillArenaToCard:y,handleConvertNodeToMemory:w,handleCreateArenaV2:_,handleSaveArenaV2:S,handleCloseArenaV2:M,handleDeleteArenaV2:E,handleExportArenaV2NodeToMemory:C,handleDistillArenaV2ToCard:R,handleCreateArenaFromMemory:k,handleToggleArenaArchive:I}}const lwe=()=>{};function uwe(t={}){const{onAddMemory:e=lwe}=t,[n,r]=P.useState(""),i=P.useRef(null);P.useEffect(()=>{const s=i.current;if(!s)return;s.style.height="0px";const o=Math.min(s.scrollHeight,Math.round(window.innerHeight*.4));s.style.height=`${Math.max(o,28)}px`},[n]);const a=P.useCallback(s=>{window.matchMedia("(max-width: 767px)").matches?s.key==="Enter"&&(s.ctrlKey||s.metaKey)&&(s.preventDefault(),e?.()):s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),e?.())},[e]);return{inputText:n,setInputText:r,inputRef:i,handleKeyDown:a}}function cwe({toast:t,onClose:e}){P.useEffect(()=>{if(t.duration!==0){const i=setTimeout(()=>{e(t.id)},t.duration||3e3);return()=>clearTimeout(i)}},[t.id,t.duration,e]);const n={success:"bg-green-900/90 border-green-700 text-green-100",error:"bg-red-900/90 border-red-700 text-red-100",warning:"bg-yellow-900/90 border-yellow-700 text-yellow-100",info:"bg-blue-900/90 border-blue-700 text-blue-100"},r={success:"✓",error:"✕",warning:"⚠",info:"ℹ"};return g.jsxs("div",{className:`
        fixed top-4 right-4 z-50
        px-4 py-3 rounded-lg border shadow-lg
        flex items-center gap-3
        max-w-md
        animate-slide-in
        ${n[t.type]}
      `,children:[g.jsx("span",{className:"text-lg font-bold",children:r[t.type]}),g.jsx("span",{className:"flex-1 text-sm",children:t.message}),g.jsx("button",{onClick:()=>e(t.id),className:"ml-2 hover:opacity-70 transition-opacity",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function dwe({children:t}){const[e,n]=P.useState([]),r=P.useCallback((a,s="info",o=3e3)=>{const l=Date.now().toString()+Math.random();n(u=>[...u,{id:l,message:a,type:s}])},[]),i=P.useCallback(a=>{n(s=>s.filter(o=>o.id!==a))},[]);return g.jsxs(g.Fragment,{children:[t?.({showToast:r}),g.jsx("div",{className:"fixed top-3 right-3 z-50 flex flex-col gap-1.5 pointer-events-none",children:e.map(a=>g.jsx("div",{className:"pointer-events-auto",children:g.jsx(cwe,{toast:{...a,duration:3e3},onClose:i})},a.id))})]})}var WZ="vercel.ai.error",hwe=Symbol.for(WZ),HL,$L,pn=class YZ extends($L=Error,HL=hwe,$L){constructor({name:e,message:n,cause:r}){super(n),this[HL]=!0,this.name=e,this.cause=r}static isInstance(e){return YZ.hasMarker(e,WZ)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}},XZ="AI_APICallError",KZ=`vercel.ai.error.${XZ}`,fwe=Symbol.for(KZ),VL,qL,ji=class extends(qL=pn,VL=fwe,qL){constructor({message:e,url:n,requestBodyValues:r,statusCode:i,responseHeaders:a,responseBody:s,cause:o,isRetryable:l=i!=null&&(i===408||i===409||i===429||i>=500),data:u}){super({name:XZ,message:e,cause:o}),this[VL]=!0,this.url=n,this.requestBodyValues=r,this.statusCode=i,this.responseHeaders=a,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(e){return pn.hasMarker(e,KZ)}},ZZ="AI_EmptyResponseBodyError",JZ=`vercel.ai.error.${ZZ}`,pwe=Symbol.for(JZ),GL,WL,QZ=class extends(WL=pn,GL=pwe,WL){constructor({message:e="Empty response body"}={}){super({name:ZZ,message:e}),this[GL]=!0}static isInstance(e){return pn.hasMarker(e,JZ)}};function ef(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var eJ="AI_InvalidArgumentError",tJ=`vercel.ai.error.${eJ}`,mwe=Symbol.for(tJ),YL,XL,nJ=class extends(XL=pn,YL=mwe,XL){constructor({message:e,cause:n,argument:r}){super({name:eJ,message:e,cause:n}),this[YL]=!0,this.argument=r}static isInstance(e){return pn.hasMarker(e,tJ)}},rJ="AI_InvalidPromptError",iJ=`vercel.ai.error.${rJ}`,gwe=Symbol.for(iJ),KL,ZL,Mu=class extends(ZL=pn,KL=gwe,ZL){constructor({prompt:e,message:n,cause:r}){super({name:rJ,message:`Invalid prompt: ${n}`,cause:r}),this[KL]=!0,this.prompt=e}static isInstance(e){return pn.hasMarker(e,iJ)}},aJ="AI_InvalidResponseDataError",sJ=`vercel.ai.error.${aJ}`,vwe=Symbol.for(sJ),JL,QL,Hh=class extends(QL=pn,JL=vwe,QL){constructor({data:e,message:n=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:aJ,message:n}),this[JL]=!0,this.data=e}static isInstance(e){return pn.hasMarker(e,sJ)}},oJ="AI_JSONParseError",lJ=`vercel.ai.error.${oJ}`,ywe=Symbol.for(lJ),eF,tF,ow=class extends(tF=pn,eF=ywe,tF){constructor({text:e,cause:n}){super({name:oJ,message:`JSON parsing failed: Text: ${e}.
Error message: ${ef(n)}`,cause:n}),this[eF]=!0,this.text=e}static isInstance(e){return pn.hasMarker(e,lJ)}},uJ="AI_LoadAPIKeyError",cJ=`vercel.ai.error.${uJ}`,xwe=Symbol.for(cJ),nF,rF,Xx=class extends(rF=pn,nF=xwe,rF){constructor({message:e}){super({name:uJ,message:e}),this[nF]=!0}static isInstance(e){return pn.hasMarker(e,cJ)}},dJ="AI_LoadSettingError",hJ=`vercel.ai.error.${dJ}`,bwe=Symbol.for(hJ),iF,aF,Kx=class extends(aF=pn,iF=bwe,aF){constructor({message:t}){super({name:dJ,message:t}),this[iF]=!0}static isInstance(t){return pn.hasMarker(t,hJ)}},fJ="AI_NoSuchModelError",pJ=`vercel.ai.error.${fJ}`,_we=Symbol.for(pJ),sF,oF,lI=class extends(oF=pn,sF=_we,oF){constructor({errorName:t=fJ,modelId:e,modelType:n,message:r=`No such ${n}: ${e}`}){super({name:t,message:r}),this[sF]=!0,this.modelId=e,this.modelType=n}static isInstance(t){return pn.hasMarker(t,pJ)}},mJ="AI_TooManyEmbeddingValuesForCallError",gJ=`vercel.ai.error.${mJ}`,wwe=Symbol.for(gJ),lF,uF,Tv=class extends(uF=pn,lF=wwe,uF){constructor(t){super({name:mJ,message:`Too many values for a single embedding call. The ${t.provider} model "${t.modelId}" can only embed up to ${t.maxEmbeddingsPerCall} values per call, but ${t.values.length} values were provided.`}),this[lF]=!0,this.provider=t.provider,this.modelId=t.modelId,this.maxEmbeddingsPerCall=t.maxEmbeddingsPerCall,this.values=t.values}static isInstance(t){return pn.hasMarker(t,gJ)}},vJ="AI_TypeValidationError",yJ=`vercel.ai.error.${vJ}`,Swe=Symbol.for(yJ),cF,dF,tf=class uI extends(dF=pn,cF=Swe,dF){constructor({value:e,cause:n}){super({name:vJ,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${ef(n)}`,cause:n}),this[cF]=!0,this.value=e}static isInstance(e){return pn.hasMarker(e,yJ)}static wrap({value:e,cause:n}){return uI.isInstance(n)&&n.value===e?n:new uI({value:e,cause:n})}},xJ="AI_UnsupportedFunctionalityError",bJ=`vercel.ai.error.${xJ}`,Ewe=Symbol.for(bJ),hF,fF,Nn=class extends(fF=pn,hF=Ewe,fF){constructor({functionality:e,message:n=`'${e}' functionality not supported.`}){super({name:xJ,message:n}),this[hF]=!0,this.functionality=e}static isInstance(e){return pn.hasMarker(e,bJ)}};function ht(t,e,n){function r(o,l){if(o._zod||Object.defineProperty(o,"_zod",{value:{def:l,constr:s,traits:new Set},enumerable:!1}),o._zod.traits.has(t))return;o._zod.traits.add(t),e(o,l);const u=s.prototype,c=Object.keys(u);for(let d=0;d<c.length;d++){const h=c[d];h in o||(o[h]=u[h].bind(o))}}const i=n?.Parent??Object;class a extends i{}Object.defineProperty(a,"name",{value:t});function s(o){var l;const u=n?.Parent?new a:this;r(u,o),(l=u._zod).deferred??(l.deferred=[]);for(const c of u._zod.deferred)c();return u}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:o=>n?.Parent&&o instanceof n.Parent?!0:o?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}class Qp extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class _J extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const wJ={};function id(t){return wJ}function SJ(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function cI(t,e){return typeof e=="bigint"?e.toString():e}function Q2(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function L8(t){return t==null}function F8(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function Twe(t,e){const n=(t.toString().split(".")[1]||"").length,r=e.toString();let i=(r.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(r)){const l=r.match(/\d?e-(\d?)/);l?.[1]&&(i=Number.parseInt(l[1]))}const a=n>i?n:i,s=Number.parseInt(t.toFixed(a).replace(".","")),o=Number.parseInt(e.toFixed(a).replace(".",""));return s%o/10**a}const pF=Symbol("evaluating");function tr(t,e,n){let r;Object.defineProperty(t,e,{get(){if(r!==pF)return r===void 0&&(r=pF,r=n()),r},set(i){Object.defineProperty(t,e,{value:i})},configurable:!0})}function yf(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function vd(...t){const e={};for(const n of t){const r=Object.getOwnPropertyDescriptors(n);Object.assign(e,r)}return Object.defineProperties({},e)}function mF(t){return JSON.stringify(t)}function Cwe(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const EJ="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function M1(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const Mwe=Q2(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function v0(t){if(M1(t)===!1)return!1;const e=t.constructor;if(e===void 0||typeof e!="function")return!0;const n=e.prototype;return!(M1(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function TJ(t){return v0(t)?{...t}:Array.isArray(t)?[...t]:t}const Awe=new Set(["string","number","symbol"]);function y0(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function yd(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n?.parent)&&(r._zod.parent=t),r}function Jt(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function kwe(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const Iwe={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Nwe(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const a=vd(t._zod.def,{get shape(){const s={};for(const o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(s[o]=n.shape[o])}return yf(this,"shape",s),s},checks:[]});return yd(t,a)}function Rwe(t,e){const n=t._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const a=vd(t._zod.def,{get shape(){const s={...t._zod.def.shape};for(const o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete s[o]}return yf(this,"shape",s),s},checks:[]});return yd(t,a)}function Pwe(t,e){if(!v0(e))throw new Error("Invalid input to extend: expected a plain object");const n=t._zod.def.checks;if(n&&n.length>0){const a=t._zod.def.shape;for(const s in e)if(Object.getOwnPropertyDescriptor(a,s)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const i=vd(t._zod.def,{get shape(){const a={...t._zod.def.shape,...e};return yf(this,"shape",a),a}});return yd(t,i)}function Dwe(t,e){if(!v0(e))throw new Error("Invalid input to safeExtend: expected a plain object");const n=vd(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e};return yf(this,"shape",r),r}});return yd(t,n)}function Owe(t,e){const n=vd(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return yf(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return yd(t,n)}function Lwe(t,e,n){const i=e._zod.def.checks;if(i&&i.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const s=vd(e._zod.def,{get shape(){const o=e._zod.def.shape,l={...o};if(n)for(const u in n){if(!(u in o))throw new Error(`Unrecognized key: "${u}"`);n[u]&&(l[u]=t?new t({type:"optional",innerType:o[u]}):o[u])}else for(const u in o)l[u]=t?new t({type:"optional",innerType:o[u]}):o[u];return yf(this,"shape",l),l},checks:[]});return yd(e,s)}function Fwe(t,e,n){const r=vd(e._zod.def,{get shape(){const i=e._zod.def.shape,a={...i};if(n)for(const s in n){if(!(s in a))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(a[s]=new t({type:"nonoptional",innerType:i[s]}))}else for(const s in i)a[s]=new t({type:"nonoptional",innerType:i[s]});return yf(this,"shape",a),a}});return yd(e,r)}function Gp(t,e=0){if(t.aborted===!0)return!0;for(let n=e;n<t.issues.length;n++)if(t.issues[n]?.continue!==!0)return!0;return!1}function Ch(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function Zx(t){return typeof t=="string"?t:t?.message}function ad(t,e,n){const r={...t,path:t.path??[]};if(!t.message){const i=Zx(t.inst?._zod.def?.error?.(t))??Zx(e?.error?.(t))??Zx(n.customError?.(t))??Zx(n.localeError?.(t))??"Invalid input";r.message=i}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}function B8(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function A1(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}const CJ=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,cI,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},MJ=ht("$ZodError",CJ),AJ=ht("$ZodError",CJ,{Parent:Error});function Bwe(t,e=n=>n.message){const n={},r=[];for(const i of t.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:n}}function Uwe(t,e=n=>n.message){const n={_errors:[]},r=i=>{for(const a of i.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(s=>r({issues:s}));else if(a.code==="invalid_key")r({issues:a.issues});else if(a.code==="invalid_element")r({issues:a.issues});else if(a.path.length===0)n._errors.push(e(a));else{let s=n,o=0;for(;o<a.path.length;){const l=a.path[o];o===a.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(e(a))):s[l]=s[l]||{_errors:[]},s=s[l],o++}}};return r(t),n}const U8=t=>(e,n,r,i)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:n,issues:[]},a);if(s instanceof Promise)throw new Qp;if(s.issues.length){const o=new(i?.Err??t)(s.issues.map(l=>ad(l,a,id())));throw EJ(o,i?.callee),o}return s.value},z8=t=>async(e,n,r,i)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:n,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){const o=new(i?.Err??t)(s.issues.map(l=>ad(l,a,id())));throw EJ(o,i?.callee),o}return s.value},e3=t=>(e,n,r)=>{const i=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new Qp;return a.issues.length?{success:!1,error:new(t??MJ)(a.issues.map(s=>ad(s,i,id())))}:{success:!0,data:a.value}},zwe=e3(AJ),t3=t=>async(e,n,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:n,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new t(a.issues.map(s=>ad(s,i,id())))}:{success:!0,data:a.value}},jwe=t3(AJ),Hwe=t=>(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return U8(t)(e,n,i)},$we=t=>(e,n,r)=>U8(t)(e,n,r),Vwe=t=>async(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return z8(t)(e,n,i)},qwe=t=>async(e,n,r)=>z8(t)(e,n,r),Gwe=t=>(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return e3(t)(e,n,i)},Wwe=t=>(e,n,r)=>e3(t)(e,n,r),Ywe=t=>async(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return t3(t)(e,n,i)},Xwe=t=>async(e,n,r)=>t3(t)(e,n,r),Kwe=/^[cC][^\s-]{8,}$/,Zwe=/^[0-9a-z]+$/,Jwe=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Qwe=/^[0-9a-vA-V]{20}$/,e2e=/^[A-Za-z0-9]{27}$/,t2e=/^[a-zA-Z0-9_-]{21}$/,n2e=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,r2e=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,gF=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,i2e=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,a2e="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function s2e(){return new RegExp(a2e,"u")}const o2e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,l2e=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,u2e=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,c2e=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,d2e=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,kJ=/^[A-Za-z0-9_-]*$/,h2e=/^\+[1-9]\d{6,14}$/,IJ="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",f2e=new RegExp(`^${IJ}$`);function NJ(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function p2e(t){return new RegExp(`^${NJ(t)}$`)}function m2e(t){const e=NJ({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${IJ}T(?:${r})$`)}const g2e=t=>{const e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},v2e=/^-?\d+$/,RJ=/^-?\d+(?:\.\d+)?$/,y2e=/^(?:true|false)$/i,x2e=/^null$/i,b2e=/^[^A-Z]*$/,_2e=/^[^a-z]*$/,Ts=ht("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),PJ={number:"number",bigint:"bigint",object:"date"},DJ=ht("$ZodCheckLessThan",(t,e)=>{Ts.init(t,e);const n=PJ[typeof e.value];t._zod.onattach.push(r=>{const i=r._zod.bag,a=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<a&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),OJ=ht("$ZodCheckGreaterThan",(t,e)=>{Ts.init(t,e);const n=PJ[typeof e.value];t._zod.onattach.push(r=>{const i=r._zod.bag,a=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>a&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),w2e=ht("$ZodCheckMultipleOf",(t,e)=>{Ts.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):Twe(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),S2e=ht("$ZodCheckNumberFormat",(t,e)=>{Ts.init(t,e),e.format=e.format||"float64";const n=e.format?.includes("int"),r=n?"int":"number",[i,a]=Iwe[e.format];t._zod.onattach.push(s=>{const o=s._zod.bag;o.format=e.format,o.minimum=i,o.maximum=a,n&&(o.pattern=v2e)}),t._zod.check=s=>{const o=s.value;if(n){if(!Number.isInteger(o)){s.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:o,inst:t});return}if(!Number.isSafeInteger(o)){o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,inclusive:!0,continue:!e.abort});return}}o<i&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:i,inclusive:!0,inst:t,continue:!e.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inclusive:!0,inst:t,continue:!e.abort})}}),E2e=ht("$ZodCheckMaxLength",(t,e)=>{var n;Ts.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!L8(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const i=r.value;if(i.length<=e.maximum)return;const s=B8(i);r.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),T2e=ht("$ZodCheckMinLength",(t,e)=>{var n;Ts.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!L8(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const i=r.value;if(i.length>=e.minimum)return;const s=B8(i);r.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),C2e=ht("$ZodCheckLengthEquals",(t,e)=>{var n;Ts.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!L8(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),t._zod.check=r=>{const i=r.value,a=i.length;if(a===e.length)return;const s=B8(i),o=a>e.length;r.issues.push({origin:s,...o?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),n3=ht("$ZodCheckStringFormat",(t,e)=>{var n,r;Ts.init(t,e),t._zod.onattach.push(i=>{const a=i._zod.bag;a.format=e.format,e.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),M2e=ht("$ZodCheckRegex",(t,e)=>{n3.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),A2e=ht("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=b2e),n3.init(t,e)}),k2e=ht("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=_2e),n3.init(t,e)}),I2e=ht("$ZodCheckIncludes",(t,e)=>{Ts.init(t,e);const n=y0(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(i=>{const a=i._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),t._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:t,continue:!e.abort})}}),N2e=ht("$ZodCheckStartsWith",(t,e)=>{Ts.init(t,e);const n=new RegExp(`^${y0(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),R2e=ht("$ZodCheckEndsWith",(t,e)=>{Ts.init(t,e);const n=new RegExp(`.*${y0(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}}),P2e=ht("$ZodCheckOverwrite",(t,e)=>{Ts.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class D2e{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(s=>s),i=Math.min(...r.map(s=>s.length-s.trimStart().length)),a=r.map(s=>s.slice(i)).map(s=>" ".repeat(this.indent*2)+s);for(const s of a)this.content.push(s)}compile(){const e=Function,n=this?.args,i=[...(this?.content??[""]).map(a=>`  ${a}`)];return new e(...n,i.join(`
`))}}const O2e={major:4,minor:3,patch:5},Ar=ht("$ZodType",(t,e)=>{var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=O2e;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const i of r)for(const a of i._zod.onattach)a(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{const i=(s,o,l)=>{let u=Gp(s),c;for(const d of o){if(d._zod.def.when){if(!d._zod.def.when(s))continue}else if(u)continue;const h=s.issues.length,f=d._zod.check(s);if(f instanceof Promise&&l?.async===!1)throw new Qp;if(c||f instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await f,s.issues.length!==h&&(u||(u=Gp(s,h)))});else{if(s.issues.length===h)continue;u||(u=Gp(s,h))}}return c?c.then(()=>s):s},a=(s,o,l)=>{if(Gp(s))return s.aborted=!0,s;const u=i(o,r,l);if(u instanceof Promise){if(l.async===!1)throw new Qp;return u.then(c=>t._zod.parse(c,l))}return t._zod.parse(u,l)};t._zod.run=(s,o)=>{if(o.skipChecks)return t._zod.parse(s,o);if(o.direction==="backward"){const u=t._zod.parse({value:s.value,issues:[]},{...o,skipChecks:!0});return u instanceof Promise?u.then(c=>a(c,s,o)):a(u,s,o)}const l=t._zod.parse(s,o);if(l instanceof Promise){if(o.async===!1)throw new Qp;return l.then(u=>i(u,r,o))}return i(l,r,o)}}tr(t,"~standard",()=>({validate:i=>{try{const a=zwe(t,i);return a.success?{value:a.data}:{issues:a.error?.issues}}catch{return jwe(t,i).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}))}),j8=ht("$ZodString",(t,e)=>{Ar.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??g2e(t._zod.bag),t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:t}),n}}),Jr=ht("$ZodStringFormat",(t,e)=>{n3.init(t,e),j8.init(t,e)}),L2e=ht("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=r2e),Jr.init(t,e)}),F2e=ht("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=gF(r))}else e.pattern??(e.pattern=gF());Jr.init(t,e)}),B2e=ht("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=i2e),Jr.init(t,e)}),U2e=ht("$ZodURL",(t,e)=>{Jr.init(t,e),t._zod.check=n=>{try{const r=n.value.trim(),i=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),e.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),z2e=ht("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=s2e()),Jr.init(t,e)}),j2e=ht("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=t2e),Jr.init(t,e)}),H2e=ht("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=Kwe),Jr.init(t,e)}),$2e=ht("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=Zwe),Jr.init(t,e)}),V2e=ht("$ZodULID",(t,e)=>{e.pattern??(e.pattern=Jwe),Jr.init(t,e)}),q2e=ht("$ZodXID",(t,e)=>{e.pattern??(e.pattern=Qwe),Jr.init(t,e)}),G2e=ht("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=e2e),Jr.init(t,e)}),W2e=ht("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=m2e(e)),Jr.init(t,e)}),Y2e=ht("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=f2e),Jr.init(t,e)}),X2e=ht("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=p2e(e)),Jr.init(t,e)}),K2e=ht("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=n2e),Jr.init(t,e)}),Z2e=ht("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=o2e),Jr.init(t,e),t._zod.bag.format="ipv4"}),J2e=ht("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=l2e),Jr.init(t,e),t._zod.bag.format="ipv6",t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),Q2e=ht("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=u2e),Jr.init(t,e)}),e3e=ht("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=c2e),Jr.init(t,e),t._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[i,a]=r;if(!a)throw new Error;const s=Number(a);if(`${s}`!==a)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${i}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function LJ(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const t3e=ht("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=d2e),Jr.init(t,e),t._zod.bag.contentEncoding="base64",t._zod.check=n=>{LJ(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function n3e(t){if(!kJ.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return LJ(n)}const r3e=ht("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=kJ),Jr.init(t,e),t._zod.bag.contentEncoding="base64url",t._zod.check=n=>{n3e(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),i3e=ht("$ZodE164",(t,e)=>{e.pattern??(e.pattern=h2e),Jr.init(t,e)});function a3e(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const i=JSON.parse(atob(r));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}const s3e=ht("$ZodJWT",(t,e)=>{Jr.init(t,e),t._zod.check=n=>{a3e(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),FJ=ht("$ZodNumber",(t,e)=>{Ar.init(t,e),t._zod.pattern=t._zod.bag.pattern??RJ,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const i=n.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return n;const a=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:i,inst:t,...a?{received:a}:{}}),n}}),o3e=ht("$ZodNumberFormat",(t,e)=>{S2e.init(t,e),FJ.init(t,e)}),l3e=ht("$ZodBoolean",(t,e)=>{Ar.init(t,e),t._zod.pattern=y2e,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=!!n.value}catch{}const i=n.value;return typeof i=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:t}),n}}),u3e=ht("$ZodNull",(t,e)=>{Ar.init(t,e),t._zod.pattern=x2e,t._zod.values=new Set([null]),t._zod.parse=(n,r)=>{const i=n.value;return i===null||n.issues.push({expected:"null",code:"invalid_type",input:i,inst:t}),n}}),c3e=ht("$ZodAny",(t,e)=>{Ar.init(t,e),t._zod.parse=n=>n}),d3e=ht("$ZodUnknown",(t,e)=>{Ar.init(t,e),t._zod.parse=n=>n}),h3e=ht("$ZodNever",(t,e)=>{Ar.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)});function vF(t,e,n){t.issues.length&&e.issues.push(...Ch(n,t.issues)),e.value[n]=t.value}const f3e=ht("$ZodArray",(t,e)=>{Ar.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!Array.isArray(i))return n.issues.push({expected:"array",code:"invalid_type",input:i,inst:t}),n;n.value=Array(i.length);const a=[];for(let s=0;s<i.length;s++){const o=i[s],l=e.element._zod.run({value:o,issues:[]},r);l instanceof Promise?a.push(l.then(u=>vF(u,n,s))):vF(l,n,s)}return a.length?Promise.all(a).then(()=>n):n}});function lw(t,e,n,r,i){if(t.issues.length){if(i&&!(n in r))return;e.issues.push(...Ch(n,t.issues))}t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}function BJ(t){const e=Object.keys(t.shape);for(const r of e)if(!t.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=kwe(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}}function UJ(t,e,n,r,i,a){const s=[],o=i.keySet,l=i.catchall._zod,u=l.def.type,c=l.optout==="optional";for(const d in e){if(o.has(d))continue;if(u==="never"){s.push(d);continue}const h=l.run({value:e[d],issues:[]},r);h instanceof Promise?t.push(h.then(f=>lw(f,n,d,e,c))):lw(h,n,d,e,c)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:a}),t.length?Promise.all(t).then(()=>n):n}const p3e=ht("$ZodObject",(t,e)=>{if(Ar.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){const o=e.shape;Object.defineProperty(e,"shape",{get:()=>{const l={...o};return Object.defineProperty(e,"shape",{value:l}),l}})}const r=Q2(()=>BJ(e));tr(t._zod,"propValues",()=>{const o=e.shape,l={};for(const u in o){const c=o[u]._zod;if(c.values){l[u]??(l[u]=new Set);for(const d of c.values)l[u].add(d)}}return l});const i=M1,a=e.catchall;let s;t._zod.parse=(o,l)=>{s??(s=r.value);const u=o.value;if(!i(u))return o.issues.push({expected:"object",code:"invalid_type",input:u,inst:t}),o;o.value={};const c=[],d=s.shape;for(const h of s.keys){const f=d[h],m=f._zod.optout==="optional",x=f._zod.run({value:u[h],issues:[]},l);x instanceof Promise?c.push(x.then(b=>lw(b,o,h,u,m))):lw(x,o,h,u,m)}return a?UJ(c,u,o,l,r.value,t):c.length?Promise.all(c).then(()=>o):o}}),m3e=ht("$ZodObjectJIT",(t,e)=>{p3e.init(t,e);const n=t._zod.parse,r=Q2(()=>BJ(e)),i=h=>{const f=new D2e(["shape","payload","ctx"]),m=r.value,x=_=>{const S=mF(_);return`shape[${S}]._zod.run({ value: input[${S}], issues: [] }, ctx)`};f.write("const input = payload.value;");const b=Object.create(null);let y=0;for(const _ of m.keys)b[_]=`key_${y++}`;f.write("const newResult = {};");for(const _ of m.keys){const S=b[_],M=mF(_),C=h[_]?._zod?.optout==="optional";f.write(`const ${S} = ${x(_)};`),C?f.write(`
        if (${S}.issues.length) {
          if (${M} in input) {
            payload.issues = payload.issues.concat(${S}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${M}, ...iss.path] : [${M}]
            })));
          }
        }
        
        if (${S}.value === undefined) {
          if (${M} in input) {
            newResult[${M}] = undefined;
          }
        } else {
          newResult[${M}] = ${S}.value;
        }
        
      `):f.write(`
        if (${S}.issues.length) {
          payload.issues = payload.issues.concat(${S}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${M}, ...iss.path] : [${M}]
          })));
        }
        
        if (${S}.value === undefined) {
          if (${M} in input) {
            newResult[${M}] = undefined;
          }
        } else {
          newResult[${M}] = ${S}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const w=f.compile();return(_,S)=>w(h,_,S)};let a;const s=M1,o=!wJ.jitless,u=o&&Mwe.value,c=e.catchall;let d;t._zod.parse=(h,f)=>{d??(d=r.value);const m=h.value;return s(m)?o&&u&&f?.async===!1&&f.jitless!==!0?(a||(a=i(e.shape)),h=a(h,f),c?UJ([],m,h,f,d,t):h):n(h,f):(h.issues.push({expected:"object",code:"invalid_type",input:m,inst:t}),h)}});function yF(t,e,n,r){for(const a of t)if(a.issues.length===0)return e.value=a.value,e;const i=t.filter(a=>!Gp(a));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(a=>a.issues.map(s=>ad(s,r,id())))}),e)}const zJ=ht("$ZodUnion",(t,e)=>{Ar.init(t,e),tr(t._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),tr(t._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),tr(t._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),tr(t._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){const i=e.options.map(a=>a._zod.pattern);return new RegExp(`^(${i.map(a=>F8(a.source)).join("|")})$`)}});const n=e.options.length===1,r=e.options[0]._zod.run;t._zod.parse=(i,a)=>{if(n)return r(i,a);let s=!1;const o=[];for(const l of e.options){const u=l._zod.run({value:i.value,issues:[]},a);if(u instanceof Promise)o.push(u),s=!0;else{if(u.issues.length===0)return u;o.push(u)}}return s?Promise.all(o).then(l=>yF(l,i,t,a)):yF(o,i,t,a)}}),g3e=ht("$ZodDiscriminatedUnion",(t,e)=>{e.inclusive=!1,zJ.init(t,e);const n=t._zod.parse;tr(t._zod,"propValues",()=>{const i={};for(const a of e.options){const s=a._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(a)}"`);for(const[o,l]of Object.entries(s)){i[o]||(i[o]=new Set);for(const u of l)i[o].add(u)}}return i});const r=Q2(()=>{const i=e.options,a=new Map;for(const s of i){const o=s._zod.propValues?.[e.discriminator];if(!o||o.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(const l of o){if(a.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);a.set(l,s)}}return a});t._zod.parse=(i,a)=>{const s=i.value;if(!M1(s))return i.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),i;const o=r.value.get(s?.[e.discriminator]);return o?o._zod.run(i,a):e.unionFallback?n(i,a):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),i)}}),v3e=ht("$ZodIntersection",(t,e)=>{Ar.init(t,e),t._zod.parse=(n,r)=>{const i=n.value,a=e.left._zod.run({value:i,issues:[]},r),s=e.right._zod.run({value:i,issues:[]},r);return a instanceof Promise||s instanceof Promise?Promise.all([a,s]).then(([l,u])=>xF(n,l,u)):xF(n,a,s)}});function dI(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(v0(t)&&v0(e)){const n=Object.keys(e),r=Object.keys(t).filter(a=>n.indexOf(a)!==-1),i={...t,...e};for(const a of r){const s=dI(t[a],e[a]);if(!s.valid)return{valid:!1,mergeErrorPath:[a,...s.mergeErrorPath]};i[a]=s.data}return{valid:!0,data:i}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const i=t[r],a=e[r],s=dI(i,a);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function xF(t,e,n){const r=new Map;let i;for(const o of e.issues)if(o.code==="unrecognized_keys"){i??(i=o);for(const l of o.keys)r.has(l)||r.set(l,{}),r.get(l).l=!0}else t.issues.push(o);for(const o of n.issues)if(o.code==="unrecognized_keys")for(const l of o.keys)r.has(l)||r.set(l,{}),r.get(l).r=!0;else t.issues.push(o);const a=[...r].filter(([,o])=>o.l&&o.r).map(([o])=>o);if(a.length&&i&&t.issues.push({...i,keys:a}),Gp(t))return t;const s=dI(e.value,n.value);if(!s.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return t.value=s.data,t}const y3e=ht("$ZodTuple",(t,e)=>{Ar.init(t,e);const n=e.items;t._zod.parse=(r,i)=>{const a=r.value;if(!Array.isArray(a))return r.issues.push({input:a,inst:t,expected:"tuple",code:"invalid_type"}),r;r.value=[];const s=[],o=[...n].reverse().findIndex(c=>c._zod.optin!=="optional"),l=o===-1?0:n.length-o;if(!e.rest){const c=a.length>n.length,d=a.length<l-1;if(c||d)return r.issues.push({...c?{code:"too_big",maximum:n.length,inclusive:!0}:{code:"too_small",minimum:n.length},input:a,inst:t,origin:"array"}),r}let u=-1;for(const c of n){if(u++,u>=a.length&&u>=l)continue;const d=c._zod.run({value:a[u],issues:[]},i);d instanceof Promise?s.push(d.then(h=>Jx(h,r,u))):Jx(d,r,u)}if(e.rest){const c=a.slice(n.length);for(const d of c){u++;const h=e.rest._zod.run({value:d,issues:[]},i);h instanceof Promise?s.push(h.then(f=>Jx(f,r,u))):Jx(h,r,u)}}return s.length?Promise.all(s).then(()=>r):r}});function Jx(t,e,n){t.issues.length&&e.issues.push(...Ch(n,t.issues)),e.value[n]=t.value}const x3e=ht("$ZodRecord",(t,e)=>{Ar.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!v0(i))return n.issues.push({expected:"record",code:"invalid_type",input:i,inst:t}),n;const a=[],s=e.keyType._zod.values;if(s){n.value={};const o=new Set;for(const u of s)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){o.add(typeof u=="number"?u.toString():u);const c=e.valueType._zod.run({value:i[u],issues:[]},r);c instanceof Promise?a.push(c.then(d=>{d.issues.length&&n.issues.push(...Ch(u,d.issues)),n.value[u]=d.value})):(c.issues.length&&n.issues.push(...Ch(u,c.issues)),n.value[u]=c.value)}let l;for(const u in i)o.has(u)||(l=l??[],l.push(u));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:i,inst:t,keys:l})}else{n.value={};for(const o of Reflect.ownKeys(i)){if(o==="__proto__")continue;let l=e.keyType._zod.run({value:o,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof o=="string"&&RJ.test(o)&&l.issues.length&&l.issues.some(d=>d.code==="invalid_type"&&d.expected==="number")){const d=e.keyType._zod.run({value:Number(o),issues:[]},r);if(d instanceof Promise)throw new Error("Async schemas not supported in object keys currently");d.issues.length===0&&(l=d)}if(l.issues.length){e.mode==="loose"?n.value[o]=i[o]:n.issues.push({code:"invalid_key",origin:"record",issues:l.issues.map(d=>ad(d,r,id())),input:o,path:[o],inst:t});continue}const c=e.valueType._zod.run({value:i[o],issues:[]},r);c instanceof Promise?a.push(c.then(d=>{d.issues.length&&n.issues.push(...Ch(o,d.issues)),n.value[l.value]=d.value})):(c.issues.length&&n.issues.push(...Ch(o,c.issues)),n.value[l.value]=c.value)}}return a.length?Promise.all(a).then(()=>n):n}}),b3e=ht("$ZodEnum",(t,e)=>{Ar.init(t,e);const n=SJ(e.entries),r=new Set(n);t._zod.values=r,t._zod.pattern=new RegExp(`^(${n.filter(i=>Awe.has(typeof i)).map(i=>typeof i=="string"?y0(i):i.toString()).join("|")})$`),t._zod.parse=(i,a)=>{const s=i.value;return r.has(s)||i.issues.push({code:"invalid_value",values:n,input:s,inst:t}),i}}),_3e=ht("$ZodLiteral",(t,e)=>{if(Ar.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(e.values);t._zod.values=n,t._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?y0(r):r?y0(r.toString()):String(r)).join("|")})$`),t._zod.parse=(r,i)=>{const a=r.value;return n.has(a)||r.issues.push({code:"invalid_value",values:e.values,input:a,inst:t}),r}}),w3e=ht("$ZodTransform",(t,e)=>{Ar.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new _J(t.constructor.name);const i=e.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(s=>(n.value=s,n));if(i instanceof Promise)throw new Qp;return n.value=i,n}});function bF(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}const jJ=ht("$ZodOptional",(t,e)=>{Ar.init(t,e),t._zod.optin="optional",t._zod.optout="optional",tr(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),tr(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${F8(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>{if(e.innerType._zod.optin==="optional"){const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(a=>bF(a,n.value)):bF(i,n.value)}return n.value===void 0?n:e.innerType._zod.run(n,r)}}),S3e=ht("$ZodExactOptional",(t,e)=>{jJ.init(t,e),tr(t._zod,"values",()=>e.innerType._zod.values),tr(t._zod,"pattern",()=>e.innerType._zod.pattern),t._zod.parse=(n,r)=>e.innerType._zod.run(n,r)}),E3e=ht("$ZodNullable",(t,e)=>{Ar.init(t,e),tr(t._zod,"optin",()=>e.innerType._zod.optin),tr(t._zod,"optout",()=>e.innerType._zod.optout),tr(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${F8(n.source)}|null)$`):void 0}),tr(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),T3e=ht("$ZodDefault",(t,e)=>{Ar.init(t,e),t._zod.optin="optional",tr(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);if(n.value===void 0)return n.value=e.defaultValue,n;const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(a=>_F(a,e)):_F(i,e)}});function _F(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const C3e=ht("$ZodPrefault",(t,e)=>{Ar.init(t,e),t._zod.optin="optional",tr(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),M3e=ht("$ZodNonOptional",(t,e)=>{Ar.init(t,e),tr(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(a=>wF(a,t)):wF(i,t)}});function wF(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const A3e=ht("$ZodCatch",(t,e)=>{Ar.init(t,e),tr(t._zod,"optin",()=>e.innerType._zod.optin),tr(t._zod,"optout",()=>e.innerType._zod.optout),tr(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(a=>(n.value=a.value,a.issues.length&&(n.value=e.catchValue({...n,error:{issues:a.issues.map(s=>ad(s,r,id()))},input:n.value}),n.issues=[]),n)):(n.value=i.value,i.issues.length&&(n.value=e.catchValue({...n,error:{issues:i.issues.map(a=>ad(a,r,id()))},input:n.value}),n.issues=[]),n)}}),k3e=ht("$ZodPipe",(t,e)=>{Ar.init(t,e),tr(t._zod,"values",()=>e.in._zod.values),tr(t._zod,"optin",()=>e.in._zod.optin),tr(t._zod,"optout",()=>e.out._zod.optout),tr(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if(r.direction==="backward"){const a=e.out._zod.run(n,r);return a instanceof Promise?a.then(s=>Qx(s,e.in,r)):Qx(a,e.in,r)}const i=e.in._zod.run(n,r);return i instanceof Promise?i.then(a=>Qx(a,e.out,r)):Qx(i,e.out,r)}});function Qx(t,e,n){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},n)}const I3e=ht("$ZodReadonly",(t,e)=>{Ar.init(t,e),tr(t._zod,"propValues",()=>e.innerType._zod.propValues),tr(t._zod,"values",()=>e.innerType._zod.values),tr(t._zod,"optin",()=>e.innerType?._zod?.optin),tr(t._zod,"optout",()=>e.innerType?._zod?.optout),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(SF):SF(i)}});function SF(t){return t.value=Object.freeze(t.value),t}const N3e=ht("$ZodLazy",(t,e)=>{Ar.init(t,e),tr(t._zod,"innerType",()=>e.getter()),tr(t._zod,"pattern",()=>t._zod.innerType?._zod?.pattern),tr(t._zod,"propValues",()=>t._zod.innerType?._zod?.propValues),tr(t._zod,"optin",()=>t._zod.innerType?._zod?.optin??void 0),tr(t._zod,"optout",()=>t._zod.innerType?._zod?.optout??void 0),t._zod.parse=(n,r)=>t._zod.innerType._zod.run(n,r)}),R3e=ht("$ZodCustom",(t,e)=>{Ts.init(t,e),Ar.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,i=e.fn(r);if(i instanceof Promise)return i.then(a=>EF(a,n,r,t));EF(i,n,r,t)}});function EF(t,e,n,r){if(!t){const i={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),e.issues.push(A1(i))}}var TF;class P3e{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...n){const r=n[0];return this._map.set(e,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function D3e(){return new P3e}(TF=globalThis).__zod_globalRegistry??(TF.__zod_globalRegistry=D3e());const yg=globalThis.__zod_globalRegistry;function O3e(t,e){return new t({type:"string",...Jt(e)})}function L3e(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...Jt(e)})}function CF(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...Jt(e)})}function F3e(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...Jt(e)})}function B3e(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Jt(e)})}function U3e(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Jt(e)})}function z3e(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Jt(e)})}function j3e(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...Jt(e)})}function H3e(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...Jt(e)})}function $3e(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...Jt(e)})}function V3e(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...Jt(e)})}function q3e(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...Jt(e)})}function G3e(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...Jt(e)})}function W3e(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...Jt(e)})}function Y3e(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...Jt(e)})}function X3e(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...Jt(e)})}function K3e(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...Jt(e)})}function Z3e(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Jt(e)})}function J3e(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Jt(e)})}function Q3e(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...Jt(e)})}function eSe(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...Jt(e)})}function tSe(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...Jt(e)})}function nSe(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...Jt(e)})}function rSe(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Jt(e)})}function iSe(t,e){return new t({type:"string",format:"date",check:"string_format",...Jt(e)})}function aSe(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...Jt(e)})}function sSe(t,e){return new t({type:"string",format:"duration",check:"string_format",...Jt(e)})}function oSe(t,e){return new t({type:"number",checks:[],...Jt(e)})}function lSe(t,e){return new t({type:"number",coerce:!0,checks:[],...Jt(e)})}function uSe(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...Jt(e)})}function cSe(t,e){return new t({type:"boolean",...Jt(e)})}function dSe(t,e){return new t({type:"null",...Jt(e)})}function hSe(t){return new t({type:"any"})}function fSe(t){return new t({type:"unknown"})}function pSe(t,e){return new t({type:"never",...Jt(e)})}function MF(t,e){return new DJ({check:"less_than",...Jt(e),value:t,inclusive:!1})}function UE(t,e){return new DJ({check:"less_than",...Jt(e),value:t,inclusive:!0})}function AF(t,e){return new OJ({check:"greater_than",...Jt(e),value:t,inclusive:!1})}function zE(t,e){return new OJ({check:"greater_than",...Jt(e),value:t,inclusive:!0})}function kF(t,e){return new w2e({check:"multiple_of",...Jt(e),value:t})}function HJ(t,e){return new E2e({check:"max_length",...Jt(e),maximum:t})}function uw(t,e){return new T2e({check:"min_length",...Jt(e),minimum:t})}function $J(t,e){return new C2e({check:"length_equals",...Jt(e),length:t})}function mSe(t,e){return new M2e({check:"string_format",format:"regex",...Jt(e),pattern:t})}function gSe(t){return new A2e({check:"string_format",format:"lowercase",...Jt(t)})}function vSe(t){return new k2e({check:"string_format",format:"uppercase",...Jt(t)})}function ySe(t,e){return new I2e({check:"string_format",format:"includes",...Jt(e),includes:t})}function xSe(t,e){return new N2e({check:"string_format",format:"starts_with",...Jt(e),prefix:t})}function bSe(t,e){return new R2e({check:"string_format",format:"ends_with",...Jt(e),suffix:t})}function V0(t){return new P2e({check:"overwrite",tx:t})}function _Se(t){return V0(e=>e.normalize(t))}function wSe(){return V0(t=>t.trim())}function SSe(){return V0(t=>t.toLowerCase())}function ESe(){return V0(t=>t.toUpperCase())}function TSe(){return V0(t=>Cwe(t))}function CSe(t,e,n){return new t({type:"array",element:e,...Jt(n)})}function MSe(t,e,n){const r=Jt(n);return r.abort??(r.abort=!0),new t({type:"custom",check:"custom",fn:e,...r})}function ASe(t,e,n){return new t({type:"custom",check:"custom",fn:e,...Jt(n)})}function kSe(t){const e=ISe(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(A1(r,n.value,e._zod.def));else{const i=r;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),n.issues.push(A1(i))}},t(n.value,n)));return e}function ISe(t,e){const n=new Ts({check:"custom",...Jt(e)});return n._zod.check=t,n}function cw(t){let e=t?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:t.processors??{},metadataRegistry:t?.metadata??yg,target:e,unrepresentable:t?.unrepresentable??"throw",override:t?.override??(()=>{}),io:t?.io??"output",counter:0,seen:new Map,cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0}}function jr(t,e,n={path:[],schemaPath:[]}){var r;const i=t._zod.def,a=e.seen.get(t);if(a)return a.count++,n.schemaPath.includes(t)&&(a.cycle=n.path),a.schema;const s={schema:{},count:1,cycle:void 0,path:n.path};e.seen.set(t,s);const o=t._zod.toJSONSchema?.();if(o)s.schema=o;else{const c={...n,schemaPath:[...n.schemaPath,t],path:n.path};if(t._zod.processJSONSchema)t._zod.processJSONSchema(e,s.schema,c);else{const h=s.schema,f=e.processors[i.type];if(!f)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);f(t,e,h,c)}const d=t._zod.parent;d&&(s.ref||(s.ref=d),jr(d,e,c),e.seen.get(d).isParent=!0)}const l=e.metadataRegistry.get(t);return l&&Object.assign(s.schema,l),e.io==="input"&&Ya(t)&&(delete s.schema.examples,delete s.schema.default),e.io==="input"&&s.schema._prefault&&((r=s.schema).default??(r.default=s.schema._prefault)),delete s.schema._prefault,e.seen.get(t).schema}function dw(t,e){const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const s of t.seen.entries()){const o=t.metadataRegistry.get(s[0])?.id;if(o){const l=r.get(o);if(l&&l!==s[0])throw new Error(`Duplicate schema id "${o}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(o,s[0])}}const i=s=>{const o=t.target==="draft-2020-12"?"$defs":"definitions";if(t.external){const d=t.external.registry.get(s[0])?.id,h=t.external.uri??(m=>m);if(d)return{ref:h(d)};const f=s[1].defId??s[1].schema.id??`schema${t.counter++}`;return s[1].defId=f,{defId:f,ref:`${h("__shared")}#/${o}/${f}`}}if(s[1]===n)return{ref:"#"};const u=`#/${o}/`,c=s[1].schema.id??`__schema${t.counter++}`;return{defId:c,ref:u+c}},a=s=>{if(s[1].schema.$ref)return;const o=s[1],{ref:l,defId:u}=i(s);o.def={...o.schema},u&&(o.defId=u);const c=o.schema;for(const d in c)delete c[d];c.$ref=l};if(t.cycles==="throw")for(const s of t.seen.entries()){const o=s[1];if(o.cycle)throw new Error(`Cycle detected: #/${o.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const s of t.seen.entries()){const o=s[1];if(e===s[0]){a(s);continue}if(t.external){const u=t.external.registry.get(s[0])?.id;if(e!==s[0]&&u){a(s);continue}}if(t.metadataRegistry.get(s[0])?.id){a(s);continue}if(o.cycle){a(s);continue}if(o.count>1&&t.reused==="ref"){a(s);continue}}}function hw(t,e){const n=t.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=s=>{const o=t.seen.get(s);if(o.ref===null)return;const l=o.def??o.schema,u={...l},c=o.ref;if(o.ref=null,c){r(c);const h=t.seen.get(c),f=h.schema;if(f.$ref&&(t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0")?(l.allOf=l.allOf??[],l.allOf.push(f)):Object.assign(l,f),Object.assign(l,u),s._zod.parent===c)for(const x in l)x==="$ref"||x==="allOf"||x in u||delete l[x];if(f.$ref)for(const x in l)x==="$ref"||x==="allOf"||x in h.def&&JSON.stringify(l[x])===JSON.stringify(h.def[x])&&delete l[x]}const d=s._zod.parent;if(d&&d!==c){r(d);const h=t.seen.get(d);if(h?.schema.$ref&&(l.$ref=h.schema.$ref,h.def))for(const f in l)f==="$ref"||f==="allOf"||f in h.def&&JSON.stringify(l[f])===JSON.stringify(h.def[f])&&delete l[f]}t.override({zodSchema:s,jsonSchema:l,path:o.path??[]})};for(const s of[...t.seen.entries()].reverse())r(s[0]);const i={};if(t.target==="draft-2020-12"?i.$schema="https://json-schema.org/draft/2020-12/schema":t.target==="draft-07"?i.$schema="http://json-schema.org/draft-07/schema#":t.target==="draft-04"?i.$schema="http://json-schema.org/draft-04/schema#":t.target,t.external?.uri){const s=t.external.registry.get(e)?.id;if(!s)throw new Error("Schema is missing an `id` property");i.$id=t.external.uri(s)}Object.assign(i,n.def??n.schema);const a=t.external?.defs??{};for(const s of t.seen.entries()){const o=s[1];o.def&&o.defId&&(a[o.defId]=o.def)}t.external||Object.keys(a).length>0&&(t.target==="draft-2020-12"?i.$defs=a:i.definitions=a);try{const s=JSON.parse(JSON.stringify(i));return Object.defineProperty(s,"~standard",{value:{...e["~standard"],jsonSchema:{input:fw(e,"input",t.processors),output:fw(e,"output",t.processors)}},enumerable:!1,writable:!1}),s}catch{throw new Error("Error converting schema to JSON.")}}function Ya(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const r=t._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return Ya(r.element,n);if(r.type==="set")return Ya(r.valueType,n);if(r.type==="lazy")return Ya(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return Ya(r.innerType,n);if(r.type==="intersection")return Ya(r.left,n)||Ya(r.right,n);if(r.type==="record"||r.type==="map")return Ya(r.keyType,n)||Ya(r.valueType,n);if(r.type==="pipe")return Ya(r.in,n)||Ya(r.out,n);if(r.type==="object"){for(const i in r.shape)if(Ya(r.shape[i],n))return!0;return!1}if(r.type==="union"){for(const i of r.options)if(Ya(i,n))return!0;return!1}if(r.type==="tuple"){for(const i of r.items)if(Ya(i,n))return!0;return!!(r.rest&&Ya(r.rest,n))}return!1}const NSe=(t,e={})=>n=>{const r=cw({...n,processors:e});return jr(t,r),dw(r,t),hw(r,t)},fw=(t,e,n={})=>r=>{const{libraryOptions:i,target:a}=r??{},s=cw({...i??{},target:a,io:e,processors:n});return jr(t,s),dw(s,t),hw(s,t)},RSe={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},VJ=(t,e,n,r)=>{const i=n;i.type="string";const{minimum:a,maximum:s,format:o,patterns:l,contentEncoding:u}=t._zod.bag;if(typeof a=="number"&&(i.minLength=a),typeof s=="number"&&(i.maxLength=s),o&&(i.format=RSe[o]??o,i.format===""&&delete i.format,o==="time"&&delete i.format),u&&(i.contentEncoding=u),l&&l.size>0){const c=[...l];c.length===1?i.pattern=c[0].source:c.length>1&&(i.allOf=[...c.map(d=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},qJ=(t,e,n,r)=>{const i=n,{minimum:a,maximum:s,format:o,multipleOf:l,exclusiveMaximum:u,exclusiveMinimum:c}=t._zod.bag;typeof o=="string"&&o.includes("int")?i.type="integer":i.type="number",typeof c=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.minimum=c,i.exclusiveMinimum=!0):i.exclusiveMinimum=c),typeof a=="number"&&(i.minimum=a,typeof c=="number"&&e.target!=="draft-04"&&(c>=a?delete i.minimum:delete i.exclusiveMinimum)),typeof u=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.maximum=u,i.exclusiveMaximum=!0):i.exclusiveMaximum=u),typeof s=="number"&&(i.maximum=s,typeof u=="number"&&e.target!=="draft-04"&&(u<=s?delete i.maximum:delete i.exclusiveMaximum)),typeof l=="number"&&(i.multipleOf=l)},GJ=(t,e,n,r)=>{n.type="boolean"},PSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},DSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},WJ=(t,e,n,r)=>{e.target==="openapi-3.0"?(n.type="string",n.nullable=!0,n.enum=[null]):n.type="null"},OSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},LSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},YJ=(t,e,n,r)=>{n.not={}},XJ=(t,e,n,r)=>{},KJ=(t,e,n,r)=>{},FSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},ZJ=(t,e,n,r)=>{const i=t._zod.def,a=SJ(i.entries);a.every(s=>typeof s=="number")&&(n.type="number"),a.every(s=>typeof s=="string")&&(n.type="string"),n.enum=a},JJ=(t,e,n,r)=>{const i=t._zod.def,a=[];for(const s of i.values)if(s===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof s=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");a.push(Number(s))}else a.push(s);if(a.length!==0)if(a.length===1){const s=a[0];n.type=s===null?"null":typeof s,e.target==="draft-04"||e.target==="openapi-3.0"?n.enum=[s]:n.const=s}else a.every(s=>typeof s=="number")&&(n.type="number"),a.every(s=>typeof s=="string")&&(n.type="string"),a.every(s=>typeof s=="boolean")&&(n.type="boolean"),a.every(s=>s===null)&&(n.type="null"),n.enum=a},BSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},USe=(t,e,n,r)=>{const i=n,a=t._zod.pattern;if(!a)throw new Error("Pattern not found in template literal");i.type="string",i.pattern=a.source},zSe=(t,e,n,r)=>{const i=n,a={type:"string",format:"binary",contentEncoding:"binary"},{minimum:s,maximum:o,mime:l}=t._zod.bag;s!==void 0&&(a.minLength=s),o!==void 0&&(a.maxLength=o),l?l.length===1?(a.contentMediaType=l[0],Object.assign(i,a)):(Object.assign(i,a),i.anyOf=l.map(u=>({contentMediaType:u}))):Object.assign(i,a)},jSe=(t,e,n,r)=>{n.type="boolean"},QJ=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},HSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},eQ=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},$Se=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},VSe=(t,e,n,r)=>{if(e.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},tQ=(t,e,n,r)=>{const i=n,a=t._zod.def,{minimum:s,maximum:o}=t._zod.bag;typeof s=="number"&&(i.minItems=s),typeof o=="number"&&(i.maxItems=o),i.type="array",i.items=jr(a.element,e,{...r,path:[...r.path,"items"]})},nQ=(t,e,n,r)=>{const i=n,a=t._zod.def;i.type="object",i.properties={};const s=a.shape;for(const u in s)i.properties[u]=jr(s[u],e,{...r,path:[...r.path,"properties",u]});const o=new Set(Object.keys(s)),l=new Set([...o].filter(u=>{const c=a.shape[u]._zod;return e.io==="input"?c.optin===void 0:c.optout===void 0}));l.size>0&&(i.required=Array.from(l)),a.catchall?._zod.def.type==="never"?i.additionalProperties=!1:a.catchall?a.catchall&&(i.additionalProperties=jr(a.catchall,e,{...r,path:[...r.path,"additionalProperties"]})):e.io==="output"&&(i.additionalProperties=!1)},rQ=(t,e,n,r)=>{const i=t._zod.def,a=i.inclusive===!1,s=i.options.map((o,l)=>jr(o,e,{...r,path:[...r.path,a?"oneOf":"anyOf",l]}));a?n.oneOf=s:n.anyOf=s},iQ=(t,e,n,r)=>{const i=t._zod.def,a=jr(i.left,e,{...r,path:[...r.path,"allOf",0]}),s=jr(i.right,e,{...r,path:[...r.path,"allOf",1]}),o=u=>"allOf"in u&&Object.keys(u).length===1,l=[...o(a)?a.allOf:[a],...o(s)?s.allOf:[s]];n.allOf=l},aQ=(t,e,n,r)=>{const i=n,a=t._zod.def;i.type="array";const s=e.target==="draft-2020-12"?"prefixItems":"items",o=e.target==="draft-2020-12"||e.target==="openapi-3.0"?"items":"additionalItems",l=a.items.map((h,f)=>jr(h,e,{...r,path:[...r.path,s,f]})),u=a.rest?jr(a.rest,e,{...r,path:[...r.path,o,...e.target==="openapi-3.0"?[a.items.length]:[]]}):null;e.target==="draft-2020-12"?(i.prefixItems=l,u&&(i.items=u)):e.target==="openapi-3.0"?(i.items={anyOf:l},u&&i.items.anyOf.push(u),i.minItems=l.length,u||(i.maxItems=l.length)):(i.items=l,u&&(i.additionalItems=u));const{minimum:c,maximum:d}=t._zod.bag;typeof c=="number"&&(i.minItems=c),typeof d=="number"&&(i.maxItems=d)},sQ=(t,e,n,r)=>{const i=n,a=t._zod.def;i.type="object";const s=a.keyType,l=s._zod.bag?.patterns;if(a.mode==="loose"&&l&&l.size>0){const c=jr(a.valueType,e,{...r,path:[...r.path,"patternProperties","*"]});i.patternProperties={};for(const d of l)i.patternProperties[d.source]=c}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(i.propertyNames=jr(a.keyType,e,{...r,path:[...r.path,"propertyNames"]})),i.additionalProperties=jr(a.valueType,e,{...r,path:[...r.path,"additionalProperties"]});const u=s._zod.values;if(u){const c=[...u].filter(d=>typeof d=="string"||typeof d=="number");c.length>0&&(i.required=c)}},oQ=(t,e,n,r)=>{const i=t._zod.def,a=jr(i.innerType,e,r),s=e.seen.get(t);e.target==="openapi-3.0"?(s.ref=i.innerType,n.nullable=!0):n.anyOf=[a,{type:"null"}]},lQ=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType},uQ=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType,n.default=JSON.parse(JSON.stringify(i.defaultValue))},cQ=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType,e.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},dQ=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType;let s;try{s=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=s},hQ=(t,e,n,r)=>{const i=t._zod.def,a=e.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;jr(a,e,r);const s=e.seen.get(t);s.ref=a},fQ=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType,n.readOnly=!0},qSe=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType},H8=(t,e,n,r)=>{const i=t._zod.def;jr(i.innerType,e,r);const a=e.seen.get(t);a.ref=i.innerType},pQ=(t,e,n,r)=>{const i=t._zod.innerType;jr(i,e,r);const a=e.seen.get(t);a.ref=i},IF={string:VJ,number:qJ,boolean:GJ,bigint:PSe,symbol:DSe,null:WJ,undefined:OSe,void:LSe,never:YJ,any:XJ,unknown:KJ,date:FSe,enum:ZJ,literal:JJ,nan:BSe,template_literal:USe,file:zSe,success:jSe,custom:QJ,function:HSe,transform:eQ,map:$Se,set:VSe,array:tQ,object:nQ,union:rQ,intersection:iQ,tuple:aQ,record:sQ,nullable:oQ,nonoptional:lQ,default:uQ,prefault:cQ,catch:dQ,pipe:hQ,readonly:fQ,promise:qSe,optional:H8,lazy:pQ};function GSe(t,e){if("_idmap"in t){const r=t,i=cw({...e,processors:IF}),a={};for(const l of r._idmap.entries()){const[u,c]=l;jr(c,i)}const s={},o={registry:r,uri:e?.uri,defs:a};i.external=o;for(const l of r._idmap.entries()){const[u,c]=l;dw(i,c),s[u]=hw(i,c)}if(Object.keys(a).length>0){const l=i.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[l]:a}}return{schemas:s}}const n=cw({...e,processors:IF});return jr(t,n),dw(n,t),hw(n,t)}const WSe=ht("ZodISODateTime",(t,e)=>{W2e.init(t,e),fi.init(t,e)});function YSe(t){return rSe(WSe,t)}const XSe=ht("ZodISODate",(t,e)=>{Y2e.init(t,e),fi.init(t,e)});function KSe(t){return iSe(XSe,t)}const ZSe=ht("ZodISOTime",(t,e)=>{X2e.init(t,e),fi.init(t,e)});function JSe(t){return aSe(ZSe,t)}const QSe=ht("ZodISODuration",(t,e)=>{K2e.init(t,e),fi.init(t,e)});function e4e(t){return sSe(QSe,t)}const t4e=(t,e)=>{MJ.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>Uwe(t,n)},flatten:{value:n=>Bwe(t,n)},addIssue:{value:n=>{t.issues.push(n),t.message=JSON.stringify(t.issues,cI,2)}},addIssues:{value:n=>{t.issues.push(...n),t.message=JSON.stringify(t.issues,cI,2)}},isEmpty:{get(){return t.issues.length===0}}})},Eo=ht("ZodError",t4e,{Parent:Error}),n4e=U8(Eo),r4e=z8(Eo),i4e=e3(Eo),mQ=t3(Eo),a4e=Hwe(Eo),s4e=$we(Eo),o4e=Vwe(Eo),l4e=qwe(Eo),u4e=Gwe(Eo),c4e=Wwe(Eo),d4e=Ywe(Eo),h4e=Xwe(Eo),Lr=ht("ZodType",(t,e)=>(Ar.init(t,e),Object.assign(t["~standard"],{jsonSchema:{input:fw(t,"input"),output:fw(t,"output")}}),t.toJSONSchema=NSe(t,{}),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone(vd(e,{checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),t.with=t.check,t.clone=(n,r)=>yd(t,n,r),t.brand=()=>t,t.register=((n,r)=>(n.add(t,r),t)),t.parse=(n,r)=>n4e(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>i4e(t,n,r),t.parseAsync=async(n,r)=>r4e(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>mQ(t,n,r),t.spa=t.safeParseAsync,t.encode=(n,r)=>a4e(t,n,r),t.decode=(n,r)=>s4e(t,n,r),t.encodeAsync=async(n,r)=>o4e(t,n,r),t.decodeAsync=async(n,r)=>l4e(t,n,r),t.safeEncode=(n,r)=>u4e(t,n,r),t.safeDecode=(n,r)=>c4e(t,n,r),t.safeEncodeAsync=async(n,r)=>d4e(t,n,r),t.safeDecodeAsync=async(n,r)=>h4e(t,n,r),t.refine=(n,r)=>t.check(lEe(n,r)),t.superRefine=n=>t.check(uEe(n)),t.overwrite=n=>t.check(V0(n)),t.optional=()=>PF(t),t.exactOptional=()=>Y4e(t),t.nullable=()=>DF(t),t.nullish=()=>PF(DF(t)),t.nonoptional=n=>eEe(t,n),t.array=()=>Ce(t),t.or=n=>vt([t,n]),t.and=n=>j4e(t,n),t.transform=n=>OF(t,G4e(n)),t.default=n=>Z4e(t,n),t.prefault=n=>Q4e(t,n),t.catch=n=>nEe(t,n),t.pipe=n=>OF(t,n),t.readonly=()=>aEe(t),t.describe=n=>{const r=t.clone();return yg.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){return yg.get(t)?.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return yg.get(t);const r=t.clone();return yg.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t.apply=n=>n(t),t)),gQ=ht("_ZodString",(t,e)=>{j8.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(r,i,a)=>VJ(t,r,i);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(mSe(...r)),t.includes=(...r)=>t.check(ySe(...r)),t.startsWith=(...r)=>t.check(xSe(...r)),t.endsWith=(...r)=>t.check(bSe(...r)),t.min=(...r)=>t.check(uw(...r)),t.max=(...r)=>t.check(HJ(...r)),t.length=(...r)=>t.check($J(...r)),t.nonempty=(...r)=>t.check(uw(1,...r)),t.lowercase=r=>t.check(gSe(r)),t.uppercase=r=>t.check(vSe(r)),t.trim=()=>t.check(wSe()),t.normalize=(...r)=>t.check(_Se(...r)),t.toLowerCase=()=>t.check(SSe()),t.toUpperCase=()=>t.check(ESe()),t.slugify=()=>t.check(TSe())}),f4e=ht("ZodString",(t,e)=>{j8.init(t,e),gQ.init(t,e),t.email=n=>t.check(L3e(p4e,n)),t.url=n=>t.check(j3e(m4e,n)),t.jwt=n=>t.check(nSe(I4e,n)),t.emoji=n=>t.check(H3e(g4e,n)),t.guid=n=>t.check(CF(NF,n)),t.uuid=n=>t.check(F3e(eb,n)),t.uuidv4=n=>t.check(B3e(eb,n)),t.uuidv6=n=>t.check(U3e(eb,n)),t.uuidv7=n=>t.check(z3e(eb,n)),t.nanoid=n=>t.check($3e(v4e,n)),t.guid=n=>t.check(CF(NF,n)),t.cuid=n=>t.check(V3e(y4e,n)),t.cuid2=n=>t.check(q3e(x4e,n)),t.ulid=n=>t.check(G3e(b4e,n)),t.base64=n=>t.check(Q3e(M4e,n)),t.base64url=n=>t.check(eSe(A4e,n)),t.xid=n=>t.check(W3e(_4e,n)),t.ksuid=n=>t.check(Y3e(w4e,n)),t.ipv4=n=>t.check(X3e(S4e,n)),t.ipv6=n=>t.check(K3e(E4e,n)),t.cidrv4=n=>t.check(Z3e(T4e,n)),t.cidrv6=n=>t.check(J3e(C4e,n)),t.e164=n=>t.check(tSe(k4e,n)),t.datetime=n=>t.check(YSe(n)),t.date=n=>t.check(KSe(n)),t.time=n=>t.check(JSe(n)),t.duration=n=>t.check(e4e(n))});function A(t){return O3e(f4e,t)}const fi=ht("ZodStringFormat",(t,e)=>{Jr.init(t,e),gQ.init(t,e)}),p4e=ht("ZodEmail",(t,e)=>{B2e.init(t,e),fi.init(t,e)}),NF=ht("ZodGUID",(t,e)=>{L2e.init(t,e),fi.init(t,e)}),eb=ht("ZodUUID",(t,e)=>{F2e.init(t,e),fi.init(t,e)}),m4e=ht("ZodURL",(t,e)=>{U2e.init(t,e),fi.init(t,e)}),g4e=ht("ZodEmoji",(t,e)=>{z2e.init(t,e),fi.init(t,e)}),v4e=ht("ZodNanoID",(t,e)=>{j2e.init(t,e),fi.init(t,e)}),y4e=ht("ZodCUID",(t,e)=>{H2e.init(t,e),fi.init(t,e)}),x4e=ht("ZodCUID2",(t,e)=>{$2e.init(t,e),fi.init(t,e)}),b4e=ht("ZodULID",(t,e)=>{V2e.init(t,e),fi.init(t,e)}),_4e=ht("ZodXID",(t,e)=>{q2e.init(t,e),fi.init(t,e)}),w4e=ht("ZodKSUID",(t,e)=>{G2e.init(t,e),fi.init(t,e)}),S4e=ht("ZodIPv4",(t,e)=>{Z2e.init(t,e),fi.init(t,e)}),E4e=ht("ZodIPv6",(t,e)=>{J2e.init(t,e),fi.init(t,e)}),T4e=ht("ZodCIDRv4",(t,e)=>{Q2e.init(t,e),fi.init(t,e)}),C4e=ht("ZodCIDRv6",(t,e)=>{e3e.init(t,e),fi.init(t,e)}),M4e=ht("ZodBase64",(t,e)=>{t3e.init(t,e),fi.init(t,e)}),A4e=ht("ZodBase64URL",(t,e)=>{r3e.init(t,e),fi.init(t,e)}),k4e=ht("ZodE164",(t,e)=>{i3e.init(t,e),fi.init(t,e)}),I4e=ht("ZodJWT",(t,e)=>{s3e.init(t,e),fi.init(t,e)}),$8=ht("ZodNumber",(t,e)=>{FJ.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(r,i,a)=>qJ(t,r,i),t.gt=(r,i)=>t.check(AF(r,i)),t.gte=(r,i)=>t.check(zE(r,i)),t.min=(r,i)=>t.check(zE(r,i)),t.lt=(r,i)=>t.check(MF(r,i)),t.lte=(r,i)=>t.check(UE(r,i)),t.max=(r,i)=>t.check(UE(r,i)),t.int=r=>t.check(RF(r)),t.safe=r=>t.check(RF(r)),t.positive=r=>t.check(AF(0,r)),t.nonnegative=r=>t.check(zE(0,r)),t.negative=r=>t.check(MF(0,r)),t.nonpositive=r=>t.check(UE(0,r)),t.multipleOf=(r,i)=>t.check(kF(r,i)),t.step=(r,i)=>t.check(kF(r,i)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function ie(t){return oSe($8,t)}const N4e=ht("ZodNumberFormat",(t,e)=>{o3e.init(t,e),$8.init(t,e)});function RF(t){return uSe(N4e,t)}const R4e=ht("ZodBoolean",(t,e)=>{l3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>GJ(t,n,r)});function Ot(t){return cSe(R4e,t)}const P4e=ht("ZodNull",(t,e)=>{u3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>WJ(t,n,r)});function V8(t){return dSe(P4e,t)}const D4e=ht("ZodAny",(t,e)=>{c3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>XJ()});function gr(){return hSe(D4e)}const O4e=ht("ZodUnknown",(t,e)=>{d3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>KJ()});function Zn(){return fSe(O4e)}const L4e=ht("ZodNever",(t,e)=>{h3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>YJ(t,n,r)});function F4e(t){return pSe(L4e,t)}const B4e=ht("ZodArray",(t,e)=>{f3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>tQ(t,n,r,i),t.element=e.element,t.min=(n,r)=>t.check(uw(n,r)),t.nonempty=n=>t.check(uw(1,n)),t.max=(n,r)=>t.check(HJ(n,r)),t.length=(n,r)=>t.check($J(n,r)),t.unwrap=()=>t.element});function Ce(t,e){return CSe(B4e,t,e)}const vQ=ht("ZodObject",(t,e)=>{m3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>nQ(t,n,r,i),tr(t,"shape",()=>e.shape),t.keyof=()=>wt(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Zn()}),t.loose=()=>t.clone({...t._zod.def,catchall:Zn()}),t.strict=()=>t.clone({...t._zod.def,catchall:F4e()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>Pwe(t,n),t.safeExtend=n=>Dwe(t,n),t.merge=n=>Owe(t,n),t.pick=n=>Nwe(t,n),t.omit=n=>Rwe(t,n),t.partial=(...n)=>Lwe(xQ,t,n[0]),t.required=(...n)=>Fwe(bQ,t,n[0])});function B(t,e){const n={type:"object",shape:t??{},...Jt(e)};return new vQ(n)}function hI(t,e){return new vQ({type:"object",shape:t,catchall:Zn(),...Jt(e)})}const yQ=ht("ZodUnion",(t,e)=>{zJ.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>rQ(t,n,r,i),t.options=e.options});function vt(t,e){return new yQ({type:"union",options:t,...Jt(e)})}const U4e=ht("ZodDiscriminatedUnion",(t,e)=>{yQ.init(t,e),g3e.init(t,e)});function Zt(t,e,n){return new U4e({type:"union",options:e,discriminator:t,...Jt(n)})}const z4e=ht("ZodIntersection",(t,e)=>{v3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>iQ(t,n,r,i)});function j4e(t,e){return new z4e({type:"intersection",left:t,right:e})}const H4e=ht("ZodTuple",(t,e)=>{y3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>aQ(t,n,r,i),t.rest=n=>t.clone({...t._zod.def,rest:n})});function x0(t,e,n){const r=e instanceof Ar,i=r?n:e,a=r?e:null;return new H4e({type:"tuple",items:t,rest:a,...Jt(i)})}const $4e=ht("ZodRecord",(t,e)=>{x3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>sQ(t,n,r,i),t.keyType=e.keyType,t.valueType=e.valueType});function sn(t,e,n){return new $4e({type:"record",keyType:t,valueType:e,...Jt(n)})}const fI=ht("ZodEnum",(t,e)=>{b3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(r,i,a)=>ZJ(t,r,i),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,i)=>{const a={};for(const s of r)if(n.has(s))a[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new fI({...e,checks:[],...Jt(i),entries:a})},t.exclude=(r,i)=>{const a={...e.entries};for(const s of r)if(n.has(s))delete a[s];else throw new Error(`Key ${s} not found in enum`);return new fI({...e,checks:[],...Jt(i),entries:a})}});function wt(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new fI({type:"enum",entries:n,...Jt(e)})}const V4e=ht("ZodLiteral",(t,e)=>{_3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>JJ(t,n,r),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function ae(t,e){return new V4e({type:"literal",values:Array.isArray(t)?t:[t],...Jt(e)})}const q4e=ht("ZodTransform",(t,e)=>{w3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>eQ(t,n),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new _J(t.constructor.name);n.addIssue=a=>{if(typeof a=="string")n.issues.push(A1(a,n.value,e));else{const s=a;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),n.issues.push(A1(s))}};const i=e.transform(n.value,n);return i instanceof Promise?i.then(a=>(n.value=a,n)):(n.value=i,n)}});function G4e(t){return new q4e({type:"transform",transform:t})}const xQ=ht("ZodOptional",(t,e)=>{jJ.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>H8(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function PF(t){return new xQ({type:"optional",innerType:t})}const W4e=ht("ZodExactOptional",(t,e)=>{S3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>H8(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function Y4e(t){return new W4e({type:"optional",innerType:t})}const X4e=ht("ZodNullable",(t,e)=>{E3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>oQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function DF(t){return new X4e({type:"nullable",innerType:t})}const K4e=ht("ZodDefault",(t,e)=>{T3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>uQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Z4e(t,e){return new K4e({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():TJ(e)}})}const J4e=ht("ZodPrefault",(t,e)=>{C3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>cQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function Q4e(t,e){return new J4e({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():TJ(e)}})}const bQ=ht("ZodNonOptional",(t,e)=>{M3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>lQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function eEe(t,e){return new bQ({type:"nonoptional",innerType:t,...Jt(e)})}const tEe=ht("ZodCatch",(t,e)=>{A3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>dQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function nEe(t,e){return new tEe({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const rEe=ht("ZodPipe",(t,e)=>{k3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>hQ(t,n,r,i),t.in=e.in,t.out=e.out});function OF(t,e){return new rEe({type:"pipe",in:t,out:e})}const iEe=ht("ZodReadonly",(t,e)=>{I3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>fQ(t,n,r,i),t.unwrap=()=>t._zod.def.innerType});function aEe(t){return new iEe({type:"readonly",innerType:t})}const sEe=ht("ZodLazy",(t,e)=>{N3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>pQ(t,n,r,i),t.unwrap=()=>t._zod.def.getter()});function Cv(t){return new sEe({type:"lazy",getter:t})}const q8=ht("ZodCustom",(t,e)=>{R3e.init(t,e),Lr.init(t,e),t._zod.processJSONSchema=(n,r,i)=>QJ(t,n)});function oEe(t,e){return MSe(q8,t??(()=>!0),e)}function lEe(t,e={}){return ASe(q8,t,e)}function uEe(t){return kSe(t)}function pw(t,e={}){const n=new q8({type:"custom",check:"custom",fn:r=>r instanceof t,abort:!0,...Jt(e)});return n._zod.bag.Class=t,n._zod.check=r=>{r.value instanceof t||r.issues.push({code:"invalid_type",expected:t.name,input:r.value,inst:n,path:[...n._zod.def.path??[]]})},n}function _Q(t){return lSe($8,t)}var k1;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},t.getValidEnumValues=i=>{const a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(const s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(k1||(k1={}));var LF;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(LF||(LF={}));k1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);k1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class mw extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},r={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)r._errors.push(n(s));else{let o=r,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(s))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return i(this),r}static assert(e){if(!(e instanceof mw))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,k1.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n=Object.create(null),r=[];for(const i of this.issues)if(i.path.length>0){const a=i.path[0];n[a]=n[a]||[],n[a].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}mw.create=t=>new mw(t);var FF;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(FF||(FF={}));var Cn;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Cn||(Cn={}));let BF=class extends Error{constructor(e,n){super(e),this.name="ParseError",this.type=n.type,this.field=n.field,this.value=n.value,this.line=n.line}};function jE(t){}function cEe(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=jE,onError:n=jE,onRetry:r=jE,onComment:i}=t;let a="",s=!0,o,l="",u="";function c(x){const b=s?x.replace(/^\xEF\xBB\xBF/,""):x,[y,w]=dEe(`${a}${b}`);for(const _ of y)d(_);a=w,s=!1}function d(x){if(x===""){f();return}if(x.startsWith(":")){i&&i(x.slice(x.startsWith(": ")?2:1));return}const b=x.indexOf(":");if(b!==-1){const y=x.slice(0,b),w=x[b+1]===" "?2:1,_=x.slice(b+w);h(y,_,x);return}h(x,"",x)}function h(x,b,y){switch(x){case"event":u=b;break;case"data":l=`${l}${b}
`;break;case"id":o=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?r(parseInt(b,10)):n(new BF(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:y}));break;default:n(new BF(`Unknown field "${x.length>20?`${x.slice(0,20)}…`:x}"`,{type:"unknown-field",field:x,value:b,line:y}));break}}function f(){l.length>0&&e({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u=""}function m(x={}){a&&x.consume&&d(a),s=!0,o=void 0,l="",u="",a=""}return{feed:c,reset:m}}function dEe(t){const e=[];let n="",r=0;for(;r<t.length;){const i=t.indexOf("\r",r),a=t.indexOf(`
`,r);let s=-1;if(i!==-1&&a!==-1?s=Math.min(i,a):i!==-1?i===t.length-1?s=-1:s=i:a!==-1&&(s=a),s===-1){n=t.slice(r);break}else{const o=t.slice(r,s);e.push(o),r=s+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,n]}let hEe=class extends TransformStream{constructor({onError:e,onRetry:n,onComment:r}={}){let i;super({start(a){i=cEe({onEvent:s=>{a.enqueue(s)},onError(s){e==="terminate"?a.error(s):typeof e=="function"&&e(s)},onRetry:n,onComment:r})},transform(a){i.feed(a)}})}};var G8={};function Mn(...t){return t.reduce((e,n)=>({...e,...n??{}}),{})}function W8({tools:t=[],providerToolNames:e}){const n={},r={};for(const i of t)if(i.type==="provider"&&i.id in e){const a=e[i.id];n[i.name]=a,r[a]=i.name}return{toProviderToolName:i=>{var a;return(a=n[i])!=null?a:i},toCustomToolName:i=>{var a;return(a=r[i])!=null?a:i}}}async function fEe(t,e){if(t==null)return Promise.resolve();const n=e?.abortSignal;return new Promise((r,i)=>{if(n?.aborted){i(UF());return}const a=setTimeout(()=>{s(),r()},t),s=()=>{clearTimeout(a),n?.removeEventListener("abort",o)},o=()=>{s(),i(UF())};n?.addEventListener("abort",o)})}function UF(){return new DOMException("Delay was aborted","AbortError")}var Km=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise?this._promise:(this._promise=new Promise((t,e)=>{this.status.type==="resolved"?t(this.status.value):this.status.type==="rejected"&&e(this.status.error),this._resolve=t,this._reject=e}),this._promise)}resolve(t){var e;this.status={type:"resolved",value:t},this._promise&&((e=this._resolve)==null||e.call(this,t))}reject(t){var e;this.status={type:"rejected",error:t},this._promise&&((e=this._reject)==null||e.call(this,t))}isResolved(){return this.status.type==="resolved"}isRejected(){return this.status.type==="rejected"}isPending(){return this.status.type==="pending"}};function xd(t){return Object.fromEntries([...t.headers])}var{btoa:pEe,atob:mEe}=globalThis;function Yu(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=mEe(e);return Uint8Array.from(n,r=>r.codePointAt(0))}function b0(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return pEe(e)}function oa(t){return t instanceof Uint8Array?b0(t):t}function wQ(t,e={}){const{useArrayBrackets:n=!0}=e,r=new FormData;for(const[i,a]of Object.entries(t))if(a!=null){if(Array.isArray(a)){if(a.length===1){r.append(i,a[0]);continue}const s=n?`${i}[]`:i;for(const o of a)r.append(s,o);continue}r.append(i,a)}return r}var SQ="AI_DownloadError",EQ=`vercel.ai.error.${SQ}`,gEe=Symbol.for(EQ),zF,jF,e0=class extends(jF=pn,zF=gEe,jF){constructor({url:t,statusCode:e,statusText:n,cause:r,message:i=r==null?`Failed to download ${t}: ${e} ${n}`:`Failed to download ${t}: ${r}`}){super({name:SQ,message:i,cause:r}),this[zF]=!0,this.url=t,this.statusCode=e,this.statusText=n}static isInstance(t){return pn.hasMarker(t,EQ)}};async function r3(t){try{const e=await fetch(t);if(!e.ok)throw new e0({url:t,statusCode:e.status,statusText:e.statusText});return await e.blob()}catch(e){throw e0.isInstance(e)?e:new e0({url:t,cause:e})}}var Mv=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const i=()=>{const a=n.length,s=new Array(e);for(let o=0;o<e;o++)s[o]=n[Math.random()*a|0];return s.join("")};if(t==null)return i;if(n.includes(r))throw new nJ({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${t}${r}${i()}`},Ln=Mv();function Y8(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}function nf(t){return(t instanceof Error||t instanceof DOMException)&&(t.name==="AbortError"||t.name==="ResponseAborted"||t.name==="TimeoutError")}var vEe=["fetch failed","failed to fetch"];function TQ({error:t,url:e,requestBodyValues:n}){if(nf(t))return t;if(t instanceof TypeError&&vEe.includes(t.message.toLowerCase())){const r=t.cause;if(r!=null)return new ji({message:`Cannot connect to API: ${r.message}`,cause:r,url:e,requestBodyValues:n,isRetryable:!0})}return t}function Av(t=globalThis){var e,n,r;return t.window?"runtime/browser":(e=t.navigator)!=null&&e.userAgent?`runtime/${t.navigator.userAgent.toLowerCase()}`:(r=(n=t.process)==null?void 0:n.versions)!=null&&r.node?`runtime/node.js/${t.process.version.substring(0)}`:t.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function Hg(t){if(t==null)return{};const e={};if(t instanceof Headers)t.forEach((n,r)=>{e[r.toLowerCase()]=n});else{Array.isArray(t)||(t=Object.entries(t));for(const[n,r]of t)r!=null&&(e[n.toLowerCase()]=r)}return e}function To(t,...e){const n=new Headers(Hg(t)),r=n.get("user-agent")||"";return n.set("user-agent",[r,...e].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}var CQ="4.0.8",yEe=()=>globalThis.fetch,HF=async({url:t,headers:e={},successfulResponseHandler:n,failedResponseHandler:r,abortSignal:i,fetch:a=yEe()})=>{try{const s=await a(t,{method:"GET",headers:To(e,`ai-sdk/provider-utils/${CQ}`,Av()),signal:i}),o=xd(s);if(!s.ok){let l;try{l=await r({response:s,url:t,requestBodyValues:{}})}catch(u){throw nf(u)||ji.isInstance(u)?u:new ji({message:"Failed to process error response",cause:u,statusCode:s.status,url:t,responseHeaders:o,requestBodyValues:{}})}throw l.value}try{return await n({response:s,url:t,requestBodyValues:{}})}catch(l){throw l instanceof Error&&(nf(l)||ji.isInstance(l))?l:new ji({message:"Failed to process successful response",cause:l,statusCode:s.status,url:t,responseHeaders:o,requestBodyValues:{}})}}catch(s){throw TQ({error:s,url:t,requestBodyValues:{}})}};function X8(t){return t!=null}function xEe({mediaType:t,url:e,supportedUrls:n}){return e=e.toLowerCase(),t=t.toLowerCase(),Object.entries(n).map(([r,i])=>{const a=r.toLowerCase();return a==="*"||a==="*/*"?{mediaTypePrefix:"",regexes:i}:{mediaTypePrefix:a.replace(/\*/,""),regexes:i}}).filter(({mediaTypePrefix:r})=>t.startsWith(r)).flatMap(({regexes:r})=>r).some(r=>r.test(e))}function i3({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new Xx({message:`${r} API key must be a string.`});if(typeof process>"u")throw new Xx({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=G8[e],t==null)throw new Xx({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Xx({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}function Kc({settingValue:t,environmentVariableName:e}){if(typeof t=="string")return t;if(!(t!=null||typeof process>"u")&&(t=G8[e],!(t==null||typeof t!="string")))return t}function mh({settingValue:t,environmentVariableName:e,settingName:n,description:r}){if(typeof t=="string")return t;if(t!=null)throw new Kx({message:`${r} setting must be a string.`});if(typeof process>"u")throw new Kx({message:`${r} setting is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=G8[e],t==null)throw new Kx({message:`${r} setting is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new Kx({message:`${r} setting must be a string. The value of the ${e} environment variable is not a string.`});return t}function MQ(t){var e;const[n,r=""]=t.toLowerCase().split("/");return(e={mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"}[r])!=null?e:r}var bEe=/"__proto__"\s*:/,_Ee=/"constructor"\s*:/;function $F(t){const e=JSON.parse(t);return e===null||typeof e!="object"||bEe.test(t)===!1&&_Ee.test(t)===!1?e:wEe(e)}function wEe(t){let e=[t];for(;e.length;){const n=e;e=[];for(const r of n){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const i in r){const a=r[i];a&&typeof a=="object"&&e.push(a)}}}return t}function K8(t){const{stackTraceLimit:e}=Error;try{Error.stackTraceLimit=0}catch{return $F(t)}try{return $F(t)}finally{Error.stackTraceLimit=e}}function Z8(t){if(t.type==="object"||Array.isArray(t.type)&&t.type.includes("object")){t.additionalProperties=!1;const{properties:n}=t;if(n!=null)for(const r of Object.keys(n))n[r]=sh(n[r])}t.items!=null&&(t.items=Array.isArray(t.items)?t.items.map(sh):sh(t.items)),t.anyOf!=null&&(t.anyOf=t.anyOf.map(sh)),t.allOf!=null&&(t.allOf=t.allOf.map(sh)),t.oneOf!=null&&(t.oneOf=t.oneOf.map(sh));const{definitions:e}=t;if(e!=null)for(const n of Object.keys(e))e[n]=sh(e[n]);return t}function sh(t){return typeof t=="boolean"?t:Z8(t)}var SEe=Symbol("Let zodToJsonSchema decide on which parser to use"),VF={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},EEe=t=>typeof t=="string"?{...VF,name:t}:{...VF,...t};function Qs(){return{}}function TEe(t,e){var n,r,i;const a={type:"array"};return(n=t.type)!=null&&n._def&&((i=(r=t.type)==null?void 0:r._def)==null?void 0:i.typeName)!==Cn.ZodAny&&(a.items=Sr(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function CEe(t){const e={type:"integer",format:"int64"};if(!t.checks)return e;for(const n of t.checks)switch(n.kind){case"min":n.inclusive?e.minimum=n.value:e.exclusiveMinimum=n.value;break;case"max":n.inclusive?e.maximum=n.value:e.exclusiveMaximum=n.value;break;case"multipleOf":e.multipleOf=n.value;break}return e}function MEe(){return{type:"boolean"}}function AQ(t,e){return Sr(t.type._def,e)}var AEe=(t,e)=>Sr(t.innerType._def,e);function kQ(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>kQ(t,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return kEe(t)}}var kEe=t=>{const e={type:"integer",format:"unix-time"};for(const n of t.checks)switch(n.kind){case"min":e.minimum=n.value;break;case"max":e.maximum=n.value;break}return e};function IEe(t,e){return{...Sr(t.innerType._def,e),default:t.defaultValue()}}function NEe(t,e){return e.effectStrategy==="input"?Sr(t.schema._def,e):Qs()}function REe(t){return{type:"string",enum:Array.from(t.values)}}var PEe=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function DEe(t,e){const n=[Sr(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Sr(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),r=[];return n.forEach(i=>{if(PEe(i))r.push(...i.allOf);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:s,...o}=i;a=o}r.push(a)}}),r.length?{allOf:r}:void 0}function OEe(t){const e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var HE=void 0,Uo={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(HE===void 0&&(HE=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),HE),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function IQ(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value;break;case"max":n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":zo(n,"email",r.message,e);break;case"format:idn-email":zo(n,"idn-email",r.message,e);break;case"pattern:zod":Ga(n,Uo.email,r.message,e);break}break;case"url":zo(n,"uri",r.message,e);break;case"uuid":zo(n,"uuid",r.message,e);break;case"regex":Ga(n,r.regex,r.message,e);break;case"cuid":Ga(n,Uo.cuid,r.message,e);break;case"cuid2":Ga(n,Uo.cuid2,r.message,e);break;case"startsWith":Ga(n,RegExp(`^${$E(r.value,e)}`),r.message,e);break;case"endsWith":Ga(n,RegExp(`${$E(r.value,e)}$`),r.message,e);break;case"datetime":zo(n,"date-time",r.message,e);break;case"date":zo(n,"date",r.message,e);break;case"time":zo(n,"time",r.message,e);break;case"duration":zo(n,"duration",r.message,e);break;case"length":n.minLength=typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,n.maxLength=typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value;break;case"includes":{Ga(n,RegExp($E(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&zo(n,"ipv4",r.message,e),r.version!=="v4"&&zo(n,"ipv6",r.message,e);break}case"base64url":Ga(n,Uo.base64url,r.message,e);break;case"jwt":Ga(n,Uo.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&Ga(n,Uo.ipv4Cidr,r.message,e),r.version!=="v4"&&Ga(n,Uo.ipv6Cidr,r.message,e);break}case"emoji":Ga(n,Uo.emoji(),r.message,e);break;case"ulid":{Ga(n,Uo.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{zo(n,"binary",r.message,e);break}case"contentEncoding:base64":{n.contentEncoding="base64";break}case"pattern:zod":{Ga(n,Uo.base64,r.message,e);break}}break}case"nanoid":Ga(n,Uo.nanoid,r.message,e)}return n}function $E(t,e){return e.patternStrategy==="escape"?FEe(t):t}var LEe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function FEe(t){let e="";for(let n=0;n<t.length;n++)LEe.has(t[n])||(e+="\\"),e+=t[n];return e}function zo(t,e,n,r){var i;t.format||(i=t.anyOf)!=null&&i.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):t.format=e}function Ga(t,e,n,r){var i;t.pattern||(i=t.allOf)!=null&&i.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:qF(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):t.pattern=qF(e,r)}function qF(t,e){var n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},i=r.i?t.source.toLowerCase():t.source;let a="",s=!1,o=!1,l=!1;for(let u=0;u<i.length;u++){if(s){a+=i[u],s=!1;continue}if(r.i){if(o){if(i[u].match(/[a-z]/)){l?(a+=i[u],a+=`${i[u-2]}-${i[u]}`.toUpperCase(),l=!1):i[u+1]==="-"&&((n=i[u+2])!=null&&n.match(/[a-z]/))?(a+=i[u],l=!0):a+=`${i[u]}${i[u].toUpperCase()}`;continue}}else if(i[u].match(/[a-z]/)){a+=`[${i[u]}${i[u].toUpperCase()}]`;continue}}if(r.m){if(i[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(i[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&i[u]==="."){a+=o?`${i[u]}\r
`:`[${i[u]}\r
]`;continue}a+=i[u],i[u]==="\\"?s=!0:o&&i[u]==="]"?o=!1:!o&&i[u]==="["&&(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a}function NQ(t,e){var n,r,i,a,s,o;const l={type:"object",additionalProperties:(n=Sr(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===Cn.ZodString&&((i=t.keyType._def.checks)!=null&&i.length)){const{type:u,...c}=IQ(t.keyType._def,e);return{...l,propertyNames:c}}else{if(((a=t.keyType)==null?void 0:a._def.typeName)===Cn.ZodEnum)return{...l,propertyNames:{enum:t.keyType._def.values}};if(((s=t.keyType)==null?void 0:s._def.typeName)===Cn.ZodBranded&&t.keyType._def.type._def.typeName===Cn.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){const{type:u,...c}=AQ(t.keyType._def,e);return{...l,propertyNames:c}}}return l}function BEe(t,e){if(e.mapStrategy==="record")return NQ(t,e);const n=Sr(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Qs(),r=Sr(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Qs();return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function UEe(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function zEe(){return{not:Qs()}}function jEe(){return{type:"null"}}var pI={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function HEe(t,e){const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in pI&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((i,a)=>{const s=pI[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===n.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:n.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return $Ee(t,e)}var $Ee=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,i)=>Sr(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function VEe(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[pI[t.innerType._def.typeName],"null"]};const n=Sr(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function qEe(t){const e={type:"number"};if(!t.checks)return e;for(const n of t.checks)switch(n.kind){case"int":e.type="integer";break;case"min":n.inclusive?e.minimum=n.value:e.exclusiveMinimum=n.value;break;case"max":n.inclusive?e.maximum=n.value:e.exclusiveMaximum=n.value;break;case"multipleOf":e.multipleOf=n.value;break}return e}function GEe(t,e){const n={type:"object",properties:{}},r=[],i=t.shape();for(const s in i){let o=i[s];if(o===void 0||o._def===void 0)continue;const l=YEe(o),u=Sr(o._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});u!==void 0&&(n.properties[s]=u,l||r.push(s))}r.length&&(n.required=r);const a=WEe(t,e);return a!==void 0&&(n.additionalProperties=a),n}function WEe(t,e){if(t.catchall._def.typeName!=="ZodNever")return Sr(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function YEe(t){try{return t.isOptional()}catch{return!0}}var XEe=(t,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return Sr(t.innerType._def,e);const r=Sr(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Qs()},r]}:Qs()},KEe=(t,e)=>{if(e.pipeStrategy==="input")return Sr(t.in._def,e);if(e.pipeStrategy==="output")return Sr(t.out._def,e);const n=Sr(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Sr(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(i=>i!==void 0)}};function ZEe(t,e){return Sr(t.type._def,e)}function JEe(t,e){const r={type:"array",uniqueItems:!0,items:Sr(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(r.minItems=t.minSize.value),t.maxSize&&(r.maxItems=t.maxSize.value),r}function QEe(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>Sr(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Sr(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>Sr(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function eTe(){return{not:Qs()}}function tTe(){return Qs()}var nTe=(t,e)=>Sr(t.innerType._def,e),rTe=(t,e,n)=>{switch(e){case Cn.ZodString:return IQ(t,n);case Cn.ZodNumber:return qEe(t);case Cn.ZodObject:return GEe(t,n);case Cn.ZodBigInt:return CEe(t);case Cn.ZodBoolean:return MEe();case Cn.ZodDate:return kQ(t,n);case Cn.ZodUndefined:return eTe();case Cn.ZodNull:return jEe();case Cn.ZodArray:return TEe(t,n);case Cn.ZodUnion:case Cn.ZodDiscriminatedUnion:return HEe(t,n);case Cn.ZodIntersection:return DEe(t,n);case Cn.ZodTuple:return QEe(t,n);case Cn.ZodRecord:return NQ(t,n);case Cn.ZodLiteral:return OEe(t);case Cn.ZodEnum:return REe(t);case Cn.ZodNativeEnum:return UEe(t);case Cn.ZodNullable:return VEe(t,n);case Cn.ZodOptional:return XEe(t,n);case Cn.ZodMap:return BEe(t,n);case Cn.ZodSet:return JEe(t,n);case Cn.ZodLazy:return()=>t.getter()._def;case Cn.ZodPromise:return ZEe(t,n);case Cn.ZodNaN:case Cn.ZodNever:return zEe();case Cn.ZodEffects:return NEe(t,n);case Cn.ZodAny:return Qs();case Cn.ZodUnknown:return tTe();case Cn.ZodDefault:return IEe(t,n);case Cn.ZodBranded:return AQ(t,n);case Cn.ZodReadonly:return nTe(t,n);case Cn.ZodCatch:return AEe(t,n);case Cn.ZodPipeline:return KEe(t,n);case Cn.ZodFunction:case Cn.ZodVoid:case Cn.ZodSymbol:return;default:return(r=>{})()}},iTe=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")};function Sr(t,e,n=!1){var r;const i=e.seen.get(t);if(e.override){const l=(r=e.override)==null?void 0:r.call(e,t,e,i,n);if(l!==SEe)return l}if(i&&!n){const l=aTe(i,e);if(l!==void 0)return l}const a={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,a);const s=rTe(t,t.typeName,e),o=typeof s=="function"?Sr(s(),e):s;if(o&&sTe(t,e,o),e.postProcess){const l=e.postProcess(o,t,e);return a.jsonSchema=o,l}return a.jsonSchema=o,o}var aTe=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:iTe(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Qs()):e.$refStrategy==="seen"?Qs():void 0}},sTe=(t,e,n)=>(t.description&&(n.description=t.description),n),oTe=t=>{const e=EEe(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},lTe=(t,e)=>{var n;const r=oTe(e);let i=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,d])=>{var h;return{...u,[c]:(h=Sr(d._def,{...r,currentPath:[...r.basePath,r.definitionPath,c]},!0))!=null?h:Qs()}},{}):void 0;const a=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=(n=Sr(t._def,a===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1))!=null?n:Qs(),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(s.title=o);const l=a===void 0?i?{...s,[r.definitionPath]:i}:s:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...i,[a]:s}};return l.$schema="http://json-schema.org/draft-07/schema#",l},mI=Symbol.for("vercel.ai.schema");function at(t){let e;return()=>(e==null&&(e=t()),e)}function a3(t,{validate:e}={}){return{[mI]:!0,_type:void 0,get jsonSchema(){return typeof t=="function"&&(t=t()),t},validate:e}}function uTe(t){return typeof t=="object"&&t!==null&&mI in t&&t[mI]===!0&&"jsonSchema"in t&&"validate"in t}function xf(t){return t==null?a3({properties:{},additionalProperties:!1}):uTe(t)?t:"~standard"in t?t["~standard"].vendor==="zod"?it(t):cTe(t):t()}function cTe(t){return a3(()=>Z8(t["~standard"].jsonSchema.input({target:"draft-07"})),{validate:async e=>{const n=await t["~standard"].validate(e);return"value"in n?{success:!0,value:n.value}:{success:!1,error:new tf({value:e,cause:n.issues})}}})}function dTe(t,e){var n;const r=(n=void 0)!=null?n:!1;return a3(()=>lTe(t,{$refStrategy:r?"root":"none"}),{validate:async i=>{const a=await t.safeParseAsync(i);return a.success?{success:!0,value:a.data}:{success:!1,error:a.error}}})}function hTe(t,e){var n;const r=(n=void 0)!=null?n:!1;return a3(()=>Z8(GSe(t,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async i=>{const a=await mQ(t,i);return a.success?{success:!0,value:a.data}:{success:!1,error:a.error}}})}function fTe(t){return"_zod"in t}function it(t,e){return fTe(t)?hTe(t):dTe(t)}async function Kn({value:t,schema:e}){const n=await xo({value:t,schema:e});if(!n.success)throw tf.wrap({value:t,cause:n.error});return n.value}async function xo({value:t,schema:e}){const n=xf(e);try{if(n.validate==null)return{success:!0,value:t,rawValue:t};const r=await n.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:tf.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:tf.wrap({value:t,cause:r}),rawValue:t}}}async function pTe({text:t,schema:e}){try{const n=K8(t);return e==null?n:Kn({value:n,schema:e})}catch(n){throw ow.isInstance(n)||tf.isInstance(n)?n:new ow({text:t,cause:n})}}async function bo({text:t,schema:e}){try{const n=K8(t);return e==null?{success:!0,value:n,rawValue:n}:await xo({value:n,schema:e})}catch(n){return{success:!1,error:ow.isInstance(n)?n:new ow({text:t,cause:n}),rawValue:void 0}}}function gw(t){try{return K8(t),!0}catch{return!1}}function mTe({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new hEe).pipeThrough(new TransformStream({async transform({data:n},r){n!=="[DONE]"&&r.enqueue(await bo({text:n,schema:e}))}}))}async function sr({provider:t,providerOptions:e,schema:n}){if(e?.[t]==null)return;const r=await xo({value:e[t],schema:n});if(!r.success)throw new nJ({argument:"providerOptions",message:`invalid ${t} provider options`,cause:r.error});return r.value}var gTe=()=>globalThis.fetch,Fn=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s})=>RQ({url:t,headers:{"Content-Type":"application/json",...e},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s}),s3=async({url:t,headers:e,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s})=>RQ({url:t,headers:e,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s}),RQ=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:s=gTe()})=>{try{const o=await s(t,{method:"POST",headers:To(e,`ai-sdk/provider-utils/${CQ}`,Av()),body:n.content,signal:a}),l=xd(o);if(!o.ok){let u;try{u=await i({response:o,url:t,requestBodyValues:n.values})}catch(c){throw nf(c)||ji.isInstance(c)?c:new ji({message:"Failed to process error response",cause:c,statusCode:o.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw u.value}try{return await r({response:o,url:t,requestBodyValues:n.values})}catch(u){throw u instanceof Error&&(nf(u)||ji.isInstance(u))?u:new ji({message:"Failed to process successful response",cause:u,statusCode:o.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(o){throw TQ({error:o,url:t,requestBodyValues:n.values})}};function Qr({id:t,inputSchema:e}){return({execute:n,outputSchema:r,needsApproval:i,toModelOutput:a,onInputStart:s,onInputDelta:o,onInputAvailable:l,...u})=>({type:"provider",id:t,args:u,inputSchema:e,outputSchema:r,execute:n,needsApproval:i,toModelOutput:a,onInputStart:s,onInputDelta:o,onInputAvailable:l})}function Fr({id:t,inputSchema:e,outputSchema:n,supportsDeferredResults:r}){return({execute:i,needsApproval:a,toModelOutput:s,onInputStart:o,onInputDelta:l,onInputAvailable:u,...c})=>({type:"provider",id:t,args:c,inputSchema:e,outputSchema:n,execute:i,needsApproval:a,toModelOutput:s,onInputStart:o,onInputDelta:l,onInputAvailable:u,supportsDeferredResults:r})}async function Vr(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var Fa=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{const s=await r.text(),o=xd(r);if(s.trim()==="")return{responseHeaders:o,value:new ji({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,isRetryable:n?.(r)})};try{const l=await pTe({text:s,schema:t});return{responseHeaders:o,value:new ji({message:e(l),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:o,value:new ji({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,isRetryable:n?.(r)})}}},Xu=t=>async({response:e})=>{const n=xd(e);if(e.body==null)throw new QZ({});return{responseHeaders:n,value:mTe({stream:e.body,schema:t})}},vr=t=>async({response:e,url:n,requestBodyValues:r})=>{const i=await e.text(),a=await bo({text:i,schema:t}),s=xd(e);if(!a.success)throw new ji({message:"Invalid JSON response",cause:a.error,statusCode:e.status,responseHeaders:s,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:s,value:a.value,rawValue:a.rawValue}},PQ=()=>async({response:t,url:e,requestBodyValues:n})=>{const r=xd(t);if(!t.body)throw new ji({message:"Response body is empty",url:e,requestBodyValues:n,statusCode:t.status,responseHeaders:r,responseBody:void 0});try{const i=await t.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(i)}}catch(i){throw new ji({message:"Failed to read response as array buffer",url:e,requestBodyValues:n,statusCode:t.status,responseHeaders:r,responseBody:void 0,cause:i})}};function rf(t){return t?.replace(/\/$/,"")}function vTe(t){return t!=null&&typeof t[Symbol.asyncIterator]=="function"}async function*yTe({execute:t,input:e,options:n}){const r=t(e,n);if(vTe(r)){let i;for await(const a of r)i=a,yield{type:"preliminary",output:a};yield{type:"final",output:i}}else yield{type:"final",output:await r}}var VE,GF;function xTe(){if(GF)return VE;GF=1;var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,i=(c,d)=>{for(var h in d)t(c,h,{get:d[h],enumerable:!0})},a=(c,d,h,f)=>{if(d&&typeof d=="object"||typeof d=="function")for(let m of n(d))!r.call(c,m)&&m!==h&&t(c,m,{get:()=>d[m],enumerable:!(f=e(d,m))||f.enumerable});return c},s=c=>a(t({},"__esModule",{value:!0}),c),o={};i(o,{SYMBOL_FOR_REQ_CONTEXT:()=>l,getContext:()=>u}),VE=s(o);const l=Symbol.for("@vercel/request-context");function u(){return globalThis[l]?.get?.()??{}}return VE}var qE,WF;function bTe(){if(WF)return qE;WF=1;var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,i=(d,h)=>{for(var f in h)t(d,f,{get:h[f],enumerable:!0})},a=(d,h,f,m)=>{if(h&&typeof h=="object"||typeof h=="function")for(let x of n(h))!r.call(d,x)&&x!==f&&t(d,x,{get:()=>h[x],enumerable:!(m=e(h,x))||m.enumerable});return d},s=d=>a(t({},"__esModule",{value:!0}),d),o={};i(o,{getContext:()=>l.getContext,getVercelOidcToken:()=>u,getVercelOidcTokenSync:()=>c}),qE=s(o);var l=xTe();async function u(){return""}function c(){return""}return qE}var DQ=bTe(),_Te="vercel.ai.gateway.error",GE=Symbol.for(_Te),YF,XF,eo=class OQ extends(XF=Error,YF=GE,XF){constructor({message:e,statusCode:n=500,cause:r}){super(e),this[YF]=!0,this.statusCode=n,this.cause=r}static isInstance(e){return OQ.hasMarker(e)}static hasMarker(e){return typeof e=="object"&&e!==null&&GE in e&&e[GE]===!0}},LQ="GatewayAuthenticationError",wTe=`vercel.ai.gateway.error.${LQ}`,KF=Symbol.for(wTe),ZF,JF,J8=class FQ extends(JF=eo,ZF=KF,JF){constructor({message:e="Authentication failed",statusCode:n=401,cause:r}={}){super({message:e,statusCode:n,cause:r}),this[ZF]=!0,this.name=LQ,this.type="authentication_error"}static isInstance(e){return eo.hasMarker(e)&&KF in e}static createContextualError({apiKeyProvided:e,oidcTokenProvided:n,message:r="Authentication failed",statusCode:i=401,cause:a}){let s;return e?s=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?s=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:s=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new FQ({message:s,statusCode:i,cause:a})}},BQ="GatewayInvalidRequestError",STe=`vercel.ai.gateway.error.${BQ}`,QF=Symbol.for(STe),eB,tB,ETe=class extends(tB=eo,eB=QF,tB){constructor({message:t="Invalid request",statusCode:e=400,cause:n}={}){super({message:t,statusCode:e,cause:n}),this[eB]=!0,this.name=BQ,this.type="invalid_request_error"}static isInstance(t){return eo.hasMarker(t)&&QF in t}},UQ="GatewayRateLimitError",TTe=`vercel.ai.gateway.error.${UQ}`,nB=Symbol.for(TTe),rB,iB,CTe=class extends(iB=eo,rB=nB,iB){constructor({message:t="Rate limit exceeded",statusCode:e=429,cause:n}={}){super({message:t,statusCode:e,cause:n}),this[rB]=!0,this.name=UQ,this.type="rate_limit_exceeded"}static isInstance(t){return eo.hasMarker(t)&&nB in t}},zQ="GatewayModelNotFoundError",MTe=`vercel.ai.gateway.error.${zQ}`,aB=Symbol.for(MTe),ATe=at(()=>it(B({modelId:A()}))),sB,oB,kTe=class extends(oB=eo,sB=aB,oB){constructor({message:t="Model not found",statusCode:e=404,modelId:n,cause:r}={}){super({message:t,statusCode:e,cause:r}),this[sB]=!0,this.name=zQ,this.type="model_not_found",this.modelId=n}static isInstance(t){return eo.hasMarker(t)&&aB in t}},jQ="GatewayInternalServerError",ITe=`vercel.ai.gateway.error.${jQ}`,lB=Symbol.for(ITe),uB,cB,dB=class extends(cB=eo,uB=lB,cB){constructor({message:t="Internal server error",statusCode:e=500,cause:n}={}){super({message:t,statusCode:e,cause:n}),this[uB]=!0,this.name=jQ,this.type="internal_server_error"}static isInstance(t){return eo.hasMarker(t)&&lB in t}},HQ="GatewayResponseError",NTe=`vercel.ai.gateway.error.${HQ}`,hB=Symbol.for(NTe),fB,pB,RTe=class extends(pB=eo,fB=hB,pB){constructor({message:t="Invalid response from Gateway",statusCode:e=502,response:n,validationError:r,cause:i}={}){super({message:t,statusCode:e,cause:i}),this[fB]=!0,this.name=HQ,this.type="response_error",this.response=n,this.validationError=r}static isInstance(t){return eo.hasMarker(t)&&hB in t}};async function mB({response:t,statusCode:e,defaultMessage:n="Gateway request failed",cause:r,authMethod:i}){const a=await xo({value:t,schema:PTe});if(!a.success)return new RTe({message:`Invalid error response format: ${n}`,statusCode:e,response:t,validationError:a.error,cause:r});const s=a.value,o=s.error.type,l=s.error.message;switch(o){case"authentication_error":return J8.createContextualError({apiKeyProvided:i==="api-key",oidcTokenProvided:i==="oidc",statusCode:e,cause:r});case"invalid_request_error":return new ETe({message:l,statusCode:e,cause:r});case"rate_limit_exceeded":return new CTe({message:l,statusCode:e,cause:r});case"model_not_found":{const u=await xo({value:s.error.param,schema:ATe});return new kTe({message:l,statusCode:e,modelId:u.success?u.value.modelId:void 0,cause:r})}case"internal_server_error":return new dB({message:l,statusCode:e,cause:r});default:return new dB({message:l,statusCode:e,cause:r})}}var PTe=at(()=>it(B({error:B({message:A(),type:A().nullish(),param:Zn().nullish(),code:vt([A(),ie()]).nullish()})})));function sd(t,e){var n;return eo.isInstance(t)?t:ji.isInstance(t)?mB({response:DTe(t),statusCode:(n=t.statusCode)!=null?n:500,defaultMessage:"Gateway request failed",cause:t,authMethod:e}):mB({response:{},statusCode:500,defaultMessage:t instanceof Error?`Gateway request failed: ${t.message}`:"Unknown Gateway error",cause:t,authMethod:e})}function DTe(t){if(t.data!==void 0)return t.data;if(t.responseBody!=null)try{return JSON.parse(t.responseBody)}catch{return t.responseBody}return{}}var $Q="ai-gateway-auth-method";async function _0(t){const e=await xo({value:t[$Q],schema:OTe});return e.success?e.value:void 0}var OTe=at(()=>it(vt([ae("api-key"),ae("oidc")]))),gB=class{constructor(t){this.config=t}async getAvailableModels(){try{const{value:t}=await HF({url:`${this.config.baseURL}/config`,headers:await Vr(this.config.headers()),successfulResponseHandler:vr(LTe),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:e=>e}),fetch:this.config.fetch});return t}catch(t){throw await sd(t)}}async getCredits(){try{const t=new URL(this.config.baseURL),{value:e}=await HF({url:`${t.origin}/v1/credits`,headers:await Vr(this.config.headers()),successfulResponseHandler:vr(FTe),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:n=>n}),fetch:this.config.fetch});return e}catch(t){throw await sd(t)}}},LTe=at(()=>it(B({models:Ce(B({id:A(),name:A(),description:A().nullish(),pricing:B({input:A(),output:A(),input_cache_read:A().nullish(),input_cache_write:A().nullish()}).transform(({input:t,output:e,input_cache_read:n,input_cache_write:r})=>({input:t,output:e,...n?{cachedInputTokens:n}:{},...r?{cacheCreationInputTokens:r}:{}})).nullish(),specification:B({specificationVersion:ae("v3"),provider:A(),modelId:A()}),modelType:wt(["language","embedding","image"]).nullish()}))}))),FTe=at(()=>it(B({balance:A(),total_used:A()}).transform(({balance:t,total_used:e})=>({balance:t,totalUsed:e})))),BTe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(t){const{abortSignal:e,...n}=t;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(t){const{args:e,warnings:n}=await this.getArgs(t),{abortSignal:r}=t,i=await Vr(this.config.headers());try{const{responseHeaders:a,value:s,rawValue:o}=await Fn({url:this.getUrl(),headers:Mn(i,t.headers,this.getModelConfigHeaders(this.modelId,!1),await Vr(this.config.o11yHeaders)),body:e,successfulResponseHandler:vr(gr()),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:l=>l}),...r&&{abortSignal:r},fetch:this.config.fetch});return{...s,request:{body:e},response:{headers:a,body:o},warnings:n}}catch(a){throw await sd(a,await _0(i))}}async doStream(t){const{args:e,warnings:n}=await this.getArgs(t),{abortSignal:r}=t,i=await Vr(this.config.headers());try{const{value:a,responseHeaders:s}=await Fn({url:this.getUrl(),headers:Mn(i,t.headers,this.getModelConfigHeaders(this.modelId,!0),await Vr(this.config.o11yHeaders)),body:e,successfulResponseHandler:Xu(gr()),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:o=>o}),...r&&{abortSignal:r},fetch:this.config.fetch});return{stream:a.pipeThrough(new TransformStream({start(o){n.length>0&&o.enqueue({type:"stream-start",warnings:n})},transform(o,l){if(o.success){const u=o.value;if(u.type==="raw"&&!t.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),l.enqueue(u)}else l.error(o.error)}})),request:{body:e},response:{headers:s}}}catch(a){throw await sd(a,await _0(i))}}isFilePart(t){return t&&typeof t=="object"&&"type"in t&&t.type==="file"}maybeEncodeFileParts(t){for(const e of t.prompt)for(const n of e.content)if(this.isFilePart(n)){const r=n;if(r.data instanceof Uint8Array){const i=Uint8Array.from(r.data),a=Buffer.from(i).toString("base64");r.data=new URL(`data:${r.mediaType||"application/octet-stream"};base64,${a}`)}}return t}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(t,e){return{"ai-language-model-specification-version":"3","ai-language-model-id":t,"ai-language-model-streaming":String(e)}}},UTe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:t,headers:e,abortSignal:n,providerOptions:r}){var i;const a=await Vr(this.config.headers());try{const{responseHeaders:s,value:o,rawValue:l}=await Fn({url:this.getUrl(),headers:Mn(a,e??{},this.getModelConfigHeaders(),await Vr(this.config.o11yHeaders)),body:{values:t,...r?{providerOptions:r}:{}},successfulResponseHandler:vr(zTe),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:u=>u}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:o.embeddings,usage:(i=o.usage)!=null?i:void 0,providerMetadata:o.providerMetadata,response:{headers:s,body:l},warnings:[]}}catch(s){throw await sd(s,await _0(a))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"3","ai-model-id":this.modelId}}},zTe=at(()=>it(B({embeddings:Ce(Ce(ie())),usage:B({tokens:ie()}).nullish(),providerMetadata:sn(A(),sn(A(),Zn())).optional()}))),jTe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.maxImagesPerCall=Number.MAX_SAFE_INTEGER}get provider(){return this.config.provider}async doGenerate({prompt:t,n:e,size:n,aspectRatio:r,seed:i,files:a,mask:s,providerOptions:o,headers:l,abortSignal:u}){var c;const d=await Vr(this.config.headers());try{const{responseHeaders:h,value:f,rawValue:m}=await Fn({url:this.getUrl(),headers:Mn(d,l??{},this.getModelConfigHeaders(),await Vr(this.config.o11yHeaders)),body:{prompt:t,n:e,...n&&{size:n},...r&&{aspectRatio:r},...i&&{seed:i},...o&&{providerOptions:o},...a&&{files:a.map(x=>vB(x))},...s&&{mask:vB(s)}},successfulResponseHandler:vr($Te),failedResponseHandler:Fa({errorSchema:gr(),errorToMessage:x=>x}),...u&&{abortSignal:u},fetch:this.config.fetch});return{images:f.images,warnings:(c=f.warnings)!=null?c:[],providerMetadata:f.providerMetadata,response:{timestamp:new Date,modelId:this.modelId,headers:h}}}catch(h){throw sd(h,await _0(d))}}getUrl(){return`${this.config.baseURL}/image-model`}getModelConfigHeaders(){return{"ai-image-model-specification-version":"3","ai-model-id":this.modelId}}};function vB(t){return t.type==="file"&&t.data instanceof Uint8Array?{...t,data:b0(t.data)}:t}var HTe=B({images:Ce(Zn()).optional()}).catchall(Zn()),$Te=B({images:Ce(A()),warnings:Ce(B({type:ae("other"),message:A()})).optional(),providerMetadata:sn(A(),HTe).optional()}),VTe=at(()=>it(B({query:vt([A(),Ce(A())]).describe("Search query (string) or multiple queries (array of up to 5 strings). Multi-query searches return combined results from all queries."),max_results:ie().optional().describe("Maximum number of search results to return (1-20, default: 10)"),max_tokens_per_page:ie().optional().describe("Maximum number of tokens to extract per search result page (256-2048, default: 2048)"),max_tokens:ie().optional().describe("Maximum total tokens across all search results (default: 25000, max: 1000000)"),country:A().optional().describe("Two-letter ISO 3166-1 alpha-2 country code for regional search results (e.g., 'US', 'GB', 'FR')"),search_domain_filter:Ce(A()).optional().describe("List of domains to include or exclude from search results (max 20). To include: ['nature.com', 'science.org']. To exclude: ['-example.com', '-spam.net']"),search_language_filter:Ce(A()).optional().describe("List of ISO 639-1 language codes to filter results (max 10, lowercase). Examples: ['en', 'fr', 'de']"),search_after_date:A().optional().describe("Include only results published after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),search_before_date:A().optional().describe("Include only results published before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),last_updated_after_filter:A().optional().describe("Include only results last updated after this date. Format: 'MM/DD/YYYY' (e.g., '3/1/2025'). Cannot be used with search_recency_filter."),last_updated_before_filter:A().optional().describe("Include only results last updated before this date. Format: 'MM/DD/YYYY' (e.g., '3/15/2025'). Cannot be used with search_recency_filter."),search_recency_filter:wt(["day","week","month","year"]).optional().describe("Filter results by relative time period. Cannot be used with search_after_date or search_before_date.")}))),qTe=at(()=>it(vt([B({results:Ce(B({title:A(),url:A(),snippet:A(),date:A().optional(),lastUpdated:A().optional()})),id:A()}),B({error:wt(["api_error","rate_limit","timeout","invalid_input","unknown"]),statusCode:ie().optional(),message:A()})]))),GTe=Fr({id:"gateway.perplexity_search",inputSchema:VTe,outputSchema:qTe}),WTe=(t={})=>GTe(t),YTe={perplexitySearch:WTe};async function XTe(){var t;return(t=DQ.getContext().headers)==null?void 0:t["x-vercel-id"]}var KTe="3.0.16",ZTe="0.0.1";function JTe(t={}){var e,n;let r=null,i=null;const a=(e=t.metadataCacheRefreshMillis)!=null?e:1e3*60*5;let s=0;const o=(n=rf(t.baseURL))!=null?n:"https://ai-gateway.vercel.sh/v3/ai",l=async()=>{try{const x=await e5e(t);return To({Authorization:`Bearer ${x.token}`,"ai-gateway-protocol-version":ZTe,[$Q]:x.authMethod,...t.headers},`ai-sdk/gateway/${KTe}`)}catch(x){throw J8.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401,cause:x})}},u=()=>{const x=Kc({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),b=Kc({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),y=Kc({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const w=await XTe();return{...x&&{"ai-o11y-deployment-id":x},...b&&{"ai-o11y-environment":b},...y&&{"ai-o11y-region":y},...w&&{"ai-o11y-request-id":w}}}},c=x=>new BTe(x,{provider:"gateway",baseURL:o,headers:l,fetch:t.fetch,o11yHeaders:u()}),d=async()=>{var x,b,y;const w=(y=(b=(x=t._internal)==null?void 0:x.currentDate)==null?void 0:b.call(x).getTime())!=null?y:Date.now();return(!r||w-s>a)&&(s=w,r=new gB({baseURL:o,headers:l,fetch:t.fetch}).getAvailableModels().then(_=>(i=_,_)).catch(async _=>{throw await sd(_,await _0(await l()))})),i?Promise.resolve(i):r},h=async()=>new gB({baseURL:o,headers:l,fetch:t.fetch}).getCredits().catch(async x=>{throw await sd(x,await _0(await l()))}),f=function(x){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return c(x)};f.specificationVersion="v3",f.getAvailableModels=d,f.getCredits=h,f.imageModel=x=>new jTe(x,{provider:"gateway",baseURL:o,headers:l,fetch:t.fetch,o11yHeaders:u()}),f.languageModel=c;const m=x=>new UTe(x,{provider:"gateway",baseURL:o,headers:l,fetch:t.fetch,o11yHeaders:u()});return f.embeddingModel=m,f.textEmbeddingModel=m,f.tools=YTe,f}var QTe=JTe();async function e5e(t){const e=Kc({settingValue:t.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});return e?{token:e,authMethod:"api-key"}:{token:await DQ.getVercelOidcToken(),authMethod:"oidc"}}var t5e=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Mh="1.9.0",yB=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function n5e(t){var e=new Set([t]),n=new Set,r=t.match(yB);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(l){return l===t};function a(o){return n.add(o),!1}function s(o){return e.add(o),!0}return function(l){if(e.has(l))return!0;if(n.has(l))return!1;var u=l.match(yB);if(!u)return a(l);var c={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return c.prerelease!=null||i.major!==c.major?a(l):i.major===0?i.minor===c.minor&&i.patch<=c.patch?s(l):a(l):i.minor<=c.minor?s(l):a(l)}}var r5e=n5e(Mh),i5e=Mh.split(".")[0],I1=Symbol.for("opentelemetry.js.api."+i5e),N1=t5e;function Q8(t,e,n,r){var i;r===void 0&&(r=!1);var a=N1[I1]=(i=N1[I1])!==null&&i!==void 0?i:{version:Mh};if(!r&&a[t]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(s.stack||s.message),!1}if(a.version!==Mh){var s=new Error("@opentelemetry/api: Registration of version v"+a.version+" for "+t+" does not match previously registered API v"+Mh);return n.error(s.stack||s.message),!1}return a[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+Mh+"."),!0}function R1(t){var e,n,r=(e=N1[I1])===null||e===void 0?void 0:e.version;if(!(!r||!r5e(r)))return(n=N1[I1])===null||n===void 0?void 0:n[t]}function eR(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+Mh+".");var n=N1[I1];n&&delete n[t]}var a5e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,a=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return a},s5e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))},o5e=(function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zm("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zm("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zm("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zm("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zm("verbose",this._namespace,e)},t})();function Zm(t,e,n){var r=R1("diag");if(r)return n.unshift(e),r[t].apply(r,s5e([],a5e(n),!1))}var Hs;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(Hs||(Hs={}));function l5e(t,e){t<Hs.NONE?t=Hs.NONE:t>Hs.ALL&&(t=Hs.ALL),e=e||{};function n(r,i){var a=e[r];return typeof a=="function"&&t>=i?a.bind(e):function(){}}return{error:n("error",Hs.ERROR),warn:n("warn",Hs.WARN),info:n("info",Hs.INFO),debug:n("debug",Hs.DEBUG),verbose:n("verbose",Hs.VERBOSE)}}var u5e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,a=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return a},c5e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))},d5e="diag",vw=(function(){function t(){function e(i){return function(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];var o=R1("diag");if(o)return o[i].apply(o,c5e([],u5e(a),!1))}}var n=this,r=function(i,a){var s,o,l;if(a===void 0&&(a={logLevel:Hs.INFO}),i===n){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((s=u.stack)!==null&&s!==void 0?s:u.message),!1}typeof a=="number"&&(a={logLevel:a});var c=R1("diag"),d=l5e((o=a.logLevel)!==null&&o!==void 0?o:Hs.INFO,i);if(c&&!a.suppressOverrideMessage){var h=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+h),d.warn("Current logger will overwrite one already registered from "+h)}return Q8("diag",d,n,!0)};n.setLogger=r,n.disable=function(){eR(d5e,n)},n.createComponentLogger=function(i){return new o5e(i)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t})();function h5e(t){return Symbol.for(t)}var f5e=(function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var a=new t(n._currentContext);return a._currentContext.set(r,i),a},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t})(),p5e=new f5e,m5e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,a=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return a},g5e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))},v5e=(function(){function t(){}return t.prototype.active=function(){return p5e},t.prototype.with=function(e,n,r){for(var i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];return n.call.apply(n,g5e([r],m5e(i),!1))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t})(),y5e=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,a=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return a},x5e=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))},WE="context",b5e=new v5e,tR=(function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return Q8(WE,e,vw.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return(i=this._getContextManager()).with.apply(i,x5e([e,n,r],y5e(a),!1))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return R1(WE)||b5e},t.prototype.disable=function(){this._getContextManager().disable(),eR(WE,vw.instance())},t})(),gI;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(gI||(gI={}));var VQ="0000000000000000",qQ="00000000000000000000000000000000",_5e={traceId:qQ,spanId:VQ,traceFlags:gI.NONE},$g=(function(){function t(e){e===void 0&&(e=_5e),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t})(),nR=h5e("OpenTelemetry Context Key SPAN");function rR(t){return t.getValue(nR)||void 0}function w5e(){return rR(tR.getInstance().active())}function iR(t,e){return t.setValue(nR,e)}function S5e(t){return t.deleteValue(nR)}function E5e(t,e){return iR(t,new $g(e))}function GQ(t){var e;return(e=rR(t))===null||e===void 0?void 0:e.spanContext()}var T5e=/^([0-9a-f]{32})$/i,C5e=/^[0-9a-f]{16}$/i;function M5e(t){return T5e.test(t)&&t!==qQ}function A5e(t){return C5e.test(t)&&t!==VQ}function WQ(t){return M5e(t.traceId)&&A5e(t.spanId)}function k5e(t){return new $g(t)}var YE=tR.getInstance(),YQ=(function(){function t(){}return t.prototype.startSpan=function(e,n,r){r===void 0&&(r=YE.active());var i=!!n?.root;if(i)return new $g;var a=r&&GQ(r);return I5e(a)&&WQ(a)?new $g(a):new $g},t.prototype.startActiveSpan=function(e,n,r,i){var a,s,o;if(!(arguments.length<2)){arguments.length===2?o=n:arguments.length===3?(a=n,o=r):(a=n,s=r,o=i);var l=s??YE.active(),u=this.startSpan(e,a,l),c=iR(l,u);return YE.with(c,o,void 0,u)}},t})();function I5e(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var N5e=new YQ,R5e=(function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):N5e},t})(),P5e=(function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new YQ},t})(),D5e=new P5e,xB=(function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new R5e(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:D5e},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t})(),yw;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(yw||(yw={}));var bB=tR.getInstance(),XE="trace",O5e=(function(){function t(){this._proxyTracerProvider=new xB,this.wrapSpanContext=k5e,this.isSpanContextValid=WQ,this.deleteSpan=S5e,this.getSpan=rR,this.getActiveSpan=w5e,this.getSpanContext=GQ,this.setSpan=iR,this.setSpanContext=E5e}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=Q8(XE,this._proxyTracerProvider,vw.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return R1(XE)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){eR(XE,vw.instance()),this._proxyTracerProvider=new xB},t})(),L5e=O5e.getInstance(),F5e=Object.defineProperty,B5e=(t,e)=>{for(var n in e)F5e(t,n,{get:e[n],enumerable:!0})},XQ="AI_InvalidArgumentError",KQ=`vercel.ai.error.${XQ}`,U5e=Symbol.for(KQ),ZQ,Sl=class extends pn{constructor({parameter:e,value:n,message:r}){super({name:XQ,message:`Invalid argument for parameter ${e}: ${r}`}),this[ZQ]=!0,this.parameter=e,this.value=n}static isInstance(e){return pn.hasMarker(e,KQ)}};ZQ=U5e;var JQ="AI_InvalidToolApprovalError",QQ=`vercel.ai.error.${JQ}`,z5e=Symbol.for(QQ),eee,j5e=class extends pn{constructor({approvalId:t}){super({name:JQ,message:`Tool approval response references unknown approvalId: "${t}". No matching tool-approval-request found in message history.`}),this[eee]=!0,this.approvalId=t}static isInstance(t){return pn.hasMarker(t,QQ)}};eee=z5e;var tee="AI_InvalidToolInputError",nee=`vercel.ai.error.${tee}`,H5e=Symbol.for(nee),ree,aR=class extends pn{constructor({toolInput:t,toolName:e,cause:n,message:r=`Invalid input for tool ${e}: ${ef(n)}`}){super({name:tee,message:r,cause:n}),this[ree]=!0,this.toolInput=t,this.toolName=e}static isInstance(t){return pn.hasMarker(t,nee)}};ree=H5e;var iee="AI_ToolCallNotFoundForApprovalError",aee=`vercel.ai.error.${iee}`,$5e=Symbol.for(aee),see,sR=class extends pn{constructor({toolCallId:t,approvalId:e}){super({name:iee,message:`Tool call "${t}" not found for approval request "${e}".`}),this[see]=!0,this.toolCallId=t,this.approvalId=e}static isInstance(t){return pn.hasMarker(t,aee)}};see=$5e;var oee="AI_NoObjectGeneratedError",lee=`vercel.ai.error.${oee}`,V5e=Symbol.for(lee),uee,Zc=class extends pn{constructor({message:t="No object generated.",cause:e,text:n,response:r,usage:i,finishReason:a}){super({name:oee,message:t,cause:e}),this[uee]=!0,this.text=n,this.response=r,this.usage=i,this.finishReason=a}static isInstance(t){return pn.hasMarker(t,lee)}};uee=V5e;var cee="AI_NoOutputGeneratedError",dee=`vercel.ai.error.${cee}`,q5e=Symbol.for(dee),hee,fee=class extends pn{constructor({message:t="No output generated.",cause:e}={}){super({name:cee,message:t,cause:e}),this[hee]=!0}static isInstance(t){return pn.hasMarker(t,dee)}};hee=q5e;var pee="AI_NoSuchToolError",mee=`vercel.ai.error.${pee}`,G5e=Symbol.for(mee),gee,vI=class extends pn{constructor({toolName:t,availableTools:e=void 0,message:n=`Model tried to call unavailable tool '${t}'. ${e===void 0?"No tools are available.":`Available tools: ${e.join(", ")}.`}`}){super({name:pee,message:n}),this[gee]=!0,this.toolName=t,this.availableTools=e}static isInstance(t){return pn.hasMarker(t,mee)}};gee=G5e;var vee="AI_ToolCallRepairError",yee=`vercel.ai.error.${vee}`,W5e=Symbol.for(yee),xee,Y5e=class extends pn{constructor({cause:t,originalError:e,message:n=`Error repairing tool call: ${ef(t)}`}){super({name:vee,message:n,cause:t}),this[xee]=!0,this.originalError=e}static isInstance(t){return pn.hasMarker(t,yee)}};xee=W5e;var X5e=class extends pn{constructor(t){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${t.version} for provider "${t.provider}" and model "${t.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=t.version,this.provider=t.provider,this.modelId=t.modelId}},bee="AI_UIMessageStreamError",_ee=`vercel.ai.error.${bee}`,K5e=Symbol.for(_ee),wee,Dp=class extends pn{constructor({chunkType:t,chunkId:e,message:n}){super({name:bee,message:n}),this[wee]=!0,this.chunkType=t,this.chunkId=e}static isInstance(t){return pn.hasMarker(t,_ee)}};wee=K5e;var See="AI_InvalidMessageRoleError",Eee=`vercel.ai.error.${See}`,Z5e=Symbol.for(Eee),Tee,J5e=class extends pn{constructor({role:t,message:e=`Invalid message role: '${t}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:See,message:e}),this[Tee]=!0,this.role=t}static isInstance(t){return pn.hasMarker(t,Eee)}};Tee=Z5e;var Cee="AI_RetryError",Mee=`vercel.ai.error.${Cee}`,Q5e=Symbol.for(Mee),Aee,_B=class extends pn{constructor({message:t,reason:e,errors:n}){super({name:Cee,message:t}),this[Aee]=!0,this.reason=e,this.errors=n,this.lastError=n[n.length-1]}static isInstance(t){return pn.hasMarker(t,Mee)}};Aee=Q5e;function eCe({warning:t,provider:e,model:n}){const r=`AI SDK Warning (${e} / ${n}):`;switch(t.type){case"unsupported":{let i=`${r} The feature "${t.feature}" is not supported.`;return t.details&&(i+=` ${t.details}`),i}case"compatibility":{let i=`${r} The feature "${t.feature}" is used in a compatibility mode.`;return t.details&&(i+=` ${t.details}`),i}case"other":return`${r} ${t.message}`;default:return`${r} ${JSON.stringify(t,null,2)}`}}var tCe="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",wB=!1,oR=t=>{if(t.warnings.length===0)return;const e=globalThis.AI_SDK_LOG_WARNINGS;if(e!==!1){if(typeof e=="function"){e(t);return}wB||(wB=!0,console.info(tCe));for(const n of t.warnings)console.warn(eCe({warning:n,provider:t.provider,model:t.model}))}};function nCe({provider:t,modelId:e}){oR({warnings:[{type:"compatibility",feature:"specificationVersion",details:"Using v2 specification compatibility mode. Some features may not be available."}],provider:t,model:e})}function rCe(t){return t.specificationVersion==="v3"?t:(nCe({provider:t.provider,modelId:t.modelId}),new Proxy(t,{get(e,n){switch(n){case"specificationVersion":return"v3";case"doGenerate":return async(...r)=>{const i=await e.doGenerate(...r);return{...i,finishReason:kee(i.finishReason),usage:Iee(i.usage)}};case"doStream":return async(...r)=>{const i=await e.doStream(...r);return{...i,stream:iCe(i.stream)}};default:return e[n]}}}))}function iCe(t){return t.pipeThrough(new TransformStream({transform(e,n){switch(e.type){case"finish":n.enqueue({...e,finishReason:kee(e.finishReason),usage:Iee(e.usage)});break;default:n.enqueue(e);break}}}))}function kee(t){return{unified:t==="unknown"?"other":t,raw:void 0}}function Iee(t){return{inputTokens:{total:t.inputTokens,noCache:void 0,cacheRead:t.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:t.outputTokens,text:void 0,reasoning:t.reasoningTokens}}}function xw(t){if(typeof t!="string"){if(t.specificationVersion!=="v3"&&t.specificationVersion!=="v2"){const e=t;throw new X5e({version:e.specificationVersion,provider:e.provider,modelId:e.modelId})}return rCe(t)}return aCe().languageModel(t)}function aCe(){var t;return(t=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?t:QTe}function lR(t){if(t!=null)return typeof t=="number"?t:t.totalMs}function Nee(t){if(!(t==null||typeof t=="number"))return t.stepMs}function sCe(t){if(!(t==null||typeof t=="number"))return t.chunkMs}var oCe=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],lCe=t=>{const e=typeof t=="string"?Yu(t):t,n=(e[6]&127)<<21|(e[7]&127)<<14|(e[8]&127)<<7|e[9]&127;return e.slice(n+10)};function uCe(t){return typeof t=="string"&&t.startsWith("SUQz")||typeof t!="string"&&t.length>10&&t[0]===73&&t[1]===68&&t[2]===51?lCe(t):t}function cCe({data:t,signatures:e}){const n=uCe(t),r=typeof n=="string"?Yu(n.substring(0,Math.min(n.length,24))):n;for(const i of e)if(r.length>=i.bytesPrefix.length&&i.bytesPrefix.every((a,s)=>a===null||r[s]===a))return i.mediaType}var Ree="6.0.39",dCe=async({url:t})=>{var e;const n=t.toString();try{const r=await fetch(n,{headers:To({},`ai-sdk/${Ree}`,Av())});if(!r.ok)throw new e0({url:n,statusCode:r.status,statusText:r.statusText});return{data:new Uint8Array(await r.arrayBuffer()),mediaType:(e=r.headers.get("content-type"))!=null?e:void 0}}catch(r){throw e0.isInstance(r)?r:new e0({url:n,cause:r})}},hCe=(t=dCe)=>e=>Promise.all(e.map(async n=>n.isUrlSupportedByModel?null:t(n)));function fCe(t){try{const[e,n]=t.split(",");return{mediaType:e.split(";")[0].split(":")[1],base64Content:n}}catch{return{mediaType:void 0,base64Content:void 0}}}var Pee=vt([A(),pw(Uint8Array),pw(ArrayBuffer),oEe(t=>{var e,n;return(n=(e=globalThis.Buffer)==null?void 0:e.isBuffer(t))!=null?n:!1},{message:"Must be a Buffer"})]);function Dee(t){if(t instanceof Uint8Array)return{data:t,mediaType:void 0};if(t instanceof ArrayBuffer)return{data:new Uint8Array(t),mediaType:void 0};if(typeof t=="string")try{t=new URL(t)}catch{}if(t instanceof URL&&t.protocol==="data:"){const{mediaType:e,base64Content:n}=fCe(t.toString());if(e==null||n==null)throw new pn({name:"InvalidDataContentError",message:`Invalid data URL format in content ${t.toString()}`});return{data:n,mediaType:e}}return{data:t,mediaType:void 0}}function pCe(t){return typeof t=="string"?t:t instanceof ArrayBuffer?b0(new Uint8Array(t)):b0(t)}function P1(t){return t===void 0?[]:Array.isArray(t)?t:[t]}async function Oee({prompt:t,supportedUrls:e,download:n=hCe()}){const r=await gCe(t.messages,n,e),i=[...t.system!=null?typeof t.system=="string"?[{role:"system",content:t.system}]:P1(t.system).map(s=>({role:"system",content:s.content,providerOptions:s.providerOptions})):[],...t.messages.map(s=>mCe({message:s,downloadedAssets:r}))],a=[];for(const s of i){if(s.role!=="tool"){a.push(s);continue}const o=a.at(-1);o?.role==="tool"?o.content.push(...s.content):a.push(s)}return a}function mCe({message:t,downloadedAssets:e}){const n=t.role;switch(n){case"system":return{role:"system",content:t.content,providerOptions:t.providerOptions};case"user":return typeof t.content=="string"?{role:"user",content:[{type:"text",text:t.content}],providerOptions:t.providerOptions}:{role:"user",content:t.content.map(r=>vCe(r,e)).filter(r=>r.type!=="text"||r.text!==""),providerOptions:t.providerOptions};case"assistant":return typeof t.content=="string"?{role:"assistant",content:[{type:"text",text:t.content}],providerOptions:t.providerOptions}:{role:"assistant",content:t.content.filter(r=>r.type!=="text"||r.text!==""||r.providerOptions!=null).filter(r=>r.type!=="tool-approval-request").map(r=>{const i=r.providerOptions;switch(r.type){case"file":{const{data:a,mediaType:s}=Dee(r.data);return{type:"file",data:a,filename:r.filename,mediaType:s??r.mediaType,providerOptions:i}}case"reasoning":return{type:"reasoning",text:r.text,providerOptions:i};case"text":return{type:"text",text:r.text,providerOptions:i};case"tool-call":return{type:"tool-call",toolCallId:r.toolCallId,toolName:r.toolName,input:r.input,providerExecuted:r.providerExecuted,providerOptions:i};case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:SB(r.output),providerOptions:i}}}),providerOptions:t.providerOptions};case"tool":return{role:"tool",content:t.content.filter(r=>r.type!=="tool-approval-response"||r.providerExecuted).map(r=>{switch(r.type){case"tool-result":return{type:"tool-result",toolCallId:r.toolCallId,toolName:r.toolName,output:SB(r.output),providerOptions:r.providerOptions};case"tool-approval-response":return{type:"tool-approval-response",approvalId:r.approvalId,approved:r.approved,reason:r.reason}}}),providerOptions:t.providerOptions};default:{const r=n;throw new J5e({role:r})}}}async function gCe(t,e,n){const r=t.filter(a=>a.role==="user").map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>a.type==="image"||a.type==="file").map(a=>{var s;const o=(s=a.mediaType)!=null?s:a.type==="image"?"image/*":void 0;let l=a.type==="image"?a.image:a.data;if(typeof l=="string")try{l=new URL(l)}catch{}return{mediaType:o,data:l}}).filter(a=>a.data instanceof URL).map(a=>({url:a.data,isUrlSupportedByModel:a.mediaType!=null&&xEe({url:a.data.toString(),mediaType:a.mediaType,supportedUrls:n})})),i=await e(r);return Object.fromEntries(i.map((a,s)=>a==null?null:[r[s].url.toString(),{data:a.data,mediaType:a.mediaType}]).filter(a=>a!=null))}function vCe(t,e){var n;if(t.type==="text")return{type:"text",text:t.text,providerOptions:t.providerOptions};let r;const i=t.type;switch(i){case"image":r=t.image;break;case"file":r=t.data;break;default:throw new Error(`Unsupported part type: ${i}`)}const{data:a,mediaType:s}=Dee(r);let o=s??t.mediaType,l=a;if(l instanceof URL){const u=e[l.toString()];u&&(l=u.data,o??(o=u.mediaType))}switch(i){case"image":return(l instanceof Uint8Array||typeof l=="string")&&(o=(n=cCe({data:l,signatures:oCe}))!=null?n:o),{type:"file",mediaType:o??"image/*",filename:void 0,data:l,providerOptions:t.providerOptions};case"file":{if(o==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:o,filename:t.filename,data:l,providerOptions:t.providerOptions}}}}function SB(t){return t.type!=="content"?t:{type:"content",value:t.value.map(e=>e.type!=="media"?e:e.mediaType.startsWith("image/")?{type:"image-data",data:e.data,mediaType:e.mediaType}:{type:"file-data",data:e.data,mediaType:e.mediaType})}}async function Vg({toolCallId:t,input:e,output:n,tool:r,errorMode:i}){return i==="text"?{type:"error-text",value:ef(n)}:i==="json"?{type:"error-json",value:EB(n)}:r?.toModelOutput?await r.toModelOutput({toolCallId:t,input:e,output:n}):typeof n=="string"?{type:"text",value:n}:{type:"json",value:EB(n)}}function EB(t){return t===void 0?null:t}function yI({maxOutputTokens:t,temperature:e,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,seed:s,stopSequences:o}){if(t!=null){if(!Number.isInteger(t))throw new Sl({parameter:"maxOutputTokens",value:t,message:"maxOutputTokens must be an integer"});if(t<1)throw new Sl({parameter:"maxOutputTokens",value:t,message:"maxOutputTokens must be >= 1"})}if(e!=null&&typeof e!="number")throw new Sl({parameter:"temperature",value:e,message:"temperature must be a number"});if(n!=null&&typeof n!="number")throw new Sl({parameter:"topP",value:n,message:"topP must be a number"});if(r!=null&&typeof r!="number")throw new Sl({parameter:"topK",value:r,message:"topK must be a number"});if(i!=null&&typeof i!="number")throw new Sl({parameter:"presencePenalty",value:i,message:"presencePenalty must be a number"});if(a!=null&&typeof a!="number")throw new Sl({parameter:"frequencyPenalty",value:a,message:"frequencyPenalty must be a number"});if(s!=null&&!Number.isInteger(s))throw new Sl({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:t,temperature:e,topP:n,topK:r,presencePenalty:i,frequencyPenalty:a,stopSequences:o,seed:s}}function yCe(t){return t!=null&&Object.keys(t).length>0}async function Lee({tools:t,toolChoice:e,activeTools:n}){if(!yCe(t))return{tools:void 0,toolChoice:void 0};const r=n!=null?Object.entries(t).filter(([a])=>n.includes(a)):Object.entries(t),i=[];for(const[a,s]of r){const o=s.type;switch(o){case void 0:case"dynamic":case"function":i.push({type:"function",name:a,description:s.description,inputSchema:await xf(s.inputSchema).jsonSchema,...s.inputExamples!=null?{inputExamples:s.inputExamples}:{},providerOptions:s.providerOptions,...s.strict!=null?{strict:s.strict}:{}});break;case"provider":i.push({type:"provider",name:a,id:s.id,args:s.args});break;default:{const l=o;throw new Error(`Unsupported tool type: ${l}`)}}}return{tools:i,toolChoice:e==null?{type:"auto"}:typeof e=="string"?{type:e}:{type:"tool",toolName:e.toolName}}}var D1=Cv(()=>vt([V8(),A(),ie(),Ot(),sn(A(),D1.optional()),Ce(D1)])),li=sn(A(),sn(A(),D1.optional())),Fee=B({type:ae("text"),text:A(),providerOptions:li.optional()}),xCe=B({type:ae("image"),image:vt([Pee,pw(URL)]),mediaType:A().optional(),providerOptions:li.optional()}),Bee=B({type:ae("file"),data:vt([Pee,pw(URL)]),filename:A().optional(),mediaType:A(),providerOptions:li.optional()}),bCe=B({type:ae("reasoning"),text:A(),providerOptions:li.optional()}),_Ce=B({type:ae("tool-call"),toolCallId:A(),toolName:A(),input:Zn(),providerOptions:li.optional(),providerExecuted:Ot().optional()}),wCe=Zt("type",[B({type:ae("text"),value:A(),providerOptions:li.optional()}),B({type:ae("json"),value:D1,providerOptions:li.optional()}),B({type:ae("execution-denied"),reason:A().optional(),providerOptions:li.optional()}),B({type:ae("error-text"),value:A(),providerOptions:li.optional()}),B({type:ae("error-json"),value:D1,providerOptions:li.optional()}),B({type:ae("content"),value:Ce(vt([B({type:ae("text"),text:A(),providerOptions:li.optional()}),B({type:ae("media"),data:A(),mediaType:A()}),B({type:ae("file-data"),data:A(),mediaType:A(),filename:A().optional(),providerOptions:li.optional()}),B({type:ae("file-url"),url:A(),providerOptions:li.optional()}),B({type:ae("file-id"),fileId:vt([A(),sn(A(),A())]),providerOptions:li.optional()}),B({type:ae("image-data"),data:A(),mediaType:A(),providerOptions:li.optional()}),B({type:ae("image-url"),url:A(),providerOptions:li.optional()}),B({type:ae("image-file-id"),fileId:vt([A(),sn(A(),A())]),providerOptions:li.optional()}),B({type:ae("custom"),providerOptions:li.optional()})]))})]),Uee=B({type:ae("tool-result"),toolCallId:A(),toolName:A(),output:wCe,providerOptions:li.optional()}),SCe=B({type:ae("tool-approval-request"),approvalId:A(),toolCallId:A()}),ECe=B({type:ae("tool-approval-response"),approvalId:A(),approved:Ot(),reason:A().optional()}),TCe=B({role:ae("system"),content:A(),providerOptions:li.optional()}),CCe=B({role:ae("user"),content:vt([A(),Ce(vt([Fee,xCe,Bee]))]),providerOptions:li.optional()}),MCe=B({role:ae("assistant"),content:vt([A(),Ce(vt([Fee,Bee,bCe,_Ce,Uee,SCe]))]),providerOptions:li.optional()}),ACe=B({role:ae("tool"),content:Ce(vt([Uee,ECe])),providerOptions:li.optional()}),kCe=vt([TCe,CCe,MCe,ACe]);async function zee(t){if(t.prompt==null&&t.messages==null)throw new Mu({prompt:t,message:"prompt or messages must be defined"});if(t.prompt!=null&&t.messages!=null)throw new Mu({prompt:t,message:"prompt and messages cannot be defined at the same time"});if(t.system!=null&&typeof t.system!="string"&&!P1(t.system).every(r=>typeof r=="object"&&r!==null&&"role"in r&&r.role==="system"))throw new Mu({prompt:t,message:"system must be a string, SystemModelMessage, or array of SystemModelMessage"});let e;if(t.prompt!=null&&typeof t.prompt=="string")e=[{role:"user",content:t.prompt}];else if(t.prompt!=null&&Array.isArray(t.prompt))e=t.prompt;else if(t.messages!=null)e=t.messages;else throw new Mu({prompt:t,message:"prompt or messages must be defined"});if(e.length===0)throw new Mu({prompt:t,message:"messages must not be empty"});const n=await xo({value:e,schema:Ce(kCe)});if(!n.success)throw new Mu({prompt:t,message:"The messages do not match the ModelMessage[] schema.",cause:n.error});return{messages:e,system:t.system}}function jee(t){if(!J8.isInstance(t))return t;const e=(process==null?void 0:"production")==="production",n="https://ai-sdk.dev/unauthenticated-ai-gateway";return e?new pn({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${n}`}):Object.assign(new Error(`\x1B[1m\x1B[31mUnauthenticated request to AI Gateway.\x1B[0m

To authenticate, set the \x1B[33mAI_GATEWAY_API_KEY\x1B[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1B[34m${n}\x1B[0m

`),{name:"GatewayAuthenticationError"})}function O1({operationId:t,telemetry:e}){return{"operation.name":`${t}${e?.functionId!=null?` ${e.functionId}`:""}`,"resource.name":e?.functionId,"ai.operationId":t,"ai.telemetry.functionId":e?.functionId}}function Hee({model:t,settings:e,telemetry:n,headers:r}){var i;return{"ai.model.provider":t.provider,"ai.model.id":t.modelId,...Object.entries(e).reduce((a,[s,o])=>{if(s==="timeout"){const l=lR(o);l!=null&&(a[`ai.settings.${s}`]=l)}else a[`ai.settings.${s}`]=o;return a},{}),...Object.entries((i=n?.metadata)!=null?i:{}).reduce((a,[s,o])=>(a[`ai.telemetry.metadata.${s}`]=o,a),{}),...Object.entries(r??{}).reduce((a,[s,o])=>(o!==void 0&&(a[`ai.request.headers.${s}`]=o),a),{})}}var ICe={startSpan(){return tb},startActiveSpan(t,e,n,r){if(typeof e=="function")return e(tb);if(typeof n=="function")return n(tb);if(typeof r=="function")return r(tb)}},tb={spanContext(){return NCe},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},NCe={traceId:"",spanId:"",traceFlags:0};function $ee({isEnabled:t=!1,tracer:e}={}){return t?e||L5e.getTracer("ai"):ICe}async function L1({name:t,tracer:e,attributes:n,fn:r,endWhenDone:i=!0}){return e.startActiveSpan(t,{attributes:await n},async a=>{const s=bB.active();try{const o=await bB.with(s,()=>r(a));return i&&a.end(),o}catch(o){try{Vee(a,o)}finally{a.end()}throw o}})}function Vee(t,e){e instanceof Error?(t.recordException({name:e.name,message:e.message,stack:e.stack}),t.setStatus({code:yw.ERROR,message:e.message})):t.setStatus({code:yw.ERROR})}async function Rl({telemetry:t,attributes:e}){if(t?.isEnabled!==!0)return{};const n={};for(const[r,i]of Object.entries(e))if(i!=null){if(typeof i=="object"&&"input"in i&&typeof i.input=="function"){if(t?.recordInputs===!1)continue;const a=await i.input();a!=null&&(n[r]=a);continue}if(typeof i=="object"&&"output"in i&&typeof i.output=="function"){if(t?.recordOutputs===!1)continue;const a=await i.output();a!=null&&(n[r]=a);continue}n[r]=i}return n}function qee(t){return JSON.stringify(t.map(e=>({...e,content:typeof e.content=="string"?e.content:e.content.map(n=>n.type==="file"?{...n,data:n.data instanceof Uint8Array?pCe(n.data):n.data}:n)})))}function Gee(t){return{inputTokens:t.inputTokens.total,inputTokenDetails:{noCacheTokens:t.inputTokens.noCache,cacheReadTokens:t.inputTokens.cacheRead,cacheWriteTokens:t.inputTokens.cacheWrite},outputTokens:t.outputTokens.total,outputTokenDetails:{textTokens:t.outputTokens.text,reasoningTokens:t.outputTokens.reasoning},totalTokens:jo(t.inputTokens.total,t.outputTokens.total),raw:t.raw,reasoningTokens:t.outputTokens.reasoning,cachedInputTokens:t.inputTokens.cacheRead}}function KE(){return{inputTokens:void 0,inputTokenDetails:{noCacheTokens:void 0,cacheReadTokens:void 0,cacheWriteTokens:void 0},outputTokens:void 0,outputTokenDetails:{textTokens:void 0,reasoningTokens:void 0},totalTokens:void 0,raw:void 0}}function Wee(t,e){var n,r,i,a,s,o,l,u,c,d;return{inputTokens:jo(t.inputTokens,e.inputTokens),inputTokenDetails:{noCacheTokens:jo((n=t.inputTokenDetails)==null?void 0:n.noCacheTokens,(r=e.inputTokenDetails)==null?void 0:r.noCacheTokens),cacheReadTokens:jo((i=t.inputTokenDetails)==null?void 0:i.cacheReadTokens,(a=e.inputTokenDetails)==null?void 0:a.cacheReadTokens),cacheWriteTokens:jo((s=t.inputTokenDetails)==null?void 0:s.cacheWriteTokens,(o=e.inputTokenDetails)==null?void 0:o.cacheWriteTokens)},outputTokens:jo(t.outputTokens,e.outputTokens),outputTokenDetails:{textTokens:jo((l=t.outputTokenDetails)==null?void 0:l.textTokens,(u=e.outputTokenDetails)==null?void 0:u.textTokens),reasoningTokens:jo((c=t.outputTokenDetails)==null?void 0:c.reasoningTokens,(d=e.outputTokenDetails)==null?void 0:d.reasoningTokens)},totalTokens:jo(t.totalTokens,e.totalTokens),reasoningTokens:jo(t.reasoningTokens,e.reasoningTokens),cachedInputTokens:jo(t.cachedInputTokens,e.cachedInputTokens)}}function jo(t,e){return t==null&&e==null?void 0:(t??0)+(e??0)}function o3(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;const n={...t};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const i=e[r];if(i===void 0)continue;const a=r in t?t[r]:void 0,s=i!==null&&typeof i=="object"&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp),o=a!=null&&typeof a=="object"&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp);s&&o?n[r]=o3(a,i):n[r]=i}return n}function RCe({error:t,exponentialBackoffDelay:e}){const n=t.responseHeaders;if(!n)return e;let r;const i=n["retry-after-ms"];if(i){const s=parseFloat(i);Number.isNaN(s)||(r=s)}const a=n["retry-after"];if(a&&r===void 0){const s=parseFloat(a);Number.isNaN(s)?r=Date.parse(a)-Date.now():r=s*1e3}return r!=null&&!Number.isNaN(r)&&0<=r&&(r<60*1e3||r<e)?r:e}var PCe=({maxRetries:t=2,initialDelayInMs:e=2e3,backoffFactor:n=2,abortSignal:r}={})=>async i=>Yee(i,{maxRetries:t,delayInMs:e,backoffFactor:n,abortSignal:r});async function Yee(t,{maxRetries:e,delayInMs:n,backoffFactor:r,abortSignal:i},a=[]){try{return await t()}catch(s){if(nf(s)||e===0)throw s;const o=Y8(s),l=[...a,s],u=l.length;if(u>e)throw new _B({message:`Failed after ${u} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:l});if(s instanceof Error&&ji.isInstance(s)&&s.isRetryable===!0&&u<=e)return await fEe(RCe({error:s,exponentialBackoffDelay:n}),{abortSignal:i}),Yee(t,{maxRetries:e,delayInMs:r*n,backoffFactor:r,abortSignal:i},l);throw u===1?s:new _B({message:`Failed after ${u} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:l})}}function Xee({maxRetries:t,abortSignal:e}){if(t!=null){if(!Number.isInteger(t))throw new Sl({parameter:"maxRetries",value:t,message:"maxRetries must be an integer"});if(t<0)throw new Sl({parameter:"maxRetries",value:t,message:"maxRetries must be >= 0"})}const n=t??2;return{maxRetries:n,retry:PCe({maxRetries:n,abortSignal:e})}}function Kee({messages:t}){const e=t.at(-1);if(e?.role!="tool")return{approvedToolApprovals:[],deniedToolApprovals:[]};const n={};for(const l of t)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const c of u)c.type==="tool-call"&&(n[c.toolCallId]=c)}const r={};for(const l of t)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const c of u)c.type==="tool-approval-request"&&(r[c.approvalId]=c)}const i={};for(const l of e.content)l.type==="tool-result"&&(i[l.toolCallId]=l);const a=[],s=[],o=e.content.filter(l=>l.type==="tool-approval-response");for(const l of o){const u=r[l.approvalId];if(u==null)throw new j5e({approvalId:l.approvalId});if(i[u.toolCallId]!=null)continue;const c=n[u.toolCallId];if(c==null)throw new sR({toolCallId:u.toolCallId,approvalId:u.approvalId});const d={approvalRequest:u,approvalResponse:l,toolCall:c};l.approved?a.push(d):s.push(d)}return{approvedToolApprovals:a,deniedToolApprovals:s}}async function uR({toolCall:t,tools:e,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:s,onPreliminaryToolResult:o}){const{toolName:l,toolCallId:u,input:c}=t,d=e?.[l];if(d?.execute!=null)return L1({name:"ai.toolCall",attributes:Rl({telemetry:r,attributes:{...O1({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":l,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(c)}}}),tracer:n,fn:async h=>{let f;try{const m=yTe({execute:d.execute.bind(d),input:c,options:{toolCallId:u,messages:i,abortSignal:a,experimental_context:s}});for await(const x of m)x.type==="preliminary"?o?.({...t,type:"tool-result",output:x.output,preliminary:!0}):f=x.output}catch(m){return Vee(h,m),{type:"tool-error",toolCallId:u,toolName:l,input:c,error:m,dynamic:d.type==="dynamic",...t.providerMetadata!=null?{providerMetadata:t.providerMetadata}:{}}}try{h.setAttributes(await Rl({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(f)}}}))}catch{}return{type:"tool-result",toolCallId:u,toolName:l,input:c,output:f,dynamic:d.type==="dynamic",...t.providerMetadata!=null?{providerMetadata:t.providerMetadata}:{}}}})}function TB(t){const e=t.filter(n=>n.type==="text");if(e.length!==0)return e.map(n=>n.text).join("")}var Zee=class{constructor({data:t,mediaType:e}){const n=t instanceof Uint8Array;this.base64Data=n?void 0:t,this.uint8ArrayData=n?t:void 0,this.mediaType=e}get base64(){return this.base64Data==null&&(this.base64Data=b0(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Yu(this.base64Data)),this.uint8ArrayData}},DCe=class extends Zee{constructor(t){super(t),this.type="file"}};async function Jee({tool:t,toolCall:e,messages:n,experimental_context:r}){return t.needsApproval==null?!1:typeof t.needsApproval=="boolean"?t.needsApproval:await t.needsApproval(e.input,{toolCallId:e.toolCallId,messages:n,experimental_context:r})}var OCe={};B5e(OCe,{array:()=>BCe,choice:()=>UCe,json:()=>zCe,object:()=>FCe,text:()=>bw});function LCe(t){const e=["ROOT"];let n=-1,r=null;function i(l,u,c){switch(l){case'"':{n=u,e.pop(),e.push(c),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=u,r=u,e.pop(),e.push(c),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(c),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=u,e.pop(),e.push(c),e.push("INSIDE_NUMBER");break}case"{":{n=u,e.pop(),e.push(c),e.push("INSIDE_OBJECT_START");break}case"[":{n=u,e.pop(),e.push(c),e.push("INSIDE_ARRAY_START");break}}}function a(l,u){switch(l){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=u,e.pop();break}}}function s(l,u){switch(l){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=u,e.pop();break}}}for(let l=0;l<t.length;l++){const u=t[l];switch(e[e.length-1]){case"ROOT":i(u,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(u){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{n=l,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(u){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(u){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(u){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{i(u,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{a(u,l);break}case"INSIDE_STRING":{switch(u){case'"':{e.pop(),n=l;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:n=l}break}case"INSIDE_ARRAY_START":{switch(u){case"]":{n=l,e.pop();break}default:{n=l,i(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(u){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=l,e.pop();break}default:{n=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{i(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),n=l;break}case"INSIDE_NUMBER":{switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=l;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(u,l);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&a(u,l);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const d=t.substring(r,l+1);!"false".startsWith(d)&&!"true".startsWith(d)&&!"null".startsWith(d)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?a(u,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l)):n=l;break}}}let o=t.slice(0,n+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":{o+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{o+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{o+="]";break}case"INSIDE_LITERAL":{const c=t.substring(r,t.length);"true".startsWith(c)?o+="true".slice(c.length):"false".startsWith(c)?o+="false".slice(c.length):"null".startsWith(c)&&(o+="null".slice(c.length))}}return o}async function kv(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await bo({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await bo({text:LCe(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var bw=()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),async parseCompleteOutput({text:t}){return t},async parsePartialOutput({text:t}){return{partial:t}},createElementStreamTransform(){}}),FCe=({schema:t,name:e,description:n})=>{const r=xf(t);return{name:"object",responseFormat:Vr(r.jsonSchema).then(i=>({type:"json",schema:i,...e!=null&&{name:e},...n!=null&&{description:n}})),async parseCompleteOutput({text:i},a){const s=await bo({text:i});if(!s.success)throw new Zc({message:"No object generated: could not parse the response.",cause:s.error,text:i,response:a.response,usage:a.usage,finishReason:a.finishReason});const o=await xo({value:s.value,schema:r});if(!o.success)throw new Zc({message:"No object generated: response did not match schema.",cause:o.error,text:i,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value},async parsePartialOutput({text:i}){const a=await kv(i);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:a.value}}},createElementStreamTransform(){}}},BCe=({element:t,name:e,description:n})=>{const r=xf(t);return{name:"array",responseFormat:Vr(r.jsonSchema).then(i=>{const{$schema:a,...s}=i;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:s}},required:["elements"],additionalProperties:!1},...e!=null&&{name:e},...n!=null&&{description:n}}}),async parseCompleteOutput({text:i},a){const s=await bo({text:i});if(!s.success)throw new Zc({message:"No object generated: could not parse the response.",cause:s.error,text:i,response:a.response,usage:a.usage,finishReason:a.finishReason});const o=s.value;if(o==null||typeof o!="object"||!("elements"in o)||!Array.isArray(o.elements))throw new Zc({message:"No object generated: response did not match schema.",cause:new tf({value:o,cause:"response must be an object with an elements array"}),text:i,response:a.response,usage:a.usage,finishReason:a.finishReason});for(const l of o.elements){const u=await xo({value:l,schema:r});if(!u.success)throw new Zc({message:"No object generated: response did not match schema.",cause:u.error,text:i,response:a.response,usage:a.usage,finishReason:a.finishReason})}return o.elements},async parsePartialOutput({text:i}){const a=await kv(i);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const s=a.value;if(s==null||typeof s!="object"||!("elements"in s)||!Array.isArray(s.elements))return;const o=a.state==="repaired-parse"&&s.elements.length>0?s.elements.slice(0,-1):s.elements,l=[];for(const u of o){const c=await xo({value:u,schema:r});c.success&&l.push(c.value)}return{partial:l}}}},createElementStreamTransform(){let i=0;return new TransformStream({transform({partialOutput:a},s){if(a!=null)for(;i<a.length;i++)s.enqueue(a[i])}})}}},UCe=({options:t,name:e,description:n})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:t}},required:["result"],additionalProperties:!1},...e!=null&&{name:e},...n!=null&&{description:n}}),async parseCompleteOutput({text:r},i){const a=await bo({text:r});if(!a.success)throw new Zc({message:"No object generated: could not parse the response.",cause:a.error,text:r,response:i.response,usage:i.usage,finishReason:i.finishReason});const s=a.value;if(s==null||typeof s!="object"||!("result"in s)||typeof s.result!="string"||!t.includes(s.result))throw new Zc({message:"No object generated: response did not match schema.",cause:new tf({value:s,cause:"response must be an object that contains a choice value."}),text:r,response:i.response,usage:i.usage,finishReason:i.finishReason});return s.result},async parsePartialOutput({text:r}){const i=await kv(r);switch(i.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{const a=i.value;if(a==null||typeof a!="object"||!("result"in a)||typeof a.result!="string")return;const s=t.filter(o=>o.startsWith(a.result));return i.state==="successful-parse"?s.includes(a.result)?{partial:a.result}:void 0:s.length===1?{partial:s[0]}:void 0}}},createElementStreamTransform(){}}),zCe=({name:t,description:e}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...t!=null&&{name:t},...e!=null&&{description:e}}),async parseCompleteOutput({text:n},r){const i=await bo({text:n});if(!i.success)throw new Zc({message:"No object generated: could not parse the response.",cause:i.error,text:n,response:r.response,usage:r.usage,finishReason:r.finishReason});return i.value},async parsePartialOutput({text:n}){const r=await kv(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return r.value===void 0?void 0:{partial:r.value}}},createElementStreamTransform(){}});async function Qee({toolCall:t,tools:e,repairToolCall:n,system:r,messages:i}){var a;try{if(e==null){if(t.providerExecuted&&t.dynamic)return await ete(t);throw new vI({toolName:t.toolName})}try{return await CB({toolCall:t,tools:e})}catch(s){if(n==null||!(vI.isInstance(s)||aR.isInstance(s)))throw s;let o=null;try{o=await n({toolCall:t,tools:e,inputSchema:async({toolName:l})=>{const{inputSchema:u}=e[l];return await xf(u).jsonSchema},system:r,messages:i,error:s})}catch(l){throw new Y5e({cause:l,originalError:s})}if(o==null)throw s;return await CB({toolCall:o,tools:e})}}catch(s){const o=await bo({text:t.input}),l=o.success?o.value:t.input;return{type:"tool-call",toolCallId:t.toolCallId,toolName:t.toolName,input:l,dynamic:!0,invalid:!0,error:s,title:(a=e?.[t.toolName])==null?void 0:a.title,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata}}}async function ete(t){const e=t.input.trim()===""?{success:!0,value:{}}:await bo({text:t.input});if(e.success===!1)throw new aR({toolName:t.toolName,toolInput:t.input,cause:e.error});return{type:"tool-call",toolCallId:t.toolCallId,toolName:t.toolName,input:e.value,providerExecuted:!0,dynamic:!0,providerMetadata:t.providerMetadata}}async function CB({toolCall:t,tools:e}){const n=t.toolName,r=e[n];if(r==null){if(t.providerExecuted&&t.dynamic)return await ete(t);throw new vI({toolName:t.toolName,availableTools:Object.keys(e)})}const i=xf(r.inputSchema),a=t.input.trim()===""?await xo({value:{},schema:i}):await bo({text:t.input,schema:i});if(a.success===!1)throw new aR({toolName:n,toolInput:t.input,cause:a.error});return r.type==="dynamic"?{type:"tool-call",toolCallId:t.toolCallId,toolName:t.toolName,input:a.value,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata,dynamic:!0,title:r.title}:{type:"tool-call",toolCallId:t.toolCallId,toolName:n,input:a.value,providerExecuted:t.providerExecuted,providerMetadata:t.providerMetadata,title:r.title}}var tte=class{constructor({content:t,finishReason:e,rawFinishReason:n,usage:r,warnings:i,request:a,response:s,providerMetadata:o}){this.content=t,this.finishReason=e,this.rawFinishReason=n,this.usage=r,this.warnings=i,this.request=a,this.response=s,this.providerMetadata=o}get text(){return this.content.filter(t=>t.type==="text").map(t=>t.text).join("")}get reasoning(){return this.content.filter(t=>t.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(t=>t.text).join("")}get files(){return this.content.filter(t=>t.type==="file").map(t=>t.file)}get sources(){return this.content.filter(t=>t.type==="source")}get toolCalls(){return this.content.filter(t=>t.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(t=>t.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(t=>t.dynamic===!0)}get toolResults(){return this.content.filter(t=>t.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(t=>t.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(t=>t.dynamic===!0)}};function nte(t){return({steps:e})=>e.length===t}async function rte({stopConditions:t,steps:e}){return(await Promise.all(t.map(n=>n({steps:e})))).some(n=>n)}async function xI({content:t,tools:e}){const n=[],r=[];for(const a of t)if(a.type!=="source"&&!((a.type==="tool-result"||a.type==="tool-error")&&!a.providerExecuted)&&!(a.type==="text"&&a.text.length===0))switch(a.type){case"text":r.push({type:"text",text:a.text,providerOptions:a.providerMetadata});break;case"reasoning":r.push({type:"reasoning",text:a.text,providerOptions:a.providerMetadata});break;case"file":r.push({type:"file",data:a.file.base64,mediaType:a.file.mediaType,providerOptions:a.providerMetadata});break;case"tool-call":r.push({type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:a.providerMetadata});break;case"tool-result":{const s=await Vg({toolCallId:a.toolCallId,input:a.input,tool:e?.[a.toolName],output:a.output,errorMode:"none"});r.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:s,providerOptions:a.providerMetadata});break}case"tool-error":{const s=await Vg({toolCallId:a.toolCallId,input:a.input,tool:e?.[a.toolName],output:a.error,errorMode:"json"});r.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:s,providerOptions:a.providerMetadata});break}case"tool-approval-request":r.push({type:"tool-approval-request",approvalId:a.approvalId,toolCallId:a.toolCall.toolCallId});break}r.length>0&&n.push({role:"assistant",content:r});const i=[];for(const a of t){if(!(a.type==="tool-result"||a.type==="tool-error")||a.providerExecuted)continue;const s=await Vg({toolCallId:a.toolCallId,input:a.input,tool:e?.[a.toolName],output:a.type==="tool-result"?a.output:a.error,errorMode:a.type==="tool-error"?"text":"none"});i.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:s,...a.providerMetadata!=null?{providerOptions:a.providerMetadata}:{}})}return i.length>0&&n.push({role:"tool",content:i}),n}function ite(...t){const e=t.filter(r=>r!=null);if(e.length===0)return;if(e.length===1)return e[0];const n=new AbortController;for(const r of e){if(r.aborted)return n.abort(r.reason),n.signal;r.addEventListener("abort",()=>{n.abort(r.reason)},{once:!0})}return n.signal}var jCe=Mv({prefix:"aitxt",size:24});async function HCe({model:t,tools:e,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:s,abortSignal:o,timeout:l,headers:u,stopWhen:c=nte(1),experimental_output:d,output:h=d,experimental_telemetry:f,providerOptions:m,experimental_activeTools:x,activeTools:b=x,experimental_prepareStep:y,prepareStep:w=y,experimental_repairToolCall:_,experimental_download:S,experimental_context:M,_internal:{generateId:E=jCe}={},onStepFinish:C,onFinish:R,...k}){const I=xw(t),N=P1(c),D=lR(l),F=Nee(l),L=F!=null?new AbortController:void 0,U=ite(o,D!=null?AbortSignal.timeout(D):void 0,L?.signal),{maxRetries:j,retry:q}=Xee({maxRetries:s,abortSignal:U}),Z=yI(k),Q=To(u??{},`ai/${Ree}`),z=Hee({model:I,telemetry:f,headers:Q,settings:{...Z,maxRetries:j}}),W=await zee({system:r,prompt:i,messages:a}),X=$ee(f);try{return await L1({name:"ai.generateText",attributes:Rl({telemetry:f,attributes:{...O1({operationId:"ai.generateText",telemetry:f}),...z,"ai.model.provider":I.provider,"ai.model.id":I.modelId,"ai.prompt":{input:()=>JSON.stringify({system:r,prompt:i,messages:a})}}}),tracer:X,fn:async H=>{var J,te,ee,se,ue,oe,Te,Ne;const be=W.messages,De=[],{approvedToolApprovals:ke,deniedToolApprovals:Me}=Kee({messages:be}),Ie=ke.filter(ve=>!ve.toolCall.providerExecuted);if(Me.length>0||Ie.length>0){const ve=await MB({toolCalls:Ie.map(Be=>Be.toolCall),tools:e,tracer:X,telemetry:f,messages:be,abortSignal:U,experimental_context:M}),_e=[];for(const Be of ve){const He=await Vg({toolCallId:Be.toolCallId,input:Be.input,tool:e?.[Be.toolName],output:Be.type==="tool-result"?Be.output:Be.error,errorMode:Be.type==="tool-error"?"json":"none"});_e.push({type:"tool-result",toolCallId:Be.toolCallId,toolName:Be.toolName,output:He})}for(const Be of Me)_e.push({type:"tool-result",toolCallId:Be.toolCall.toolCallId,toolName:Be.toolCall.toolName,output:{type:"execution-denied",reason:Be.approvalResponse.reason,...Be.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:Be.approvalResponse.approvalId}}}}});De.push({role:"tool",content:_e})}const ce=[...ke,...Me].filter(ve=>ve.toolCall.providerExecuted);ce.length>0&&De.push({role:"tool",content:ce.map(ve=>({type:"tool-approval-response",approvalId:ve.approvalResponse.approvalId,approved:ve.approvalResponse.approved,reason:ve.approvalResponse.reason,providerExecuted:!0}))});const G=yI(k);let xe,Oe=[],Fe=[];const ze=[],le=new Map;do{const ve=F!=null?setTimeout(()=>L.abort(),F):void 0;try{const _e=[...be,...De],Be=await w?.({model:I,steps:ze,stepNumber:ze.length,messages:_e,experimental_context:M}),He=xw((J=Be?.model)!=null?J:I),pt=await Oee({prompt:{system:(te=Be?.system)!=null?te:W.system,messages:(ee=Be?.messages)!=null?ee:_e},supportedUrls:await He.supportedUrls,download:S});M=(se=Be?.experimental_context)!=null?se:M;const{toolChoice:gt,tools:We}=await Lee({tools:e,toolChoice:(ue=Be?.toolChoice)!=null?ue:n,activeTools:(oe=Be?.activeTools)!=null?oe:b});xe=await q(()=>{var fe;return L1({name:"ai.generateText.doGenerate",attributes:Rl({telemetry:f,attributes:{...O1({operationId:"ai.generateText.doGenerate",telemetry:f}),...z,"ai.model.provider":He.provider,"ai.model.id":He.modelId,"ai.prompt.messages":{input:()=>qee(pt)},"ai.prompt.tools":{input:()=>We?.map($e=>JSON.stringify($e))},"ai.prompt.toolChoice":{input:()=>gt!=null?JSON.stringify(gt):void 0},"gen_ai.system":He.provider,"gen_ai.request.model":He.modelId,"gen_ai.request.frequency_penalty":k.frequencyPenalty,"gen_ai.request.max_tokens":k.maxOutputTokens,"gen_ai.request.presence_penalty":k.presencePenalty,"gen_ai.request.stop_sequences":k.stopSequences,"gen_ai.request.temperature":(fe=k.temperature)!=null?fe:void 0,"gen_ai.request.top_k":k.topK,"gen_ai.request.top_p":k.topP}}),tracer:X,fn:async $e=>{var Ge,st,Qe,Ye,ft,Ct,At,Ht;const wn=o3(m,Be?.providerOptions),Vt=await He.doGenerate({...G,tools:We,toolChoice:gt,responseFormat:await h?.responseFormat,prompt:pt,providerOptions:wn,abortSignal:U,headers:Q}),En={id:(st=(Ge=Vt.response)==null?void 0:Ge.id)!=null?st:E(),timestamp:(Ye=(Qe=Vt.response)==null?void 0:Qe.timestamp)!=null?Ye:new Date,modelId:(Ct=(ft=Vt.response)==null?void 0:ft.modelId)!=null?Ct:He.modelId,headers:(At=Vt.response)==null?void 0:At.headers,body:(Ht=Vt.response)==null?void 0:Ht.body};return $e.setAttributes(await Rl({telemetry:f,attributes:{"ai.response.finishReason":Vt.finishReason.unified,"ai.response.text":{output:()=>TB(Vt.content)},"ai.response.toolCalls":{output:()=>{const kr=AB(Vt.content);return kr==null?void 0:JSON.stringify(kr)}},"ai.response.id":En.id,"ai.response.model":En.modelId,"ai.response.timestamp":En.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Vt.providerMetadata),"ai.usage.promptTokens":Vt.usage.inputTokens.total,"ai.usage.completionTokens":Vt.usage.outputTokens.total,"gen_ai.response.finish_reasons":[Vt.finishReason.unified],"gen_ai.response.id":En.id,"gen_ai.response.model":En.modelId,"gen_ai.usage.input_tokens":Vt.usage.inputTokens.total,"gen_ai.usage.output_tokens":Vt.usage.outputTokens.total}})),{...Vt,response:En}}})});const Je=await Promise.all(xe.content.filter(fe=>fe.type==="tool-call").map(fe=>Qee({toolCall:fe,tools:e,repairToolCall:_,system:r,messages:_e}))),ot={};for(const fe of Je){if(fe.invalid)continue;const $e=e?.[fe.toolName];$e!=null&&($e?.onInputAvailable!=null&&await $e.onInputAvailable({input:fe.input,toolCallId:fe.toolCallId,messages:_e,abortSignal:U,experimental_context:M}),await Jee({tool:$e,toolCall:fe,messages:_e,experimental_context:M})&&(ot[fe.toolCallId]={type:"tool-approval-request",approvalId:E(),toolCall:fe}))}const Ee=Je.filter(fe=>fe.invalid&&fe.dynamic);Fe=[];for(const fe of Ee)Fe.push({type:"tool-error",toolCallId:fe.toolCallId,toolName:fe.toolName,input:fe.input,error:Y8(fe.error),dynamic:!0});Oe=Je.filter(fe=>!fe.providerExecuted),e!=null&&Fe.push(...await MB({toolCalls:Oe.filter(fe=>!fe.invalid&&ot[fe.toolCallId]==null),tools:e,tracer:X,telemetry:f,messages:_e,abortSignal:U,experimental_context:M}));for(const fe of Je){if(!fe.providerExecuted)continue;const $e=e?.[fe.toolName];$e?.type==="provider"&&$e.supportsDeferredResults&&(xe.content.some(st=>st.type==="tool-result"&&st.toolCallId===fe.toolCallId)||le.set(fe.toolCallId,{toolName:fe.toolName}))}for(const fe of xe.content)fe.type==="tool-result"&&le.delete(fe.toolCallId);const je=VCe({content:xe.content,toolCalls:Je,toolOutputs:Fe,toolApprovalRequests:Object.values(ot),tools:e});De.push(...await xI({content:je,tools:e}));const mt=new tte({content:je,finishReason:xe.finishReason.unified,rawFinishReason:xe.finishReason.raw,usage:Gee(xe.usage),warnings:xe.warnings,providerMetadata:xe.providerMetadata,request:(Te=xe.request)!=null?Te:{},response:{...xe.response,messages:structuredClone(De)}});oR({warnings:(Ne=xe.warnings)!=null?Ne:[],provider:He.provider,model:He.modelId}),ze.push(mt),await C?.(mt)}finally{ve!=null&&clearTimeout(ve)}}while((Oe.length>0&&Fe.length===Oe.length||le.size>0)&&!await rte({stopConditions:N,steps:ze}));H.setAttributes(await Rl({telemetry:f,attributes:{"ai.response.finishReason":xe.finishReason.unified,"ai.response.text":{output:()=>TB(xe.content)},"ai.response.toolCalls":{output:()=>{const ve=AB(xe.content);return ve==null?void 0:JSON.stringify(ve)}},"ai.response.providerMetadata":JSON.stringify(xe.providerMetadata),"ai.usage.promptTokens":xe.usage.inputTokens.total,"ai.usage.completionTokens":xe.usage.outputTokens.total}}));const re=ze[ze.length-1],me=ze.reduce((ve,_e)=>Wee(ve,_e.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});await R?.({finishReason:re.finishReason,rawFinishReason:re.rawFinishReason,usage:re.usage,content:re.content,text:re.text,reasoningText:re.reasoningText,reasoning:re.reasoning,files:re.files,sources:re.sources,toolCalls:re.toolCalls,staticToolCalls:re.staticToolCalls,dynamicToolCalls:re.dynamicToolCalls,toolResults:re.toolResults,staticToolResults:re.staticToolResults,dynamicToolResults:re.dynamicToolResults,request:re.request,response:re.response,warnings:re.warnings,providerMetadata:re.providerMetadata,steps:ze,totalUsage:me,experimental_context:M});let de;return re.finishReason==="stop"&&(de=await(h??bw()).parseCompleteOutput({text:re.text},{response:re.response,usage:re.usage,finishReason:re.finishReason})),new $Ce({steps:ze,totalUsage:me,output:de})}})}catch(H){throw jee(H)}}async function MB({toolCalls:t,tools:e,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:s}){return(await Promise.all(t.map(async l=>uR({toolCall:l,tools:e,tracer:n,telemetry:r,messages:i,abortSignal:a,experimental_context:s})))).filter(l=>l!=null)}var $Ce=class{constructor(t){this.steps=t.steps,this._output=t.output,this.totalUsage=t.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(this._output==null)throw new fee;return this._output}};function AB(t){const e=t.filter(n=>n.type==="tool-call");if(e.length!==0)return e.map(n=>({toolCallId:n.toolCallId,toolName:n.toolName,input:n.input}))}function VCe({content:t,toolCalls:e,toolOutputs:n,toolApprovalRequests:r,tools:i}){const a=[];for(const s of t)switch(s.type){case"text":case"reasoning":case"source":a.push(s);break;case"file":{a.push({type:"file",file:new Zee(s),...s.providerMetadata!=null?{providerMetadata:s.providerMetadata}:{}});break}case"tool-call":{a.push(e.find(o=>o.toolCallId===s.toolCallId));break}case"tool-result":{const o=e.find(l=>l.toolCallId===s.toolCallId);if(o==null){const l=i?.[s.toolName];if(!(l?.type==="provider"&&l.supportsDeferredResults))throw new Error(`Tool call ${s.toolCallId} not found.`);s.isError?a.push({type:"tool-error",toolCallId:s.toolCallId,toolName:s.toolName,input:void 0,error:s.result,providerExecuted:!0,dynamic:s.dynamic}):a.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,input:void 0,output:s.result,providerExecuted:!0,dynamic:s.dynamic});break}s.isError?a.push({type:"tool-error",toolCallId:s.toolCallId,toolName:s.toolName,input:o.input,error:s.result,providerExecuted:!0,dynamic:o.dynamic}):a.push({type:"tool-result",toolCallId:s.toolCallId,toolName:s.toolName,input:o.input,output:s.result,providerExecuted:!0,dynamic:o.dynamic});break}case"tool-approval-request":{const o=e.find(l=>l.toolCallId===s.toolCallId);if(o==null)throw new sR({toolCallId:s.toolCallId,approvalId:s.approvalId});a.push({type:"tool-approval-request",approvalId:s.approvalId,toolCall:o});break}}return[...a,...n,...r]}function l3(t,e){const n=new Headers(t??{});for(const[r,i]of Object.entries(e))n.has(r)||n.set(r,i);return n}function qCe({status:t,statusText:e,headers:n,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:t??200,statusText:e,headers:l3(n,{"content-type":"text/plain; charset=utf-8"})})}function ate({response:t,status:e,statusText:n,headers:r,stream:i}){const a=e??200;n!==void 0?t.writeHead(a,n,r):t.writeHead(a,r);const s=i.getReader();(async()=>{try{for(;;){const{done:l,value:u}=await s.read();if(l)break;t.write(u)||await new Promise(d=>{t.once("drain",d)})}}catch(l){throw l}finally{t.end()}})()}function GCe({response:t,status:e,statusText:n,headers:r,textStream:i}){ate({response:t,status:e,statusText:n,headers:Object.fromEntries(l3(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:i.pipeThrough(new TextEncoderStream)})}var ste=class extends TransformStream{constructor(){super({transform(t,e){e.enqueue(`data: ${JSON.stringify(t)}

`)},flush(t){t.enqueue(`data: [DONE]

`)}})}},ote={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function WCe({status:t,statusText:e,headers:n,stream:r,consumeSseStream:i}){let a=r.pipeThrough(new ste);if(i){const[s,o]=a.tee();a=s,i({stream:o})}return new Response(a.pipeThrough(new TextEncoderStream),{status:t,statusText:e,headers:l3(n,ote)})}function YCe({originalMessages:t,responseMessageId:e}){if(t==null)return;const n=t[t.length-1];return n?.role==="assistant"?n.id:typeof e=="function"?e():e}function XCe(t){return t.type.startsWith("data-")}function bI(t){return t.type.startsWith("tool-")}function KCe(t){return t.type==="dynamic-tool"}function ZCe(t){return bI(t)||KCe(t)}function kB(t){return t.type.split("-").slice(1).join("-")}function JCe({lastMessage:t,messageId:e}){return{message:t?.role==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function QCe({stream:t,messageMetadataSchema:e,dataPartSchemas:n,runUpdateMessageJob:r,onError:i,onToolCall:a,onData:s}){return t.pipeThrough(new TransformStream({async transform(o,l){await r(async({state:u,write:c})=>{var d,h,f,m;function x(_){const M=u.message.parts.filter(ZCe).find(E=>E.toolCallId===_);if(M==null)throw new Dp({chunkType:"tool-invocation",chunkId:_,message:`No tool invocation found for tool call ID "${_}".`});return M}function b(_){var S;const M=u.message.parts.find(R=>bI(R)&&R.toolCallId===_.toolCallId),E=_,C=M;M!=null?(M.state=_.state,C.input=E.input,C.output=E.output,C.errorText=E.errorText,C.rawInput=E.rawInput,C.preliminary=E.preliminary,_.title!==void 0&&(C.title=_.title),C.providerExecuted=(S=E.providerExecuted)!=null?S:M.providerExecuted,E.providerMetadata!=null&&(M.callProviderMetadata=E.providerMetadata)):u.message.parts.push({type:`tool-${_.toolName}`,toolCallId:_.toolCallId,state:_.state,title:_.title,input:E.input,output:E.output,rawInput:E.rawInput,errorText:E.errorText,providerExecuted:E.providerExecuted,preliminary:E.preliminary,...E.providerMetadata!=null?{callProviderMetadata:E.providerMetadata}:{}})}function y(_){var S,M;const E=u.message.parts.find(k=>k.type==="dynamic-tool"&&k.toolCallId===_.toolCallId),C=_,R=E;E!=null?(E.state=_.state,R.toolName=_.toolName,R.input=C.input,R.output=C.output,R.errorText=C.errorText,R.rawInput=(S=C.rawInput)!=null?S:R.rawInput,R.preliminary=C.preliminary,_.title!==void 0&&(R.title=_.title),R.providerExecuted=(M=C.providerExecuted)!=null?M:E.providerExecuted,C.providerMetadata!=null&&(E.callProviderMetadata=C.providerMetadata)):u.message.parts.push({type:"dynamic-tool",toolName:_.toolName,toolCallId:_.toolCallId,state:_.state,input:C.input,output:C.output,errorText:C.errorText,preliminary:C.preliminary,providerExecuted:C.providerExecuted,title:_.title,...C.providerMetadata!=null?{callProviderMetadata:C.providerMetadata}:{}})}async function w(_){if(_!=null){const S=u.message.metadata!=null?o3(u.message.metadata,_):_;e!=null&&await Kn({value:S,schema:e}),u.message.metadata=S}}switch(o.type){case"text-start":{const _={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};u.activeTextParts[o.id]=_,u.message.parts.push(_),c();break}case"text-delta":{const _=u.activeTextParts[o.id];if(_==null)throw new Dp({chunkType:"text-delta",chunkId:o.id,message:`Received text-delta for missing text part with ID "${o.id}". Ensure a "text-start" chunk is sent before any "text-delta" chunks.`});_.text+=o.delta,_.providerMetadata=(d=o.providerMetadata)!=null?d:_.providerMetadata,c();break}case"text-end":{const _=u.activeTextParts[o.id];if(_==null)throw new Dp({chunkType:"text-end",chunkId:o.id,message:`Received text-end for missing text part with ID "${o.id}". Ensure a "text-start" chunk is sent before any "text-end" chunks.`});_.state="done",_.providerMetadata=(h=o.providerMetadata)!=null?h:_.providerMetadata,delete u.activeTextParts[o.id],c();break}case"reasoning-start":{const _={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};u.activeReasoningParts[o.id]=_,u.message.parts.push(_),c();break}case"reasoning-delta":{const _=u.activeReasoningParts[o.id];if(_==null)throw new Dp({chunkType:"reasoning-delta",chunkId:o.id,message:`Received reasoning-delta for missing reasoning part with ID "${o.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-delta" chunks.`});_.text+=o.delta,_.providerMetadata=(f=o.providerMetadata)!=null?f:_.providerMetadata,c();break}case"reasoning-end":{const _=u.activeReasoningParts[o.id];if(_==null)throw new Dp({chunkType:"reasoning-end",chunkId:o.id,message:`Received reasoning-end for missing reasoning part with ID "${o.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-end" chunks.`});_.providerMetadata=(m=o.providerMetadata)!=null?m:_.providerMetadata,_.state="done",delete u.activeReasoningParts[o.id],c();break}case"file":{u.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),c();break}case"source-url":{u.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),c();break}case"source-document":{u.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),c();break}case"tool-input-start":{const _=u.message.parts.filter(bI);u.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:_.length,dynamic:o.dynamic,title:o.title},o.dynamic?y({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted,title:o.title,providerMetadata:o.providerMetadata}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted,title:o.title,providerMetadata:o.providerMetadata}),c();break}case"tool-input-delta":{const _=u.partialToolCalls[o.toolCallId];if(_==null)throw new Dp({chunkType:"tool-input-delta",chunkId:o.toolCallId,message:`Received tool-input-delta for missing tool call with ID "${o.toolCallId}". Ensure a "tool-input-start" chunk is sent before any "tool-input-delta" chunks.`});_.text+=o.inputTextDelta;const{value:S}=await kv(_.text);_.dynamic?y({toolCallId:o.toolCallId,toolName:_.toolName,state:"input-streaming",input:S,title:_.title}):b({toolCallId:o.toolCallId,toolName:_.toolName,state:"input-streaming",input:S,title:_.title}),c();break}case"tool-input-available":{o.dynamic?y({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata,title:o.title}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata,title:o.title}),c(),a&&!o.providerExecuted&&await a({toolCall:o});break}case"tool-input-error":{o.dynamic?y({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}):b({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),c();break}case"tool-approval-request":{const _=x(o.toolCallId);_.state="approval-requested",_.approval={id:o.approvalId},c();break}case"tool-output-denied":{const _=x(o.toolCallId);_.state="output-denied",c();break}case"tool-output-available":{const _=x(o.toolCallId);_.type==="dynamic-tool"?y({toolCallId:o.toolCallId,toolName:_.toolName,state:"output-available",input:_.input,output:o.output,preliminary:o.preliminary,providerExecuted:o.providerExecuted,title:_.title}):b({toolCallId:o.toolCallId,toolName:kB(_),state:"output-available",input:_.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary,title:_.title}),c();break}case"tool-output-error":{const _=x(o.toolCallId);_.type==="dynamic-tool"?y({toolCallId:o.toolCallId,toolName:_.toolName,state:"output-error",input:_.input,errorText:o.errorText,providerExecuted:o.providerExecuted,title:_.title}):b({toolCallId:o.toolCallId,toolName:kB(_),state:"output-error",input:_.input,rawInput:_.rawInput,errorText:o.errorText,providerExecuted:o.providerExecuted,title:_.title}),c();break}case"start-step":{u.message.parts.push({type:"step-start"});break}case"finish-step":{u.activeTextParts={},u.activeReasoningParts={};break}case"start":{o.messageId!=null&&(u.message.id=o.messageId),await w(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&c();break}case"finish":{o.finishReason!=null&&(u.finishReason=o.finishReason),await w(o.messageMetadata),o.messageMetadata!=null&&c();break}case"message-metadata":{await w(o.messageMetadata),o.messageMetadata!=null&&c();break}case"error":{i?.(new Error(o.errorText));break}default:if(XCe(o)){n?.[o.type]!=null&&await Kn({value:o.data,schema:n[o.type]});const _=o;if(_.transient){s?.(_);break}const S=_.id!=null?u.message.parts.find(M=>_.type===M.type&&_.id===M.id):void 0;S!=null?S.data=_.data:u.message.parts.push(_),s?.(_),c()}}l.enqueue(o)})}}))}function eMe({messageId:t,originalMessages:e=[],onFinish:n,onError:r,stream:i}){let a=e?.[e.length-1];a?.role!=="assistant"?a=void 0:t=a.id;let s=!1;const o=i.pipeThrough(new TransformStream({transform(h,f){if(h.type==="start"){const m=h;m.messageId==null&&t!=null&&(m.messageId=t)}h.type==="abort"&&(s=!0),f.enqueue(h)}}));if(n==null)return o;const l=JCe({lastMessage:a?structuredClone(a):void 0,messageId:t??""}),u=async h=>{await h({state:l,write:()=>{}})};let c=!1;const d=async()=>{if(c||!n)return;c=!0;const h=l.message.id===a?.id;await n({isAborted:s,isContinuation:h,responseMessage:l.message,messages:[...h?e.slice(0,-1):e,l.message],finishReason:l.finishReason})};return QCe({stream:o,runUpdateMessageJob:u,onError:r}).pipeThrough(new TransformStream({transform(h,f){f.enqueue(h)},async cancel(){await d()},async flush(){await d()}}))}function tMe({response:t,status:e,statusText:n,headers:r,stream:i,consumeSseStream:a}){let s=i.pipeThrough(new ste);if(a){const[o,l]=s.tee();s=o,a({stream:l})}ate({response:t,status:e,statusText:n,headers:Object.fromEntries(l3(r,ote).entries()),stream:s.pipeThrough(new TextEncoderStream)})}function Jm(t){const e=t.pipeThrough(new TransformStream);return e[Symbol.asyncIterator]=function(){const n=this.getReader();let r=!1;async function i(a){var s;if(!r){r=!0;try{a&&await((s=n.cancel)==null?void 0:s.call(n))}finally{try{n.releaseLock()}catch{}}}}return{async next(){if(r)return{done:!0,value:void 0};const{done:a,value:s}=await n.read();return a?(await i(!0),{done:!0,value:void 0}):{done:!1,value:s}},async return(){return await i(!0),{done:!0,value:void 0}},async throw(a){throw await i(!0),a}}},e}async function nMe({stream:t,onError:e}){const n=t.getReader();try{for(;;){const{done:r}=await n.read();if(r)break}}catch(r){e?.(r)}finally{n.releaseLock()}}function IB(){let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}}function rMe(){let t=[],e=null,n=!1,r=IB();const i=()=>{n=!0,r.resolve(),t.forEach(s=>s.cancel()),t=[],e?.close()},a=async()=>{if(n&&t.length===0){e?.close();return}if(t.length===0)return r=IB(),await r.promise,a();try{const{value:s,done:o}=await t[0].read();o?(t.shift(),t.length===0&&n?e?.close():await a()):e?.enqueue(s)}catch(s){e?.error(s),t.shift(),i()}};return{stream:new ReadableStream({start(s){e=s},pull:a,async cancel(){for(const s of t)await s.cancel();t=[],n=!0}}),addStream:s=>{if(n)throw new Error("Cannot add inner stream: outer stream is closed");t.push(s.getReader()),r.resolve()},close:()=>{n=!0,r.resolve(),t.length===0&&e?.close()},terminate:i}}function iMe(){var t,e;return(e=(t=globalThis?.performance)==null?void 0:t.now())!=null?e:Date.now()}function aMe({tools:t,generatorStream:e,tracer:n,telemetry:r,system:i,messages:a,abortSignal:s,repairToolCall:o,experimental_context:l,generateId:u}){let c=null;const d=new ReadableStream({start(_){c=_}}),h=new Set,f=new Map,m=new Map;let x=!1,b;function y(){x&&h.size===0&&(b!=null&&c.enqueue(b),c.close())}const w=new TransformStream({async transform(_,S){const M=_.type;switch(M){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{S.enqueue(_);break}case"file":{S.enqueue({type:"file",file:new DCe({data:_.data,mediaType:_.mediaType})});break}case"finish":{b={type:"finish",finishReason:_.finishReason.unified,rawFinishReason:_.finishReason.raw,usage:Gee(_.usage),providerMetadata:_.providerMetadata};break}case"tool-approval-request":{const E=m.get(_.toolCallId);if(E==null){c.enqueue({type:"error",error:new sR({toolCallId:_.toolCallId,approvalId:_.approvalId})});break}S.enqueue({type:"tool-approval-request",approvalId:_.approvalId,toolCall:E});break}case"tool-call":{try{const E=await Qee({toolCall:_,tools:t,repairToolCall:o,system:i,messages:a});if(m.set(E.toolCallId,E),S.enqueue(E),E.invalid){c.enqueue({type:"tool-error",toolCallId:E.toolCallId,toolName:E.toolName,input:E.input,error:Y8(E.error),dynamic:!0,title:E.title});break}const C=t?.[E.toolName];if(C==null)break;if(C.onInputAvailable!=null&&await C.onInputAvailable({input:E.input,toolCallId:E.toolCallId,messages:a,abortSignal:s,experimental_context:l}),await Jee({tool:C,toolCall:E,messages:a,experimental_context:l})){c.enqueue({type:"tool-approval-request",approvalId:u(),toolCall:E});break}if(f.set(E.toolCallId,E.input),C.execute!=null&&E.providerExecuted!==!0){const R=u();h.add(R),uR({toolCall:E,tools:t,tracer:n,telemetry:r,messages:a,abortSignal:s,experimental_context:l,onPreliminaryToolResult:k=>{c.enqueue(k)}}).then(k=>{c.enqueue(k)}).catch(k=>{c.enqueue({type:"error",error:k})}).finally(()=>{h.delete(R),y()})}}catch(E){c.enqueue({type:"error",error:E})}break}case"tool-result":{const E=_.toolName;_.isError?c.enqueue({type:"tool-error",toolCallId:_.toolCallId,toolName:E,input:f.get(_.toolCallId),providerExecuted:!0,error:_.result,dynamic:_.dynamic}):S.enqueue({type:"tool-result",toolCallId:_.toolCallId,toolName:E,input:f.get(_.toolCallId),output:_.result,providerExecuted:!0,dynamic:_.dynamic});break}default:{const E=M;throw new Error(`Unhandled chunk type: ${E}`)}}},flush(){x=!0,y()}});return new ReadableStream({async start(_){return Promise.all([e.pipeThrough(w).pipeTo(new WritableStream({write(S){_.enqueue(S)},close(){}})),d.pipeTo(new WritableStream({write(S){_.enqueue(S)},close(){_.close()}}))])}})}var sMe=Mv({prefix:"aitxt",size:24});function oMe({model:t,tools:e,toolChoice:n,system:r,prompt:i,messages:a,maxRetries:s,abortSignal:o,timeout:l,headers:u,stopWhen:c=nte(1),experimental_output:d,output:h=d,experimental_telemetry:f,prepareStep:m,providerOptions:x,experimental_activeTools:b,activeTools:y=b,experimental_repairToolCall:w,experimental_transform:_,experimental_download:S,includeRawChunks:M=!1,onChunk:E,onError:C=({error:U})=>{console.error(U)},onFinish:R,onAbort:k,onStepFinish:I,experimental_context:N,_internal:{now:D=iMe,generateId:F=sMe}={},...L}){const U=lR(l),j=Nee(l),q=sCe(l),Z=j!=null?new AbortController:void 0,Q=q!=null?new AbortController:void 0;return new uMe({model:xw(t),telemetry:f,headers:u,settings:L,maxRetries:s,abortSignal:ite(o,U!=null?AbortSignal.timeout(U):void 0,Z?.signal,Q?.signal),stepTimeoutMs:j,stepAbortController:Z,chunkTimeoutMs:q,chunkAbortController:Q,system:r,prompt:i,messages:a,tools:e,toolChoice:n,transforms:P1(_),activeTools:y,repairToolCall:w,stopConditions:P1(c),output:h,providerOptions:x,prepareStep:m,includeRawChunks:M,onChunk:E,onError:C,onFinish:R,onAbort:k,onStepFinish:I,now:D,generateId:F,experimental_context:N,download:S})}function lMe(t){let e,n="",r="",i,a="";function s({controller:o,partialOutput:l=void 0}){o.enqueue({part:{type:"text-delta",id:e,text:r,providerMetadata:i},partialOutput:l}),r=""}return new TransformStream({async transform(o,l){var u;if(o.type==="finish-step"&&r.length>0&&s({controller:l}),o.type!=="text-delta"&&o.type!=="text-start"&&o.type!=="text-end"){l.enqueue({part:o,partialOutput:void 0});return}if(e==null)e=o.id;else if(o.id!==e){l.enqueue({part:o,partialOutput:void 0});return}if(o.type==="text-start"){l.enqueue({part:o,partialOutput:void 0});return}if(o.type==="text-end"){r.length>0&&s({controller:l}),l.enqueue({part:o,partialOutput:void 0});return}n+=o.text,r+=o.text,i=(u=o.providerMetadata)!=null?u:i;const c=await t.parsePartialOutput({text:n});if(c!==void 0){const d=JSON.stringify(c.partial);d!==a&&(s({controller:l,partialOutput:c.partial}),a=d)}}})}var uMe=class{constructor({model:t,telemetry:e,headers:n,settings:r,maxRetries:i,abortSignal:a,stepTimeoutMs:s,stepAbortController:o,chunkTimeoutMs:l,chunkAbortController:u,system:c,prompt:d,messages:h,tools:f,toolChoice:m,transforms:x,activeTools:b,repairToolCall:y,stopConditions:w,output:_,providerOptions:S,prepareStep:M,includeRawChunks:E,now:C,generateId:R,onChunk:k,onError:I,onFinish:N,onAbort:D,onStepFinish:F,experimental_context:L,download:U}){this._totalUsage=new Km,this._finishReason=new Km,this._rawFinishReason=new Km,this._steps=new Km,this.outputSpecification=_,this.includeRawChunks=E,this.tools=f;let j,q=[];const Z=[];let Q,z,W,X={},H=[];const J=[],te=new Map;let ee,se={},ue={};const oe=new TransformStream({async transform(xe,Oe){var Fe,ze,le,re;Oe.enqueue(xe);const{part:me}=xe;if((me.type==="text-delta"||me.type==="reasoning-delta"||me.type==="source"||me.type==="tool-call"||me.type==="tool-result"||me.type==="tool-input-start"||me.type==="tool-input-delta"||me.type==="raw")&&await k?.({chunk:me}),me.type==="error"&&await I({error:jee(me.error)}),me.type==="text-start"&&(se[me.id]={type:"text",text:"",providerMetadata:me.providerMetadata},q.push(se[me.id])),me.type==="text-delta"){const de=se[me.id];if(de==null){Oe.enqueue({part:{type:"error",error:`text part ${me.id} not found`},partialOutput:void 0});return}de.text+=me.text,de.providerMetadata=(Fe=me.providerMetadata)!=null?Fe:de.providerMetadata}if(me.type==="text-end"){const de=se[me.id];if(de==null){Oe.enqueue({part:{type:"error",error:`text part ${me.id} not found`},partialOutput:void 0});return}de.providerMetadata=(ze=me.providerMetadata)!=null?ze:de.providerMetadata,delete se[me.id]}if(me.type==="reasoning-start"&&(ue[me.id]={type:"reasoning",text:"",providerMetadata:me.providerMetadata},q.push(ue[me.id])),me.type==="reasoning-delta"){const de=ue[me.id];if(de==null){Oe.enqueue({part:{type:"error",error:`reasoning part ${me.id} not found`},partialOutput:void 0});return}de.text+=me.text,de.providerMetadata=(le=me.providerMetadata)!=null?le:de.providerMetadata}if(me.type==="reasoning-end"){const de=ue[me.id];if(de==null){Oe.enqueue({part:{type:"error",error:`reasoning part ${me.id} not found`},partialOutput:void 0});return}de.providerMetadata=(re=me.providerMetadata)!=null?re:de.providerMetadata,delete ue[me.id]}if(me.type==="file"&&q.push({type:"file",file:me.file}),me.type==="source"&&q.push(me),me.type==="tool-call"&&q.push(me),me.type==="tool-result"&&!me.preliminary&&q.push(me),me.type==="tool-approval-request"&&q.push(me),me.type==="tool-error"&&q.push(me),me.type==="start-step"&&(q=[],ue={},se={},X=me.request,H=me.warnings),me.type==="finish-step"){const de=await xI({content:q,tools:f}),ve=new tte({content:q,finishReason:me.finishReason,rawFinishReason:me.rawFinishReason,usage:me.usage,warnings:H,request:X,response:{...me.response,messages:[...Z,...de]},providerMetadata:me.providerMetadata});await F?.(ve),oR({warnings:H,provider:t.provider,model:t.modelId}),J.push(ve),Z.push(...de),j.resolve()}me.type==="finish"&&(W=me.totalUsage,Q=me.finishReason,z=me.rawFinishReason)},async flush(xe){try{if(J.length===0){const le=a?.aborted?a.reason:new fee({message:"No output generated. Check the stream for errors."});G._finishReason.reject(le),G._rawFinishReason.reject(le),G._totalUsage.reject(le),G._steps.reject(le);return}const Oe=Q??"other",Fe=W??KE();G._finishReason.resolve(Oe),G._rawFinishReason.resolve(z),G._totalUsage.resolve(Fe),G._steps.resolve(J);const ze=J[J.length-1];await N?.({finishReason:ze.finishReason,rawFinishReason:ze.rawFinishReason,totalUsage:Fe,usage:ze.usage,content:ze.content,text:ze.text,reasoningText:ze.reasoningText,reasoning:ze.reasoning,files:ze.files,sources:ze.sources,toolCalls:ze.toolCalls,staticToolCalls:ze.staticToolCalls,dynamicToolCalls:ze.dynamicToolCalls,toolResults:ze.toolResults,staticToolResults:ze.staticToolResults,dynamicToolResults:ze.dynamicToolResults,request:ze.request,response:ze.response,warnings:ze.warnings,providerMetadata:ze.providerMetadata,steps:J,experimental_context:L}),ee.setAttributes(await Rl({telemetry:e,attributes:{"ai.response.finishReason":Oe,"ai.response.text":{output:()=>ze.text},"ai.response.toolCalls":{output:()=>{var le;return(le=ze.toolCalls)!=null&&le.length?JSON.stringify(ze.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(ze.providerMetadata),"ai.usage.inputTokens":Fe.inputTokens,"ai.usage.outputTokens":Fe.outputTokens,"ai.usage.totalTokens":Fe.totalTokens,"ai.usage.reasoningTokens":Fe.reasoningTokens,"ai.usage.cachedInputTokens":Fe.cachedInputTokens}}))}catch(Oe){xe.error(Oe)}finally{ee.end()}}}),Te=rMe();this.addStream=Te.addStream,this.closeStream=Te.close;const Ne=Te.stream.getReader();let be=new ReadableStream({async start(xe){xe.enqueue({type:"start"})},async pull(xe){function Oe(){D?.({steps:J}),xe.enqueue({type:"abort",...a?.reason!==void 0?{reason:ef(a.reason)}:{}}),xe.close()}try{const{done:Fe,value:ze}=await Ne.read();if(Fe){xe.close();return}if(a?.aborted){Oe();return}xe.enqueue(ze)}catch(Fe){nf(Fe)&&a?.aborted?Oe():xe.error(Fe)}},cancel(xe){return Te.stream.cancel(xe)}});for(const xe of x)be=be.pipeThrough(xe({tools:f,stopStream(){Te.terminate()}}));this.baseStream=be.pipeThrough(lMe(_??bw())).pipeThrough(oe);const{maxRetries:De,retry:ke}=Xee({maxRetries:i,abortSignal:a}),Me=$ee(e),Ie=yI(r),ce=Hee({model:t,telemetry:e,headers:n,settings:{...Ie,maxRetries:De}}),G=this;L1({name:"ai.streamText",attributes:Rl({telemetry:e,attributes:{...O1({operationId:"ai.streamText",telemetry:e}),...ce,"ai.prompt":{input:()=>JSON.stringify({system:c,prompt:d,messages:h})}}}),tracer:Me,endWhenDone:!1,fn:async xe=>{ee=xe;const Oe=await zee({system:c,prompt:d,messages:h}),Fe=Oe.messages,ze=[],{approvedToolApprovals:le,deniedToolApprovals:re}=Kee({messages:Fe});if(re.length>0||le.length>0){const de=[...le,...re].filter(gt=>gt.toolCall.providerExecuted),ve=le.filter(gt=>!gt.toolCall.providerExecuted),_e=re.filter(gt=>!gt.toolCall.providerExecuted),Be=re.filter(gt=>gt.toolCall.providerExecuted);let He;const pt=new ReadableStream({start(gt){He=gt}});G.addStream(pt);try{for(const We of[..._e,...Be])He?.enqueue({type:"tool-output-denied",toolCallId:We.toolCall.toolCallId,toolName:We.toolCall.toolName});const gt=[];if(await Promise.all(ve.map(async We=>{const Je=await uR({toolCall:We.toolCall,tools:f,tracer:Me,telemetry:e,messages:Fe,abortSignal:a,experimental_context:L,onPreliminaryToolResult:ot=>{He?.enqueue(ot)}});Je!=null&&(He?.enqueue(Je),gt.push(Je))})),de.length>0&&ze.push({role:"tool",content:de.map(We=>({type:"tool-approval-response",approvalId:We.approvalResponse.approvalId,approved:We.approvalResponse.approved,reason:We.approvalResponse.reason,providerExecuted:!0}))}),gt.length>0||_e.length>0){const We=[];for(const Je of gt)We.push({type:"tool-result",toolCallId:Je.toolCallId,toolName:Je.toolName,output:await Vg({toolCallId:Je.toolCallId,input:Je.input,tool:f?.[Je.toolName],output:Je.type==="tool-result"?Je.output:Je.error,errorMode:Je.type==="tool-error"?"json":"none"})});for(const Je of _e)We.push({type:"tool-result",toolCallId:Je.toolCall.toolCallId,toolName:Je.toolCall.toolName,output:{type:"execution-denied",reason:Je.approvalResponse.reason}});ze.push({role:"tool",content:We})}}finally{He?.close()}}Z.push(...ze);async function me({currentStep:de,responseMessages:ve,usage:_e}){var Be,He,pt,gt,We,Je;const ot=G.includeRawChunks,Ee=s!=null?setTimeout(()=>o.abort(),s):void 0;let je;function mt(){l!=null&&(je!=null&&clearTimeout(je),je=setTimeout(()=>u.abort(),l))}function fe(){je!=null&&(clearTimeout(je),je=void 0)}function $e(){Ee!=null&&clearTimeout(Ee)}j=new Km;const Ge=[...Fe,...ve],st=await M?.({model:t,steps:J,stepNumber:J.length,messages:Ge,experimental_context:L}),Qe=xw((Be=st?.model)!=null?Be:t),Ye=await Oee({prompt:{system:(He=st?.system)!=null?He:Oe.system,messages:(pt=st?.messages)!=null?pt:Ge},supportedUrls:await Qe.supportedUrls,download:U}),{toolChoice:ft,tools:Ct}=await Lee({tools:f,toolChoice:(gt=st?.toolChoice)!=null?gt:m,activeTools:(We=st?.activeTools)!=null?We:b});L=(Je=st?.experimental_context)!=null?Je:L;const At=o3(S,st?.providerOptions),{result:{stream:Ht,response:wn,request:Vt},doStreamSpan:En,startTimestampMs:kr}=await ke(()=>L1({name:"ai.streamText.doStream",attributes:Rl({telemetry:e,attributes:{...O1({operationId:"ai.streamText.doStream",telemetry:e}),...ce,"ai.model.provider":Qe.provider,"ai.model.id":Qe.modelId,"ai.prompt.messages":{input:()=>qee(Ye)},"ai.prompt.tools":{input:()=>Ct?.map(Kt=>JSON.stringify(Kt))},"ai.prompt.toolChoice":{input:()=>ft!=null?JSON.stringify(ft):void 0},"gen_ai.system":Qe.provider,"gen_ai.request.model":Qe.modelId,"gen_ai.request.frequency_penalty":Ie.frequencyPenalty,"gen_ai.request.max_tokens":Ie.maxOutputTokens,"gen_ai.request.presence_penalty":Ie.presencePenalty,"gen_ai.request.stop_sequences":Ie.stopSequences,"gen_ai.request.temperature":Ie.temperature,"gen_ai.request.top_k":Ie.topK,"gen_ai.request.top_p":Ie.topP}}),tracer:Me,endWhenDone:!1,fn:async Kt=>({startTimestampMs:C(),doStreamSpan:Kt,result:await Qe.doStream({...Ie,tools:Ct,toolChoice:ft,responseFormat:await _?.responseFormat,prompt:Ye,providerOptions:At,abortSignal:a,headers:n,includeRawChunks:ot})})})),Yi=aMe({tools:f,generatorStream:Ht,tracer:Me,telemetry:e,system:c,messages:Ge,repairToolCall:y,abortSignal:a,experimental_context:L,generateId:R}),ki=Vt??{},Gr=[],pi=[];let fr;const Tr={};let Wr="other",Ha,Ir=KE(),Ii,mi=!0,Ur={id:R(),timestamp:new Date,modelId:t.modelId},$a="";G.addStream(Yi.pipeThrough(new TransformStream({async transform(Kt,yr){var la,ba,_a,Pt,ge;if(mt(),Kt.type==="stream-start"){fr=Kt.warnings;return}if(mi){const Xe=C()-kr;mi=!1,En.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Xe}),En.setAttributes({"ai.response.msToFirstChunk":Xe}),yr.enqueue({type:"start-step",request:ki,warnings:fr??[]})}const qe=Kt.type;switch(qe){case"tool-approval-request":case"text-start":case"text-end":{yr.enqueue(Kt);break}case"text-delta":{Kt.delta.length>0&&(yr.enqueue({type:"text-delta",id:Kt.id,text:Kt.delta,providerMetadata:Kt.providerMetadata}),$a+=Kt.delta);break}case"reasoning-start":case"reasoning-end":{yr.enqueue(Kt);break}case"reasoning-delta":{yr.enqueue({type:"reasoning-delta",id:Kt.id,text:Kt.delta,providerMetadata:Kt.providerMetadata});break}case"tool-call":{yr.enqueue(Kt),Gr.push(Kt);break}case"tool-result":{yr.enqueue(Kt),Kt.preliminary||pi.push(Kt);break}case"tool-error":{yr.enqueue(Kt),pi.push(Kt);break}case"response-metadata":{Ur={id:(la=Kt.id)!=null?la:Ur.id,timestamp:(ba=Kt.timestamp)!=null?ba:Ur.timestamp,modelId:(_a=Kt.modelId)!=null?_a:Ur.modelId};break}case"finish":{Ir=Kt.usage,Wr=Kt.finishReason,Ha=Kt.rawFinishReason,Ii=Kt.providerMetadata;const Xe=C()-kr;En.addEvent("ai.stream.finish"),En.setAttributes({"ai.response.msToFinish":Xe,"ai.response.avgOutputTokensPerSecond":1e3*((Pt=Ir.outputTokens)!=null?Pt:0)/Xe});break}case"file":{yr.enqueue(Kt);break}case"source":{yr.enqueue(Kt);break}case"tool-input-start":{Tr[Kt.id]=Kt.toolName;const Xe=f?.[Kt.toolName];Xe?.onInputStart!=null&&await Xe.onInputStart({toolCallId:Kt.id,messages:Ge,abortSignal:a,experimental_context:L}),yr.enqueue({...Kt,dynamic:(ge=Kt.dynamic)!=null?ge:Xe?.type==="dynamic",title:Xe?.title});break}case"tool-input-end":{delete Tr[Kt.id],yr.enqueue(Kt);break}case"tool-input-delta":{const Xe=Tr[Kt.id],nt=f?.[Xe];nt?.onInputDelta!=null&&await nt.onInputDelta({inputTextDelta:Kt.delta,toolCallId:Kt.id,messages:Ge,abortSignal:a,experimental_context:L}),yr.enqueue(Kt);break}case"error":{yr.enqueue(Kt),Wr="error";break}case"raw":{ot&&yr.enqueue(Kt);break}default:{const Xe=qe;throw new Error(`Unknown chunk type: ${Xe}`)}}},async flush(Kt){const yr=Gr.length>0?JSON.stringify(Gr):void 0;try{En.setAttributes(await Rl({telemetry:e,attributes:{"ai.response.finishReason":Wr,"ai.response.text":{output:()=>$a},"ai.response.toolCalls":{output:()=>yr},"ai.response.id":Ur.id,"ai.response.model":Ur.modelId,"ai.response.timestamp":Ur.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Ii),"ai.usage.inputTokens":Ir.inputTokens,"ai.usage.outputTokens":Ir.outputTokens,"ai.usage.totalTokens":Ir.totalTokens,"ai.usage.reasoningTokens":Ir.reasoningTokens,"ai.usage.cachedInputTokens":Ir.cachedInputTokens,"gen_ai.response.finish_reasons":[Wr],"gen_ai.response.id":Ur.id,"gen_ai.response.model":Ur.modelId,"gen_ai.usage.input_tokens":Ir.inputTokens,"gen_ai.usage.output_tokens":Ir.outputTokens}}))}catch{}finally{En.end()}Kt.enqueue({type:"finish-step",finishReason:Wr,rawFinishReason:Ha,usage:Ir,providerMetadata:Ii,response:{...Ur,headers:wn?.headers}});const la=Wee(_e,Ir);await j.promise;const ba=Gr.filter(Pt=>Pt.providerExecuted!==!0),_a=pi.filter(Pt=>Pt.providerExecuted!==!0);for(const Pt of Gr){if(Pt.providerExecuted!==!0)continue;const ge=f?.[Pt.toolName];ge?.type==="provider"&&ge.supportsDeferredResults&&(pi.some(Xe=>Xe.type==="tool-result"&&Xe.toolCallId===Pt.toolCallId)||te.set(Pt.toolCallId,{toolName:Pt.toolName}))}for(const Pt of pi)Pt.type==="tool-result"&&te.delete(Pt.toolCallId);if($e(),fe(),(ba.length>0&&_a.length===ba.length||te.size>0)&&!await rte({stopConditions:w,steps:J})){ve.push(...await xI({content:J[J.length-1].content,tools:f}));try{await me({currentStep:de+1,responseMessages:ve,usage:la})}catch(Pt){Kt.enqueue({type:"error",error:Pt}),G.closeStream()}}else Kt.enqueue({type:"finish",finishReason:Wr,rawFinishReason:Ha,totalUsage:la}),G.closeStream()}})))}await me({currentStep:0,responseMessages:ze,usage:KE()})}}).catch(xe=>{G.addStream(new ReadableStream({start(Oe){Oe.enqueue({type:"error",error:xe}),Oe.close()}})),G.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(t=>t[t.length-1])}get content(){return this.finalStep.then(t=>t.content)}get warnings(){return this.finalStep.then(t=>t.warnings)}get providerMetadata(){return this.finalStep.then(t=>t.providerMetadata)}get text(){return this.finalStep.then(t=>t.text)}get reasoningText(){return this.finalStep.then(t=>t.reasoningText)}get reasoning(){return this.finalStep.then(t=>t.reasoning)}get sources(){return this.finalStep.then(t=>t.sources)}get files(){return this.finalStep.then(t=>t.files)}get toolCalls(){return this.finalStep.then(t=>t.toolCalls)}get staticToolCalls(){return this.finalStep.then(t=>t.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(t=>t.dynamicToolCalls)}get toolResults(){return this.finalStep.then(t=>t.toolResults)}get staticToolResults(){return this.finalStep.then(t=>t.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(t=>t.dynamicToolResults)}get usage(){return this.finalStep.then(t=>t.usage)}get request(){return this.finalStep.then(t=>t.request)}get response(){return this.finalStep.then(t=>t.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}get rawFinishReason(){return this.consumeStream(),this._rawFinishReason.promise}teeStream(){const[t,e]=this.baseStream.tee();return this.baseStream=e,t}get textStream(){return Jm(this.teeStream().pipeThrough(new TransformStream({transform({part:t},e){t.type==="text-delta"&&e.enqueue(t.text)}})))}get fullStream(){return Jm(this.teeStream().pipeThrough(new TransformStream({transform({part:t},e){e.enqueue(t)}})))}async consumeStream(t){var e;try{await nMe({stream:this.fullStream,onError:t?.onError})}catch(n){(e=t?.onError)==null||e.call(t,n)}}get experimental_partialOutputStream(){return this.partialOutputStream}get partialOutputStream(){return Jm(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:t},e){t!=null&&e.enqueue(t)}})))}get elementStream(){var t,e,n;const r=(t=this.outputSpecification)==null?void 0:t.createElementStreamTransform();if(r==null)throw new Nn({functionality:`element streams in ${(n=(e=this.outputSpecification)==null?void 0:e.name)!=null?n:"text"} mode`});return Jm(this.teeStream().pipeThrough(r))}get output(){return this.finalStep.then(t=>{var e;return((e=this.outputSpecification)!=null?e:bw()).parseCompleteOutput({text:t.text},{response:t.response,usage:t.usage,finishReason:t.finishReason})})}toUIMessageStream({originalMessages:t,generateMessageId:e,onFinish:n,messageMetadata:r,sendReasoning:i=!0,sendSources:a=!1,sendStart:s=!0,sendFinish:o=!0,onError:l=ef}={}){const u=e!=null?YCe({originalMessages:t,responseMessageId:e}):void 0,c=h=>{var f;const m=(f=this.tools)==null?void 0:f[h.toolName];return m==null?h.dynamic:m?.type==="dynamic"?!0:void 0},d=this.fullStream.pipeThrough(new TransformStream({transform:async(h,f)=>{const m=r?.({part:h}),x=h.type;switch(x){case"text-start":{f.enqueue({type:"text-start",id:h.id,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"text-delta":{f.enqueue({type:"text-delta",id:h.id,delta:h.text,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"text-end":{f.enqueue({type:"text-end",id:h.id,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"reasoning-start":{f.enqueue({type:"reasoning-start",id:h.id,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"reasoning-delta":{i&&f.enqueue({type:"reasoning-delta",id:h.id,delta:h.text,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"reasoning-end":{f.enqueue({type:"reasoning-end",id:h.id,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"file":{f.enqueue({type:"file",mediaType:h.file.mediaType,url:`data:${h.file.mediaType};base64,${h.file.base64}`});break}case"source":{a&&h.sourceType==="url"&&f.enqueue({type:"source-url",sourceId:h.id,url:h.url,title:h.title,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}}),a&&h.sourceType==="document"&&f.enqueue({type:"source-document",sourceId:h.id,mediaType:h.mediaType,title:h.title,filename:h.filename,...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{}});break}case"tool-input-start":{const b=c(h);f.enqueue({type:"tool-input-start",toolCallId:h.id,toolName:h.toolName,...h.providerExecuted!=null?{providerExecuted:h.providerExecuted}:{},...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{},...b!=null?{dynamic:b}:{},...h.title!=null?{title:h.title}:{}});break}case"tool-input-delta":{f.enqueue({type:"tool-input-delta",toolCallId:h.id,inputTextDelta:h.delta});break}case"tool-call":{const b=c(h);h.invalid?f.enqueue({type:"tool-input-error",toolCallId:h.toolCallId,toolName:h.toolName,input:h.input,...h.providerExecuted!=null?{providerExecuted:h.providerExecuted}:{},...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{},...b!=null?{dynamic:b}:{},errorText:l(h.error),...h.title!=null?{title:h.title}:{}}):f.enqueue({type:"tool-input-available",toolCallId:h.toolCallId,toolName:h.toolName,input:h.input,...h.providerExecuted!=null?{providerExecuted:h.providerExecuted}:{},...h.providerMetadata!=null?{providerMetadata:h.providerMetadata}:{},...b!=null?{dynamic:b}:{},...h.title!=null?{title:h.title}:{}});break}case"tool-approval-request":{f.enqueue({type:"tool-approval-request",approvalId:h.approvalId,toolCallId:h.toolCall.toolCallId});break}case"tool-result":{const b=c(h);f.enqueue({type:"tool-output-available",toolCallId:h.toolCallId,output:h.output,...h.providerExecuted!=null?{providerExecuted:h.providerExecuted}:{},...h.preliminary!=null?{preliminary:h.preliminary}:{},...b!=null?{dynamic:b}:{}});break}case"tool-error":{const b=c(h);f.enqueue({type:"tool-output-error",toolCallId:h.toolCallId,errorText:l(h.error),...h.providerExecuted!=null?{providerExecuted:h.providerExecuted}:{},...b!=null?{dynamic:b}:{}});break}case"tool-output-denied":{f.enqueue({type:"tool-output-denied",toolCallId:h.toolCallId});break}case"error":{f.enqueue({type:"error",errorText:l(h.error)});break}case"start-step":{f.enqueue({type:"start-step"});break}case"finish-step":{f.enqueue({type:"finish-step"});break}case"start":{s&&f.enqueue({type:"start",...m!=null?{messageMetadata:m}:{},...u!=null?{messageId:u}:{}});break}case"finish":{o&&f.enqueue({type:"finish",finishReason:h.finishReason,...m!=null?{messageMetadata:m}:{}});break}case"abort":{f.enqueue(h);break}case"tool-input-end":break;case"raw":break;default:{const b=x;throw new Error(`Unknown chunk type: ${b}`)}}m!=null&&x!=="start"&&x!=="finish"&&f.enqueue({type:"message-metadata",messageMetadata:m})}}));return Jm(eMe({stream:d,messageId:u??e?.(),originalMessages:t,onFinish:n,onError:l}))}pipeUIMessageStreamToResponse(t,{originalMessages:e,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:s,sendFinish:o,sendStart:l,onError:u,...c}={}){tMe({response:t,stream:this.toUIMessageStream({originalMessages:e,generateMessageId:n,onFinish:r,messageMetadata:i,sendReasoning:a,sendSources:s,sendFinish:o,sendStart:l,onError:u}),...c})}pipeTextStreamToResponse(t,e){GCe({response:t,textStream:this.textStream,...e})}toUIMessageStreamResponse({originalMessages:t,generateMessageId:e,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:s,sendStart:o,onError:l,...u}={}){return WCe({stream:this.toUIMessageStream({originalMessages:t,generateMessageId:e,onFinish:n,messageMetadata:r,sendReasoning:i,sendSources:a,sendFinish:s,sendStart:o,onError:l}),...u})}toTextStreamResponse(t){return qCe({textStream:this.textStream,...t})}};Mv({prefix:"aiobj",size:24});Mv({prefix:"aiobj",size:24});B({citations:B({enabled:Ot()}).optional(),title:A().optional(),context:A().optional()});B({sendReasoning:Ot().optional(),structuredOutputMode:wt(["outputFormat","jsonTool","auto"]).optional(),thinking:B({type:vt([ae("enabled"),ae("disabled")]),budgetTokens:ie().optional()}).optional(),disableParallelToolUse:Ot().optional(),cacheControl:B({type:ae("ephemeral"),ttl:vt([ae("5m"),ae("1h")]).optional()}).optional(),mcpServers:Ce(B({type:ae("url"),name:A(),url:A(),authorizationToken:A().nullish(),toolConfiguration:B({enabled:Ot().nullish(),allowedTools:Ce(A()).nullish()}).nullish()})).optional(),container:B({id:A().optional(),skills:Ce(B({type:vt([ae("anthropic"),ae("custom")]),skillId:A(),version:A().optional()})).optional()}).optional(),toolStreaming:Ot().optional(),effort:wt(["low","medium","high"]).optional(),contextManagement:B({edits:Ce(Zt("type",[B({type:ae("clear_tool_uses_20250919"),trigger:Zt("type",[B({type:ae("input_tokens"),value:ie()}),B({type:ae("tool_uses"),value:ie()})]).optional(),keep:B({type:ae("tool_uses"),value:ie()}).optional(),clearAtLeast:B({type:ae("input_tokens"),value:ie()}).optional(),clearToolInputs:Ot().optional(),excludeTools:Ce(A()).optional()}),B({type:ae("clear_thinking_20251015"),keep:vt([ae("all"),B({type:ae("thinking_turns"),value:ie()})]).optional()})]))}).optional()});var NB=4;function cMe(t){var e;const n=t?.anthropic;return(e=n?.cacheControl)!=null?e:n?.cache_control}var dMe=class{constructor(){this.breakpointCount=0,this.warnings=[]}getCacheControl(e,n){const r=cMe(e);if(r){if(!n.canCache){this.warnings.push({type:"unsupported",feature:"cache_control on non-cacheable context",details:`cache_control cannot be set on ${n.type}. It will be ignored.`});return}if(this.breakpointCount++,this.breakpointCount>NB){this.warnings.push({type:"unsupported",feature:"cacheControl breakpoint limit",details:`Maximum ${NB} cache breakpoints exceeded (found ${this.breakpointCount}). This breakpoint will be ignored.`});return}return r}}getWarnings(){return this.warnings}},hMe=at(()=>it(B({maxCharacters:ie().optional()}))),fMe=at(()=>it(B({command:wt(["view","create","str_replace","insert"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),pMe=Qr({id:"anthropic.text_editor_20250728",inputSchema:fMe}),mMe=(t={})=>pMe(t),gMe=at(()=>it(B({maxUses:ie().optional(),allowedDomains:Ce(A()).optional(),blockedDomains:Ce(A()).optional(),userLocation:B({type:ae("approximate"),city:A().optional(),region:A().optional(),country:A().optional(),timezone:A().optional()}).optional()}))),vMe=at(()=>it(Ce(B({url:A(),title:A().nullable(),pageAge:A().nullable(),encryptedContent:A(),type:ae("web_search_result")})))),yMe=at(()=>it(B({query:A()}))),xMe=Fr({id:"anthropic.web_search_20250305",inputSchema:yMe,outputSchema:vMe,supportsDeferredResults:!0}),bMe=(t={})=>xMe(t),_Me=at(()=>it(B({maxUses:ie().optional(),allowedDomains:Ce(A()).optional(),blockedDomains:Ce(A()).optional(),citations:B({enabled:Ot()}).optional(),maxContentTokens:ie().optional()}))),wMe=at(()=>it(B({type:ae("web_fetch_result"),url:A(),content:B({type:ae("document"),title:A().nullable(),citations:B({enabled:Ot()}).optional(),source:vt([B({type:ae("base64"),mediaType:ae("application/pdf"),data:A()}),B({type:ae("text"),mediaType:ae("text/plain"),data:A()})])}),retrievedAt:A().nullable()}))),SMe=at(()=>it(B({url:A()}))),EMe=Fr({id:"anthropic.web_fetch_20250910",inputSchema:SMe,outputSchema:wMe,supportsDeferredResults:!0}),TMe=(t={})=>EMe(t);async function CMe({tools:t,toolChoice:e,disableParallelToolUse:n,cacheControlValidator:r,supportsStructuredOutput:i}){var a;t=t?.length?t:void 0;const s=[],o=new Set,l=r||new dMe;if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:s,betas:o};const u=[];for(const d of t)switch(d.type){case"function":{const h=l.getCacheControl(d.providerOptions,{type:"tool definition",canCache:!0}),f=(a=d.providerOptions)==null?void 0:a.anthropic,m=f?.deferLoading,x=f?.allowedCallers;u.push({name:d.name,description:d.description,input_schema:d.inputSchema,cache_control:h,...m!=null?{defer_loading:m}:{},...x!=null?{allowed_callers:x}:{},...d.inputExamples!=null?{input_examples:d.inputExamples.map(b=>b.input)}:{}}),(d.inputExamples!=null||x!=null)&&o.add("advanced-tool-use-2025-11-20");break}case"provider":{switch(d.id){case"anthropic.code_execution_20250522":{o.add("code-execution-2025-05-22"),u.push({type:"code_execution_20250522",name:"code_execution",cache_control:void 0});break}case"anthropic.code_execution_20250825":{o.add("code-execution-2025-08-25"),u.push({type:"code_execution_20250825",name:"code_execution"});break}case"anthropic.computer_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"computer",type:"computer_20250124",display_width_px:d.args.displayWidthPx,display_height_px:d.args.displayHeightPx,display_number:d.args.displayNumber,cache_control:void 0});break}case"anthropic.computer_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"computer",type:"computer_20241022",display_width_px:d.args.displayWidthPx,display_height_px:d.args.displayHeightPx,display_number:d.args.displayNumber,cache_control:void 0});break}case"anthropic.text_editor_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"str_replace_editor",type:"text_editor_20250124",cache_control:void 0});break}case"anthropic.text_editor_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"str_replace_editor",type:"text_editor_20241022",cache_control:void 0});break}case"anthropic.text_editor_20250429":{o.add("computer-use-2025-01-24"),u.push({name:"str_replace_based_edit_tool",type:"text_editor_20250429",cache_control:void 0});break}case"anthropic.text_editor_20250728":{const h=await Kn({value:d.args,schema:hMe});u.push({name:"str_replace_based_edit_tool",type:"text_editor_20250728",max_characters:h.maxCharacters,cache_control:void 0});break}case"anthropic.bash_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"bash",type:"bash_20250124",cache_control:void 0});break}case"anthropic.bash_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"bash",type:"bash_20241022",cache_control:void 0});break}case"anthropic.memory_20250818":{o.add("context-management-2025-06-27"),u.push({name:"memory",type:"memory_20250818"});break}case"anthropic.web_fetch_20250910":{o.add("web-fetch-2025-09-10");const h=await Kn({value:d.args,schema:_Me});u.push({type:"web_fetch_20250910",name:"web_fetch",max_uses:h.maxUses,allowed_domains:h.allowedDomains,blocked_domains:h.blockedDomains,citations:h.citations,max_content_tokens:h.maxContentTokens,cache_control:void 0});break}case"anthropic.web_search_20250305":{const h=await Kn({value:d.args,schema:gMe});u.push({type:"web_search_20250305",name:"web_search",max_uses:h.maxUses,allowed_domains:h.allowedDomains,blocked_domains:h.blockedDomains,user_location:h.userLocation,cache_control:void 0});break}case"anthropic.tool_search_regex_20251119":{o.add("advanced-tool-use-2025-11-20"),u.push({type:"tool_search_tool_regex_20251119",name:"tool_search_tool_regex"});break}case"anthropic.tool_search_bm25_20251119":{o.add("advanced-tool-use-2025-11-20"),u.push({type:"tool_search_tool_bm25_20251119",name:"tool_search_tool_bm25"});break}default:{s.push({type:"unsupported",feature:`provider-defined tool ${d.id}`});break}}break}default:{s.push({type:"unsupported",feature:`tool ${d}`});break}}if(e==null)return{tools:u,toolChoice:n?{type:"auto",disable_parallel_tool_use:n}:void 0,toolWarnings:s,betas:o};const c=e.type;switch(c){case"auto":return{tools:u,toolChoice:{type:"auto",disable_parallel_tool_use:n},toolWarnings:s,betas:o};case"required":return{tools:u,toolChoice:{type:"any",disable_parallel_tool_use:n},toolWarnings:s,betas:o};case"none":return{tools:void 0,toolChoice:void 0,toolWarnings:s,betas:o};case"tool":return{tools:u,toolChoice:{type:"tool",name:e.toolName,disable_parallel_tool_use:n},toolWarnings:s,betas:o};default:{const d=c;throw new Nn({functionality:`tool choice type: ${d}`})}}}var MMe=at(()=>it(B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}))),AMe=at(()=>it(B({code:A()}))),kMe=Fr({id:"anthropic.code_execution_20250522",inputSchema:AMe,outputSchema:MMe}),IMe=(t={})=>kMe(t),NMe=at(()=>it(Zt("type",[B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}),B({type:ae("bash_code_execution_result"),content:Ce(B({type:ae("bash_code_execution_output"),file_id:A()})),stdout:A(),stderr:A(),return_code:ie()}),B({type:ae("bash_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_view_result"),content:A(),file_type:A(),num_lines:ie().nullable(),start_line:ie().nullable(),total_lines:ie().nullable()}),B({type:ae("text_editor_code_execution_create_result"),is_file_update:Ot()}),B({type:ae("text_editor_code_execution_str_replace_result"),lines:Ce(A()).nullable(),new_lines:ie().nullable(),new_start:ie().nullable(),old_lines:ie().nullable(),old_start:ie().nullable()})]))),RMe=at(()=>it(Zt("type",[B({type:ae("programmatic-tool-call"),code:A()}),B({type:ae("bash_code_execution"),command:A()}),Zt("command",[B({type:ae("text_editor_code_execution"),command:ae("view"),path:A()}),B({type:ae("text_editor_code_execution"),command:ae("create"),path:A(),file_text:A().nullish()}),B({type:ae("text_editor_code_execution"),command:ae("str_replace"),path:A(),old_str:A(),new_str:A()})])]))),PMe=Fr({id:"anthropic.code_execution_20250825",inputSchema:RMe,outputSchema:NMe,supportsDeferredResults:!0}),DMe=(t={})=>PMe(t),OMe=at(()=>it(Ce(B({type:ae("tool_reference"),toolName:A()})))),LMe=at(()=>it(B({pattern:A(),limit:ie().optional()}))),FMe=Fr({id:"anthropic.tool_search_regex_20251119",inputSchema:LMe,outputSchema:OMe}),BMe=(t={})=>FMe(t),UMe=at(()=>it(B({command:A(),restart:Ot().optional()}))),zMe=Qr({id:"anthropic.bash_20241022",inputSchema:UMe}),jMe=at(()=>it(B({command:A(),restart:Ot().optional()}))),HMe=Qr({id:"anthropic.bash_20250124",inputSchema:jMe}),$Me=at(()=>it(B({action:wt(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:Ce(ie().int()).optional(),text:A().optional()}))),VMe=Qr({id:"anthropic.computer_20241022",inputSchema:$Me}),qMe=at(()=>it(B({action:wt(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:x0([ie().int(),ie().int()]).optional(),duration:ie().optional(),scroll_amount:ie().optional(),scroll_direction:wt(["up","down","left","right"]).optional(),start_coordinate:x0([ie().int(),ie().int()]).optional(),text:A().optional()}))),GMe=Qr({id:"anthropic.computer_20250124",inputSchema:qMe}),WMe=at(()=>it(Zt("command",[B({command:ae("view"),path:A(),view_range:x0([ie(),ie()]).optional()}),B({command:ae("create"),path:A(),file_text:A()}),B({command:ae("str_replace"),path:A(),old_str:A(),new_str:A()}),B({command:ae("insert"),path:A(),insert_line:ie(),insert_text:A()}),B({command:ae("delete"),path:A()}),B({command:ae("rename"),old_path:A(),new_path:A()})]))),YMe=Qr({id:"anthropic.memory_20250818",inputSchema:WMe}),XMe=at(()=>it(B({command:wt(["view","create","str_replace","insert","undo_edit"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),KMe=Qr({id:"anthropic.text_editor_20241022",inputSchema:XMe}),ZMe=at(()=>it(B({command:wt(["view","create","str_replace","insert","undo_edit"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),JMe=Qr({id:"anthropic.text_editor_20250124",inputSchema:ZMe}),QMe=at(()=>it(B({command:wt(["view","create","str_replace","insert"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),eAe=Qr({id:"anthropic.text_editor_20250429",inputSchema:QMe}),tAe=at(()=>it(Ce(B({type:ae("tool_reference"),toolName:A()})))),nAe=at(()=>it(B({query:A(),limit:ie().optional()}))),rAe=Fr({id:"anthropic.tool_search_bm25_20251119",inputSchema:nAe,outputSchema:tAe}),iAe=(t={})=>rAe(t),lte={bash_20241022:zMe,bash_20250124:HMe,codeExecution_20250522:IMe,codeExecution_20250825:DMe,computer_20241022:VMe,computer_20250124:GMe,memory_20250818:YMe,textEditor_20241022:KMe,textEditor_20250124:JMe,textEditor_20250429:eAe,textEditor_20250728:mMe,webFetch_20250910:TMe,webSearch_20250305:bMe,toolSearchRegex_20251119:BMe,toolSearchBm25_20251119:iAe};function aAe(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}const sAe=t=>new TextEncoder().encode(t);typeof Buffer<"u"&&Buffer.from;function oAe(t){if(!Uint32Array.from){for(var e=new Uint32Array(t.length),n=0;n<t.length;)e[n]=t[n],n+=1;return e}return Uint32Array.from(t)}var ute=(function(){function t(){this.checksum=4294967295}return t.prototype.update=function(e){var n,r;try{for(var i=aAe(e),a=i.next();!a.done;a=i.next()){var s=a.value;this.checksum=this.checksum>>>8^uAe[(this.checksum^s)&255]}}catch(o){n={error:o}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this},t.prototype.digest=function(){return(this.checksum^4294967295)>>>0},t})(),lAe=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],uAe=oAe(lAe);const cte={},_I={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),cte[t]=e,_I[e]=t}function cAe(t){if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){const r=t.slice(n,n+2).toLowerCase();if(r in _I)e[n/2]=_I[r];else throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`)}return e}function zp(t){let e="";for(let n=0;n<t.byteLength;n++)e+=cte[t[n]];return e}class qg{bytes;constructor(e){if(this.bytes=e,e.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>9223372036854776e3||e<-9223372036854776e3)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const n=new Uint8Array(8);for(let r=7,i=Math.abs(Math.round(e));r>-1&&i>0;r--,i/=256)n[r]=i;return e<0&&RB(n),new qg(n)}valueOf(){const e=this.bytes.slice(0),n=e[0]&128;return n&&RB(e),parseInt(zp(e),16)*(n?-1:1)}toString(){return String(this.valueOf())}}function RB(t){for(let e=0;e<8;e++)t[e]^=255;for(let e=7;e>-1&&(t[e]++,t[e]===0);e--);}class dAe{toUtf8;fromUtf8;constructor(e,n){this.toUtf8=e,this.fromUtf8=n}format(e){const n=[];for(const a of Object.keys(e)){const s=this.fromUtf8(a);n.push(Uint8Array.from([s.byteLength]),s,this.formatHeaderValue(e[a]))}const r=new Uint8Array(n.reduce((a,s)=>a+s.byteLength,0));let i=0;for(const a of n)r.set(a,i),i+=a.byteLength;return r}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const n=new DataView(new ArrayBuffer(3));return n.setUint8(0,3),n.setInt16(1,e.value,!1),new Uint8Array(n.buffer);case"integer":const r=new DataView(new ArrayBuffer(5));return r.setUint8(0,4),r.setInt32(1,e.value,!1),new Uint8Array(r.buffer);case"long":const i=new Uint8Array(9);return i[0]=5,i.set(e.value.bytes,1),i;case"binary":const a=new DataView(new ArrayBuffer(3+e.value.byteLength));a.setUint8(0,6),a.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(a.buffer);return s.set(e.value,3),s;case"string":const o=this.fromUtf8(e.value),l=new DataView(new ArrayBuffer(3+o.byteLength));l.setUint8(0,7),l.setUint16(1,o.byteLength,!1);const u=new Uint8Array(l.buffer);return u.set(o,3),u;case"timestamp":const c=new Uint8Array(9);return c[0]=8,c.set(qg.fromNumber(e.value.valueOf()).bytes,1),c;case"uuid":if(!bAe.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(cAe(e.value.replace(/\-/g,"")),1),d}}parse(e){const n={};let r=0;for(;r<e.byteLength;){const i=e.getUint8(r++),a=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,i));switch(r+=i,e.getUint8(r++)){case 0:n[a]={type:DB,value:!0};break;case 1:n[a]={type:DB,value:!1};break;case 2:n[a]={type:hAe,value:e.getInt8(r++)};break;case 3:n[a]={type:fAe,value:e.getInt16(r,!1)},r+=2;break;case 4:n[a]={type:pAe,value:e.getInt32(r,!1)},r+=4;break;case 5:n[a]={type:mAe,value:new qg(new Uint8Array(e.buffer,e.byteOffset+r,8))},r+=8;break;case 6:const s=e.getUint16(r,!1);r+=2,n[a]={type:gAe,value:new Uint8Array(e.buffer,e.byteOffset+r,s)},r+=s;break;case 7:const o=e.getUint16(r,!1);r+=2,n[a]={type:vAe,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+r,o))},r+=o;break;case 8:n[a]={type:yAe,value:new Date(new qg(new Uint8Array(e.buffer,e.byteOffset+r,8)).valueOf())},r+=8;break;case 9:const l=new Uint8Array(e.buffer,e.byteOffset+r,16);r+=16,n[a]={type:xAe,value:`${zp(l.subarray(0,4))}-${zp(l.subarray(4,6))}-${zp(l.subarray(6,8))}-${zp(l.subarray(8,10))}-${zp(l.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return n}}var PB;(function(t){t[t.boolTrue=0]="boolTrue",t[t.boolFalse=1]="boolFalse",t[t.byte=2]="byte",t[t.short=3]="short",t[t.integer=4]="integer",t[t.long=5]="long",t[t.byteArray=6]="byteArray",t[t.string=7]="string",t[t.timestamp=8]="timestamp",t[t.uuid=9]="uuid"})(PB||(PB={}));const DB="boolean",hAe="byte",fAe="short",pAe="integer",mAe="long",gAe="binary",vAe="string",yAe="timestamp",xAe="uuid",bAe=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,dte=4,Lc=dte*2,gh=4,_Ae=Lc+gh*2;function wAe({byteLength:t,byteOffset:e,buffer:n}){if(t<_Ae)throw new Error("Provided message too short to accommodate event stream message overhead");const r=new DataView(n,e,t),i=r.getUint32(0,!1);if(t!==i)throw new Error("Reported message length does not match received message length");const a=r.getUint32(dte,!1),s=r.getUint32(Lc,!1),o=r.getUint32(t-gh,!1),l=new ute().update(new Uint8Array(n,e,Lc));if(s!==l.digest())throw new Error(`The prelude checksum specified in the message (${s}) does not match the calculated CRC32 checksum (${l.digest()})`);if(l.update(new Uint8Array(n,e+Lc,t-(Lc+gh))),o!==l.digest())throw new Error(`The message checksum (${l.digest()}) did not match the expected value of ${o}`);return{headers:new DataView(n,e+Lc+gh,a),body:new Uint8Array(n,e+Lc+gh+a,i-a-(Lc+gh+gh))}}class SAe{headerMarshaller;messageBuffer;isEndOfStream;constructor(e,n){this.headerMarshaller=new dAe(e,n),this.messageBuffer=[],this.isEndOfStream=!1}feed(e){this.messageBuffer.push(this.decode(e))}endOfStream(){this.isEndOfStream=!0}getMessage(){const e=this.messageBuffer.pop(),n=this.isEndOfStream;return{getMessage(){return e},isEndOfStream(){return n}}}getAvailableMessages(){const e=this.messageBuffer;this.messageBuffer=[];const n=this.isEndOfStream;return{getMessages(){return e},isEndOfStream(){return n}}}encode({headers:e,body:n}){const r=this.headerMarshaller.format(e),i=r.byteLength+n.byteLength+16,a=new Uint8Array(i),s=new DataView(a.buffer,a.byteOffset,a.byteLength),o=new ute;return s.setUint32(0,i,!1),s.setUint32(4,r.byteLength,!1),s.setUint32(8,o.update(a.subarray(0,8)).digest(),!1),a.set(r,12),a.set(n,r.byteLength+12),s.setUint32(i-4,o.update(a.subarray(8,i-4)).digest(),!1),a}decode(e){const{headers:n,body:r}=wAe(e);return{headers:this.headerMarshaller.parse(n),body:r}}formatHeaders(e){return this.headerMarshaller.format(e)}}const EAe=t=>new TextEncoder().encode(t),TAe=t=>{if(typeof t=="string")return t;if(typeof t!="object"||typeof t.byteOffset!="number"||typeof t.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(t)};/**
 * @license MIT <https://opensource.org/licenses/MIT>
 * @copyright Michael Hart 2024
 */const wI=new TextEncoder,CAe={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},MAe=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class AAe{constructor({method:e,url:n,headers:r,body:i,accessKeyId:a,secretAccessKey:s,sessionToken:o,service:l,region:u,cache:c,datetime:d,signQuery:h,appendSessionToken:f,allHeaders:m,singleEncode:x}){if(n==null)throw new TypeError("url is a required option");if(a==null)throw new TypeError("accessKeyId is a required option");if(s==null)throw new TypeError("secretAccessKey is a required option");this.method=e||(i?"POST":"GET"),this.url=new URL(n),this.headers=new Headers(r||{}),this.body=i,this.accessKeyId=a,this.secretAccessKey=s,this.sessionToken=o;let b,y;(!l||!u)&&([b,y]=kAe(this.url,this.headers)),this.service=l||b||"",this.region=u||y||"us-east-1",this.cache=c||new Map,this.datetime=d||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=h,this.appendSessionToken=f||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service==="s3"&&!this.signQuery&&!this.headers.has("X-Amz-Content-Sha256")&&this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const w=this.signQuery?this.url.searchParams:this.headers;if(w.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&w.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(S=>m||!MAe.has(S)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(S=>S+":"+(S==="host"?this.url.host:(this.headers.get(S)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service==="s3"&&!w.has("X-Amz-Expires")&&w.set("X-Amz-Expires","86400"),w.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),w.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),w.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");x||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=FB(this.encodedPath);const _=new Set;this.encodedSearch=[...this.url.searchParams].filter(([S])=>{if(!S)return!1;if(this.service==="s3"){if(_.has(S))return!1;_.add(S)}return!0}).map(S=>S.map(M=>FB(encodeURIComponent(M)))).sort(([S,M],[E,C])=>S<E?-1:S>E?1:M<C?-1:M>C?1:0).map(S=>S.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),n=[this.secretAccessKey,e,this.region,this.service].join();let r=this.cache.get(n);if(!r){const i=await Qm("AWS4"+this.secretAccessKey,e),a=await Qm(i,this.region),s=await Qm(a,this.service);r=await Qm(s,"aws4_request"),this.cache.set(n,r)}return ZE(await Qm(r,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,ZE(await OB(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=ZE(await OB(this.body||""))}return e}}async function Qm(t,e){const n=await crypto.subtle.importKey("raw",typeof t=="string"?wI.encode(t):t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",n,wI.encode(e))}async function OB(t){return crypto.subtle.digest("SHA-256",typeof t=="string"?wI.encode(t):t)}const LB=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function ZE(t){const e=new Uint8Array(t);let n="";for(let r=0;r<e.length;r++){const i=e[r];n+=LB[i>>>4&15],n+=LB[i&15]}return n}function FB(t){return t.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}function kAe(t,e){const{hostname:n,pathname:r}=t;if(n.endsWith(".on.aws")){const o=n.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return o!=null?["lambda",o[1]||""]:["",""]}if(n.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(n.endsWith(".backblazeb2.com")){const o=n.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return o!=null?["s3",o[1]||""]:["",""]}const i=n.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/);let a=i&&i[1]||"",s=i&&i[2];if(s==="us-gov")s="us-gov-west-1";else if(s==="s3"||s==="s3-accelerate")s="us-east-1",a="s3";else if(a==="iot")n.startsWith("iot.")?a="execute-api":n.startsWith("data.jobs.iot.")?a="iot-jobs-data":a=r==="/mqtt"?"iotdevicegateway":"iotdata";else if(a==="autoscaling"){const o=(e.get("X-Amz-Target")||"").split(".")[0];o==="AnyScaleFrontendService"?a="application-autoscaling":o==="AnyScaleScalingPlannerFrontendService"&&(a="autoscaling-plans")}else s==null&&a.startsWith("s3-")?(s=a.slice(3).replace(/^fips-|^external-1/,""),a="s3"):a.endsWith("-fips")?a=a.slice(0,-5):s&&/-\d$/.test(a)&&!/-\d$/.test(s)&&([a,s]=[s,a]);return[CAe[a]||a,s||""]}var JE={cachePoint:{type:"default"}},IAe=["stop","stop_sequence","end_turn","length","max_tokens","content-filter","content_filtered","guardrail_intervened","tool-calls","tool_use"],BB={"image/jpeg":"jpeg","image/png":"png","image/gif":"gif","image/webp":"webp"},UB={"application/pdf":"pdf","text/csv":"csv","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","text/html":"html","text/plain":"txt","text/markdown":"md"},NAe=B({citations:B({enabled:Ot()}).optional()}),RAe=B({additionalModelRequestFields:sn(A(),gr()).optional(),reasoningConfig:B({type:vt([ae("enabled"),ae("disabled")]).optional(),budgetTokens:ie().optional(),maxReasoningEffort:wt(["low","medium","high"]).optional()}).optional(),anthropicBeta:Ce(A()).optional()}),F1=B({message:A(),type:A().nullish()}),PAe=t=>async({response:e})=>{const n=xd(e);if(e.body==null)throw new QZ({});const r=new SAe(TAe,EAe);let i=new Uint8Array(0);const a=new TextDecoder;return{responseHeaders:n,value:e.body.pipeThrough(new TransformStream({async transform(s,o){var l,u;const c=new Uint8Array(i.length+s.length);for(c.set(i),c.set(s,i.length),i=c;i.length>=4;){const d=new DataView(i.buffer,i.byteOffset,i.byteLength).getUint32(0,!1);if(i.length<d)break;try{const h=i.subarray(0,d),f=r.decode(h);if(i=i.slice(d),((l=f.headers[":message-type"])==null?void 0:l.value)==="event"){const m=a.decode(f.body),x=await bo({text:m});if(!x.success){o.enqueue(x);break}delete x.value.p;let b={[(u=f.headers[":event-type"])==null?void 0:u.value]:x.value};const y=await xo({value:b,schema:t});y.success?o.enqueue({success:!0,value:y.value,rawValue:b}):o.enqueue(y)}}catch{break}}}}))}};async function DAe({tools:t,toolChoice:e,modelId:n}){var r;const i=[],a=new Set;if(t==null||t.length===0)return{toolConfig:{},additionalTools:void 0,betas:a,toolWarnings:i};const s=t.filter(x=>x.type==="provider"&&x.id==="anthropic.web_search_20250305"?(i.push({type:"unsupported",feature:"web_search_20250305 tool",details:"The web_search_20250305 tool is not supported on Amazon Bedrock."}),!1):!0);if(s.length===0)return{toolConfig:{},additionalTools:void 0,betas:a,toolWarnings:i};const o=n.includes("anthropic."),l=s.filter(x=>x.type==="provider"),u=s.filter(x=>x.type==="function");let c;const d=[],h=o&&l.length>0;if(h){u.length>0&&i.push({type:"unsupported",feature:"mixing Anthropic provider-defined tools and standard function tools",details:"Mixed Anthropic provider-defined tools and standard function tools are not supported in a single call to Bedrock. Only Anthropic tools will be used."});const{toolChoice:x,toolWarnings:b,betas:y}=await CMe({tools:l,toolChoice:e,supportsStructuredOutput:!1});i.push(...b),y.forEach(w=>a.add(w)),x&&(c={tool_choice:x});for(const w of l){const _=Object.values(lte).find(S=>S({}).id===w.id);if(_!=null){const S=_({});d.push({toolSpec:{name:w.name,inputSchema:{json:await xf(S.inputSchema).jsonSchema}}})}else i.push({type:"unsupported",feature:"tool ${tool.id}"})}}else for(const x of l)i.push({type:"unsupported",feature:`tool ${x.id}`});for(const x of u)d.push({toolSpec:{name:x.name,...((r=x.description)==null?void 0:r.trim())!==""?{description:x.description}:{},inputSchema:{json:x.inputSchema}}});let f;if(!h&&d.length>0&&e){const x=e.type;switch(x){case"auto":f={auto:{}};break;case"required":f={any:{}};break;case"none":d.length=0,f=void 0;break;case"tool":f={tool:{name:e.toolName}};break;default:{const b=x;throw new Nn({functionality:`tool choice type: ${b}`})}}}return{toolConfig:d.length>0?{tools:d,toolChoice:f}:{},additionalTools:c,betas:a,toolWarnings:i}}function zB(t){var e,n;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const r=t.inputTokens,i=t.outputTokens,a=(e=t.cacheReadInputTokens)!=null?e:0,s=(n=t.cacheWriteInputTokens)!=null?n:0;return{inputTokens:{total:r+a+s,noCache:r,cacheRead:a,cacheWrite:s},outputTokens:{total:i,text:i,reasoning:void 0},raw:t}}function QE(t){var e;return(e=t?.bedrock)==null?void 0:e.cachePoint}async function OAe(t){var e,n;const r=await sr({provider:"bedrock",providerOptions:t,schema:NAe});return(n=(e=r?.citations)==null?void 0:e.enabled)!=null?n:!1}async function LAe(t){var e,n;const r=BAe(t);let i=[];const a=[];let s=0;const o=()=>`document-${++s}`;for(let l=0;l<r.length;l++){const u=r[l],c=l===r.length-1,d=u.type;switch(d){case"system":{if(a.length>0)throw new Nn({functionality:"Multiple system messages that are separated by user/assistant messages"});for(const h of u.messages)i.push({text:h.content}),QE(h.providerOptions)&&i.push(JE);break}case"user":{const h=[];for(const f of u.messages){const{role:m,content:x,providerOptions:b}=f;switch(m){case"user":{for(let y=0;y<x.length;y++){const w=x[y];switch(w.type){case"text":{h.push({text:w.text});break}case"file":{if(w.data instanceof URL)throw new Nn({functionality:"File URL data"});if(w.mediaType.startsWith("image/"))h.push({image:{format:jB(w.mediaType),source:{bytes:oa(w.data)}}});else{if(!w.mediaType)throw new Nn({functionality:"file without mime type",message:"File mime type is required in user message part content"});const _=await OAe(w.providerOptions);h.push({document:{format:FAe(w.mediaType),name:(e=w.filename)!=null?e:o(),source:{bytes:oa(w.data)},..._&&{citations:{enabled:!0}}}})}break}}}break}case"tool":{for(const y of x){if(y.type==="tool-approval-response")continue;let w;const _=y.output;switch(_.type){case"content":{w=_.value.map(S=>{switch(S.type){case"text":return{text:S.text};case"image-data":if(!S.mediaType.startsWith("image/"))throw new Nn({functionality:`media type: ${S.mediaType}`});return{image:{format:jB(S.mediaType),source:{bytes:S.data}}};default:throw new Nn({functionality:`unsupported tool content part type: ${S.type}`})}});break}case"text":case"error-text":w=[{text:_.value}];break;case"execution-denied":w=[{text:(n=_.reason)!=null?n:"Tool execution denied."}];break;case"json":case"error-json":default:w=[{text:JSON.stringify(_.value)}];break}h.push({toolResult:{toolUseId:y.toolCallId,content:w}})}break}default:{const y=m;throw new Error(`Unsupported role: ${y}`)}}QE(b)&&h.push(JE)}a.push({role:"user",content:h});break}case"assistant":{const h=[];for(let f=0;f<u.messages.length;f++){const m=u.messages[f],x=f===u.messages.length-1,{content:b}=m;for(let y=0;y<b.length;y++){const w=b[y],_=y===b.length-1;switch(w.type){case"text":{if(!w.text.trim())break;h.push({text:HB(c,x,_,w.text)});break}case"reasoning":{const S=await sr({provider:"bedrock",providerOptions:w.providerOptions,schema:VAe});S!=null&&(S.signature!=null?h.push({reasoningContent:{reasoningText:{text:HB(c,x,_,w.text),signature:S.signature}}}):S.redactedData!=null&&h.push({reasoningContent:{redactedReasoning:{data:S.redactedData}}}));break}case"tool-call":{h.push({toolUse:{toolUseId:w.toolCallId,name:w.toolName,input:w.input}});break}}}QE(m.providerOptions)&&h.push(JE)}a.push({role:"assistant",content:h});break}default:{const h=d;throw new Error(`Unsupported type: ${h}`)}}}return{system:i,messages:a}}function jB(t){if(!t)throw new Nn({functionality:"image without mime type",message:"Image mime type is required in user message part content"});const e=BB[t];if(!e)throw new Nn({functionality:`image mime type: ${t}`,message:`Unsupported image mime type: ${t}, expected one of: ${Object.keys(BB).join(", ")}`});return e}function FAe(t){const e=UB[t];if(!e)throw new Nn({functionality:`file mime type: ${t}`,message:`Unsupported file mime type: ${t}, expected one of: ${Object.keys(UB).join(", ")}`});return e}function HB(t,e,n,r){return t&&e&&n?r.trim():r}function BAe(t){const e=[];let n;for(const r of t){const{role:i}=r;switch(i){case"system":{n?.type!=="system"&&(n={type:"system",messages:[]},e.push(n)),n.messages.push(r);break}case"assistant":{n?.type!=="assistant"&&(n={type:"assistant",messages:[]},e.push(n)),n.messages.push(r);break}case"user":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}case"tool":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}default:{const a=i;throw new Error(`Unsupported role: ${a}`)}}}return e}function $B(t,e){switch(t){case"stop_sequence":case"end_turn":return"stop";case"max_tokens":return"length";case"content_filtered":case"guardrail_intervened":return"content-filter";case"tool_use":return e?"stop":"tool-calls";default:return"other"}}var UAe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.provider="amazon-bedrock",this.supportedUrls={}}async getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:s,stopSequences:o,responseFormat:l,seed:u,tools:c,toolChoice:d,providerOptions:h}){var f,m,x,b,y,w,_,S,M;const E=(f=await sr({provider:"bedrock",providerOptions:h,schema:RAe}))!=null?f:{},C=[];a!=null&&C.push({type:"unsupported",feature:"frequencyPenalty"}),s!=null&&C.push({type:"unsupported",feature:"presencePenalty"}),u!=null&&C.push({type:"unsupported",feature:"seed"}),n!=null&&n>1?(C.push({type:"unsupported",feature:"temperature",details:`${n} exceeds bedrock maximum of 1.0. clamped to 1.0`}),n=1):n!=null&&n<0&&(C.push({type:"unsupported",feature:"temperature",details:`${n} is below bedrock minimum of 0. clamped to 0`}),n=0),l!=null&&l.type!=="text"&&l.type!=="json"&&C.push({type:"unsupported",feature:"responseFormat",details:"Only text and json response formats are supported."});const R=l?.type==="json"&&l.schema!=null?{type:"function",name:"json",description:"Respond with a JSON object.",inputSchema:l.schema}:void 0,{toolConfig:k,additionalTools:I,toolWarnings:N,betas:D}=await DAe({tools:R?[...c??[],R]:c,toolChoice:R!=null?{type:"required"}:d,modelId:this.modelId});if(C.push(...N),I&&(E.additionalModelRequestFields={...E.additionalModelRequestFields,...I}),D.size>0||E.anthropicBeta){const ue=(m=E.anthropicBeta)!=null?m:[],oe=D.size>0?[...ue,...Array.from(D)]:ue;E.additionalModelRequestFields={...E.additionalModelRequestFields,anthropic_beta:oe}}const F=this.modelId.includes("anthropic"),L=((x=E.reasoningConfig)==null?void 0:x.type)==="enabled",U=(b=E.reasoningConfig)==null?void 0:b.budgetTokens,j=F&&L,q={...e!=null&&{maxTokens:e},...n!=null&&{temperature:n},...r!=null&&{topP:r},...i!=null&&{topK:i},...o!=null&&{stopSequences:o}};j&&U!=null?(q.maxTokens!=null?q.maxTokens+=U:q.maxTokens=U+4096,E.additionalModelRequestFields={...E.additionalModelRequestFields,thinking:{type:(y=E.reasoningConfig)==null?void 0:y.type,budget_tokens:U}}):!F&&U!=null&&C.push({type:"unsupported",feature:"budgetTokens",details:"budgetTokens applies only to Anthropic models on Bedrock and will be ignored for this model."});const Z=(w=E.reasoningConfig)==null?void 0:w.maxReasoningEffort,Q=this.modelId.startsWith("openai.");Z!=null&&!F?Q?E.additionalModelRequestFields={...E.additionalModelRequestFields,reasoning_effort:Z}:E.additionalModelRequestFields={...E.additionalModelRequestFields,reasoningConfig:{...((_=E.reasoningConfig)==null?void 0:_.type)!=null&&{type:E.reasoningConfig.type},maxReasoningEffort:Z}}:Z!=null&&F&&C.push({type:"unsupported",feature:"maxReasoningEffort",details:"maxReasoningEffort applies only to Amazon Nova models on Bedrock and will be ignored for this model."}),j&&q.temperature!=null&&(delete q.temperature,C.push({type:"unsupported",feature:"temperature",details:"temperature is not supported when thinking is enabled"})),j&&q.topP!=null&&(delete q.topP,C.push({type:"unsupported",feature:"topP",details:"topP is not supported when thinking is enabled"})),j&&q.topK!=null&&(delete q.topK,C.push({type:"unsupported",feature:"topK",details:"topK is not supported when thinking is enabled"}));const z=((M=(S=k.tools)==null?void 0:S.length)!=null?M:0)>0||I;let W=t;z||t.some(oe=>"content"in oe&&Array.isArray(oe.content)&&oe.content.some(Te=>Te.type==="tool-call"||Te.type==="tool-result"))&&(W=t.map(oe=>oe.role==="system"?oe:{...oe,content:oe.content.filter(Te=>Te.type!=="tool-call"&&Te.type!=="tool-result")}).filter(oe=>oe.role==="system"||oe.content.length>0),C.push({type:"unsupported",feature:"toolContent",details:"Tool calls and results removed from conversation because Bedrock does not support tool content without active tools."}));const{system:X,messages:H}=await LAe(W),{reasoningConfig:J,additionalModelRequestFields:te,...ee}=h?.bedrock||{},se=F?["/delta/stop_sequence"]:void 0;return{command:{system:X,messages:H,additionalModelRequestFields:E.additionalModelRequestFields,...se&&{additionalModelResponseFieldPaths:se},...Object.keys(q).length>0&&{inferenceConfig:q},...ee,...k.tools!==void 0&&k.tools.length>0?{toolConfig:k}:{}},warnings:C,usesJsonResponseTool:R!=null,betas:D}}async getHeaders({headers:t}){return Mn(await Vr(this.config.headers),t)}async doGenerate(t){var e,n,r,i,a,s,o,l,u,c,d,h;const{command:f,warnings:m,usesJsonResponseTool:x}=await this.getArgs(t),b=`${this.getUrl(this.modelId)}/converse`,{value:y,responseHeaders:w}=await Fn({url:b,headers:await this.getHeaders({headers:t.headers}),body:f,failedResponseHandler:Fa({errorSchema:F1,errorToMessage:C=>{var R;return`${(R=C.message)!=null?R:"Unknown error"}`}}),successfulResponseHandler:vr(HAe),abortSignal:t.abortSignal,fetch:this.config.fetch}),_=[];let S=!1;for(const C of y.output.message.content){if(C.text&&_.push({type:"text",text:C.text}),C.reasoningContent)if("reasoningText"in C.reasoningContent){const R={type:"reasoning",text:C.reasoningContent.reasoningText.text};C.reasoningContent.reasoningText.signature&&(R.providerMetadata={bedrock:{signature:C.reasoningContent.reasoningText.signature}}),_.push(R)}else"redactedReasoning"in C.reasoningContent&&_.push({type:"reasoning",text:"",providerMetadata:{bedrock:{redactedData:(e=C.reasoningContent.redactedReasoning.data)!=null?e:""}}});C.toolUse&&(x&&C.toolUse.name==="json"?(S=!0,_.push({type:"text",text:JSON.stringify(C.toolUse.input)})):_.push({type:"tool-call",toolCallId:(r=(n=C.toolUse)==null?void 0:n.toolUseId)!=null?r:this.config.generateId(),toolName:(a=(i=C.toolUse)==null?void 0:i.name)!=null?a:`tool-${this.config.generateId()}`,input:JSON.stringify((o=(s=C.toolUse)==null?void 0:s.input)!=null?o:{})}))}const M=(c=(u=(l=y.additionalModelResponseFields)==null?void 0:l.delta)==null?void 0:u.stop_sequence)!=null?c:null,E=y.trace||y.usage||S||M?{bedrock:{...y.trace&&typeof y.trace=="object"?{trace:y.trace}:{},...((d=y.usage)==null?void 0:d.cacheWriteInputTokens)!=null&&{usage:{cacheWriteInputTokens:y.usage.cacheWriteInputTokens}},...S&&{isJsonResponseFromTool:!0},stopSequence:M}}:void 0;return{content:_,finishReason:{unified:$B(y.stopReason,S),raw:(h=y.stopReason)!=null?h:void 0},usage:zB(y.usage),response:{headers:w},warnings:m,...E&&{providerMetadata:E}}}async doStream(t){const{command:e,warnings:n,usesJsonResponseTool:r}=await this.getArgs(t),i=`${this.getUrl(this.modelId)}/converse-stream`,{value:a,responseHeaders:s}=await Fn({url:i,headers:await this.getHeaders({headers:t.headers}),body:e,failedResponseHandler:Fa({errorSchema:F1,errorToMessage:f=>`${f.type}: ${f.message}`}),successfulResponseHandler:PAe($Ae),abortSignal:t.abortSignal,fetch:this.config.fetch});let o={unified:"other",raw:void 0},l,u,c=!1,d=null;const h={};return{stream:a.pipeThrough(new TransformStream({start(f){f.enqueue({type:"stream-start",warnings:n})},transform(f,m){var x,b,y,w,_,S,M,E,C,R,k,I,N;function D(j){o={unified:"error",raw:void 0},m.enqueue({type:"error",error:j})}if(t.includeRawChunks&&m.enqueue({type:"raw",rawValue:f.rawValue}),!f.success){D(f.error);return}const F=f.value;if(F.internalServerException){D(F.internalServerException);return}if(F.modelStreamErrorException){D(F.modelStreamErrorException);return}if(F.throttlingException){D(F.throttlingException);return}if(F.validationException){D(F.validationException);return}if(F.messageStop&&(o={unified:$B(F.messageStop.stopReason,c),raw:(x=F.messageStop.stopReason)!=null?x:void 0},d=(w=(y=(b=F.messageStop.additionalModelResponseFields)==null?void 0:b.delta)==null?void 0:y.stop_sequence)!=null?w:null),F.metadata){F.metadata.usage&&(l=F.metadata.usage);const j=((_=F.metadata.usage)==null?void 0:_.cacheWriteInputTokens)!=null?{usage:{cacheWriteInputTokens:F.metadata.usage.cacheWriteInputTokens}}:void 0,q=F.metadata.trace?{trace:F.metadata.trace}:void 0;(j||q)&&(u={bedrock:{...j,...q}})}if(((S=F.contentBlockStart)==null?void 0:S.contentBlockIndex)!=null&&!((E=(M=F.contentBlockStart)==null?void 0:M.start)!=null&&E.toolUse)){const j=F.contentBlockStart.contentBlockIndex;h[j]={type:"text"},m.enqueue({type:"text-start",id:String(j)})}if((C=F.contentBlockDelta)!=null&&C.delta&&"text"in F.contentBlockDelta.delta&&F.contentBlockDelta.delta.text){const j=F.contentBlockDelta.contentBlockIndex||0;h[j]==null&&(h[j]={type:"text"},m.enqueue({type:"text-start",id:String(j)})),m.enqueue({type:"text-delta",id:String(j),delta:F.contentBlockDelta.delta.text})}if(((R=F.contentBlockStop)==null?void 0:R.contentBlockIndex)!=null){const j=F.contentBlockStop.contentBlockIndex,q=h[j];q!=null&&(q.type==="reasoning"?m.enqueue({type:"reasoning-end",id:String(j)}):q.type==="text"?m.enqueue({type:"text-end",id:String(j)}):q.type==="tool-call"&&(q.isJsonResponseTool?(c=!0,m.enqueue({type:"text-start",id:String(j)}),m.enqueue({type:"text-delta",id:String(j),delta:q.jsonText}),m.enqueue({type:"text-end",id:String(j)})):(m.enqueue({type:"tool-input-end",id:q.toolCallId}),m.enqueue({type:"tool-call",toolCallId:q.toolCallId,toolName:q.toolName,input:q.jsonText===""?"{}":q.jsonText}))),delete h[j])}if((k=F.contentBlockDelta)!=null&&k.delta&&"reasoningContent"in F.contentBlockDelta.delta&&F.contentBlockDelta.delta.reasoningContent){const j=F.contentBlockDelta.contentBlockIndex||0,q=F.contentBlockDelta.delta.reasoningContent;"text"in q&&q.text?(h[j]==null&&(h[j]={type:"reasoning"},m.enqueue({type:"reasoning-start",id:String(j)})),m.enqueue({type:"reasoning-delta",id:String(j),delta:q.text})):"signature"in q&&q.signature?m.enqueue({type:"reasoning-delta",id:String(j),delta:"",providerMetadata:{bedrock:{signature:q.signature}}}):"data"in q&&q.data&&m.enqueue({type:"reasoning-delta",id:String(j),delta:"",providerMetadata:{bedrock:{redactedData:q.data}}})}const L=F.contentBlockStart;if(((I=L?.start)==null?void 0:I.toolUse)!=null){const j=L.start.toolUse,q=L.contentBlockIndex,Z=r&&j.name==="json";h[q]={type:"tool-call",toolCallId:j.toolUseId,toolName:j.name,jsonText:"",isJsonResponseTool:Z},Z||m.enqueue({type:"tool-input-start",id:j.toolUseId,toolName:j.name})}const U=F.contentBlockDelta;if(U?.delta&&"toolUse"in U.delta&&U.delta.toolUse){const j=U.contentBlockIndex,q=h[j];if(q?.type==="tool-call"){const Z=(N=U.delta.toolUse.input)!=null?N:"";q.isJsonResponseTool||m.enqueue({type:"tool-input-delta",id:q.toolCallId,delta:Z}),q.jsonText+=Z}}},flush(f){(c||d!=null)&&(u?u.bedrock={...u.bedrock,...c&&{isJsonResponseFromTool:!0},stopSequence:d}:u={bedrock:{...c&&{isJsonResponseFromTool:!0},stopSequence:d}}),f.enqueue({type:"finish",finishReason:o,usage:zB(l),...u&&{providerMetadata:u}})}})),response:{headers:s}}}getUrl(t){const e=encodeURIComponent(t);return`${this.config.baseUrl()}/model/${e}`}},hte=vt([wt(IAe),A()]),fte=B({delta:B({stop_sequence:A().nullish()}).nullish()}).catchall(Zn()),pte=B({toolUseId:A(),name:A(),input:Zn()}),zAe=B({signature:A().nullish(),text:A()}),jAe=B({data:A()}),HAe=B({metrics:B({latencyMs:ie()}).nullish(),output:B({message:B({content:Ce(B({text:A().nullish(),toolUse:pte.nullish(),reasoningContent:vt([B({reasoningText:zAe}),B({redactedReasoning:jAe})]).nullish()})),role:A()})}),stopReason:hte,additionalModelResponseFields:fte.nullish(),trace:Zn().nullish(),usage:B({inputTokens:ie(),outputTokens:ie(),totalTokens:ie(),cacheReadInputTokens:ie().nullish(),cacheWriteInputTokens:ie().nullish()})}),$Ae=B({contentBlockDelta:B({contentBlockIndex:ie(),delta:vt([B({text:A()}),B({toolUse:B({input:A()})}),B({reasoningContent:B({text:A()})}),B({reasoningContent:B({signature:A()})}),B({reasoningContent:B({data:A()})})]).nullish()}).nullish(),contentBlockStart:B({contentBlockIndex:ie(),start:B({toolUse:pte.nullish()}).nullish()}).nullish(),contentBlockStop:B({contentBlockIndex:ie()}).nullish(),internalServerException:sn(A(),Zn()).nullish(),messageStop:B({additionalModelResponseFields:fte.nullish(),stopReason:hte}).nullish(),metadata:B({trace:Zn().nullish(),usage:B({cacheReadInputTokens:ie().nullish(),cacheWriteInputTokens:ie().nullish(),inputTokens:ie(),outputTokens:ie()}).nullish()}).nullish(),modelStreamErrorException:sn(A(),Zn()).nullish(),throttlingException:sn(A(),Zn()).nullish(),validationException:sn(A(),Zn()).nullish()}),VAe=B({signature:A().optional(),redactedData:A().optional()}),qAe=B({dimensions:vt([ae(1024),ae(512),ae(256)]).optional(),normalize:Ot().optional()}),GAe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.provider="amazon-bedrock",this.maxEmbeddingsPerCall=1,this.supportsParallelCalls=!0}getUrl(t){const e=encodeURIComponent(t);return`${this.config.baseUrl()}/model/${e}/invoke`}async doEmbed({values:t,headers:e,abortSignal:n,providerOptions:r}){var i;if(t.length>this.maxEmbeddingsPerCall)throw new Tv({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const a=(i=await sr({provider:"bedrock",providerOptions:r,schema:qAe}))!=null?i:{},s={inputText:t[0],dimensions:a.dimensions,normalize:a.normalize},o=this.getUrl(this.modelId),{value:l}=await Fn({url:o,headers:await Vr(Mn(await Vr(this.config.headers),e)),body:s,failedResponseHandler:Fa({errorSchema:F1,errorToMessage:u=>`${u.type}: ${u.message}`}),successfulResponseHandler:vr(WAe),fetch:this.config.fetch,abortSignal:n});return{warnings:[],embeddings:[l.embedding],usage:{tokens:l.inputTextTokenCount}}}},WAe=B({embedding:Ce(ie()),inputTextTokenCount:ie()}),YAe={"amazon.nova-canvas-v1:0":5},XAe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.provider="amazon-bedrock"}get maxImagesPerCall(){var t;return(t=YAe[this.modelId])!=null?t:1}getUrl(t){const e=encodeURIComponent(t);return`${this.config.baseUrl()}/model/${e}/invoke`}async doGenerate({prompt:t,n:e,size:n,aspectRatio:r,seed:i,providerOptions:a,headers:s,abortSignal:o,files:l,mask:u}){var c,d,h,f,m,x,b,y,w,_,S,M,E,C,R,k;const I=[],[N,D]=n?n.split("x").map(Number):[],F=l!=null&&l.length>0,L={...N?{width:N}:{},...D?{height:D}:{},...i?{seed:i}:{},...e?{numberOfImages:e}:{},...(c=a?.bedrock)!=null&&c.quality?{quality:a.bedrock.quality}:{},...(d=a?.bedrock)!=null&&d.cfgScale?{cfgScale:a.bedrock.cfgScale}:{}};let U;if(F){const Q=u?.type!=null,z=((h=a?.bedrock)==null?void 0:h.maskPrompt)!=null,W=(m=(f=a?.bedrock)==null?void 0:f.taskType)!=null?m:Q||z?"INPAINTING":"IMAGE_VARIATION",X=nb(l[0]);switch(W){case"INPAINTING":{const H={image:X,...t?{text:t}:{},...(x=a?.bedrock)!=null&&x.negativeText?{negativeText:a.bedrock.negativeText}:{}};Q?H.maskImage=nb(u):z&&(H.maskPrompt=a.bedrock.maskPrompt),U={taskType:"INPAINTING",inPaintingParams:H,imageGenerationConfig:L};break}case"OUTPAINTING":{const H={image:X,...t?{text:t}:{},...(b=a?.bedrock)!=null&&b.negativeText?{negativeText:a.bedrock.negativeText}:{},...(y=a?.bedrock)!=null&&y.outPaintingMode?{outPaintingMode:a.bedrock.outPaintingMode}:{}};Q?H.maskImage=nb(u):z&&(H.maskPrompt=a.bedrock.maskPrompt),U={taskType:"OUTPAINTING",outPaintingParams:H,imageGenerationConfig:L};break}case"BACKGROUND_REMOVAL":{U={taskType:"BACKGROUND_REMOVAL",backgroundRemovalParams:{image:X}};break}case"IMAGE_VARIATION":{U={taskType:"IMAGE_VARIATION",imageVariationParams:{images:l.map(te=>nb(te)),...t?{text:t}:{},...(w=a?.bedrock)!=null&&w.negativeText?{negativeText:a.bedrock.negativeText}:{},...((_=a?.bedrock)==null?void 0:_.similarityStrength)!=null?{similarityStrength:a.bedrock.similarityStrength}:{}},imageGenerationConfig:L};break}default:throw new Error(`Unsupported task type: ${W}`)}}else U={taskType:"TEXT_IMAGE",textToImageParams:{text:t,...(S=a?.bedrock)!=null&&S.negativeText?{negativeText:a.bedrock.negativeText}:{},...(M=a?.bedrock)!=null&&M.style?{style:a.bedrock.style}:{}},imageGenerationConfig:L};r!=null&&I.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."});const j=(R=(C=(E=this.config._internal)==null?void 0:E.currentDate)==null?void 0:C.call(E))!=null?R:new Date,{value:q,responseHeaders:Z}=await Fn({url:this.getUrl(this.modelId),headers:await Vr(Mn(await Vr(this.config.headers),s)),body:U,failedResponseHandler:Fa({errorSchema:F1,errorToMessage:Q=>`${Q.type}: ${Q.message}`}),successfulResponseHandler:vr(KAe),abortSignal:o,fetch:this.config.fetch});if(q.status==="Request Moderated"){const Q=(k=q.details)==null?void 0:k["Moderation Reasons"],z=Array.isArray(Q)?Q:["Unknown"];throw new Error(`Amazon Bedrock request was moderated: ${z.join(", ")}`)}if(!q.images||q.images.length===0)throw new Error("Amazon Bedrock returned no images. "+(q.status?`Status: ${q.status}`:""));return{images:q.images,warnings:I,response:{timestamp:j,modelId:this.modelId,headers:Z}}}};function nb(t){if(t.type==="url")throw new Error("URL-based images are not supported for Amazon Bedrock image editing. Please provide the image data directly.");return t.data instanceof Uint8Array?b0(t.data):t.data}var KAe=B({images:Ce(A()).optional(),id:A().optional(),status:A().optional(),result:Zn().optional(),progress:Zn().optional(),details:sn(A(),Zn()).optional(),preview:Zn().optional()}),cR="4.0.19";function ZAe(t,e=globalThis.fetch){return async(n,r)=>{var i,a;const s=n instanceof Request?n:void 0,o=Mn(Hg(s?.headers),Hg(r?.headers)),l=To(o,`ai-sdk/amazon-bedrock/${cR}`,Av());let u=(i=r?.body)!=null?i:void 0;if(u===void 0&&s&&s.body!==null)try{u=await s.clone().text()}catch{}const c=(a=r?.method)!=null?a:s?.method;if(c?.toUpperCase()!=="POST"||!u)return e(n,{...r,headers:l});const d=typeof n=="string"?n:n instanceof URL?n.href:n.url,h=JAe(u),f=await t(),x=await new AAe({url:d,method:"POST",headers:Object.entries(l),body:h,region:f.region,accessKeyId:f.accessKeyId,secretAccessKey:f.secretAccessKey,sessionToken:f.sessionToken,service:"bedrock"}).sign(),b=Hg(x.headers),y=Mn(l,b);return e(n,{...r,body:h,headers:y})}}function JAe(t){return typeof t=="string"?t:t instanceof Uint8Array?new TextDecoder().decode(t):t instanceof ArrayBuffer?new TextDecoder().decode(new Uint8Array(t)):JSON.stringify(t)}function QAe(t,e=globalThis.fetch){return async(n,r)=>{const i=Hg(r?.headers),a=To(i,`ai-sdk/amazon-bedrock/${cR}`,Av()),s=Mn(a,{Authorization:`Bearer ${t}`});return e(n,{...r,headers:s})}}var eke=at(()=>it(B({results:Ce(B({index:ie(),relevanceScore:ie()})),nextToken:A().optional()}))),tke=at(()=>it(B({nextToken:A().optional(),additionalModelRequestFields:sn(A(),gr()).optional()}))),nke=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3",this.provider="amazon-bedrock"}async doRerank({documents:t,headers:e,query:n,topN:r,abortSignal:i,providerOptions:a}){const s=await sr({provider:"bedrock",providerOptions:a,schema:tke}),{value:o,responseHeaders:l,rawValue:u}=await Fn({url:`${this.config.baseUrl()}/rerank`,headers:await Vr(Mn(await Vr(this.config.headers),e)),body:{nextToken:s?.nextToken,queries:[{textQuery:{text:n},type:"TEXT"}],rerankingConfiguration:{bedrockRerankingConfiguration:{modelConfiguration:{modelArn:`arn:aws:bedrock:${this.config.region}::foundation-model/${this.modelId}`,additionalModelRequestFields:s?.additionalModelRequestFields},numberOfResults:r},type:"BEDROCK_RERANKING_MODEL"},sources:t.values.map(c=>({type:"INLINE",inlineDocumentSource:t.type==="text"?{type:"TEXT",textDocument:{text:c}}:{type:"JSON",jsonDocument:c}}))},failedResponseHandler:Fa({errorSchema:F1,errorToMessage:c=>`${c.type}: ${c.message}`}),successfulResponseHandler:vr(eke),fetch:this.config.fetch,abortSignal:i});return{ranking:o.results,response:{headers:l,body:u}}}};function rke(t={}){const e=Kc({settingValue:t.apiKey,environmentVariableName:"AWS_BEARER_TOKEN_BEDROCK"}),n=e&&e.trim().length>0?e.trim():void 0,r=n?QAe(n,t.fetch):ZAe(async()=>{const h=mh({settingValue:t.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"});if(t.credentialProvider)try{return{...await t.credentialProvider(),region:h}}catch(f){const m=f instanceof Error?f.message:String(f);throw new Error(`AWS credential provider failed: ${m}. Please ensure your credential provider returns valid AWS credentials with accessKeyId and secretAccessKey properties.`)}try{return{region:h,accessKeyId:mh({settingValue:t.accessKeyId,settingName:"accessKeyId",environmentVariableName:"AWS_ACCESS_KEY_ID",description:"AWS access key ID"}),secretAccessKey:mh({settingValue:t.secretAccessKey,settingName:"secretAccessKey",environmentVariableName:"AWS_SECRET_ACCESS_KEY",description:"AWS secret access key"}),sessionToken:Kc({settingValue:t.sessionToken,environmentVariableName:"AWS_SESSION_TOKEN"})}}catch(f){const m=f instanceof Error?f.message:String(f);throw m.includes("AWS_ACCESS_KEY_ID")||m.includes("accessKeyId")?new Error(`AWS SigV4 authentication requires AWS credentials. Please provide either:
1. Set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables
2. Provide accessKeyId and secretAccessKey in options
3. Use a credentialProvider function
4. Use API key authentication with AWS_BEARER_TOKEN_BEDROCK or apiKey option
Original error: ${m}`):m.includes("AWS_SECRET_ACCESS_KEY")||m.includes("secretAccessKey")?new Error(`AWS SigV4 authentication requires both AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY. Please ensure both credentials are provided.
Original error: ${m}`):f}},t.fetch),i=()=>{var h;const f=(h=t.headers)!=null?h:{};return To(f,`ai-sdk/amazon-bedrock/${cR}`)},a=()=>{var h,f;return(f=rf((h=t.baseURL)!=null?h:`https://bedrock-runtime.${mh({settingValue:t.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"})}.amazonaws.com`))!=null?f:"https://bedrock-runtime.us-east-1.amazonaws.com"},s=()=>{var h,f;return(f=rf((h=t.baseURL)!=null?h:`https://bedrock-agent-runtime.${mh({settingValue:t.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"})}.amazonaws.com`))!=null?f:"https://bedrock-agent-runtime.us-west-2.amazonaws.com"},o=h=>new UAe(h,{baseUrl:a,headers:i,fetch:r,generateId:Ln}),l=function(h){if(new.target)throw new Error("The Amazon Bedrock model function cannot be called with the new keyword.");return o(h)},u=h=>new GAe(h,{baseUrl:a,headers:i,fetch:r}),c=h=>new XAe(h,{baseUrl:a,headers:i,fetch:r}),d=h=>new nke(h,{baseUrl:s,region:mh({settingValue:t.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"}),headers:i,fetch:r});return l.specificationVersion="v3",l.languageModel=o,l.embedding=u,l.embeddingModel=u,l.textEmbedding=u,l.textEmbeddingModel=u,l.image=c,l.imageModel=c,l.reranking=d,l.rerankingModel=d,l.tools=lte,l}var ike=rke(),dR=B({error:B({message:A(),type:A().nullish(),param:gr().nullish(),code:vt([A(),ie()]).nullish()})}),rl=Fa({errorSchema:dR,errorToMessage:t=>t.error.message});function mte(t){const e=t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat"),n=t.startsWith("gpt-4")||t.startsWith("gpt-5-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-nano")&&!t.startsWith("gpt-5-chat")||t.startsWith("o3")||t.startsWith("o4-mini"),r=t.startsWith("o1")||t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("codex-mini")||t.startsWith("computer-use-preview")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat"),i=t.startsWith("gpt-5.1")||t.startsWith("gpt-5.2");return{supportsFlexProcessing:e,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?"developer":"system",supportsNonReasoningParameters:i}}function VB(t){var e,n,r,i,a,s;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const o=(e=t.prompt_tokens)!=null?e:0,l=(n=t.completion_tokens)!=null?n:0,u=(i=(r=t.prompt_tokens_details)==null?void 0:r.cached_tokens)!=null?i:0,c=(s=(a=t.completion_tokens_details)==null?void 0:a.reasoning_tokens)!=null?s:0;return{inputTokens:{total:o,noCache:o-u,cacheRead:u,cacheWrite:void 0},outputTokens:{total:l,text:l-c,reasoning:c},raw:t}}function ake({prompt:t,systemMessageMode:e="system"}){var n;const r=[],i=[];for(const{role:a,content:s}of t)switch(a){case"system":{switch(e){case"system":{r.push({role:"system",content:s});break}case"developer":{r.push({role:"developer",content:s});break}case"remove":{i.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=e;throw new Error(`Unsupported system message mode: ${o}`)}}break}case"user":{if(s.length===1&&s[0].type==="text"){r.push({role:"user",content:s[0].text});break}r.push({role:"user",content:s.map((o,l)=>{var u,c,d;switch(o.type){case"text":return{type:"text",text:o.text};case"file":if(o.mediaType.startsWith("image/")){const h=o.mediaType==="image/*"?"image/jpeg":o.mediaType;return{type:"image_url",image_url:{url:o.data instanceof URL?o.data.toString():`data:${h};base64,${oa(o.data)}`,detail:(c=(u=o.providerOptions)==null?void 0:u.openai)==null?void 0:c.imageDetail}}}else if(o.mediaType.startsWith("audio/")){if(o.data instanceof URL)throw new Nn({functionality:"audio file parts with URLs"});switch(o.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:oa(o.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:oa(o.data),format:"mp3"}};default:throw new Nn({functionality:`audio content parts with media type ${o.mediaType}`})}}else if(o.mediaType==="application/pdf"){if(o.data instanceof URL)throw new Nn({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof o.data=="string"&&o.data.startsWith("file-")?{file_id:o.data}:{filename:(d=o.filename)!=null?d:`part-${l}.pdf`,file_data:`data:application/pdf;base64,${oa(o.data)}`}}}else throw new Nn({functionality:`file part media type ${o.mediaType}`})}})});break}case"assistant":{let o="";const l=[];for(const u of s)switch(u.type){case"text":{o+=u.text;break}case"tool-call":{l.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.input)}});break}}r.push({role:"assistant",content:o,tool_calls:l.length>0?l:void 0});break}case"tool":{for(const o of s){if(o.type==="tool-approval-response")continue;const l=o.output;let u;switch(l.type){case"text":case"error-text":u=l.value;break;case"execution-denied":u=(n=l.reason)!=null?n:"Tool execution denied.";break;case"content":case"json":case"error-json":u=JSON.stringify(l.value);break}r.push({role:"tool",tool_call_id:o.toolCallId,content:u})}break}default:{const o=a;throw new Error(`Unsupported role: ${o}`)}}return{messages:r,warnings:i}}function eT({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n?new Date(n*1e3):void 0}}function qB(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var ske=at(()=>it(B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({message:B({role:ae("assistant").nullish(),content:A().nullish(),tool_calls:Ce(B({id:A().nullish(),type:ae("function"),function:B({name:A(),arguments:A()})})).nullish(),annotations:Ce(B({type:ae("url_citation"),url_citation:B({start_index:ie(),end_index:ie(),url:A(),title:A()})})).nullish()}),index:ie(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}).nullish(),finish_reason:A().nullish()})),usage:B({prompt_tokens:ie().nullish(),completion_tokens:ie().nullish(),total_tokens:ie().nullish(),prompt_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),completion_tokens_details:B({reasoning_tokens:ie().nullish(),accepted_prediction_tokens:ie().nullish(),rejected_prediction_tokens:ie().nullish()}).nullish()}).nullish()}))),oke=at(()=>it(vt([B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({delta:B({role:wt(["assistant"]).nullish(),content:A().nullish(),tool_calls:Ce(B({index:ie(),id:A().nullish(),type:ae("function").nullish(),function:B({name:A().nullish(),arguments:A().nullish()})})).nullish(),annotations:Ce(B({type:ae("url_citation"),url_citation:B({start_index:ie(),end_index:ie(),url:A(),title:A()})})).nullish()}).nullish(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}).nullish(),finish_reason:A().nullish(),index:ie()})),usage:B({prompt_tokens:ie().nullish(),completion_tokens:ie().nullish(),total_tokens:ie().nullish(),prompt_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),completion_tokens_details:B({reasoning_tokens:ie().nullish(),accepted_prediction_tokens:ie().nullish(),rejected_prediction_tokens:ie().nullish()}).nullish()}).nullish()}),dR]))),lke=at(()=>it(B({logitBias:sn(_Q(),ie()).optional(),logprobs:vt([Ot(),ie()]).optional(),parallelToolCalls:Ot().optional(),user:A().optional(),reasoningEffort:wt(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:ie().optional(),store:Ot().optional(),metadata:sn(A().max(64),A().max(512)).optional(),prediction:sn(A(),gr()).optional(),serviceTier:wt(["auto","flex","priority","default"]).optional(),strictJsonSchema:Ot().optional(),textVerbosity:wt(["low","medium","high"]).optional(),promptCacheKey:A().optional(),promptCacheRetention:wt(["in_memory","24h"]).optional(),safetyIdentifier:A().optional(),systemMessageMode:wt(["system","developer","remove"]).optional(),forceReasoning:Ot().optional()})));function uke({tools:t,toolChoice:e}){t=t?.length?t:void 0;const n=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const a of t)switch(a.type){case"function":r.push({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema,...a.strict!=null?{strict:a.strict}:{}}});break;default:n.push({type:"unsupported",feature:`tool type: ${a.type}`});break}if(e==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const i=e.type;switch(i){case"auto":case"none":case"required":return{tools:r,toolChoice:i,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:e.toolName}},toolWarnings:n};default:{const a=i;throw new Nn({functionality:`tool choice type: ${a}`})}}}var cke=class{constructor(e,n){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=n}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:n,temperature:r,topP:i,topK:a,frequencyPenalty:s,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,tools:d,toolChoice:h,providerOptions:f}){var m,x,b,y,w;const _=[],S=(m=await sr({provider:"openai",providerOptions:f,schema:lke}))!=null?m:{},M=mte(this.modelId),E=(x=S.forceReasoning)!=null?x:M.isReasoningModel;a!=null&&_.push({type:"unsupported",feature:"topK"});const{messages:C,warnings:R}=ake({prompt:e,systemMessageMode:(b=S.systemMessageMode)!=null?b:E?"developer":M.systemMessageMode});_.push(...R);const k=(y=S.strictJsonSchema)!=null?y:!0,I={model:this.modelId,logit_bias:S.logitBias,logprobs:S.logprobs===!0||typeof S.logprobs=="number"?!0:void 0,top_logprobs:typeof S.logprobs=="number"?S.logprobs:typeof S.logprobs=="boolean"&&S.logprobs?0:void 0,user:S.user,parallel_tool_calls:S.parallelToolCalls,max_tokens:n,temperature:r,top_p:i,frequency_penalty:s,presence_penalty:o,response_format:u?.type==="json"?u.schema!=null?{type:"json_schema",json_schema:{schema:u.schema,strict:k,name:(w=u.name)!=null?w:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,verbosity:S.textVerbosity,max_completion_tokens:S.maxCompletionTokens,store:S.store,metadata:S.metadata,prediction:S.prediction,reasoning_effort:S.reasoningEffort,service_tier:S.serviceTier,prompt_cache_key:S.promptCacheKey,prompt_cache_retention:S.promptCacheRetention,safety_identifier:S.safetyIdentifier,messages:C};E?((S.reasoningEffort!=="none"||!M.supportsNonReasoningParameters)&&(I.temperature!=null&&(I.temperature=void 0,_.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),I.top_p!=null&&(I.top_p=void 0,_.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"})),I.logprobs!=null&&(I.logprobs=void 0,_.push({type:"other",message:"logprobs is not supported for reasoning models"}))),I.frequency_penalty!=null&&(I.frequency_penalty=void 0,_.push({type:"unsupported",feature:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),I.presence_penalty!=null&&(I.presence_penalty=void 0,_.push({type:"unsupported",feature:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),I.logit_bias!=null&&(I.logit_bias=void 0,_.push({type:"other",message:"logitBias is not supported for reasoning models"})),I.top_logprobs!=null&&(I.top_logprobs=void 0,_.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),I.max_tokens!=null&&(I.max_completion_tokens==null&&(I.max_completion_tokens=I.max_tokens),I.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&I.temperature!=null&&(I.temperature=void 0,_.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),S.serviceTier==="flex"&&!M.supportsFlexProcessing&&(_.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),I.service_tier=void 0),S.serviceTier==="priority"&&!M.supportsPriorityProcessing&&(_.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),I.service_tier=void 0);const{tools:N,toolChoice:D,toolWarnings:F}=uke({tools:d,toolChoice:h});return{args:{...I,tools:N,tool_choice:D},warnings:[..._,...F]}}async doGenerate(e){var n,r,i,a,s,o,l;const{args:u,warnings:c}=await this.getArgs(e),{responseHeaders:d,value:h,rawValue:f}=await Fn({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:u,failedResponseHandler:rl,successfulResponseHandler:vr(ske),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=h.choices[0],x=[],b=m.message.content;b!=null&&b.length>0&&x.push({type:"text",text:b});for(const _ of(n=m.message.tool_calls)!=null?n:[])x.push({type:"tool-call",toolCallId:(r=_.id)!=null?r:Ln(),toolName:_.function.name,input:_.function.arguments});for(const _ of(i=m.message.annotations)!=null?i:[])x.push({type:"source",sourceType:"url",id:Ln(),url:_.url_citation.url,title:_.url_citation.title});const y=(a=h.usage)==null?void 0:a.completion_tokens_details;(s=h.usage)==null||s.prompt_tokens_details;const w={openai:{}};return y?.accepted_prediction_tokens!=null&&(w.openai.acceptedPredictionTokens=y?.accepted_prediction_tokens),y?.rejected_prediction_tokens!=null&&(w.openai.rejectedPredictionTokens=y?.rejected_prediction_tokens),((o=m.logprobs)==null?void 0:o.content)!=null&&(w.openai.logprobs=m.logprobs.content),{content:x,finishReason:{unified:qB(m.finish_reason),raw:(l=m.finish_reason)!=null?l:void 0},usage:VB(h.usage),request:{body:u},response:{...eT(h),headers:d,body:f},warnings:c,providerMetadata:w}}async doStream(e){const{args:n,warnings:r}=await this.getArgs(e),i={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:s}=await Fn({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:i,failedResponseHandler:rl,successfulResponseHandler:Xu(oke),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=[];let l={unified:"other",raw:void 0},u,c=!1,d=!1;const h={openai:{}};return{stream:s.pipeThrough(new TransformStream({start(f){f.enqueue({type:"stream-start",warnings:r})},transform(f,m){var x,b,y,w,_,S,M,E,C,R,k,I,N,D,F,L,U;if(e.includeRawChunks&&m.enqueue({type:"raw",rawValue:f.rawValue}),!f.success){l={unified:"error",raw:void 0},m.enqueue({type:"error",error:f.error});return}const j=f.value;if("error"in j){l={unified:"error",raw:void 0},m.enqueue({type:"error",error:j.error});return}if(!c){const Q=eT(j);Object.values(Q).some(Boolean)&&(c=!0,m.enqueue({type:"response-metadata",...eT(j)}))}j.usage!=null&&(u=j.usage,((x=j.usage.completion_tokens_details)==null?void 0:x.accepted_prediction_tokens)!=null&&(h.openai.acceptedPredictionTokens=(b=j.usage.completion_tokens_details)==null?void 0:b.accepted_prediction_tokens),((y=j.usage.completion_tokens_details)==null?void 0:y.rejected_prediction_tokens)!=null&&(h.openai.rejectedPredictionTokens=(w=j.usage.completion_tokens_details)==null?void 0:w.rejected_prediction_tokens));const q=j.choices[0];if(q?.finish_reason!=null&&(l={unified:qB(q.finish_reason),raw:q.finish_reason}),((_=q?.logprobs)==null?void 0:_.content)!=null&&(h.openai.logprobs=q.logprobs.content),q?.delta==null)return;const Z=q.delta;if(Z.content!=null&&(d||(m.enqueue({type:"text-start",id:"0"}),d=!0),m.enqueue({type:"text-delta",id:"0",delta:Z.content})),Z.tool_calls!=null)for(const Q of Z.tool_calls){const z=Q.index;if(o[z]==null){if(Q.type!=="function")throw new Hh({data:Q,message:"Expected 'function' type."});if(Q.id==null)throw new Hh({data:Q,message:"Expected 'id' to be a string."});if(((S=Q.function)==null?void 0:S.name)==null)throw new Hh({data:Q,message:"Expected 'function.name' to be a string."});m.enqueue({type:"tool-input-start",id:Q.id,toolName:Q.function.name}),o[z]={id:Q.id,type:"function",function:{name:Q.function.name,arguments:(M=Q.function.arguments)!=null?M:""},hasFinished:!1};const X=o[z];((E=X.function)==null?void 0:E.name)!=null&&((C=X.function)==null?void 0:C.arguments)!=null&&(X.function.arguments.length>0&&m.enqueue({type:"tool-input-delta",id:X.id,delta:X.function.arguments}),gw(X.function.arguments)&&(m.enqueue({type:"tool-input-end",id:X.id}),m.enqueue({type:"tool-call",toolCallId:(R=X.id)!=null?R:Ln(),toolName:X.function.name,input:X.function.arguments}),X.hasFinished=!0));continue}const W=o[z];W.hasFinished||(((k=Q.function)==null?void 0:k.arguments)!=null&&(W.function.arguments+=(N=(I=Q.function)==null?void 0:I.arguments)!=null?N:""),m.enqueue({type:"tool-input-delta",id:W.id,delta:(D=Q.function.arguments)!=null?D:""}),((F=W.function)==null?void 0:F.name)!=null&&((L=W.function)==null?void 0:L.arguments)!=null&&gw(W.function.arguments)&&(m.enqueue({type:"tool-input-end",id:W.id}),m.enqueue({type:"tool-call",toolCallId:(U=W.id)!=null?U:Ln(),toolName:W.function.name,input:W.function.arguments}),W.hasFinished=!0))}if(Z.annotations!=null)for(const Q of Z.annotations)m.enqueue({type:"source",sourceType:"url",id:Ln(),url:Q.url_citation.url,title:Q.url_citation.title})},flush(f){d&&f.enqueue({type:"text-end",id:"0"}),f.enqueue({type:"finish",finishReason:l,usage:VB(u),...h!=null?{providerMetadata:h}:{}})}})),request:{body:i},response:{headers:a}}}};function GB(t){var e,n,r,i;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=(e=t.prompt_tokens)!=null?e:0,s=(n=t.completion_tokens)!=null?n:0;return{inputTokens:{total:(r=t.prompt_tokens)!=null?r:void 0,noCache:a,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:(i=t.completion_tokens)!=null?i:void 0,text:s,reasoning:void 0},raw:t}}function dke({prompt:t,user:e="user",assistant:n="assistant"}){let r="";t[0].role==="system"&&(r+=`${t[0].content}

`,t=t.slice(1));for(const{role:i,content:a}of t)switch(i){case"system":throw new Mu({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const s=a.map(o=>{switch(o.type){case"text":return o.text}}).filter(Boolean).join("");r+=`${e}:
${s}

`;break}case"assistant":{const s=a.map(o=>{switch(o.type){case"text":return o.text;case"tool-call":throw new Nn({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${s}

`;break}case"tool":throw new Nn({functionality:"tool messages"});default:{const s=i;throw new Error(`Unsupported role: ${s}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${e}:`]}}function WB({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function YB(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var hke=at(()=>it(B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({text:A(),finish_reason:A(),logprobs:B({tokens:Ce(A()),token_logprobs:Ce(ie()),top_logprobs:Ce(sn(A(),ie())).nullish()}).nullish()})),usage:B({prompt_tokens:ie(),completion_tokens:ie(),total_tokens:ie()}).nullish()}))),fke=at(()=>it(vt([B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({text:A(),finish_reason:A().nullish(),index:ie(),logprobs:B({tokens:Ce(A()),token_logprobs:Ce(ie()),top_logprobs:Ce(sn(A(),ie())).nullish()}).nullish()})),usage:B({prompt_tokens:ie(),completion_tokens:ie(),total_tokens:ie()}).nullish()}),dR]))),XB=at(()=>it(B({echo:Ot().optional(),logitBias:sn(A(),ie()).optional(),suffix:A().optional(),user:A().optional(),logprobs:vt([Ot(),ie()]).optional()}))),pke=class{constructor(e,n){this.specificationVersion="v3",this.supportedUrls={},this.modelId=e,this.config=n}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:n,temperature:r,topP:i,topK:a,frequencyPenalty:s,presencePenalty:o,stopSequences:l,responseFormat:u,tools:c,toolChoice:d,seed:h,providerOptions:f}){const m=[],x={...await sr({provider:"openai",providerOptions:f,schema:XB}),...await sr({provider:this.providerOptionsName,providerOptions:f,schema:XB})};a!=null&&m.push({type:"unsupported",feature:"topK"}),c?.length&&m.push({type:"unsupported",feature:"tools"}),d!=null&&m.push({type:"unsupported",feature:"toolChoice"}),u!=null&&u.type!=="text"&&m.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:b,stopSequences:y}=dke({prompt:e}),w=[...y??[],...l??[]];return{args:{model:this.modelId,echo:x.echo,logit_bias:x.logitBias,logprobs:x?.logprobs===!0?0:x?.logprobs===!1?void 0:x?.logprobs,suffix:x.suffix,user:x.user,max_tokens:n,temperature:r,top_p:i,frequency_penalty:s,presence_penalty:o,seed:h,prompt:b,stop:w.length>0?w:void 0},warnings:m}}async doGenerate(e){var n;const{args:r,warnings:i}=await this.getArgs(e),{responseHeaders:a,value:s,rawValue:o}=await Fn({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:r,failedResponseHandler:rl,successfulResponseHandler:vr(hke),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=s.choices[0],u={openai:{}};return l.logprobs!=null&&(u.openai.logprobs=l.logprobs),{content:[{type:"text",text:l.text}],usage:GB(s.usage),finishReason:{unified:YB(l.finish_reason),raw:(n=l.finish_reason)!=null?n:void 0},request:{body:r},response:{...WB(s),headers:a,body:o},providerMetadata:u,warnings:i}}async doStream(e){const{args:n,warnings:r}=await this.getArgs(e),i={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:s}=await Fn({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:i,failedResponseHandler:rl,successfulResponseHandler:Xu(fke),abortSignal:e.abortSignal,fetch:this.config.fetch});let o={unified:"other",raw:void 0};const l={openai:{}};let u,c=!0;return{stream:s.pipeThrough(new TransformStream({start(d){d.enqueue({type:"stream-start",warnings:r})},transform(d,h){if(e.includeRawChunks&&h.enqueue({type:"raw",rawValue:d.rawValue}),!d.success){o={unified:"error",raw:void 0},h.enqueue({type:"error",error:d.error});return}const f=d.value;if("error"in f){o={unified:"error",raw:void 0},h.enqueue({type:"error",error:f.error});return}c&&(c=!1,h.enqueue({type:"response-metadata",...WB(f)}),h.enqueue({type:"text-start",id:"0"})),f.usage!=null&&(u=f.usage);const m=f.choices[0];m?.finish_reason!=null&&(o={unified:YB(m.finish_reason),raw:m.finish_reason}),m?.logprobs!=null&&(l.openai.logprobs=m.logprobs),m?.text!=null&&m.text.length>0&&h.enqueue({type:"text-delta",id:"0",delta:m.text})},flush(d){c||d.enqueue({type:"text-end",id:"0"}),d.enqueue({type:"finish",finishReason:o,providerMetadata:l,usage:GB(u)})}})),request:{body:i},response:{headers:a}}}},mke=at(()=>it(B({dimensions:ie().optional(),user:A().optional()}))),gke=at(()=>it(B({data:Ce(B({embedding:Ce(ie())})),usage:B({prompt_tokens:ie()}).nullish()}))),vke=class{constructor(e,n){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=n}get provider(){return this.config.provider}async doEmbed({values:e,headers:n,abortSignal:r,providerOptions:i}){var a;if(e.length>this.maxEmbeddingsPerCall)throw new Tv({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const s=(a=await sr({provider:"openai",providerOptions:i,schema:mke}))!=null?a:{},{responseHeaders:o,value:l,rawValue:u}=await Fn({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Mn(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:s.dimensions,user:s.user},failedResponseHandler:rl,successfulResponseHandler:vr(gke),abortSignal:r,fetch:this.config.fetch});return{warnings:[],embeddings:l.data.map(c=>c.embedding),usage:l.usage?{tokens:l.usage.prompt_tokens}:void 0,response:{headers:o,body:u}}}},KB=at(()=>it(B({created:ie().nullish(),data:Ce(B({b64_json:A(),revised_prompt:A().nullish()})),background:A().nullish(),output_format:A().nullish(),size:A().nullish(),quality:A().nullish(),usage:B({input_tokens:ie().nullish(),output_tokens:ie().nullish(),total_tokens:ie().nullish(),input_tokens_details:B({image_tokens:ie().nullish(),text_tokens:ie().nullish()}).nullish()}).nullish()}))),yke={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},xke=["gpt-image-1-mini","gpt-image-1.5","gpt-image-1"];function bke(t){return xke.some(e=>t.startsWith(e))}var _ke=class{constructor(e,n){this.modelId=e,this.config=n,this.specificationVersion="v3"}get maxImagesPerCall(){var e;return(e=yke[this.modelId])!=null?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,files:n,mask:r,n:i,size:a,aspectRatio:s,seed:o,providerOptions:l,headers:u,abortSignal:c}){var d,h,f,m,x,b,y,w,_,S,M;const E=[];s!=null&&E.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),o!=null&&E.push({type:"unsupported",feature:"seed"});const C=(f=(h=(d=this.config._internal)==null?void 0:d.currentDate)==null?void 0:h.call(d))!=null?f:new Date;if(n!=null){const{value:I,responseHeaders:N}=await s3({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:Mn(this.config.headers(),u),formData:wQ({model:this.modelId,prompt:e,image:await Promise.all(n.map(D=>D.type==="file"?new Blob([D.data instanceof Uint8Array?new Blob([D.data],{type:D.mediaType}):new Blob([Yu(D.data)],{type:D.mediaType})],{type:D.mediaType}):r3(D.url))),mask:r!=null?await wke(r):void 0,n:i,size:a,...(m=l.openai)!=null?m:{}}),failedResponseHandler:rl,successfulResponseHandler:vr(KB),abortSignal:c,fetch:this.config.fetch});return{images:I.data.map(D=>D.b64_json),warnings:E,usage:I.usage!=null?{inputTokens:(x=I.usage.input_tokens)!=null?x:void 0,outputTokens:(b=I.usage.output_tokens)!=null?b:void 0,totalTokens:(y=I.usage.total_tokens)!=null?y:void 0}:void 0,response:{timestamp:C,modelId:this.modelId,headers:N},providerMetadata:{openai:{images:I.data.map(D=>{var F,L,U,j,q;return{...D.revised_prompt?{revisedPrompt:D.revised_prompt}:{},created:(F=I.created)!=null?F:void 0,size:(L=I.size)!=null?L:void 0,quality:(U=I.quality)!=null?U:void 0,background:(j=I.background)!=null?j:void 0,outputFormat:(q=I.output_format)!=null?q:void 0}})}}}}const{value:R,responseHeaders:k}=await Fn({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Mn(this.config.headers(),u),body:{model:this.modelId,prompt:e,n:i,size:a,...(w=l.openai)!=null?w:{},...bke(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:rl,successfulResponseHandler:vr(KB),abortSignal:c,fetch:this.config.fetch});return{images:R.data.map(I=>I.b64_json),warnings:E,usage:R.usage!=null?{inputTokens:(_=R.usage.input_tokens)!=null?_:void 0,outputTokens:(S=R.usage.output_tokens)!=null?S:void 0,totalTokens:(M=R.usage.total_tokens)!=null?M:void 0}:void 0,response:{timestamp:C,modelId:this.modelId,headers:k},providerMetadata:{openai:{images:R.data.map(I=>{var N,D,F,L,U;return{...I.revised_prompt?{revisedPrompt:I.revised_prompt}:{},created:(N=R.created)!=null?N:void 0,size:(D=R.size)!=null?D:void 0,quality:(F=R.quality)!=null?F:void 0,background:(L=R.background)!=null?L:void 0,outputFormat:(U=R.output_format)!=null?U:void 0}})}}}}};async function wke(t){if(!t)return;if(t.type==="url")return r3(t.url);const e=t.data instanceof Uint8Array?t.data:Yu(t.data);return new Blob([e],{type:t.mediaType})}var Ske=at(()=>it(B({callId:A(),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}))),gte=at(()=>it(B({status:wt(["completed","failed"]),output:A().optional()}))),Eke=Fr({id:"openai.apply_patch",inputSchema:Ske,outputSchema:gte}),Tke=Eke,Cke=at(()=>it(B({code:A().nullish(),containerId:A()}))),Mke=at(()=>it(B({outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullish()}))),Ake=at(()=>it(B({container:vt([A(),B({fileIds:Ce(A()).optional()})]).optional()}))),kke=Fr({id:"openai.code_interpreter",inputSchema:Cke,outputSchema:Mke}),Ike=(t={})=>kke(t),vte=B({key:A(),type:wt(["eq","ne","gt","gte","lt","lte","in","nin"]),value:vt([A(),ie(),Ot(),Ce(A())])}),yte=B({type:wt(["and","or"]),filters:Ce(vt([vte,Cv(()=>yte)]))}),Nke=at(()=>it(B({vectorStoreIds:Ce(A()),maxNumResults:ie().optional(),ranking:B({ranker:A().optional(),scoreThreshold:ie().optional()}).optional(),filters:vt([vte,yte]).optional()}))),Rke=at(()=>it(B({queries:Ce(A()),results:Ce(B({attributes:sn(A(),Zn()),fileId:A(),filename:A(),score:ie(),text:A()})).nullable()}))),Pke=Fr({id:"openai.file_search",inputSchema:B({}),outputSchema:Rke}),Dke=at(()=>it(B({background:wt(["auto","opaque","transparent"]).optional(),inputFidelity:wt(["low","high"]).optional(),inputImageMask:B({fileId:A().optional(),imageUrl:A().optional()}).optional(),model:A().optional(),moderation:wt(["auto"]).optional(),outputCompression:ie().int().min(0).max(100).optional(),outputFormat:wt(["png","jpeg","webp"]).optional(),partialImages:ie().int().min(0).max(3).optional(),quality:wt(["auto","low","medium","high"]).optional(),size:wt(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),Oke=at(()=>it(B({}))),Lke=at(()=>it(B({result:A()}))),Fke=Fr({id:"openai.image_generation",inputSchema:Oke,outputSchema:Lke}),Bke=(t={})=>Fke(t),xte=at(()=>it(B({action:B({type:ae("exec"),command:Ce(A()),timeoutMs:ie().optional(),user:A().optional(),workingDirectory:A().optional(),env:sn(A(),A()).optional()})}))),bte=at(()=>it(B({output:A()}))),Uke=Fr({id:"openai.local_shell",inputSchema:xte,outputSchema:bte}),_te=at(()=>it(B({action:B({commands:Ce(A()),timeoutMs:ie().optional(),maxOutputLength:ie().optional()})}))),wte=at(()=>it(B({output:Ce(B({stdout:A(),stderr:A(),outcome:Zt("type",[B({type:ae("timeout")}),B({type:ae("exit"),exitCode:ie()})])}))}))),zke=Fr({id:"openai.shell",inputSchema:_te,outputSchema:wte}),jke=at(()=>it(B({externalWebAccess:Ot().optional(),filters:B({allowedDomains:Ce(A()).optional()}).optional(),searchContextSize:wt(["low","medium","high"]).optional(),userLocation:B({type:ae("approximate"),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),Hke=at(()=>it(B({}))),$ke=at(()=>it(B({action:Zt("type",[B({type:ae("search"),query:A().optional()}),B({type:ae("openPage"),url:A().nullish()}),B({type:ae("findInPage"),url:A().nullish(),pattern:A().nullish()})]),sources:Ce(Zt("type",[B({type:ae("url"),url:A()}),B({type:ae("api"),name:A()})])).optional()}))),Vke=Fr({id:"openai.web_search",inputSchema:Hke,outputSchema:$ke}),qke=(t={})=>Vke(t),Gke=at(()=>it(B({searchContextSize:wt(["low","medium","high"]).optional(),userLocation:B({type:ae("approximate"),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),Wke=at(()=>it(B({}))),Yke=at(()=>it(B({action:Zt("type",[B({type:ae("search"),query:A().optional()}),B({type:ae("openPage"),url:A().nullish()}),B({type:ae("findInPage"),url:A().nullish(),pattern:A().nullish()})])}))),Xke=Fr({id:"openai.web_search_preview",inputSchema:Wke,outputSchema:Yke}),SI=Cv(()=>vt([A(),ie(),Ot(),V8(),Ce(SI),sn(A(),SI)])),Kke=at(()=>it(B({serverLabel:A(),allowedTools:vt([Ce(A()),B({readOnly:Ot().optional(),toolNames:Ce(A()).optional()})]).optional(),authorization:A().optional(),connectorId:A().optional(),headers:sn(A(),A()).optional(),requireApproval:vt([wt(["always","never"]),B({never:B({toolNames:Ce(A()).optional()}).optional()})]).optional(),serverDescription:A().optional(),serverUrl:A().optional()}).refine(t=>t.serverUrl!=null||t.connectorId!=null,"One of serverUrl or connectorId must be provided."))),Zke=at(()=>it(B({}))),Jke=at(()=>it(B({type:ae("call"),serverLabel:A(),name:A(),arguments:A(),output:A().nullish(),error:vt([A(),SI]).optional()}))),Qke=Fr({id:"openai.mcp",inputSchema:Zke,outputSchema:Jke}),e6e=t=>Qke(t),t6e={applyPatch:Tke,codeInterpreter:Ike,fileSearch:Pke,imageGeneration:Bke,localShell:Uke,shell:zke,webSearchPreview:Xke,webSearch:qke,mcp:e6e};function ZB(t){var e,n,r,i;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=t.input_tokens,s=t.output_tokens,o=(n=(e=t.input_tokens_details)==null?void 0:e.cached_tokens)!=null?n:0,l=(i=(r=t.output_tokens_details)==null?void 0:r.reasoning_tokens)!=null?i:0;return{inputTokens:{total:a,noCache:a-o,cacheRead:o,cacheWrite:void 0},outputTokens:{total:s,text:s-l,reasoning:l},raw:t}}function JB(t,e){return e?e.some(n=>t.startsWith(n)):!1}async function n6e({prompt:t,toolNameMapping:e,systemMessageMode:n,providerOptionsName:r,fileIdPrefixes:i,store:a,hasLocalShellTool:s=!1,hasShellTool:o=!1,hasApplyPatchTool:l=!1}){var u,c,d,h,f,m,x,b,y,w,_,S,M;const E=[],C=[],R=new Set;for(const{role:k,content:I}of t)switch(k){case"system":{switch(n){case"system":{E.push({role:"system",content:I});break}case"developer":{E.push({role:"developer",content:I});break}case"remove":{C.push({type:"other",message:"system messages are removed for this model"});break}default:{const N=n;throw new Error(`Unsupported system message mode: ${N}`)}}break}case"user":{E.push({role:"user",content:I.map((N,D)=>{var F,L,U;switch(N.type){case"text":return{type:"input_text",text:N.text};case"file":if(N.mediaType.startsWith("image/")){const j=N.mediaType==="image/*"?"image/jpeg":N.mediaType;return{type:"input_image",...N.data instanceof URL?{image_url:N.data.toString()}:typeof N.data=="string"&&JB(N.data,i)?{file_id:N.data}:{image_url:`data:${j};base64,${oa(N.data)}`},detail:(L=(F=N.providerOptions)==null?void 0:F[r])==null?void 0:L.imageDetail}}else{if(N.mediaType==="application/pdf")return N.data instanceof URL?{type:"input_file",file_url:N.data.toString()}:{type:"input_file",...typeof N.data=="string"&&JB(N.data,i)?{file_id:N.data}:{filename:(U=N.filename)!=null?U:`part-${D}.pdf`,file_data:`data:application/pdf;base64,${oa(N.data)}`}};throw new Nn({functionality:`file part media type ${N.mediaType}`})}}})});break}case"assistant":{const N={};for(const D of I)switch(D.type){case"text":{const F=(c=(u=D.providerOptions)==null?void 0:u[r])==null?void 0:c.itemId;if(a&&F!=null){E.push({type:"item_reference",id:F});break}E.push({role:"assistant",content:[{type:"output_text",text:D.text}],id:F});break}case"tool-call":{const F=(x=(h=(d=D.providerOptions)==null?void 0:d[r])==null?void 0:h.itemId)!=null?x:(m=(f=D.providerMetadata)==null?void 0:f[r])==null?void 0:m.itemId;if(D.providerExecuted){a&&F!=null&&E.push({type:"item_reference",id:F});break}if(a&&F!=null){E.push({type:"item_reference",id:F});break}const L=e.toProviderToolName(D.toolName);if(s&&L==="local_shell"){const U=await Kn({value:D.input,schema:xte});E.push({type:"local_shell_call",call_id:D.toolCallId,id:F,action:{type:"exec",command:U.action.command,timeout_ms:U.action.timeoutMs,user:U.action.user,working_directory:U.action.workingDirectory,env:U.action.env}});break}if(o&&L==="shell"){const U=await Kn({value:D.input,schema:_te});E.push({type:"shell_call",call_id:D.toolCallId,id:F,status:"completed",action:{commands:U.action.commands,timeout_ms:U.action.timeoutMs,max_output_length:U.action.maxOutputLength}});break}E.push({type:"function_call",call_id:D.toolCallId,name:L,arguments:JSON.stringify(D.input),id:F});break}case"tool-result":{if(D.output.type==="execution-denied"||D.output.type==="json"&&typeof D.output.value=="object"&&D.output.value!=null&&"type"in D.output.value&&D.output.value.type==="execution-denied")break;if(a){const F=(w=(y=(b=D.providerMetadata)==null?void 0:b[r])==null?void 0:y.itemId)!=null?w:D.toolCallId;E.push({type:"item_reference",id:F})}else C.push({type:"other",message:`Results for OpenAI tool ${D.toolName} are not sent to the API when store is false`});break}case"reasoning":{const F=await sr({provider:r,providerOptions:D.providerOptions,schema:r6e}),L=F?.itemId;if(L!=null){const U=N[L];if(a)U===void 0&&(E.push({type:"item_reference",id:L}),N[L]={type:"reasoning",id:L,summary:[]});else{const j=[];D.text.length>0?j.push({type:"summary_text",text:D.text}):U!==void 0&&C.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(D)}.`}),U===void 0?(N[L]={type:"reasoning",id:L,encrypted_content:F?.reasoningEncryptedContent,summary:j},E.push(N[L])):(U.summary.push(...j),F?.reasoningEncryptedContent!=null&&(U.encrypted_content=F.reasoningEncryptedContent))}}else C.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(D)}.`});break}}break}case"tool":{for(const N of I){if(N.type==="tool-approval-response"){const U=N;if(R.has(U.approvalId))continue;R.add(U.approvalId),a&&E.push({type:"item_reference",id:U.approvalId}),E.push({type:"mcp_approval_response",approval_request_id:U.approvalId,approve:U.approved});continue}const D=N.output;if(D.type==="execution-denied"&&((S=(_=D.providerOptions)==null?void 0:_.openai)==null?void 0:S.approvalId))continue;const F=e.toProviderToolName(N.toolName);if(s&&F==="local_shell"&&D.type==="json"){const U=await Kn({value:D.value,schema:bte});E.push({type:"local_shell_call_output",call_id:N.toolCallId,output:U.output});continue}if(o&&F==="shell"&&D.type==="json"){const U=await Kn({value:D.value,schema:wte});E.push({type:"shell_call_output",call_id:N.toolCallId,output:U.output.map(j=>({stdout:j.stdout,stderr:j.stderr,outcome:j.outcome.type==="timeout"?{type:"timeout"}:{type:"exit",exit_code:j.outcome.exitCode}}))});continue}if(l&&N.toolName==="apply_patch"&&D.type==="json"){const U=await Kn({value:D.value,schema:gte});E.push({type:"apply_patch_call_output",call_id:N.toolCallId,status:U.status,output:U.output});continue}let L;switch(D.type){case"text":case"error-text":L=D.value;break;case"execution-denied":L=(M=D.reason)!=null?M:"Tool execution denied.";break;case"json":case"error-json":L=JSON.stringify(D.value);break;case"content":L=D.value.map(U=>{var j;switch(U.type){case"text":return{type:"input_text",text:U.text};case"image-data":return{type:"input_image",image_url:`data:${U.mediaType};base64,${U.data}`};case"image-url":return{type:"input_image",image_url:U.url};case"file-data":return{type:"input_file",filename:(j=U.filename)!=null?j:"data",file_data:`data:${U.mediaType};base64,${U.data}`};default:{C.push({type:"other",message:`unsupported tool content part type: ${U.type}`});return}}}).filter(X8);break}E.push({type:"function_call_output",call_id:N.toolCallId,output:L})}break}default:{const N=k;throw new Error(`Unsupported role: ${N}`)}}return{input:E,warnings:C}}var r6e=B({itemId:A().nullish(),reasoningEncryptedContent:A().nullish()});function QB({finishReason:t,hasFunctionCall:e}){switch(t){case void 0:case null:return e?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return e?"tool-calls":"other"}}var i6e=at(()=>it(vt([B({type:ae("response.output_text.delta"),item_id:A(),delta:A(),logprobs:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}),B({type:wt(["response.completed","response.incomplete"]),response:B({incomplete_details:B({reason:A()}).nullish(),usage:B({input_tokens:ie(),input_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),output_tokens:ie(),output_tokens_details:B({reasoning_tokens:ie().nullish()}).nullish()}),service_tier:A().nullish()})}),B({type:ae("response.created"),response:B({id:A(),created_at:ie(),model:A(),service_tier:A().nullish()})}),B({type:ae("response.output_item.added"),output_index:ie(),item:Zt("type",[B({type:ae("message"),id:A()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish()}),B({type:ae("function_call"),id:A(),call_id:A(),name:A(),arguments:A()}),B({type:ae("web_search_call"),id:A(),status:A()}),B({type:ae("computer_call"),id:A(),status:A()}),B({type:ae("file_search_call"),id:A()}),B({type:ae("image_generation_call"),id:A()}),B({type:ae("code_interpreter_call"),id:A(),container_id:A(),code:A().nullable(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable(),status:A()}),B({type:ae("mcp_call"),id:A(),status:A(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A()}),B({type:ae("mcp_approval_request"),id:A()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])}),B({type:ae("response.output_item.done"),output_index:ie(),item:Zt("type",[B({type:ae("message"),id:A()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish()}),B({type:ae("function_call"),id:A(),call_id:A(),name:A(),arguments:A(),status:ae("completed")}),B({type:ae("code_interpreter_call"),id:A(),code:A().nullable(),container_id:A(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable()}),B({type:ae("image_generation_call"),id:A(),result:A()}),B({type:ae("web_search_call"),id:A(),status:A(),action:Zt("type",[B({type:ae("search"),query:A().nullish(),sources:Ce(Zt("type",[B({type:ae("url"),url:A()}),B({type:ae("api"),name:A()})])).nullish()}),B({type:ae("open_page"),url:A().nullish()}),B({type:ae("find_in_page"),url:A().nullish(),pattern:A().nullish()})])}),B({type:ae("file_search_call"),id:A(),queries:Ce(A()),results:Ce(B({attributes:sn(A(),vt([A(),ie(),Ot()])),file_id:A(),filename:A(),score:ie(),text:A()})).nullish()}),B({type:ae("local_shell_call"),id:A(),call_id:A(),action:B({type:ae("exec"),command:Ce(A()),timeout_ms:ie().optional(),user:A().optional(),working_directory:A().optional(),env:sn(A(),A()).optional()})}),B({type:ae("computer_call"),id:A(),status:ae("completed")}),B({type:ae("mcp_call"),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A(),server_label:A(),tools:Ce(B({name:A(),description:A().optional(),input_schema:gr(),annotations:sn(A(),Zn()).optional()})),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).optional()}),B({type:ae("mcp_approval_request"),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])}),B({type:ae("response.function_call_arguments.delta"),item_id:A(),output_index:ie(),delta:A()}),B({type:ae("response.image_generation_call.partial_image"),item_id:A(),output_index:ie(),partial_image_b64:A()}),B({type:ae("response.code_interpreter_call_code.delta"),item_id:A(),output_index:ie(),delta:A()}),B({type:ae("response.code_interpreter_call_code.done"),item_id:A(),output_index:ie(),code:A()}),B({type:ae("response.output_text.annotation.added"),annotation:Zt("type",[B({type:ae("url_citation"),start_index:ie(),end_index:ie(),url:A(),title:A()}),B({type:ae("file_citation"),file_id:A(),filename:A(),index:ie()}),B({type:ae("container_file_citation"),container_id:A(),file_id:A(),filename:A(),start_index:ie(),end_index:ie()}),B({type:ae("file_path"),file_id:A(),index:ie()})])}),B({type:ae("response.reasoning_summary_part.added"),item_id:A(),summary_index:ie()}),B({type:ae("response.reasoning_summary_text.delta"),item_id:A(),summary_index:ie(),delta:A()}),B({type:ae("response.reasoning_summary_part.done"),item_id:A(),summary_index:ie()}),B({type:ae("response.apply_patch_call_operation_diff.delta"),item_id:A(),output_index:ie(),delta:A(),obfuscation:A().nullish()}),B({type:ae("response.apply_patch_call_operation_diff.done"),item_id:A(),output_index:ie(),diff:A()}),B({type:ae("error"),sequence_number:ie(),error:B({type:A(),code:A(),message:A(),param:A().nullish()})}),B({type:A()}).loose().transform(t=>({type:"unknown_chunk",message:t.type}))]))),a6e=at(()=>it(B({id:A().optional(),created_at:ie().optional(),error:B({message:A(),type:A(),param:A().nullish(),code:A()}).nullish(),model:A().optional(),output:Ce(Zt("type",[B({type:ae("message"),role:ae("assistant"),id:A(),content:Ce(B({type:ae("output_text"),text:A(),logprobs:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish(),annotations:Ce(Zt("type",[B({type:ae("url_citation"),start_index:ie(),end_index:ie(),url:A(),title:A()}),B({type:ae("file_citation"),file_id:A(),filename:A(),index:ie()}),B({type:ae("container_file_citation"),container_id:A(),file_id:A(),filename:A(),start_index:ie(),end_index:ie()}),B({type:ae("file_path"),file_id:A(),index:ie()})]))}))}),B({type:ae("web_search_call"),id:A(),status:A(),action:Zt("type",[B({type:ae("search"),query:A().nullish(),sources:Ce(Zt("type",[B({type:ae("url"),url:A()}),B({type:ae("api"),name:A()})])).nullish()}),B({type:ae("open_page"),url:A().nullish()}),B({type:ae("find_in_page"),url:A().nullish(),pattern:A().nullish()})])}),B({type:ae("file_search_call"),id:A(),queries:Ce(A()),results:Ce(B({attributes:sn(A(),vt([A(),ie(),Ot()])),file_id:A(),filename:A(),score:ie(),text:A()})).nullish()}),B({type:ae("code_interpreter_call"),id:A(),code:A().nullable(),container_id:A(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable()}),B({type:ae("image_generation_call"),id:A(),result:A()}),B({type:ae("local_shell_call"),id:A(),call_id:A(),action:B({type:ae("exec"),command:Ce(A()),timeout_ms:ie().optional(),user:A().optional(),working_directory:A().optional(),env:sn(A(),A()).optional()})}),B({type:ae("function_call"),call_id:A(),name:A(),arguments:A(),id:A()}),B({type:ae("computer_call"),id:A(),status:A().optional()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish(),summary:Ce(B({type:ae("summary_text"),text:A()}))}),B({type:ae("mcp_call"),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A(),server_label:A(),tools:Ce(B({name:A(),description:A().optional(),input_schema:gr(),annotations:sn(A(),Zn()).optional()})),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).optional()}),B({type:ae("mcp_approval_request"),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])).optional(),service_tier:A().nullish(),incomplete_details:B({reason:A()}).nullish(),usage:B({input_tokens:ie(),input_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),output_tokens:ie(),output_tokens_details:B({reasoning_tokens:ie().nullish()}).nullish()}).optional()}))),Ste=20,eU=at(()=>it(B({conversation:A().nullish(),include:Ce(wt(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:A().nullish(),logprobs:vt([Ot(),ie().min(1).max(Ste)]).optional(),maxToolCalls:ie().nullish(),metadata:gr().nullish(),parallelToolCalls:Ot().nullish(),previousResponseId:A().nullish(),promptCacheKey:A().nullish(),promptCacheRetention:wt(["in_memory","24h"]).nullish(),reasoningEffort:A().nullish(),reasoningSummary:A().nullish(),safetyIdentifier:A().nullish(),serviceTier:wt(["auto","flex","priority","default"]).nullish(),store:Ot().nullish(),strictJsonSchema:Ot().nullish(),textVerbosity:wt(["low","medium","high"]).nullish(),truncation:wt(["auto","disabled"]).nullish(),user:A().nullish(),systemMessageMode:wt(["system","developer","remove"]).optional(),forceReasoning:Ot().optional()})));async function s6e({tools:t,toolChoice:e}){t=t?.length?t:void 0;const n=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const a of t)switch(a.type){case"function":r.push({type:"function",name:a.name,description:a.description,parameters:a.inputSchema,...a.strict!=null?{strict:a.strict}:{}});break;case"provider":{switch(a.id){case"openai.file_search":{const s=await Kn({value:a.args,schema:Nke});r.push({type:"file_search",vector_store_ids:s.vectorStoreIds,max_num_results:s.maxNumResults,ranking_options:s.ranking?{ranker:s.ranking.ranker,score_threshold:s.ranking.scoreThreshold}:void 0,filters:s.filters});break}case"openai.local_shell":{r.push({type:"local_shell"});break}case"openai.shell":{r.push({type:"shell"});break}case"openai.apply_patch":{r.push({type:"apply_patch"});break}case"openai.web_search_preview":{const s=await Kn({value:a.args,schema:Gke});r.push({type:"web_search_preview",search_context_size:s.searchContextSize,user_location:s.userLocation});break}case"openai.web_search":{const s=await Kn({value:a.args,schema:jke});r.push({type:"web_search",filters:s.filters!=null?{allowed_domains:s.filters.allowedDomains}:void 0,external_web_access:s.externalWebAccess,search_context_size:s.searchContextSize,user_location:s.userLocation});break}case"openai.code_interpreter":{const s=await Kn({value:a.args,schema:Ake});r.push({type:"code_interpreter",container:s.container==null?{type:"auto",file_ids:void 0}:typeof s.container=="string"?s.container:{type:"auto",file_ids:s.container.fileIds}});break}case"openai.image_generation":{const s=await Kn({value:a.args,schema:Dke});r.push({type:"image_generation",background:s.background,input_fidelity:s.inputFidelity,input_image_mask:s.inputImageMask?{file_id:s.inputImageMask.fileId,image_url:s.inputImageMask.imageUrl}:void 0,model:s.model,moderation:s.moderation,partial_images:s.partialImages,quality:s.quality,output_compression:s.outputCompression,output_format:s.outputFormat,size:s.size});break}case"openai.mcp":{const s=await Kn({value:a.args,schema:Kke}),o=c=>({tool_names:c.toolNames}),l=s.requireApproval,u=l==null?void 0:typeof l=="string"?l:l.never!=null?{never:o(l.never)}:void 0;r.push({type:"mcp",server_label:s.serverLabel,allowed_tools:Array.isArray(s.allowedTools)?s.allowedTools:s.allowedTools?{read_only:s.allowedTools.readOnly,tool_names:s.allowedTools.toolNames}:void 0,authorization:s.authorization,connector_id:s.connectorId,headers:s.headers,require_approval:u??"never",server_description:s.serverDescription,server_url:s.serverUrl});break}}break}default:n.push({type:"unsupported",feature:`function tool ${a}`});break}if(e==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const i=e.type;switch(i){case"auto":case"none":case"required":return{tools:r,toolChoice:i,toolWarnings:n};case"tool":return{tools:r,toolChoice:e.toolName==="code_interpreter"||e.toolName==="file_search"||e.toolName==="image_generation"||e.toolName==="web_search_preview"||e.toolName==="web_search"||e.toolName==="mcp"||e.toolName==="apply_patch"?{type:e.toolName}:{type:"function",name:e.toolName},toolWarnings:n};default:{const a=i;throw new Nn({functionality:`tool choice type: ${a}`})}}}function tU(t){var e,n;const r={};for(const i of t)if(i.role==="assistant")for(const a of i.content){if(a.type!=="tool-call")continue;const s=(n=(e=a.providerOptions)==null?void 0:e.openai)==null?void 0:n.approvalRequestId;s!=null&&(r[s]=a.toolCallId)}return r}var o6e=class{constructor(e,n){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=n}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:n,stopSequences:r,topP:i,topK:a,presencePenalty:s,frequencyPenalty:o,seed:l,prompt:u,providerOptions:c,tools:d,toolChoice:h,responseFormat:f}){var m,x,b,y,w,_;const S=[],M=mte(this.modelId);a!=null&&S.push({type:"unsupported",feature:"topK"}),l!=null&&S.push({type:"unsupported",feature:"seed"}),s!=null&&S.push({type:"unsupported",feature:"presencePenalty"}),o!=null&&S.push({type:"unsupported",feature:"frequencyPenalty"}),r!=null&&S.push({type:"unsupported",feature:"stopSequences"});const E=this.config.provider.includes("azure")?"azure":"openai";let C=await sr({provider:E,providerOptions:c,schema:eU});C==null&&E!=="openai"&&(C=await sr({provider:"openai",providerOptions:c,schema:eU}));const R=(m=C?.forceReasoning)!=null?m:M.isReasoningModel;C?.conversation&&C?.previousResponseId&&S.push({type:"unsupported",feature:"conversation",details:"conversation and previousResponseId cannot be used together"});const k=W8({tools:d,providerToolNames:{"openai.code_interpreter":"code_interpreter","openai.file_search":"file_search","openai.image_generation":"image_generation","openai.local_shell":"local_shell","openai.shell":"shell","openai.web_search":"web_search","openai.web_search_preview":"web_search_preview","openai.mcp":"mcp","openai.apply_patch":"apply_patch"}}),{input:I,warnings:N}=await n6e({prompt:u,toolNameMapping:k,systemMessageMode:(x=C?.systemMessageMode)!=null?x:R?"developer":M.systemMessageMode,providerOptionsName:E,fileIdPrefixes:this.config.fileIdPrefixes,store:(b=C?.store)!=null?b:!0,hasLocalShellTool:U("openai.local_shell"),hasShellTool:U("openai.shell"),hasApplyPatchTool:U("openai.apply_patch")});S.push(...N);const D=(y=C?.strictJsonSchema)!=null?y:!0;let F=C?.include;function L(H){F==null?F=[H]:F.includes(H)||(F=[...F,H])}function U(H){return d?.find(J=>J.type==="provider"&&J.id===H)!=null}const j=typeof C?.logprobs=="number"?C?.logprobs:C?.logprobs===!0?Ste:void 0;j&&L("message.output_text.logprobs");const q=(w=d?.find(H=>H.type==="provider"&&(H.id==="openai.web_search"||H.id==="openai.web_search_preview")))==null?void 0:w.name;q&&L("web_search_call.action.sources"),U("openai.code_interpreter")&&L("code_interpreter_call.outputs");const Z=C?.store;Z===!1&&R&&L("reasoning.encrypted_content");const Q={model:this.modelId,input:I,temperature:n,top_p:i,max_output_tokens:e,...(f?.type==="json"||C?.textVerbosity)&&{text:{...f?.type==="json"&&{format:f.schema!=null?{type:"json_schema",strict:D,name:(_=f.name)!=null?_:"response",description:f.description,schema:f.schema}:{type:"json_object"}},...C?.textVerbosity&&{verbosity:C.textVerbosity}}},conversation:C?.conversation,max_tool_calls:C?.maxToolCalls,metadata:C?.metadata,parallel_tool_calls:C?.parallelToolCalls,previous_response_id:C?.previousResponseId,store:Z,user:C?.user,instructions:C?.instructions,service_tier:C?.serviceTier,include:F,prompt_cache_key:C?.promptCacheKey,prompt_cache_retention:C?.promptCacheRetention,safety_identifier:C?.safetyIdentifier,top_logprobs:j,truncation:C?.truncation,...R&&(C?.reasoningEffort!=null||C?.reasoningSummary!=null)&&{reasoning:{...C?.reasoningEffort!=null&&{effort:C.reasoningEffort},...C?.reasoningSummary!=null&&{summary:C.reasoningSummary}}}};R?C?.reasoningEffort==="none"&&M.supportsNonReasoningParameters||(Q.temperature!=null&&(Q.temperature=void 0,S.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),Q.top_p!=null&&(Q.top_p=void 0,S.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"}))):(C?.reasoningEffort!=null&&S.push({type:"unsupported",feature:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),C?.reasoningSummary!=null&&S.push({type:"unsupported",feature:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),C?.serviceTier==="flex"&&!M.supportsFlexProcessing&&(S.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete Q.service_tier),C?.serviceTier==="priority"&&!M.supportsPriorityProcessing&&(S.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete Q.service_tier);const{tools:z,toolChoice:W,toolWarnings:X}=await s6e({tools:d,toolChoice:h});return{webSearchToolName:q,args:{...Q,tools:z,tool_choice:W},warnings:[...S,...X],store:Z,toolNameMapping:k,providerOptionsName:E}}async doGenerate(e){var n,r,i,a,s,o,l,u,c,d,h,f,m,x,b,y,w,_,S,M,E,C,R,k,I;const{args:N,warnings:D,webSearchToolName:F,toolNameMapping:L,providerOptionsName:U}=await this.getArgs(e),j=this.config.url({path:"/responses",modelId:this.modelId}),q=tU(e.prompt),{responseHeaders:Z,value:Q,rawValue:z}=await Fn({url:j,headers:Mn(this.config.headers(),e.headers),body:N,failedResponseHandler:rl,successfulResponseHandler:vr(a6e),abortSignal:e.abortSignal,fetch:this.config.fetch});if(Q.error)throw new ji({message:Q.error.message,url:j,requestBodyValues:N,statusCode:400,responseHeaders:Z,responseBody:z,isRetryable:!1});const W=[],X=[];let H=!1;for(const ee of Q.output)switch(ee.type){case"reasoning":{ee.summary.length===0&&ee.summary.push({type:"summary_text",text:""});for(const se of ee.summary)W.push({type:"reasoning",text:se.text,providerMetadata:{[U]:{itemId:ee.id,reasoningEncryptedContent:(n=ee.encrypted_content)!=null?n:null}}});break}case"image_generation_call":{W.push({type:"tool-call",toolCallId:ee.id,toolName:L.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0}),W.push({type:"tool-result",toolCallId:ee.id,toolName:L.toCustomToolName("image_generation"),result:{result:ee.result}});break}case"local_shell_call":{W.push({type:"tool-call",toolCallId:ee.call_id,toolName:L.toCustomToolName("local_shell"),input:JSON.stringify({action:ee.action}),providerMetadata:{[U]:{itemId:ee.id}}});break}case"shell_call":{W.push({type:"tool-call",toolCallId:ee.call_id,toolName:L.toCustomToolName("shell"),input:JSON.stringify({action:{commands:ee.action.commands}}),providerMetadata:{[U]:{itemId:ee.id}}});break}case"message":{for(const se of ee.content){(i=(r=e.providerOptions)==null?void 0:r[U])!=null&&i.logprobs&&se.logprobs&&X.push(se.logprobs);const ue={itemId:ee.id,...se.annotations.length>0&&{annotations:se.annotations}};W.push({type:"text",text:se.text,providerMetadata:{[U]:ue}});for(const oe of se.annotations)oe.type==="url_citation"?W.push({type:"source",sourceType:"url",id:(o=(s=(a=this.config).generateId)==null?void 0:s.call(a))!=null?o:Ln(),url:oe.url,title:oe.title}):oe.type==="file_citation"?W.push({type:"source",sourceType:"document",id:(c=(u=(l=this.config).generateId)==null?void 0:u.call(l))!=null?c:Ln(),mediaType:"text/plain",title:oe.filename,filename:oe.filename,providerMetadata:{[U]:{type:oe.type,fileId:oe.file_id,index:oe.index}}}):oe.type==="container_file_citation"?W.push({type:"source",sourceType:"document",id:(f=(h=(d=this.config).generateId)==null?void 0:h.call(d))!=null?f:Ln(),mediaType:"text/plain",title:oe.filename,filename:oe.filename,providerMetadata:{[U]:{type:oe.type,fileId:oe.file_id,containerId:oe.container_id}}}):oe.type==="file_path"&&W.push({type:"source",sourceType:"document",id:(b=(x=(m=this.config).generateId)==null?void 0:x.call(m))!=null?b:Ln(),mediaType:"application/octet-stream",title:oe.file_id,filename:oe.file_id,providerMetadata:{[U]:{type:oe.type,fileId:oe.file_id,index:oe.index}}})}break}case"function_call":{H=!0,W.push({type:"tool-call",toolCallId:ee.call_id,toolName:ee.name,input:ee.arguments,providerMetadata:{[U]:{itemId:ee.id}}});break}case"web_search_call":{W.push({type:"tool-call",toolCallId:ee.id,toolName:L.toCustomToolName(F??"web_search"),input:JSON.stringify({}),providerExecuted:!0}),W.push({type:"tool-result",toolCallId:ee.id,toolName:L.toCustomToolName(F??"web_search"),result:rU(ee.action)});break}case"mcp_call":{const se=ee.approval_request_id!=null&&(y=q[ee.approval_request_id])!=null?y:ee.id,ue=`mcp.${ee.name}`;W.push({type:"tool-call",toolCallId:se,toolName:ue,input:ee.arguments,providerExecuted:!0,dynamic:!0}),W.push({type:"tool-result",toolCallId:se,toolName:ue,result:{type:"call",serverLabel:ee.server_label,name:ee.name,arguments:ee.arguments,...ee.output!=null?{output:ee.output}:{},...ee.error!=null?{error:ee.error}:{}},providerMetadata:{[U]:{itemId:ee.id}}});break}case"mcp_list_tools":break;case"mcp_approval_request":{const se=(w=ee.approval_request_id)!=null?w:ee.id,ue=(M=(S=(_=this.config).generateId)==null?void 0:S.call(_))!=null?M:Ln(),oe=`mcp.${ee.name}`;W.push({type:"tool-call",toolCallId:ue,toolName:oe,input:ee.arguments,providerExecuted:!0,dynamic:!0}),W.push({type:"tool-approval-request",approvalId:se,toolCallId:ue});break}case"computer_call":{W.push({type:"tool-call",toolCallId:ee.id,toolName:L.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),W.push({type:"tool-result",toolCallId:ee.id,toolName:L.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:ee.status||"completed"}});break}case"file_search_call":{W.push({type:"tool-call",toolCallId:ee.id,toolName:L.toCustomToolName("file_search"),input:"{}",providerExecuted:!0}),W.push({type:"tool-result",toolCallId:ee.id,toolName:L.toCustomToolName("file_search"),result:{queries:ee.queries,results:(C=(E=ee.results)==null?void 0:E.map(se=>({attributes:se.attributes,fileId:se.file_id,filename:se.filename,score:se.score,text:se.text})))!=null?C:null}});break}case"code_interpreter_call":{W.push({type:"tool-call",toolCallId:ee.id,toolName:L.toCustomToolName("code_interpreter"),input:JSON.stringify({code:ee.code,containerId:ee.container_id}),providerExecuted:!0}),W.push({type:"tool-result",toolCallId:ee.id,toolName:L.toCustomToolName("code_interpreter"),result:{outputs:ee.outputs}});break}case"apply_patch_call":{W.push({type:"tool-call",toolCallId:ee.call_id,toolName:L.toCustomToolName("apply_patch"),input:JSON.stringify({callId:ee.call_id,operation:ee.operation}),providerMetadata:{[U]:{itemId:ee.id}}});break}}const J={[U]:{responseId:Q.id}};X.length>0&&(J[U].logprobs=X),typeof Q.service_tier=="string"&&(J[U].serviceTier=Q.service_tier);const te=Q.usage;return{content:W,finishReason:{unified:QB({finishReason:(R=Q.incomplete_details)==null?void 0:R.reason,hasFunctionCall:H}),raw:(I=(k=Q.incomplete_details)==null?void 0:k.reason)!=null?I:void 0},usage:ZB(te),request:{body:N},response:{id:Q.id,timestamp:new Date(Q.created_at*1e3),modelId:Q.model,headers:Z,body:z},providerMetadata:J,warnings:D}}async doStream(e){const{args:n,warnings:r,webSearchToolName:i,toolNameMapping:a,store:s,providerOptionsName:o}=await this.getArgs(e),{responseHeaders:l,value:u}=await Fn({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:{...n,stream:!0},failedResponseHandler:rl,successfulResponseHandler:Xu(i6e),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=this,d=tU(e.prompt),h=new Map;let f={unified:"other",raw:void 0},m;const x=[];let b=null;const y={},w=[];let _=!1;const S={};let M;return{stream:u.pipeThrough(new TransformStream({start(E){E.enqueue({type:"stream-start",warnings:r})},transform(E,C){var R,k,I,N,D,F,L,U,j,q,Z,Q,z,W,X,H,J,te,ee,se,ue,oe,Te,Ne,be,De,ke,Me,Ie,ce;if(e.includeRawChunks&&C.enqueue({type:"raw",rawValue:E.rawValue}),!E.success){f={unified:"error",raw:void 0},C.enqueue({type:"error",error:E.error});return}const G=E.value;if(nU(G)){if(G.item.type==="function_call")y[G.output_index]={toolName:G.item.name,toolCallId:G.item.call_id},C.enqueue({type:"tool-input-start",id:G.item.call_id,toolName:G.item.name});else if(G.item.type==="web_search_call")y[G.output_index]={toolName:a.toCustomToolName(i??"web_search"),toolCallId:G.item.id},C.enqueue({type:"tool-input-start",id:G.item.id,toolName:a.toCustomToolName(i??"web_search"),providerExecuted:!0}),C.enqueue({type:"tool-input-end",id:G.item.id}),C.enqueue({type:"tool-call",toolCallId:G.item.id,toolName:a.toCustomToolName(i??"web_search"),input:JSON.stringify({}),providerExecuted:!0});else if(G.item.type==="computer_call")y[G.output_index]={toolName:a.toCustomToolName("computer_use"),toolCallId:G.item.id},C.enqueue({type:"tool-input-start",id:G.item.id,toolName:a.toCustomToolName("computer_use"),providerExecuted:!0});else if(G.item.type==="code_interpreter_call")y[G.output_index]={toolName:a.toCustomToolName("code_interpreter"),toolCallId:G.item.id,codeInterpreter:{containerId:G.item.container_id}},C.enqueue({type:"tool-input-start",id:G.item.id,toolName:a.toCustomToolName("code_interpreter"),providerExecuted:!0}),C.enqueue({type:"tool-input-delta",id:G.item.id,delta:`{"containerId":"${G.item.container_id}","code":"`});else if(G.item.type==="file_search_call")C.enqueue({type:"tool-call",toolCallId:G.item.id,toolName:a.toCustomToolName("file_search"),input:"{}",providerExecuted:!0});else if(G.item.type==="image_generation_call")C.enqueue({type:"tool-call",toolCallId:G.item.id,toolName:a.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0});else if(!(G.item.type==="mcp_call"||G.item.type==="mcp_list_tools"||G.item.type==="mcp_approval_request"))if(G.item.type==="apply_patch_call"){const{call_id:xe,operation:Oe}=G.item;if(y[G.output_index]={toolName:a.toCustomToolName("apply_patch"),toolCallId:xe,applyPatch:{hasDiff:Oe.type==="delete_file",endEmitted:Oe.type==="delete_file"}},C.enqueue({type:"tool-input-start",id:xe,toolName:a.toCustomToolName("apply_patch")}),Oe.type==="delete_file"){const Fe=JSON.stringify({callId:xe,operation:Oe});C.enqueue({type:"tool-input-delta",id:xe,delta:Fe}),C.enqueue({type:"tool-input-end",id:xe})}else C.enqueue({type:"tool-input-delta",id:xe,delta:`{"callId":"${oh(xe)}","operation":{"type":"${oh(Oe.type)}","path":"${oh(Oe.path)}","diff":"`})}else G.item.type==="shell_call"?y[G.output_index]={toolName:a.toCustomToolName("shell"),toolCallId:G.item.call_id}:G.item.type==="message"?(w.splice(0,w.length),C.enqueue({type:"text-start",id:G.item.id,providerMetadata:{[o]:{itemId:G.item.id}}})):nU(G)&&G.item.type==="reasoning"&&(S[G.item.id]={encryptedContent:G.item.encrypted_content,summaryParts:{0:"active"}},C.enqueue({type:"reasoning-start",id:`${G.item.id}:0`,providerMetadata:{[o]:{itemId:G.item.id,reasoningEncryptedContent:(R=G.item.encrypted_content)!=null?R:null}}}))}else if(u6e(G)){if(G.item.type==="message")C.enqueue({type:"text-end",id:G.item.id,providerMetadata:{[o]:{itemId:G.item.id,...w.length>0&&{annotations:w}}}});else if(G.item.type==="function_call")y[G.output_index]=void 0,_=!0,C.enqueue({type:"tool-input-end",id:G.item.call_id}),C.enqueue({type:"tool-call",toolCallId:G.item.call_id,toolName:G.item.name,input:G.item.arguments,providerMetadata:{[o]:{itemId:G.item.id}}});else if(G.item.type==="web_search_call")y[G.output_index]=void 0,C.enqueue({type:"tool-result",toolCallId:G.item.id,toolName:a.toCustomToolName(i??"web_search"),result:rU(G.item.action)});else if(G.item.type==="computer_call")y[G.output_index]=void 0,C.enqueue({type:"tool-input-end",id:G.item.id}),C.enqueue({type:"tool-call",toolCallId:G.item.id,toolName:a.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),C.enqueue({type:"tool-result",toolCallId:G.item.id,toolName:a.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:G.item.status||"completed"}});else if(G.item.type==="file_search_call")y[G.output_index]=void 0,C.enqueue({type:"tool-result",toolCallId:G.item.id,toolName:a.toCustomToolName("file_search"),result:{queries:G.item.queries,results:(I=(k=G.item.results)==null?void 0:k.map(xe=>({attributes:xe.attributes,fileId:xe.file_id,filename:xe.filename,score:xe.score,text:xe.text})))!=null?I:null}});else if(G.item.type==="code_interpreter_call")y[G.output_index]=void 0,C.enqueue({type:"tool-result",toolCallId:G.item.id,toolName:a.toCustomToolName("code_interpreter"),result:{outputs:G.item.outputs}});else if(G.item.type==="image_generation_call")C.enqueue({type:"tool-result",toolCallId:G.item.id,toolName:a.toCustomToolName("image_generation"),result:{result:G.item.result}});else if(G.item.type==="mcp_call"){y[G.output_index]=void 0;const xe=(N=G.item.approval_request_id)!=null?N:void 0,Oe=xe!=null&&(F=(D=h.get(xe))!=null?D:d[xe])!=null?F:G.item.id,Fe=`mcp.${G.item.name}`;C.enqueue({type:"tool-call",toolCallId:Oe,toolName:Fe,input:G.item.arguments,providerExecuted:!0,dynamic:!0}),C.enqueue({type:"tool-result",toolCallId:Oe,toolName:Fe,result:{type:"call",serverLabel:G.item.server_label,name:G.item.name,arguments:G.item.arguments,...G.item.output!=null?{output:G.item.output}:{},...G.item.error!=null?{error:G.item.error}:{}},providerMetadata:{[o]:{itemId:G.item.id}}})}else if(G.item.type==="mcp_list_tools")y[G.output_index]=void 0;else if(G.item.type==="apply_patch_call"){const xe=y[G.output_index];xe?.applyPatch&&!xe.applyPatch.endEmitted&&G.item.operation.type!=="delete_file"&&(xe.applyPatch.hasDiff||C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:oh(G.item.operation.diff)}),C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:'"}}'}),C.enqueue({type:"tool-input-end",id:xe.toolCallId}),xe.applyPatch.endEmitted=!0),xe&&G.item.status==="completed"&&C.enqueue({type:"tool-call",toolCallId:xe.toolCallId,toolName:a.toCustomToolName("apply_patch"),input:JSON.stringify({callId:G.item.call_id,operation:G.item.operation}),providerMetadata:{[o]:{itemId:G.item.id}}}),y[G.output_index]=void 0}else if(G.item.type==="mcp_approval_request"){y[G.output_index]=void 0;const xe=(j=(U=(L=c.config).generateId)==null?void 0:U.call(L))!=null?j:Ln(),Oe=(q=G.item.approval_request_id)!=null?q:G.item.id;h.set(Oe,xe);const Fe=`mcp.${G.item.name}`;C.enqueue({type:"tool-call",toolCallId:xe,toolName:Fe,input:G.item.arguments,providerExecuted:!0,dynamic:!0}),C.enqueue({type:"tool-approval-request",approvalId:Oe,toolCallId:xe})}else if(G.item.type==="local_shell_call")y[G.output_index]=void 0,C.enqueue({type:"tool-call",toolCallId:G.item.call_id,toolName:a.toCustomToolName("local_shell"),input:JSON.stringify({action:{type:"exec",command:G.item.action.command,timeoutMs:G.item.action.timeout_ms,user:G.item.action.user,workingDirectory:G.item.action.working_directory,env:G.item.action.env}}),providerMetadata:{[o]:{itemId:G.item.id}}});else if(G.item.type==="shell_call")y[G.output_index]=void 0,C.enqueue({type:"tool-call",toolCallId:G.item.call_id,toolName:a.toCustomToolName("shell"),input:JSON.stringify({action:{commands:G.item.action.commands}}),providerMetadata:{[o]:{itemId:G.item.id}}});else if(G.item.type==="reasoning"){const xe=S[G.item.id],Oe=Object.entries(xe.summaryParts).filter(([Fe,ze])=>ze==="active"||ze==="can-conclude").map(([Fe])=>Fe);for(const Fe of Oe)C.enqueue({type:"reasoning-end",id:`${G.item.id}:${Fe}`,providerMetadata:{[o]:{itemId:G.item.id,reasoningEncryptedContent:(Z=G.item.encrypted_content)!=null?Z:null}}});delete S[G.item.id]}}else if(h6e(G)){const xe=y[G.output_index];xe!=null&&C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:G.delta})}else if(g6e(G)){const xe=y[G.output_index];xe?.applyPatch&&(C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:oh(G.delta)}),xe.applyPatch.hasDiff=!0)}else if(v6e(G)){const xe=y[G.output_index];xe?.applyPatch&&!xe.applyPatch.endEmitted&&(xe.applyPatch.hasDiff||(C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:oh(G.diff)}),xe.applyPatch.hasDiff=!0),C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:'"}}'}),C.enqueue({type:"tool-input-end",id:xe.toolCallId}),xe.applyPatch.endEmitted=!0)}else if(f6e(G))C.enqueue({type:"tool-result",toolCallId:G.item_id,toolName:a.toCustomToolName("image_generation"),result:{result:G.partial_image_b64},preliminary:!0});else if(p6e(G)){const xe=y[G.output_index];xe!=null&&C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:oh(G.delta)})}else if(m6e(G)){const xe=y[G.output_index];xe!=null&&(C.enqueue({type:"tool-input-delta",id:xe.toolCallId,delta:'"}'}),C.enqueue({type:"tool-input-end",id:xe.toolCallId}),C.enqueue({type:"tool-call",toolCallId:xe.toolCallId,toolName:a.toCustomToolName("code_interpreter"),input:JSON.stringify({code:G.code,containerId:xe.codeInterpreter.containerId}),providerExecuted:!0}))}else if(d6e(G))b=G.response.id,C.enqueue({type:"response-metadata",id:G.response.id,timestamp:new Date(G.response.created_at*1e3),modelId:G.response.model});else if(l6e(G))C.enqueue({type:"text-delta",id:G.item_id,delta:G.delta}),(z=(Q=e.providerOptions)==null?void 0:Q[o])!=null&&z.logprobs&&G.logprobs&&x.push(G.logprobs);else if(G.type==="response.reasoning_summary_part.added"){if(G.summary_index>0){const xe=S[G.item_id];xe.summaryParts[G.summary_index]="active";for(const Oe of Object.keys(xe.summaryParts))xe.summaryParts[Oe]==="can-conclude"&&(C.enqueue({type:"reasoning-end",id:`${G.item_id}:${Oe}`,providerMetadata:{[o]:{itemId:G.item_id}}}),xe.summaryParts[Oe]="concluded");C.enqueue({type:"reasoning-start",id:`${G.item_id}:${G.summary_index}`,providerMetadata:{[o]:{itemId:G.item_id,reasoningEncryptedContent:(X=(W=S[G.item_id])==null?void 0:W.encryptedContent)!=null?X:null}}})}}else G.type==="response.reasoning_summary_text.delta"?C.enqueue({type:"reasoning-delta",id:`${G.item_id}:${G.summary_index}`,delta:G.delta,providerMetadata:{[o]:{itemId:G.item_id}}}):G.type==="response.reasoning_summary_part.done"?s?(C.enqueue({type:"reasoning-end",id:`${G.item_id}:${G.summary_index}`,providerMetadata:{[o]:{itemId:G.item_id}}}),S[G.item_id].summaryParts[G.summary_index]="concluded"):S[G.item_id].summaryParts[G.summary_index]="can-conclude":c6e(G)?(f={unified:QB({finishReason:(H=G.response.incomplete_details)==null?void 0:H.reason,hasFunctionCall:_}),raw:(te=(J=G.response.incomplete_details)==null?void 0:J.reason)!=null?te:void 0},m=G.response.usage,typeof G.response.service_tier=="string"&&(M=G.response.service_tier)):y6e(G)?(w.push(G.annotation),G.annotation.type==="url_citation"?C.enqueue({type:"source",sourceType:"url",id:(ue=(se=(ee=c.config).generateId)==null?void 0:se.call(ee))!=null?ue:Ln(),url:G.annotation.url,title:G.annotation.title}):G.annotation.type==="file_citation"?C.enqueue({type:"source",sourceType:"document",id:(Ne=(Te=(oe=c.config).generateId)==null?void 0:Te.call(oe))!=null?Ne:Ln(),mediaType:"text/plain",title:G.annotation.filename,filename:G.annotation.filename,providerMetadata:{[o]:{type:G.annotation.type,fileId:G.annotation.file_id,index:G.annotation.index}}}):G.annotation.type==="container_file_citation"?C.enqueue({type:"source",sourceType:"document",id:(ke=(De=(be=c.config).generateId)==null?void 0:De.call(be))!=null?ke:Ln(),mediaType:"text/plain",title:G.annotation.filename,filename:G.annotation.filename,providerMetadata:{[o]:{type:G.annotation.type,fileId:G.annotation.file_id,containerId:G.annotation.container_id}}}):G.annotation.type==="file_path"&&C.enqueue({type:"source",sourceType:"document",id:(ce=(Ie=(Me=c.config).generateId)==null?void 0:Ie.call(Me))!=null?ce:Ln(),mediaType:"application/octet-stream",title:G.annotation.file_id,filename:G.annotation.file_id,providerMetadata:{[o]:{type:G.annotation.type,fileId:G.annotation.file_id,index:G.annotation.index}}})):x6e(G)&&C.enqueue({type:"error",error:G})},flush(E){const C={[o]:{responseId:b}};x.length>0&&(C[o].logprobs=x),M!==void 0&&(C[o].serviceTier=M),E.enqueue({type:"finish",finishReason:f,usage:ZB(m),providerMetadata:C})}})),request:{body:n},response:{headers:l}}}};function l6e(t){return t.type==="response.output_text.delta"}function u6e(t){return t.type==="response.output_item.done"}function c6e(t){return t.type==="response.completed"||t.type==="response.incomplete"}function d6e(t){return t.type==="response.created"}function h6e(t){return t.type==="response.function_call_arguments.delta"}function f6e(t){return t.type==="response.image_generation_call.partial_image"}function p6e(t){return t.type==="response.code_interpreter_call_code.delta"}function m6e(t){return t.type==="response.code_interpreter_call_code.done"}function g6e(t){return t.type==="response.apply_patch_call_operation_diff.delta"}function v6e(t){return t.type==="response.apply_patch_call_operation_diff.done"}function nU(t){return t.type==="response.output_item.added"}function y6e(t){return t.type==="response.output_text.annotation.added"}function x6e(t){return t.type==="error"}function rU(t){var e;switch(t.type){case"search":return{action:{type:"search",query:(e=t.query)!=null?e:void 0},...t.sources!=null&&{sources:t.sources}};case"open_page":return{action:{type:"openPage",url:t.url}};case"find_in_page":return{action:{type:"findInPage",url:t.url,pattern:t.pattern}}}}function oh(t){return JSON.stringify(t).slice(1,-1)}var b6e=at(()=>it(B({instructions:A().nullish(),speed:ie().min(.25).max(4).default(1).nullish()}))),_6e=class{constructor(e,n){this.modelId=e,this.config=n,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({text:e,voice:n="alloy",outputFormat:r="mp3",speed:i,instructions:a,language:s,providerOptions:o}){const l=[],u=await sr({provider:"openai",providerOptions:o,schema:b6e}),c={model:this.modelId,input:e,voice:n,response_format:"mp3",speed:i,instructions:a};if(r&&(["mp3","opus","aac","flac","wav","pcm"].includes(r)?c.response_format=r:l.push({type:"unsupported",feature:"outputFormat",details:`Unsupported output format: ${r}. Using mp3 instead.`})),u){const d={};for(const h in d){const f=d[h];f!==void 0&&(c[h]=f)}}return s&&l.push({type:"unsupported",feature:"language",details:`OpenAI speech models do not support language selection. Language parameter "${s}" was ignored.`}),{requestBody:c,warnings:l}}async doGenerate(e){var n,r,i;const a=(i=(r=(n=this.config._internal)==null?void 0:n.currentDate)==null?void 0:r.call(n))!=null?i:new Date,{requestBody:s,warnings:o}=await this.getArgs(e),{value:l,responseHeaders:u,rawValue:c}=await Fn({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),body:s,failedResponseHandler:rl,successfulResponseHandler:PQ(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:l,warnings:o,request:{body:JSON.stringify(s)},response:{timestamp:a,modelId:this.modelId,headers:u,body:c}}}},w6e=at(()=>it(B({text:A(),language:A().nullish(),duration:ie().nullish(),words:Ce(B({word:A(),start:ie(),end:ie()})).nullish(),segments:Ce(B({id:ie(),seek:ie(),start:ie(),end:ie(),text:A(),tokens:Ce(ie()),temperature:ie(),avg_logprob:ie(),compression_ratio:ie(),no_speech_prob:ie()})).nullish()}))),S6e=at(()=>it(B({include:Ce(A()).optional(),language:A().optional(),prompt:A().optional(),temperature:ie().min(0).max(1).default(0).optional(),timestampGranularities:Ce(wt(["word","segment"])).default(["segment"]).optional()}))),iU={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},E6e=class{constructor(e,n){this.modelId=e,this.config=n,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:n,providerOptions:r}){const i=[],a=await sr({provider:"openai",providerOptions:r,schema:S6e}),s=new FormData,o=e instanceof Uint8Array?new Blob([e]):new Blob([Yu(e)]);s.append("model",this.modelId);const l=MQ(n);if(s.append("file",new File([o],"audio",{type:n}),`audio.${l}`),a){const u={include:a.include,language:a.language,prompt:a.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:a.temperature,timestamp_granularities:a.timestampGranularities};for(const[c,d]of Object.entries(u))if(d!=null)if(Array.isArray(d))for(const h of d)s.append(`${c}[]`,String(h));else s.append(c,String(d))}return{formData:s,warnings:i}}async doGenerate(e){var n,r,i,a,s,o,l,u;const c=(i=(r=(n=this.config._internal)==null?void 0:n.currentDate)==null?void 0:r.call(n))!=null?i:new Date,{formData:d,warnings:h}=await this.getArgs(e),{value:f,responseHeaders:m,rawValue:x}=await s3({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:Mn(this.config.headers(),e.headers),formData:d,failedResponseHandler:rl,successfulResponseHandler:vr(w6e),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=f.language!=null&&f.language in iU?iU[f.language]:void 0;return{text:f.text,segments:(l=(o=(a=f.segments)==null?void 0:a.map(y=>({text:y.text,startSecond:y.start,endSecond:y.end})))!=null?o:(s=f.words)==null?void 0:s.map(y=>({text:y.word,startSecond:y.start,endSecond:y.end})))!=null?l:[],language:b,durationInSeconds:(u=f.duration)!=null?u:void 0,warnings:h,response:{timestamp:c,modelId:this.modelId,headers:m,body:x}}}},T6e="3.0.12";function Ete(t={}){var e,n;const r=(e=rf(Kc({settingValue:t.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))!=null?e:"https://api.openai.com/v1",i=(n=t.name)!=null?n:"openai",a=()=>To({Authorization:`Bearer ${i3({apiKey:t.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":t.organization,"OpenAI-Project":t.project,...t.headers},`ai-sdk/openai/${T6e}`),s=x=>new cke(x,{provider:`${i}.chat`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),o=x=>new pke(x,{provider:`${i}.completion`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),l=x=>new vke(x,{provider:`${i}.embedding`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),u=x=>new _ke(x,{provider:`${i}.image`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),c=x=>new E6e(x,{provider:`${i}.transcription`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),d=x=>new _6e(x,{provider:`${i}.speech`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch}),h=x=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return f(x)},f=x=>new o6e(x,{provider:`${i}.responses`,url:({path:b})=>`${r}${b}`,headers:a,fetch:t.fetch,fileIdPrefixes:["file-"]}),m=function(x){return h(x)};return m.specificationVersion="v3",m.languageModel=h,m.chat=s,m.completion=o,m.responses=f,m.embedding=l,m.embeddingModel=l,m.textEmbedding=l,m.textEmbeddingModel=l,m.image=u,m.imageModel=u,m.transcription=c,m.transcriptionModel=c,m.speech=d,m.speechModel=d,m.tools=t6e,m}var C6e=Ete(),M6e="3.0.15",A6e=at(()=>it(B({type:ae("error"),error:B({type:A(),message:A()})}))),aU=Fa({errorSchema:A6e,errorToMessage:t=>t.error.message}),k6e=at(()=>it(B({type:ae("message"),id:A().nullish(),model:A().nullish(),content:Ce(Zt("type",[B({type:ae("text"),text:A(),citations:Ce(Zt("type",[B({type:ae("web_search_result_location"),cited_text:A(),url:A(),title:A(),encrypted_index:A()}),B({type:ae("page_location"),cited_text:A(),document_index:ie(),document_title:A().nullable(),start_page_number:ie(),end_page_number:ie()}),B({type:ae("char_location"),cited_text:A(),document_index:ie(),document_title:A().nullable(),start_char_index:ie(),end_char_index:ie()})])).optional()}),B({type:ae("thinking"),thinking:A(),signature:A()}),B({type:ae("redacted_thinking"),data:A()}),B({type:ae("tool_use"),id:A(),name:A(),input:Zn(),caller:vt([B({type:ae("code_execution_20250825"),tool_id:A()}),B({type:ae("direct")})]).optional()}),B({type:ae("server_tool_use"),id:A(),name:A(),input:sn(A(),Zn()).nullish()}),B({type:ae("mcp_tool_use"),id:A(),name:A(),input:Zn(),server_name:A()}),B({type:ae("mcp_tool_result"),tool_use_id:A(),is_error:Ot(),content:Ce(vt([A(),B({type:ae("text"),text:A()})]))}),B({type:ae("web_fetch_tool_result"),tool_use_id:A(),content:vt([B({type:ae("web_fetch_result"),url:A(),retrieved_at:A(),content:B({type:ae("document"),title:A().nullable(),citations:B({enabled:Ot()}).optional(),source:vt([B({type:ae("base64"),media_type:ae("application/pdf"),data:A()}),B({type:ae("text"),media_type:ae("text/plain"),data:A()})])})}),B({type:ae("web_fetch_tool_result_error"),error_code:A()})])}),B({type:ae("web_search_tool_result"),tool_use_id:A(),content:vt([Ce(B({type:ae("web_search_result"),url:A(),title:A(),encrypted_content:A(),page_age:A().nullish()})),B({type:ae("web_search_tool_result_error"),error_code:A()})])}),B({type:ae("code_execution_tool_result"),tool_use_id:A(),content:vt([B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}),B({type:ae("code_execution_tool_result_error"),error_code:A()})])}),B({type:ae("bash_code_execution_tool_result"),tool_use_id:A(),content:Zt("type",[B({type:ae("bash_code_execution_result"),content:Ce(B({type:ae("bash_code_execution_output"),file_id:A()})),stdout:A(),stderr:A(),return_code:ie()}),B({type:ae("bash_code_execution_tool_result_error"),error_code:A()})])}),B({type:ae("text_editor_code_execution_tool_result"),tool_use_id:A(),content:Zt("type",[B({type:ae("text_editor_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_view_result"),content:A(),file_type:A(),num_lines:ie().nullable(),start_line:ie().nullable(),total_lines:ie().nullable()}),B({type:ae("text_editor_code_execution_create_result"),is_file_update:Ot()}),B({type:ae("text_editor_code_execution_str_replace_result"),lines:Ce(A()).nullable(),new_lines:ie().nullable(),new_start:ie().nullable(),old_lines:ie().nullable(),old_start:ie().nullable()})])}),B({type:ae("tool_search_tool_result"),tool_use_id:A(),content:vt([B({type:ae("tool_search_tool_search_result"),tool_references:Ce(B({type:ae("tool_reference"),tool_name:A()}))}),B({type:ae("tool_search_tool_result_error"),error_code:A()})])})])),stop_reason:A().nullish(),stop_sequence:A().nullish(),usage:hI({input_tokens:ie(),output_tokens:ie(),cache_creation_input_tokens:ie().nullish(),cache_read_input_tokens:ie().nullish()}),container:B({expires_at:A(),id:A(),skills:Ce(B({type:vt([ae("anthropic"),ae("custom")]),skill_id:A(),version:A()})).nullish()}).nullish(),context_management:B({applied_edits:Ce(vt([B({type:ae("clear_tool_uses_20250919"),cleared_tool_uses:ie(),cleared_input_tokens:ie()}),B({type:ae("clear_thinking_20251015"),cleared_thinking_turns:ie(),cleared_input_tokens:ie()})]))}).nullish()}))),I6e=at(()=>it(Zt("type",[B({type:ae("message_start"),message:B({id:A().nullish(),model:A().nullish(),role:A().nullish(),usage:hI({input_tokens:ie(),cache_creation_input_tokens:ie().nullish(),cache_read_input_tokens:ie().nullish()}),content:Ce(Zt("type",[B({type:ae("tool_use"),id:A(),name:A(),input:Zn(),caller:vt([B({type:ae("code_execution_20250825"),tool_id:A()}),B({type:ae("direct")})]).optional()})])).nullish(),stop_reason:A().nullish(),container:B({expires_at:A(),id:A()}).nullish()})}),B({type:ae("content_block_start"),index:ie(),content_block:Zt("type",[B({type:ae("text"),text:A()}),B({type:ae("thinking"),thinking:A()}),B({type:ae("tool_use"),id:A(),name:A(),input:sn(A(),Zn()).optional(),caller:vt([B({type:ae("code_execution_20250825"),tool_id:A()}),B({type:ae("direct")})]).optional()}),B({type:ae("redacted_thinking"),data:A()}),B({type:ae("server_tool_use"),id:A(),name:A(),input:sn(A(),Zn()).nullish()}),B({type:ae("mcp_tool_use"),id:A(),name:A(),input:Zn(),server_name:A()}),B({type:ae("mcp_tool_result"),tool_use_id:A(),is_error:Ot(),content:Ce(vt([A(),B({type:ae("text"),text:A()})]))}),B({type:ae("web_fetch_tool_result"),tool_use_id:A(),content:vt([B({type:ae("web_fetch_result"),url:A(),retrieved_at:A(),content:B({type:ae("document"),title:A().nullable(),citations:B({enabled:Ot()}).optional(),source:vt([B({type:ae("base64"),media_type:ae("application/pdf"),data:A()}),B({type:ae("text"),media_type:ae("text/plain"),data:A()})])})}),B({type:ae("web_fetch_tool_result_error"),error_code:A()})])}),B({type:ae("web_search_tool_result"),tool_use_id:A(),content:vt([Ce(B({type:ae("web_search_result"),url:A(),title:A(),encrypted_content:A(),page_age:A().nullish()})),B({type:ae("web_search_tool_result_error"),error_code:A()})])}),B({type:ae("code_execution_tool_result"),tool_use_id:A(),content:vt([B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}),B({type:ae("code_execution_tool_result_error"),error_code:A()})])}),B({type:ae("bash_code_execution_tool_result"),tool_use_id:A(),content:Zt("type",[B({type:ae("bash_code_execution_result"),content:Ce(B({type:ae("bash_code_execution_output"),file_id:A()})),stdout:A(),stderr:A(),return_code:ie()}),B({type:ae("bash_code_execution_tool_result_error"),error_code:A()})])}),B({type:ae("text_editor_code_execution_tool_result"),tool_use_id:A(),content:Zt("type",[B({type:ae("text_editor_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_view_result"),content:A(),file_type:A(),num_lines:ie().nullable(),start_line:ie().nullable(),total_lines:ie().nullable()}),B({type:ae("text_editor_code_execution_create_result"),is_file_update:Ot()}),B({type:ae("text_editor_code_execution_str_replace_result"),lines:Ce(A()).nullable(),new_lines:ie().nullable(),new_start:ie().nullable(),old_lines:ie().nullable(),old_start:ie().nullable()})])}),B({type:ae("tool_search_tool_result"),tool_use_id:A(),content:vt([B({type:ae("tool_search_tool_search_result"),tool_references:Ce(B({type:ae("tool_reference"),tool_name:A()}))}),B({type:ae("tool_search_tool_result_error"),error_code:A()})])})])}),B({type:ae("content_block_delta"),index:ie(),delta:Zt("type",[B({type:ae("input_json_delta"),partial_json:A()}),B({type:ae("text_delta"),text:A()}),B({type:ae("thinking_delta"),thinking:A()}),B({type:ae("signature_delta"),signature:A()}),B({type:ae("citations_delta"),citation:Zt("type",[B({type:ae("web_search_result_location"),cited_text:A(),url:A(),title:A(),encrypted_index:A()}),B({type:ae("page_location"),cited_text:A(),document_index:ie(),document_title:A().nullable(),start_page_number:ie(),end_page_number:ie()}),B({type:ae("char_location"),cited_text:A(),document_index:ie(),document_title:A().nullable(),start_char_index:ie(),end_char_index:ie()})])})])}),B({type:ae("content_block_stop"),index:ie()}),B({type:ae("error"),error:B({type:A(),message:A()})}),B({type:ae("message_delta"),delta:B({stop_reason:A().nullish(),stop_sequence:A().nullish(),container:B({expires_at:A(),id:A(),skills:Ce(B({type:vt([ae("anthropic"),ae("custom")]),skill_id:A(),version:A()})).nullish()}).nullish(),context_management:B({applied_edits:Ce(vt([B({type:ae("clear_tool_uses_20250919"),cleared_tool_uses:ie(),cleared_input_tokens:ie()}),B({type:ae("clear_thinking_20251015"),cleared_thinking_turns:ie(),cleared_input_tokens:ie()})]))}).nullish()}),usage:hI({input_tokens:ie().nullish(),output_tokens:ie(),cache_creation_input_tokens:ie().nullish()})}),B({type:ae("message_stop")}),B({type:ae("ping")})]))),N6e=at(()=>it(B({signature:A().optional(),redactedData:A().optional()}))),sU=B({citations:B({enabled:Ot()}).optional(),title:A().optional(),context:A().optional()}),R6e=B({sendReasoning:Ot().optional(),structuredOutputMode:wt(["outputFormat","jsonTool","auto"]).optional(),thinking:B({type:vt([ae("enabled"),ae("disabled")]),budgetTokens:ie().optional()}).optional(),disableParallelToolUse:Ot().optional(),cacheControl:B({type:ae("ephemeral"),ttl:vt([ae("5m"),ae("1h")]).optional()}).optional(),mcpServers:Ce(B({type:ae("url"),name:A(),url:A(),authorizationToken:A().nullish(),toolConfiguration:B({enabled:Ot().nullish(),allowedTools:Ce(A()).nullish()}).nullish()})).optional(),container:B({id:A().optional(),skills:Ce(B({type:vt([ae("anthropic"),ae("custom")]),skillId:A(),version:A().optional()})).optional()}).optional(),toolStreaming:Ot().optional(),effort:wt(["low","medium","high"]).optional(),contextManagement:B({edits:Ce(Zt("type",[B({type:ae("clear_tool_uses_20250919"),trigger:Zt("type",[B({type:ae("input_tokens"),value:ie()}),B({type:ae("tool_uses"),value:ie()})]).optional(),keep:B({type:ae("tool_uses"),value:ie()}).optional(),clearAtLeast:B({type:ae("input_tokens"),value:ie()}).optional(),clearToolInputs:Ot().optional(),excludeTools:Ce(A()).optional()}),B({type:ae("clear_thinking_20251015"),keep:vt([ae("all"),B({type:ae("thinking_turns"),value:ie()})]).optional()})]))}).optional()}),oU=4;function P6e(t){var e;const n=t?.anthropic;return(e=n?.cacheControl)!=null?e:n?.cache_control}var hR=class{constructor(){this.breakpointCount=0,this.warnings=[]}getCacheControl(t,e){const n=P6e(t);if(n){if(!e.canCache){this.warnings.push({type:"unsupported",feature:"cache_control on non-cacheable context",details:`cache_control cannot be set on ${e.type}. It will be ignored.`});return}if(this.breakpointCount++,this.breakpointCount>oU){this.warnings.push({type:"unsupported",feature:"cacheControl breakpoint limit",details:`Maximum ${oU} cache breakpoints exceeded (found ${this.breakpointCount}). This breakpoint will be ignored.`});return}return n}}getWarnings(){return this.warnings}},D6e=at(()=>it(B({maxCharacters:ie().optional()}))),O6e=at(()=>it(B({command:wt(["view","create","str_replace","insert"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),L6e=Qr({id:"anthropic.text_editor_20250728",inputSchema:O6e}),F6e=(t={})=>L6e(t),B6e=at(()=>it(B({maxUses:ie().optional(),allowedDomains:Ce(A()).optional(),blockedDomains:Ce(A()).optional(),userLocation:B({type:ae("approximate"),city:A().optional(),region:A().optional(),country:A().optional(),timezone:A().optional()}).optional()}))),Tte=at(()=>it(Ce(B({url:A(),title:A().nullable(),pageAge:A().nullable(),encryptedContent:A(),type:ae("web_search_result")})))),U6e=at(()=>it(B({query:A()}))),z6e=Fr({id:"anthropic.web_search_20250305",inputSchema:U6e,outputSchema:Tte,supportsDeferredResults:!0}),j6e=(t={})=>z6e(t),H6e=at(()=>it(B({maxUses:ie().optional(),allowedDomains:Ce(A()).optional(),blockedDomains:Ce(A()).optional(),citations:B({enabled:Ot()}).optional(),maxContentTokens:ie().optional()}))),Cte=at(()=>it(B({type:ae("web_fetch_result"),url:A(),content:B({type:ae("document"),title:A().nullable(),citations:B({enabled:Ot()}).optional(),source:vt([B({type:ae("base64"),mediaType:ae("application/pdf"),data:A()}),B({type:ae("text"),mediaType:ae("text/plain"),data:A()})])}),retrievedAt:A().nullable()}))),$6e=at(()=>it(B({url:A()}))),V6e=Fr({id:"anthropic.web_fetch_20250910",inputSchema:$6e,outputSchema:Cte,supportsDeferredResults:!0}),q6e=(t={})=>V6e(t);async function G6e({tools:t,toolChoice:e,disableParallelToolUse:n,cacheControlValidator:r,supportsStructuredOutput:i}){var a;t=t?.length?t:void 0;const s=[],o=new Set,l=r||new hR;if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:s,betas:o};const u=[];for(const d of t)switch(d.type){case"function":{const h=l.getCacheControl(d.providerOptions,{type:"tool definition",canCache:!0}),f=(a=d.providerOptions)==null?void 0:a.anthropic,m=f?.deferLoading,x=f?.allowedCallers;u.push({name:d.name,description:d.description,input_schema:d.inputSchema,cache_control:h,...i===!0&&d.strict!=null?{strict:d.strict}:{},...m!=null?{defer_loading:m}:{},...x!=null?{allowed_callers:x}:{},...d.inputExamples!=null?{input_examples:d.inputExamples.map(b=>b.input)}:{}}),i===!0&&o.add("structured-outputs-2025-11-13"),(d.inputExamples!=null||x!=null)&&o.add("advanced-tool-use-2025-11-20");break}case"provider":{switch(d.id){case"anthropic.code_execution_20250522":{o.add("code-execution-2025-05-22"),u.push({type:"code_execution_20250522",name:"code_execution",cache_control:void 0});break}case"anthropic.code_execution_20250825":{o.add("code-execution-2025-08-25"),u.push({type:"code_execution_20250825",name:"code_execution"});break}case"anthropic.computer_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"computer",type:"computer_20250124",display_width_px:d.args.displayWidthPx,display_height_px:d.args.displayHeightPx,display_number:d.args.displayNumber,cache_control:void 0});break}case"anthropic.computer_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"computer",type:"computer_20241022",display_width_px:d.args.displayWidthPx,display_height_px:d.args.displayHeightPx,display_number:d.args.displayNumber,cache_control:void 0});break}case"anthropic.text_editor_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"str_replace_editor",type:"text_editor_20250124",cache_control:void 0});break}case"anthropic.text_editor_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"str_replace_editor",type:"text_editor_20241022",cache_control:void 0});break}case"anthropic.text_editor_20250429":{o.add("computer-use-2025-01-24"),u.push({name:"str_replace_based_edit_tool",type:"text_editor_20250429",cache_control:void 0});break}case"anthropic.text_editor_20250728":{const h=await Kn({value:d.args,schema:D6e});u.push({name:"str_replace_based_edit_tool",type:"text_editor_20250728",max_characters:h.maxCharacters,cache_control:void 0});break}case"anthropic.bash_20250124":{o.add("computer-use-2025-01-24"),u.push({name:"bash",type:"bash_20250124",cache_control:void 0});break}case"anthropic.bash_20241022":{o.add("computer-use-2024-10-22"),u.push({name:"bash",type:"bash_20241022",cache_control:void 0});break}case"anthropic.memory_20250818":{o.add("context-management-2025-06-27"),u.push({name:"memory",type:"memory_20250818"});break}case"anthropic.web_fetch_20250910":{o.add("web-fetch-2025-09-10");const h=await Kn({value:d.args,schema:H6e});u.push({type:"web_fetch_20250910",name:"web_fetch",max_uses:h.maxUses,allowed_domains:h.allowedDomains,blocked_domains:h.blockedDomains,citations:h.citations,max_content_tokens:h.maxContentTokens,cache_control:void 0});break}case"anthropic.web_search_20250305":{const h=await Kn({value:d.args,schema:B6e});u.push({type:"web_search_20250305",name:"web_search",max_uses:h.maxUses,allowed_domains:h.allowedDomains,blocked_domains:h.blockedDomains,user_location:h.userLocation,cache_control:void 0});break}case"anthropic.tool_search_regex_20251119":{o.add("advanced-tool-use-2025-11-20"),u.push({type:"tool_search_tool_regex_20251119",name:"tool_search_tool_regex"});break}case"anthropic.tool_search_bm25_20251119":{o.add("advanced-tool-use-2025-11-20"),u.push({type:"tool_search_tool_bm25_20251119",name:"tool_search_tool_bm25"});break}default:{s.push({type:"unsupported",feature:`provider-defined tool ${d.id}`});break}}break}default:{s.push({type:"unsupported",feature:`tool ${d}`});break}}if(e==null)return{tools:u,toolChoice:n?{type:"auto",disable_parallel_tool_use:n}:void 0,toolWarnings:s,betas:o};const c=e.type;switch(c){case"auto":return{tools:u,toolChoice:{type:"auto",disable_parallel_tool_use:n},toolWarnings:s,betas:o};case"required":return{tools:u,toolChoice:{type:"any",disable_parallel_tool_use:n},toolWarnings:s,betas:o};case"none":return{tools:void 0,toolChoice:void 0,toolWarnings:s,betas:o};case"tool":return{tools:u,toolChoice:{type:"tool",name:e.toolName,disable_parallel_tool_use:n},toolWarnings:s,betas:o};default:{const d=c;throw new Nn({functionality:`tool choice type: ${d}`})}}}function lU(t){var e,n;const r=t.input_tokens,i=t.output_tokens,a=(e=t.cache_creation_input_tokens)!=null?e:0,s=(n=t.cache_read_input_tokens)!=null?n:0;return{inputTokens:{total:r+a+s,noCache:r,cacheRead:s,cacheWrite:a},outputTokens:{total:i,text:void 0,reasoning:void 0},raw:t}}var Mte=at(()=>it(B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}))),W6e=at(()=>it(B({code:A()}))),Y6e=Fr({id:"anthropic.code_execution_20250522",inputSchema:W6e,outputSchema:Mte}),X6e=(t={})=>Y6e(t),Ate=at(()=>it(Zt("type",[B({type:ae("code_execution_result"),stdout:A(),stderr:A(),return_code:ie(),content:Ce(B({type:ae("code_execution_output"),file_id:A()})).optional().default([])}),B({type:ae("bash_code_execution_result"),content:Ce(B({type:ae("bash_code_execution_output"),file_id:A()})),stdout:A(),stderr:A(),return_code:ie()}),B({type:ae("bash_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_tool_result_error"),error_code:A()}),B({type:ae("text_editor_code_execution_view_result"),content:A(),file_type:A(),num_lines:ie().nullable(),start_line:ie().nullable(),total_lines:ie().nullable()}),B({type:ae("text_editor_code_execution_create_result"),is_file_update:Ot()}),B({type:ae("text_editor_code_execution_str_replace_result"),lines:Ce(A()).nullable(),new_lines:ie().nullable(),new_start:ie().nullable(),old_lines:ie().nullable(),old_start:ie().nullable()})]))),K6e=at(()=>it(Zt("type",[B({type:ae("programmatic-tool-call"),code:A()}),B({type:ae("bash_code_execution"),command:A()}),Zt("command",[B({type:ae("text_editor_code_execution"),command:ae("view"),path:A()}),B({type:ae("text_editor_code_execution"),command:ae("create"),path:A(),file_text:A().nullish()}),B({type:ae("text_editor_code_execution"),command:ae("str_replace"),path:A(),old_str:A(),new_str:A()})])]))),Z6e=Fr({id:"anthropic.code_execution_20250825",inputSchema:K6e,outputSchema:Ate,supportsDeferredResults:!0}),J6e=(t={})=>Z6e(t),kte=at(()=>it(Ce(B({type:ae("tool_reference"),toolName:A()})))),Q6e=at(()=>it(B({pattern:A(),limit:ie().optional()}))),eIe=Fr({id:"anthropic.tool_search_regex_20251119",inputSchema:Q6e,outputSchema:kte}),tIe=(t={})=>eIe(t);function nIe(t){if(typeof t=="string")return Buffer.from(t,"base64").toString("utf-8");if(t instanceof Uint8Array)return new TextDecoder().decode(t);throw t instanceof URL?new Nn({functionality:"URL-based text documents are not supported for citations"}):new Nn({functionality:`unsupported data type for text documents: ${typeof t}`})}function tT(t){return t instanceof URL||rIe(t)}function rIe(t){return typeof t=="string"&&/^https?:\/\//i.test(t)}function nT(t){return t instanceof URL?t.toString():t}async function iIe({prompt:t,sendReasoning:e,warnings:n,cacheControlValidator:r,toolNameMapping:i}){var a,s,o,l,u,c,d,h,f,m,x,b,y,w,_;const S=new Set,M=aIe(t),E=r||new hR;let C;const R=[];async function k(N){var D,F;const L=await sr({provider:"anthropic",providerOptions:N,schema:sU});return(F=(D=L?.citations)==null?void 0:D.enabled)!=null?F:!1}async function I(N){const D=await sr({provider:"anthropic",providerOptions:N,schema:sU});return{title:D?.title,context:D?.context}}for(let N=0;N<M.length;N++){const D=M[N],F=N===M.length-1,L=D.type;switch(L){case"system":{if(C!=null)throw new Nn({functionality:"Multiple system messages that are separated by user/assistant messages"});C=D.messages.map(({content:U,providerOptions:j})=>({type:"text",text:U,cache_control:E.getCacheControl(j,{type:"system message",canCache:!0})}));break}case"user":{const U=[];for(const j of D.messages){const{role:q,content:Z}=j;switch(q){case"user":{for(let Q=0;Q<Z.length;Q++){const z=Z[Q],W=Q===Z.length-1,X=(a=E.getCacheControl(z.providerOptions,{type:"user message part",canCache:!0}))!=null?a:W?E.getCacheControl(j.providerOptions,{type:"user message",canCache:!0}):void 0;switch(z.type){case"text":{U.push({type:"text",text:z.text,cache_control:X});break}case"file":{if(z.mediaType.startsWith("image/"))U.push({type:"image",source:tT(z.data)?{type:"url",url:nT(z.data)}:{type:"base64",media_type:z.mediaType==="image/*"?"image/jpeg":z.mediaType,data:oa(z.data)},cache_control:X});else if(z.mediaType==="application/pdf"){S.add("pdfs-2024-09-25");const H=await k(z.providerOptions),J=await I(z.providerOptions);U.push({type:"document",source:tT(z.data)?{type:"url",url:nT(z.data)}:{type:"base64",media_type:"application/pdf",data:oa(z.data)},title:(s=J.title)!=null?s:z.filename,...J.context&&{context:J.context},...H&&{citations:{enabled:!0}},cache_control:X})}else if(z.mediaType==="text/plain"){const H=await k(z.providerOptions),J=await I(z.providerOptions);U.push({type:"document",source:tT(z.data)?{type:"url",url:nT(z.data)}:{type:"text",media_type:"text/plain",data:nIe(z.data)},title:(o=J.title)!=null?o:z.filename,...J.context&&{context:J.context},...H&&{citations:{enabled:!0}},cache_control:X})}else throw new Nn({functionality:`media type: ${z.mediaType}`});break}}}break}case"tool":{for(let Q=0;Q<Z.length;Q++){const z=Z[Q];if(z.type==="tool-approval-response")continue;const W=Q===Z.length-1,X=(l=E.getCacheControl(z.providerOptions,{type:"tool result part",canCache:!0}))!=null?l:W?E.getCacheControl(j.providerOptions,{type:"tool result message",canCache:!0}):void 0,H=z.output;let J;switch(H.type){case"content":J=H.value.map(te=>{switch(te.type){case"text":return{type:"text",text:te.text};case"image-data":return{type:"image",source:{type:"base64",media_type:te.mediaType,data:te.data}};case"image-url":return{type:"image",source:{type:"url",url:te.url}};case"file-url":return{type:"document",source:{type:"url",url:te.url}};case"file-data":{if(te.mediaType==="application/pdf")return S.add("pdfs-2024-09-25"),{type:"document",source:{type:"base64",media_type:te.mediaType,data:te.data}};n.push({type:"other",message:`unsupported tool content part type: ${te.type} with media type: ${te.mediaType}`});return}default:{n.push({type:"other",message:`unsupported tool content part type: ${te.type}`});return}}}).filter(X8);break;case"text":case"error-text":J=H.value;break;case"execution-denied":J=(u=H.reason)!=null?u:"Tool execution denied.";break;case"json":case"error-json":default:J=JSON.stringify(H.value);break}U.push({type:"tool_result",tool_use_id:z.toolCallId,content:J,is_error:H.type==="error-text"||H.type==="error-json"?!0:void 0,cache_control:X})}break}default:{const Q=q;throw new Error(`Unsupported role: ${Q}`)}}}R.push({role:"user",content:U});break}case"assistant":{const U=[],j=new Set;for(let q=0;q<D.messages.length;q++){const Z=D.messages[q],Q=q===D.messages.length-1,{content:z}=Z;for(let W=0;W<z.length;W++){const X=z[W],H=W===z.length-1,J=(c=E.getCacheControl(X.providerOptions,{type:"assistant message part",canCache:!0}))!=null?c:H?E.getCacheControl(Z.providerOptions,{type:"assistant message",canCache:!0}):void 0;switch(X.type){case"text":{U.push({type:"text",text:F&&Q&&H?X.text.trim():X.text,cache_control:J});break}case"reasoning":{if(e){const te=await sr({provider:"anthropic",providerOptions:X.providerOptions,schema:N6e});te!=null?te.signature!=null?(E.getCacheControl(X.providerOptions,{type:"thinking block",canCache:!1}),U.push({type:"thinking",thinking:X.text,signature:te.signature})):te.redactedData!=null?(E.getCacheControl(X.providerOptions,{type:"redacted thinking block",canCache:!1}),U.push({type:"redacted_thinking",data:te.redactedData})):n.push({type:"other",message:"unsupported reasoning metadata"}):n.push({type:"other",message:"unsupported reasoning metadata"})}else n.push({type:"other",message:"sending reasoning content is disabled for this model"});break}case"tool-call":{if(X.providerExecuted){const se=i.toProviderToolName(X.toolName);if(((h=(d=X.providerOptions)==null?void 0:d.anthropic)==null?void 0:h.type)==="mcp-tool-use"){j.add(X.toolCallId);const oe=(m=(f=X.providerOptions)==null?void 0:f.anthropic)==null?void 0:m.serverName;if(oe==null||typeof oe!="string"){n.push({type:"other",message:"mcp tool use server name is required and must be a string"});break}U.push({type:"mcp_tool_use",id:X.toolCallId,name:X.toolName,input:X.input,server_name:oe,cache_control:J})}else if(se==="code_execution"&&X.input!=null&&typeof X.input=="object"&&"type"in X.input&&typeof X.input.type=="string"&&(X.input.type==="bash_code_execution"||X.input.type==="text_editor_code_execution"))U.push({type:"server_tool_use",id:X.toolCallId,name:X.input.type,input:X.input,cache_control:J});else if(se==="code_execution"&&X.input!=null&&typeof X.input=="object"&&"type"in X.input&&X.input.type==="programmatic-tool-call"){const{type:oe,...Te}=X.input;U.push({type:"server_tool_use",id:X.toolCallId,name:"code_execution",input:Te,cache_control:J})}else se==="code_execution"||se==="web_fetch"||se==="web_search"?U.push({type:"server_tool_use",id:X.toolCallId,name:se,input:X.input,cache_control:J}):se==="tool_search_tool_regex"||se==="tool_search_tool_bm25"?U.push({type:"server_tool_use",id:X.toolCallId,name:se,input:X.input,cache_control:J}):n.push({type:"other",message:`provider executed tool call for tool ${X.toolName} is not supported`});break}const te=(x=X.providerOptions)==null?void 0:x.anthropic,ee=te?.caller?te.caller.type==="code_execution_20250825"&&te.caller.toolId?{type:"code_execution_20250825",tool_id:te.caller.toolId}:te.caller.type==="direct"?{type:"direct"}:void 0:void 0;U.push({type:"tool_use",id:X.toolCallId,name:X.toolName,input:X.input,...ee&&{caller:ee},cache_control:J});break}case"tool-result":{const te=i.toProviderToolName(X.toolName);if(j.has(X.toolCallId)){const ee=X.output;if(ee.type!=="json"&&ee.type!=="error-json"){n.push({type:"other",message:`provider executed tool result output type ${ee.type} for tool ${X.toolName} is not supported`});break}U.push({type:"mcp_tool_result",tool_use_id:X.toolCallId,is_error:ee.type==="error-json",content:ee.value,cache_control:J})}else if(te==="code_execution"){const ee=X.output;if(ee.type==="error-text"||ee.type==="error-json"){let se={};try{typeof ee.value=="string"?se=JSON.parse(ee.value):typeof ee.value=="object"&&ee.value!==null&&(se=ee.value)}catch{}se.type==="code_execution_tool_result_error"?U.push({type:"code_execution_tool_result",tool_use_id:X.toolCallId,content:{type:"code_execution_tool_result_error",error_code:(b=se.errorCode)!=null?b:"unknown"},cache_control:J}):U.push({type:"bash_code_execution_tool_result",tool_use_id:X.toolCallId,cache_control:J,content:{type:"bash_code_execution_tool_result_error",error_code:(y=se.errorCode)!=null?y:"unknown"}});break}if(ee.type!=="json"){n.push({type:"other",message:`provider executed tool result output type ${ee.type} for tool ${X.toolName} is not supported`});break}if(ee.value==null||typeof ee.value!="object"||!("type"in ee.value)||typeof ee.value.type!="string"){n.push({type:"other",message:`provider executed tool result output value is not a valid code execution result for tool ${X.toolName}`});break}if(ee.value.type==="code_execution_result"){const se=await Kn({value:ee.value,schema:Mte});U.push({type:"code_execution_tool_result",tool_use_id:X.toolCallId,content:{type:se.type,stdout:se.stdout,stderr:se.stderr,return_code:se.return_code,content:(w=se.content)!=null?w:[]},cache_control:J})}else{const se=await Kn({value:ee.value,schema:Ate});se.type==="code_execution_result"?U.push({type:"code_execution_tool_result",tool_use_id:X.toolCallId,content:{type:se.type,stdout:se.stdout,stderr:se.stderr,return_code:se.return_code,content:(_=se.content)!=null?_:[]},cache_control:J}):se.type==="bash_code_execution_result"||se.type==="bash_code_execution_tool_result_error"?U.push({type:"bash_code_execution_tool_result",tool_use_id:X.toolCallId,cache_control:J,content:se}):U.push({type:"text_editor_code_execution_tool_result",tool_use_id:X.toolCallId,cache_control:J,content:se})}break}if(te==="web_fetch"){const ee=X.output;if(ee.type==="error-json"){const ue=JSON.parse(ee.value);U.push({type:"web_fetch_tool_result",tool_use_id:X.toolCallId,content:{type:"web_fetch_tool_result_error",error_code:ue.errorCode},cache_control:J});break}if(ee.type!=="json"){n.push({type:"other",message:`provider executed tool result output type ${ee.type} for tool ${X.toolName} is not supported`});break}const se=await Kn({value:ee.value,schema:Cte});U.push({type:"web_fetch_tool_result",tool_use_id:X.toolCallId,content:{type:"web_fetch_result",url:se.url,retrieved_at:se.retrievedAt,content:{type:"document",title:se.content.title,citations:se.content.citations,source:{type:se.content.source.type,media_type:se.content.source.mediaType,data:se.content.source.data}}},cache_control:J});break}if(te==="web_search"){const ee=X.output;if(ee.type!=="json"){n.push({type:"other",message:`provider executed tool result output type ${ee.type} for tool ${X.toolName} is not supported`});break}const se=await Kn({value:ee.value,schema:Tte});U.push({type:"web_search_tool_result",tool_use_id:X.toolCallId,content:se.map(ue=>({url:ue.url,title:ue.title,page_age:ue.pageAge,encrypted_content:ue.encryptedContent,type:ue.type})),cache_control:J});break}if(te==="tool_search_tool_regex"||te==="tool_search_tool_bm25"){const ee=X.output;if(ee.type!=="json"){n.push({type:"other",message:`provider executed tool result output type ${ee.type} for tool ${X.toolName} is not supported`});break}const ue=(await Kn({value:ee.value,schema:kte})).map(oe=>({type:"tool_reference",tool_name:oe.toolName}));U.push({type:"tool_search_tool_result",tool_use_id:X.toolCallId,content:{type:"tool_search_tool_search_result",tool_references:ue},cache_control:J});break}n.push({type:"other",message:`provider executed tool result for tool ${X.toolName} is not supported`});break}}}}R.push({role:"assistant",content:U});break}default:{const U=L;throw new Error(`content type: ${U}`)}}}return{prompt:{system:C,messages:R},betas:S}}function aIe(t){const e=[];let n;for(const r of t){const{role:i}=r;switch(i){case"system":{n?.type!=="system"&&(n={type:"system",messages:[]},e.push(n)),n.messages.push(r);break}case"assistant":{n?.type!=="assistant"&&(n={type:"assistant",messages:[]},e.push(n)),n.messages.push(r);break}case"user":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}case"tool":{n?.type!=="user"&&(n={type:"user",messages:[]},e.push(n)),n.messages.push(r);break}default:{const a=i;throw new Error(`Unsupported role: ${a}`)}}}return e}function rT({finishReason:t,isJsonResponseFromTool:e}){switch(t){case"pause_turn":case"end_turn":case"stop_sequence":return"stop";case"refusal":return"content-filter";case"tool_use":return e?"stop":"tool-calls";case"max_tokens":case"model_context_window_exceeded":return"length";default:return"other"}}function uU(t,e,n){var r;if(t.type!=="page_location"&&t.type!=="char_location")return;const i=e[t.document_index];if(i)return{type:"source",sourceType:"document",id:n(),mediaType:i.mediaType,title:(r=t.document_title)!=null?r:i.title,filename:i.filename,providerMetadata:{anthropic:t.type==="page_location"?{citedText:t.cited_text,startPageNumber:t.start_page_number,endPageNumber:t.end_page_number}:{citedText:t.cited_text,startCharIndex:t.start_char_index,endCharIndex:t.end_char_index}}}}var sIe=class{constructor(t,e){this.specificationVersion="v3";var n;this.modelId=t,this.config=e,this.generateId=(n=e.generateId)!=null?n:Ln}supportsUrl(t){return t.protocol==="https:"}get provider(){return this.config.provider}get supportedUrls(){var t,e,n;return(n=(e=(t=this.config).supportedUrls)==null?void 0:e.call(t))!=null?n:{}}async getArgs({userSuppliedBetas:t,prompt:e,maxOutputTokens:n,temperature:r,topP:i,topK:a,frequencyPenalty:s,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,tools:d,toolChoice:h,providerOptions:f,stream:m}){var x,b,y,w,_,S;const M=[];s!=null&&M.push({type:"unsupported",feature:"frequencyPenalty"}),o!=null&&M.push({type:"unsupported",feature:"presencePenalty"}),c!=null&&M.push({type:"unsupported",feature:"seed"}),r!=null&&r>1?(M.push({type:"unsupported",feature:"temperature",details:`${r} exceeds anthropic maximum of 1.0. clamped to 1.0`}),r=1):r!=null&&r<0&&(M.push({type:"unsupported",feature:"temperature",details:`${r} is below anthropic minimum of 0. clamped to 0`}),r=0),u?.type==="json"&&u.schema==null&&M.push({type:"unsupported",feature:"responseFormat",details:"JSON response format requires a schema. The response format is ignored."});const E=await sr({provider:"anthropic",providerOptions:f,schema:R6e}),{maxOutputTokens:C,supportsStructuredOutput:R,isKnownModel:k}=oIe(this.modelId),I=((x=this.config.supportsNativeStructuredOutput)!=null?x:!0)&&R,N=(b=E?.structuredOutputMode)!=null?b:"auto",D=N==="outputFormat"||N==="auto"&&I,F=u?.type==="json"&&u.schema!=null&&!D?{type:"function",name:"json",description:"Respond with a JSON object.",inputSchema:u.schema}:void 0,L=E?.contextManagement,U=new hR,j=W8({tools:d,providerToolNames:{"anthropic.code_execution_20250522":"code_execution","anthropic.code_execution_20250825":"code_execution","anthropic.computer_20241022":"computer","anthropic.computer_20250124":"computer","anthropic.text_editor_20241022":"str_replace_editor","anthropic.text_editor_20250124":"str_replace_editor","anthropic.text_editor_20250429":"str_replace_based_edit_tool","anthropic.text_editor_20250728":"str_replace_based_edit_tool","anthropic.bash_20241022":"bash","anthropic.bash_20250124":"bash","anthropic.memory_20250818":"memory","anthropic.web_search_20250305":"web_search","anthropic.web_fetch_20250910":"web_fetch","anthropic.tool_search_regex_20251119":"tool_search_tool_regex","anthropic.tool_search_bm25_20251119":"tool_search_tool_bm25"}}),{prompt:q,betas:Z}=await iIe({prompt:e,sendReasoning:(y=E?.sendReasoning)!=null?y:!0,warnings:M,cacheControlValidator:U,toolNameMapping:j}),Q=((w=E?.thinking)==null?void 0:w.type)==="enabled";let z=(_=E?.thinking)==null?void 0:_.budgetTokens;const W=n??C,X={model:this.modelId,max_tokens:W,temperature:r,top_k:a,top_p:i,stop_sequences:l,...Q&&{thinking:{type:"enabled",budget_tokens:z}},...E?.effort&&{output_config:{effort:E.effort}},...D&&u?.type==="json"&&u.schema!=null&&{output_format:{type:"json_schema",schema:u.schema}},...E?.mcpServers&&E.mcpServers.length>0&&{mcp_servers:E.mcpServers.map(oe=>({type:oe.type,name:oe.name,url:oe.url,authorization_token:oe.authorizationToken,tool_configuration:oe.toolConfiguration?{allowed_tools:oe.toolConfiguration.allowedTools,enabled:oe.toolConfiguration.enabled}:void 0}))},...E?.container&&{container:E.container.skills&&E.container.skills.length>0?{id:E.container.id,skills:E.container.skills.map(oe=>({type:oe.type,skill_id:oe.skillId,version:oe.version}))}:E.container.id},system:q.system,messages:q.messages,...L&&{context_management:{edits:L.edits.map(oe=>{const Te=oe.type;switch(Te){case"clear_tool_uses_20250919":return{type:oe.type,...oe.trigger!==void 0&&{trigger:oe.trigger},...oe.keep!==void 0&&{keep:oe.keep},...oe.clearAtLeast!==void 0&&{clear_at_least:oe.clearAtLeast},...oe.clearToolInputs!==void 0&&{clear_tool_inputs:oe.clearToolInputs},...oe.excludeTools!==void 0&&{exclude_tools:oe.excludeTools}};case"clear_thinking_20251015":return{type:oe.type,...oe.keep!==void 0&&{keep:oe.keep}};default:M.push({type:"other",message:`Unknown context management strategy: ${Te}`});return}}).filter(oe=>oe!==void 0)}}};Q?(z==null&&(M.push({type:"compatibility",feature:"extended thinking",details:"thinking budget is required when thinking is enabled. using default budget of 1024 tokens."}),X.thinking={type:"enabled",budget_tokens:1024},z=1024),X.temperature!=null&&(X.temperature=void 0,M.push({type:"unsupported",feature:"temperature",details:"temperature is not supported when thinking is enabled"})),a!=null&&(X.top_k=void 0,M.push({type:"unsupported",feature:"topK",details:"topK is not supported when thinking is enabled"})),i!=null&&(X.top_p=void 0,M.push({type:"unsupported",feature:"topP",details:"topP is not supported when thinking is enabled"})),X.max_tokens=W+(z??0)):i!=null&&r!=null&&(M.push({type:"unsupported",feature:"topP",details:"topP is not supported when temperature is set. topP is ignored."}),X.top_p=void 0),k&&X.max_tokens>C&&(n!=null&&M.push({type:"unsupported",feature:"maxOutputTokens",details:`${X.max_tokens} (maxOutputTokens + thinkingBudget) is greater than ${this.modelId} ${C} max output tokens. The max output tokens have been limited to ${C}.`}),X.max_tokens=C),E?.mcpServers&&E.mcpServers.length>0&&Z.add("mcp-client-2025-04-04"),L&&Z.add("context-management-2025-06-27"),E?.container&&E.container.skills&&E.container.skills.length>0&&(Z.add("code-execution-2025-08-25"),Z.add("skills-2025-10-02"),Z.add("files-api-2025-04-14"),d?.some(oe=>oe.type==="provider"&&oe.id==="anthropic.code_execution_20250825")||M.push({type:"other",message:"code execution tool is required when using skills"})),E?.effort&&Z.add("effort-2025-11-24"),m&&((S=E?.toolStreaming)==null||S)&&Z.add("fine-grained-tool-streaming-2025-05-14"),D&&u?.type==="json"&&u.schema!=null&&Z.add("structured-outputs-2025-11-13");const{tools:J,toolChoice:te,toolWarnings:ee,betas:se}=await G6e(F!=null?{tools:[...d??[],F],toolChoice:{type:"required"},disableParallelToolUse:!0,cacheControlValidator:U,supportsStructuredOutput:I}:{tools:d??[],toolChoice:h,disableParallelToolUse:E?.disableParallelToolUse,cacheControlValidator:U,supportsStructuredOutput:I}),ue=U.getWarnings();return{args:{...X,tools:J,tool_choice:te,stream:m===!0?!0:void 0},warnings:[...M,...ee,...ue],betas:new Set([...Z,...se,...t]),usesJsonResponseTool:F!=null,toolNameMapping:j}}async getHeaders({betas:t,headers:e}){return Mn(await Vr(this.config.headers),e,t.size>0?{"anthropic-beta":Array.from(t).join(",")}:{})}async getBetasFromHeaders(t){var e,n;const i=(e=(await Vr(this.config.headers))["anthropic-beta"])!=null?e:"",a=(n=t?.["anthropic-beta"])!=null?n:"";return new Set([...i.toLowerCase().split(","),...a.toLowerCase().split(",")].map(s=>s.trim()).filter(s=>s!==""))}buildRequestUrl(t){var e,n,r;return(r=(n=(e=this.config).buildRequestUrl)==null?void 0:n.call(e,this.config.baseURL,t))!=null?r:`${this.config.baseURL}/messages`}transformRequestBody(t){var e,n,r;return(r=(n=(e=this.config).transformRequestBody)==null?void 0:n.call(e,t))!=null?r:t}extractCitationDocuments(t){const e=n=>{var r,i;if(n.type!=="file"||n.mediaType!=="application/pdf"&&n.mediaType!=="text/plain")return!1;const a=(r=n.providerOptions)==null?void 0:r.anthropic,s=a?.citations;return(i=s?.enabled)!=null?i:!1};return t.filter(n=>n.role==="user").flatMap(n=>n.content).filter(e).map(n=>{var r;const i=n;return{title:(r=i.filename)!=null?r:"Untitled Document",filename:i.filename,mediaType:i.mediaType}})}async doGenerate(t){var e,n,r,i,a,s,o,l,u,c,d;const{args:h,warnings:f,betas:m,usesJsonResponseTool:x,toolNameMapping:b}=await this.getArgs({...t,stream:!1,userSuppliedBetas:await this.getBetasFromHeaders(t.headers)}),y=this.extractCitationDocuments(t.prompt),{responseHeaders:w,value:_,rawValue:S}=await Fn({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:m,headers:t.headers}),body:this.transformRequestBody(h),failedResponseHandler:aU,successfulResponseHandler:vr(k6e),abortSignal:t.abortSignal,fetch:this.config.fetch}),M=[],E={},C={};let R=!1;for(const k of _.content)switch(k.type){case"text":{if(!x&&(M.push({type:"text",text:k.text}),k.citations))for(const I of k.citations){const N=uU(I,y,this.generateId);N&&M.push(N)}break}case"thinking":{M.push({type:"reasoning",text:k.thinking,providerMetadata:{anthropic:{signature:k.signature}}});break}case"redacted_thinking":{M.push({type:"reasoning",text:"",providerMetadata:{anthropic:{redactedData:k.data}}});break}case"tool_use":{if(x&&k.name==="json")R=!0,M.push({type:"text",text:JSON.stringify(k.input)});else{const N=k.caller,D=N?{type:N.type,toolId:"tool_id"in N?N.tool_id:void 0}:void 0;M.push({type:"tool-call",toolCallId:k.id,toolName:k.name,input:JSON.stringify(k.input),...D&&{providerMetadata:{anthropic:{caller:D}}}})}break}case"server_tool_use":{if(k.name==="text_editor_code_execution"||k.name==="bash_code_execution")M.push({type:"tool-call",toolCallId:k.id,toolName:b.toCustomToolName("code_execution"),input:JSON.stringify({type:k.name,...k.input}),providerExecuted:!0});else if(k.name==="web_search"||k.name==="code_execution"||k.name==="web_fetch"){const I=k.name==="code_execution"&&k.input!=null&&typeof k.input=="object"&&"code"in k.input&&!("type"in k.input)?{type:"programmatic-tool-call",...k.input}:k.input;M.push({type:"tool-call",toolCallId:k.id,toolName:b.toCustomToolName(k.name),input:JSON.stringify(I),providerExecuted:!0})}else(k.name==="tool_search_tool_regex"||k.name==="tool_search_tool_bm25")&&(C[k.id]=k.name,M.push({type:"tool-call",toolCallId:k.id,toolName:b.toCustomToolName(k.name),input:JSON.stringify(k.input),providerExecuted:!0}));break}case"mcp_tool_use":{E[k.id]={type:"tool-call",toolCallId:k.id,toolName:k.name,input:JSON.stringify(k.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:"mcp-tool-use",serverName:k.server_name}}},M.push(E[k.id]);break}case"mcp_tool_result":{M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:E[k.tool_use_id].toolName,isError:k.is_error,result:k.content,dynamic:!0,providerMetadata:E[k.tool_use_id].providerMetadata});break}case"web_fetch_tool_result":{k.content.type==="web_fetch_result"?M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("web_fetch"),result:{type:"web_fetch_result",url:k.content.url,retrievedAt:k.content.retrieved_at,content:{type:k.content.content.type,title:k.content.content.title,citations:k.content.content.citations,source:{type:k.content.content.source.type,mediaType:k.content.content.source.media_type,data:k.content.content.source.data}}}}):k.content.type==="web_fetch_tool_result_error"&&M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("web_fetch"),isError:!0,result:{type:"web_fetch_tool_result_error",errorCode:k.content.error_code}});break}case"web_search_tool_result":{if(Array.isArray(k.content)){M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("web_search"),result:k.content.map(I=>{var N;return{url:I.url,title:I.title,pageAge:(N=I.page_age)!=null?N:null,encryptedContent:I.encrypted_content,type:I.type}})});for(const I of k.content)M.push({type:"source",sourceType:"url",id:this.generateId(),url:I.url,title:I.title,providerMetadata:{anthropic:{pageAge:(e=I.page_age)!=null?e:null}}})}else M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("web_search"),isError:!0,result:{type:"web_search_tool_result_error",errorCode:k.content.error_code}});break}case"code_execution_tool_result":{k.content.type==="code_execution_result"?M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("code_execution"),result:{type:k.content.type,stdout:k.content.stdout,stderr:k.content.stderr,return_code:k.content.return_code,content:(n=k.content.content)!=null?n:[]}}):k.content.type==="code_execution_tool_result_error"&&M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("code_execution"),isError:!0,result:{type:"code_execution_tool_result_error",errorCode:k.content.error_code}});break}case"bash_code_execution_tool_result":case"text_editor_code_execution_tool_result":{M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName("code_execution"),result:k.content});break}case"tool_search_tool_result":{const I=(r=C[k.tool_use_id])!=null?r:"tool_search_tool_regex";k.content.type==="tool_search_tool_search_result"?M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName(I),result:k.content.tool_references.map(N=>({type:N.type,toolName:N.tool_name}))}):M.push({type:"tool-result",toolCallId:k.tool_use_id,toolName:b.toCustomToolName(I),isError:!0,result:{type:"tool_search_tool_result_error",errorCode:k.content.error_code}});break}}return{content:M,finishReason:{unified:rT({finishReason:_.stop_reason,isJsonResponseFromTool:R}),raw:(i=_.stop_reason)!=null?i:void 0},usage:lU(_.usage),request:{body:h},response:{id:(a=_.id)!=null?a:void 0,modelId:(s=_.model)!=null?s:void 0,headers:w,body:S},warnings:f,providerMetadata:{anthropic:{usage:_.usage,cacheCreationInputTokens:(o=_.usage.cache_creation_input_tokens)!=null?o:null,stopSequence:(l=_.stop_sequence)!=null?l:null,container:_.container?{expiresAt:_.container.expires_at,id:_.container.id,skills:(c=(u=_.container.skills)==null?void 0:u.map(k=>({type:k.type,skillId:k.skill_id,version:k.version})))!=null?c:null}:null,contextManagement:(d=cU(_.context_management))!=null?d:null}}}}async doStream(t){var e,n;const{args:r,warnings:i,betas:a,usesJsonResponseTool:s,toolNameMapping:o}=await this.getArgs({...t,stream:!0,userSuppliedBetas:await this.getBetasFromHeaders(t.headers)}),l=this.extractCitationDocuments(t.prompt),u=this.buildRequestUrl(!0),{responseHeaders:c,value:d}=await Fn({url:u,headers:await this.getHeaders({betas:a,headers:t.headers}),body:this.transformRequestBody(r),failedResponseHandler:aU,successfulResponseHandler:Xu(I6e),abortSignal:t.abortSignal,fetch:this.config.fetch});let h={unified:"other",raw:void 0};const f={input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0},m={},x={},b={};let y=null,w,_=null,S=null,M=null,E=!1,C;const R=this.generateId,k=d.pipeThrough(new TransformStream({start(F){F.enqueue({type:"stream-start",warnings:i})},transform(F,L){var U,j,q,Z,Q,z,W,X,H,J,te,ee,se;if(t.includeRawChunks&&L.enqueue({type:"raw",rawValue:F.rawValue}),!F.success){L.enqueue({type:"error",error:F.error});return}const ue=F.value;switch(ue.type){case"ping":return;case"content_block_start":{const oe=ue.content_block,Te=oe.type;switch(C=Te,Te){case"text":{if(s)return;m[ue.index]={type:"text"},L.enqueue({type:"text-start",id:String(ue.index)});return}case"thinking":{m[ue.index]={type:"reasoning"},L.enqueue({type:"reasoning-start",id:String(ue.index)});return}case"redacted_thinking":{m[ue.index]={type:"reasoning"},L.enqueue({type:"reasoning-start",id:String(ue.index),providerMetadata:{anthropic:{redactedData:oe.data}}});return}case"tool_use":{if(s&&oe.name==="json")E=!0,m[ue.index]={type:"text"},L.enqueue({type:"text-start",id:String(ue.index)});else{const be=oe.caller,De=be?{type:be.type,toolId:"tool_id"in be?be.tool_id:void 0}:void 0,Me=oe.input&&Object.keys(oe.input).length>0?JSON.stringify(oe.input):"";m[ue.index]={type:"tool-call",toolCallId:oe.id,toolName:oe.name,input:Me,firstDelta:Me.length===0,...De&&{caller:De}},L.enqueue({type:"tool-input-start",id:oe.id,toolName:oe.name})}return}case"server_tool_use":{if(["web_fetch","web_search","code_execution","text_editor_code_execution","bash_code_execution"].includes(oe.name)){const Ne=oe.name==="text_editor_code_execution"||oe.name==="bash_code_execution"?"code_execution":oe.name,be=o.toCustomToolName(Ne);m[ue.index]={type:"tool-call",toolCallId:oe.id,toolName:be,input:"",providerExecuted:!0,firstDelta:!0,providerToolName:oe.name},L.enqueue({type:"tool-input-start",id:oe.id,toolName:be,providerExecuted:!0})}else if(oe.name==="tool_search_tool_regex"||oe.name==="tool_search_tool_bm25"){b[oe.id]=oe.name;const Ne=o.toCustomToolName(oe.name);m[ue.index]={type:"tool-call",toolCallId:oe.id,toolName:Ne,input:"",providerExecuted:!0,firstDelta:!0,providerToolName:oe.name},L.enqueue({type:"tool-input-start",id:oe.id,toolName:Ne,providerExecuted:!0})}return}case"web_fetch_tool_result":{oe.content.type==="web_fetch_result"?L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("web_fetch"),result:{type:"web_fetch_result",url:oe.content.url,retrievedAt:oe.content.retrieved_at,content:{type:oe.content.content.type,title:oe.content.content.title,citations:oe.content.content.citations,source:{type:oe.content.content.source.type,mediaType:oe.content.content.source.media_type,data:oe.content.content.source.data}}}}):oe.content.type==="web_fetch_tool_result_error"&&L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("web_fetch"),isError:!0,result:{type:"web_fetch_tool_result_error",errorCode:oe.content.error_code}});return}case"web_search_tool_result":{if(Array.isArray(oe.content)){L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("web_search"),result:oe.content.map(Ne=>{var be;return{url:Ne.url,title:Ne.title,pageAge:(be=Ne.page_age)!=null?be:null,encryptedContent:Ne.encrypted_content,type:Ne.type}})});for(const Ne of oe.content)L.enqueue({type:"source",sourceType:"url",id:R(),url:Ne.url,title:Ne.title,providerMetadata:{anthropic:{pageAge:(U=Ne.page_age)!=null?U:null}}})}else L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("web_search"),isError:!0,result:{type:"web_search_tool_result_error",errorCode:oe.content.error_code}});return}case"code_execution_tool_result":{oe.content.type==="code_execution_result"?L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("code_execution"),result:{type:oe.content.type,stdout:oe.content.stdout,stderr:oe.content.stderr,return_code:oe.content.return_code,content:(j=oe.content.content)!=null?j:[]}}):oe.content.type==="code_execution_tool_result_error"&&L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("code_execution"),isError:!0,result:{type:"code_execution_tool_result_error",errorCode:oe.content.error_code}});return}case"bash_code_execution_tool_result":case"text_editor_code_execution_tool_result":{L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName("code_execution"),result:oe.content});return}case"tool_search_tool_result":{const Ne=(q=b[oe.tool_use_id])!=null?q:"tool_search_tool_regex";oe.content.type==="tool_search_tool_search_result"?L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName(Ne),result:oe.content.tool_references.map(be=>({type:be.type,toolName:be.tool_name}))}):L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:o.toCustomToolName(Ne),isError:!0,result:{type:"tool_search_tool_result_error",errorCode:oe.content.error_code}});return}case"mcp_tool_use":{x[oe.id]={type:"tool-call",toolCallId:oe.id,toolName:oe.name,input:JSON.stringify(oe.input),providerExecuted:!0,dynamic:!0,providerMetadata:{anthropic:{type:"mcp-tool-use",serverName:oe.server_name}}},L.enqueue(x[oe.id]);return}case"mcp_tool_result":{L.enqueue({type:"tool-result",toolCallId:oe.tool_use_id,toolName:x[oe.tool_use_id].toolName,isError:oe.is_error,result:oe.content,dynamic:!0,providerMetadata:x[oe.tool_use_id].providerMetadata});return}default:{const Ne=Te;throw new Error(`Unsupported content block type: ${Ne}`)}}}case"content_block_stop":{if(m[ue.index]!=null){const oe=m[ue.index];switch(oe.type){case"text":{L.enqueue({type:"text-end",id:String(ue.index)});break}case"reasoning":{L.enqueue({type:"reasoning-end",id:String(ue.index)});break}case"tool-call":if(!(s&&oe.toolName==="json")){L.enqueue({type:"tool-input-end",id:oe.toolCallId});let Ne=oe.input===""?"{}":oe.input;if(oe.providerToolName==="code_execution")try{const be=JSON.parse(Ne);be!=null&&typeof be=="object"&&"code"in be&&!("type"in be)&&(Ne=JSON.stringify({type:"programmatic-tool-call",...be}))}catch{}L.enqueue({type:"tool-call",toolCallId:oe.toolCallId,toolName:oe.toolName,input:Ne,providerExecuted:oe.providerExecuted,...oe.caller&&{providerMetadata:{anthropic:{caller:oe.caller}}}})}break}delete m[ue.index]}C=void 0;return}case"content_block_delta":{const oe=ue.delta.type;switch(oe){case"text_delta":{if(s)return;L.enqueue({type:"text-delta",id:String(ue.index),delta:ue.delta.text});return}case"thinking_delta":{L.enqueue({type:"reasoning-delta",id:String(ue.index),delta:ue.delta.thinking});return}case"signature_delta":{C==="thinking"&&L.enqueue({type:"reasoning-delta",id:String(ue.index),delta:"",providerMetadata:{anthropic:{signature:ue.delta.signature}}});return}case"input_json_delta":{const Te=m[ue.index];let Ne=ue.delta.partial_json;if(Ne.length===0)return;if(E){if(Te?.type!=="text")return;L.enqueue({type:"text-delta",id:String(ue.index),delta:Ne})}else{if(Te?.type!=="tool-call")return;Te.firstDelta&&(Te.providerToolName==="bash_code_execution"||Te.providerToolName==="text_editor_code_execution")&&(Ne=`{"type": "${Te.providerToolName}",${Ne.substring(1)}`),L.enqueue({type:"tool-input-delta",id:Te.toolCallId,delta:Ne}),Te.input+=Ne,Te.firstDelta=!1}return}case"citations_delta":{const Te=ue.delta.citation,Ne=uU(Te,l,R);Ne&&L.enqueue(Ne);return}default:{const Te=oe;throw new Error(`Unsupported delta type: ${Te}`)}}}case"message_start":{if(f.input_tokens=ue.message.usage.input_tokens,f.cache_read_input_tokens=(Z=ue.message.usage.cache_read_input_tokens)!=null?Z:0,f.cache_creation_input_tokens=(Q=ue.message.usage.cache_creation_input_tokens)!=null?Q:0,w={...ue.message.usage},_=(z=ue.message.usage.cache_creation_input_tokens)!=null?z:null,ue.message.container!=null&&(M={expiresAt:ue.message.container.expires_at,id:ue.message.container.id,skills:null}),ue.message.stop_reason!=null&&(h={unified:rT({finishReason:ue.message.stop_reason,isJsonResponseFromTool:E}),raw:ue.message.stop_reason}),L.enqueue({type:"response-metadata",id:(W=ue.message.id)!=null?W:void 0,modelId:(X=ue.message.model)!=null?X:void 0}),ue.message.content!=null)for(let oe=0;oe<ue.message.content.length;oe++){const Te=ue.message.content[oe];if(Te.type==="tool_use"){const Ne=Te.caller,be=Ne?{type:Ne.type,toolId:"tool_id"in Ne?Ne.tool_id:void 0}:void 0;L.enqueue({type:"tool-input-start",id:Te.id,toolName:Te.name});const De=JSON.stringify((H=Te.input)!=null?H:{});L.enqueue({type:"tool-input-delta",id:Te.id,delta:De}),L.enqueue({type:"tool-input-end",id:Te.id}),L.enqueue({type:"tool-call",toolCallId:Te.id,toolName:Te.name,input:De,...be&&{providerMetadata:{anthropic:{caller:be}}}})}}return}case"message_delta":{ue.usage.input_tokens!=null&&f.input_tokens!==ue.usage.input_tokens&&(f.input_tokens=ue.usage.input_tokens),f.output_tokens=ue.usage.output_tokens,h={unified:rT({finishReason:ue.delta.stop_reason,isJsonResponseFromTool:E}),raw:(J=ue.delta.stop_reason)!=null?J:void 0},S=(te=ue.delta.stop_sequence)!=null?te:null,M=ue.delta.container!=null?{expiresAt:ue.delta.container.expires_at,id:ue.delta.container.id,skills:(se=(ee=ue.delta.container.skills)==null?void 0:ee.map(oe=>({type:oe.type,skillId:oe.skill_id,version:oe.version})))!=null?se:null}:null,ue.delta.context_management&&(y=cU(ue.delta.context_management)),w={...w,...ue.usage};return}case"message_stop":{L.enqueue({type:"finish",finishReason:h,usage:lU(f),providerMetadata:{anthropic:{usage:w??null,cacheCreationInputTokens:_,stopSequence:S,container:M,contextManagement:y}}});return}case"error":{L.enqueue({type:"error",error:ue.error});return}default:{const oe=ue;throw new Error(`Unsupported chunk type: ${oe}`)}}}})),[I,N]=k.tee(),D=I.getReader();try{await D.read();let F=await D.read();if(((e=F.value)==null?void 0:e.type)==="raw"&&(F=await D.read()),((n=F.value)==null?void 0:n.type)==="error"){const L=F.value.error;throw new ji({message:L.message,url:u,requestBodyValues:r,statusCode:L.type==="overloaded_error"?529:500,responseHeaders:c,responseBody:JSON.stringify(L),isRetryable:L.type==="overloaded_error"})}}finally{D.cancel().catch(()=>{}),D.releaseLock()}return{stream:N,request:{body:r},response:{headers:c}}}};function oIe(t){return t.includes("claude-sonnet-4-5")||t.includes("claude-opus-4-5")||t.includes("claude-haiku-4-5")?{maxOutputTokens:64e3,supportsStructuredOutput:!0,isKnownModel:!0}:t.includes("claude-opus-4-1")?{maxOutputTokens:32e3,supportsStructuredOutput:!0,isKnownModel:!0}:t.includes("claude-sonnet-4-")||t.includes("claude-3-7-sonnet")?{maxOutputTokens:64e3,supportsStructuredOutput:!1,isKnownModel:!0}:t.includes("claude-opus-4-")?{maxOutputTokens:32e3,supportsStructuredOutput:!1,isKnownModel:!0}:t.includes("claude-3-5-haiku")?{maxOutputTokens:8192,supportsStructuredOutput:!1,isKnownModel:!0}:t.includes("claude-3-haiku")?{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!0}:{maxOutputTokens:4096,supportsStructuredOutput:!1,isKnownModel:!1}}function cU(t){return t?{appliedEdits:t.applied_edits.map(e=>{switch(e.type){case"clear_tool_uses_20250919":return{type:e.type,clearedToolUses:e.cleared_tool_uses,clearedInputTokens:e.cleared_input_tokens};case"clear_thinking_20251015":return{type:e.type,clearedThinkingTurns:e.cleared_thinking_turns,clearedInputTokens:e.cleared_input_tokens}}}).filter(e=>e!==void 0)}:null}var lIe=at(()=>it(B({command:A(),restart:Ot().optional()}))),uIe=Qr({id:"anthropic.bash_20241022",inputSchema:lIe}),cIe=at(()=>it(B({command:A(),restart:Ot().optional()}))),dIe=Qr({id:"anthropic.bash_20250124",inputSchema:cIe}),hIe=at(()=>it(B({action:wt(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:Ce(ie().int()).optional(),text:A().optional()}))),fIe=Qr({id:"anthropic.computer_20241022",inputSchema:hIe}),pIe=at(()=>it(B({action:wt(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:x0([ie().int(),ie().int()]).optional(),duration:ie().optional(),scroll_amount:ie().optional(),scroll_direction:wt(["up","down","left","right"]).optional(),start_coordinate:x0([ie().int(),ie().int()]).optional(),text:A().optional()}))),mIe=Qr({id:"anthropic.computer_20250124",inputSchema:pIe}),gIe=at(()=>it(Zt("command",[B({command:ae("view"),path:A(),view_range:x0([ie(),ie()]).optional()}),B({command:ae("create"),path:A(),file_text:A()}),B({command:ae("str_replace"),path:A(),old_str:A(),new_str:A()}),B({command:ae("insert"),path:A(),insert_line:ie(),insert_text:A()}),B({command:ae("delete"),path:A()}),B({command:ae("rename"),old_path:A(),new_path:A()})]))),vIe=Qr({id:"anthropic.memory_20250818",inputSchema:gIe}),yIe=at(()=>it(B({command:wt(["view","create","str_replace","insert","undo_edit"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),xIe=Qr({id:"anthropic.text_editor_20241022",inputSchema:yIe}),bIe=at(()=>it(B({command:wt(["view","create","str_replace","insert","undo_edit"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),_Ie=Qr({id:"anthropic.text_editor_20250124",inputSchema:bIe}),wIe=at(()=>it(B({command:wt(["view","create","str_replace","insert"]),path:A(),file_text:A().optional(),insert_line:ie().int().optional(),new_str:A().optional(),old_str:A().optional(),view_range:Ce(ie().int()).optional()}))),SIe=Qr({id:"anthropic.text_editor_20250429",inputSchema:wIe}),EIe=at(()=>it(Ce(B({type:ae("tool_reference"),toolName:A()})))),TIe=at(()=>it(B({query:A(),limit:ie().optional()}))),CIe=Fr({id:"anthropic.tool_search_bm25_20251119",inputSchema:TIe,outputSchema:EIe}),MIe=(t={})=>CIe(t),AIe={bash_20241022:uIe,bash_20250124:dIe,codeExecution_20250522:X6e,codeExecution_20250825:J6e,computer_20241022:fIe,computer_20250124:mIe,memory_20250818:vIe,textEditor_20241022:xIe,textEditor_20250124:_Ie,textEditor_20250429:SIe,textEditor_20250728:F6e,webFetch_20250910:q6e,webSearch_20250305:j6e,toolSearchRegex_20251119:tIe,toolSearchBm25_20251119:MIe};function kIe(t={}){var e,n;const r=(e=rf(Kc({settingValue:t.baseURL,environmentVariableName:"ANTHROPIC_BASE_URL"})))!=null?e:"https://api.anthropic.com/v1",i=(n=t.name)!=null?n:"anthropic.messages",a=()=>To({"anthropic-version":"2023-06-01","x-api-key":i3({apiKey:t.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...t.headers},`ai-sdk/anthropic/${M6e}`),s=l=>{var u;return new sIe(l,{provider:i,baseURL:r,headers:a,fetch:t.fetch,generateId:(u=t.generateId)!=null?u:Ln,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]})})},o=function(l){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return s(l)};return o.specificationVersion="v3",o.languageModel=s,o.chat=s,o.messages=s,o.embeddingModel=l=>{throw new lI({modelId:l,modelType:"embeddingModel"})},o.textEmbeddingModel=o.embeddingModel,o.imageModel=l=>{throw new lI({modelId:l,modelType:"imageModel"})},o.tools=AIe,o}var IIe=kIe(),NIe="3.0.10",RIe=at(()=>it(B({error:B({code:ie().nullable(),message:A(),status:A()})}))),B1=Fa({errorSchema:RIe,errorToMessage:t=>t.error.message}),PIe=at(()=>it(B({outputDimensionality:ie().optional(),taskType:wt(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}))),DIe=class{constructor(t,e){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=t,this.config=e}get provider(){return this.config.provider}async doEmbed({values:t,headers:e,abortSignal:n,providerOptions:r}){const i=await sr({provider:"google",providerOptions:r,schema:PIe});if(t.length>this.maxEmbeddingsPerCall)throw new Tv({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const a=Mn(await Vr(this.config.headers),e);if(t.length===1){const{responseHeaders:u,value:c,rawValue:d}=await Fn({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:a,body:{model:`models/${this.modelId}`,content:{parts:[{text:t[0]}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType},failedResponseHandler:B1,successfulResponseHandler:vr(LIe),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:[c.embedding.values],usage:void 0,response:{headers:u,body:d}}}const{responseHeaders:s,value:o,rawValue:l}=await Fn({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:t.map(u=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:u}]},outputDimensionality:i?.outputDimensionality,taskType:i?.taskType}))},failedResponseHandler:B1,successfulResponseHandler:vr(OIe),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:o.embeddings.map(u=>u.values),usage:void 0,response:{headers:s,body:l}}}},OIe=at(()=>it(B({embeddings:Ce(B({values:Ce(ie())}))}))),LIe=at(()=>it(B({embedding:B({values:Ce(ie())})})));function dU(t){var e,n,r,i;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=(e=t.promptTokenCount)!=null?e:0,s=(n=t.candidatesTokenCount)!=null?n:0,o=(r=t.cachedContentTokenCount)!=null?r:0,l=(i=t.thoughtsTokenCount)!=null?i:0;return{inputTokens:{total:a,noCache:a-o,cacheRead:o,cacheWrite:void 0},outputTokens:{total:s+l,text:s,reasoning:l},raw:t}}function El(t,e=!0){if(t==null)return;if(FIe(t))return e?void 0:typeof t=="object"&&t.description?{type:"object",description:t.description}:{type:"object"};if(typeof t=="boolean")return{type:"boolean",properties:{}};const{type:n,description:r,required:i,properties:a,items:s,allOf:o,anyOf:l,oneOf:u,format:c,const:d,minLength:h,enum:f}=t,m={};if(r&&(m.description=r),i&&(m.required=i),c&&(m.format=c),d!==void 0&&(m.enum=[d]),n)if(Array.isArray(n)){const x=n.includes("null"),b=n.filter(y=>y!=="null");b.length===0?m.type="null":(m.anyOf=b.map(y=>({type:y})),x&&(m.nullable=!0))}else m.type=n;if(f!==void 0&&(m.enum=f),a!=null&&(m.properties=Object.entries(a).reduce((x,[b,y])=>(x[b]=El(y,!1),x),{})),s&&(m.items=Array.isArray(s)?s.map(x=>El(x,!1)):El(s,!1)),o&&(m.allOf=o.map(x=>El(x,!1))),l)if(l.some(x=>typeof x=="object"&&x?.type==="null")){const x=l.filter(b=>!(typeof b=="object"&&b?.type==="null"));if(x.length===1){const b=El(x[0],!1);typeof b=="object"&&(m.nullable=!0,Object.assign(m,b))}else m.anyOf=x.map(b=>El(b,!1)),m.nullable=!0}else m.anyOf=l.map(x=>El(x,!1));return u&&(m.oneOf=u.map(x=>El(x,!1))),h!==void 0&&(m.minLength=h),m}function FIe(t){return t!=null&&typeof t=="object"&&t.type==="object"&&(t.properties==null||Object.keys(t.properties).length===0)&&!t.additionalProperties}function BIe(t,e){var n,r,i;const a=[],s=[];let o=!0;const l=(n=e?.isGemmaModel)!=null?n:!1,u=(r=e?.providerOptionsName)!=null?r:"google";for(const{role:c,content:d}of t)switch(c){case"system":{if(!o)throw new Nn({functionality:"system messages are only supported at the beginning of the conversation"});a.push({text:d});break}case"user":{o=!1;const h=[];for(const f of d)switch(f.type){case"text":{h.push({text:f.text});break}case"file":{const m=f.mediaType==="image/*"?"image/jpeg":f.mediaType;h.push(f.data instanceof URL?{fileData:{mimeType:m,fileUri:f.data.toString()}}:{inlineData:{mimeType:m,data:oa(f.data)}});break}}s.push({role:"user",parts:h});break}case"assistant":{o=!1,s.push({role:"model",parts:d.map(h=>{var f;const m=(f=h.providerOptions)==null?void 0:f[u],x=m?.thoughtSignature!=null?String(m.thoughtSignature):void 0;switch(h.type){case"text":return h.text.length===0?void 0:{text:h.text,thoughtSignature:x};case"reasoning":return h.text.length===0?void 0:{text:h.text,thought:!0,thoughtSignature:x};case"file":{if(h.data instanceof URL)throw new Nn({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:h.mediaType,data:oa(h.data)},thoughtSignature:x}}case"tool-call":return{functionCall:{name:h.toolName,args:h.input},thoughtSignature:x}}}).filter(h=>h!==void 0)});break}case"tool":{o=!1;const h=[];for(const f of d){if(f.type==="tool-approval-response")continue;const m=f.output;if(m.type==="content")for(const x of m.value)switch(x.type){case"text":h.push({functionResponse:{name:f.toolName,response:{name:f.toolName,content:x.text}}});break;case"image-data":h.push({inlineData:{mimeType:x.mediaType,data:x.data}},{text:"Tool executed successfully and returned this image as a response"});break;default:h.push({text:JSON.stringify(x)});break}else h.push({functionResponse:{name:f.toolName,response:{name:f.toolName,content:m.type==="execution-denied"?(i=m.reason)!=null?i:"Tool execution denied.":m.value}}})}s.push({role:"user",parts:h});break}}if(l&&a.length>0&&s.length>0&&s[0].role==="user"){const c=a.map(d=>d.text).join(`

`);s[0].parts.unshift({text:c+`

`})}return{systemInstruction:a.length>0&&!l?{parts:a}:void 0,contents:s}}function hU(t){return t.includes("/")?t:`models/${t}`}var fU=at(()=>it(B({responseModalities:Ce(wt(["TEXT","IMAGE"])).optional(),thinkingConfig:B({thinkingBudget:ie().optional(),includeThoughts:Ot().optional(),thinkingLevel:wt(["minimal","low","medium","high"]).optional()}).optional(),cachedContent:A().optional(),structuredOutputs:Ot().optional(),safetySettings:Ce(B({category:wt(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:wt(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:wt(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:Ot().optional(),labels:sn(A(),A()).optional(),mediaResolution:wt(["MEDIA_RESOLUTION_UNSPECIFIED","MEDIA_RESOLUTION_LOW","MEDIA_RESOLUTION_MEDIUM","MEDIA_RESOLUTION_HIGH"]).optional(),imageConfig:B({aspectRatio:wt(["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"]).optional(),imageSize:wt(["1K","2K","4K"]).optional()}).optional(),retrievalConfig:B({latLng:B({latitude:ie(),longitude:ie()}).optional()}).optional()})));function UIe({tools:t,toolChoice:e,modelId:n}){var r;t=t?.length?t:void 0;const i=[],a=["gemini-flash-latest","gemini-flash-lite-latest","gemini-pro-latest"].some(f=>f===n),s=n.includes("gemini-2")||n.includes("gemini-3")||a,o=n.includes("gemini-1.5-flash")&&!n.includes("-8b"),l=n.includes("gemini-2.5")||n.includes("gemini-3");if(t==null)return{tools:void 0,toolConfig:void 0,toolWarnings:i};const u=t.some(f=>f.type==="function"),c=t.some(f=>f.type==="provider");if(u&&c&&i.push({type:"unsupported",feature:"combination of function and provider-defined tools"}),c){const f=[];return t.filter(x=>x.type==="provider").forEach(x=>{switch(x.id){case"google.google_search":s?f.push({googleSearch:{}}):o?f.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:x.args.mode,dynamicThreshold:x.args.dynamicThreshold}}}):f.push({googleSearchRetrieval:{}});break;case"google.enterprise_web_search":s?f.push({enterpriseWebSearch:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"Enterprise Web Search requires Gemini 2.0 or newer."});break;case"google.url_context":s?f.push({urlContext:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":s?f.push({codeExecution:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;case"google.file_search":l?f.push({fileSearch:{...x.args}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"The file search tool is only supported with Gemini 2.5 models and Gemini 3 models."});break;case"google.vertex_rag_store":s?f.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:x.args.ragCorpus},similarity_top_k:x.args.topK}}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"The RAG store tool is not supported with other Gemini models than Gemini 2."});break;case"google.google_maps":s?f.push({googleMaps:{}}):i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`,details:"The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer."});break;default:i.push({type:"unsupported",feature:`provider-defined tool ${x.id}`});break}}),{tools:f.length>0?f:void 0,toolConfig:void 0,toolWarnings:i}}const d=[];for(const f of t)switch(f.type){case"function":d.push({name:f.name,description:(r=f.description)!=null?r:"",parameters:El(f.inputSchema)});break;default:i.push({type:"unsupported",feature:`function tool ${f.name}`});break}if(e==null)return{tools:[{functionDeclarations:d}],toolConfig:void 0,toolWarnings:i};const h=e.type;switch(h){case"auto":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:i};case"none":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:i};case"required":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:i};case"tool":return{tools:[{functionDeclarations:d}],toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[e.toolName]}},toolWarnings:i};default:{const f=h;throw new Nn({functionality:`tool choice type: ${f}`})}}}function pU({finishReason:t,hasToolCalls:e}){switch(t){case"STOP":return e?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"MALFORMED_FUNCTION_CALL":return"error";case"FINISH_REASON_UNSPECIFIED":case"OTHER":default:return"other"}}var zIe=class{constructor(t,e){this.specificationVersion="v3";var n;this.modelId=t,this.config=e,this.generateId=(n=e.generateId)!=null?n:Ln}get provider(){return this.config.provider}get supportedUrls(){var t,e,n;return(n=(e=(t=this.config).supportedUrls)==null?void 0:e.call(t))!=null?n:{}}async getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:s,stopSequences:o,responseFormat:l,seed:u,tools:c,toolChoice:d,providerOptions:h}){var f;const m=[],x=this.config.provider.includes("vertex")?"vertex":"google";let b=await sr({provider:x,providerOptions:h,schema:fU});b==null&&x!=="google"&&(b=await sr({provider:"google",providerOptions:h,schema:fU})),c?.some(C=>C.type==="provider"&&C.id==="google.vertex_rag_store")&&!this.config.provider.startsWith("google.vertex.")&&m.push({type:"other",message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const y=this.modelId.toLowerCase().startsWith("gemma-"),{contents:w,systemInstruction:_}=BIe(t,{isGemmaModel:y,providerOptionsName:x}),{tools:S,toolConfig:M,toolWarnings:E}=UIe({tools:c,toolChoice:d,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:e,temperature:n,topK:i,topP:r,frequencyPenalty:a,presencePenalty:s,stopSequences:o,seed:u,responseMimeType:l?.type==="json"?"application/json":void 0,responseSchema:l?.type==="json"&&l.schema!=null&&((f=b?.structuredOutputs)==null||f)?El(l.schema):void 0,...b?.audioTimestamp&&{audioTimestamp:b.audioTimestamp},responseModalities:b?.responseModalities,thinkingConfig:b?.thinkingConfig,...b?.mediaResolution&&{mediaResolution:b.mediaResolution},...b?.imageConfig&&{imageConfig:b.imageConfig}},contents:w,systemInstruction:y?void 0:_,safetySettings:b?.safetySettings,tools:S,toolConfig:b?.retrievalConfig?{...M,retrievalConfig:b.retrievalConfig}:M,cachedContent:b?.cachedContent,labels:b?.labels},warnings:[...m,...E],providerOptionsName:x}}async doGenerate(t){var e,n,r,i,a,s,o,l,u;const{args:c,warnings:d,providerOptionsName:h}=await this.getArgs(t),f=Mn(await Vr(this.config.headers),t.headers),{responseHeaders:m,value:x,rawValue:b}=await Fn({url:`${this.config.baseURL}/${hU(this.modelId)}:generateContent`,headers:f,body:c,failedResponseHandler:B1,successfulResponseHandler:vr(HIe),abortSignal:t.abortSignal,fetch:this.config.fetch}),y=x.candidates[0],w=[],_=(n=(e=y.content)==null?void 0:e.parts)!=null?n:[],S=x.usageMetadata;let M;for(const C of _)if("executableCode"in C&&((r=C.executableCode)!=null&&r.code)){const R=this.config.generateId();M=R,w.push({type:"tool-call",toolCallId:R,toolName:"code_execution",input:JSON.stringify(C.executableCode),providerExecuted:!0})}else"codeExecutionResult"in C&&C.codeExecutionResult?(w.push({type:"tool-result",toolCallId:M,toolName:"code_execution",result:{outcome:C.codeExecutionResult.outcome,output:C.codeExecutionResult.output}}),M=void 0):"text"in C&&C.text!=null&&C.text.length>0?w.push({type:C.thought===!0?"reasoning":"text",text:C.text,providerMetadata:C.thoughtSignature?{[h]:{thoughtSignature:C.thoughtSignature}}:void 0}):"functionCall"in C?w.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:C.functionCall.name,input:JSON.stringify(C.functionCall.args),providerMetadata:C.thoughtSignature?{[h]:{thoughtSignature:C.thoughtSignature}}:void 0}):"inlineData"in C&&w.push({type:"file",data:C.inlineData.data,mediaType:C.inlineData.mimeType,providerMetadata:C.thoughtSignature?{[h]:{thoughtSignature:C.thoughtSignature}}:void 0});const E=(i=mU({groundingMetadata:y.groundingMetadata,generateId:this.config.generateId}))!=null?i:[];for(const C of E)w.push(C);return{content:w,finishReason:{unified:pU({finishReason:y.finishReason,hasToolCalls:w.some(C=>C.type==="tool-call"&&!C.providerExecuted)}),raw:(a=y.finishReason)!=null?a:void 0},usage:dU(S),warnings:d,providerMetadata:{[h]:{promptFeedback:(s=x.promptFeedback)!=null?s:null,groundingMetadata:(o=y.groundingMetadata)!=null?o:null,urlContextMetadata:(l=y.urlContextMetadata)!=null?l:null,safetyRatings:(u=y.safetyRatings)!=null?u:null,usageMetadata:S??null}},request:{body:c},response:{headers:m,body:b}}}async doStream(t){const{args:e,warnings:n,providerOptionsName:r}=await this.getArgs(t),i=Mn(await Vr(this.config.headers),t.headers),{responseHeaders:a,value:s}=await Fn({url:`${this.config.baseURL}/${hU(this.modelId)}:streamGenerateContent?alt=sse`,headers:i,body:e,failedResponseHandler:B1,successfulResponseHandler:Xu($Ie),abortSignal:t.abortSignal,fetch:this.config.fetch});let o={unified:"other",raw:void 0},l,u;const c=this.config.generateId;let d=!1,h=null,f=null,m=0;const x=new Set;let b;return{stream:s.pipeThrough(new TransformStream({start(y){y.enqueue({type:"stream-start",warnings:n})},transform(y,w){var _,S,M,E,C,R,k;if(t.includeRawChunks&&w.enqueue({type:"raw",rawValue:y.rawValue}),!y.success){w.enqueue({type:"error",error:y.error});return}const I=y.value,N=I.usageMetadata;N!=null&&(l=N);const D=(_=I.candidates)==null?void 0:_[0];if(D==null)return;const F=D.content,L=mU({groundingMetadata:D.groundingMetadata,generateId:c});if(L!=null)for(const U of L)U.sourceType==="url"&&!x.has(U.url)&&(x.add(U.url),w.enqueue(U));if(F!=null){const U=(S=F.parts)!=null?S:[];for(const q of U)if("executableCode"in q&&((M=q.executableCode)!=null&&M.code)){const Z=c();b=Z,w.enqueue({type:"tool-call",toolCallId:Z,toolName:"code_execution",input:JSON.stringify(q.executableCode),providerExecuted:!0})}else if("codeExecutionResult"in q&&q.codeExecutionResult){const Z=b;Z&&(w.enqueue({type:"tool-result",toolCallId:Z,toolName:"code_execution",result:{outcome:q.codeExecutionResult.outcome,output:q.codeExecutionResult.output}}),b=void 0)}else"text"in q&&q.text!=null&&q.text.length>0?q.thought===!0?(h!==null&&(w.enqueue({type:"text-end",id:h}),h=null),f===null&&(f=String(m++),w.enqueue({type:"reasoning-start",id:f,providerMetadata:q.thoughtSignature?{[r]:{thoughtSignature:q.thoughtSignature}}:void 0})),w.enqueue({type:"reasoning-delta",id:f,delta:q.text,providerMetadata:q.thoughtSignature?{[r]:{thoughtSignature:q.thoughtSignature}}:void 0})):(f!==null&&(w.enqueue({type:"reasoning-end",id:f}),f=null),h===null&&(h=String(m++),w.enqueue({type:"text-start",id:h,providerMetadata:q.thoughtSignature?{[r]:{thoughtSignature:q.thoughtSignature}}:void 0})),w.enqueue({type:"text-delta",id:h,delta:q.text,providerMetadata:q.thoughtSignature?{[r]:{thoughtSignature:q.thoughtSignature}}:void 0})):"inlineData"in q&&w.enqueue({type:"file",mediaType:q.inlineData.mimeType,data:q.inlineData.data});const j=jIe({parts:F.parts,generateId:c,providerOptionsName:r});if(j!=null)for(const q of j)w.enqueue({type:"tool-input-start",id:q.toolCallId,toolName:q.toolName,providerMetadata:q.providerMetadata}),w.enqueue({type:"tool-input-delta",id:q.toolCallId,delta:q.args,providerMetadata:q.providerMetadata}),w.enqueue({type:"tool-input-end",id:q.toolCallId,providerMetadata:q.providerMetadata}),w.enqueue({type:"tool-call",toolCallId:q.toolCallId,toolName:q.toolName,input:q.args,providerMetadata:q.providerMetadata}),d=!0}D.finishReason!=null&&(o={unified:pU({finishReason:D.finishReason,hasToolCalls:d}),raw:D.finishReason},u={[r]:{promptFeedback:(E=I.promptFeedback)!=null?E:null,groundingMetadata:(C=D.groundingMetadata)!=null?C:null,urlContextMetadata:(R=D.urlContextMetadata)!=null?R:null,safetyRatings:(k=D.safetyRatings)!=null?k:null}},N!=null&&(u[r].usageMetadata=N))},flush(y){h!==null&&y.enqueue({type:"text-end",id:h}),f!==null&&y.enqueue({type:"reasoning-end",id:f}),y.enqueue({type:"finish",finishReason:o,usage:dU(l),providerMetadata:u})}})),response:{headers:a},request:{body:e}}}};function jIe({parts:t,generateId:e,providerOptionsName:n}){const r=t?.filter(i=>"functionCall"in i);return r==null||r.length===0?void 0:r.map(i=>({type:"tool-call",toolCallId:e(),toolName:i.functionCall.name,args:JSON.stringify(i.functionCall.args),providerMetadata:i.thoughtSignature?{[n]:{thoughtSignature:i.thoughtSignature}}:void 0}))}function mU({groundingMetadata:t,generateId:e}){var n,r,i,a,s;if(!t?.groundingChunks)return;const o=[];for(const l of t.groundingChunks)if(l.web!=null)o.push({type:"source",sourceType:"url",id:e(),url:l.web.uri,title:(n=l.web.title)!=null?n:void 0});else if(l.retrievedContext!=null){const u=l.retrievedContext.uri,c=l.retrievedContext.fileSearchStore;if(u&&(u.startsWith("http://")||u.startsWith("https://")))o.push({type:"source",sourceType:"url",id:e(),url:u,title:(r=l.retrievedContext.title)!=null?r:void 0});else if(u){const d=(i=l.retrievedContext.title)!=null?i:"Unknown Document";let h="application/octet-stream",f;u.endsWith(".pdf")?(h="application/pdf",f=u.split("/").pop()):u.endsWith(".txt")?(h="text/plain",f=u.split("/").pop()):u.endsWith(".docx")?(h="application/vnd.openxmlformats-officedocument.wordprocessingml.document",f=u.split("/").pop()):u.endsWith(".doc")?(h="application/msword",f=u.split("/").pop()):(u.match(/\.(md|markdown)$/)&&(h="text/markdown"),f=u.split("/").pop()),o.push({type:"source",sourceType:"document",id:e(),mediaType:h,title:d,filename:f})}else if(c){const d=(a=l.retrievedContext.title)!=null?a:"Unknown Document";o.push({type:"source",sourceType:"document",id:e(),mediaType:"application/octet-stream",title:d,filename:c.split("/").pop()})}}else l.maps!=null&&l.maps.uri&&o.push({type:"source",sourceType:"url",id:e(),url:l.maps.uri,title:(s=l.maps.title)!=null?s:void 0});return o.length>0?o:void 0}var Ite=()=>B({webSearchQueries:Ce(A()).nullish(),retrievalQueries:Ce(A()).nullish(),searchEntryPoint:B({renderedContent:A()}).nullish(),groundingChunks:Ce(B({web:B({uri:A(),title:A().nullish()}).nullish(),retrievedContext:B({uri:A().nullish(),title:A().nullish(),text:A().nullish(),fileSearchStore:A().nullish()}).nullish(),maps:B({uri:A().nullish(),title:A().nullish(),text:A().nullish(),placeId:A().nullish()}).nullish()})).nullish(),groundingSupports:Ce(B({segment:B({startIndex:ie().nullish(),endIndex:ie().nullish(),text:A().nullish()}),segment_text:A().nullish(),groundingChunkIndices:Ce(ie()).nullish(),supportChunkIndices:Ce(ie()).nullish(),confidenceScores:Ce(ie()).nullish(),confidenceScore:Ce(ie()).nullish()})).nullish(),retrievalMetadata:vt([B({webDynamicRetrievalScore:ie()}),B({})]).nullish()}),Nte=()=>B({parts:Ce(vt([B({functionCall:B({name:A(),args:Zn()}),thoughtSignature:A().nullish()}),B({inlineData:B({mimeType:A(),data:A()}),thoughtSignature:A().nullish()}),B({executableCode:B({language:A(),code:A()}).nullish(),codeExecutionResult:B({outcome:A(),output:A()}).nullish(),text:A().nullish(),thought:Ot().nullish(),thoughtSignature:A().nullish()})])).nullish()}),_w=()=>B({category:A().nullish(),probability:A().nullish(),probabilityScore:ie().nullish(),severity:A().nullish(),severityScore:ie().nullish(),blocked:Ot().nullish()}),Rte=B({cachedContentTokenCount:ie().nullish(),thoughtsTokenCount:ie().nullish(),promptTokenCount:ie().nullish(),candidatesTokenCount:ie().nullish(),totalTokenCount:ie().nullish(),trafficType:A().nullish()}),Pte=()=>B({urlMetadata:Ce(B({retrievedUrl:A(),urlRetrievalStatus:A()}))}),HIe=at(()=>it(B({candidates:Ce(B({content:Nte().nullish().or(B({}).strict()),finishReason:A().nullish(),safetyRatings:Ce(_w()).nullish(),groundingMetadata:Ite().nullish(),urlContextMetadata:Pte().nullish()})),usageMetadata:Rte.nullish(),promptFeedback:B({blockReason:A().nullish(),safetyRatings:Ce(_w()).nullish()}).nullish()}))),$Ie=at(()=>it(B({candidates:Ce(B({content:Nte().nullish(),finishReason:A().nullish(),safetyRatings:Ce(_w()).nullish(),groundingMetadata:Ite().nullish(),urlContextMetadata:Pte().nullish()})).nullish(),usageMetadata:Rte.nullish(),promptFeedback:B({blockReason:A().nullish(),safetyRatings:Ce(_w()).nullish()}).nullish()}))),VIe=Fr({id:"google.code_execution",inputSchema:B({language:A().describe("The programming language of the code."),code:A().describe("The code to be executed.")}),outputSchema:B({outcome:A().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:A().describe("The output from the code execution.")})}),qIe=Qr({id:"google.enterprise_web_search",inputSchema:at(()=>it(B({})))}),GIe=B({fileSearchStoreNames:Ce(A()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:ie().int().positive().describe("The number of file search retrieval chunks to retrieve.").optional(),metadataFilter:A().describe("Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.").optional()}).passthrough(),WIe=at(()=>it(GIe)),YIe=Qr({id:"google.file_search",inputSchema:WIe}),XIe=Qr({id:"google.google_maps",inputSchema:at(()=>it(B({})))}),KIe=Qr({id:"google.google_search",inputSchema:at(()=>it(B({mode:wt(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:ie().default(1)})))}),ZIe=Qr({id:"google.url_context",inputSchema:at(()=>it(B({})))}),JIe=Qr({id:"google.vertex_rag_store",inputSchema:B({ragCorpus:A(),topK:ie().optional()})}),QIe={googleSearch:KIe,enterpriseWebSearch:qIe,googleMaps:XIe,urlContext:ZIe,fileSearch:YIe,codeExecution:VIe,vertexRagStore:JIe},eNe=class{constructor(t,e,n){this.modelId=t,this.settings=e,this.config=n,this.specificationVersion="v3"}get maxImagesPerCall(){var t;return(t=this.settings.maxImagesPerCall)!=null?t:4}get provider(){return this.config.provider}async doGenerate(t){var e,n,r;const{prompt:i,n:a=1,size:s,aspectRatio:o="1:1",seed:l,providerOptions:u,headers:c,abortSignal:d,files:h,mask:f}=t,m=[];if(h!=null&&h.length>0)throw new Error("Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");if(f!=null)throw new Error("Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");s!=null&&m.push({type:"unsupported",feature:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),l!=null&&m.push({type:"unsupported",feature:"seed",details:"This model does not support the `seed` option through this provider."});const x=await sr({provider:"google",providerOptions:u,schema:nNe}),b=(r=(n=(e=this.config._internal)==null?void 0:e.currentDate)==null?void 0:n.call(e))!=null?r:new Date,y={sampleCount:a};o!=null&&(y.aspectRatio=o),x&&Object.assign(y,x);const w={instances:[{prompt:i}],parameters:y},{responseHeaders:_,value:S}=await Fn({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:Mn(await Vr(this.config.headers),c),body:w,failedResponseHandler:B1,successfulResponseHandler:vr(tNe),abortSignal:d,fetch:this.config.fetch});return{images:S.predictions.map(M=>M.bytesBase64Encoded),warnings:m??[],providerMetadata:{google:{images:S.predictions.map(M=>({}))}},response:{timestamp:b,modelId:this.modelId,headers:_}}}},tNe=at(()=>it(B({predictions:Ce(B({bytesBase64Encoded:A()})).default([])}))),nNe=at(()=>it(B({personGeneration:wt(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:wt(["1:1","3:4","4:3","9:16","16:9"]).nullish()})));function rNe(t={}){var e,n;const r=(e=rf(t.baseURL))!=null?e:"https://generativelanguage.googleapis.com/v1beta",i=(n=t.name)!=null?n:"google.generative-ai",a=()=>To({"x-goog-api-key":i3({apiKey:t.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...t.headers},`ai-sdk/google/${NIe}`),s=c=>{var d;return new zIe(c,{provider:i,baseURL:r,headers:a,generateId:(d=t.generateId)!=null?d:Ln,supportedUrls:()=>({"*":[new RegExp(`^${r}/files/.*$`),new RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),new RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:t.fetch})},o=c=>new DIe(c,{provider:i,baseURL:r,headers:a,fetch:t.fetch}),l=(c,d={})=>new eNe(c,d,{provider:i,baseURL:r,headers:a,fetch:t.fetch}),u=function(c){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return s(c)};return u.specificationVersion="v3",u.languageModel=s,u.chat=s,u.generativeAI=s,u.embedding=o,u.embeddingModel=o,u.textEmbedding=o,u.textEmbeddingModel=o,u.image=l,u.imageModel=l,u.tools=QIe,u}var iNe=rNe(),fR=B({error:B({message:A(),type:A().nullish(),param:gr().nullish(),code:vt([A(),ie()]).nullish()})}),il=Fa({errorSchema:fR,errorToMessage:t=>t.error.message});function Dte(t){const e=t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat"),n=t.startsWith("gpt-4")||t.startsWith("gpt-5-mini")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-nano")&&!t.startsWith("gpt-5-chat")||t.startsWith("o3")||t.startsWith("o4-mini"),r=t.startsWith("o1")||t.startsWith("o3")||t.startsWith("o4-mini")||t.startsWith("codex-mini")||t.startsWith("computer-use-preview")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat"),i=t.startsWith("gpt-5.1")||t.startsWith("gpt-5.2");return{supportsFlexProcessing:e,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?"developer":"system",supportsNonReasoningParameters:i}}function gU(t){var e,n,r,i,a,s;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const o=(e=t.prompt_tokens)!=null?e:0,l=(n=t.completion_tokens)!=null?n:0,u=(i=(r=t.prompt_tokens_details)==null?void 0:r.cached_tokens)!=null?i:0,c=(s=(a=t.completion_tokens_details)==null?void 0:a.reasoning_tokens)!=null?s:0;return{inputTokens:{total:o,noCache:o-u,cacheRead:u,cacheWrite:void 0},outputTokens:{total:l,text:l-c,reasoning:c},raw:t}}function aNe({prompt:t,systemMessageMode:e="system"}){var n;const r=[],i=[];for(const{role:a,content:s}of t)switch(a){case"system":{switch(e){case"system":{r.push({role:"system",content:s});break}case"developer":{r.push({role:"developer",content:s});break}case"remove":{i.push({type:"other",message:"system messages are removed for this model"});break}default:{const o=e;throw new Error(`Unsupported system message mode: ${o}`)}}break}case"user":{if(s.length===1&&s[0].type==="text"){r.push({role:"user",content:s[0].text});break}r.push({role:"user",content:s.map((o,l)=>{var u,c,d;switch(o.type){case"text":return{type:"text",text:o.text};case"file":if(o.mediaType.startsWith("image/")){const h=o.mediaType==="image/*"?"image/jpeg":o.mediaType;return{type:"image_url",image_url:{url:o.data instanceof URL?o.data.toString():`data:${h};base64,${oa(o.data)}`,detail:(c=(u=o.providerOptions)==null?void 0:u.openai)==null?void 0:c.imageDetail}}}else if(o.mediaType.startsWith("audio/")){if(o.data instanceof URL)throw new Nn({functionality:"audio file parts with URLs"});switch(o.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:oa(o.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:oa(o.data),format:"mp3"}};default:throw new Nn({functionality:`audio content parts with media type ${o.mediaType}`})}}else if(o.mediaType==="application/pdf"){if(o.data instanceof URL)throw new Nn({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof o.data=="string"&&o.data.startsWith("file-")?{file_id:o.data}:{filename:(d=o.filename)!=null?d:`part-${l}.pdf`,file_data:`data:application/pdf;base64,${oa(o.data)}`}}}else throw new Nn({functionality:`file part media type ${o.mediaType}`})}})});break}case"assistant":{let o="";const l=[];for(const u of s)switch(u.type){case"text":{o+=u.text;break}case"tool-call":{l.push({id:u.toolCallId,type:"function",function:{name:u.toolName,arguments:JSON.stringify(u.input)}});break}}r.push({role:"assistant",content:o,tool_calls:l.length>0?l:void 0});break}case"tool":{for(const o of s){if(o.type==="tool-approval-response")continue;const l=o.output;let u;switch(l.type){case"text":case"error-text":u=l.value;break;case"execution-denied":u=(n=l.reason)!=null?n:"Tool execution denied.";break;case"content":case"json":case"error-json":u=JSON.stringify(l.value);break}r.push({role:"tool",tool_call_id:o.toolCallId,content:u})}break}default:{const o=a;throw new Error(`Unsupported role: ${o}`)}}return{messages:r,warnings:i}}function iT({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n?new Date(n*1e3):void 0}}function vU(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var sNe=at(()=>it(B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({message:B({role:ae("assistant").nullish(),content:A().nullish(),tool_calls:Ce(B({id:A().nullish(),type:ae("function"),function:B({name:A(),arguments:A()})})).nullish(),annotations:Ce(B({type:ae("url_citation"),url_citation:B({start_index:ie(),end_index:ie(),url:A(),title:A()})})).nullish()}),index:ie(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}).nullish(),finish_reason:A().nullish()})),usage:B({prompt_tokens:ie().nullish(),completion_tokens:ie().nullish(),total_tokens:ie().nullish(),prompt_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),completion_tokens_details:B({reasoning_tokens:ie().nullish(),accepted_prediction_tokens:ie().nullish(),rejected_prediction_tokens:ie().nullish()}).nullish()}).nullish()}))),oNe=at(()=>it(vt([B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({delta:B({role:wt(["assistant"]).nullish(),content:A().nullish(),tool_calls:Ce(B({index:ie(),id:A().nullish(),type:ae("function").nullish(),function:B({name:A().nullish(),arguments:A().nullish()})})).nullish(),annotations:Ce(B({type:ae("url_citation"),url_citation:B({start_index:ie(),end_index:ie(),url:A(),title:A()})})).nullish()}).nullish(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}).nullish(),finish_reason:A().nullish(),index:ie()})),usage:B({prompt_tokens:ie().nullish(),completion_tokens:ie().nullish(),total_tokens:ie().nullish(),prompt_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),completion_tokens_details:B({reasoning_tokens:ie().nullish(),accepted_prediction_tokens:ie().nullish(),rejected_prediction_tokens:ie().nullish()}).nullish()}).nullish()}),fR]))),lNe=at(()=>it(B({logitBias:sn(_Q(),ie()).optional(),logprobs:vt([Ot(),ie()]).optional(),parallelToolCalls:Ot().optional(),user:A().optional(),reasoningEffort:wt(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:ie().optional(),store:Ot().optional(),metadata:sn(A().max(64),A().max(512)).optional(),prediction:sn(A(),gr()).optional(),serviceTier:wt(["auto","flex","priority","default"]).optional(),strictJsonSchema:Ot().optional(),textVerbosity:wt(["low","medium","high"]).optional(),promptCacheKey:A().optional(),promptCacheRetention:wt(["in_memory","24h"]).optional(),safetyIdentifier:A().optional(),systemMessageMode:wt(["system","developer","remove"]).optional(),forceReasoning:Ot().optional()})));function uNe({tools:t,toolChoice:e}){t=t?.length?t:void 0;const n=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const a of t)switch(a.type){case"function":r.push({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema,...a.strict!=null?{strict:a.strict}:{}}});break;default:n.push({type:"unsupported",feature:`tool type: ${a.type}`});break}if(e==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const i=e.type;switch(i){case"auto":case"none":case"required":return{tools:r,toolChoice:i,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:e.toolName}},toolWarnings:n};default:{const a=i;throw new Nn({functionality:`tool choice type: ${a}`})}}}var cNe=class{constructor(t,e){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=t,this.config=e}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:s,stopSequences:o,responseFormat:l,seed:u,tools:c,toolChoice:d,providerOptions:h}){var f,m,x,b,y;const w=[],_=(f=await sr({provider:"openai",providerOptions:h,schema:lNe}))!=null?f:{},S=Dte(this.modelId),M=(m=_.forceReasoning)!=null?m:S.isReasoningModel;i!=null&&w.push({type:"unsupported",feature:"topK"});const{messages:E,warnings:C}=aNe({prompt:t,systemMessageMode:(x=_.systemMessageMode)!=null?x:M?"developer":S.systemMessageMode});w.push(...C);const R=(b=_.strictJsonSchema)!=null?b:!0,k={model:this.modelId,logit_bias:_.logitBias,logprobs:_.logprobs===!0||typeof _.logprobs=="number"?!0:void 0,top_logprobs:typeof _.logprobs=="number"?_.logprobs:typeof _.logprobs=="boolean"&&_.logprobs?0:void 0,user:_.user,parallel_tool_calls:_.parallelToolCalls,max_tokens:e,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:s,response_format:l?.type==="json"?l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:R,name:(y=l.name)!=null?y:"response",description:l.description}}:{type:"json_object"}:void 0,stop:o,seed:u,verbosity:_.textVerbosity,max_completion_tokens:_.maxCompletionTokens,store:_.store,metadata:_.metadata,prediction:_.prediction,reasoning_effort:_.reasoningEffort,service_tier:_.serviceTier,prompt_cache_key:_.promptCacheKey,prompt_cache_retention:_.promptCacheRetention,safety_identifier:_.safetyIdentifier,messages:E};M?((_.reasoningEffort!=="none"||!S.supportsNonReasoningParameters)&&(k.temperature!=null&&(k.temperature=void 0,w.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),k.top_p!=null&&(k.top_p=void 0,w.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"})),k.logprobs!=null&&(k.logprobs=void 0,w.push({type:"other",message:"logprobs is not supported for reasoning models"}))),k.frequency_penalty!=null&&(k.frequency_penalty=void 0,w.push({type:"unsupported",feature:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),k.presence_penalty!=null&&(k.presence_penalty=void 0,w.push({type:"unsupported",feature:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),k.logit_bias!=null&&(k.logit_bias=void 0,w.push({type:"other",message:"logitBias is not supported for reasoning models"})),k.top_logprobs!=null&&(k.top_logprobs=void 0,w.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),k.max_tokens!=null&&(k.max_completion_tokens==null&&(k.max_completion_tokens=k.max_tokens),k.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&k.temperature!=null&&(k.temperature=void 0,w.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),_.serviceTier==="flex"&&!S.supportsFlexProcessing&&(w.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),k.service_tier=void 0),_.serviceTier==="priority"&&!S.supportsPriorityProcessing&&(w.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),k.service_tier=void 0);const{tools:I,toolChoice:N,toolWarnings:D}=uNe({tools:c,toolChoice:d});return{args:{...k,tools:I,tool_choice:N},warnings:[...w,...D]}}async doGenerate(t){var e,n,r,i,a,s,o;const{args:l,warnings:u}=await this.getArgs(t),{responseHeaders:c,value:d,rawValue:h}=await Fn({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:l,failedResponseHandler:il,successfulResponseHandler:vr(sNe),abortSignal:t.abortSignal,fetch:this.config.fetch}),f=d.choices[0],m=[],x=f.message.content;x!=null&&x.length>0&&m.push({type:"text",text:x});for(const w of(e=f.message.tool_calls)!=null?e:[])m.push({type:"tool-call",toolCallId:(n=w.id)!=null?n:Ln(),toolName:w.function.name,input:w.function.arguments});for(const w of(r=f.message.annotations)!=null?r:[])m.push({type:"source",sourceType:"url",id:Ln(),url:w.url_citation.url,title:w.url_citation.title});const b=(i=d.usage)==null?void 0:i.completion_tokens_details;(a=d.usage)==null||a.prompt_tokens_details;const y={openai:{}};return b?.accepted_prediction_tokens!=null&&(y.openai.acceptedPredictionTokens=b?.accepted_prediction_tokens),b?.rejected_prediction_tokens!=null&&(y.openai.rejectedPredictionTokens=b?.rejected_prediction_tokens),((s=f.logprobs)==null?void 0:s.content)!=null&&(y.openai.logprobs=f.logprobs.content),{content:m,finishReason:{unified:vU(f.finish_reason),raw:(o=f.finish_reason)!=null?o:void 0},usage:gU(d.usage),request:{body:l},response:{...iT(d),headers:c,body:h},warnings:u,providerMetadata:y}}async doStream(t){const{args:e,warnings:n}=await this.getArgs(t),r={...e,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await Fn({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:r,failedResponseHandler:il,successfulResponseHandler:Xu(oNe),abortSignal:t.abortSignal,fetch:this.config.fetch}),s=[];let o={unified:"other",raw:void 0},l,u=!1,c=!1;const d={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(h){h.enqueue({type:"stream-start",warnings:n})},transform(h,f){var m,x,b,y,w,_,S,M,E,C,R,k,I,N,D,F,L;if(t.includeRawChunks&&f.enqueue({type:"raw",rawValue:h.rawValue}),!h.success){o={unified:"error",raw:void 0},f.enqueue({type:"error",error:h.error});return}const U=h.value;if("error"in U){o={unified:"error",raw:void 0},f.enqueue({type:"error",error:U.error});return}if(!u){const Z=iT(U);Object.values(Z).some(Boolean)&&(u=!0,f.enqueue({type:"response-metadata",...iT(U)}))}U.usage!=null&&(l=U.usage,((m=U.usage.completion_tokens_details)==null?void 0:m.accepted_prediction_tokens)!=null&&(d.openai.acceptedPredictionTokens=(x=U.usage.completion_tokens_details)==null?void 0:x.accepted_prediction_tokens),((b=U.usage.completion_tokens_details)==null?void 0:b.rejected_prediction_tokens)!=null&&(d.openai.rejectedPredictionTokens=(y=U.usage.completion_tokens_details)==null?void 0:y.rejected_prediction_tokens));const j=U.choices[0];if(j?.finish_reason!=null&&(o={unified:vU(j.finish_reason),raw:j.finish_reason}),((w=j?.logprobs)==null?void 0:w.content)!=null&&(d.openai.logprobs=j.logprobs.content),j?.delta==null)return;const q=j.delta;if(q.content!=null&&(c||(f.enqueue({type:"text-start",id:"0"}),c=!0),f.enqueue({type:"text-delta",id:"0",delta:q.content})),q.tool_calls!=null)for(const Z of q.tool_calls){const Q=Z.index;if(s[Q]==null){if(Z.type!=="function")throw new Hh({data:Z,message:"Expected 'function' type."});if(Z.id==null)throw new Hh({data:Z,message:"Expected 'id' to be a string."});if(((_=Z.function)==null?void 0:_.name)==null)throw new Hh({data:Z,message:"Expected 'function.name' to be a string."});f.enqueue({type:"tool-input-start",id:Z.id,toolName:Z.function.name}),s[Q]={id:Z.id,type:"function",function:{name:Z.function.name,arguments:(S=Z.function.arguments)!=null?S:""},hasFinished:!1};const W=s[Q];((M=W.function)==null?void 0:M.name)!=null&&((E=W.function)==null?void 0:E.arguments)!=null&&(W.function.arguments.length>0&&f.enqueue({type:"tool-input-delta",id:W.id,delta:W.function.arguments}),gw(W.function.arguments)&&(f.enqueue({type:"tool-input-end",id:W.id}),f.enqueue({type:"tool-call",toolCallId:(C=W.id)!=null?C:Ln(),toolName:W.function.name,input:W.function.arguments}),W.hasFinished=!0));continue}const z=s[Q];z.hasFinished||(((R=Z.function)==null?void 0:R.arguments)!=null&&(z.function.arguments+=(I=(k=Z.function)==null?void 0:k.arguments)!=null?I:""),f.enqueue({type:"tool-input-delta",id:z.id,delta:(N=Z.function.arguments)!=null?N:""}),((D=z.function)==null?void 0:D.name)!=null&&((F=z.function)==null?void 0:F.arguments)!=null&&gw(z.function.arguments)&&(f.enqueue({type:"tool-input-end",id:z.id}),f.enqueue({type:"tool-call",toolCallId:(L=z.id)!=null?L:Ln(),toolName:z.function.name,input:z.function.arguments}),z.hasFinished=!0))}if(q.annotations!=null)for(const Z of q.annotations)f.enqueue({type:"source",sourceType:"url",id:Ln(),url:Z.url_citation.url,title:Z.url_citation.title})},flush(h){c&&h.enqueue({type:"text-end",id:"0"}),h.enqueue({type:"finish",finishReason:o,usage:gU(l),...d!=null?{providerMetadata:d}:{}})}})),request:{body:r},response:{headers:i}}}};function yU(t){var e,n,r,i;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=(e=t.prompt_tokens)!=null?e:0,s=(n=t.completion_tokens)!=null?n:0;return{inputTokens:{total:(r=t.prompt_tokens)!=null?r:void 0,noCache:a,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:(i=t.completion_tokens)!=null?i:void 0,text:s,reasoning:void 0},raw:t}}function dNe({prompt:t,user:e="user",assistant:n="assistant"}){let r="";t[0].role==="system"&&(r+=`${t[0].content}

`,t=t.slice(1));for(const{role:i,content:a}of t)switch(i){case"system":throw new Mu({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const s=a.map(o=>{switch(o.type){case"text":return o.text}}).filter(Boolean).join("");r+=`${e}:
${s}

`;break}case"assistant":{const s=a.map(o=>{switch(o.type){case"text":return o.text;case"tool-call":throw new Nn({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${s}

`;break}case"tool":throw new Nn({functionality:"tool messages"});default:{const s=i;throw new Error(`Unsupported role: ${s}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${e}:`]}}function xU({id:t,model:e,created:n}){return{id:t??void 0,modelId:e??void 0,timestamp:n!=null?new Date(n*1e3):void 0}}function bU(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var hNe=at(()=>it(B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({text:A(),finish_reason:A(),logprobs:B({tokens:Ce(A()),token_logprobs:Ce(ie()),top_logprobs:Ce(sn(A(),ie())).nullish()}).nullish()})),usage:B({prompt_tokens:ie(),completion_tokens:ie(),total_tokens:ie()}).nullish()}))),fNe=at(()=>it(vt([B({id:A().nullish(),created:ie().nullish(),model:A().nullish(),choices:Ce(B({text:A(),finish_reason:A().nullish(),index:ie(),logprobs:B({tokens:Ce(A()),token_logprobs:Ce(ie()),top_logprobs:Ce(sn(A(),ie())).nullish()}).nullish()})),usage:B({prompt_tokens:ie(),completion_tokens:ie(),total_tokens:ie()}).nullish()}),fR]))),_U=at(()=>it(B({echo:Ot().optional(),logitBias:sn(A(),ie()).optional(),suffix:A().optional(),user:A().optional(),logprobs:vt([Ot(),ie()]).optional()}))),pNe=class{constructor(t,e){this.specificationVersion="v3",this.supportedUrls={},this.modelId=t,this.config=e}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:s,stopSequences:o,responseFormat:l,tools:u,toolChoice:c,seed:d,providerOptions:h}){const f=[],m={...await sr({provider:"openai",providerOptions:h,schema:_U}),...await sr({provider:this.providerOptionsName,providerOptions:h,schema:_U})};i!=null&&f.push({type:"unsupported",feature:"topK"}),u?.length&&f.push({type:"unsupported",feature:"tools"}),c!=null&&f.push({type:"unsupported",feature:"toolChoice"}),l!=null&&l.type!=="text"&&f.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:x,stopSequences:b}=dNe({prompt:t}),y=[...b??[],...o??[]];return{args:{model:this.modelId,echo:m.echo,logit_bias:m.logitBias,logprobs:m?.logprobs===!0?0:m?.logprobs===!1?void 0:m?.logprobs,suffix:m.suffix,user:m.user,max_tokens:e,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:s,seed:d,prompt:x,stop:y.length>0?y:void 0},warnings:f}}async doGenerate(t){var e;const{args:n,warnings:r}=await this.getArgs(t),{responseHeaders:i,value:a,rawValue:s}=await Fn({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:n,failedResponseHandler:il,successfulResponseHandler:vr(hNe),abortSignal:t.abortSignal,fetch:this.config.fetch}),o=a.choices[0],l={openai:{}};return o.logprobs!=null&&(l.openai.logprobs=o.logprobs),{content:[{type:"text",text:o.text}],usage:yU(a.usage),finishReason:{unified:bU(o.finish_reason),raw:(e=o.finish_reason)!=null?e:void 0},request:{body:n},response:{...xU(a),headers:i,body:s},providerMetadata:l,warnings:r}}async doStream(t){const{args:e,warnings:n}=await this.getArgs(t),r={...e,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await Fn({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:r,failedResponseHandler:il,successfulResponseHandler:Xu(fNe),abortSignal:t.abortSignal,fetch:this.config.fetch});let s={unified:"other",raw:void 0};const o={openai:{}};let l,u=!0;return{stream:a.pipeThrough(new TransformStream({start(c){c.enqueue({type:"stream-start",warnings:n})},transform(c,d){if(t.includeRawChunks&&d.enqueue({type:"raw",rawValue:c.rawValue}),!c.success){s={unified:"error",raw:void 0},d.enqueue({type:"error",error:c.error});return}const h=c.value;if("error"in h){s={unified:"error",raw:void 0},d.enqueue({type:"error",error:h.error});return}u&&(u=!1,d.enqueue({type:"response-metadata",...xU(h)}),d.enqueue({type:"text-start",id:"0"})),h.usage!=null&&(l=h.usage);const f=h.choices[0];f?.finish_reason!=null&&(s={unified:bU(f.finish_reason),raw:f.finish_reason}),f?.logprobs!=null&&(o.openai.logprobs=f.logprobs),f?.text!=null&&f.text.length>0&&d.enqueue({type:"text-delta",id:"0",delta:f.text})},flush(c){u||c.enqueue({type:"text-end",id:"0"}),c.enqueue({type:"finish",finishReason:s,providerMetadata:o,usage:yU(l)})}})),request:{body:r},response:{headers:i}}}},mNe=at(()=>it(B({dimensions:ie().optional(),user:A().optional()}))),gNe=at(()=>it(B({data:Ce(B({embedding:Ce(ie())})),usage:B({prompt_tokens:ie()}).nullish()}))),vNe=class{constructor(t,e){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=t,this.config=e}get provider(){return this.config.provider}async doEmbed({values:t,headers:e,abortSignal:n,providerOptions:r}){var i;if(t.length>this.maxEmbeddingsPerCall)throw new Tv({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const a=(i=await sr({provider:"openai",providerOptions:r,schema:mNe}))!=null?i:{},{responseHeaders:s,value:o,rawValue:l}=await Fn({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Mn(this.config.headers(),e),body:{model:this.modelId,input:t,encoding_format:"float",dimensions:a.dimensions,user:a.user},failedResponseHandler:il,successfulResponseHandler:vr(gNe),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:o.data.map(u=>u.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,response:{headers:s,body:l}}}},wU=at(()=>it(B({created:ie().nullish(),data:Ce(B({b64_json:A(),revised_prompt:A().nullish()})),background:A().nullish(),output_format:A().nullish(),size:A().nullish(),quality:A().nullish(),usage:B({input_tokens:ie().nullish(),output_tokens:ie().nullish(),total_tokens:ie().nullish(),input_tokens_details:B({image_tokens:ie().nullish(),text_tokens:ie().nullish()}).nullish()}).nullish()}))),yNe={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},xNe=["gpt-image-1-mini","gpt-image-1.5","gpt-image-1"];function bNe(t){return xNe.some(e=>t.startsWith(e))}var _Ne=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3"}get maxImagesPerCall(){var t;return(t=yNe[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:t,files:e,mask:n,n:r,size:i,aspectRatio:a,seed:s,providerOptions:o,headers:l,abortSignal:u}){var c,d,h,f,m,x,b,y,w,_,S;const M=[];a!=null&&M.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),s!=null&&M.push({type:"unsupported",feature:"seed"});const E=(h=(d=(c=this.config._internal)==null?void 0:c.currentDate)==null?void 0:d.call(c))!=null?h:new Date;if(e!=null){const{value:k,responseHeaders:I}=await s3({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:Mn(this.config.headers(),l),formData:wQ({model:this.modelId,prompt:t,image:await Promise.all(e.map(N=>N.type==="file"?new Blob([N.data instanceof Uint8Array?new Blob([N.data],{type:N.mediaType}):new Blob([Yu(N.data)],{type:N.mediaType})],{type:N.mediaType}):r3(N.url))),mask:n!=null?await wNe(n):void 0,n:r,size:i,...(f=o.openai)!=null?f:{}}),failedResponseHandler:il,successfulResponseHandler:vr(wU),abortSignal:u,fetch:this.config.fetch});return{images:k.data.map(N=>N.b64_json),warnings:M,usage:k.usage!=null?{inputTokens:(m=k.usage.input_tokens)!=null?m:void 0,outputTokens:(x=k.usage.output_tokens)!=null?x:void 0,totalTokens:(b=k.usage.total_tokens)!=null?b:void 0}:void 0,response:{timestamp:E,modelId:this.modelId,headers:I},providerMetadata:{openai:{images:k.data.map(N=>{var D,F,L,U,j;return{...N.revised_prompt?{revisedPrompt:N.revised_prompt}:{},created:(D=k.created)!=null?D:void 0,size:(F=k.size)!=null?F:void 0,quality:(L=k.quality)!=null?L:void 0,background:(U=k.background)!=null?U:void 0,outputFormat:(j=k.output_format)!=null?j:void 0}})}}}}const{value:C,responseHeaders:R}=await Fn({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Mn(this.config.headers(),l),body:{model:this.modelId,prompt:t,n:r,size:i,...(y=o.openai)!=null?y:{},...bNe(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:il,successfulResponseHandler:vr(wU),abortSignal:u,fetch:this.config.fetch});return{images:C.data.map(k=>k.b64_json),warnings:M,usage:C.usage!=null?{inputTokens:(w=C.usage.input_tokens)!=null?w:void 0,outputTokens:(_=C.usage.output_tokens)!=null?_:void 0,totalTokens:(S=C.usage.total_tokens)!=null?S:void 0}:void 0,response:{timestamp:E,modelId:this.modelId,headers:R},providerMetadata:{openai:{images:C.data.map(k=>{var I,N,D,F,L;return{...k.revised_prompt?{revisedPrompt:k.revised_prompt}:{},created:(I=C.created)!=null?I:void 0,size:(N=C.size)!=null?N:void 0,quality:(D=C.quality)!=null?D:void 0,background:(F=C.background)!=null?F:void 0,outputFormat:(L=C.output_format)!=null?L:void 0}})}}}}};async function wNe(t){if(!t)return;if(t.type==="url")return r3(t.url);const e=t.data instanceof Uint8Array?t.data:Yu(t.data);return new Blob([e],{type:t.mediaType})}var SNe=at(()=>it(B({text:A(),language:A().nullish(),duration:ie().nullish(),words:Ce(B({word:A(),start:ie(),end:ie()})).nullish(),segments:Ce(B({id:ie(),seek:ie(),start:ie(),end:ie(),text:A(),tokens:Ce(ie()),temperature:ie(),avg_logprob:ie(),compression_ratio:ie(),no_speech_prob:ie()})).nullish()}))),ENe=at(()=>it(B({include:Ce(A()).optional(),language:A().optional(),prompt:A().optional(),temperature:ie().min(0).max(1).default(0).optional(),timestampGranularities:Ce(wt(["word","segment"])).default(["segment"]).optional()}))),SU={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},TNe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({audio:t,mediaType:e,providerOptions:n}){const r=[],i=await sr({provider:"openai",providerOptions:n,schema:ENe}),a=new FormData,s=t instanceof Uint8Array?new Blob([t]):new Blob([Yu(t)]);a.append("model",this.modelId);const o=MQ(e);if(a.append("file",new File([s],"audio",{type:e}),`audio.${o}`),i){const l={include:i.include,language:i.language,prompt:i.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(const[u,c]of Object.entries(l))if(c!=null)if(Array.isArray(c))for(const d of c)a.append(`${u}[]`,String(d));else a.append(u,String(c))}return{formData:a,warnings:r}}async doGenerate(t){var e,n,r,i,a,s,o,l;const u=(r=(n=(e=this.config._internal)==null?void 0:e.currentDate)==null?void 0:n.call(e))!=null?r:new Date,{formData:c,warnings:d}=await this.getArgs(t),{value:h,responseHeaders:f,rawValue:m}=await s3({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),formData:c,failedResponseHandler:il,successfulResponseHandler:vr(SNe),abortSignal:t.abortSignal,fetch:this.config.fetch}),x=h.language!=null&&h.language in SU?SU[h.language]:void 0;return{text:h.text,segments:(o=(s=(i=h.segments)==null?void 0:i.map(b=>({text:b.text,startSecond:b.start,endSecond:b.end})))!=null?s:(a=h.words)==null?void 0:a.map(b=>({text:b.word,startSecond:b.start,endSecond:b.end})))!=null?o:[],language:x,durationInSeconds:(l=h.duration)!=null?l:void 0,warnings:d,response:{timestamp:u,modelId:this.modelId,headers:f,body:m}}}},CNe=at(()=>it(B({instructions:A().nullish(),speed:ie().min(.25).max(4).default(1).nullish()}))),MNe=class{constructor(t,e){this.modelId=t,this.config=e,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({text:t,voice:e="alloy",outputFormat:n="mp3",speed:r,instructions:i,language:a,providerOptions:s}){const o=[],l=await sr({provider:"openai",providerOptions:s,schema:CNe}),u={model:this.modelId,input:t,voice:e,response_format:"mp3",speed:r,instructions:i};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?u.response_format=n:o.push({type:"unsupported",feature:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),l){const c={};for(const d in c){const h=c[d];h!==void 0&&(u[d]=h)}}return a&&o.push({type:"unsupported",feature:"language",details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:u,warnings:o}}async doGenerate(t){var e,n,r;const i=(r=(n=(e=this.config._internal)==null?void 0:e.currentDate)==null?void 0:n.call(e))!=null?r:new Date,{requestBody:a,warnings:s}=await this.getArgs(t),{value:o,responseHeaders:l,rawValue:u}=await Fn({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:a,failedResponseHandler:il,successfulResponseHandler:PQ(),abortSignal:t.abortSignal,fetch:this.config.fetch});return{audio:o,warnings:s,request:{body:JSON.stringify(a)},response:{timestamp:i,modelId:this.modelId,headers:l,body:u}}}};function EU(t){var e,n,r,i;if(t==null)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=t.input_tokens,s=t.output_tokens,o=(n=(e=t.input_tokens_details)==null?void 0:e.cached_tokens)!=null?n:0,l=(i=(r=t.output_tokens_details)==null?void 0:r.reasoning_tokens)!=null?i:0;return{inputTokens:{total:a,noCache:a-o,cacheRead:o,cacheWrite:void 0},outputTokens:{total:s,text:s-l,reasoning:l},raw:t}}var ANe=at(()=>it(B({status:wt(["completed","failed"]),output:A().optional()}))),kNe=at(()=>it(B({action:B({type:ae("exec"),command:Ce(A()),timeoutMs:ie().optional(),user:A().optional(),workingDirectory:A().optional(),env:sn(A(),A()).optional()})}))),INe=at(()=>it(B({output:A()}))),NNe=at(()=>it(B({action:B({commands:Ce(A()),timeoutMs:ie().optional(),maxOutputLength:ie().optional()})}))),RNe=at(()=>it(B({output:Ce(B({stdout:A(),stderr:A(),outcome:Zt("type",[B({type:ae("timeout")}),B({type:ae("exit"),exitCode:ie()})])}))})));function TU(t,e){return e?e.some(n=>t.startsWith(n)):!1}async function PNe({prompt:t,toolNameMapping:e,systemMessageMode:n,providerOptionsName:r,fileIdPrefixes:i,store:a,hasLocalShellTool:s=!1,hasShellTool:o=!1,hasApplyPatchTool:l=!1}){var u,c,d,h,f,m,x,b,y,w,_,S,M;const E=[],C=[],R=new Set;for(const{role:k,content:I}of t)switch(k){case"system":{switch(n){case"system":{E.push({role:"system",content:I});break}case"developer":{E.push({role:"developer",content:I});break}case"remove":{C.push({type:"other",message:"system messages are removed for this model"});break}default:{const N=n;throw new Error(`Unsupported system message mode: ${N}`)}}break}case"user":{E.push({role:"user",content:I.map((N,D)=>{var F,L,U;switch(N.type){case"text":return{type:"input_text",text:N.text};case"file":if(N.mediaType.startsWith("image/")){const j=N.mediaType==="image/*"?"image/jpeg":N.mediaType;return{type:"input_image",...N.data instanceof URL?{image_url:N.data.toString()}:typeof N.data=="string"&&TU(N.data,i)?{file_id:N.data}:{image_url:`data:${j};base64,${oa(N.data)}`},detail:(L=(F=N.providerOptions)==null?void 0:F[r])==null?void 0:L.imageDetail}}else{if(N.mediaType==="application/pdf")return N.data instanceof URL?{type:"input_file",file_url:N.data.toString()}:{type:"input_file",...typeof N.data=="string"&&TU(N.data,i)?{file_id:N.data}:{filename:(U=N.filename)!=null?U:`part-${D}.pdf`,file_data:`data:application/pdf;base64,${oa(N.data)}`}};throw new Nn({functionality:`file part media type ${N.mediaType}`})}}})});break}case"assistant":{const N={};for(const D of I)switch(D.type){case"text":{const F=(c=(u=D.providerOptions)==null?void 0:u[r])==null?void 0:c.itemId;if(a&&F!=null){E.push({type:"item_reference",id:F});break}E.push({role:"assistant",content:[{type:"output_text",text:D.text}],id:F});break}case"tool-call":{const F=(x=(h=(d=D.providerOptions)==null?void 0:d[r])==null?void 0:h.itemId)!=null?x:(m=(f=D.providerMetadata)==null?void 0:f[r])==null?void 0:m.itemId;if(D.providerExecuted){a&&F!=null&&E.push({type:"item_reference",id:F});break}if(a&&F!=null){E.push({type:"item_reference",id:F});break}const L=e.toProviderToolName(D.toolName);if(s&&L==="local_shell"){const U=await Kn({value:D.input,schema:kNe});E.push({type:"local_shell_call",call_id:D.toolCallId,id:F,action:{type:"exec",command:U.action.command,timeout_ms:U.action.timeoutMs,user:U.action.user,working_directory:U.action.workingDirectory,env:U.action.env}});break}if(o&&L==="shell"){const U=await Kn({value:D.input,schema:NNe});E.push({type:"shell_call",call_id:D.toolCallId,id:F,status:"completed",action:{commands:U.action.commands,timeout_ms:U.action.timeoutMs,max_output_length:U.action.maxOutputLength}});break}E.push({type:"function_call",call_id:D.toolCallId,name:L,arguments:JSON.stringify(D.input),id:F});break}case"tool-result":{if(D.output.type==="execution-denied"||D.output.type==="json"&&typeof D.output.value=="object"&&D.output.value!=null&&"type"in D.output.value&&D.output.value.type==="execution-denied")break;if(a){const F=(w=(y=(b=D.providerMetadata)==null?void 0:b[r])==null?void 0:y.itemId)!=null?w:D.toolCallId;E.push({type:"item_reference",id:F})}else C.push({type:"other",message:`Results for OpenAI tool ${D.toolName} are not sent to the API when store is false`});break}case"reasoning":{const F=await sr({provider:r,providerOptions:D.providerOptions,schema:DNe}),L=F?.itemId;if(L!=null){const U=N[L];if(a)U===void 0&&(E.push({type:"item_reference",id:L}),N[L]={type:"reasoning",id:L,summary:[]});else{const j=[];D.text.length>0?j.push({type:"summary_text",text:D.text}):U!==void 0&&C.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(D)}.`}),U===void 0?(N[L]={type:"reasoning",id:L,encrypted_content:F?.reasoningEncryptedContent,summary:j},E.push(N[L])):(U.summary.push(...j),F?.reasoningEncryptedContent!=null&&(U.encrypted_content=F.reasoningEncryptedContent))}}else C.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(D)}.`});break}}break}case"tool":{for(const N of I){if(N.type==="tool-approval-response"){const U=N;if(R.has(U.approvalId))continue;R.add(U.approvalId),a&&E.push({type:"item_reference",id:U.approvalId}),E.push({type:"mcp_approval_response",approval_request_id:U.approvalId,approve:U.approved});continue}const D=N.output;if(D.type==="execution-denied"&&((S=(_=D.providerOptions)==null?void 0:_.openai)==null?void 0:S.approvalId))continue;const F=e.toProviderToolName(N.toolName);if(s&&F==="local_shell"&&D.type==="json"){const U=await Kn({value:D.value,schema:INe});E.push({type:"local_shell_call_output",call_id:N.toolCallId,output:U.output});continue}if(o&&F==="shell"&&D.type==="json"){const U=await Kn({value:D.value,schema:RNe});E.push({type:"shell_call_output",call_id:N.toolCallId,output:U.output.map(j=>({stdout:j.stdout,stderr:j.stderr,outcome:j.outcome.type==="timeout"?{type:"timeout"}:{type:"exit",exit_code:j.outcome.exitCode}}))});continue}if(l&&N.toolName==="apply_patch"&&D.type==="json"){const U=await Kn({value:D.value,schema:ANe});E.push({type:"apply_patch_call_output",call_id:N.toolCallId,status:U.status,output:U.output});continue}let L;switch(D.type){case"text":case"error-text":L=D.value;break;case"execution-denied":L=(M=D.reason)!=null?M:"Tool execution denied.";break;case"json":case"error-json":L=JSON.stringify(D.value);break;case"content":L=D.value.map(U=>{var j;switch(U.type){case"text":return{type:"input_text",text:U.text};case"image-data":return{type:"input_image",image_url:`data:${U.mediaType};base64,${U.data}`};case"image-url":return{type:"input_image",image_url:U.url};case"file-data":return{type:"input_file",filename:(j=U.filename)!=null?j:"data",file_data:`data:${U.mediaType};base64,${U.data}`};default:{C.push({type:"other",message:`unsupported tool content part type: ${U.type}`});return}}}).filter(X8);break}E.push({type:"function_call_output",call_id:N.toolCallId,output:L})}break}default:{const N=k;throw new Error(`Unsupported role: ${N}`)}}return{input:E,warnings:C}}var DNe=B({itemId:A().nullish(),reasoningEncryptedContent:A().nullish()});function CU({finishReason:t,hasFunctionCall:e}){switch(t){case void 0:case null:return e?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return e?"tool-calls":"other"}}var ONe=at(()=>it(vt([B({type:ae("response.output_text.delta"),item_id:A(),delta:A(),logprobs:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish()}),B({type:wt(["response.completed","response.incomplete"]),response:B({incomplete_details:B({reason:A()}).nullish(),usage:B({input_tokens:ie(),input_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),output_tokens:ie(),output_tokens_details:B({reasoning_tokens:ie().nullish()}).nullish()}),service_tier:A().nullish()})}),B({type:ae("response.created"),response:B({id:A(),created_at:ie(),model:A(),service_tier:A().nullish()})}),B({type:ae("response.output_item.added"),output_index:ie(),item:Zt("type",[B({type:ae("message"),id:A()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish()}),B({type:ae("function_call"),id:A(),call_id:A(),name:A(),arguments:A()}),B({type:ae("web_search_call"),id:A(),status:A()}),B({type:ae("computer_call"),id:A(),status:A()}),B({type:ae("file_search_call"),id:A()}),B({type:ae("image_generation_call"),id:A()}),B({type:ae("code_interpreter_call"),id:A(),container_id:A(),code:A().nullable(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable(),status:A()}),B({type:ae("mcp_call"),id:A(),status:A(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A()}),B({type:ae("mcp_approval_request"),id:A()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])}),B({type:ae("response.output_item.done"),output_index:ie(),item:Zt("type",[B({type:ae("message"),id:A()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish()}),B({type:ae("function_call"),id:A(),call_id:A(),name:A(),arguments:A(),status:ae("completed")}),B({type:ae("code_interpreter_call"),id:A(),code:A().nullable(),container_id:A(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable()}),B({type:ae("image_generation_call"),id:A(),result:A()}),B({type:ae("web_search_call"),id:A(),status:A(),action:Zt("type",[B({type:ae("search"),query:A().nullish(),sources:Ce(Zt("type",[B({type:ae("url"),url:A()}),B({type:ae("api"),name:A()})])).nullish()}),B({type:ae("open_page"),url:A().nullish()}),B({type:ae("find_in_page"),url:A().nullish(),pattern:A().nullish()})])}),B({type:ae("file_search_call"),id:A(),queries:Ce(A()),results:Ce(B({attributes:sn(A(),vt([A(),ie(),Ot()])),file_id:A(),filename:A(),score:ie(),text:A()})).nullish()}),B({type:ae("local_shell_call"),id:A(),call_id:A(),action:B({type:ae("exec"),command:Ce(A()),timeout_ms:ie().optional(),user:A().optional(),working_directory:A().optional(),env:sn(A(),A()).optional()})}),B({type:ae("computer_call"),id:A(),status:ae("completed")}),B({type:ae("mcp_call"),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A(),server_label:A(),tools:Ce(B({name:A(),description:A().optional(),input_schema:gr(),annotations:sn(A(),Zn()).optional()})),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).optional()}),B({type:ae("mcp_approval_request"),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])}),B({type:ae("response.function_call_arguments.delta"),item_id:A(),output_index:ie(),delta:A()}),B({type:ae("response.image_generation_call.partial_image"),item_id:A(),output_index:ie(),partial_image_b64:A()}),B({type:ae("response.code_interpreter_call_code.delta"),item_id:A(),output_index:ie(),delta:A()}),B({type:ae("response.code_interpreter_call_code.done"),item_id:A(),output_index:ie(),code:A()}),B({type:ae("response.output_text.annotation.added"),annotation:Zt("type",[B({type:ae("url_citation"),start_index:ie(),end_index:ie(),url:A(),title:A()}),B({type:ae("file_citation"),file_id:A(),filename:A(),index:ie()}),B({type:ae("container_file_citation"),container_id:A(),file_id:A(),filename:A(),start_index:ie(),end_index:ie()}),B({type:ae("file_path"),file_id:A(),index:ie()})])}),B({type:ae("response.reasoning_summary_part.added"),item_id:A(),summary_index:ie()}),B({type:ae("response.reasoning_summary_text.delta"),item_id:A(),summary_index:ie(),delta:A()}),B({type:ae("response.reasoning_summary_part.done"),item_id:A(),summary_index:ie()}),B({type:ae("response.apply_patch_call_operation_diff.delta"),item_id:A(),output_index:ie(),delta:A(),obfuscation:A().nullish()}),B({type:ae("response.apply_patch_call_operation_diff.done"),item_id:A(),output_index:ie(),diff:A()}),B({type:ae("error"),sequence_number:ie(),error:B({type:A(),code:A(),message:A(),param:A().nullish()})}),B({type:A()}).loose().transform(t=>({type:"unknown_chunk",message:t.type}))]))),LNe=at(()=>it(B({id:A().optional(),created_at:ie().optional(),error:B({message:A(),type:A(),param:A().nullish(),code:A()}).nullish(),model:A().optional(),output:Ce(Zt("type",[B({type:ae("message"),role:ae("assistant"),id:A(),content:Ce(B({type:ae("output_text"),text:A(),logprobs:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}))})).nullish(),annotations:Ce(Zt("type",[B({type:ae("url_citation"),start_index:ie(),end_index:ie(),url:A(),title:A()}),B({type:ae("file_citation"),file_id:A(),filename:A(),index:ie()}),B({type:ae("container_file_citation"),container_id:A(),file_id:A(),filename:A(),start_index:ie(),end_index:ie()}),B({type:ae("file_path"),file_id:A(),index:ie()})]))}))}),B({type:ae("web_search_call"),id:A(),status:A(),action:Zt("type",[B({type:ae("search"),query:A().nullish(),sources:Ce(Zt("type",[B({type:ae("url"),url:A()}),B({type:ae("api"),name:A()})])).nullish()}),B({type:ae("open_page"),url:A().nullish()}),B({type:ae("find_in_page"),url:A().nullish(),pattern:A().nullish()})])}),B({type:ae("file_search_call"),id:A(),queries:Ce(A()),results:Ce(B({attributes:sn(A(),vt([A(),ie(),Ot()])),file_id:A(),filename:A(),score:ie(),text:A()})).nullish()}),B({type:ae("code_interpreter_call"),id:A(),code:A().nullable(),container_id:A(),outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullable()}),B({type:ae("image_generation_call"),id:A(),result:A()}),B({type:ae("local_shell_call"),id:A(),call_id:A(),action:B({type:ae("exec"),command:Ce(A()),timeout_ms:ie().optional(),user:A().optional(),working_directory:A().optional(),env:sn(A(),A()).optional()})}),B({type:ae("function_call"),call_id:A(),name:A(),arguments:A(),id:A()}),B({type:ae("computer_call"),id:A(),status:A().optional()}),B({type:ae("reasoning"),id:A(),encrypted_content:A().nullish(),summary:Ce(B({type:ae("summary_text"),text:A()}))}),B({type:ae("mcp_call"),id:A(),status:A(),arguments:A(),name:A(),server_label:A(),output:A().nullish(),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).nullish(),approval_request_id:A().nullish()}),B({type:ae("mcp_list_tools"),id:A(),server_label:A(),tools:Ce(B({name:A(),description:A().optional(),input_schema:gr(),annotations:sn(A(),Zn()).optional()})),error:vt([A(),B({type:A().optional(),code:vt([ie(),A()]).optional(),message:A().optional()}).loose()]).optional()}),B({type:ae("mcp_approval_request"),id:A(),server_label:A(),name:A(),arguments:A(),approval_request_id:A().optional()}),B({type:ae("apply_patch_call"),id:A(),call_id:A(),status:wt(["in_progress","completed"]),operation:Zt("type",[B({type:ae("create_file"),path:A(),diff:A()}),B({type:ae("delete_file"),path:A()}),B({type:ae("update_file"),path:A(),diff:A()})])}),B({type:ae("shell_call"),id:A(),call_id:A(),status:wt(["in_progress","completed","incomplete"]),action:B({commands:Ce(A())})})])).optional(),service_tier:A().nullish(),incomplete_details:B({reason:A()}).nullish(),usage:B({input_tokens:ie(),input_tokens_details:B({cached_tokens:ie().nullish()}).nullish(),output_tokens:ie(),output_tokens_details:B({reasoning_tokens:ie().nullish()}).nullish()}).optional()}))),Ote=20,MU=at(()=>it(B({conversation:A().nullish(),include:Ce(wt(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:A().nullish(),logprobs:vt([Ot(),ie().min(1).max(Ote)]).optional(),maxToolCalls:ie().nullish(),metadata:gr().nullish(),parallelToolCalls:Ot().nullish(),previousResponseId:A().nullish(),promptCacheKey:A().nullish(),promptCacheRetention:wt(["in_memory","24h"]).nullish(),reasoningEffort:A().nullish(),reasoningSummary:A().nullish(),safetyIdentifier:A().nullish(),serviceTier:wt(["auto","flex","priority","default"]).nullish(),store:Ot().nullish(),strictJsonSchema:Ot().nullish(),textVerbosity:wt(["low","medium","high"]).nullish(),truncation:wt(["auto","disabled"]).nullish(),user:A().nullish(),systemMessageMode:wt(["system","developer","remove"]).optional(),forceReasoning:Ot().optional()}))),FNe=at(()=>it(B({code:A().nullish(),containerId:A()}))),BNe=at(()=>it(B({outputs:Ce(Zt("type",[B({type:ae("logs"),logs:A()}),B({type:ae("image"),url:A()})])).nullish()}))),UNe=at(()=>it(B({container:vt([A(),B({fileIds:Ce(A()).optional()})]).optional()}))),zNe=Fr({id:"openai.code_interpreter",inputSchema:FNe,outputSchema:BNe}),jNe=(t={})=>zNe(t),Lte=B({key:A(),type:wt(["eq","ne","gt","gte","lt","lte","in","nin"]),value:vt([A(),ie(),Ot(),Ce(A())])}),Fte=B({type:wt(["and","or"]),filters:Ce(vt([Lte,Cv(()=>Fte)]))}),HNe=at(()=>it(B({vectorStoreIds:Ce(A()),maxNumResults:ie().optional(),ranking:B({ranker:A().optional(),scoreThreshold:ie().optional()}).optional(),filters:vt([Lte,Fte]).optional()}))),$Ne=at(()=>it(B({queries:Ce(A()),results:Ce(B({attributes:sn(A(),Zn()),fileId:A(),filename:A(),score:ie(),text:A()})).nullable()}))),VNe=Fr({id:"openai.file_search",inputSchema:B({}),outputSchema:$Ne}),qNe=at(()=>it(B({background:wt(["auto","opaque","transparent"]).optional(),inputFidelity:wt(["low","high"]).optional(),inputImageMask:B({fileId:A().optional(),imageUrl:A().optional()}).optional(),model:A().optional(),moderation:wt(["auto"]).optional(),outputCompression:ie().int().min(0).max(100).optional(),outputFormat:wt(["png","jpeg","webp"]).optional(),partialImages:ie().int().min(0).max(3).optional(),quality:wt(["auto","low","medium","high"]).optional(),size:wt(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),GNe=at(()=>it(B({}))),WNe=at(()=>it(B({result:A()}))),YNe=Fr({id:"openai.image_generation",inputSchema:GNe,outputSchema:WNe}),XNe=(t={})=>YNe(t),AU=Cv(()=>vt([A(),ie(),Ot(),V8(),Ce(AU),sn(A(),AU)])),KNe=at(()=>it(B({serverLabel:A(),allowedTools:vt([Ce(A()),B({readOnly:Ot().optional(),toolNames:Ce(A()).optional()})]).optional(),authorization:A().optional(),connectorId:A().optional(),headers:sn(A(),A()).optional(),requireApproval:vt([wt(["always","never"]),B({never:B({toolNames:Ce(A()).optional()}).optional()})]).optional(),serverDescription:A().optional(),serverUrl:A().optional()}).refine(t=>t.serverUrl!=null||t.connectorId!=null,"One of serverUrl or connectorId must be provided."))),ZNe=at(()=>it(B({externalWebAccess:Ot().optional(),filters:B({allowedDomains:Ce(A()).optional()}).optional(),searchContextSize:wt(["low","medium","high"]).optional(),userLocation:B({type:ae("approximate"),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),JNe=at(()=>it(B({searchContextSize:wt(["low","medium","high"]).optional(),userLocation:B({type:ae("approximate"),country:A().optional(),city:A().optional(),region:A().optional(),timezone:A().optional()}).optional()}))),QNe=at(()=>it(B({}))),e8e=at(()=>it(B({action:Zt("type",[B({type:ae("search"),query:A().optional()}),B({type:ae("openPage"),url:A().nullish()}),B({type:ae("findInPage"),url:A().nullish(),pattern:A().nullish()})])}))),t8e=Fr({id:"openai.web_search_preview",inputSchema:QNe,outputSchema:e8e});async function n8e({tools:t,toolChoice:e}){t=t?.length?t:void 0;const n=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const a of t)switch(a.type){case"function":r.push({type:"function",name:a.name,description:a.description,parameters:a.inputSchema,...a.strict!=null?{strict:a.strict}:{}});break;case"provider":{switch(a.id){case"openai.file_search":{const s=await Kn({value:a.args,schema:HNe});r.push({type:"file_search",vector_store_ids:s.vectorStoreIds,max_num_results:s.maxNumResults,ranking_options:s.ranking?{ranker:s.ranking.ranker,score_threshold:s.ranking.scoreThreshold}:void 0,filters:s.filters});break}case"openai.local_shell":{r.push({type:"local_shell"});break}case"openai.shell":{r.push({type:"shell"});break}case"openai.apply_patch":{r.push({type:"apply_patch"});break}case"openai.web_search_preview":{const s=await Kn({value:a.args,schema:JNe});r.push({type:"web_search_preview",search_context_size:s.searchContextSize,user_location:s.userLocation});break}case"openai.web_search":{const s=await Kn({value:a.args,schema:ZNe});r.push({type:"web_search",filters:s.filters!=null?{allowed_domains:s.filters.allowedDomains}:void 0,external_web_access:s.externalWebAccess,search_context_size:s.searchContextSize,user_location:s.userLocation});break}case"openai.code_interpreter":{const s=await Kn({value:a.args,schema:UNe});r.push({type:"code_interpreter",container:s.container==null?{type:"auto",file_ids:void 0}:typeof s.container=="string"?s.container:{type:"auto",file_ids:s.container.fileIds}});break}case"openai.image_generation":{const s=await Kn({value:a.args,schema:qNe});r.push({type:"image_generation",background:s.background,input_fidelity:s.inputFidelity,input_image_mask:s.inputImageMask?{file_id:s.inputImageMask.fileId,image_url:s.inputImageMask.imageUrl}:void 0,model:s.model,moderation:s.moderation,partial_images:s.partialImages,quality:s.quality,output_compression:s.outputCompression,output_format:s.outputFormat,size:s.size});break}case"openai.mcp":{const s=await Kn({value:a.args,schema:KNe}),o=c=>({tool_names:c.toolNames}),l=s.requireApproval,u=l==null?void 0:typeof l=="string"?l:l.never!=null?{never:o(l.never)}:void 0;r.push({type:"mcp",server_label:s.serverLabel,allowed_tools:Array.isArray(s.allowedTools)?s.allowedTools:s.allowedTools?{read_only:s.allowedTools.readOnly,tool_names:s.allowedTools.toolNames}:void 0,authorization:s.authorization,connector_id:s.connectorId,headers:s.headers,require_approval:u??"never",server_description:s.serverDescription,server_url:s.serverUrl});break}}break}default:n.push({type:"unsupported",feature:`function tool ${a}`});break}if(e==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const i=e.type;switch(i){case"auto":case"none":case"required":return{tools:r,toolChoice:i,toolWarnings:n};case"tool":return{tools:r,toolChoice:e.toolName==="code_interpreter"||e.toolName==="file_search"||e.toolName==="image_generation"||e.toolName==="web_search_preview"||e.toolName==="web_search"||e.toolName==="mcp"||e.toolName==="apply_patch"?{type:e.toolName}:{type:"function",name:e.toolName},toolWarnings:n};default:{const a=i;throw new Nn({functionality:`tool choice type: ${a}`})}}}function kU(t){var e,n;const r={};for(const i of t)if(i.role==="assistant")for(const a of i.content){if(a.type!=="tool-call")continue;const s=(n=(e=a.providerOptions)==null?void 0:e.openai)==null?void 0:n.approvalRequestId;s!=null&&(r[s]=a.toolCallId)}return r}var r8e=class{constructor(t,e){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=t,this.config=e}get provider(){return this.config.provider}async getArgs({maxOutputTokens:t,temperature:e,stopSequences:n,topP:r,topK:i,presencePenalty:a,frequencyPenalty:s,seed:o,prompt:l,providerOptions:u,tools:c,toolChoice:d,responseFormat:h}){var f,m,x,b,y,w;const _=[],S=Dte(this.modelId);i!=null&&_.push({type:"unsupported",feature:"topK"}),o!=null&&_.push({type:"unsupported",feature:"seed"}),a!=null&&_.push({type:"unsupported",feature:"presencePenalty"}),s!=null&&_.push({type:"unsupported",feature:"frequencyPenalty"}),n!=null&&_.push({type:"unsupported",feature:"stopSequences"});const M=this.config.provider.includes("azure")?"azure":"openai";let E=await sr({provider:M,providerOptions:u,schema:MU});E==null&&M!=="openai"&&(E=await sr({provider:"openai",providerOptions:u,schema:MU}));const C=(f=E?.forceReasoning)!=null?f:S.isReasoningModel;E?.conversation&&E?.previousResponseId&&_.push({type:"unsupported",feature:"conversation",details:"conversation and previousResponseId cannot be used together"});const R=W8({tools:c,providerToolNames:{"openai.code_interpreter":"code_interpreter","openai.file_search":"file_search","openai.image_generation":"image_generation","openai.local_shell":"local_shell","openai.shell":"shell","openai.web_search":"web_search","openai.web_search_preview":"web_search_preview","openai.mcp":"mcp","openai.apply_patch":"apply_patch"}}),{input:k,warnings:I}=await PNe({prompt:l,toolNameMapping:R,systemMessageMode:(m=E?.systemMessageMode)!=null?m:C?"developer":S.systemMessageMode,providerOptionsName:M,fileIdPrefixes:this.config.fileIdPrefixes,store:(x=E?.store)!=null?x:!0,hasLocalShellTool:L("openai.local_shell"),hasShellTool:L("openai.shell"),hasApplyPatchTool:L("openai.apply_patch")});_.push(...I);const N=(b=E?.strictJsonSchema)!=null?b:!0;let D=E?.include;function F(X){D==null?D=[X]:D.includes(X)||(D=[...D,X])}function L(X){return c?.find(H=>H.type==="provider"&&H.id===X)!=null}const U=typeof E?.logprobs=="number"?E?.logprobs:E?.logprobs===!0?Ote:void 0;U&&F("message.output_text.logprobs");const j=(y=c?.find(X=>X.type==="provider"&&(X.id==="openai.web_search"||X.id==="openai.web_search_preview")))==null?void 0:y.name;j&&F("web_search_call.action.sources"),L("openai.code_interpreter")&&F("code_interpreter_call.outputs");const q=E?.store;q===!1&&C&&F("reasoning.encrypted_content");const Z={model:this.modelId,input:k,temperature:e,top_p:r,max_output_tokens:t,...(h?.type==="json"||E?.textVerbosity)&&{text:{...h?.type==="json"&&{format:h.schema!=null?{type:"json_schema",strict:N,name:(w=h.name)!=null?w:"response",description:h.description,schema:h.schema}:{type:"json_object"}},...E?.textVerbosity&&{verbosity:E.textVerbosity}}},conversation:E?.conversation,max_tool_calls:E?.maxToolCalls,metadata:E?.metadata,parallel_tool_calls:E?.parallelToolCalls,previous_response_id:E?.previousResponseId,store:q,user:E?.user,instructions:E?.instructions,service_tier:E?.serviceTier,include:D,prompt_cache_key:E?.promptCacheKey,prompt_cache_retention:E?.promptCacheRetention,safety_identifier:E?.safetyIdentifier,top_logprobs:U,truncation:E?.truncation,...C&&(E?.reasoningEffort!=null||E?.reasoningSummary!=null)&&{reasoning:{...E?.reasoningEffort!=null&&{effort:E.reasoningEffort},...E?.reasoningSummary!=null&&{summary:E.reasoningSummary}}}};C?E?.reasoningEffort==="none"&&S.supportsNonReasoningParameters||(Z.temperature!=null&&(Z.temperature=void 0,_.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),Z.top_p!=null&&(Z.top_p=void 0,_.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"}))):(E?.reasoningEffort!=null&&_.push({type:"unsupported",feature:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),E?.reasoningSummary!=null&&_.push({type:"unsupported",feature:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),E?.serviceTier==="flex"&&!S.supportsFlexProcessing&&(_.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete Z.service_tier),E?.serviceTier==="priority"&&!S.supportsPriorityProcessing&&(_.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete Z.service_tier);const{tools:Q,toolChoice:z,toolWarnings:W}=await n8e({tools:c,toolChoice:d});return{webSearchToolName:j,args:{...Z,tools:Q,tool_choice:z},warnings:[..._,...W],store:q,toolNameMapping:R,providerOptionsName:M}}async doGenerate(t){var e,n,r,i,a,s,o,l,u,c,d,h,f,m,x,b,y,w,_,S,M,E,C,R,k;const{args:I,warnings:N,webSearchToolName:D,toolNameMapping:F,providerOptionsName:L}=await this.getArgs(t),U=this.config.url({path:"/responses",modelId:this.modelId}),j=kU(t.prompt),{responseHeaders:q,value:Z,rawValue:Q}=await Fn({url:U,headers:Mn(this.config.headers(),t.headers),body:I,failedResponseHandler:il,successfulResponseHandler:vr(LNe),abortSignal:t.abortSignal,fetch:this.config.fetch});if(Z.error)throw new ji({message:Z.error.message,url:U,requestBodyValues:I,statusCode:400,responseHeaders:q,responseBody:Q,isRetryable:!1});const z=[],W=[];let X=!1;for(const te of Z.output)switch(te.type){case"reasoning":{te.summary.length===0&&te.summary.push({type:"summary_text",text:""});for(const ee of te.summary)z.push({type:"reasoning",text:ee.text,providerMetadata:{[L]:{itemId:te.id,reasoningEncryptedContent:(e=te.encrypted_content)!=null?e:null}}});break}case"image_generation_call":{z.push({type:"tool-call",toolCallId:te.id,toolName:F.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0}),z.push({type:"tool-result",toolCallId:te.id,toolName:F.toCustomToolName("image_generation"),result:{result:te.result}});break}case"local_shell_call":{z.push({type:"tool-call",toolCallId:te.call_id,toolName:F.toCustomToolName("local_shell"),input:JSON.stringify({action:te.action}),providerMetadata:{[L]:{itemId:te.id}}});break}case"shell_call":{z.push({type:"tool-call",toolCallId:te.call_id,toolName:F.toCustomToolName("shell"),input:JSON.stringify({action:{commands:te.action.commands}}),providerMetadata:{[L]:{itemId:te.id}}});break}case"message":{for(const ee of te.content){(r=(n=t.providerOptions)==null?void 0:n[L])!=null&&r.logprobs&&ee.logprobs&&W.push(ee.logprobs);const se={itemId:te.id,...ee.annotations.length>0&&{annotations:ee.annotations}};z.push({type:"text",text:ee.text,providerMetadata:{[L]:se}});for(const ue of ee.annotations)ue.type==="url_citation"?z.push({type:"source",sourceType:"url",id:(s=(a=(i=this.config).generateId)==null?void 0:a.call(i))!=null?s:Ln(),url:ue.url,title:ue.title}):ue.type==="file_citation"?z.push({type:"source",sourceType:"document",id:(u=(l=(o=this.config).generateId)==null?void 0:l.call(o))!=null?u:Ln(),mediaType:"text/plain",title:ue.filename,filename:ue.filename,providerMetadata:{[L]:{type:ue.type,fileId:ue.file_id,index:ue.index}}}):ue.type==="container_file_citation"?z.push({type:"source",sourceType:"document",id:(h=(d=(c=this.config).generateId)==null?void 0:d.call(c))!=null?h:Ln(),mediaType:"text/plain",title:ue.filename,filename:ue.filename,providerMetadata:{[L]:{type:ue.type,fileId:ue.file_id,containerId:ue.container_id}}}):ue.type==="file_path"&&z.push({type:"source",sourceType:"document",id:(x=(m=(f=this.config).generateId)==null?void 0:m.call(f))!=null?x:Ln(),mediaType:"application/octet-stream",title:ue.file_id,filename:ue.file_id,providerMetadata:{[L]:{type:ue.type,fileId:ue.file_id,index:ue.index}}})}break}case"function_call":{X=!0,z.push({type:"tool-call",toolCallId:te.call_id,toolName:te.name,input:te.arguments,providerMetadata:{[L]:{itemId:te.id}}});break}case"web_search_call":{z.push({type:"tool-call",toolCallId:te.id,toolName:F.toCustomToolName(D??"web_search"),input:JSON.stringify({}),providerExecuted:!0}),z.push({type:"tool-result",toolCallId:te.id,toolName:F.toCustomToolName(D??"web_search"),result:NU(te.action)});break}case"mcp_call":{const ee=te.approval_request_id!=null&&(b=j[te.approval_request_id])!=null?b:te.id,se=`mcp.${te.name}`;z.push({type:"tool-call",toolCallId:ee,toolName:se,input:te.arguments,providerExecuted:!0,dynamic:!0}),z.push({type:"tool-result",toolCallId:ee,toolName:se,result:{type:"call",serverLabel:te.server_label,name:te.name,arguments:te.arguments,...te.output!=null?{output:te.output}:{},...te.error!=null?{error:te.error}:{}},providerMetadata:{[L]:{itemId:te.id}}});break}case"mcp_list_tools":break;case"mcp_approval_request":{const ee=(y=te.approval_request_id)!=null?y:te.id,se=(S=(_=(w=this.config).generateId)==null?void 0:_.call(w))!=null?S:Ln(),ue=`mcp.${te.name}`;z.push({type:"tool-call",toolCallId:se,toolName:ue,input:te.arguments,providerExecuted:!0,dynamic:!0}),z.push({type:"tool-approval-request",approvalId:ee,toolCallId:se});break}case"computer_call":{z.push({type:"tool-call",toolCallId:te.id,toolName:F.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),z.push({type:"tool-result",toolCallId:te.id,toolName:F.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:te.status||"completed"}});break}case"file_search_call":{z.push({type:"tool-call",toolCallId:te.id,toolName:F.toCustomToolName("file_search"),input:"{}",providerExecuted:!0}),z.push({type:"tool-result",toolCallId:te.id,toolName:F.toCustomToolName("file_search"),result:{queries:te.queries,results:(E=(M=te.results)==null?void 0:M.map(ee=>({attributes:ee.attributes,fileId:ee.file_id,filename:ee.filename,score:ee.score,text:ee.text})))!=null?E:null}});break}case"code_interpreter_call":{z.push({type:"tool-call",toolCallId:te.id,toolName:F.toCustomToolName("code_interpreter"),input:JSON.stringify({code:te.code,containerId:te.container_id}),providerExecuted:!0}),z.push({type:"tool-result",toolCallId:te.id,toolName:F.toCustomToolName("code_interpreter"),result:{outputs:te.outputs}});break}case"apply_patch_call":{z.push({type:"tool-call",toolCallId:te.call_id,toolName:F.toCustomToolName("apply_patch"),input:JSON.stringify({callId:te.call_id,operation:te.operation}),providerMetadata:{[L]:{itemId:te.id}}});break}}const H={[L]:{responseId:Z.id}};W.length>0&&(H[L].logprobs=W),typeof Z.service_tier=="string"&&(H[L].serviceTier=Z.service_tier);const J=Z.usage;return{content:z,finishReason:{unified:CU({finishReason:(C=Z.incomplete_details)==null?void 0:C.reason,hasFunctionCall:X}),raw:(k=(R=Z.incomplete_details)==null?void 0:R.reason)!=null?k:void 0},usage:EU(J),request:{body:I},response:{id:Z.id,timestamp:new Date(Z.created_at*1e3),modelId:Z.model,headers:q,body:Q},providerMetadata:H,warnings:N}}async doStream(t){const{args:e,warnings:n,webSearchToolName:r,toolNameMapping:i,store:a,providerOptionsName:s}=await this.getArgs(t),{responseHeaders:o,value:l}=await Fn({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:{...e,stream:!0},failedResponseHandler:il,successfulResponseHandler:Xu(ONe),abortSignal:t.abortSignal,fetch:this.config.fetch}),u=this,c=kU(t.prompt),d=new Map;let h={unified:"other",raw:void 0},f;const m=[];let x=null;const b={},y=[];let w=!1;const _={};let S;return{stream:l.pipeThrough(new TransformStream({start(M){M.enqueue({type:"stream-start",warnings:n})},transform(M,E){var C,R,k,I,N,D,F,L,U,j,q,Z,Q,z,W,X,H,J,te,ee,se,ue,oe,Te,Ne,be,De,ke,Me,Ie;if(t.includeRawChunks&&E.enqueue({type:"raw",rawValue:M.rawValue}),!M.success){h={unified:"error",raw:void 0},E.enqueue({type:"error",error:M.error});return}const ce=M.value;if(IU(ce)){if(ce.item.type==="function_call")b[ce.output_index]={toolName:ce.item.name,toolCallId:ce.item.call_id},E.enqueue({type:"tool-input-start",id:ce.item.call_id,toolName:ce.item.name});else if(ce.item.type==="web_search_call")b[ce.output_index]={toolName:i.toCustomToolName(r??"web_search"),toolCallId:ce.item.id},E.enqueue({type:"tool-input-start",id:ce.item.id,toolName:i.toCustomToolName(r??"web_search"),providerExecuted:!0}),E.enqueue({type:"tool-input-end",id:ce.item.id}),E.enqueue({type:"tool-call",toolCallId:ce.item.id,toolName:i.toCustomToolName(r??"web_search"),input:JSON.stringify({}),providerExecuted:!0});else if(ce.item.type==="computer_call")b[ce.output_index]={toolName:i.toCustomToolName("computer_use"),toolCallId:ce.item.id},E.enqueue({type:"tool-input-start",id:ce.item.id,toolName:i.toCustomToolName("computer_use"),providerExecuted:!0});else if(ce.item.type==="code_interpreter_call")b[ce.output_index]={toolName:i.toCustomToolName("code_interpreter"),toolCallId:ce.item.id,codeInterpreter:{containerId:ce.item.container_id}},E.enqueue({type:"tool-input-start",id:ce.item.id,toolName:i.toCustomToolName("code_interpreter"),providerExecuted:!0}),E.enqueue({type:"tool-input-delta",id:ce.item.id,delta:`{"containerId":"${ce.item.container_id}","code":"`});else if(ce.item.type==="file_search_call")E.enqueue({type:"tool-call",toolCallId:ce.item.id,toolName:i.toCustomToolName("file_search"),input:"{}",providerExecuted:!0});else if(ce.item.type==="image_generation_call")E.enqueue({type:"tool-call",toolCallId:ce.item.id,toolName:i.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0});else if(!(ce.item.type==="mcp_call"||ce.item.type==="mcp_list_tools"||ce.item.type==="mcp_approval_request"))if(ce.item.type==="apply_patch_call"){const{call_id:G,operation:xe}=ce.item;if(b[ce.output_index]={toolName:i.toCustomToolName("apply_patch"),toolCallId:G,applyPatch:{hasDiff:xe.type==="delete_file",endEmitted:xe.type==="delete_file"}},E.enqueue({type:"tool-input-start",id:G,toolName:i.toCustomToolName("apply_patch")}),xe.type==="delete_file"){const Oe=JSON.stringify({callId:G,operation:xe});E.enqueue({type:"tool-input-delta",id:G,delta:Oe}),E.enqueue({type:"tool-input-end",id:G})}else E.enqueue({type:"tool-input-delta",id:G,delta:`{"callId":"${lh(G)}","operation":{"type":"${lh(xe.type)}","path":"${lh(xe.path)}","diff":"`})}else ce.item.type==="shell_call"?b[ce.output_index]={toolName:i.toCustomToolName("shell"),toolCallId:ce.item.call_id}:ce.item.type==="message"?(y.splice(0,y.length),E.enqueue({type:"text-start",id:ce.item.id,providerMetadata:{[s]:{itemId:ce.item.id}}})):IU(ce)&&ce.item.type==="reasoning"&&(_[ce.item.id]={encryptedContent:ce.item.encrypted_content,summaryParts:{0:"active"}},E.enqueue({type:"reasoning-start",id:`${ce.item.id}:0`,providerMetadata:{[s]:{itemId:ce.item.id,reasoningEncryptedContent:(C=ce.item.encrypted_content)!=null?C:null}}}))}else if(a8e(ce)){if(ce.item.type==="message")E.enqueue({type:"text-end",id:ce.item.id,providerMetadata:{[s]:{itemId:ce.item.id,...y.length>0&&{annotations:y}}}});else if(ce.item.type==="function_call")b[ce.output_index]=void 0,w=!0,E.enqueue({type:"tool-input-end",id:ce.item.call_id}),E.enqueue({type:"tool-call",toolCallId:ce.item.call_id,toolName:ce.item.name,input:ce.item.arguments,providerMetadata:{[s]:{itemId:ce.item.id}}});else if(ce.item.type==="web_search_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-result",toolCallId:ce.item.id,toolName:i.toCustomToolName(r??"web_search"),result:NU(ce.item.action)});else if(ce.item.type==="computer_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-input-end",id:ce.item.id}),E.enqueue({type:"tool-call",toolCallId:ce.item.id,toolName:i.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),E.enqueue({type:"tool-result",toolCallId:ce.item.id,toolName:i.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:ce.item.status||"completed"}});else if(ce.item.type==="file_search_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-result",toolCallId:ce.item.id,toolName:i.toCustomToolName("file_search"),result:{queries:ce.item.queries,results:(k=(R=ce.item.results)==null?void 0:R.map(G=>({attributes:G.attributes,fileId:G.file_id,filename:G.filename,score:G.score,text:G.text})))!=null?k:null}});else if(ce.item.type==="code_interpreter_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-result",toolCallId:ce.item.id,toolName:i.toCustomToolName("code_interpreter"),result:{outputs:ce.item.outputs}});else if(ce.item.type==="image_generation_call")E.enqueue({type:"tool-result",toolCallId:ce.item.id,toolName:i.toCustomToolName("image_generation"),result:{result:ce.item.result}});else if(ce.item.type==="mcp_call"){b[ce.output_index]=void 0;const G=(I=ce.item.approval_request_id)!=null?I:void 0,xe=G!=null&&(D=(N=d.get(G))!=null?N:c[G])!=null?D:ce.item.id,Oe=`mcp.${ce.item.name}`;E.enqueue({type:"tool-call",toolCallId:xe,toolName:Oe,input:ce.item.arguments,providerExecuted:!0,dynamic:!0}),E.enqueue({type:"tool-result",toolCallId:xe,toolName:Oe,result:{type:"call",serverLabel:ce.item.server_label,name:ce.item.name,arguments:ce.item.arguments,...ce.item.output!=null?{output:ce.item.output}:{},...ce.item.error!=null?{error:ce.item.error}:{}},providerMetadata:{[s]:{itemId:ce.item.id}}})}else if(ce.item.type==="mcp_list_tools")b[ce.output_index]=void 0;else if(ce.item.type==="apply_patch_call"){const G=b[ce.output_index];G?.applyPatch&&!G.applyPatch.endEmitted&&ce.item.operation.type!=="delete_file"&&(G.applyPatch.hasDiff||E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:lh(ce.item.operation.diff)}),E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}}'}),E.enqueue({type:"tool-input-end",id:G.toolCallId}),G.applyPatch.endEmitted=!0),G&&ce.item.status==="completed"&&E.enqueue({type:"tool-call",toolCallId:G.toolCallId,toolName:i.toCustomToolName("apply_patch"),input:JSON.stringify({callId:ce.item.call_id,operation:ce.item.operation}),providerMetadata:{[s]:{itemId:ce.item.id}}}),b[ce.output_index]=void 0}else if(ce.item.type==="mcp_approval_request"){b[ce.output_index]=void 0;const G=(U=(L=(F=u.config).generateId)==null?void 0:L.call(F))!=null?U:Ln(),xe=(j=ce.item.approval_request_id)!=null?j:ce.item.id;d.set(xe,G);const Oe=`mcp.${ce.item.name}`;E.enqueue({type:"tool-call",toolCallId:G,toolName:Oe,input:ce.item.arguments,providerExecuted:!0,dynamic:!0}),E.enqueue({type:"tool-approval-request",approvalId:xe,toolCallId:G})}else if(ce.item.type==="local_shell_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-call",toolCallId:ce.item.call_id,toolName:i.toCustomToolName("local_shell"),input:JSON.stringify({action:{type:"exec",command:ce.item.action.command,timeoutMs:ce.item.action.timeout_ms,user:ce.item.action.user,workingDirectory:ce.item.action.working_directory,env:ce.item.action.env}}),providerMetadata:{[s]:{itemId:ce.item.id}}});else if(ce.item.type==="shell_call")b[ce.output_index]=void 0,E.enqueue({type:"tool-call",toolCallId:ce.item.call_id,toolName:i.toCustomToolName("shell"),input:JSON.stringify({action:{commands:ce.item.action.commands}}),providerMetadata:{[s]:{itemId:ce.item.id}}});else if(ce.item.type==="reasoning"){const G=_[ce.item.id],xe=Object.entries(G.summaryParts).filter(([Oe,Fe])=>Fe==="active"||Fe==="can-conclude").map(([Oe])=>Oe);for(const Oe of xe)E.enqueue({type:"reasoning-end",id:`${ce.item.id}:${Oe}`,providerMetadata:{[s]:{itemId:ce.item.id,reasoningEncryptedContent:(q=ce.item.encrypted_content)!=null?q:null}}});delete _[ce.item.id]}}else if(l8e(ce)){const G=b[ce.output_index];G!=null&&E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:ce.delta})}else if(h8e(ce)){const G=b[ce.output_index];G?.applyPatch&&(E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:lh(ce.delta)}),G.applyPatch.hasDiff=!0)}else if(f8e(ce)){const G=b[ce.output_index];G?.applyPatch&&!G.applyPatch.endEmitted&&(G.applyPatch.hasDiff||(E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:lh(ce.diff)}),G.applyPatch.hasDiff=!0),E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}}'}),E.enqueue({type:"tool-input-end",id:G.toolCallId}),G.applyPatch.endEmitted=!0)}else if(u8e(ce))E.enqueue({type:"tool-result",toolCallId:ce.item_id,toolName:i.toCustomToolName("image_generation"),result:{result:ce.partial_image_b64},preliminary:!0});else if(c8e(ce)){const G=b[ce.output_index];G!=null&&E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:lh(ce.delta)})}else if(d8e(ce)){const G=b[ce.output_index];G!=null&&(E.enqueue({type:"tool-input-delta",id:G.toolCallId,delta:'"}'}),E.enqueue({type:"tool-input-end",id:G.toolCallId}),E.enqueue({type:"tool-call",toolCallId:G.toolCallId,toolName:i.toCustomToolName("code_interpreter"),input:JSON.stringify({code:ce.code,containerId:G.codeInterpreter.containerId}),providerExecuted:!0}))}else if(o8e(ce))x=ce.response.id,E.enqueue({type:"response-metadata",id:ce.response.id,timestamp:new Date(ce.response.created_at*1e3),modelId:ce.response.model});else if(i8e(ce))E.enqueue({type:"text-delta",id:ce.item_id,delta:ce.delta}),(Q=(Z=t.providerOptions)==null?void 0:Z[s])!=null&&Q.logprobs&&ce.logprobs&&m.push(ce.logprobs);else if(ce.type==="response.reasoning_summary_part.added"){if(ce.summary_index>0){const G=_[ce.item_id];G.summaryParts[ce.summary_index]="active";for(const xe of Object.keys(G.summaryParts))G.summaryParts[xe]==="can-conclude"&&(E.enqueue({type:"reasoning-end",id:`${ce.item_id}:${xe}`,providerMetadata:{[s]:{itemId:ce.item_id}}}),G.summaryParts[xe]="concluded");E.enqueue({type:"reasoning-start",id:`${ce.item_id}:${ce.summary_index}`,providerMetadata:{[s]:{itemId:ce.item_id,reasoningEncryptedContent:(W=(z=_[ce.item_id])==null?void 0:z.encryptedContent)!=null?W:null}}})}}else ce.type==="response.reasoning_summary_text.delta"?E.enqueue({type:"reasoning-delta",id:`${ce.item_id}:${ce.summary_index}`,delta:ce.delta,providerMetadata:{[s]:{itemId:ce.item_id}}}):ce.type==="response.reasoning_summary_part.done"?a?(E.enqueue({type:"reasoning-end",id:`${ce.item_id}:${ce.summary_index}`,providerMetadata:{[s]:{itemId:ce.item_id}}}),_[ce.item_id].summaryParts[ce.summary_index]="concluded"):_[ce.item_id].summaryParts[ce.summary_index]="can-conclude":s8e(ce)?(h={unified:CU({finishReason:(X=ce.response.incomplete_details)==null?void 0:X.reason,hasFunctionCall:w}),raw:(J=(H=ce.response.incomplete_details)==null?void 0:H.reason)!=null?J:void 0},f=ce.response.usage,typeof ce.response.service_tier=="string"&&(S=ce.response.service_tier)):p8e(ce)?(y.push(ce.annotation),ce.annotation.type==="url_citation"?E.enqueue({type:"source",sourceType:"url",id:(se=(ee=(te=u.config).generateId)==null?void 0:ee.call(te))!=null?se:Ln(),url:ce.annotation.url,title:ce.annotation.title}):ce.annotation.type==="file_citation"?E.enqueue({type:"source",sourceType:"document",id:(Te=(oe=(ue=u.config).generateId)==null?void 0:oe.call(ue))!=null?Te:Ln(),mediaType:"text/plain",title:ce.annotation.filename,filename:ce.annotation.filename,providerMetadata:{[s]:{type:ce.annotation.type,fileId:ce.annotation.file_id,index:ce.annotation.index}}}):ce.annotation.type==="container_file_citation"?E.enqueue({type:"source",sourceType:"document",id:(De=(be=(Ne=u.config).generateId)==null?void 0:be.call(Ne))!=null?De:Ln(),mediaType:"text/plain",title:ce.annotation.filename,filename:ce.annotation.filename,providerMetadata:{[s]:{type:ce.annotation.type,fileId:ce.annotation.file_id,containerId:ce.annotation.container_id}}}):ce.annotation.type==="file_path"&&E.enqueue({type:"source",sourceType:"document",id:(Ie=(Me=(ke=u.config).generateId)==null?void 0:Me.call(ke))!=null?Ie:Ln(),mediaType:"application/octet-stream",title:ce.annotation.file_id,filename:ce.annotation.file_id,providerMetadata:{[s]:{type:ce.annotation.type,fileId:ce.annotation.file_id,index:ce.annotation.index}}})):m8e(ce)&&E.enqueue({type:"error",error:ce})},flush(M){const E={[s]:{responseId:x}};m.length>0&&(E[s].logprobs=m),S!==void 0&&(E[s].serviceTier=S),M.enqueue({type:"finish",finishReason:h,usage:EU(f),providerMetadata:E})}})),request:{body:e},response:{headers:o}}}};function i8e(t){return t.type==="response.output_text.delta"}function a8e(t){return t.type==="response.output_item.done"}function s8e(t){return t.type==="response.completed"||t.type==="response.incomplete"}function o8e(t){return t.type==="response.created"}function l8e(t){return t.type==="response.function_call_arguments.delta"}function u8e(t){return t.type==="response.image_generation_call.partial_image"}function c8e(t){return t.type==="response.code_interpreter_call_code.delta"}function d8e(t){return t.type==="response.code_interpreter_call_code.done"}function h8e(t){return t.type==="response.apply_patch_call_operation_diff.delta"}function f8e(t){return t.type==="response.apply_patch_call_operation_diff.done"}function IU(t){return t.type==="response.output_item.added"}function p8e(t){return t.type==="response.output_text.annotation.added"}function m8e(t){return t.type==="error"}function NU(t){var e;switch(t.type){case"search":return{action:{type:"search",query:(e=t.query)!=null?e:void 0},...t.sources!=null&&{sources:t.sources}};case"open_page":return{action:{type:"openPage",url:t.url}};case"find_in_page":return{action:{type:"findInPage",url:t.url,pattern:t.pattern}}}}function lh(t){return JSON.stringify(t).slice(1,-1)}var g8e={codeInterpreter:jNe,fileSearch:VNe,imageGeneration:XNe,webSearchPreview:t8e},v8e="3.0.12";function y8e(t={}){var e;const n=()=>{const m={"api-key":i3({apiKey:t.apiKey,environmentVariableName:"AZURE_API_KEY",description:"Azure OpenAI"}),...t.headers};return To(m,`ai-sdk/azure/${v8e}`)},r=()=>mh({settingValue:t.resourceName,settingName:"resourceName",environmentVariableName:"AZURE_RESOURCE_NAME",description:"Azure OpenAI resource name"}),i=(e=t.apiVersion)!=null?e:"v1",a=({path:m,modelId:x})=>{var b;const y=(b=t.baseURL)!=null?b:`https://${r()}.openai.azure.com/openai`;let w;return t.useDeploymentBasedUrls?w=new URL(`${y}/deployments/${x}${m}`):w=new URL(`${y}/v1${m}`),w.searchParams.set("api-version",i),w.toString()},s=m=>new cNe(m,{provider:"azure.chat",url:a,headers:n,fetch:t.fetch}),o=m=>new pNe(m,{provider:"azure.completion",url:a,headers:n,fetch:t.fetch}),l=m=>new vNe(m,{provider:"azure.embeddings",headers:n,url:a,fetch:t.fetch}),u=m=>new r8e(m,{provider:"azure.responses",url:a,headers:n,fetch:t.fetch,fileIdPrefixes:["assistant-"]}),c=m=>new _Ne(m,{provider:"azure.image",url:a,headers:n,fetch:t.fetch}),d=m=>new TNe(m,{provider:"azure.transcription",url:a,headers:n,fetch:t.fetch}),h=m=>new MNe(m,{provider:"azure.speech",url:a,headers:n,fetch:t.fetch}),f=function(m){if(new.target)throw new Error("The Azure OpenAI model function cannot be called with the new keyword.");return u(m)};return f.specificationVersion="v3",f.languageModel=u,f.chat=s,f.completion=o,f.embedding=l,f.embeddingModel=l,f.textEmbedding=l,f.textEmbeddingModel=l,f.image=c,f.imageModel=c,f.responses=u,f.transcription=d,f.speech=h,f.tools=g8e,f}var x8e=y8e();function b8e({prompt:t,user:e="user",assistant:n="assistant"}){let r="";t[0].role==="system"&&(r+=`${t[0].content}

`,t=t.slice(1));for(const{role:i,content:a}of t)switch(i){case"system":throw new Mu({message:"Unexpected system message in prompt: ${content}",prompt:t});case"user":{const s=a.map(o=>{switch(o.type){case"text":return o.text}}).filter(Boolean).join("");r+=`${e}:
${s}

`;break}case"assistant":{const s=a.map(o=>{switch(o.type){case"text":return o.text;case"tool-call":throw new Nn({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${s}

`;break}case"tool":throw new Nn({functionality:"tool messages"});default:{const s=i;throw new Error(`Unsupported role: ${s}`)}}return r+=`${n}:
`,{prompt:r,stopSequences:[`
${e}:`]}}function ww(t){switch(t){case"stop":return{raw:t,unified:"stop"};case"length":return{raw:t,unified:"length"};case"content_filter":return{raw:t,unified:"content-filter"};case"function_call":case"tool_calls":return{raw:t,unified:"tool-calls"};default:return{raw:t,unified:"other"}}}function EI({model:t,created_at:e}){return{id:void 0,modelId:t??void 0,timestamp:e!=null?new Date(e):void 0}}function Bte(t){return async({response:e})=>{const n=xd(e);if(e.body==null)throw new Error("Response body is null");const r=e.body.getReader(),i=new TextDecoder;let a="";const s=new ReadableStream({async pull(o){for(;;){const{done:l,value:u}=await r.read();if(l){if(a.trim())try{const d=JSON.parse(a.trim()),h=t.parse(d);o.enqueue({success:!0,value:h,rawValue:h})}catch{}o.close();return}a+=i.decode(u,{stream:!0});const c=a.split(`
`);a=c.pop()||"";for(const d of c){const h=d.trim();if(h)try{const f=JSON.parse(h),m=t.parse(f);o.enqueue({success:!0,value:m,rawValue:m})}catch(f){console.warn("Failed to parse NDJSON line:",f)}}}},cancel(){r.cancel()}});return{responseHeaders:n,value:s}}}var _8e=B({error:B({message:A(),type:A().nullish(),param:gr().nullish(),code:vt([A(),ie()]).nullish()})}),U1=Fa({errorSchema:_8e,errorToMessage:t=>t.error.message});B({think:Ot().optional(),user:A().optional(),suffix:A().optional(),echo:Ot().optional()});var w8e=class{constructor(t,e,n){this.specificationVersion="v3",this.defaultObjectGenerationMode=void 0,this.supportsImageUrls=!1,this.supportedUrls={},this.modelId=t,this.settings=e,this.config=n,this.provider=n.provider}getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:s,stopSequences:o,responseFormat:l,tools:u,toolChoice:c,seed:d}){const h=[];i!=null&&h.push({type:"unsupported",feature:"topK"}),u?.length&&h.push({type:"unsupported",feature:"tools"}),c!=null&&h.push({type:"unsupported",feature:"toolChoice"}),l!=null&&l.type!=="text"&&h.push({type:"unsupported",feature:"responseFormat (JSON)"});const{prompt:f,stopSequences:m}=b8e({prompt:t}),x=[...m??[],...o??[]];return{args:{model:this.modelId,user:this.settings.user,think:this.settings.think,max_tokens:e,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:s,stop:x,prompt:f,suffix:this.settings.suffix,echo:this.settings.echo,stream:!1},warnings:h}}async doGenerate(t){var e,n;const{args:r,warnings:i}=this.getArgs(t),{responseHeaders:a,value:s,rawValue:o}=await Fn({url:this.config.url({path:"/generate",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:{...r,stream:!1},failedResponseHandler:U1,successfulResponseHandler:vr(RU),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:l,...u}=r,c=s;return{content:[{type:"text",text:c.response}],usage:{inputTokens:{total:(e=c.prompt_eval_count)!=null?e:0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:(n=c.eval_count)!=null?n:0,text:void 0,reasoning:void 0}},finishReason:ww("stop"),request:{body:JSON.stringify(r)},response:{...EI(c),headers:a,body:o},warnings:i}}async doStream(t){const{args:e,warnings:n}=this.getArgs(t),r={...e,stream:!0},{responseHeaders:i,value:a}=await Fn({url:this.config.url({path:"/generate",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:r,failedResponseHandler:U1,successfulResponseHandler:Bte(RU),abortSignal:t.abortSignal,fetch:this.config.fetch}),{prompt:s,...o}=e;let l="other",u={inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0}},c=!0,d=!1;const h=Ln();return{stream:a.pipeThrough(new TransformStream({transform(f,m){if(!f.success){m.enqueue({type:"error",error:f.rawValue});return}const x=f.value;if("error"in x){l="error",m.enqueue({type:"error",error:x.error});return}c&&(c=!1,m.enqueue({type:"response-metadata",...EI(x)})),x.done&&(l="stop"),x.response!=null&&(d||(m.enqueue({type:"text-start",id:h}),d=!0),m.enqueue({type:"text-delta",id:h,delta:x.response}))},flush(f){d&&f.enqueue({type:"text-end",id:h}),f.enqueue({type:"finish",finishReason:ww(l),usage:u})}})),request:{body:JSON.stringify(r)},response:{headers:i},warnings:n}}},RU=B({model:A(),created_at:A(),response:A(),done:Ot(),context:Ce(ie()),eval_count:ie().optional(),eval_duration:ie().optional(),load_duration:ie().optional(),total_duration:ie().optional(),prompt_eval_count:ie().optional(),prompt_eval_duration:ie().optional()}),S8e=B({dimensions:ie().optional(),truncate:Ot().optional(),keepAlive:A().optional()}),E8e=class{constructor(t,e,n){this.specificationVersion="v3";var r,i;this.modelId=t,this.settings=e,this.config=n,this.provider=n.provider,this.maxEmbeddingsPerCall=(r=e.maxEmbeddingsPerCall)!=null?r:2048,this.supportsParallelCalls=(i=e.supportsParallelCalls)!=null?i:!0}getArgs({values:t}){return{model:this.modelId,input:t,dimensions:this.settings.dimensions,truncate:this.settings.truncate,keep_alive:this.settings.keepAlive}}async doEmbed({values:t,headers:e,abortSignal:n,providerOptions:r}){var i,a,s;if(this.maxEmbeddingsPerCall&&t.length>this.maxEmbeddingsPerCall)throw new Tv({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:t});const o=await sr({provider:"ollama",providerOptions:r,schema:S8e}),l=(i=o?.dimensions)!=null?i:this.settings.dimensions,u=(a=o?.truncate)!=null?a:this.settings.truncate,c=(s=o?.keepAlive)!=null?s:this.settings.keepAlive,d={model:this.modelId,input:t};l!==void 0&&(d.dimensions=l),u!==void 0&&(d.truncate=u),c!==void 0&&(d.keep_alive=c);const{responseHeaders:h,value:f,rawValue:m}=await Fn({url:this.config.url({path:"/embed",modelId:this.modelId}),headers:Mn(this.config.headers(),e),body:{...d},failedResponseHandler:U1,successfulResponseHandler:vr(T8e),abortSignal:n,fetch:this.config.fetch}),x=f;return{embeddings:x.embeddings.map(b=>b),usage:{tokens:x.prompt_eval_count},response:{headers:h,body:m},warnings:[]}}},T8e=B({model:A(),embeddings:Ce(Ce(ie())),total_duration:ie(),load_duration:ie(),prompt_eval_count:ie()}),TI=B({model:A(),created_at:A(),done:Ot(),message:B({content:A(),role:A(),thinking:A().optional(),tool_calls:Ce(B({function:B({name:A(),arguments:sn(A(),gr())}),id:A().optional()})).optional().nullable()}),done_reason:A().optional(),eval_count:ie().optional(),eval_duration:ie().optional(),load_duration:ie().optional(),prompt_eval_count:ie().optional(),prompt_eval_duration:ie().optional(),total_duration:ie().optional()}),C8e=class{constructor(t){this.config=t}processGenerateResponse(t){const e=this.extractContent(t),n=ww(t.done_reason),r=this.extractUsage(t);return{content:e,finishReason:n,usage:r,providerMetadata:{ollama:{}}}}extractContent(t){var e,n,r,i,a;const s=[],o=t.message.content;o!=null&&o.length>0&&s.push({type:"text",text:o});const l=t.message.thinking;l!=null&&l.length>0&&s.push({type:"reasoning",text:l});for(const u of(e=t.message.tool_calls)!=null?e:[])s.push({type:"tool-call",toolCallId:(a=u.id)!=null?a:(i=(r=(n=this.config).generateId)==null?void 0:r.call(n))!=null?i:Ln(),toolName:u.function.name,input:JSON.stringify(u.function.arguments)});return s}extractUsage(t){var e,n;return{inputTokens:{total:(e=t.prompt_eval_count)!=null?e:0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:(n=t.eval_count)!=null?n:0,text:void 0,reasoning:void 0}}}};function M8e(t){var e;if(t.success)return[t.value];const n=[],r=(e=t.error)==null?void 0:e.text;if(typeof r!="string"||r.length===0)return n;const i=r.split(/\r?\n/);for(const a of i){const s=a.trim();if(s!=="")try{const o=JSON.parse(s),l=TI.safeParse(o);l.success&&n.push(l.data)}catch{}}return n}function A8e({prompt:t,systemMessageMode:e="system"}){const n=[];for(const{role:r,content:i}of t)switch(r){case"system":{switch(e){case"system":{n.push({role:"system",content:i});break}case"developer":{n.push({role:"developer",content:i});break}case"remove":break;default:{const a=e;throw new Error(`Unsupported system message mode: ${a}`)}}break}case"user":{if(i.length===1&&i[0].type==="text"){n.push({role:"user",content:i[0].text});break}const a=i.filter(o=>o.type==="text").map(o=>o.text).join(""),s=i.filter(o=>o.type==="file"&&o.mediaType.startsWith("image/")).map(o=>o.data);n.push({role:"user",content:a.length>0?a:[],images:s.length>0?s:void 0});break}case"assistant":{let a="",s="";const o=[];for(const l of i)switch(l.type){case"text":{a+=l.text;break}case"tool-call":{o.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:l.input}});break}case"reasoning":{s+=l.text;break}default:throw new Error(`Unsupported part: ${l}`)}n.push({role:"assistant",content:a,...s&&{thinking:s},tool_calls:o.length>0?o:void 0});break}case"tool":{for(const a of i){const s=a.output;let o;switch(s.type){case"text":case"error-text":o=s.value;break;case"content":case"json":case"error-json":o=JSON.stringify(s.value);break}n.push({role:"tool",tool_call_id:a.toolCallId,content:o})}break}default:{const a=r;throw new Error(`Unsupported role: ${a}`)}}return n}var k8e=B({think:Ot().optional(),options:B({num_ctx:ie().optional(),repeat_last_n:ie().optional(),repeat_penalty:ie().optional(),temperature:ie().optional(),seed:ie().optional(),stop:Ce(A()).optional(),num_predict:ie().optional(),top_k:ie().optional(),top_p:ie().optional(),min_p:ie().optional()}).optional()});function I8e({prompt:t,systemMessageMode:e}){const n=[],r=[];for(const{role:i,content:a}of t)switch(i){case"system":{switch(e){case"system":{n.push({role:"system",content:a});break}case"developer":{n.push({role:"developer",content:a});break}case"remove":{r.push({type:"other",message:"system messages are removed for this model"});break}default:{const s=e;throw new Error(`Unsupported system message mode: ${s}`)}}break}case"user":{n.push({role:"user",content:a.map((s,o)=>{var l,u,c;switch(s.type){case"text":return{type:"input_text",text:s.text};case"file":if(s.mediaType.startsWith("image/")){const d=s.mediaType==="image/*"?"image/jpeg":s.mediaType;return{type:"input_image",image_url:s.data instanceof URL?s.data.toString():`data:${d};base64,${s.data}`,detail:(u=(l=s.providerOptions)==null?void 0:l.ollama)==null?void 0:u.imageDetail}}else if(s.mediaType==="application/pdf"){if(s.data instanceof URL)throw new Nn({functionality:"PDF file parts with URLs"});return{type:"input_file",filename:(c=s.filename)!=null?c:`part-${o}.pdf`,file_data:`data:application/pdf;base64,${s.data}`}}else throw new Nn({functionality:`file part media type ${s.mediaType}`})}})});break}case"assistant":{for(const s of a)switch(s.type){case"text":{n.push({role:"assistant",content:[{type:"output_text",text:s.text}]});break}case"tool-call":{if(s.providerExecuted)break;n.push({type:"function_call",call_id:s.toolCallId,name:s.toolName,arguments:JSON.stringify(s.input)});break}case"tool-result":{r.push({type:"other",message:"tool result parts in assistant messages are not supported for Ollama responses"});break}}break}case"tool":{for(const s of a){const o=s.output;let l;switch(o.type){case"text":case"error-text":l=o.value;break;case"content":case"json":case"error-json":l=JSON.stringify(o.value);break}n.push({type:"function_call_output",call_id:s.toolCallId,output:l})}break}default:{const s=i;throw new Error(`Unsupported role: ${s}`)}}return{messages:n,warnings:r}}function N8e({tools:t,toolChoice:e}){t=t?.length?t:void 0;const n=[];if(t==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const r=[];for(const a of t)switch(a.type){case"function":{let s=a.inputSchema;s?s&&typeof s=="object"&&s.type==="object"&&s.properties&&Object.keys(s.properties).length===0&&(s={...s,properties:{},required:[]}):s={type:"object",properties:{},required:[]},r.push({type:"function",function:{name:a.name,description:a.description,parameters:s}});break}default:n.push({type:"unsupported",feature:"tool",details:a.name});break}if(e==null)return{tools:r,toolChoice:void 0,toolWarnings:n};const i=e.type;switch(i){case"auto":case"none":case"required":return{tools:r,toolChoice:i,toolWarnings:n};case"tool":return{tools:r,toolChoice:e.toolName=="web_search_preview"?{type:"web_search_preview"}:{type:"function",name:e.toolName},toolWarnings:n};default:{const a=i;throw new Nn({functionality:`tool choice type: ${a}`})}}}var R8e=class{async buildRequest({modelId:t,maxOutputTokens:e,temperature:n,stopSequences:r,topP:i,topK:a,presencePenalty:s,frequencyPenalty:o,seed:l,prompt:u,providerOptions:c,tools:d,toolChoice:h,responseFormat:f}){const m=this.collectUnsupportedSettingsWarnings({topK:a,seed:l,presencePenalty:s,frequencyPenalty:o,stopSequences:r}),{warnings:x}=I8e({prompt:u,systemMessageMode:"system"});m.push(...x);const b=await this.parseProviderOptions(c),y=this.buildBaseArgs({modelId:t,prompt:u,temperature:n,topP:i,maxOutputTokens:e,responseFormat:f,ollamaOptions:b}),{tools:w,toolChoice:_,toolWarnings:S}=N8e({tools:d,toolChoice:h});return{args:{...y,tools:w,tool_choice:_},warnings:[...m,...S]}}collectUnsupportedSettingsWarnings({topK:t,seed:e,presencePenalty:n,frequencyPenalty:r,stopSequences:i}){const a=[],s=[{value:t,name:"topK"},{value:e,name:"seed"},{value:n,name:"presencePenalty"},{value:r,name:"frequencyPenalty"},{value:i,name:"stopSequences"}];for(const{value:o,name:l}of s)o!=null&&a.push({type:"unsupported",feature:"setting",details:l});return a}async parseProviderOptions(t){const e=await sr({provider:"ollama",providerOptions:t,schema:k8e});return e??null}buildBaseArgs({modelId:t,prompt:e,temperature:n,topP:r,maxOutputTokens:i,responseFormat:a,ollamaOptions:s}){var o,l;return{model:t,messages:A8e({prompt:e,systemMessageMode:"system"}),temperature:n,top_p:r,max_output_tokens:i,...a?.type==="json"&&{format:a.schema!=null?a.schema:"json"},think:(o=s?.think)!=null?o:!1,options:(l=s?.options)!=null?l:void 0}}},P8e=class{constructor(t){this.config=t,this.state=this.initializeState()}createTransformStream(t,e){return new TransformStream({transform:(n,r)=>{this.processChunk(n,r,e)},flush:n=>{this.finalizeStream(n)}})}initializeState(){return{finishReason:{unified:"other",raw:void 0},usage:{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0}},responseId:null,ongoingToolCalls:{},hasToolCalls:!1,isFirstChunk:!0,hasTextStarted:!1,hasReasoningStarted:!1,textEnded:!1,reasoningEnded:!1,textId:Ln(),reasoningId:Ln()}}processChunk(t,e,n){n?.includeRawChunks&&e.enqueue({type:"raw",rawValue:t.rawValue});const r=M8e(t);if(r.length===0){t.success||(this.state.finishReason={unified:"error",raw:void 0},e.enqueue({type:"error",error:t.error}));return}for(const i of r)this.processResponseValue(i,e)}processResponseValue(t,e){if(t&&typeof t=="object"&&"error"in t){this.state.finishReason={unified:"error",raw:void 0},e.enqueue({type:"error",error:t.error});return}this.state.isFirstChunk&&(this.state.isFirstChunk=!1,e.enqueue({type:"response-metadata",...EI(t)})),t.done&&this.handleDoneChunk(t,e);const n=t?.message;n&&this.processDelta(n,e)}handleDoneChunk(t,e){this.state.finishReason=ww(t.done_reason),this.state.usage={inputTokens:{total:t.prompt_eval_count||0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:t.eval_count||0,text:void 0,reasoning:void 0}},this.state.hasTextStarted&&!this.state.textEnded&&(e.enqueue({type:"text-end",id:this.state.textId}),this.state.textEnded=!0),this.state.hasReasoningStarted&&!this.state.reasoningEnded&&(e.enqueue({type:"reasoning-end",id:this.state.reasoningId}),this.state.reasoningEnded=!0)}processDelta(t,e){this.processTextContent(t,e),this.processThinking(t,e),this.processToolCalls(t,e)}processTextContent(t,e){t?.content!=null&&(this.state.hasTextStarted||(e.enqueue({type:"text-start",id:this.state.textId}),this.state.hasTextStarted=!0),e.enqueue({type:"text-delta",id:this.state.textId,delta:t.content}))}processThinking(t,e){t?.thinking&&(this.state.hasReasoningStarted||(e.enqueue({type:"reasoning-start",id:this.state.reasoningId}),this.state.hasReasoningStarted=!0),e.enqueue({type:"reasoning-delta",id:this.state.reasoningId,delta:t.thinking}))}processToolCalls(t,e){var n,r,i,a;for(const s of(n=t.tool_calls)!=null?n:[]){if(((r=s.function)==null?void 0:r.name)==null)throw new Hh({data:s,message:"Expected 'function.name' to be a string."});((i=s.function)==null?void 0:i.name)!=null&&((a=s.function)==null?void 0:a.arguments)!=null&&this.emitToolCall(s,e)}}emitToolCall(t,e){var n,r,i,a;const s=(a=t.id)!=null?a:(i=(r=(n=this.config).generateId)==null?void 0:r.call(n))!=null?i:Ln();e.enqueue({type:"tool-input-start",id:s,toolName:t.function.name}),e.enqueue({type:"tool-input-delta",id:s,delta:JSON.stringify(t.function.arguments)}),e.enqueue({type:"tool-input-end",id:s}),e.enqueue({type:"tool-call",toolCallId:s,toolName:t.function.name,input:JSON.stringify(t.function.arguments)}),this.state.hasToolCalls=!0}finalizeStream(t){this.state.hasTextStarted&&!this.state.textEnded&&t.enqueue({type:"text-end",id:this.state.textId}),this.state.hasReasoningStarted&&!this.state.reasoningEnded&&t.enqueue({type:"reasoning-end",id:this.state.reasoningId}),t.enqueue({type:"finish",finishReason:this.state.finishReason,usage:this.state.usage,providerMetadata:{ollama:{responseId:this.state.responseId}}})}},D8e=class{constructor(t,e){this.specificationVersion="v3",this.defaultObjectGenerationMode=void 0,this.supportsImageUrls=!0,this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=t,this.config=e,this.provider=e.provider,this.requestBuilder=new R8e,this.responseProcessor=new C8e(e)}async doGenerate(t){const{args:e,warnings:n}=await this.prepareRequest(t),{responseHeaders:r,value:i,rawValue:a}=await Fn({url:this.config.url({path:"/chat",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:{...e,stream:!1},failedResponseHandler:U1,successfulResponseHandler:vr(TI),abortSignal:t.abortSignal,fetch:this.config.fetch});return{...this.responseProcessor.processGenerateResponse(i),request:{body:JSON.stringify(e)},response:{modelId:this.modelId,timestamp:new Date,headers:r,body:a},warnings:n}}async doStream(t){const{args:e,warnings:n}=await this.prepareRequest(t),{responseHeaders:r,value:i}=await Fn({url:this.config.url({path:"/chat",modelId:this.modelId}),headers:Mn(this.config.headers(),t.headers),body:{...e,stream:!0},failedResponseHandler:U1,successfulResponseHandler:Bte(TI),abortSignal:t.abortSignal,fetch:this.config.fetch}),a=new P8e(this.config);return{stream:i.pipeThrough(a.createTransformStream(n,t)),request:{body:e},response:{headers:r},warnings:n}}async prepareRequest(t){return await this.requestBuilder.buildRequest({modelId:this.modelId,...t})}};function Ute(t={}){var e,n;const r=(e=rf(t.baseURL))!=null?e:"http://127.0.0.1:11434/api",i=(n=t.name)!=null?n:"ollama",a=()=>({"Ollama-Organization":t.organization,"Ollama-Project":t.project,...t.headers}),s=(d,h={})=>new w8e(d,h,{provider:`${i}.completion`,url:({path:f})=>`${r}${f}`,headers:a,fetch:t.fetch}),o=(d,h={})=>new E8e(d,h,{provider:`${i}.embedding`,url:({path:f})=>`${r}${f}`,headers:a,fetch:t.fetch}),l=d=>{if(new.target)throw new Error("The Ollama model function cannot be called with the new keyword.");return u(d)},u=d=>new D8e(d,{provider:`${i}.responses`,url:({path:h})=>`${r}${h}`,headers:a,fetch:t.fetch}),c=function(d){return l(d)};return c.specificationVersion="v3",c.languageModel=l,c.chat=l,c.completion=s,c.embedding=o,c.textEmbedding=o,c.textEmbeddingModel=o,c.embeddingModel=o,c.imageModel=d=>{throw new lI({modelId:d,modelType:"imageModel",message:"Image generation is unsupported with Ollama"})},c}Ute();var O8e={},L8e=Object.defineProperty,F8e=Object.defineProperties,B8e=Object.getOwnPropertyDescriptors,PU=Object.getOwnPropertySymbols,U8e=Object.prototype.hasOwnProperty,z8e=Object.prototype.propertyIsEnumerable,DU=(t,e,n)=>e in t?L8e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,wr=(t,e)=>{for(var n in e||(e={}))U8e.call(e,n)&&DU(t,n,e[n]);if(PU)for(var n of PU(e))z8e.call(e,n)&&DU(t,n,e[n]);return t},Sw=(t,e)=>F8e(t,B8e(e)),zte="vercel.ai.error",j8e=Symbol.for(zte),jte,H8e=class Hte extends Error{constructor({name:e,message:n,cause:r}){super(n),this[jte]=!0,this.name=e,this.cause=r}static isInstance(e){return Hte.hasMarker(e,zte)}static hasMarker(e,n){const r=Symbol.for(n);return e!=null&&typeof e=="object"&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};jte=j8e;var $i=H8e,$te="AI_APICallError",Vte=`vercel.ai.error.${$te}`,$8e=Symbol.for(Vte),qte,Zo=class extends $i{constructor({message:t,url:e,requestBodyValues:n,statusCode:r,responseHeaders:i,responseBody:a,cause:s,isRetryable:o=r!=null&&(r===408||r===409||r===429||r>=500),data:l}){super({name:$te,message:t,cause:s}),this[qte]=!0,this.url=e,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=i,this.responseBody=a,this.isRetryable=o,this.data=l}static isInstance(t){return $i.hasMarker(t,Vte)}};qte=$8e;var Gte="AI_EmptyResponseBodyError",Wte=`vercel.ai.error.${Gte}`,V8e=Symbol.for(Wte),Yte,q8e=class extends $i{constructor({message:t="Empty response body"}={}){super({name:Gte,message:t}),this[Yte]=!0}static isInstance(t){return $i.hasMarker(t,Wte)}};Yte=V8e;function Xte(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Kte="AI_InvalidArgumentError",Zte=`vercel.ai.error.${Kte}`,G8e=Symbol.for(Zte),Jte,Qte=class extends $i{constructor({message:t,cause:e,argument:n}){super({name:Kte,message:t,cause:e}),this[Jte]=!0,this.argument=n}static isInstance(t){return $i.hasMarker(t,Zte)}};Jte=G8e;var ene="AI_InvalidPromptError",tne=`vercel.ai.error.${ene}`,W8e=Symbol.for(tne),nne,Y8e=class extends $i{constructor({prompt:t,message:e,cause:n}){super({name:ene,message:`Invalid prompt: ${e}`,cause:n}),this[nne]=!0,this.prompt=t}static isInstance(t){return $i.hasMarker(t,tne)}};nne=W8e;var rne="AI_InvalidResponseDataError",ine=`vercel.ai.error.${rne}`,X8e=Symbol.for(ine),ane,eg=class extends $i{constructor({data:t,message:e=`Invalid response data: ${JSON.stringify(t)}.`}){super({name:rne,message:e}),this[ane]=!0,this.data=t}static isInstance(t){return $i.hasMarker(t,ine)}};ane=X8e;var sne="AI_JSONParseError",one=`vercel.ai.error.${sne}`,K8e=Symbol.for(one),lne,Ew=class extends $i{constructor({text:t,cause:e}){super({name:sne,message:`JSON parsing failed: Text: ${t}.
Error message: ${Xte(e)}`,cause:e}),this[lne]=!0,this.text=t}static isInstance(t){return $i.hasMarker(t,one)}};lne=K8e;var une="AI_LoadAPIKeyError",cne=`vercel.ai.error.${une}`,Z8e=Symbol.for(cne),dne,rb=class extends $i{constructor({message:t}){super({name:une,message:t}),this[dne]=!0}static isInstance(t){return $i.hasMarker(t,cne)}};dne=Z8e;var hne="AI_NoContentGeneratedError",fne=`vercel.ai.error.${hne}`,J8e=Symbol.for(fne),pne,mne=class extends $i{constructor({message:t="No content generated."}={}){super({name:hne,message:t}),this[pne]=!0}static isInstance(t){return $i.hasMarker(t,fne)}};pne=J8e;var gne="AI_TypeValidationError",vne=`vercel.ai.error.${gne}`,Q8e=Symbol.for(vne),yne,eRe=class CI extends $i{constructor({value:e,cause:n}){super({name:gne,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Xte(n)}`,cause:n}),this[yne]=!0,this.value=e}static isInstance(e){return $i.hasMarker(e,vne)}static wrap({value:e,cause:n}){return CI.isInstance(n)&&n.value===e?n:new CI({value:e,cause:n})}};yne=Q8e;var z1=eRe,xne="AI_UnsupportedFunctionalityError",bne=`vercel.ai.error.${xne}`,tRe=Symbol.for(bne),_ne,Uc=class extends $i{constructor({functionality:t,message:e=`'${t}' functionality not supported.`}){super({name:xne,message:e}),this[_ne]=!0,this.functionality=t}static isInstance(t){return $i.hasMarker(t,bne)}};_ne=tRe;var OU=class extends Error{constructor(e,n){super(e),this.name="ParseError",this.type=n.type,this.field=n.field,this.value=n.value,this.line=n.line}};function aT(t){}function nRe(t){if(typeof t=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=aT,onError:n=aT,onRetry:r=aT,onComment:i}=t;let a="",s=!0,o,l="",u="";function c(x){const b=s?x.replace(/^\xEF\xBB\xBF/,""):x,[y,w]=rRe(`${a}${b}`);for(const _ of y)d(_);a=w,s=!1}function d(x){if(x===""){f();return}if(x.startsWith(":")){i&&i(x.slice(x.startsWith(": ")?2:1));return}const b=x.indexOf(":");if(b!==-1){const y=x.slice(0,b),w=x[b+1]===" "?2:1,_=x.slice(b+w);h(y,_,x);return}h(x,"",x)}function h(x,b,y){switch(x){case"event":u=b;break;case"data":l=`${l}${b}
`;break;case"id":o=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?r(parseInt(b,10)):n(new OU(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:y}));break;default:n(new OU(`Unknown field "${x.length>20?`${x.slice(0,20)}…`:x}"`,{type:"unknown-field",field:x,value:b,line:y}));break}}function f(){l.length>0&&e({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u=""}function m(x={}){a&&x.consume&&d(a),s=!0,o=void 0,l="",u="",a=""}return{feed:c,reset:m}}function rRe(t){const e=[];let n="",r=0;for(;r<t.length;){const i=t.indexOf("\r",r),a=t.indexOf(`
`,r);let s=-1;if(i!==-1&&a!==-1?s=Math.min(i,a):i!==-1?s=i:a!==-1&&(s=a),s===-1){n=t.slice(r);break}else{const o=t.slice(r,s);e.push(o),r=s+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,n]}var iRe=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:n}={}){let r;super({start(i){r=nRe({onEvent:a=>{i.enqueue(a)},onError(a){t==="terminate"?i.error(a):typeof t=="function"&&t(a)},onRetry:e,onComment:n})},transform(i){r.feed(i)}})}};new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function j1(...t){return t.reduce((e,n)=>wr(wr({},e),n??{}),{})}function u3(t){return Object.fromEntries([...t.headers])}var aRe=({prefix:t,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const i=()=>{const a=n.length,s=new Array(e);for(let o=0;o<e;o++)s[o]=n[Math.random()*a|0];return s.join("")};if(t==null)return i;if(n.includes(r))throw new Qte({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${t}${r}${i()}`},Ho=aRe();function MI(t){return(t instanceof Error||t instanceof DOMException)&&(t.name==="AbortError"||t.name==="ResponseAborted"||t.name==="TimeoutError")}var sRe=["fetch failed","failed to fetch"];function oRe({error:t,url:e,requestBodyValues:n}){if(MI(t))return t;if(t instanceof TypeError&&sRe.includes(t.message.toLowerCase())){const r=t.cause;if(r!=null)return new Zo({message:`Cannot connect to API: ${r.message}`,cause:r,url:e,requestBodyValues:n,isRetryable:!0})}return t}function lRe(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>n!=null))}function uRe({apiKey:t,environmentVariableName:e,apiKeyParameterName:n="apiKey",description:r}){if(typeof t=="string")return t;if(t!=null)throw new rb({message:`${r} API key must be a string.`});if(typeof process>"u")throw new rb({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(t=O8e[e],t==null)throw new rb({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${e} environment variable.`});if(typeof t!="string")throw new rb({message:`${r} API key must be a string. The value of the ${e} environment variable is not a string.`});return t}var cRe=/"__proto__"\s*:/,dRe=/"constructor"\s*:/;function hRe(t){const e=JSON.parse(t);return e===null||typeof e!="object"||cRe.test(t)===!1&&dRe.test(t)===!1?e:fRe(e)}function fRe(t){let e=[t];for(;e.length;){const n=e;e=[];for(const r of n){if(Object.prototype.hasOwnProperty.call(r,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const i in r){const a=r[i];a&&typeof a=="object"&&e.push(a)}}}return t}function pR(t){const{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return hRe(t)}finally{Error.stackTraceLimit=e}}var AI=Symbol.for("vercel.ai.validator");function pRe(t){return{[AI]:!0,validate:t}}function mRe(t){return typeof t=="object"&&t!==null&&AI in t&&t[AI]===!0&&"validate"in t}function gRe(t){return mRe(t)?t:vRe(t)}function vRe(t){return pRe(async e=>{const n=await t["~standard"].validate(e);return n.issues==null?{success:!0,value:n.value}:{success:!1,error:new z1({value:e,cause:n.issues})}})}async function yRe({value:t,schema:e}){const n=await wne({value:t,schema:e});if(!n.success)throw z1.wrap({value:t,cause:n.error});return n.value}async function wne({value:t,schema:e}){const n=gRe(e);try{if(n.validate==null)return{success:!0,value:t,rawValue:t};const r=await n.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:z1.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:z1.wrap({value:t,cause:r}),rawValue:t}}}async function xRe({text:t,schema:e}){try{const n=pR(t);return e==null?n:yRe({value:n,schema:e})}catch(n){throw Ew.isInstance(n)||z1.isInstance(n)?n:new Ew({text:t,cause:n})}}async function Sne({text:t,schema:e}){try{const n=pR(t);return e==null?{success:!0,value:n,rawValue:n}:await wne({value:n,schema:e})}catch(n){return{success:!1,error:Ew.isInstance(n)?n:new Ew({text:t,cause:n}),rawValue:void 0}}}function sT(t){try{return pR(t),!0}catch{return!1}}function bRe({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new iRe).pipeThrough(new TransformStream({async transform({data:n},r){n!=="[DONE]"&&r.enqueue(await Sne({text:n,schema:e}))}}))}var _Re=()=>globalThis.fetch,H1=async({url:t,headers:e,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s})=>wRe({url:t,headers:wr({"Content-Type":"application/json"},e),body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:s}),wRe=async({url:t,headers:e={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:s=_Re()})=>{try{const o=await s(t,{method:"POST",headers:lRe(e),body:n.content,signal:a}),l=u3(o);if(!o.ok){let u;try{u=await i({response:o,url:t,requestBodyValues:n.values})}catch(c){throw MI(c)||Zo.isInstance(c)?c:new Zo({message:"Failed to process error response",cause:c,statusCode:o.status,url:t,responseHeaders:l,requestBodyValues:n.values})}throw u.value}try{return await r({response:o,url:t,requestBodyValues:n.values})}catch(u){throw u instanceof Error&&(MI(u)||Zo.isInstance(u))?u:new Zo({message:"Failed to process successful response",cause:u,statusCode:o.status,url:t,responseHeaders:l,requestBodyValues:n.values})}}catch(o){throw oRe({error:o,url:t,requestBodyValues:n.values})}},SRe=({errorSchema:t,errorToMessage:e,isRetryable:n})=>async({response:r,url:i,requestBodyValues:a})=>{const s=await r.text(),o=u3(r);if(s.trim()==="")return{responseHeaders:o,value:new Zo({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,isRetryable:n?.(r)})};try{const l=await xRe({text:s,schema:t});return{responseHeaders:o,value:new Zo({message:e(l),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,data:l,isRetryable:n?.(r,l)})}}catch{return{responseHeaders:o,value:new Zo({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:s,isRetryable:n?.(r)})}}},Ene=t=>async({response:e})=>{const n=u3(e);if(e.body==null)throw new q8e({});return{responseHeaders:n,value:bRe({stream:e.body,schema:t})}},mR=t=>async({response:e,url:n,requestBodyValues:r})=>{const i=await e.text(),a=await Sne({text:i,schema:t}),s=u3(e);if(!a.success)throw new Zo({message:"Invalid JSON response",cause:a.error,statusCode:e.status,responseHeaders:s,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:s,value:a.value,rawValue:a.rawValue}},{btoa:ERe}=globalThis;function TRe(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCodePoint(t[n]);return ERe(e)}function CRe(t){return t?.replace(/\/$/,"")}function oT(t){return t!=null}var Tne=(t=>(t.Unknown="unknown",t.OpenAIResponsesV1="openai-responses-v1",t.XAIResponsesV1="xai-responses-v1",t.AnthropicClaudeV1="anthropic-claude-v1",t.GoogleGeminiV1="google-gemini-v1",t))(Tne||{}),gR=B({id:A().nullish(),format:wt(Tne).nullish(),index:ie().optional()}).loose(),MRe=B({type:ae("reasoning.summary"),summary:A()}).extend(gR.shape),ARe=B({type:ae("reasoning.encrypted"),data:A()}).extend(gR.shape),kRe=B({type:ae("reasoning.text"),text:A().nullish(),signature:A().nullish()}).extend(gR.shape),vR=vt([MRe,ARe,kRe]),Vb=vt([vR,Zn().transform(()=>null)]),yR=Ce(Vb).transform(t=>t.filter(e=>!!e));vt([B({delta:B({reasoning_details:Ce(Vb)})}).transform(t=>t.delta.reasoning_details.filter(oT)),B({message:B({reasoning_details:Ce(Vb)})}).transform(t=>t.message.reasoning_details.filter(oT)),B({text:A(),reasoning_details:Ce(Vb)}).transform(t=>t.reasoning_details.filter(oT))]);var c3=B({error:B({code:vt([A(),ie()]).nullable().optional().default(null),message:A(),type:A().nullable().optional().default(null),param:gr().nullable().optional().default(null)}).passthrough()}).passthrough(),$1=SRe({errorSchema:c3,errorToMessage:t=>t.error.message}),Cne=B({type:ae("file"),file:B({hash:A(),name:A(),content:Ce(B({type:A(),text:A().optional()}).catchall(gr())).optional()}).catchall(gr())}).catchall(gr()),IRe=B({provider:A(),reasoning_details:Ce(vR).optional(),annotations:Ce(Cne).optional(),usage:B({promptTokens:ie(),promptTokensDetails:B({cachedTokens:ie()}).catchall(gr()).optional(),completionTokens:ie(),completionTokensDetails:B({reasoningTokens:ie()}).catchall(gr()).optional(),totalTokens:ie(),cost:ie().optional(),costDetails:B({upstreamInferenceCost:ie()}).catchall(gr()).optional()}).catchall(gr())}).catchall(gr()),LU=B({openrouter:B({reasoning_details:Ce(vR).optional(),annotations:Ce(Cne).optional()}).optional()}).optional();function Tw(t){switch(t){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var NRe=["wav","mp3","aiff","aac","ogg","flac","m4a","pcm16","pcm24"];function xR({url:t,protocols:e}){try{const n=new URL(t);return e.has(n.protocol)}catch{return!1}}function kI({part:t,defaultMediaType:e}){var n,r;if(t.data instanceof Uint8Array){const a=TRe(t.data);return`data:${(n=t.mediaType)!=null?n:e};base64,${a}`}const i=t.data.toString();return xR({url:i,protocols:new Set(["http:","https:"])})||i.startsWith("data:")?i:`data:${(r=t.mediaType)!=null?r:e};base64,${i}`}function FU(t,e){var n;const r=t.match(/^data:([^;]+)/);return r&&(n=r[1])!=null?n:e}function II(t){const e=t.match(/^data:[^;]*;base64,(.+)$/);return e?e[1]:t}var RRe={mpeg:"mp3",mp3:"mp3","x-wav":"wav",wave:"wav",wav:"wav",ogg:"ogg",vorbis:"ogg",aac:"aac","x-aac":"aac",m4a:"m4a","x-m4a":"m4a",mp4:"m4a",aiff:"aiff","x-aiff":"aiff",flac:"flac","x-flac":"flac",pcm16:"pcm16",pcm24:"pcm24"};function PRe(t){const e=kI({part:t,defaultMediaType:"audio/mpeg"});if(xR({url:e,protocols:new Set(["http:","https:"])}))throw new Error(`Audio files cannot be provided as URLs.

OpenRouter requires audio to be base64-encoded. Please:
1. Download the audio file locally
2. Read it as a Buffer or Uint8Array
3. Pass it as the data parameter

The AI SDK will automatically handle base64 encoding.

Learn more: https://openrouter.ai/docs/features/multimodal/audio`);const n=II(e),r=t.mediaType||"audio/mpeg",i=r.replace("audio/",""),a=RRe[i];if(a===void 0){const s=NRe.join(", ");throw new Error(`Unsupported audio format: "${r}"

OpenRouter supports the following audio formats: ${s}

Learn more: https://openrouter.ai/docs/features/multimodal/audio`)}return{data:n,format:a}}function kc(t){var e,n,r;const i=t?.anthropic,a=t?.openrouter;return(r=(n=(e=a?.cacheControl)!=null?e:a?.cache_control)!=null?n:i?.cacheControl)!=null?r:i?.cache_control}function DRe(t){var e,n,r,i,a,s,o,l,u,c;const d=[];for(const{role:h,content:f,providerOptions:m}of t)switch(h){case"system":{d.push({role:"system",content:f,cache_control:kc(m)});break}case"user":{if(f.length===1&&((e=f[0])==null?void 0:e.type)==="text"){const y=(n=kc(m))!=null?n:kc(f[0].providerOptions),w=y?[{type:"text",text:f[0].text,cache_control:y}]:f[0].text;d.push({role:"user",content:w});break}const x=kc(m),b=f.map(y=>{var w,_,S,M,E,C,R;const k=(w=kc(y.providerOptions))!=null?w:x;switch(y.type){case"text":return{type:"text",text:y.text,cache_control:k};case"file":{if((_=y.mediaType)!=null&&_.startsWith("image/"))return{type:"image_url",image_url:{url:kI({part:y,defaultMediaType:"image/jpeg"})},cache_control:k};if((S=y.mediaType)!=null&&S.startsWith("audio/"))return{type:"input_audio",input_audio:PRe(y),cache_control:k};const I=String((R=(C=(E=(M=y.providerOptions)==null?void 0:M.openrouter)==null?void 0:E.filename)!=null?C:y.filename)!=null?R:""),N=kI({part:y,defaultMediaType:"application/pdf"});return xR({url:N,protocols:new Set(["http:","https:"])})?{type:"file",file:{filename:I,file_data:N}}:{type:"file",file:{filename:I,file_data:N},cache_control:k}}default:return{type:"text",text:"",cache_control:k}}});d.push({role:"user",content:b});break}case"assistant":{let x="",b="";const y=[],w=[];for(const C of f)switch(C.type){case"text":{x+=C.text;break}case"tool-call":{const R=(r=C.providerOptions)==null?void 0:r.openrouter;R?.reasoning_details&&Array.isArray(R.reasoning_details)&&w.push(...R.reasoning_details),y.push({id:C.toolCallId,type:"function",function:{name:C.toolName,arguments:JSON.stringify(C.input)}});break}case"reasoning":{b+=C.text;const R=LU.safeParse(C.providerOptions);R.success&&((a=(i=R.data)==null?void 0:i.openrouter)!=null&&a.reasoning_details)&&w.push(...R.data.openrouter.reasoning_details);break}}const _=LU.safeParse(m),S=_.success?(o=(s=_.data)==null?void 0:s.openrouter)==null?void 0:o.reasoning_details:void 0,M=_.success?(u=(l=_.data)==null?void 0:l.openrouter)==null?void 0:u.annotations:void 0,E=S&&Array.isArray(S)&&S.length>0?S:w.length>0?w:void 0;d.push({role:"assistant",content:x,tool_calls:y.length>0?y:void 0,reasoning:b||void 0,reasoning_details:E,annotations:M,cache_control:kc(m)});break}case"tool":{for(const x of f){const b=ORe(x);d.push({role:"tool",tool_call_id:x.toolCallId,content:b,cache_control:(c=kc(m))!=null?c:kc(x.providerOptions)})}break}}return d}function ORe(t){return t.output.type==="text"?t.output.value:JSON.stringify(t.output.value)}vt([ae("auto"),ae("none"),ae("required"),B({type:ae("function"),function:B({name:A()})})]);function LRe(t){switch(t.type){case"auto":case"none":case"required":return t.type;case"tool":return{type:"function",function:{name:t.toolName}};default:throw new Qte({argument:"toolChoice",message:`Invalid tool choice type: ${JSON.stringify(t)}`})}}var FRe=B({type:ae("image_url"),image_url:B({url:A()}).passthrough()}).passthrough(),BRe=vt([FRe,Zn().transform(()=>null)]),Mne=Ce(BRe).transform(t=>t.filter(e=>!!e)),Ane=B({id:A().optional(),model:A().optional(),provider:A().optional(),usage:B({prompt_tokens:ie(),prompt_tokens_details:B({cached_tokens:ie()}).passthrough().nullish(),completion_tokens:ie(),completion_tokens_details:B({reasoning_tokens:ie()}).passthrough().nullish(),total_tokens:ie(),cost:ie().optional(),cost_details:B({upstream_inference_cost:ie().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),URe=vt([Ane.extend({choices:Ce(B({message:B({role:ae("assistant"),content:A().nullable().optional(),reasoning:A().nullable().optional(),reasoning_details:yR.nullish(),images:Mne.nullish(),tool_calls:Ce(B({id:A().optional().nullable(),type:ae("function"),function:B({name:A(),arguments:A()}).passthrough()}).passthrough()).optional(),annotations:Ce(vt([B({type:ae("url_citation"),url_citation:B({end_index:ie(),start_index:ie(),title:A(),url:A(),content:A().optional()}).passthrough()}).passthrough(),B({type:ae("file_annotation"),file_annotation:B({file_id:A(),quote:A().optional()}).passthrough()}).passthrough(),B({type:ae("file"),file:B({hash:A(),name:A(),content:Ce(B({type:A(),text:A().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough(),index:ie().nullish(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}).passthrough())}).passthrough()).nullable()}).passthrough().nullable().optional(),finish_reason:A().optional().nullable()}).passthrough())}),c3.extend({user_id:A().optional()})]),zRe=vt([Ane.extend({choices:Ce(B({delta:B({role:wt(["assistant"]).optional(),content:A().nullish(),reasoning:A().nullish().optional(),reasoning_details:yR.nullish(),images:Mne.nullish(),tool_calls:Ce(B({index:ie().nullish(),id:A().nullish(),type:ae("function").optional(),function:B({name:A().nullish(),arguments:A().nullish()}).passthrough()}).passthrough()).nullish(),annotations:Ce(vt([B({type:ae("url_citation"),url_citation:B({end_index:ie(),start_index:ie(),title:A(),url:A(),content:A().optional()}).passthrough()}).passthrough(),B({type:ae("file_annotation"),file_annotation:B({file_id:A(),quote:A().optional()}).passthrough()}).passthrough(),B({type:ae("file"),file:B({hash:A(),name:A(),content:Ce(B({type:A(),text:A().optional()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough().nullish(),logprobs:B({content:Ce(B({token:A(),logprob:ie(),top_logprobs:Ce(B({token:A(),logprob:ie()}).passthrough())}).passthrough()).nullable()}).passthrough().nullish(),finish_reason:A().nullable().optional(),index:ie().nullish()}).passthrough())}),c3]),jRe=class{constructor(t,e,n){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!0,this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=t,this.settings=e,this.config=n}getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,frequencyPenalty:i,presencePenalty:a,seed:s,stopSequences:o,responseFormat:l,topK:u,tools:c,toolChoice:d}){var h;const f=wr(wr({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:e,temperature:n,top_p:r,frequency_penalty:i,presence_penalty:a,seed:s,stop:o,response_format:l?.type==="json"?l.schema!=null?{type:"json_schema",json_schema:wr({schema:l.schema,strict:!0,name:(h=l.name)!=null?h:"response"},l.description&&{description:l.description})}:{type:"json_object"}:void 0,top_k:u,messages:DRe(t),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider,debug:this.settings.debug},this.config.extraBody),this.settings.extraBody);if(c&&c.length>0){const m=c.filter(x=>x.type==="function").map(x=>({type:"function",function:{name:x.name,description:x.description,parameters:x.inputSchema}}));return Sw(wr({},f),{tools:m,tool_choice:d?LRe(d):void 0})}return f}async doGenerate(t){var e,n,r,i,a,s,o,l,u,c,d,h,f,m,x,b,y,w,_,S,M,E,C;const k=(t.providerOptions||{}).openrouter||{},I=wr(wr({},this.getArgs(t)),k),{value:N,responseHeaders:D}=await H1({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:j1(this.config.headers(),t.headers),body:I,failedResponseHandler:$1,successfulResponseHandler:mR(URe),abortSignal:t.abortSignal,fetch:this.config.fetch});if("error"in N){const J=N.error;throw new Zo({message:J.message,url:this.config.url({path:"/chat/completions",modelId:this.modelId}),requestBodyValues:I,statusCode:200,responseHeaders:D,data:J})}const F=N,L=F.choices[0];if(!L)throw new mne({message:"No choice in response"});const U=F.usage?{inputTokens:(e=F.usage.prompt_tokens)!=null?e:0,outputTokens:(n=F.usage.completion_tokens)!=null?n:0,totalTokens:((r=F.usage.prompt_tokens)!=null?r:0)+((i=F.usage.completion_tokens)!=null?i:0),reasoningTokens:(s=(a=F.usage.completion_tokens_details)==null?void 0:a.reasoning_tokens)!=null?s:0,cachedInputTokens:(l=(o=F.usage.prompt_tokens_details)==null?void 0:o.cached_tokens)!=null?l:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},j=(u=L.message.reasoning_details)!=null?u:[],q=j.length>0?j.map(J=>{switch(J.type){case"reasoning.text":{if(J.text)return{type:"reasoning",text:J.text,providerMetadata:{openrouter:{reasoning_details:[J]}}};break}case"reasoning.summary":{if(J.summary)return{type:"reasoning",text:J.summary,providerMetadata:{openrouter:{reasoning_details:[J]}}};break}case"reasoning.encrypted":{if(J.data)return{type:"reasoning",text:"[REDACTED]",providerMetadata:{openrouter:{reasoning_details:[J]}}};break}}return null}).filter(J=>J!==null):L.message.reasoning?[{type:"reasoning",text:L.message.reasoning}]:[],Z=[];if(Z.push(...q),L.message.content&&Z.push({type:"text",text:L.message.content}),L.message.tool_calls)for(const J of L.message.tool_calls)Z.push({type:"tool-call",toolCallId:(c=J.id)!=null?c:Ho(),toolName:J.function.name,input:J.function.arguments,providerMetadata:{openrouter:{reasoning_details:j}}});if(L.message.images)for(const J of L.message.images)Z.push({type:"file",mediaType:FU(J.image_url.url,"image/jpeg"),data:II(J.image_url.url)});if(L.message.annotations)for(const J of L.message.annotations)J.type==="url_citation"&&Z.push({type:"source",sourceType:"url",id:J.url_citation.url,url:J.url_citation.url,title:J.url_citation.title,providerMetadata:{openrouter:{content:J.url_citation.content||""}}});const Q=(d=L.message.annotations)==null?void 0:d.filter(J=>J.type==="file"),z=L.message.tool_calls&&L.message.tool_calls.length>0,W=j.some(J=>J.type==="reasoning.encrypted"&&J.data),H=z&&W&&L.finish_reason==="stop"?"tool-calls":Tw(L.finish_reason);return{content:Z,finishReason:H,usage:U,warnings:[],providerMetadata:{openrouter:IRe.parse({provider:(h=F.provider)!=null?h:"",reasoning_details:(f=L.message.reasoning_details)!=null?f:[],annotations:Q&&Q.length>0?Q:void 0,usage:wr(wr(wr({promptTokens:(m=U.inputTokens)!=null?m:0,completionTokens:(x=U.outputTokens)!=null?x:0,totalTokens:(b=U.totalTokens)!=null?b:0,cost:(y=F.usage)==null?void 0:y.cost},((_=(w=F.usage)==null?void 0:w.prompt_tokens_details)==null?void 0:_.cached_tokens)!=null?{promptTokensDetails:{cachedTokens:F.usage.prompt_tokens_details.cached_tokens}}:{}),((M=(S=F.usage)==null?void 0:S.completion_tokens_details)==null?void 0:M.reasoning_tokens)!=null?{completionTokensDetails:{reasoningTokens:F.usage.completion_tokens_details.reasoning_tokens}}:{}),((C=(E=F.usage)==null?void 0:E.cost_details)==null?void 0:C.upstream_inference_cost)!=null?{costDetails:{upstreamInferenceCost:F.usage.cost_details.upstream_inference_cost}}:{})})},request:{body:I},response:{id:F.id,modelId:F.model,headers:D}}}async doStream(t){var e;const r=(t.providerOptions||{}).openrouter||{},i=wr(wr({},this.getArgs(t)),r),{value:a,responseHeaders:s}=await H1({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:j1(this.config.headers(),t.headers),body:Sw(wr({},i),{stream:!0,stream_options:this.config.compatibility==="strict"?wr({include_usage:!0},(e=this.settings.usage)!=null&&e.include?{include_usage:!0}:{}):void 0}),failedResponseHandler:$1,successfulResponseHandler:Ene(zRe),abortSignal:t.abortSignal,fetch:this.config.fetch}),o=[];let l="other";const u={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},c={},d=[],h=[];let f=!1,m=!1,x,b,y,w;return{stream:a.pipeThrough(new TransformStream({transform(_,S){var M,E,C,R,k,I,N,D,F,L,U,j,q,Z,Q;if(!_.success){l="error",S.enqueue({type:"error",error:_.error});return}const z=_.value;if("error"in z){l="error",S.enqueue({type:"error",error:z.error});return}if(z.provider&&(w=z.provider),z.id&&(y=z.id,S.enqueue({type:"response-metadata",id:z.id})),z.model&&S.enqueue({type:"response-metadata",modelId:z.model}),z.usage!=null){if(u.inputTokens=z.usage.prompt_tokens,u.outputTokens=z.usage.completion_tokens,u.totalTokens=z.usage.prompt_tokens+z.usage.completion_tokens,c.promptTokens=z.usage.prompt_tokens,z.usage.prompt_tokens_details){const te=(M=z.usage.prompt_tokens_details.cached_tokens)!=null?M:0;u.cachedInputTokens=te,c.promptTokensDetails={cachedTokens:te}}if(c.completionTokens=z.usage.completion_tokens,z.usage.completion_tokens_details){const te=(E=z.usage.completion_tokens_details.reasoning_tokens)!=null?E:0;u.reasoningTokens=te,c.completionTokensDetails={reasoningTokens:te}}c.cost=z.usage.cost,c.totalTokens=z.usage.total_tokens;const J=(C=z.usage.cost_details)==null?void 0:C.upstream_inference_cost;J!=null&&(c.costDetails={upstreamInferenceCost:J})}const W=z.choices[0];if(W?.finish_reason!=null&&(l=Tw(W.finish_reason)),W?.delta==null)return;const X=W.delta,H=(J,te)=>{m||(b=y||Ho(),S.enqueue({providerMetadata:te,type:"reasoning-start",id:b}),m=!0),S.enqueue({providerMetadata:te,type:"reasoning-delta",delta:J,id:b||Ho()})};if(X.reasoning_details&&X.reasoning_details.length>0){for(const te of X.reasoning_details)if(te.type==="reasoning.text"){const ee=d[d.length-1];ee?.type==="reasoning.text"?(ee.text=(ee.text||"")+(te.text||""),ee.signature=ee.signature||te.signature,ee.format=ee.format||te.format):d.push(wr({},te))}else d.push(te);const J={openrouter:{reasoning_details:X.reasoning_details}};for(const te of X.reasoning_details)switch(te.type){case"reasoning.text":{te.text&&H(te.text,J);break}case"reasoning.encrypted":{te.data&&H("[REDACTED]",J);break}case"reasoning.summary":{te.summary&&H(te.summary,J);break}}}else X.reasoning&&H(X.reasoning);if(X.content&&(m&&!f&&(S.enqueue({type:"reasoning-end",id:b||Ho()}),m=!1),f||(x=y||Ho(),S.enqueue({type:"text-start",id:x}),f=!0),S.enqueue({type:"text-delta",delta:X.content,id:x||Ho()})),X.annotations){for(const J of X.annotations)if(J.type==="url_citation")S.enqueue({type:"source",sourceType:"url",id:J.url_citation.url,url:J.url_citation.url,title:J.url_citation.title,providerMetadata:{openrouter:{content:J.url_citation.content||""}}});else if(J.type==="file"){const te=J.file;te&&typeof te=="object"&&"hash"in te&&"name"in te&&h.push(J)}}if(X.tool_calls!=null)for(const J of X.tool_calls){const te=(R=J.index)!=null?R:o.length-1;if(o[te]==null){if(J.type!=="function")throw new eg({data:J,message:"Expected 'function' type."});if(J.id==null)throw new eg({data:J,message:"Expected 'id' to be a string."});if(((k=J.function)==null?void 0:k.name)==null)throw new eg({data:J,message:"Expected 'function.name' to be a string."});o[te]={id:J.id,type:"function",function:{name:J.function.name,arguments:(I=J.function.arguments)!=null?I:""},inputStarted:!1,sent:!1};const se=o[te];if(se==null)throw new eg({data:{index:te,toolCallsLength:o.length},message:`Tool call at index ${te} is missing after creation.`});((N=se.function)==null?void 0:N.name)!=null&&((D=se.function)==null?void 0:D.arguments)!=null&&sT(se.function.arguments)&&(se.inputStarted=!0,S.enqueue({type:"tool-input-start",id:se.id,toolName:se.function.name}),S.enqueue({type:"tool-input-delta",id:se.id,delta:se.function.arguments}),S.enqueue({type:"tool-input-end",id:se.id}),S.enqueue({type:"tool-call",toolCallId:se.id,toolName:se.function.name,input:se.function.arguments,providerMetadata:{openrouter:{reasoning_details:d}}}),se.sent=!0);continue}const ee=o[te];if(ee==null)throw new eg({data:{index:te,toolCallsLength:o.length,toolCallDelta:J},message:`Tool call at index ${te} is missing during merge.`});ee.inputStarted||(ee.inputStarted=!0,S.enqueue({type:"tool-input-start",id:ee.id,toolName:ee.function.name})),((F=J.function)==null?void 0:F.arguments)!=null&&(ee.function.arguments+=(U=(L=J.function)==null?void 0:L.arguments)!=null?U:""),S.enqueue({type:"tool-input-delta",id:ee.id,delta:(j=J.function.arguments)!=null?j:""}),((q=ee.function)==null?void 0:q.name)!=null&&((Z=ee.function)==null?void 0:Z.arguments)!=null&&sT(ee.function.arguments)&&(S.enqueue({type:"tool-call",toolCallId:(Q=ee.id)!=null?Q:Ho(),toolName:ee.function.name,input:ee.function.arguments,providerMetadata:{openrouter:{reasoning_details:d}}}),ee.sent=!0)}if(X.images!=null)for(const J of X.images)S.enqueue({type:"file",mediaType:FU(J.image_url.url,"image/jpeg"),data:II(J.image_url.url)})},flush(_){var S;const M=o.length>0,E=d.some(R=>R.type==="reasoning.encrypted"&&R.data);if(M&&E&&l==="stop"&&(l="tool-calls"),l==="tool-calls")for(const R of o)R&&!R.sent&&(_.enqueue({type:"tool-call",toolCallId:(S=R.id)!=null?S:Ho(),toolName:R.function.name,input:sT(R.function.arguments)?R.function.arguments:"{}",providerMetadata:{openrouter:{reasoning_details:d}}}),R.sent=!0);m&&_.enqueue({type:"reasoning-end",id:b||Ho()}),f&&_.enqueue({type:"text-end",id:x||Ho()});const C={usage:c};w!==void 0&&(C.provider=w),d.length>0&&(C.reasoning_details=d),h.length>0&&(C.annotations=h),_.enqueue({type:"finish",finishReason:l,usage:u,providerMetadata:{openrouter:C}})}})),warnings:[],request:{body:i},response:{headers:s}}}};function HRe({prompt:t,inputFormat:e,user:n="user",assistant:r="assistant"}){if(t.length===1&&t[0]&&t[0].role==="user"&&t[0].content.length===1&&t[0].content[0]&&t[0].content[0].type==="text")return{prompt:t[0].content[0].text};let i="";t[0]&&t[0].role==="system"&&(i+=`${t[0].content}

`,t=t.slice(1));for(const{role:a,content:s}of t)switch(a){case"system":throw new Y8e({message:`Unexpected system message in prompt: ${s}`,prompt:t});case"user":{const o=s.map(l=>{switch(l.type){case"text":return l.text;case"file":throw new Uc({functionality:"file attachments"});default:return""}}).join("");i+=`${n}:
${o}

`;break}case"assistant":{const o=s.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new Uc({functionality:"tool-call messages"});case"tool-result":throw new Uc({functionality:"tool-result messages"});case"reasoning":throw new Uc({functionality:"reasoning messages"});case"file":throw new Uc({functionality:"file attachments"});default:return""}}).join("");i+=`${r}:
${o}

`;break}case"tool":throw new Uc({functionality:"tool messages"})}return i+=`${r}:
`,{prompt:i}}var BU=vt([B({id:A().optional(),model:A().optional(),choices:Ce(B({text:A(),reasoning:A().nullish().optional(),reasoning_details:yR.nullish(),finish_reason:A().nullish(),index:ie().nullish(),logprobs:B({tokens:Ce(A()),token_logprobs:Ce(ie()),top_logprobs:Ce(sn(A(),ie())).nullable()}).passthrough().nullable().optional()}).passthrough()),usage:B({prompt_tokens:ie(),prompt_tokens_details:B({cached_tokens:ie()}).passthrough().nullish(),completion_tokens:ie(),completion_tokens_details:B({reasoning_tokens:ie()}).passthrough().nullish(),total_tokens:ie(),cost:ie().optional(),cost_details:B({upstream_inference_cost:ie().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),c3]),$Re=class{constructor(t,e,n){this.specificationVersion="v2",this.provider="openrouter",this.supportsImageUrls=!0,this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=t,this.settings=e,this.config=n}getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,frequencyPenalty:i,presencePenalty:a,seed:s,responseFormat:o,topK:l,stopSequences:u,tools:c,toolChoice:d}){const{prompt:h}=HRe({prompt:t,inputFormat:"prompt"});if(c?.length)throw new Uc({functionality:"tools"});if(d)throw new Uc({functionality:"toolChoice"});return wr(wr({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:e,temperature:n,top_p:r,frequency_penalty:i,presence_penalty:a,seed:s,stop:u,response_format:o,top_k:l,prompt:h,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(t){var e,n,r,i,a,s,o,l,u,c,d,h,f,m,x;const y=(t.providerOptions||{}).openrouter||{},w=wr(wr({},this.getArgs(t)),y),{value:_,responseHeaders:S}=await H1({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:j1(this.config.headers(),t.headers),body:w,failedResponseHandler:$1,successfulResponseHandler:mR(BU),abortSignal:t.abortSignal,fetch:this.config.fetch});if("error"in _){const E=_.error;throw new Zo({message:E.message,url:this.config.url({path:"/completions",modelId:this.modelId}),requestBodyValues:w,statusCode:200,responseHeaders:S,data:E})}const M=_.choices[0];if(!M)throw new mne({message:"No choice in OpenRouter completion response"});return{content:[{type:"text",text:(e=M.text)!=null?e:""}],finishReason:Tw(M.finish_reason),usage:{inputTokens:(r=(n=_.usage)==null?void 0:n.prompt_tokens)!=null?r:0,outputTokens:(a=(i=_.usage)==null?void 0:i.completion_tokens)!=null?a:0,totalTokens:((o=(s=_.usage)==null?void 0:s.prompt_tokens)!=null?o:0)+((u=(l=_.usage)==null?void 0:l.completion_tokens)!=null?u:0),reasoningTokens:(h=(d=(c=_.usage)==null?void 0:c.completion_tokens_details)==null?void 0:d.reasoning_tokens)!=null?h:0,cachedInputTokens:(x=(m=(f=_.usage)==null?void 0:f.prompt_tokens_details)==null?void 0:m.cached_tokens)!=null?x:0},warnings:[],response:{headers:S}}}async doStream(t){const n=(t.providerOptions||{}).openrouter||{},r=wr(wr({},this.getArgs(t)),n),{value:i,responseHeaders:a}=await H1({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:j1(this.config.headers(),t.headers),body:Sw(wr({},r),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:$1,successfulResponseHandler:Ene(BU),abortSignal:t.abortSignal,fetch:this.config.fetch});let s="other";const o={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},l={};return{stream:i.pipeThrough(new TransformStream({transform(u,c){var d,h,f;if(!u.success){s="error",c.enqueue({type:"error",error:u.error});return}const m=u.value;if("error"in m){s="error",c.enqueue({type:"error",error:m.error});return}if(m.usage!=null){if(o.inputTokens=m.usage.prompt_tokens,o.outputTokens=m.usage.completion_tokens,o.totalTokens=m.usage.prompt_tokens+m.usage.completion_tokens,l.promptTokens=m.usage.prompt_tokens,m.usage.prompt_tokens_details){const y=(d=m.usage.prompt_tokens_details.cached_tokens)!=null?d:0;o.cachedInputTokens=y,l.promptTokensDetails={cachedTokens:y}}if(l.completionTokens=m.usage.completion_tokens,m.usage.completion_tokens_details){const y=(h=m.usage.completion_tokens_details.reasoning_tokens)!=null?h:0;o.reasoningTokens=y,l.completionTokensDetails={reasoningTokens:y}}l.cost=m.usage.cost,l.totalTokens=m.usage.total_tokens;const b=(f=m.usage.cost_details)==null?void 0:f.upstream_inference_cost;b!=null&&(l.costDetails={upstreamInferenceCost:b})}const x=m.choices[0];x?.finish_reason!=null&&(s=Tw(x.finish_reason)),x?.text!=null&&c.enqueue({type:"text-delta",delta:x.text,id:Ho()})},flush(u){u.enqueue({type:"finish",finishReason:s,usage:o,providerMetadata:{openrouter:{usage:l}}})}})),response:{headers:a}}}},VRe=B({prompt_tokens:ie(),total_tokens:ie(),cost:ie().optional()}),qRe=B({object:ae("embedding"),embedding:Ce(ie()),index:ie().optional()}),GRe=B({id:A().optional(),object:ae("list"),data:Ce(qRe),model:A(),usage:VRe.optional()}),WRe=class{constructor(t,e,n){this.specificationVersion="v2",this.provider="openrouter",this.maxEmbeddingsPerCall=void 0,this.supportsParallelCalls=!0,this.modelId=t,this.settings=e,this.config=n}async doEmbed(t){var e;const{values:n,abortSignal:r,headers:i}=t,a=wr(wr({model:this.modelId,input:n,user:this.settings.user,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody),{value:s,responseHeaders:o}=await H1({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:j1(this.config.headers(),i),body:a,failedResponseHandler:$1,successfulResponseHandler:mR(GRe),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.data.map(l=>l.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,providerMetadata:(e=s.usage)!=null&&e.cost?{openrouter:{usage:{cost:s.usage.cost}}}:void 0,response:{headers:o,body:s}}}};function YRe(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==null))}function XRe(t,...e){const n=YRe(t??{}),i=[n["user-agent"]||"",...e].filter(Boolean).join(" ");return Sw(wr({},n),{"user-agent":i})}var KRe="1.5.4";function kne(t={}){var e,n,r;const i=(n=CRe((e=t.baseURL)!=null?e:t.baseUrl))!=null?n:"https://openrouter.ai/api/v1",a=(r=t.compatibility)!=null?r:"compatible",s=()=>XRe(wr(wr({Authorization:`Bearer ${uRe({apiKey:t.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},t.headers),t.api_keys&&Object.keys(t.api_keys).length>0&&{"X-Provider-API-Keys":JSON.stringify(t.api_keys)}),`ai-sdk/openrouter/${KRe}`),o=(h,f={})=>new jRe(h,f,{provider:"openrouter.chat",url:({path:m})=>`${i}${m}`,headers:s,compatibility:a,fetch:t.fetch,extraBody:t.extraBody}),l=(h,f={})=>new $Re(h,f,{provider:"openrouter.completion",url:({path:m})=>`${i}${m}`,headers:s,compatibility:a,fetch:t.fetch,extraBody:t.extraBody}),u=(h,f={})=>new WRe(h,f,{provider:"openrouter.embedding",url:({path:m})=>`${i}${m}`,headers:s,fetch:t.fetch,extraBody:t.extraBody}),c=(h,f)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return h==="openai/gpt-3.5-turbo-instruct"?l(h,f):o(h,f)},d=(h,f)=>c(h,f);return d.languageModel=c,d.chat=o,d.completion=l,d.textEmbeddingModel=u,d.embedding=u,d}kne({compatibility:"strict"});class ZRe{enabled=!0;prefix="[AI]";minLevel="debug";setEnabled(e){this.enabled=e}setMinLevel(e){this.minLevel=e}shouldLog(e){if(!this.enabled)return!1;const n=["debug","info","warn","error"],r=n.indexOf(e),i=n.indexOf(this.minLevel);return r>=i}debug(e,...n){this.shouldLog("debug")&&console.debug(`${this.prefix}[DEBUG]`,e,...n)}info(e,...n){this.shouldLog("info")&&console.log(`${this.prefix}[INFO]`,e,...n)}warn(e,...n){this.shouldLog("warn")&&console.warn(`${this.prefix}[WARN]`,e,...n)}error(e,...n){this.shouldLog("error")&&console.error(`${this.prefix}[ERROR]`,e,...n)}group(e){return{debug:(n,...r)=>this.debug(`[${e}] ${n}`,...r),info:(n,...r)=>this.info(`[${e}] ${n}`,...r),warn:(n,...r)=>this.warn(`[${e}] ${n}`,...r),error:(n,...r)=>this.error(`[${e}] ${n}`,...r)}}}const w0=new ZRe,jp=w0.group("Provider"),tg=w0.group("Chat");w0.group("Conflict");w0.group("Assist");const NI={MAX_MESSAGE_LENGTH:1e4},UU={TEMPERATURE:.7,MAX_TOKENS:4096,CONFLICT_DETECTION_TEMPERATURE:.3,ARENA_ASSIST_TEMPERATURE:.7},Cw={NO_CONFIG:"AI 未配置，请先配置 AI 服务",NO_MODEL:"AI 模型未指定，请配置模型 ID",INVALID_INPUT:"输入内容无效或过长"},zU={anthropic:{additionalModelRequestFields:{anthropic_beta:["fine-grained-tool-streaming-2025-05-14"]}}};function JRe(t,e){const r={bedrock:{key:"awsAccessKeyId",name:"AWS Access Key ID"},openai:{key:"openaiApiKey",name:"OpenAI API Key"},anthropic:{key:"anthropicApiKey",name:"Anthropic API Key"},google:{key:"googleApiKey",name:"Google API Key"},azure:{key:"azureApiKey",name:"Azure API Key"},ollama:null,openrouter:{key:"openrouterApiKey",name:"OpenRouter API Key"},lmstudio:null}[t];if(r&&!e[r.key]){const i=`${r.name} is required for ${t} provider. Please configure it in AI settings.`;throw jp.error(i),new Error(i)}}function Ine(t){const{provider:e,model:n,credentials:r}=t;if(!n)throw jp.error(Cw.NO_MODEL),new Error(Cw.NO_MODEL);JRe(e,r),jp.info(`Initializing ${e} with model: ${n}`);let i,a;switch(e){case"bedrock":r.awsAccessKeyId&&r.awsSecretAccessKey&&jp.warn("AWS Bedrock requires proper AWS SDK configuration in browser"),i=ike(n),n.includes("anthropic.claude")&&(a=zU);break;case"openai":i=C6e(n);break;case"anthropic":i=IIe(n),a=zU;break;case"google":i=iNe(n);break;case"azure":i=x8e(n);break;case"ollama":i=Ute({baseURL:r.ollamaBaseUrl||"http://localhost:11434/api",headers:r.ollamaApiKey?{Authorization:`Bearer ${r.ollamaApiKey}`}:{}})(n);break;case"openrouter":i=kne({apiKey:r.openrouterApiKey})(n);break;case"lmstudio":i=Ete({baseURL:r.lmstudioBaseUrl||"http://localhost:1234/v1",apiKey:r.lmstudioApiKey||"lm-studio"})(n);break;default:const u=`Unknown AI provider: ${e}. Supported providers: bedrock, openai, anthropic, google, azure, ollama, openrouter, lmstudio`;throw jp.error(u),new Error(u)}return a&&jp.info("Applying provider-specific options"),{model:i,providerOptions:a}}function jU(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Nne(t,e=1e4){return t.length>0&&t.length<=e}function QRe(t){return t instanceof Error?t:typeof t=="string"?new Error(t):new Error("Unknown error occurred")}function e7e(t){const{aiConfig:e,systemPrompt:n="你是一个友好、有帮助的 AI 助手。请用简洁清晰的方式回答用户的问题。",initialMessages:r=[],onBeforeSend:i,onAfterReceive:a,onError:s}=t,[o,l]=P.useState(r),[u,c]=P.useState(""),[d,h]=P.useState(null),[f,m]=P.useState("idle"),x=P.useRef(null),b=P.useRef(e),y=P.useRef(n),w=P.useRef(i),_=P.useRef(a),S=P.useRef(s);P.useEffect(()=>{b.current=e,y.current=n,w.current=i,_.current=a,S.current=s},[e,n,i,a,s]);const M=e!=null,E=P.useCallback(async I=>{const N=(typeof I=="string"?I:u)||"";if(!N.trim())return;if(!Nne(N,NI.MAX_MESSAGE_LENGTH)){const F=new Error(Cw.INVALID_INPUT);h(F),m("error"),S.current&&S.current(F);return}const D=b.current;if(!D){const F=new Error(Cw.NO_CONFIG);h(F),m("error"),S.current&&S.current(F);return}try{m("loading"),h(null),w.current&&w.current(N);const F={id:jU(),role:"user",content:N,timestamp:new Date};l(z=>[...z,F]),c(""),tg.info("使用配置:",{provider:D.provider,model:D.model});const{model:L,providerOptions:U}=Ine(D),j=[...o,F].map(z=>({role:z.role,content:z.content}));m("streaming"),x.current=new AbortController,tg.info("开始调用 AI API...");const q=oMe({model:L,system:y.current,messages:j,...U&&{providerOptions:U},temperature:D.temperature||UU.TEMPERATURE,maxTokens:D.maxTokens||UU.MAX_TOKENS,abortSignal:x.current.signal}),Z=jU();let Q="";tg.info("接收流式响应...");for await(const z of q.textStream)Q+=z,l(W=>{const X=W[W.length-1];return X?.id===Z?[...W.slice(0,-1),{...X,content:Q}]:[...W,{id:Z,role:"assistant",content:Q,timestamp:new Date}]});tg.info("AI 响应完成"),m("success"),_.current&&_.current({id:Z,role:"assistant",content:Q,timestamp:new Date})}catch(F){tg.error("错误:",F);const L=QRe(F);h(L),m("error"),S.current&&S.current(L)}},[u,o]),C=P.useCallback(()=>{l([]),c(""),h(null),m("idle")},[]),R=P.useCallback(()=>{x.current&&(x.current.abort(),x.current=null),m("idle")},[]),k=P.useCallback(async()=>{if(o.length<2)return;const I=o.findLastIndex(D=>D.role==="user");if(I===-1)return;const N=o[I];l(o.slice(0,I)),await E(N.content)},[o,E]);return{messages:o,input:u,setInput:c,status:f,error:d,sendMessage:E,clearChat:C,stop:R,regenerate:k,isConfigured:M}}const t7e=`你是一个友好、有帮助的 AI 助手，专注于帮助用户进行思维整理和知识管理。

**你的特点：**
- 思维清晰，善于结构化思考
- 回答简洁明了，避免冗长
- 善于提出启发性问题
- 尊重用户的思考过程

**用户正在使用的工具：**
- 记忆球：一个3D可视化的个人知识管理系统
- 演武场：用于复杂思维推演和论证的工具

**回答原则：**
1. 简洁为先，一般控制在200字以内
2. 必要时使用 Markdown 格式化
3. 涉及复杂概念时，善用列表和结构化表达
4. 可以主动提出问题引导用户深入思考`;function bR(t,e){let n=t;for(const[r,i]of Object.entries(e)){const a=`{{${r}}}`;n=n.replace(new RegExp(a,"g"),i)}return n}function _R(t){try{return JSON.parse(t)}catch{const e=t.match(/```json\s*\n([\s\S]*?)\n```/);if(e)try{return JSON.parse(e[1])}catch{return null}const n=t.indexOf("{"),r=t.lastIndexOf("}");if(n!==-1&&r!==-1&&r>n)try{return JSON.parse(t.substring(n,r+1))}catch{return null}return null}}function HU(t){const e=[],n=String(t||"");let r=n.indexOf(","),i=0,a=!1;for(;!a;){r===-1&&(r=n.length,a=!0);const s=n.slice(i,r).trim();(s||!a)&&e.push(s),i=r+1,r=n.indexOf(",",i)}return e}function Rne(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const n7e=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,r7e=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,i7e={};function $U(t,e){return(i7e.jsx?r7e:n7e).test(t)}const a7e=/[ \t\n\f\r]/g;function s7e(t){return typeof t=="object"?t.type==="text"?VU(t.value):!1:VU(t)}function VU(t){return t.replace(a7e,"")===""}class Iv{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}Iv.prototype.normal={};Iv.prototype.property={};Iv.prototype.space=void 0;function Pne(t,e){const n={},r={};for(const i of t)Object.assign(n,i.property),Object.assign(r,i.normal);return new Iv(n,r,e)}function V1(t){return t.toLowerCase()}let Cs=class{constructor(e,n){this.attribute=n,this.property=e}};Cs.prototype.attribute="";Cs.prototype.booleanish=!1;Cs.prototype.boolean=!1;Cs.prototype.commaOrSpaceSeparated=!1;Cs.prototype.commaSeparated=!1;Cs.prototype.defined=!1;Cs.prototype.mustUseProperty=!1;Cs.prototype.number=!1;Cs.prototype.overloadedBoolean=!1;Cs.prototype.property="";Cs.prototype.spaceSeparated=!1;Cs.prototype.space=void 0;let o7e=0;const Rn=bf(),Ui=bf(),RI=bf(),kt=bf(),zr=bf(),t0=bf(),js=bf();function bf(){return 2**++o7e}const PI=Object.freeze(Object.defineProperty({__proto__:null,boolean:Rn,booleanish:Ui,commaOrSpaceSeparated:js,commaSeparated:t0,number:kt,overloadedBoolean:RI,spaceSeparated:zr},Symbol.toStringTag,{value:"Module"})),lT=Object.keys(PI);class wR extends Cs{constructor(e,n,r,i){let a=-1;if(super(e,n),qU(this,"space",i),typeof r=="number")for(;++a<lT.length;){const s=lT[a];qU(this,lT[a],(r&PI[s])===PI[s])}}}wR.prototype.defined=!0;function qU(t,e,n){n&&(t[e]=n)}function q0(t){const e={},n={};for(const[r,i]of Object.entries(t.properties)){const a=new wR(r,t.transform(t.attributes||{},r),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),e[r]=a,n[V1(r)]=r,n[V1(a.attribute)]=r}return new Iv(e,n,t.space)}const Dne=q0({properties:{ariaActiveDescendant:null,ariaAtomic:Ui,ariaAutoComplete:null,ariaBusy:Ui,ariaChecked:Ui,ariaColCount:kt,ariaColIndex:kt,ariaColSpan:kt,ariaControls:zr,ariaCurrent:null,ariaDescribedBy:zr,ariaDetails:null,ariaDisabled:Ui,ariaDropEffect:zr,ariaErrorMessage:null,ariaExpanded:Ui,ariaFlowTo:zr,ariaGrabbed:Ui,ariaHasPopup:null,ariaHidden:Ui,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:zr,ariaLevel:kt,ariaLive:null,ariaModal:Ui,ariaMultiLine:Ui,ariaMultiSelectable:Ui,ariaOrientation:null,ariaOwns:zr,ariaPlaceholder:null,ariaPosInSet:kt,ariaPressed:Ui,ariaReadOnly:Ui,ariaRelevant:null,ariaRequired:Ui,ariaRoleDescription:zr,ariaRowCount:kt,ariaRowIndex:kt,ariaRowSpan:kt,ariaSelected:Ui,ariaSetSize:kt,ariaSort:null,ariaValueMax:kt,ariaValueMin:kt,ariaValueNow:kt,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function One(t,e){return e in t?t[e]:e}function Lne(t,e){return One(t,e.toLowerCase())}const l7e=q0({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:t0,acceptCharset:zr,accessKey:zr,action:null,allow:null,allowFullScreen:Rn,allowPaymentRequest:Rn,allowUserMedia:Rn,alt:null,as:null,async:Rn,autoCapitalize:null,autoComplete:zr,autoFocus:Rn,autoPlay:Rn,blocking:zr,capture:null,charSet:null,checked:Rn,cite:null,className:zr,cols:kt,colSpan:null,content:null,contentEditable:Ui,controls:Rn,controlsList:zr,coords:kt|t0,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Rn,defer:Rn,dir:null,dirName:null,disabled:Rn,download:RI,draggable:Ui,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Rn,formTarget:null,headers:zr,height:kt,hidden:RI,high:kt,href:null,hrefLang:null,htmlFor:zr,httpEquiv:zr,id:null,imageSizes:null,imageSrcSet:null,inert:Rn,inputMode:null,integrity:null,is:null,isMap:Rn,itemId:null,itemProp:zr,itemRef:zr,itemScope:Rn,itemType:zr,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Rn,low:kt,manifest:null,max:null,maxLength:kt,media:null,method:null,min:null,minLength:kt,multiple:Rn,muted:Rn,name:null,nonce:null,noModule:Rn,noValidate:Rn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Rn,optimum:kt,pattern:null,ping:zr,placeholder:null,playsInline:Rn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Rn,referrerPolicy:null,rel:zr,required:Rn,reversed:Rn,rows:kt,rowSpan:kt,sandbox:zr,scope:null,scoped:Rn,seamless:Rn,selected:Rn,shadowRootClonable:Rn,shadowRootDelegatesFocus:Rn,shadowRootMode:null,shape:null,size:kt,sizes:null,slot:null,span:kt,spellCheck:Ui,src:null,srcDoc:null,srcLang:null,srcSet:null,start:kt,step:null,style:null,tabIndex:kt,target:null,title:null,translate:null,type:null,typeMustMatch:Rn,useMap:null,value:Ui,width:kt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:zr,axis:null,background:null,bgColor:null,border:kt,borderColor:null,bottomMargin:kt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Rn,declare:Rn,event:null,face:null,frame:null,frameBorder:null,hSpace:kt,leftMargin:kt,link:null,longDesc:null,lowSrc:null,marginHeight:kt,marginWidth:kt,noResize:Rn,noHref:Rn,noShade:Rn,noWrap:Rn,object:null,profile:null,prompt:null,rev:null,rightMargin:kt,rules:null,scheme:null,scrolling:Ui,standby:null,summary:null,text:null,topMargin:kt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:kt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Rn,disableRemotePlayback:Rn,prefix:null,property:null,results:kt,security:null,unselectable:null},space:"html",transform:Lne}),u7e=q0({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:js,accentHeight:kt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:kt,amplitude:kt,arabicForm:null,ascent:kt,attributeName:null,attributeType:null,azimuth:kt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:kt,by:null,calcMode:null,capHeight:kt,className:zr,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:kt,diffuseConstant:kt,direction:null,display:null,dur:null,divisor:kt,dominantBaseline:null,download:Rn,dx:null,dy:null,edgeMode:null,editable:null,elevation:kt,enableBackground:null,end:null,event:null,exponent:kt,externalResourcesRequired:null,fill:null,fillOpacity:kt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:t0,g2:t0,glyphName:t0,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:kt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:kt,horizOriginX:kt,horizOriginY:kt,id:null,ideographic:kt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:kt,k:kt,k1:kt,k2:kt,k3:kt,k4:kt,kernelMatrix:js,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:kt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:kt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:kt,overlineThickness:kt,paintOrder:null,panose1:null,path:null,pathLength:kt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:zr,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:kt,pointsAtY:kt,pointsAtZ:kt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:js,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:js,rev:js,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:js,requiredFeatures:js,requiredFonts:js,requiredFormats:js,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:kt,specularExponent:kt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:kt,strikethroughThickness:kt,string:null,stroke:null,strokeDashArray:js,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:kt,strokeOpacity:kt,strokeWidth:null,style:null,surfaceScale:kt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:js,tabIndex:kt,tableValues:null,target:null,targetX:kt,targetY:kt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:js,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:kt,underlineThickness:kt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:kt,values:null,vAlphabetic:kt,vMathematical:kt,vectorEffect:null,vHanging:kt,vIdeographic:kt,version:null,vertAdvY:kt,vertOriginX:kt,vertOriginY:kt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:kt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:One}),Fne=q0({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),Bne=q0({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Lne}),Une=q0({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),c7e={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},d7e=/[A-Z]/g,GU=/-[a-z]/g,h7e=/^data[-\w.:]+$/i;function d3(t,e){const n=V1(e);let r=e,i=Cs;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&h7e.test(e)){if(e.charAt(4)==="-"){const a=e.slice(5).replace(GU,p7e);r="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=e.slice(4);if(!GU.test(a)){let s=a.replace(d7e,f7e);s.charAt(0)!=="-"&&(s="-"+s),e="data"+s}}i=wR}return new i(r,e)}function f7e(t){return"-"+t.toLowerCase()}function p7e(t){return t.charAt(1).toUpperCase()}const Nv=Pne([Dne,l7e,Fne,Bne,Une],"html"),bd=Pne([Dne,u7e,Fne,Bne,Une],"svg");function WU(t){const e=String(t||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function zne(t){return t.join(" ").trim()}var Op={},uT,YU;function m7e(){if(YU)return uT;YU=1;var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,n=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,i=/^:\s*/,a=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,o=/^\s+|\s+$/g,l=`
`,u="/",c="*",d="",h="comment",f="declaration";function m(b,y){if(typeof b!="string")throw new TypeError("First argument must be a string");if(!b)return[];y=y||{};var w=1,_=1;function S(L){var U=L.match(e);U&&(w+=U.length);var j=L.lastIndexOf(l);_=~j?L.length-j:_+L.length}function M(){var L={line:w,column:_};return function(U){return U.position=new E(L),k(),U}}function E(L){this.start=L,this.end={line:w,column:_},this.source=y.source}E.prototype.content=b;function C(L){var U=new Error(y.source+":"+w+":"+_+": "+L);if(U.reason=L,U.filename=y.source,U.line=w,U.column=_,U.source=b,!y.silent)throw U}function R(L){var U=L.exec(b);if(U){var j=U[0];return S(j),b=b.slice(j.length),U}}function k(){R(n)}function I(L){var U;for(L=L||[];U=N();)U!==!1&&L.push(U);return L}function N(){var L=M();if(!(u!=b.charAt(0)||c!=b.charAt(1))){for(var U=2;d!=b.charAt(U)&&(c!=b.charAt(U)||u!=b.charAt(U+1));)++U;if(U+=2,d===b.charAt(U-1))return C("End of comment missing");var j=b.slice(2,U-2);return _+=2,S(j),b=b.slice(U),_+=2,L({type:h,comment:j})}}function D(){var L=M(),U=R(r);if(U){if(N(),!R(i))return C("property missing ':'");var j=R(a),q=L({type:f,property:x(U[0].replace(t,d)),value:j?x(j[0].replace(t,d)):d});return R(s),q}}function F(){var L=[];I(L);for(var U;U=D();)U!==!1&&(L.push(U),I(L));return L}return k(),F()}function x(b){return b?b.replace(o,d):d}return uT=m,uT}var XU;function g7e(){if(XU)return Op;XU=1;var t=Op&&Op.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Op,"__esModule",{value:!0}),Op.default=n;const e=t(m7e());function n(r,i){let a=null;if(!r||typeof r!="string")return a;const s=(0,e.default)(r),o=typeof i=="function";return s.forEach(l=>{if(l.type!=="declaration")return;const{property:u,value:c}=l;o?i(u,c,l):c&&(a=a||{},a[u]=c)}),a}return Op}var ng={},KU;function v7e(){if(KU)return ng;KU=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,n=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,i=/^-(ms)-/,a=function(u){return!u||n.test(u)||t.test(u)},s=function(u,c){return c.toUpperCase()},o=function(u,c){return"".concat(c,"-")},l=function(u,c){return c===void 0&&(c={}),a(u)?u:(u=u.toLowerCase(),c.reactCompat?u=u.replace(i,o):u=u.replace(r,o),u.replace(e,s))};return ng.camelCase=l,ng}var rg,ZU;function y7e(){if(ZU)return rg;ZU=1;var t=rg&&rg.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},e=t(g7e()),n=v7e();function r(i,a){var s={};return!i||typeof i!="string"||(0,e.default)(i,function(o,l){o&&l&&(s[(0,n.camelCase)(o,a)]=l)}),s}return r.default=r,rg=r,rg}var x7e=y7e();const b7e=pv(x7e),h3=jne("end"),Xl=jne("start");function jne(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function _7e(t){const e=Xl(t),n=h3(t);if(e&&n)return{start:e,end:n}}function Gg(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?JU(t.position):"start"in t||"end"in t?JU(t):"line"in t||"column"in t?DI(t):""}function DI(t){return QU(t&&t.line)+":"+QU(t&&t.column)}function JU(t){return DI(t&&t.start)+"-"+DI(t&&t.end)}function QU(t){return t&&typeof t=="number"?t:1}class za extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let i="",a={},s=!1;if(n&&("line"in n&&"column"in n?a={place:n}:"start"in n&&"end"in n?a={place:n}:"type"in n?a={ancestors:[n],place:n.position}:a={...n}),typeof e=="string"?i=e:!a.cause&&e&&(s=!0,i=e.message,a.cause=e),!a.ruleId&&!a.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?a.ruleId=r:(a.source=r.slice(0,l),a.ruleId=r.slice(l+1))}if(!a.place&&a.ancestors&&a.ancestors){const l=a.ancestors[a.ancestors.length-1];l&&(a.place=l.position)}const o=a.place&&"start"in a.place?a.place.start:a.place;this.ancestors=a.ancestors||void 0,this.cause=a.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=i,this.line=o?o.line:void 0,this.name=Gg(a.place)||"1:1",this.place=a.place||void 0,this.reason=this.message,this.ruleId=a.ruleId||void 0,this.source=a.source||void 0,this.stack=s&&a.cause&&typeof a.cause.stack=="string"?a.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}za.prototype.file="";za.prototype.name="";za.prototype.reason="";za.prototype.message="";za.prototype.stack="";za.prototype.column=void 0;za.prototype.line=void 0;za.prototype.ancestors=void 0;za.prototype.cause=void 0;za.prototype.fatal=void 0;za.prototype.place=void 0;za.prototype.ruleId=void 0;za.prototype.source=void 0;const SR={}.hasOwnProperty,w7e=new Map,S7e=/[A-Z]/g,E7e=new Set(["table","tbody","thead","tfoot","tr"]),T7e=new Set(["td","th"]),Hne="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function C7e(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=D7e(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=P7e(n,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?bd:Nv,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},a=$ne(i,t,void 0);return a&&typeof a!="string"?a:i.create(t,i.Fragment,{children:a||void 0},void 0)}function $ne(t,e,n){if(e.type==="element")return M7e(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return A7e(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return I7e(t,e,n);if(e.type==="mdxjsEsm")return k7e(t,e);if(e.type==="root")return N7e(t,e,n);if(e.type==="text")return R7e(t,e)}function M7e(t,e,n){const r=t.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=bd,t.schema=i),t.ancestors.push(e);const a=qne(t,e.tagName,!1),s=O7e(t,e);let o=TR(t,e);return E7e.has(e.tagName)&&(o=o.filter(function(l){return typeof l=="string"?!s7e(l):!0})),Vne(t,s,a,e),ER(s,o),t.ancestors.pop(),t.schema=r,t.create(e,a,s,n)}function A7e(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}q1(t,e.position)}function k7e(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);q1(t,e.position)}function I7e(t,e,n){const r=t.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=bd,t.schema=i),t.ancestors.push(e);const a=e.name===null?t.Fragment:qne(t,e.name,!0),s=L7e(t,e),o=TR(t,e);return Vne(t,s,a,e),ER(s,o),t.ancestors.pop(),t.schema=r,t.create(e,a,s,n)}function N7e(t,e,n){const r={};return ER(r,TR(t,e)),t.create(e,t.Fragment,r,n)}function R7e(t,e){return e.value}function Vne(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function ER(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function P7e(t,e,n){return r;function r(i,a,s,o){const u=Array.isArray(s.children)?n:e;return o?u(a,s,o):u(a,s)}}function D7e(t,e){return n;function n(r,i,a,s){const o=Array.isArray(a.children),l=Xl(r);return e(i,a,s,o,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function O7e(t,e){const n={};let r,i;for(i in e.properties)if(i!=="children"&&SR.call(e.properties,i)){const a=F7e(t,i,e.properties[i]);if(a){const[s,o]=a;t.tableCellAlignToStyle&&s==="align"&&typeof o=="string"&&T7e.has(e.tagName)?r=o:n[s]=o}}if(r){const a=n.style||(n.style={});a[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function L7e(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const a=r.data.estree.body[0];a.type;const s=a.expression;s.type;const o=s.properties[0];o.type,Object.assign(n,t.evaluater.evaluateExpression(o.argument))}else q1(t,e.position);else{const i=r.name;let a;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const o=r.value.data.estree.body[0];o.type,a=t.evaluater.evaluateExpression(o.expression)}else q1(t,e.position);else a=r.value===null?!0:r.value;n[i]=a}return n}function TR(t,e){const n=[];let r=-1;const i=t.passKeys?new Map:w7e;for(;++r<e.children.length;){const a=e.children[r];let s;if(t.passKeys){const l=a.type==="element"?a.tagName:a.type==="mdxJsxFlowElement"||a.type==="mdxJsxTextElement"?a.name:void 0;if(l){const u=i.get(l)||0;s=l+"-"+u,i.set(l,u+1)}}const o=$ne(t,a,s);o!==void 0&&n.push(o)}return n}function F7e(t,e,n){const r=d3(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?Rne(n):zne(n)),r.property==="style"){let i=typeof n=="object"?n:B7e(t,String(n));return t.stylePropertyNameCase==="css"&&(i=U7e(i)),["style",i]}return[t.elementAttributeNameCase==="react"&&r.space?c7e[r.property]||r.property:r.attribute,n]}}function B7e(t,e){try{return b7e(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,i=new za("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=t.filePath||void 0,i.url=Hne+"#cannot-parse-style-attribute",i}}function qne(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let a=-1,s;for(;++a<i.length;){const o=$U(i[a])?{type:"Identifier",name:i[a]}:{type:"Literal",value:i[a]};s=s?{type:"MemberExpression",object:s,property:o,computed:!!(a&&o.type==="Literal"),optional:!1}:o}r=s}else r=$U(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return SR.call(t.components,i)?t.components[i]:i}if(t.evaluater)return t.evaluater.evaluateExpression(r);q1(t)}function q1(t,e){const n=new za("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=Hne+"#cannot-handle-mdx-estrees-without-createevaluater",n}function U7e(t){const e={};let n;for(n in t)SR.call(t,n)&&(e[z7e(n)]=t[n]);return e}function z7e(t){let e=t.replace(S7e,j7e);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function j7e(t){return"-"+t.toLowerCase()}const cT={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},H7e={};function CR(t,e){const n=H7e,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,i=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Gne(t,r,i)}function Gne(t,e,n){if($7e(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return ez(t.children,e,n)}return Array.isArray(t)?ez(t,e,n):""}function ez(t,e,n){const r=[];let i=-1;for(;++i<t.length;)r[i]=Gne(t[i],e,n);return r.join("")}function $7e(t){return!!(t&&typeof t=="object")}const tz=document.createElement("i");function MR(t){const e="&"+t+";";tz.innerHTML=e;const n=tz.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Xs(t,e,n,r){const i=t.length;let a=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,n=n>0?n:0,r.length<1e4)s=Array.from(r),s.unshift(e,n),t.splice(...s);else for(n&&t.splice(e,n);a<r.length;)s=r.slice(a,a+1e4),s.unshift(e,0),t.splice(...s),a+=1e4,e+=1e4}function co(t,e){return t.length>0?(Xs(t,t.length,0,e),t):e}const nz={}.hasOwnProperty;function Wne(t){const e={};let n=-1;for(;++n<t.length;)V7e(e,t[n]);return e}function V7e(t,e){let n;for(n in e){const i=(nz.call(t,n)?t[n]:void 0)||(t[n]={}),a=e[n];let s;if(a)for(s in a){nz.call(i,s)||(i[s]=[]);const o=a[s];q7e(i[s],Array.isArray(o)?o:o?[o]:[])}}}function q7e(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);Xs(t,0,0,r)}function Yne(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"�":String.fromCodePoint(n)}function nl(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Ja=_d(/[A-Za-z]/),Oa=_d(/[\dA-Za-z]/),G7e=_d(/[#-'*+\--9=?A-Z^-~]/);function Mw(t){return t!==null&&(t<32||t===127)}const OI=_d(/\d/),W7e=_d(/[\dA-Fa-f]/),Y7e=_d(/[!-/:-@[-`{-~]/);function en(t){return t!==null&&t<-2}function Dr(t){return t!==null&&(t<0||t===32)}function Vn(t){return t===-2||t===-1||t===32}const f3=_d(/\p{P}|\p{S}/u),af=_d(/\s/);function _d(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function G0(t){const e=[];let n=-1,r=0,i=0;for(;++n<t.length;){const a=t.charCodeAt(n);let s="";if(a===37&&Oa(t.charCodeAt(n+1))&&Oa(t.charCodeAt(n+2)))i=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(s=String.fromCharCode(a));else if(a>55295&&a<57344){const o=t.charCodeAt(n+1);a<56320&&o>56319&&o<57344?(s=String.fromCharCode(a,o),i=1):s="�"}else s=String.fromCharCode(a);s&&(e.push(t.slice(r,n),encodeURIComponent(s)),r=n+i+1,s=""),i&&(n+=i,i=0)}return e.join("")+t.slice(r)}function Un(t,e,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let a=0;return s;function s(l){return Vn(l)?(t.enter(n),o(l)):e(l)}function o(l){return Vn(l)&&a++<i?(t.consume(l),o):(t.exit(n),e(l))}}const X7e={tokenize:K7e};function K7e(t){const e=t.attempt(this.parser.constructs.contentInitial,r,i);let n;return e;function r(o){if(o===null){t.consume(o);return}return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Un(t,e,"linePrefix")}function i(o){return t.enter("paragraph"),a(o)}function a(o){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,s(o)}function s(o){if(o===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(o);return}return en(o)?(t.consume(o),t.exit("chunkText"),a):(t.consume(o),s)}}const Z7e={tokenize:J7e},rz={tokenize:Q7e};function J7e(t){const e=this,n=[];let r=0,i,a,s;return o;function o(_){if(r<n.length){const S=n[r];return e.containerState=S[1],t.attempt(S[0].continuation,l,u)(_)}return u(_)}function l(_){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&w();const S=e.events.length;let M=S,E;for(;M--;)if(e.events[M][0]==="exit"&&e.events[M][1].type==="chunkFlow"){E=e.events[M][1].end;break}y(r);let C=S;for(;C<e.events.length;)e.events[C][1].end={...E},C++;return Xs(e.events,M+1,0,e.events.slice(S)),e.events.length=C,u(_)}return o(_)}function u(_){if(r===n.length){if(!i)return h(_);if(i.currentConstruct&&i.currentConstruct.concrete)return m(_);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(rz,c,d)(_)}function c(_){return i&&w(),y(r),h(_)}function d(_){return e.parser.lazy[e.now().line]=r!==n.length,s=e.now().offset,m(_)}function h(_){return e.containerState={},t.attempt(rz,f,m)(_)}function f(_){return r++,n.push([e.currentConstruct,e.containerState]),h(_)}function m(_){if(_===null){i&&w(),y(0),t.consume(_);return}return i=i||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:a}),x(_)}function x(_){if(_===null){b(t.exit("chunkFlow"),!0),y(0),t.consume(_);return}return en(_)?(t.consume(_),b(t.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(t.consume(_),x)}function b(_,S){const M=e.sliceStream(_);if(S&&M.push(null),_.previous=a,a&&(a.next=_),a=_,i.defineSkip(_.start),i.write(M),e.parser.lazy[_.start.line]){let E=i.events.length;for(;E--;)if(i.events[E][1].start.offset<s&&(!i.events[E][1].end||i.events[E][1].end.offset>s))return;const C=e.events.length;let R=C,k,I;for(;R--;)if(e.events[R][0]==="exit"&&e.events[R][1].type==="chunkFlow"){if(k){I=e.events[R][1].end;break}k=!0}for(y(r),E=C;E<e.events.length;)e.events[E][1].end={...I},E++;Xs(e.events,R+1,0,e.events.slice(C)),e.events.length=E}}function y(_){let S=n.length;for(;S-- >_;){const M=n[S];e.containerState=M[1],M[0].exit.call(e,t)}n.length=_}function w(){i.write([null]),a=void 0,i=void 0,e.containerState._closeFlow=void 0}}function Q7e(t,e,n){return Un(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function S0(t){if(t===null||Dr(t)||af(t))return 1;if(f3(t))return 2}function p3(t,e,n){const r=[];let i=-1;for(;++i<t.length;){const a=t[i].resolveAll;a&&!r.includes(a)&&(e=a(e,n),r.push(a))}return e}const LI={name:"attention",resolveAll:ePe,tokenize:tPe};function ePe(t,e){let n=-1,r,i,a,s,o,l,u,c;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[r][1].end},h={...t[n][1].start};iz(d,-l),iz(h,l),s={type:l>1?"strongSequence":"emphasisSequence",start:d,end:{...t[r][1].end}},o={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},a={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},i={type:l>1?"strong":"emphasis",start:{...s.start},end:{...o.end}},t[r][1].end={...s.start},t[n][1].start={...o.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=co(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=co(u,[["enter",i,e],["enter",s,e],["exit",s,e],["enter",a,e]]),u=co(u,p3(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=co(u,[["exit",a,e],["enter",o,e],["exit",o,e],["exit",i,e]]),t[n][1].end.offset-t[n][1].start.offset?(c=2,u=co(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):c=0,Xs(t,r-1,n-r+3,u),n=r+u.length-c-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function tPe(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=S0(r);let a;return s;function s(l){return a=l,t.enter("attentionSequence"),o(l)}function o(l){if(l===a)return t.consume(l),o;const u=t.exit("attentionSequence"),c=S0(l),d=!c||c===2&&i||n.includes(l),h=!i||i===2&&c||n.includes(r);return u._open=!!(a===42?d:d&&(i||!h)),u._close=!!(a===42?h:h&&(c||!d)),e(l)}}function iz(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const nPe={name:"autolink",tokenize:rPe};function rPe(t,e,n){let r=0;return i;function i(f){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),a}function a(f){return Ja(f)?(t.consume(f),s):f===64?n(f):u(f)}function s(f){return f===43||f===45||f===46||Oa(f)?(r=1,o(f)):u(f)}function o(f){return f===58?(t.consume(f),r=0,l):(f===43||f===45||f===46||Oa(f))&&r++<32?(t.consume(f),o):(r=0,u(f))}function l(f){return f===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):f===null||f===32||f===60||Mw(f)?n(f):(t.consume(f),l)}function u(f){return f===64?(t.consume(f),c):G7e(f)?(t.consume(f),u):n(f)}function c(f){return Oa(f)?d(f):n(f)}function d(f){return f===46?(t.consume(f),r=0,c):f===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):h(f)}function h(f){if((f===45||Oa(f))&&r++<63){const m=f===45?h:d;return t.consume(f),m}return n(f)}}const Rv={partial:!0,tokenize:iPe};function iPe(t,e,n){return r;function r(a){return Vn(a)?Un(t,i,"linePrefix")(a):i(a)}function i(a){return a===null||en(a)?e(a):n(a)}}const Xne={continuation:{tokenize:sPe},exit:oPe,name:"blockQuote",tokenize:aPe};function aPe(t,e,n){const r=this;return i;function i(s){if(s===62){const o=r.containerState;return o.open||(t.enter("blockQuote",{_container:!0}),o.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(s),t.exit("blockQuoteMarker"),a}return n(s)}function a(s){return Vn(s)?(t.enter("blockQuotePrefixWhitespace"),t.consume(s),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(s))}}function sPe(t,e,n){const r=this;return i;function i(s){return Vn(s)?Un(t,a,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):a(s)}function a(s){return t.attempt(Xne,e,n)(s)}}function oPe(t){t.exit("blockQuote")}const Kne={name:"characterEscape",tokenize:lPe};function lPe(t,e,n){return r;function r(a){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(a),t.exit("escapeMarker"),i}function i(a){return Y7e(a)?(t.enter("characterEscapeValue"),t.consume(a),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(a)}}const Zne={name:"characterReference",tokenize:uPe};function uPe(t,e,n){const r=this;let i=0,a,s;return o;function o(d){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),l}function l(d){return d===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(d),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),a=31,s=Oa,c(d))}function u(d){return d===88||d===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(d),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),a=6,s=W7e,c):(t.enter("characterReferenceValue"),a=7,s=OI,c(d))}function c(d){if(d===59&&i){const h=t.exit("characterReferenceValue");return s===Oa&&!MR(r.sliceSerialize(h))?n(d):(t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return s(d)&&i++<a?(t.consume(d),c):n(d)}}const az={partial:!0,tokenize:dPe},sz={concrete:!0,name:"codeFenced",tokenize:cPe};function cPe(t,e,n){const r=this,i={partial:!0,tokenize:M};let a=0,s=0,o;return l;function l(E){return u(E)}function u(E){const C=r.events[r.events.length-1];return a=C&&C[1].type==="linePrefix"?C[2].sliceSerialize(C[1],!0).length:0,o=E,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),c(E)}function c(E){return E===o?(s++,t.consume(E),c):s<3?n(E):(t.exit("codeFencedFenceSequence"),Vn(E)?Un(t,d,"whitespace")(E):d(E))}function d(E){return E===null||en(E)?(t.exit("codeFencedFence"),r.interrupt?e(E):t.check(az,x,S)(E)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(E))}function h(E){return E===null||en(E)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),d(E)):Vn(E)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Un(t,f,"whitespace")(E)):E===96&&E===o?n(E):(t.consume(E),h)}function f(E){return E===null||en(E)?d(E):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(E))}function m(E){return E===null||en(E)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),d(E)):E===96&&E===o?n(E):(t.consume(E),m)}function x(E){return t.attempt(i,S,b)(E)}function b(E){return t.enter("lineEnding"),t.consume(E),t.exit("lineEnding"),y}function y(E){return a>0&&Vn(E)?Un(t,w,"linePrefix",a+1)(E):w(E)}function w(E){return E===null||en(E)?t.check(az,x,S)(E):(t.enter("codeFlowValue"),_(E))}function _(E){return E===null||en(E)?(t.exit("codeFlowValue"),w(E)):(t.consume(E),_)}function S(E){return t.exit("codeFenced"),e(E)}function M(E,C,R){let k=0;return I;function I(U){return E.enter("lineEnding"),E.consume(U),E.exit("lineEnding"),N}function N(U){return E.enter("codeFencedFence"),Vn(U)?Un(E,D,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(U):D(U)}function D(U){return U===o?(E.enter("codeFencedFenceSequence"),F(U)):R(U)}function F(U){return U===o?(k++,E.consume(U),F):k>=s?(E.exit("codeFencedFenceSequence"),Vn(U)?Un(E,L,"whitespace")(U):L(U)):R(U)}function L(U){return U===null||en(U)?(E.exit("codeFencedFence"),C(U)):R(U)}}}function dPe(t,e,n){const r=this;return i;function i(s){return s===null?n(s):(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),a)}function a(s){return r.parser.lazy[r.now().line]?n(s):e(s)}}const dT={name:"codeIndented",tokenize:fPe},hPe={partial:!0,tokenize:pPe};function fPe(t,e,n){const r=this;return i;function i(u){return t.enter("codeIndented"),Un(t,a,"linePrefix",5)(u)}function a(u){const c=r.events[r.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?s(u):n(u)}function s(u){return u===null?l(u):en(u)?t.attempt(hPe,s,l)(u):(t.enter("codeFlowValue"),o(u))}function o(u){return u===null||en(u)?(t.exit("codeFlowValue"),s(u)):(t.consume(u),o)}function l(u){return t.exit("codeIndented"),e(u)}}function pPe(t,e,n){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?n(s):en(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),i):Un(t,a,"linePrefix",5)(s)}function a(s){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):en(s)?i(s):n(s)}}const mPe={name:"codeText",previous:vPe,resolve:gPe,tokenize:yPe};function gPe(t){let e=t.length-4,n=3,r,i;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(i=r):(r===e||t[r][1].type==="lineEnding")&&(t[i][1].type="codeTextData",r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function vPe(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function yPe(t,e,n){let r=0,i,a;return s;function s(d){return t.enter("codeText"),t.enter("codeTextSequence"),o(d)}function o(d){return d===96?(t.consume(d),r++,o):(t.exit("codeTextSequence"),l(d))}function l(d){return d===null?n(d):d===32?(t.enter("space"),t.consume(d),t.exit("space"),l):d===96?(a=t.enter("codeTextSequence"),i=0,c(d)):en(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),l):(t.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||en(d)?(t.exit("codeTextData"),l(d)):(t.consume(d),u)}function c(d){return d===96?(t.consume(d),i++,c):i===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(d)):(a.type="codeTextData",u(d))}}class xPe{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const i=n||0;this.setCursor(Math.trunc(e));const a=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&ig(this.left,r),a.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),ig(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),ig(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);ig(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);ig(this.left,n.reverse())}}}function ig(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function Jne(t){const e={};let n=-1,r,i,a,s,o,l,u;const c=new xPe(t);for(;++n<c.length;){for(;n in e;)n=e[n];if(r=c.get(n),n&&r[1].type==="chunkFlow"&&c.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,a=0,a<l.length&&l[a][1].type==="lineEndingBlank"&&(a+=2),a<l.length&&l[a][1].type==="content"))for(;++a<l.length&&l[a][1].type!=="content";)l[a][1].type==="chunkText"&&(l[a][1]._isInFirstContentOfListItem=!0,a++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,bPe(c,n)),n=e[n],u=!0);else if(r[1]._container){for(a=n,i=void 0;a--;)if(s=c.get(a),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank")s[0]==="enter"&&(i&&(c.get(i)[1].type="lineEndingBlank"),s[1].type="lineEnding",i=a);else if(!(s[1].type==="linePrefix"||s[1].type==="listItemIndent"))break;i&&(r[1].end={...c.get(i)[1].start},o=c.slice(i,n),o.unshift(r),c.splice(i,n-i+1,o))}}return Xs(t,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function bPe(t,e){const n=t.get(e)[1],r=t.get(e)[2];let i=e-1;const a=[];let s=n._tokenizer;s||(s=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(s._contentTypeTextTrailing=!0));const o=s.events,l=[],u={};let c,d,h=-1,f=n,m=0,x=0;const b=[x];for(;f;){for(;t.get(++i)[1]!==f;);a.push(i),f._tokenizer||(c=r.sliceStream(f),f.next||c.push(null),d&&s.defineSkip(f.start),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(c),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),d=f,f=f.next}for(f=n;++h<o.length;)o[h][0]==="exit"&&o[h-1][0]==="enter"&&o[h][1].type===o[h-1][1].type&&o[h][1].start.line!==o[h][1].end.line&&(x=h+1,b.push(x),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(s.events=[],f?(f._tokenizer=void 0,f.previous=void 0):b.pop(),h=b.length;h--;){const y=o.slice(b[h],b[h+1]),w=a.pop();l.push([w,w+y.length-1]),t.splice(w,2,y)}for(l.reverse(),h=-1;++h<l.length;)u[m+l[h][0]]=m+l[h][1],m+=l[h][1]-l[h][0]-1;return u}const _Pe={resolve:SPe,tokenize:EPe},wPe={partial:!0,tokenize:TPe};function SPe(t){return Jne(t),t}function EPe(t,e){let n;return r;function r(o){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),i(o)}function i(o){return o===null?a(o):en(o)?t.check(wPe,s,a)(o):(t.consume(o),i)}function a(o){return t.exit("chunkContent"),t.exit("content"),e(o)}function s(o){return t.consume(o),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}}function TPe(t,e,n){const r=this;return i;function i(s){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),Un(t,a,"linePrefix")}function a(s){if(s===null||en(s))return n(s);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):t.interrupt(r.parser.constructs.flow,n,e)(s)}}function Qne(t,e,n,r,i,a,s,o,l){const u=l||Number.POSITIVE_INFINITY;let c=0;return d;function d(y){return y===60?(t.enter(r),t.enter(i),t.enter(a),t.consume(y),t.exit(a),h):y===null||y===32||y===41||Mw(y)?n(y):(t.enter(r),t.enter(s),t.enter(o),t.enter("chunkString",{contentType:"string"}),x(y))}function h(y){return y===62?(t.enter(a),t.consume(y),t.exit(a),t.exit(i),t.exit(r),e):(t.enter(o),t.enter("chunkString",{contentType:"string"}),f(y))}function f(y){return y===62?(t.exit("chunkString"),t.exit(o),h(y)):y===null||y===60||en(y)?n(y):(t.consume(y),y===92?m:f)}function m(y){return y===60||y===62||y===92?(t.consume(y),f):f(y)}function x(y){return!c&&(y===null||y===41||Dr(y))?(t.exit("chunkString"),t.exit(o),t.exit(s),t.exit(r),e(y)):c<u&&y===40?(t.consume(y),c++,x):y===41?(t.consume(y),c--,x):y===null||y===32||y===40||Mw(y)?n(y):(t.consume(y),y===92?b:x)}function b(y){return y===40||y===41||y===92?(t.consume(y),x):x(y)}}function ere(t,e,n,r,i,a){const s=this;let o=0,l;return u;function u(f){return t.enter(r),t.enter(i),t.consume(f),t.exit(i),t.enter(a),c}function c(f){return o>999||f===null||f===91||f===93&&!l||f===94&&!o&&"_hiddenFootnoteSupport"in s.parser.constructs?n(f):f===93?(t.exit(a),t.enter(i),t.consume(f),t.exit(i),t.exit(r),e):en(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),c):(t.enter("chunkString",{contentType:"string"}),d(f))}function d(f){return f===null||f===91||f===93||en(f)||o++>999?(t.exit("chunkString"),c(f)):(t.consume(f),l||(l=!Vn(f)),f===92?h:d)}function h(f){return f===91||f===92||f===93?(t.consume(f),o++,d):d(f)}}function tre(t,e,n,r,i,a){let s;return o;function o(h){return h===34||h===39||h===40?(t.enter(r),t.enter(i),t.consume(h),t.exit(i),s=h===40?41:h,l):n(h)}function l(h){return h===s?(t.enter(i),t.consume(h),t.exit(i),t.exit(r),e):(t.enter(a),u(h))}function u(h){return h===s?(t.exit(a),l(s)):h===null?n(h):en(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),Un(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),c(h))}function c(h){return h===s||h===null||en(h)?(t.exit("chunkString"),u(h)):(t.consume(h),h===92?d:c)}function d(h){return h===s||h===92?(t.consume(h),c):c(h)}}function Wg(t,e){let n;return r;function r(i){return en(i)?(t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),n=!0,r):Vn(i)?Un(t,r,n?"linePrefix":"lineSuffix")(i):e(i)}}const CPe={name:"definition",tokenize:APe},MPe={partial:!0,tokenize:kPe};function APe(t,e,n){const r=this;let i;return a;function a(f){return t.enter("definition"),s(f)}function s(f){return ere.call(r,t,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function o(f){return i=nl(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(t.enter("definitionMarker"),t.consume(f),t.exit("definitionMarker"),l):n(f)}function l(f){return Dr(f)?Wg(t,u)(f):u(f)}function u(f){return Qne(t,c,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function c(f){return t.attempt(MPe,d,d)(f)}function d(f){return Vn(f)?Un(t,h,"whitespace")(f):h(f)}function h(f){return f===null||en(f)?(t.exit("definition"),r.parser.defined.push(i),e(f)):n(f)}}function kPe(t,e,n){return r;function r(o){return Dr(o)?Wg(t,i)(o):n(o)}function i(o){return tre(t,a,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function a(o){return Vn(o)?Un(t,s,"whitespace")(o):s(o)}function s(o){return o===null||en(o)?e(o):n(o)}}const IPe={name:"hardBreakEscape",tokenize:NPe};function NPe(t,e,n){return r;function r(a){return t.enter("hardBreakEscape"),t.consume(a),i}function i(a){return en(a)?(t.exit("hardBreakEscape"),e(a)):n(a)}}const RPe={name:"headingAtx",resolve:PPe,tokenize:DPe};function PPe(t,e){let n=t.length-2,r=3,i,a;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(i={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},a={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},Xs(t,r,n-r+1,[["enter",i,e],["enter",a,e],["exit",a,e],["exit",i,e]])),t}function DPe(t,e,n){let r=0;return i;function i(c){return t.enter("atxHeading"),a(c)}function a(c){return t.enter("atxHeadingSequence"),s(c)}function s(c){return c===35&&r++<6?(t.consume(c),s):c===null||Dr(c)?(t.exit("atxHeadingSequence"),o(c)):n(c)}function o(c){return c===35?(t.enter("atxHeadingSequence"),l(c)):c===null||en(c)?(t.exit("atxHeading"),e(c)):Vn(c)?Un(t,o,"whitespace")(c):(t.enter("atxHeadingText"),u(c))}function l(c){return c===35?(t.consume(c),l):(t.exit("atxHeadingSequence"),o(c))}function u(c){return c===null||c===35||Dr(c)?(t.exit("atxHeadingText"),o(c)):(t.consume(c),u)}}const OPe=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],oz=["pre","script","style","textarea"],LPe={concrete:!0,name:"htmlFlow",resolveTo:UPe,tokenize:zPe},FPe={partial:!0,tokenize:HPe},BPe={partial:!0,tokenize:jPe};function UPe(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function zPe(t,e,n){const r=this;let i,a,s,o,l;return u;function u(H){return c(H)}function c(H){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(H),d}function d(H){return H===33?(t.consume(H),h):H===47?(t.consume(H),a=!0,x):H===63?(t.consume(H),i=3,r.interrupt?e:z):Ja(H)?(t.consume(H),s=String.fromCharCode(H),b):n(H)}function h(H){return H===45?(t.consume(H),i=2,f):H===91?(t.consume(H),i=5,o=0,m):Ja(H)?(t.consume(H),i=4,r.interrupt?e:z):n(H)}function f(H){return H===45?(t.consume(H),r.interrupt?e:z):n(H)}function m(H){const J="CDATA[";return H===J.charCodeAt(o++)?(t.consume(H),o===J.length?r.interrupt?e:D:m):n(H)}function x(H){return Ja(H)?(t.consume(H),s=String.fromCharCode(H),b):n(H)}function b(H){if(H===null||H===47||H===62||Dr(H)){const J=H===47,te=s.toLowerCase();return!J&&!a&&oz.includes(te)?(i=1,r.interrupt?e(H):D(H)):OPe.includes(s.toLowerCase())?(i=6,J?(t.consume(H),y):r.interrupt?e(H):D(H)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(H):a?w(H):_(H))}return H===45||Oa(H)?(t.consume(H),s+=String.fromCharCode(H),b):n(H)}function y(H){return H===62?(t.consume(H),r.interrupt?e:D):n(H)}function w(H){return Vn(H)?(t.consume(H),w):I(H)}function _(H){return H===47?(t.consume(H),I):H===58||H===95||Ja(H)?(t.consume(H),S):Vn(H)?(t.consume(H),_):I(H)}function S(H){return H===45||H===46||H===58||H===95||Oa(H)?(t.consume(H),S):M(H)}function M(H){return H===61?(t.consume(H),E):Vn(H)?(t.consume(H),M):_(H)}function E(H){return H===null||H===60||H===61||H===62||H===96?n(H):H===34||H===39?(t.consume(H),l=H,C):Vn(H)?(t.consume(H),E):R(H)}function C(H){return H===l?(t.consume(H),l=null,k):H===null||en(H)?n(H):(t.consume(H),C)}function R(H){return H===null||H===34||H===39||H===47||H===60||H===61||H===62||H===96||Dr(H)?M(H):(t.consume(H),R)}function k(H){return H===47||H===62||Vn(H)?_(H):n(H)}function I(H){return H===62?(t.consume(H),N):n(H)}function N(H){return H===null||en(H)?D(H):Vn(H)?(t.consume(H),N):n(H)}function D(H){return H===45&&i===2?(t.consume(H),j):H===60&&i===1?(t.consume(H),q):H===62&&i===4?(t.consume(H),W):H===63&&i===3?(t.consume(H),z):H===93&&i===5?(t.consume(H),Q):en(H)&&(i===6||i===7)?(t.exit("htmlFlowData"),t.check(FPe,X,F)(H)):H===null||en(H)?(t.exit("htmlFlowData"),F(H)):(t.consume(H),D)}function F(H){return t.check(BPe,L,X)(H)}function L(H){return t.enter("lineEnding"),t.consume(H),t.exit("lineEnding"),U}function U(H){return H===null||en(H)?F(H):(t.enter("htmlFlowData"),D(H))}function j(H){return H===45?(t.consume(H),z):D(H)}function q(H){return H===47?(t.consume(H),s="",Z):D(H)}function Z(H){if(H===62){const J=s.toLowerCase();return oz.includes(J)?(t.consume(H),W):D(H)}return Ja(H)&&s.length<8?(t.consume(H),s+=String.fromCharCode(H),Z):D(H)}function Q(H){return H===93?(t.consume(H),z):D(H)}function z(H){return H===62?(t.consume(H),W):H===45&&i===2?(t.consume(H),z):D(H)}function W(H){return H===null||en(H)?(t.exit("htmlFlowData"),X(H)):(t.consume(H),W)}function X(H){return t.exit("htmlFlow"),e(H)}}function jPe(t,e,n){const r=this;return i;function i(s){return en(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),a):n(s)}function a(s){return r.parser.lazy[r.now().line]?n(s):e(s)}}function HPe(t,e,n){return r;function r(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),t.attempt(Rv,e,n)}}const $Pe={name:"htmlText",tokenize:VPe};function VPe(t,e,n){const r=this;let i,a,s;return o;function o(z){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(z),l}function l(z){return z===33?(t.consume(z),u):z===47?(t.consume(z),M):z===63?(t.consume(z),_):Ja(z)?(t.consume(z),R):n(z)}function u(z){return z===45?(t.consume(z),c):z===91?(t.consume(z),a=0,m):Ja(z)?(t.consume(z),w):n(z)}function c(z){return z===45?(t.consume(z),f):n(z)}function d(z){return z===null?n(z):z===45?(t.consume(z),h):en(z)?(s=d,q(z)):(t.consume(z),d)}function h(z){return z===45?(t.consume(z),f):d(z)}function f(z){return z===62?j(z):z===45?h(z):d(z)}function m(z){const W="CDATA[";return z===W.charCodeAt(a++)?(t.consume(z),a===W.length?x:m):n(z)}function x(z){return z===null?n(z):z===93?(t.consume(z),b):en(z)?(s=x,q(z)):(t.consume(z),x)}function b(z){return z===93?(t.consume(z),y):x(z)}function y(z){return z===62?j(z):z===93?(t.consume(z),y):x(z)}function w(z){return z===null||z===62?j(z):en(z)?(s=w,q(z)):(t.consume(z),w)}function _(z){return z===null?n(z):z===63?(t.consume(z),S):en(z)?(s=_,q(z)):(t.consume(z),_)}function S(z){return z===62?j(z):_(z)}function M(z){return Ja(z)?(t.consume(z),E):n(z)}function E(z){return z===45||Oa(z)?(t.consume(z),E):C(z)}function C(z){return en(z)?(s=C,q(z)):Vn(z)?(t.consume(z),C):j(z)}function R(z){return z===45||Oa(z)?(t.consume(z),R):z===47||z===62||Dr(z)?k(z):n(z)}function k(z){return z===47?(t.consume(z),j):z===58||z===95||Ja(z)?(t.consume(z),I):en(z)?(s=k,q(z)):Vn(z)?(t.consume(z),k):j(z)}function I(z){return z===45||z===46||z===58||z===95||Oa(z)?(t.consume(z),I):N(z)}function N(z){return z===61?(t.consume(z),D):en(z)?(s=N,q(z)):Vn(z)?(t.consume(z),N):k(z)}function D(z){return z===null||z===60||z===61||z===62||z===96?n(z):z===34||z===39?(t.consume(z),i=z,F):en(z)?(s=D,q(z)):Vn(z)?(t.consume(z),D):(t.consume(z),L)}function F(z){return z===i?(t.consume(z),i=void 0,U):z===null?n(z):en(z)?(s=F,q(z)):(t.consume(z),F)}function L(z){return z===null||z===34||z===39||z===60||z===61||z===96?n(z):z===47||z===62||Dr(z)?k(z):(t.consume(z),L)}function U(z){return z===47||z===62||Dr(z)?k(z):n(z)}function j(z){return z===62?(t.consume(z),t.exit("htmlTextData"),t.exit("htmlText"),e):n(z)}function q(z){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(z),t.exit("lineEnding"),Z}function Z(z){return Vn(z)?Un(t,Q,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(z):Q(z)}function Q(z){return t.enter("htmlTextData"),s(z)}}const AR={name:"labelEnd",resolveAll:YPe,resolveTo:XPe,tokenize:KPe},qPe={tokenize:ZPe},GPe={tokenize:JPe},WPe={tokenize:QPe};function YPe(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",e+=i}}return t.length!==n.length&&Xs(t,0,t.length,n),t}function XPe(t,e){let n=t.length,r=0,i,a,s,o;for(;n--;)if(i=t[n][1],a){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;t[n][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(s){if(t[n][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(a=n,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(s=n);const l={type:t[a][1].type==="labelLink"?"link":"image",start:{...t[a][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[a][1].start},end:{...t[s][1].end}},c={type:"labelText",start:{...t[a+r+2][1].end},end:{...t[s-2][1].start}};return o=[["enter",l,e],["enter",u,e]],o=co(o,t.slice(a+1,a+r+3)),o=co(o,[["enter",c,e]]),o=co(o,p3(e.parser.constructs.insideSpan.null,t.slice(a+r+4,s-3),e)),o=co(o,[["exit",c,e],t[s-2],t[s-1],["exit",u,e]]),o=co(o,t.slice(s+1)),o=co(o,[["exit",l,e]]),Xs(t,a,t.length,o),t}function KPe(t,e,n){const r=this;let i=r.events.length,a,s;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){a=r.events[i][1];break}return o;function o(h){return a?a._inactive?d(h):(s=r.parser.defined.includes(nl(r.sliceSerialize({start:a.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(qPe,c,s?c:d)(h):h===91?t.attempt(GPe,c,s?u:d)(h):s?c(h):d(h)}function u(h){return t.attempt(WPe,c,d)(h)}function c(h){return e(h)}function d(h){return a._balanced=!0,n(h)}}function ZPe(t,e,n){return r;function r(d){return t.enter("resource"),t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),i}function i(d){return Dr(d)?Wg(t,a)(d):a(d)}function a(d){return d===41?c(d):Qne(t,s,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function s(d){return Dr(d)?Wg(t,l)(d):c(d)}function o(d){return n(d)}function l(d){return d===34||d===39||d===40?tre(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return Dr(d)?Wg(t,c)(d):c(d)}function c(d){return d===41?(t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),t.exit("resource"),e):n(d)}}function JPe(t,e,n){const r=this;return i;function i(o){return ere.call(r,t,a,s,"reference","referenceMarker","referenceString")(o)}function a(o){return r.parser.defined.includes(nl(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):n(o)}function s(o){return n(o)}}function QPe(t,e,n){return r;function r(a){return t.enter("reference"),t.enter("referenceMarker"),t.consume(a),t.exit("referenceMarker"),i}function i(a){return a===93?(t.enter("referenceMarker"),t.consume(a),t.exit("referenceMarker"),t.exit("reference"),e):n(a)}}const eDe={name:"labelStartImage",resolveAll:AR.resolveAll,tokenize:tDe};function tDe(t,e,n){const r=this;return i;function i(o){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(o),t.exit("labelImageMarker"),a}function a(o){return o===91?(t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelImage"),s):n(o)}function s(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const nDe={name:"labelStartLink",resolveAll:AR.resolveAll,tokenize:rDe};function rDe(t,e,n){const r=this;return i;function i(s){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(s),t.exit("labelMarker"),t.exit("labelLink"),a}function a(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(s):e(s)}}const hT={name:"lineEnding",tokenize:iDe};function iDe(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Un(t,e,"linePrefix")}}const qb={name:"thematicBreak",tokenize:aDe};function aDe(t,e,n){let r=0,i;return a;function a(u){return t.enter("thematicBreak"),s(u)}function s(u){return i=u,o(u)}function o(u){return u===i?(t.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||en(u))?(t.exit("thematicBreak"),e(u)):n(u)}function l(u){return u===i?(t.consume(u),r++,l):(t.exit("thematicBreakSequence"),Vn(u)?Un(t,o,"whitespace")(u):o(u))}}const ps={continuation:{tokenize:uDe},exit:dDe,name:"list",tokenize:lDe},sDe={partial:!0,tokenize:hDe},oDe={partial:!0,tokenize:cDe};function lDe(t,e,n){const r=this,i=r.events[r.events.length-1];let a=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,s=0;return o;function o(f){const m=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:OI(f)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),f===42||f===45?t.check(qb,n,u)(f):u(f);if(!r.interrupt||f===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(f)}return n(f)}function l(f){return OI(f)&&++s<10?(t.consume(f),l):(!r.interrupt||s<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(t.exit("listItemValue"),u(f)):n(f)}function u(f){return t.enter("listItemMarker"),t.consume(f),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,t.check(Rv,r.interrupt?n:c,t.attempt(sDe,h,d))}function c(f){return r.containerState.initialBlankLine=!0,a++,h(f)}function d(f){return Vn(f)?(t.enter("listItemPrefixWhitespace"),t.consume(f),t.exit("listItemPrefixWhitespace"),h):n(f)}function h(f){return r.containerState.size=a+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(f)}}function uDe(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(Rv,i,a);function i(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Un(t,e,"listItemIndent",r.containerState.size+1)(o)}function a(o){return r.containerState.furtherBlankLines||!Vn(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(oDe,e,s)(o))}function s(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,Un(t,t.attempt(ps,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function cDe(t,e,n){const r=this;return Un(t,i,"listItemIndent",r.containerState.size+1);function i(a){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?e(a):n(a)}}function dDe(t){t.exit(this.containerState.type)}function hDe(t,e,n){const r=this;return Un(t,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(a){const s=r.events[r.events.length-1];return!Vn(a)&&s&&s[1].type==="listItemPrefixWhitespace"?e(a):n(a)}}const lz={name:"setextUnderline",resolveTo:fDe,tokenize:pDe};function fDe(t,e){let n=t.length,r,i,a;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(i=n)}else t[n][1].type==="content"&&t.splice(n,1),!a&&t[n][1].type==="definition"&&(a=n);const s={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[i][1].type="setextHeadingText",a?(t.splice(i,0,["enter",s,e]),t.splice(a+1,0,["exit",t[r][1],e]),t[r][1].end={...t[a][1].end}):t[r][1]=s,t.push(["exit",s,e]),t}function pDe(t,e,n){const r=this;let i;return a;function a(u){let c=r.events.length,d;for(;c--;)if(r.events[c][1].type!=="lineEnding"&&r.events[c][1].type!=="linePrefix"&&r.events[c][1].type!=="content"){d=r.events[c][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(t.enter("setextHeadingLine"),i=u,s(u)):n(u)}function s(u){return t.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===i?(t.consume(u),o):(t.exit("setextHeadingLineSequence"),Vn(u)?Un(t,l,"lineSuffix")(u):l(u))}function l(u){return u===null||en(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const mDe={tokenize:gDe};function gDe(t){const e=this,n=t.attempt(Rv,r,t.attempt(this.parser.constructs.flowInitial,i,Un(t,t.attempt(this.parser.constructs.flow,i,t.attempt(_Pe,i)),"linePrefix")));return n;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEndingBlank"),t.consume(a),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function i(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const vDe={resolveAll:rre()},yDe=nre("string"),xDe=nre("text");function nre(t){return{resolveAll:rre(t==="text"?bDe:void 0),tokenize:e};function e(n){const r=this,i=this.parser.constructs[t],a=n.attempt(i,s,o);return s;function s(c){return u(c)?a(c):o(c)}function o(c){if(c===null){n.consume(c);return}return n.enter("data"),n.consume(c),l}function l(c){return u(c)?(n.exit("data"),a(c)):(n.consume(c),l)}function u(c){if(c===null)return!0;const d=i[c];let h=-1;if(d)for(;++h<d.length;){const f=d[h];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function rre(t){return e;function e(n,r){let i=-1,a;for(;++i<=n.length;)a===void 0?n[i]&&n[i][1].type==="data"&&(a=i,i++):(!n[i]||n[i][1].type!=="data")&&(i!==a+2&&(n[a][1].end=n[i-1][1].end,n.splice(a+2,i-a-2),i=a+2),a=void 0);return t?t(n,r):n}}function bDe(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],i=e.sliceStream(r);let a=i.length,s=-1,o=0,l;for(;a--;){const u=i[a];if(typeof u=="string"){for(s=u.length;u.charCodeAt(s-1)===32;)o++,s--;if(s)break;s=-1}else if(u===-2)l=!0,o++;else if(u!==-1){a++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(o=0),o){const u={type:n===t.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:a?s:r.start._bufferIndex+s,_index:r.start._index+a,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const _De={42:ps,43:ps,45:ps,48:ps,49:ps,50:ps,51:ps,52:ps,53:ps,54:ps,55:ps,56:ps,57:ps,62:Xne},wDe={91:CPe},SDe={[-2]:dT,[-1]:dT,32:dT},EDe={35:RPe,42:qb,45:[lz,qb],60:LPe,61:lz,95:qb,96:sz,126:sz},TDe={38:Zne,92:Kne},CDe={[-5]:hT,[-4]:hT,[-3]:hT,33:eDe,38:Zne,42:LI,60:[nPe,$Pe],91:nDe,92:[IPe,Kne],93:AR,95:LI,96:mPe},MDe={null:[LI,vDe]},ADe={null:[42,95]},kDe={null:[]},IDe=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:ADe,contentInitial:wDe,disable:kDe,document:_De,flow:EDe,flowInitial:SDe,insideSpan:MDe,string:TDe,text:CDe},Symbol.toStringTag,{value:"Module"}));function NDe(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},a=[];let s=[],o=[];const l={attempt:C(M),check:C(E),consume:w,enter:_,exit:S,interrupt:C(E,{interrupt:!0})},u={code:null,containerState:{},defineSkip:x,events:[],now:m,parser:t,previous:null,sliceSerialize:h,sliceStream:f,write:d};let c=e.tokenize.call(u,l);return e.resolveAll&&a.push(e),u;function d(N){return s=co(s,N),b(),s[s.length-1]!==null?[]:(R(e,0),u.events=p3(a,u.events,u),u.events)}function h(N,D){return PDe(f(N),D)}function f(N){return RDe(s,N)}function m(){const{_bufferIndex:N,_index:D,line:F,column:L,offset:U}=r;return{_bufferIndex:N,_index:D,line:F,column:L,offset:U}}function x(N){i[N.line]=N.column,I()}function b(){let N;for(;r._index<s.length;){const D=s[r._index];if(typeof D=="string")for(N=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===N&&r._bufferIndex<D.length;)y(D.charCodeAt(r._bufferIndex));else y(D)}}function y(N){c=c(N)}function w(N){en(N)?(r.line++,r.column=1,r.offset+=N===-3?2:1,I()):N!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=N}function _(N,D){const F=D||{};return F.type=N,F.start=m(),u.events.push(["enter",F,u]),o.push(F),F}function S(N){const D=o.pop();return D.end=m(),u.events.push(["exit",D,u]),D}function M(N,D){R(N,D.from)}function E(N,D){D.restore()}function C(N,D){return F;function F(L,U,j){let q,Z,Q,z;return Array.isArray(L)?X(L):"tokenize"in L?X([L]):W(L);function W(ee){return se;function se(ue){const oe=ue!==null&&ee[ue],Te=ue!==null&&ee.null,Ne=[...Array.isArray(oe)?oe:oe?[oe]:[],...Array.isArray(Te)?Te:Te?[Te]:[]];return X(Ne)(ue)}}function X(ee){return q=ee,Z=0,ee.length===0?j:H(ee[Z])}function H(ee){return se;function se(ue){return z=k(),Q=ee,ee.partial||(u.currentConstruct=ee),ee.name&&u.parser.constructs.disable.null.includes(ee.name)?te():ee.tokenize.call(D?Object.assign(Object.create(u),D):u,l,J,te)(ue)}}function J(ee){return N(Q,z),U}function te(ee){return z.restore(),++Z<q.length?H(q[Z]):j}}}function R(N,D){N.resolveAll&&!a.includes(N)&&a.push(N),N.resolve&&Xs(u.events,D,u.events.length-D,N.resolve(u.events.slice(D),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function k(){const N=m(),D=u.previous,F=u.currentConstruct,L=u.events.length,U=Array.from(o);return{from:L,restore:j};function j(){r=N,u.previous=D,u.currentConstruct=F,u.events.length=L,o=U,I()}}function I(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function RDe(t,e){const n=e.start._index,r=e.start._bufferIndex,i=e.end._index,a=e.end._bufferIndex;let s;if(n===i)s=[t[n].slice(r,a)];else{if(s=t.slice(n,i),r>-1){const o=s[0];typeof o=="string"?s[0]=o.slice(r):s.shift()}a>0&&s.push(t[i].slice(0,a))}return s}function PDe(t,e){let n=-1;const r=[];let i;for(;++n<t.length;){const a=t[n];let s;if(typeof a=="string")s=a;else switch(a){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=e?" ":"	";break}case-1:{if(!e&&i)continue;s=" ";break}default:s=String.fromCharCode(a)}i=a===-2,r.push(s)}return r.join("")}function DDe(t){const r={constructs:Wne([IDe,...(t||{}).extensions||[]]),content:i(X7e),defined:[],document:i(Z7e),flow:i(mDe),lazy:{},string:i(yDe),text:i(xDe)};return r;function i(a){return s;function s(o){return NDe(r,a,o)}}}function ODe(t){for(;!Jne(t););return t}const uz=/[\0\t\n\r]/g;function LDe(){let t=1,e="",n=!0,r;return i;function i(a,s,o){const l=[];let u,c,d,h,f;for(a=e+(typeof a=="string"?a.toString():new TextDecoder(s||void 0).decode(a)),d=0,e="",n&&(a.charCodeAt(0)===65279&&d++,n=void 0);d<a.length;){if(uz.lastIndex=d,u=uz.exec(a),h=u&&u.index!==void 0?u.index:a.length,f=a.charCodeAt(h),!u){e=a.slice(d);break}if(f===10&&d===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),d<h&&(l.push(a.slice(d,h)),t+=h-d),f){case 0:{l.push(65533),t++;break}case 9:{for(c=Math.ceil(t/4)*4,l.push(-2);t++<c;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}d=h+1}return o&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const FDe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function BDe(t){return t.replace(FDe,UDe)}function UDe(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const i=n.charCodeAt(1),a=i===120||i===88;return Yne(n.slice(a?2:1),a?16:10)}return MR(n)||t}const ire={}.hasOwnProperty;function zDe(t,e,n){return typeof e!="string"&&(n=e,e=void 0),jDe(n)(ODe(DDe(n).document().write(LDe()(t,e,!0))))}function jDe(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(xe),autolinkProtocol:k,autolinkEmail:k,atxHeading:a(Me),blockQuote:a(Te),characterEscape:k,characterReference:k,codeFenced:a(Ne),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:a(Ne,s),codeText:a(be,s),codeTextData:k,data:k,codeFlowValue:k,definition:a(De),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:a(ke),hardBreakEscape:a(Ie),hardBreakTrailing:a(Ie),htmlFlow:a(ce,s),htmlFlowData:k,htmlText:a(ce,s),htmlTextData:k,image:a(G),label:s,link:a(xe),listItem:a(Fe),listItemValue:h,listOrdered:a(Oe,d),listUnordered:a(Oe),paragraph:a(ze),reference:H,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:a(Me),strong:a(le),thematicBreak:a(me)},exit:{atxHeading:l(),atxHeadingSequence:M,autolink:l(),autolinkEmail:oe,autolinkProtocol:ue,blockQuote:l(),characterEscapeValue:I,characterReferenceMarkerHexadecimal:te,characterReferenceMarkerNumeric:te,characterReferenceValue:ee,characterReference:se,codeFenced:l(b),codeFencedFence:x,codeFencedFenceInfo:f,codeFencedFenceMeta:m,codeFlowValue:I,codeIndented:l(y),codeText:l(U),codeTextData:I,data:I,definition:l(),definitionDestinationString:S,definitionLabelString:w,definitionTitleString:_,emphasis:l(),hardBreakEscape:l(D),hardBreakTrailing:l(D),htmlFlow:l(F),htmlFlowData:I,htmlText:l(L),htmlTextData:I,image:l(q),label:Q,labelText:Z,lineEnding:N,link:l(j),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:J,resourceDestinationString:z,resourceTitleString:W,resource:X,setextHeading:l(R),setextHeadingLineSequence:C,setextHeadingText:E,strong:l(),thematicBreak:l()}};are(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(de){let ve={type:"root",children:[]};const _e={stack:[ve],tokenStack:[],config:e,enter:o,exit:u,buffer:s,resume:c,data:n},Be=[];let He=-1;for(;++He<de.length;)if(de[He][1].type==="listOrdered"||de[He][1].type==="listUnordered")if(de[He][0]==="enter")Be.push(He);else{const pt=Be.pop();He=i(de,pt,He)}for(He=-1;++He<de.length;){const pt=e[de[He][0]];ire.call(pt,de[He][1].type)&&pt[de[He][1].type].call(Object.assign({sliceSerialize:de[He][2].sliceSerialize},_e),de[He][1])}if(_e.tokenStack.length>0){const pt=_e.tokenStack[_e.tokenStack.length-1];(pt[1]||cz).call(_e,void 0,pt[0])}for(ve.position={start:Ic(de.length>0?de[0][1].start:{line:1,column:1,offset:0}),end:Ic(de.length>0?de[de.length-2][1].end:{line:1,column:1,offset:0})},He=-1;++He<e.transforms.length;)ve=e.transforms[He](ve)||ve;return ve}function i(de,ve,_e){let Be=ve-1,He=-1,pt=!1,gt,We,Je,ot;for(;++Be<=_e;){const Ee=de[Be];switch(Ee[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ee[0]==="enter"?He++:He--,ot=void 0;break}case"lineEndingBlank":{Ee[0]==="enter"&&(gt&&!ot&&!He&&!Je&&(Je=Be),ot=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:ot=void 0}if(!He&&Ee[0]==="enter"&&Ee[1].type==="listItemPrefix"||He===-1&&Ee[0]==="exit"&&(Ee[1].type==="listUnordered"||Ee[1].type==="listOrdered")){if(gt){let je=Be;for(We=void 0;je--;){const mt=de[je];if(mt[1].type==="lineEnding"||mt[1].type==="lineEndingBlank"){if(mt[0]==="exit")continue;We&&(de[We][1].type="lineEndingBlank",pt=!0),mt[1].type="lineEnding",We=je}else if(!(mt[1].type==="linePrefix"||mt[1].type==="blockQuotePrefix"||mt[1].type==="blockQuotePrefixWhitespace"||mt[1].type==="blockQuoteMarker"||mt[1].type==="listItemIndent"))break}Je&&(!We||Je<We)&&(gt._spread=!0),gt.end=Object.assign({},We?de[We][1].start:Ee[1].end),de.splice(We||Be,0,["exit",gt,Ee[2]]),Be++,_e++}if(Ee[1].type==="listItemPrefix"){const je={type:"listItem",_spread:!1,start:Object.assign({},Ee[1].start),end:void 0};gt=je,de.splice(Be,0,["enter",je,Ee[2]]),Be++,_e++,Je=void 0,ot=!0}}}return de[ve][1]._spread=pt,_e}function a(de,ve){return _e;function _e(Be){o.call(this,de(Be),Be),ve&&ve.call(this,Be)}}function s(){this.stack.push({type:"fragment",children:[]})}function o(de,ve,_e){this.stack[this.stack.length-1].children.push(de),this.stack.push(de),this.tokenStack.push([ve,_e||void 0]),de.position={start:Ic(ve.start),end:void 0}}function l(de){return ve;function ve(_e){de&&de.call(this,_e),u.call(this,_e)}}function u(de,ve){const _e=this.stack.pop(),Be=this.tokenStack.pop();if(Be)Be[0].type!==de.type&&(ve?ve.call(this,de,Be[0]):(Be[1]||cz).call(this,de,Be[0]));else throw new Error("Cannot close `"+de.type+"` ("+Gg({start:de.start,end:de.end})+"): it’s not open");_e.position.end=Ic(de.end)}function c(){return CR(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(de){if(this.data.expectingFirstListItemValue){const ve=this.stack[this.stack.length-2];ve.start=Number.parseInt(this.sliceSerialize(de),10),this.data.expectingFirstListItemValue=void 0}}function f(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.lang=de}function m(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.meta=de}function x(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function b(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.value=de.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function y(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.value=de.replace(/(\r?\n|\r)$/g,"")}function w(de){const ve=this.resume(),_e=this.stack[this.stack.length-1];_e.label=ve,_e.identifier=nl(this.sliceSerialize(de)).toLowerCase()}function _(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.title=de}function S(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.url=de}function M(de){const ve=this.stack[this.stack.length-1];if(!ve.depth){const _e=this.sliceSerialize(de).length;ve.depth=_e}}function E(){this.data.setextHeadingSlurpLineEnding=!0}function C(de){const ve=this.stack[this.stack.length-1];ve.depth=this.sliceSerialize(de).codePointAt(0)===61?1:2}function R(){this.data.setextHeadingSlurpLineEnding=void 0}function k(de){const _e=this.stack[this.stack.length-1].children;let Be=_e[_e.length-1];(!Be||Be.type!=="text")&&(Be=re(),Be.position={start:Ic(de.start),end:void 0},_e.push(Be)),this.stack.push(Be)}function I(de){const ve=this.stack.pop();ve.value+=this.sliceSerialize(de),ve.position.end=Ic(de.end)}function N(de){const ve=this.stack[this.stack.length-1];if(this.data.atHardBreak){const _e=ve.children[ve.children.length-1];_e.position.end=Ic(de.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(ve.type)&&(k.call(this,de),I.call(this,de))}function D(){this.data.atHardBreak=!0}function F(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.value=de}function L(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.value=de}function U(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.value=de}function j(){const de=this.stack[this.stack.length-1];if(this.data.inReference){const ve=this.data.referenceType||"shortcut";de.type+="Reference",de.referenceType=ve,delete de.url,delete de.title}else delete de.identifier,delete de.label;this.data.referenceType=void 0}function q(){const de=this.stack[this.stack.length-1];if(this.data.inReference){const ve=this.data.referenceType||"shortcut";de.type+="Reference",de.referenceType=ve,delete de.url,delete de.title}else delete de.identifier,delete de.label;this.data.referenceType=void 0}function Z(de){const ve=this.sliceSerialize(de),_e=this.stack[this.stack.length-2];_e.label=BDe(ve),_e.identifier=nl(ve).toLowerCase()}function Q(){const de=this.stack[this.stack.length-1],ve=this.resume(),_e=this.stack[this.stack.length-1];if(this.data.inReference=!0,_e.type==="link"){const Be=de.children;_e.children=Be}else _e.alt=ve}function z(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.url=de}function W(){const de=this.resume(),ve=this.stack[this.stack.length-1];ve.title=de}function X(){this.data.inReference=void 0}function H(){this.data.referenceType="collapsed"}function J(de){const ve=this.resume(),_e=this.stack[this.stack.length-1];_e.label=ve,_e.identifier=nl(this.sliceSerialize(de)).toLowerCase(),this.data.referenceType="full"}function te(de){this.data.characterReferenceType=de.type}function ee(de){const ve=this.sliceSerialize(de),_e=this.data.characterReferenceType;let Be;_e?(Be=Yne(ve,_e==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Be=MR(ve);const He=this.stack[this.stack.length-1];He.value+=Be}function se(de){const ve=this.stack.pop();ve.position.end=Ic(de.end)}function ue(de){I.call(this,de);const ve=this.stack[this.stack.length-1];ve.url=this.sliceSerialize(de)}function oe(de){I.call(this,de);const ve=this.stack[this.stack.length-1];ve.url="mailto:"+this.sliceSerialize(de)}function Te(){return{type:"blockquote",children:[]}}function Ne(){return{type:"code",lang:null,meta:null,value:""}}function be(){return{type:"inlineCode",value:""}}function De(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ke(){return{type:"emphasis",children:[]}}function Me(){return{type:"heading",depth:0,children:[]}}function Ie(){return{type:"break"}}function ce(){return{type:"html",value:""}}function G(){return{type:"image",title:null,url:"",alt:null}}function xe(){return{type:"link",title:null,url:"",children:[]}}function Oe(de){return{type:"list",ordered:de.type==="listOrdered",start:null,spread:de._spread,children:[]}}function Fe(de){return{type:"listItem",spread:de._spread,checked:null,children:[]}}function ze(){return{type:"paragraph",children:[]}}function le(){return{type:"strong",children:[]}}function re(){return{type:"text",value:""}}function me(){return{type:"thematicBreak"}}}function Ic(t){return{line:t.line,column:t.column,offset:t.offset}}function are(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?are(t,r):HDe(t,r)}}function HDe(t,e){let n;for(n in e)if(ire.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function cz(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Gg({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Gg({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Gg({start:e.start,end:e.end})+") is still open")}function $De(t){const e=this;e.parser=n;function n(r){return zDe(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function VDe(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function qDe(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function GDe(t,e){const n=e.value?e.value+`
`:"",r={},i=e.lang?e.lang.split(/\s+/):[];i.length>0&&(r.className=["language-"+i[0]]);let a={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(a.data={meta:e.meta}),t.patch(e,a),a=t.applyData(e,a),a={type:"element",tagName:"pre",properties:{},children:[a]},t.patch(e,a),a}function WDe(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function YDe(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function XDe(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=G0(r.toLowerCase()),a=t.footnoteOrder.indexOf(r);let s,o=t.footnoteCounts.get(r);o===void 0?(o=0,t.footnoteOrder.push(r),s=t.footnoteOrder.length):s=a+1,o+=1,t.footnoteCounts.set(r,o);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};t.patch(e,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,u),t.applyData(e,u)}function KDe(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function ZDe(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function sre(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=t.all(e),a=i[0];a&&a.type==="text"?a.value="["+a.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&s.type==="text"?s.value+=r:i.push({type:"text",value:r}),i}function JDe(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return sre(t,e);const i={src:G0(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"img",properties:i,children:[]};return t.patch(e,a),t.applyData(e,a)}function QDe(t,e){const n={src:G0(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function e9e(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function t9e(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return sre(t,e);const i={href:G0(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"a",properties:i,children:t.all(e)};return t.patch(e,a),t.applyData(e,a)}function n9e(t,e){const n={href:G0(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function r9e(t,e,n){const r=t.all(e),i=n?i9e(n):ore(e),a={},s=[];if(typeof e.checked=="boolean"){const c=r[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const c=r[o];(i||o!==0||c.type!=="element"||c.tagName!=="p")&&s.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!i?s.push(...c.children):s.push(c)}const l=r[r.length-1];l&&(i||l.type!=="element"||l.tagName!=="p")&&s.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:a,children:s};return t.patch(e,u),t.applyData(e,u)}function i9e(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=ore(n[r])}return e}function ore(t){const e=t.spread;return e??t.children.length>1}function a9e(t,e){const n={},r=t.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++i<r.length;){const s=r[i];if(s.type==="element"&&s.tagName==="li"&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const a={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,a),t.applyData(e,a)}function s9e(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function o9e(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function l9e(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function u9e(t,e){const n=t.all(e),r=n.shift(),i=[];if(r){const s={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],s),i.push(s)}if(n.length>0){const s={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},o=Xl(e.children[1]),l=h3(e.children[e.children.length-1]);o&&l&&(s.position={start:o,end:l}),i.push(s)}const a={type:"element",tagName:"table",properties:{},children:t.wrap(i,!0)};return t.patch(e,a),t.applyData(e,a)}function c9e(t,e,n){const r=n?n.children:void 0,a=(r?r.indexOf(e):1)===0?"th":"td",s=n&&n.type==="table"?n.align:void 0,o=s?s.length:e.children.length;let l=-1;const u=[];for(;++l<o;){const d=e.children[l],h={},f=s?s[l]:void 0;f&&(h.align=f);let m={type:"element",tagName:a,properties:h,children:[]};d&&(m.children=t.all(d),t.patch(d,m),m=t.applyData(d,m)),u.push(m)}const c={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,c),t.applyData(e,c)}function d9e(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const dz=9,hz=32;function h9e(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),i=0;const a=[];for(;r;)a.push(fz(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(e);return a.push(fz(e.slice(i),i>0,!1)),a.join("")}function fz(t,e,n){let r=0,i=t.length;if(e){let a=t.codePointAt(r);for(;a===dz||a===hz;)r++,a=t.codePointAt(r)}if(n){let a=t.codePointAt(i-1);for(;a===dz||a===hz;)i--,a=t.codePointAt(i-1)}return i>r?t.slice(r,i):""}function f9e(t,e){const n={type:"text",value:h9e(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function p9e(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const m9e={blockquote:VDe,break:qDe,code:GDe,delete:WDe,emphasis:YDe,footnoteReference:XDe,heading:KDe,html:ZDe,imageReference:JDe,image:QDe,inlineCode:e9e,linkReference:t9e,link:n9e,listItem:r9e,list:a9e,paragraph:s9e,root:o9e,strong:l9e,table:u9e,tableCell:d9e,tableRow:c9e,text:f9e,thematicBreak:p9e,toml:ib,yaml:ib,definition:ib,footnoteDefinition:ib};function ib(){}const lre=-1,m3=0,Yg=1,Aw=2,kR=3,IR=4,NR=5,RR=6,ure=7,cre=8,pz=typeof self=="object"?self:globalThis,g9e=(t,e)=>{const n=(i,a)=>(t.set(a,i),i),r=i=>{if(t.has(i))return t.get(i);const[a,s]=e[i];switch(a){case m3:case lre:return n(s,i);case Yg:{const o=n([],i);for(const l of s)o.push(r(l));return o}case Aw:{const o=n({},i);for(const[l,u]of s)o[r(l)]=r(u);return o}case kR:return n(new Date(s),i);case IR:{const{source:o,flags:l}=s;return n(new RegExp(o,l),i)}case NR:{const o=n(new Map,i);for(const[l,u]of s)o.set(r(l),r(u));return o}case RR:{const o=n(new Set,i);for(const l of s)o.add(r(l));return o}case ure:{const{name:o,message:l}=s;return n(new pz[o](l),i)}case cre:return n(BigInt(s),i);case"BigInt":return n(Object(BigInt(s)),i);case"ArrayBuffer":return n(new Uint8Array(s).buffer,s);case"DataView":{const{buffer:o}=new Uint8Array(s);return n(new DataView(o),s)}}return n(new pz[a](s),i)};return r},mz=t=>g9e(new Map,t)(0),Lp="",{toString:v9e}={},{keys:y9e}=Object,ag=t=>{const e=typeof t;if(e!=="object"||!t)return[m3,e];const n=v9e.call(t).slice(8,-1);switch(n){case"Array":return[Yg,Lp];case"Object":return[Aw,Lp];case"Date":return[kR,Lp];case"RegExp":return[IR,Lp];case"Map":return[NR,Lp];case"Set":return[RR,Lp];case"DataView":return[Yg,n]}return n.includes("Array")?[Yg,n]:n.includes("Error")?[ure,n]:[Aw,n]},ab=([t,e])=>t===m3&&(e==="function"||e==="symbol"),x9e=(t,e,n,r)=>{const i=(s,o)=>{const l=r.push(s)-1;return n.set(o,l),l},a=s=>{if(n.has(s))return n.get(s);let[o,l]=ag(s);switch(o){case m3:{let c=s;switch(l){case"bigint":o=cre,c=s.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);c=null;break;case"undefined":return i([lre],s)}return i([o,c],s)}case Yg:{if(l){let h=s;return l==="DataView"?h=new Uint8Array(s.buffer):l==="ArrayBuffer"&&(h=new Uint8Array(s)),i([l,[...h]],s)}const c=[],d=i([o,c],s);for(const h of s)c.push(a(h));return d}case Aw:{if(l)switch(l){case"BigInt":return i([l,s.toString()],s);case"Boolean":case"Number":case"String":return i([l,s.valueOf()],s)}if(e&&"toJSON"in s)return a(s.toJSON());const c=[],d=i([o,c],s);for(const h of y9e(s))(t||!ab(ag(s[h])))&&c.push([a(h),a(s[h])]);return d}case kR:return i([o,s.toISOString()],s);case IR:{const{source:c,flags:d}=s;return i([o,{source:c,flags:d}],s)}case NR:{const c=[],d=i([o,c],s);for(const[h,f]of s)(t||!(ab(ag(h))||ab(ag(f))))&&c.push([a(h),a(f)]);return d}case RR:{const c=[],d=i([o,c],s);for(const h of s)(t||!ab(ag(h)))&&c.push(a(h));return d}}const{message:u}=s;return i([o,{name:l,message:u}],s)};return a},gz=(t,{json:e,lossy:n}={})=>{const r=[];return x9e(!(e||n),!!e,new Map,r)(t),r},E0=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?mz(gz(t,e)):structuredClone(t):(t,e)=>mz(gz(t,e));function b9e(t,e){const n=[{type:"text",value:"↩"}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function _9e(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function w9e(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||b9e,r=t.options.footnoteBackLabel||_9e,i=t.options.footnoteLabel||"Footnotes",a=t.options.footnoteLabelTagName||"h2",s=t.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[l]);if(!u)continue;const c=t.all(u),d=String(u.identifier).toUpperCase(),h=G0(d.toLowerCase());let f=0;const m=[],x=t.footnoteCounts.get(d);for(;x!==void 0&&++f<=x;){m.length>0&&m.push({type:"text",value:" "});let w=typeof n=="string"?n:n(l,f);typeof w=="string"&&(w={type:"text",value:w}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+h+(f>1?"-"+f:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,f),className:["data-footnote-backref"]},children:Array.isArray(w)?w:[w]})}const b=c[c.length-1];if(b&&b.type==="element"&&b.tagName==="p"){const w=b.children[b.children.length-1];w&&w.type==="text"?w.value+=" ":b.children.push({type:"text",value:" "}),b.children.push(...m)}else c.push(...m);const y={type:"element",tagName:"li",properties:{id:e+"fn-"+h},children:t.wrap(c,!0)};t.patch(u,y),o.push(y)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...E0(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(o,!0)},{type:"text",value:`
`}]}}const Pv=(function(t){if(t==null)return C9e;if(typeof t=="function")return g3(t);if(typeof t=="object")return Array.isArray(t)?S9e(t):E9e(t);if(typeof t=="string")return T9e(t);throw new Error("Expected function, string, or object as test")});function S9e(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=Pv(t[n]);return g3(r);function r(...i){let a=-1;for(;++a<e.length;)if(e[a].apply(this,i))return!0;return!1}}function E9e(t){const e=t;return g3(n);function n(r){const i=r;let a;for(a in t)if(i[a]!==e[a])return!1;return!0}}function T9e(t){return g3(e);function e(n){return n&&n.type===t}}function g3(t){return e;function e(n,r,i){return!!(M9e(n)&&t.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function C9e(){return!0}function M9e(t){return t!==null&&typeof t=="object"&&"type"in t}const dre=[],A9e=!0,FI=!1,hre="skip";function PR(t,e,n,r){let i;typeof e=="function"&&typeof n!="function"?(r=n,n=e):i=e;const a=Pv(i),s=r?-1:1;o(t,void 0,[])();function o(l,u,c){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const f=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(f?"<"+f+">":""))+")"})}return h;function h(){let f=dre,m,x,b;if((!e||a(l,u,c[c.length-1]||void 0))&&(f=k9e(n(l,c)),f[0]===FI))return f;if("children"in l&&l.children){const y=l;if(y.children&&f[0]!==hre)for(x=(r?y.children.length:-1)+s,b=c.concat(y);x>-1&&x<y.children.length;){const w=y.children[x];if(m=o(w,x,b)(),m[0]===FI)return m;x=typeof m[1]=="number"?m[1]:x+s}}return f}}}function k9e(t){return Array.isArray(t)?t:typeof t=="number"?[A9e,t]:t==null?dre:[t]}function v3(t,e,n,r){let i,a,s;typeof e=="function"&&typeof n!="function"?(a=void 0,s=e,i=n):(a=e,s=n,i=r),PR(t,a,o,i);function o(l,u){const c=u[u.length-1],d=c?c.children.indexOf(l):void 0;return s(l,d,c)}}const BI={}.hasOwnProperty,I9e={};function N9e(t,e){const n=e||I9e,r=new Map,i=new Map,a=new Map,s={...m9e,...n.handlers},o={all:u,applyData:P9e,definitionById:r,footnoteById:i,footnoteCounts:a,footnoteOrder:[],handlers:s,one:l,options:n,patch:R9e,wrap:O9e};return v3(t,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?r:i,h=String(c.identifier).toUpperCase();d.has(h)||d.set(h,c)}}),o;function l(c,d){const h=c.type,f=o.handlers[h];if(BI.call(o.handlers,h)&&f)return f(o,c,d);if(o.options.passThrough&&o.options.passThrough.includes(h)){if("children"in c){const{children:x,...b}=c,y=E0(b);return y.children=o.all(c),y}return E0(c)}return(o.options.unknownHandler||D9e)(o,c,d)}function u(c){const d=[];if("children"in c){const h=c.children;let f=-1;for(;++f<h.length;){const m=o.one(h[f],c);if(m){if(f&&h[f-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=vz(m.value)),!Array.isArray(m)&&m.type==="element")){const x=m.children[0];x&&x.type==="text"&&(x.value=vz(x.value))}Array.isArray(m)?d.push(...m):d.push(m)}}}return d}}function R9e(t,e){t.position&&(e.position=_7e(t))}function P9e(t,e){let n=e;if(t&&t.data){const r=t.data.hName,i=t.data.hChildren,a=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const s="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:s}}n.type==="element"&&a&&Object.assign(n.properties,E0(a)),"children"in n&&n.children&&i!==null&&i!==void 0&&(n.children=i)}return n}function D9e(t,e){const n=e.data||{},r="value"in e&&!(BI.call(n,"hProperties")||BI.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function O9e(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function vz(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function yz(t,e){const n=N9e(t,e),r=n.one(t,void 0),i=w9e(n),a=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&a.children.push({type:"text",value:`
`},i),a}function L9e(t,e){return t&&"run"in t?async function(n,r){const i=yz(n,{file:r,...e});await t.run(i,r)}:function(n,r){return yz(n,{file:r,...t||e})}}function xz(t){if(t)throw t}var fT,bz;function F9e(){if(bz)return fT;bz=1;var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=function(u){return typeof Array.isArray=="function"?Array.isArray(u):e.call(u)==="[object Array]"},a=function(u){if(!u||e.call(u)!=="[object Object]")return!1;var c=t.call(u,"constructor"),d=u.constructor&&u.constructor.prototype&&t.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!c&&!d)return!1;var h;for(h in u);return typeof h>"u"||t.call(u,h)},s=function(u,c){n&&c.name==="__proto__"?n(u,c.name,{enumerable:!0,configurable:!0,value:c.newValue,writable:!0}):u[c.name]=c.newValue},o=function(u,c){if(c==="__proto__")if(t.call(u,c)){if(r)return r(u,c).value}else return;return u[c]};return fT=function l(){var u,c,d,h,f,m,x=arguments[0],b=1,y=arguments.length,w=!1;for(typeof x=="boolean"&&(w=x,x=arguments[1]||{},b=2),(x==null||typeof x!="object"&&typeof x!="function")&&(x={});b<y;++b)if(u=arguments[b],u!=null)for(c in u)d=o(x,c),h=o(u,c),x!==h&&(w&&h&&(a(h)||(f=i(h)))?(f?(f=!1,m=d&&i(d)?d:[]):m=d&&a(d)?d:{},s(x,{name:c,newValue:l(w,m,h)})):typeof h<"u"&&s(x,{name:c,newValue:h}));return x},fT}var B9e=F9e();const pT=pv(B9e);function UI(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function U9e(){const t=[],e={run:n,use:r};return e;function n(...i){let a=-1;const s=i.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);o(null,...i);function o(l,...u){const c=t[++a];let d=-1;if(l){s(l);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,c?z9e(c,o)(...u):s(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return t.push(i),e}}function z9e(t,e){let n;return r;function r(...s){const o=t.length>s.length;let l;o&&s.push(i);try{l=t.apply(this,s)}catch(u){const c=u;if(o&&n)throw c;return i(c)}o||(l&&l.then&&typeof l.then=="function"?l.then(a,i):l instanceof Error?i(l):a(l))}function i(s,...o){n||(n=!0,e(s,...o))}function a(s){i(null,s)}}const Tl={basename:j9e,dirname:H9e,extname:$9e,join:V9e,sep:"/"};function j9e(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Dv(t);let n=0,r=-1,i=t.length,a;if(e===void 0||e.length===0||e.length>t.length){for(;i--;)if(t.codePointAt(i)===47){if(a){n=i+1;break}}else r<0&&(a=!0,r=i+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let s=-1,o=e.length-1;for(;i--;)if(t.codePointAt(i)===47){if(a){n=i+1;break}}else s<0&&(a=!0,s=i+1),o>-1&&(t.codePointAt(i)===e.codePointAt(o--)?o<0&&(r=i):(o=-1,r=s));return n===r?r=s:r<0&&(r=t.length),t.slice(n,r)}function H9e(t){if(Dv(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function $9e(t){Dv(t);let e=t.length,n=-1,r=0,i=-1,a=0,s;for(;e--;){const o=t.codePointAt(e);if(o===47){if(s){r=e+1;break}continue}n<0&&(s=!0,n=e+1),o===46?i<0?i=e:a!==1&&(a=1):i>-1&&(a=-1)}return i<0||n<0||a===0||a===1&&i===n-1&&i===r+1?"":t.slice(i,n)}function V9e(...t){let e=-1,n;for(;++e<t.length;)Dv(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":q9e(n)}function q9e(t){Dv(t);const e=t.codePointAt(0)===47;let n=G9e(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function G9e(t,e){let n="",r=0,i=-1,a=0,s=-1,o,l;for(;++s<=t.length;){if(s<t.length)o=t.codePointAt(s);else{if(o===47)break;o=47}if(o===47){if(!(i===s-1||a===1))if(i!==s-1&&a===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=s,a=0;continue}}else if(n.length>0){n="",r=0,i=s,a=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(i+1,s):n=t.slice(i+1,s),r=s-i-1;i=s,a=0}else o===46&&a>-1?a++:a=-1}return n}function Dv(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const W9e={cwd:Y9e};function Y9e(){return"/"}function zI(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function X9e(t){if(typeof t=="string")t=new URL(t);else if(!zI(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return K9e(t)}function K9e(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const mT=["history","path","basename","stem","extname","dirname"];class fre{constructor(e){let n;e?zI(e)?n={path:e}:typeof e=="string"||Z9e(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":W9e.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<mT.length;){const a=mT[r];a in n&&n[a]!==void 0&&n[a]!==null&&(this[a]=a==="history"?[...n[a]]:n[a])}let i;for(i in n)mT.includes(i)||(this[i]=n[i])}get basename(){return typeof this.path=="string"?Tl.basename(this.path):void 0}set basename(e){vT(e,"basename"),gT(e,"basename"),this.path=Tl.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?Tl.dirname(this.path):void 0}set dirname(e){_z(this.basename,"dirname"),this.path=Tl.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?Tl.extname(this.path):void 0}set extname(e){if(gT(e,"extname"),_z(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Tl.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){zI(e)&&(e=X9e(e)),vT(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?Tl.basename(this.path,this.extname):void 0}set stem(e){vT(e,"stem"),gT(e,"stem"),this.path=Tl.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const i=this.message(e,n,r);throw i.fatal=!0,i}info(e,n,r){const i=this.message(e,n,r);return i.fatal=void 0,i}message(e,n,r){const i=new za(e,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function gT(t,e){if(t&&t.includes(Tl.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+Tl.sep+"`")}function vT(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function _z(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Z9e(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const J9e=(function(t){const r=this.constructor.prototype,i=r[t],a=function(){return i.apply(a,arguments)};return Object.setPrototypeOf(a,r),a}),Q9e={}.hasOwnProperty;class DR extends J9e{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=U9e()}copy(){const e=new DR;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(pT(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(bT("data",this.frozen),this.namespace[e]=n,this):Q9e.call(this.namespace,e)&&this.namespace[e]||void 0:e?(bT("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=n.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=sb(e),r=this.parser||this.Parser;return yT("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),yT("process",this.parser||this.Parser),xT("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(a,s){const o=sb(e),l=r.parse(o);r.run(l,o,function(c,d,h){if(c||!d||!h)return u(c);const f=d,m=r.stringify(f,h);nOe(m)?h.value=m:h.result=m,u(c,h)});function u(c,d){c||!d?s(c):a?a(d):n(void 0,d)}}}processSync(e){let n=!1,r;return this.freeze(),yT("processSync",this.parser||this.Parser),xT("processSync",this.compiler||this.Compiler),this.process(e,i),Sz("processSync","process",n),r;function i(a,s){n=!0,xz(a),r=s}}run(e,n,r){wz(e),this.freeze();const i=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?a(void 0,r):new Promise(a);function a(s,o){const l=sb(n);i.run(e,l,u);function u(c,d,h){const f=d||e;c?o(c):s?s(f):r(void 0,f,h)}}}runSync(e,n){let r=!1,i;return this.run(e,n,a),Sz("runSync","run",r),i;function a(s,o){xz(s),i=o,r=!0}}stringify(e,n){this.freeze();const r=sb(n),i=this.compiler||this.Compiler;return xT("stringify",i),wz(e),i(e,r)}use(e,...n){const r=this.attachers,i=this.namespace;if(bT("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?o(e):s(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function a(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;l(c,d)}else s(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function s(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(i.settings=pT(!0,i.settings,u.settings))}function o(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];a(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,c){let d=-1,h=-1;for(;++d<r.length;)if(r[d][0]===u){h=d;break}if(h===-1)r.push([u,...c]);else if(c.length>0){let[f,...m]=c;const x=r[h][1];UI(x)&&UI(f)&&(f=pT(!0,x,f)),r[h]=[u,f,...m]}}}}const eOe=new DR().freeze();function yT(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function xT(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function bT(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function wz(t){if(!UI(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Sz(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function sb(t){return tOe(t)?t:new fre(t)}function tOe(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function nOe(t){return typeof t=="string"||rOe(t)}function rOe(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const iOe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Ez=[],Tz={allowDangerousHtml:!0},aOe=/^(https?|ircs?|mailto|xmpp)$/i,sOe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function pre(t){const e=oOe(t),n=lOe(t);return uOe(e.runSync(e.parse(n),n),t)}function oOe(t){const e=t.rehypePlugins||Ez,n=t.remarkPlugins||Ez,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...Tz}:Tz;return eOe().use($De).use(n).use(L9e,r).use(e)}function lOe(t){const e=t.children||"",n=new fre;return typeof e=="string"&&(n.value=e),n}function uOe(t,e){const n=e.allowedElements,r=e.allowElement,i=e.components,a=e.disallowedElements,s=e.skipHtml,o=e.unwrapDisallowed,l=e.urlTransform||cOe;for(const c of sOe)Object.hasOwn(e,c.from)&&(""+c.from+(c.to?"use `"+c.to+"` instead":"remove it")+iOe+c.id,void 0);return v3(t,u),C7e(t,{Fragment:g.Fragment,components:i,ignoreInvalidStyle:!0,jsx:g.jsx,jsxs:g.jsxs,passKeys:!0,passNode:!0});function u(c,d,h){if(c.type==="raw"&&h&&typeof d=="number")return s?h.children.splice(d,1):h.children[d]={type:"text",value:c.value},d;if(c.type==="element"){let f;for(f in cT)if(Object.hasOwn(cT,f)&&Object.hasOwn(c.properties,f)){const m=c.properties[f],x=cT[f];(x===null||x.includes(c.tagName))&&(c.properties[f]=l(String(m||""),f,c))}}if(c.type==="element"){let f=n?!n.includes(c.tagName):a?a.includes(c.tagName):!1;if(!f&&r&&typeof d=="number"&&(f=!r(c,d,h)),f&&h&&typeof d=="number")return o&&c.children?h.children.splice(d,1,...c.children):h.children.splice(d,1),d}}}function cOe(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),i=t.indexOf("/");return e===-1||i!==-1&&e>i||n!==-1&&e>n||r!==-1&&e>r||aOe.test(t.slice(0,e))?t:""}function Cz(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let r=0,i=n.indexOf(e);for(;i!==-1;)r++,i=n.indexOf(e,i+e.length);return r}function dOe(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function mre(t,e,n){const i=Pv((n||{}).ignore||[]),a=hOe(e);let s=-1;for(;++s<a.length;)PR(t,"text",o);function o(u,c){let d=-1,h;for(;++d<c.length;){const f=c[d],m=h?h.children:void 0;if(i(f,m?m.indexOf(f):void 0,h))return;h=f}if(h)return l(u,c)}function l(u,c){const d=c[c.length-1],h=a[s][0],f=a[s][1];let m=0;const b=d.children.indexOf(u);let y=!1,w=[];h.lastIndex=0;let _=h.exec(u.value);for(;_;){const S=_.index,M={index:_.index,input:_.input,stack:[...c,u]};let E=f(..._,M);if(typeof E=="string"&&(E=E.length>0?{type:"text",value:E}:void 0),E===!1?h.lastIndex=S+1:(m!==S&&w.push({type:"text",value:u.value.slice(m,S)}),Array.isArray(E)?w.push(...E):E&&w.push(E),m=S+_[0].length,y=!0),!h.global)break;_=h.exec(u.value)}return y?(m<u.value.length&&w.push({type:"text",value:u.value.slice(m)}),d.children.splice(b,1,...w)):w=[u],b+w.length}}function hOe(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const i=n[r];e.push([fOe(i[0]),pOe(i[1])])}return e}function fOe(t){return typeof t=="string"?new RegExp(dOe(t),"g"):t}function pOe(t){return typeof t=="function"?t:function(){return t}}const _T="phrasing",wT=["autolink","link","image","label"];function mOe(){return{transforms:[wOe],enter:{literalAutolink:vOe,literalAutolinkEmail:ST,literalAutolinkHttp:ST,literalAutolinkWww:ST},exit:{literalAutolink:_Oe,literalAutolinkEmail:bOe,literalAutolinkHttp:yOe,literalAutolinkWww:xOe}}}function gOe(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:_T,notInConstruct:wT},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:_T,notInConstruct:wT},{character:":",before:"[ps]",after:"\\/",inConstruct:_T,notInConstruct:wT}]}}function vOe(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function ST(t){this.config.enter.autolinkProtocol.call(this,t)}function yOe(t){this.config.exit.autolinkProtocol.call(this,t)}function xOe(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function bOe(t){this.config.exit.autolinkEmail.call(this,t)}function _Oe(t){this.exit(t)}function wOe(t){mre(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,SOe],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,EOe]],{ignore:["link","linkReference"]})}function SOe(t,e,n,r,i){let a="";if(!gre(i)||(/^w/i.test(e)&&(n=e+n,e="",a="http://"),!TOe(n)))return!1;const s=COe(n+r);if(!s[0])return!1;const o={type:"link",title:null,url:a+e+s[0],children:[{type:"text",value:e+s[0]}]};return s[1]?[o,{type:"text",value:s[1]}]:o}function EOe(t,e,n,r){return!gre(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function TOe(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function COe(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],r=n.indexOf(")");const i=Cz(t,"(");let a=Cz(t,")");for(;r!==-1&&i>a;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),a++;return[t,n]}function gre(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||af(n)||f3(n))&&(!e||n!==47)}vre.peek=OOe;function MOe(){this.buffer()}function AOe(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function kOe(){this.buffer()}function IOe(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function NOe(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=nl(this.sliceSerialize(t)).toLowerCase(),n.label=e}function ROe(t){this.exit(t)}function POe(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=nl(this.sliceSerialize(t)).toLowerCase(),n.label=e}function DOe(t){this.exit(t)}function OOe(){return"["}function vre(t,e,n,r){const i=n.createTracker(r);let a=i.move("[^");const s=n.enter("footnoteReference"),o=n.enter("reference");return a+=i.move(n.safe(n.associationId(t),{after:"]",before:a})),o(),s(),a+=i.move("]"),a}function LOe(){return{enter:{gfmFootnoteCallString:MOe,gfmFootnoteCall:AOe,gfmFootnoteDefinitionLabelString:kOe,gfmFootnoteDefinition:IOe},exit:{gfmFootnoteCallString:NOe,gfmFootnoteCall:ROe,gfmFootnoteDefinitionLabelString:POe,gfmFootnoteDefinition:DOe}}}function FOe(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:n,footnoteReference:vre},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(r,i,a,s){const o=a.createTracker(s);let l=o.move("[^");const u=a.enter("footnoteDefinition"),c=a.enter("label");return l+=o.move(a.safe(a.associationId(r),{before:l,after:"]"})),c(),l+=o.move("]:"),r.children&&r.children.length>0&&(o.shift(4),l+=o.move((e?`
`:" ")+a.indentLines(a.containerFlow(r,o.current()),e?yre:BOe))),u(),l}}function BOe(t,e,n){return e===0?t:yre(t,e,n)}function yre(t,e,n){return(n?"":"    ")+t}const UOe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];xre.peek=VOe;function zOe(){return{canContainEols:["delete"],enter:{strikethrough:HOe},exit:{strikethrough:$Oe}}}function jOe(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:UOe}],handlers:{delete:xre}}}function HOe(t){this.enter({type:"delete",children:[]},t)}function $Oe(t){this.exit(t)}function xre(t,e,n,r){const i=n.createTracker(r),a=n.enter("strikethrough");let s=i.move("~~");return s+=n.containerPhrasing(t,{...i.current(),before:s,after:"~"}),s+=i.move("~~"),a(),s}function VOe(){return"~"}function qOe(t){return t.length}function GOe(t,e){const n=e||{},r=(n.align||[]).concat(),i=n.stringLength||qOe,a=[],s=[],o=[],l=[];let u=0,c=-1;for(;++c<t.length;){const x=[],b=[];let y=-1;for(t[c].length>u&&(u=t[c].length);++y<t[c].length;){const w=WOe(t[c][y]);if(n.alignDelimiters!==!1){const _=i(w);b[y]=_,(l[y]===void 0||_>l[y])&&(l[y]=_)}x.push(w)}s[c]=x,o[c]=b}let d=-1;if(typeof r=="object"&&"length"in r)for(;++d<u;)a[d]=Mz(r[d]);else{const x=Mz(r);for(;++d<u;)a[d]=x}d=-1;const h=[],f=[];for(;++d<u;){const x=a[d];let b="",y="";x===99?(b=":",y=":"):x===108?b=":":x===114&&(y=":");let w=n.alignDelimiters===!1?1:Math.max(1,l[d]-b.length-y.length);const _=b+"-".repeat(w)+y;n.alignDelimiters!==!1&&(w=b.length+w+y.length,w>l[d]&&(l[d]=w),f[d]=w),h[d]=_}s.splice(1,0,h),o.splice(1,0,f),c=-1;const m=[];for(;++c<s.length;){const x=s[c],b=o[c];d=-1;const y=[];for(;++d<u;){const w=x[d]||"";let _="",S="";if(n.alignDelimiters!==!1){const M=l[d]-(b[d]||0),E=a[d];E===114?_=" ".repeat(M):E===99?M%2?(_=" ".repeat(M/2+.5),S=" ".repeat(M/2-.5)):(_=" ".repeat(M/2),S=_):S=" ".repeat(M)}n.delimiterStart!==!1&&!d&&y.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&w==="")&&(n.delimiterStart!==!1||d)&&y.push(" "),n.alignDelimiters!==!1&&y.push(_),y.push(w),n.alignDelimiters!==!1&&y.push(S),n.padding!==!1&&y.push(" "),(n.delimiterEnd!==!1||d!==u-1)&&y.push("|")}m.push(n.delimiterEnd===!1?y.join("").replace(/ +$/,""):y.join(""))}return m.join(`
`)}function WOe(t){return t==null?"":String(t)}function Mz(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}const Az={}.hasOwnProperty;function bre(t,e){const n=e||{};function r(i,...a){let s=r.invalid;const o=r.handlers;if(i&&Az.call(i,t)){const l=String(i[t]);s=Az.call(o,l)?o[l]:r.unknown}if(s)return s.call(this,i,...a)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}function YOe(t,e,n,r){const i=n.enter("blockquote"),a=n.createTracker(r);a.move("> "),a.shift(2);const s=n.indentLines(n.containerFlow(t,a.current()),XOe);return i(),s}function XOe(t,e,n){return">"+(n?"":" ")+t}function KOe(t,e){return kz(t,e.inConstruct,!0)&&!kz(t,e.notInConstruct,!1)}function kz(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let r=-1;for(;++r<e.length;)if(t.includes(e[r]))return!0;return!1}function Iz(t,e,n,r){let i=-1;for(;++i<n.unsafe.length;)if(n.unsafe[i].character===`
`&&KOe(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function _re(t,e){const n=String(t);let r=n.indexOf(e),i=r,a=0,s=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===i?++a>s&&(s=a):a=1,i=r+e.length,r=n.indexOf(e,i);return s}function ZOe(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function JOe(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function QOe(t,e,n,r){const i=JOe(n),a=t.value||"",s=i==="`"?"GraveAccent":"Tilde";if(ZOe(t,n)){const d=n.enter("codeIndented"),h=n.indentLines(a,eLe);return d(),h}const o=n.createTracker(r),l=i.repeat(Math.max(_re(a,i)+1,3)),u=n.enter("codeFenced");let c=o.move(l);if(t.lang){const d=n.enter(`codeFencedLang${s}`);c+=o.move(n.safe(t.lang,{before:c,after:" ",encode:["`"],...o.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${s}`);c+=o.move(" "),c+=o.move(n.safe(t.meta,{before:c,after:`
`,encode:["`"],...o.current()})),d()}return c+=o.move(`
`),a&&(c+=o.move(a+`
`)),c+=o.move(l),u(),c}function eLe(t,e,n){return(n?"":"    ")+t}function OR(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function tLe(t,e,n,r){const i=OR(n),a=i==='"'?"Quote":"Apostrophe",s=n.enter("definition");let o=n.enter("label");const l=n.createTracker(r);let u=l.move("[");return u+=l.move(n.safe(n.associationId(t),{before:u,after:"]",...l.current()})),u+=l.move("]: "),o(),!t.url||/[\0- \u007F]/.test(t.url)?(o=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":`
`,...l.current()}))),o(),t.title&&(o=n.enter(`title${a}`),u+=l.move(" "+i),u+=l.move(n.safe(t.title,{before:u,after:i,...l.current()})),u+=l.move(i),o()),s(),u}function nLe(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function G1(t){return"&#x"+t.toString(16).toUpperCase()+";"}function kw(t,e,n){const r=S0(t),i=S0(e);return r===void 0?i===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}wre.peek=rLe;function wre(t,e,n,r){const i=nLe(n),a=n.enter("emphasis"),s=n.createTracker(r),o=s.move(i);let l=s.move(n.containerPhrasing(t,{after:i,before:o,...s.current()}));const u=l.charCodeAt(0),c=kw(r.before.charCodeAt(r.before.length-1),u,i);c.inside&&(l=G1(u)+l.slice(1));const d=l.charCodeAt(l.length-1),h=kw(r.after.charCodeAt(0),d,i);h.inside&&(l=l.slice(0,-1)+G1(d));const f=s.move(i);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},o+l+f}function rLe(t,e,n){return n.options.emphasis||"*"}function iLe(t,e){let n=!1;return v3(t,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,FI}),!!((!t.depth||t.depth<3)&&CR(t)&&(e.options.setext||n))}function aLe(t,e,n,r){const i=Math.max(Math.min(6,t.depth||1),1),a=n.createTracker(r);if(iLe(t,n)){const c=n.enter("headingSetext"),d=n.enter("phrasing"),h=n.containerPhrasing(t,{...a.current(),before:`
`,after:`
`});return d(),c(),h+`
`+(i===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const s="#".repeat(i),o=n.enter("headingAtx"),l=n.enter("phrasing");a.move(s+" ");let u=n.containerPhrasing(t,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(u)&&(u=G1(u.charCodeAt(0))+u.slice(1)),u=u?s+" "+u:s,n.options.closeAtx&&(u+=" "+s),l(),o(),u}Sre.peek=sLe;function Sre(t){return t.value||""}function sLe(){return"<"}Ere.peek=oLe;function Ere(t,e,n,r){const i=OR(n),a=i==='"'?"Quote":"Apostrophe",s=n.enter("image");let o=n.enter("label");const l=n.createTracker(r);let u=l.move("![");return u+=l.move(n.safe(t.alt,{before:u,after:"]",...l.current()})),u+=l.move("]("),o(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(o=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(o=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":")",...l.current()}))),o(),t.title&&(o=n.enter(`title${a}`),u+=l.move(" "+i),u+=l.move(n.safe(t.title,{before:u,after:i,...l.current()})),u+=l.move(i),o()),u+=l.move(")"),s(),u}function oLe(){return"!"}Tre.peek=lLe;function Tre(t,e,n,r){const i=t.referenceType,a=n.enter("imageReference");let s=n.enter("label");const o=n.createTracker(r);let l=o.move("![");const u=n.safe(t.alt,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),s();const c=n.stack;n.stack=[],s=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...o.current()});return s(),n.stack=c,a(),i==="full"||!u||u!==d?l+=o.move(d+"]"):i==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function lLe(){return"!"}Cre.peek=uLe;function Cre(t,e,n){let r=t.value||"",i="`",a=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++a<n.unsafe.length;){const s=n.unsafe[a],o=n.compilePattern(s);let l;if(s.atBreak)for(;l=o.exec(r);){let u=l.index;r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(l.index+1)}}return i+r+i}function uLe(){return"`"}function Mre(t,e){const n=CR(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}Are.peek=cLe;function Are(t,e,n,r){const i=OR(n),a=i==='"'?"Quote":"Apostrophe",s=n.createTracker(r);let o,l;if(Mre(t,n)){const c=n.stack;n.stack=[],o=n.enter("autolink");let d=s.move("<");return d+=s.move(n.containerPhrasing(t,{before:d,after:">",...s.current()})),d+=s.move(">"),o(),n.stack=c,d}o=n.enter("link"),l=n.enter("label");let u=s.move("[");return u+=s.move(n.containerPhrasing(t,{before:u,after:"](",...s.current()})),u+=s.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),u+=s.move("<"),u+=s.move(n.safe(t.url,{before:u,after:">",...s.current()})),u+=s.move(">")):(l=n.enter("destinationRaw"),u+=s.move(n.safe(t.url,{before:u,after:t.title?" ":")",...s.current()}))),l(),t.title&&(l=n.enter(`title${a}`),u+=s.move(" "+i),u+=s.move(n.safe(t.title,{before:u,after:i,...s.current()})),u+=s.move(i),l()),u+=s.move(")"),o(),u}function cLe(t,e,n){return Mre(t,n)?"<":"["}kre.peek=dLe;function kre(t,e,n,r){const i=t.referenceType,a=n.enter("linkReference");let s=n.enter("label");const o=n.createTracker(r);let l=o.move("[");const u=n.containerPhrasing(t,{before:l,after:"]",...o.current()});l+=o.move(u+"]["),s();const c=n.stack;n.stack=[],s=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...o.current()});return s(),n.stack=c,a(),i==="full"||!u||u!==d?l+=o.move(d+"]"):i==="shortcut"?l=l.slice(0,-1):l+=o.move("]"),l}function dLe(){return"["}function LR(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function hLe(t){const e=LR(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function fLe(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function Ire(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function pLe(t,e,n,r){const i=n.enter("list"),a=n.bulletCurrent;let s=t.ordered?fLe(n):LR(n);const o=t.ordered?s==="."?")":".":hLe(n);let l=e&&n.bulletLastUsed?s===n.bulletLastUsed:!1;if(!t.ordered){const c=t.children?t.children[0]:void 0;if((s==="*"||s==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(l=!0),Ire(n)===s&&c){let d=-1;for(;++d<t.children.length;){const h=t.children[d];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(s=o),n.bulletCurrent=s;const u=n.containerFlow(t,r);return n.bulletLastUsed=s,n.bulletCurrent=a,i(),u}function mLe(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function gLe(t,e,n,r){const i=mLe(n);let a=n.bulletCurrent||LR(n);e&&e.type==="list"&&e.ordered&&(a=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+a);let s=a.length+1;(i==="tab"||i==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(s=Math.ceil(s/4)*4);const o=n.createTracker(r);o.move(a+" ".repeat(s-a.length)),o.shift(s);const l=n.enter("listItem"),u=n.indentLines(n.containerFlow(t,o.current()),c);return l(),u;function c(d,h,f){return h?(f?"":" ".repeat(s))+d:(f?a:a+" ".repeat(s-a.length))+d}}function vLe(t,e,n,r){const i=n.enter("paragraph"),a=n.enter("phrasing"),s=n.containerPhrasing(t,r);return a(),i(),s}const yLe=Pv(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function xLe(t,e,n,r){return(t.children.some(function(s){return yLe(s)})?n.containerPhrasing:n.containerFlow).call(n,t,r)}function bLe(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}Nre.peek=_Le;function Nre(t,e,n,r){const i=bLe(n),a=n.enter("strong"),s=n.createTracker(r),o=s.move(i+i);let l=s.move(n.containerPhrasing(t,{after:i,before:o,...s.current()}));const u=l.charCodeAt(0),c=kw(r.before.charCodeAt(r.before.length-1),u,i);c.inside&&(l=G1(u)+l.slice(1));const d=l.charCodeAt(l.length-1),h=kw(r.after.charCodeAt(0),d,i);h.inside&&(l=l.slice(0,-1)+G1(d));const f=s.move(i+i);return a(),n.attentionEncodeSurroundingInfo={after:h.outside,before:c.outside},o+l+f}function _Le(t,e,n){return n.options.strong||"*"}function wLe(t,e,n,r){return n.safe(t.value,r)}function SLe(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function ELe(t,e,n){const r=(Ire(n)+(n.options.ruleSpaces?" ":"")).repeat(SLe(n));return n.options.ruleSpaces?r.slice(0,-1):r}const Rre={blockquote:YOe,break:Iz,code:QOe,definition:tLe,emphasis:wre,hardBreak:Iz,heading:aLe,html:Sre,image:Ere,imageReference:Tre,inlineCode:Cre,link:Are,linkReference:kre,list:pLe,listItem:gLe,paragraph:vLe,root:xLe,strong:Nre,text:wLe,thematicBreak:ELe};function TLe(){return{enter:{table:CLe,tableData:Nz,tableHeader:Nz,tableRow:ALe},exit:{codeText:kLe,table:MLe,tableData:ET,tableHeader:ET,tableRow:ET}}}function CLe(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function MLe(t){this.exit(t),this.data.inTable=void 0}function ALe(t){this.enter({type:"tableRow",children:[]},t)}function ET(t){this.exit(t)}function Nz(t){this.enter({type:"tableCell",children:[]},t)}function kLe(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,ILe));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function ILe(t,e){return e==="|"?e:t}function NLe(t){const e=t||{},n=e.tableCellPadding,r=e.tablePipeAlign,i=e.stringLength,a=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:s,tableCell:l,tableRow:o}};function s(f,m,x,b){return u(c(f,x,b),f.align)}function o(f,m,x,b){const y=d(f,x,b),w=u([y]);return w.slice(0,w.indexOf(`
`))}function l(f,m,x,b){const y=x.enter("tableCell"),w=x.enter("phrasing"),_=x.containerPhrasing(f,{...b,before:a,after:a});return w(),y(),_}function u(f,m){return GOe(f,{align:m,alignDelimiters:r,padding:n,stringLength:i})}function c(f,m,x){const b=f.children;let y=-1;const w=[],_=m.enter("table");for(;++y<b.length;)w[y]=d(b[y],m,x);return _(),w}function d(f,m,x){const b=f.children;let y=-1;const w=[],_=m.enter("tableRow");for(;++y<b.length;)w[y]=l(b[y],f,m,x);return _(),w}function h(f,m,x){let b=Rre.inlineCode(f,m,x);return x.stack.includes("tableCell")&&(b=b.replace(/\|/g,"\\$&")),b}}function RLe(){return{exit:{taskListCheckValueChecked:Rz,taskListCheckValueUnchecked:Rz,paragraph:DLe}}}function PLe(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:OLe}}}function Rz(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function DLe(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const i=e.children;let a=-1,s;for(;++a<i.length;){const o=i[a];if(o.type==="paragraph"){s=o;break}}s===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(t)}function OLe(t,e,n,r){const i=t.children[0],a=typeof t.checked=="boolean"&&i&&i.type==="paragraph",s="["+(t.checked?"x":" ")+"] ",o=n.createTracker(r);a&&o.move(s);let l=Rre.listItem(t,e,n,{...r,...o.current()});return a&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),l;function u(c){return c+s}}function LLe(){return[mOe(),LOe(),zOe(),TLe(),RLe()]}function FLe(t){return{extensions:[gOe(),FOe(t),jOe(),NLe(t),PLe()]}}const BLe={tokenize:VLe,partial:!0},Pre={tokenize:qLe,partial:!0},Dre={tokenize:GLe,partial:!0},Ore={tokenize:WLe,partial:!0},ULe={tokenize:YLe,partial:!0},Lre={name:"wwwAutolink",tokenize:HLe,previous:Bre},Fre={name:"protocolAutolink",tokenize:$Le,previous:Ure},Ku={name:"emailAutolink",tokenize:jLe,previous:zre},Kl={};function zLe(){return{text:Kl}}let uh=48;for(;uh<123;)Kl[uh]=Ku,uh++,uh===58?uh=65:uh===91&&(uh=97);Kl[43]=Ku;Kl[45]=Ku;Kl[46]=Ku;Kl[95]=Ku;Kl[72]=[Ku,Fre];Kl[104]=[Ku,Fre];Kl[87]=[Ku,Lre];Kl[119]=[Ku,Lre];function jLe(t,e,n){const r=this;let i,a;return s;function s(d){return!jI(d)||!zre.call(r,r.previous)||FR(r.events)?n(d):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),o(d))}function o(d){return jI(d)?(t.consume(d),o):d===64?(t.consume(d),l):n(d)}function l(d){return d===46?t.check(ULe,c,u)(d):d===45||d===95||Oa(d)?(a=!0,t.consume(d),l):c(d)}function u(d){return t.consume(d),i=!0,l}function c(d){return a&&i&&Ja(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(d)):n(d)}}function HLe(t,e,n){const r=this;return i;function i(s){return s!==87&&s!==119||!Bre.call(r,r.previous)||FR(r.events)?n(s):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(BLe,t.attempt(Pre,t.attempt(Dre,a),n),n)(s))}function a(s){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(s)}}function $Le(t,e,n){const r=this;let i="",a=!1;return s;function s(d){return(d===72||d===104)&&Ure.call(r,r.previous)&&!FR(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),i+=String.fromCodePoint(d),t.consume(d),o):n(d)}function o(d){if(Ja(d)&&i.length<5)return i+=String.fromCodePoint(d),t.consume(d),o;if(d===58){const h=i.toLowerCase();if(h==="http"||h==="https")return t.consume(d),l}return n(d)}function l(d){return d===47?(t.consume(d),a?u:(a=!0,l)):n(d)}function u(d){return d===null||Mw(d)||Dr(d)||af(d)||f3(d)?n(d):t.attempt(Pre,t.attempt(Dre,c),n)(d)}function c(d){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(d)}}function VLe(t,e,n){let r=0;return i;function i(s){return(s===87||s===119)&&r<3?(r++,t.consume(s),i):s===46&&r===3?(t.consume(s),a):n(s)}function a(s){return s===null?n(s):e(s)}}function qLe(t,e,n){let r,i,a;return s;function s(u){return u===46||u===95?t.check(Ore,l,o)(u):u===null||Dr(u)||af(u)||u!==45&&f3(u)?l(u):(a=!0,t.consume(u),s)}function o(u){return u===95?r=!0:(i=r,r=void 0),t.consume(u),s}function l(u){return i||r||!a?n(u):e(u)}}function GLe(t,e){let n=0,r=0;return i;function i(s){return s===40?(n++,t.consume(s),i):s===41&&r<n?a(s):s===33||s===34||s===38||s===39||s===41||s===42||s===44||s===46||s===58||s===59||s===60||s===63||s===93||s===95||s===126?t.check(Ore,e,a)(s):s===null||Dr(s)||af(s)?e(s):(t.consume(s),i)}function a(s){return s===41&&r++,t.consume(s),i}}function WLe(t,e,n){return r;function r(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(t.consume(o),r):o===38?(t.consume(o),a):o===93?(t.consume(o),i):o===60||o===null||Dr(o)||af(o)?e(o):n(o)}function i(o){return o===null||o===40||o===91||Dr(o)||af(o)?e(o):r(o)}function a(o){return Ja(o)?s(o):n(o)}function s(o){return o===59?(t.consume(o),r):Ja(o)?(t.consume(o),s):n(o)}}function YLe(t,e,n){return r;function r(a){return t.consume(a),i}function i(a){return Oa(a)?n(a):e(a)}}function Bre(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Dr(t)}function Ure(t){return!Ja(t)}function zre(t){return!(t===47||jI(t))}function jI(t){return t===43||t===45||t===46||t===95||Oa(t)}function FR(t){let e=t.length,n=!1;for(;e--;){const r=t[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const XLe={tokenize:rFe,partial:!0};function KLe(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:eFe,continuation:{tokenize:tFe},exit:nFe}},text:{91:{name:"gfmFootnoteCall",tokenize:QLe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:ZLe,resolveTo:JLe}}}}function ZLe(t,e,n){const r=this;let i=r.events.length;const a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s;for(;i--;){const l=r.events[i][1];if(l.type==="labelImage"){s=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return o;function o(l){if(!s||!s._balanced)return n(l);const u=nl(r.sliceSerialize({start:s.end,end:r.now()}));return u.codePointAt(0)!==94||!a.includes(u.slice(1))?n(l):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),e(l))}}function JLe(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const a={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},t[t.length-1][1].start)},s={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},o=[t[n+1],t[n+2],["enter",r,e],t[n+3],t[n+4],["enter",i,e],["exit",i,e],["enter",a,e],["enter",s,e],["exit",s,e],["exit",a,e],t[t.length-2],t[t.length-1],["exit",r,e]];return t.splice(n,t.length-n+1,...o),t}function QLe(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let a=0,s;return o;function o(d){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),l}function l(d){return d!==94?n(d):(t.enter("gfmFootnoteCallMarker"),t.consume(d),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",u)}function u(d){if(a>999||d===93&&!s||d===null||d===91||Dr(d))return n(d);if(d===93){t.exit("chunkString");const h=t.exit("gfmFootnoteCallString");return i.includes(nl(r.sliceSerialize(h)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(d)}return Dr(d)||(s=!0),a++,t.consume(d),d===92?c:u}function c(d){return d===91||d===92||d===93?(t.consume(d),a++,u):u(d)}}function eFe(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let a,s=0,o;return l;function l(m){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(m){return m===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",c):n(m)}function c(m){if(s>999||m===93&&!o||m===null||m===91||Dr(m))return n(m);if(m===93){t.exit("chunkString");const x=t.exit("gfmFootnoteDefinitionLabelString");return a=nl(r.sliceSerialize(x)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),h}return Dr(m)||(o=!0),s++,t.consume(m),m===92?d:c}function d(m){return m===91||m===92||m===93?(t.consume(m),s++,c):c(m)}function h(m){return m===58?(t.enter("definitionMarker"),t.consume(m),t.exit("definitionMarker"),i.includes(a)||i.push(a),Un(t,f,"gfmFootnoteDefinitionWhitespace")):n(m)}function f(m){return e(m)}}function tFe(t,e,n){return t.check(Rv,e,t.attempt(XLe,e,n))}function nFe(t){t.exit("gfmFootnoteDefinition")}function rFe(t,e,n){const r=this;return Un(t,i,"gfmFootnoteDefinitionIndent",5);function i(a){const s=r.events[r.events.length-1];return s&&s[1].type==="gfmFootnoteDefinitionIndent"&&s[2].sliceSerialize(s[1],!0).length===4?e(a):n(a)}}function iFe(t){let n=(t||{}).singleTilde;const r={name:"strikethrough",tokenize:a,resolveAll:i};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function i(s,o){let l=-1;for(;++l<s.length;)if(s[l][0]==="enter"&&s[l][1].type==="strikethroughSequenceTemporary"&&s[l][1]._close){let u=l;for(;u--;)if(s[u][0]==="exit"&&s[u][1].type==="strikethroughSequenceTemporary"&&s[u][1]._open&&s[l][1].end.offset-s[l][1].start.offset===s[u][1].end.offset-s[u][1].start.offset){s[l][1].type="strikethroughSequence",s[u][1].type="strikethroughSequence";const c={type:"strikethrough",start:Object.assign({},s[u][1].start),end:Object.assign({},s[l][1].end)},d={type:"strikethroughText",start:Object.assign({},s[u][1].end),end:Object.assign({},s[l][1].start)},h=[["enter",c,o],["enter",s[u][1],o],["exit",s[u][1],o],["enter",d,o]],f=o.parser.constructs.insideSpan.null;f&&Xs(h,h.length,0,p3(f,s.slice(u+1,l),o)),Xs(h,h.length,0,[["exit",d,o],["enter",s[l][1],o],["exit",s[l][1],o],["exit",c,o]]),Xs(s,u-1,l-u+3,h),l=u+h.length-2;break}}for(l=-1;++l<s.length;)s[l][1].type==="strikethroughSequenceTemporary"&&(s[l][1].type="data");return s}function a(s,o,l){const u=this.previous,c=this.events;let d=0;return h;function h(m){return u===126&&c[c.length-1][1].type!=="characterEscape"?l(m):(s.enter("strikethroughSequenceTemporary"),f(m))}function f(m){const x=S0(u);if(m===126)return d>1?l(m):(s.consume(m),d++,f);if(d<2&&!n)return l(m);const b=s.exit("strikethroughSequenceTemporary"),y=S0(m);return b._open=!y||y===2&&!!x,b._close=!x||x===2&&!!y,o(m)}}}class aFe{constructor(){this.map=[]}add(e,n,r){sFe(this,e,n,r)}consume(e){if(this.map.sort(function(a,s){return a[0]-s[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];r.push(e.slice()),e.length=0;let i=r.pop();for(;i;){for(const a of i)e.push(a);i=r.pop()}this.map.length=0}}function sFe(t,e,n,r){let i=0;if(!(n===0&&r.length===0)){for(;i<t.map.length;){if(t.map[i][0]===e){t.map[i][1]+=n,t.map[i][2].push(...r);return}i+=1}t.map.push([e,n,r])}}function oFe(t,e){let n=!1;const r=[];for(;e<t.length;){const i=t[e];if(n){if(i[0]==="enter")i[1].type==="tableContent"&&r.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(i[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const a=r.length-1;r[a]=r[a]==="left"?"center":"right"}}else if(i[1].type==="tableDelimiterRow")break}else i[0]==="enter"&&i[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return r}function lFe(){return{flow:{null:{name:"table",tokenize:uFe,resolveAll:cFe}}}}function uFe(t,e,n){const r=this;let i=0,a=0,s;return o;function o(I){let N=r.events.length-1;for(;N>-1;){const L=r.events[N][1].type;if(L==="lineEnding"||L==="linePrefix")N--;else break}const D=N>-1?r.events[N][1].type:null,F=D==="tableHead"||D==="tableRow"?E:l;return F===E&&r.parser.lazy[r.now().line]?n(I):F(I)}function l(I){return t.enter("tableHead"),t.enter("tableRow"),u(I)}function u(I){return I===124||(s=!0,a+=1),c(I)}function c(I){return I===null?n(I):en(I)?a>1?(a=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(I),t.exit("lineEnding"),f):n(I):Vn(I)?Un(t,c,"whitespace")(I):(a+=1,s&&(s=!1,i+=1),I===124?(t.enter("tableCellDivider"),t.consume(I),t.exit("tableCellDivider"),s=!0,c):(t.enter("data"),d(I)))}function d(I){return I===null||I===124||Dr(I)?(t.exit("data"),c(I)):(t.consume(I),I===92?h:d)}function h(I){return I===92||I===124?(t.consume(I),d):d(I)}function f(I){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(I):(t.enter("tableDelimiterRow"),s=!1,Vn(I)?Un(t,m,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(I):m(I))}function m(I){return I===45||I===58?b(I):I===124?(s=!0,t.enter("tableCellDivider"),t.consume(I),t.exit("tableCellDivider"),x):M(I)}function x(I){return Vn(I)?Un(t,b,"whitespace")(I):b(I)}function b(I){return I===58?(a+=1,s=!0,t.enter("tableDelimiterMarker"),t.consume(I),t.exit("tableDelimiterMarker"),y):I===45?(a+=1,y(I)):I===null||en(I)?S(I):M(I)}function y(I){return I===45?(t.enter("tableDelimiterFiller"),w(I)):M(I)}function w(I){return I===45?(t.consume(I),w):I===58?(s=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(I),t.exit("tableDelimiterMarker"),_):(t.exit("tableDelimiterFiller"),_(I))}function _(I){return Vn(I)?Un(t,S,"whitespace")(I):S(I)}function S(I){return I===124?m(I):I===null||en(I)?!s||i!==a?M(I):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(I)):M(I)}function M(I){return n(I)}function E(I){return t.enter("tableRow"),C(I)}function C(I){return I===124?(t.enter("tableCellDivider"),t.consume(I),t.exit("tableCellDivider"),C):I===null||en(I)?(t.exit("tableRow"),e(I)):Vn(I)?Un(t,C,"whitespace")(I):(t.enter("data"),R(I))}function R(I){return I===null||I===124||Dr(I)?(t.exit("data"),C(I)):(t.consume(I),I===92?k:R)}function k(I){return I===92||I===124?(t.consume(I),R):R(I)}}function cFe(t,e){let n=-1,r=!0,i=0,a=[0,0,0,0],s=[0,0,0,0],o=!1,l=0,u,c,d;const h=new aFe;for(;++n<t.length;){const f=t[n],m=f[1];f[0]==="enter"?m.type==="tableHead"?(o=!1,l!==0&&(Pz(h,e,l,u,c),c=void 0,l=0),u={type:"table",start:Object.assign({},m.start),end:Object.assign({},m.end)},h.add(n,0,[["enter",u,e]])):m.type==="tableRow"||m.type==="tableDelimiterRow"?(r=!0,d=void 0,a=[0,0,0,0],s=[0,n+1,0,0],o&&(o=!1,c={type:"tableBody",start:Object.assign({},m.start),end:Object.assign({},m.end)},h.add(n,0,[["enter",c,e]])),i=m.type==="tableDelimiterRow"?2:c?3:1):i&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")?(r=!1,s[2]===0&&(a[1]!==0&&(s[0]=s[1],d=ob(h,e,a,i,void 0,d),a=[0,0,0,0]),s[2]=n)):m.type==="tableCellDivider"&&(r?r=!1:(a[1]!==0&&(s[0]=s[1],d=ob(h,e,a,i,void 0,d)),a=s,s=[a[1],n,0,0])):m.type==="tableHead"?(o=!0,l=n):m.type==="tableRow"||m.type==="tableDelimiterRow"?(l=n,a[1]!==0?(s[0]=s[1],d=ob(h,e,a,i,n,d)):s[1]!==0&&(d=ob(h,e,s,i,n,d)),i=0):i&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")&&(s[3]=n)}for(l!==0&&Pz(h,e,l,u,c),h.consume(e.events),n=-1;++n<e.events.length;){const f=e.events[n];f[0]==="enter"&&f[1].type==="table"&&(f[1]._align=oFe(e.events,n))}return t}function ob(t,e,n,r,i,a){const s=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",o="tableContent";n[0]!==0&&(a.end=Object.assign({},Hp(e.events,n[0])),t.add(n[0],0,[["exit",a,e]]));const l=Hp(e.events,n[1]);if(a={type:s,start:Object.assign({},l),end:Object.assign({},l)},t.add(n[1],0,[["enter",a,e]]),n[2]!==0){const u=Hp(e.events,n[2]),c=Hp(e.events,n[3]),d={type:o,start:Object.assign({},u),end:Object.assign({},c)};if(t.add(n[2],0,[["enter",d,e]]),r!==2){const h=e.events[n[2]],f=e.events[n[3]];if(h[1].end=Object.assign({},f[1].end),h[1].type="chunkText",h[1].contentType="text",n[3]>n[2]+1){const m=n[2]+1,x=n[3]-n[2]-1;t.add(m,x,[])}}t.add(n[3]+1,0,[["exit",d,e]])}return i!==void 0&&(a.end=Object.assign({},Hp(e.events,i)),t.add(i,0,[["exit",a,e]]),a=void 0),a}function Pz(t,e,n,r,i){const a=[],s=Hp(e.events,n);i&&(i.end=Object.assign({},s),a.push(["exit",i,e])),r.end=Object.assign({},s),a.push(["exit",r,e]),t.add(n+1,0,a)}function Hp(t,e){const n=t[e],r=n[0]==="enter"?"start":"end";return n[1][r]}const dFe={name:"tasklistCheck",tokenize:fFe};function hFe(){return{text:{91:dFe}}}function fFe(t,e,n){const r=this;return i;function i(l){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(l):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),a)}function a(l){return Dr(l)?(t.enter("taskListCheckValueUnchecked"),t.consume(l),t.exit("taskListCheckValueUnchecked"),s):l===88||l===120?(t.enter("taskListCheckValueChecked"),t.consume(l),t.exit("taskListCheckValueChecked"),s):n(l)}function s(l){return l===93?(t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),o):n(l)}function o(l){return en(l)?e(l):Vn(l)?t.check({tokenize:pFe},e,n)(l):n(l)}}function pFe(t,e,n){return Un(t,r,"whitespace");function r(i){return i===null?n(i):e(i)}}function mFe(t){return Wne([zLe(),KLe(),iFe(t),lFe(),hFe()])}const gFe={};function jre(t){const e=this,n=t||gFe,r=e.data(),i=r.micromarkExtensions||(r.micromarkExtensions=[]),a=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),s=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);i.push(mFe(n)),a.push(LLe()),s.push(FLe(n))}function vFe(){return{enter:{mathFlow:t,mathFlowFenceMeta:e,mathText:a},exit:{mathFlow:i,mathFlowFence:r,mathFlowFenceMeta:n,mathFlowValue:o,mathText:s,mathTextData:o}};function t(l){const u={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[u]}},l)}function e(){this.buffer()}function n(){const l=this.resume(),u=this.stack[this.stack.length-1];u.type,u.meta=l}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function i(l){const u=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),c=this.stack[this.stack.length-1];c.type,this.exit(l),c.value=u;const d=c.data.hChildren[0];d.type,d.tagName,d.children.push({type:"text",value:u}),this.data.mathFlowInside=void 0}function a(l){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},l),this.buffer()}function s(l){const u=this.resume(),c=this.stack[this.stack.length-1];c.type,this.exit(l),c.value=u,c.data.hChildren.push({type:"text",value:u})}function o(l){this.config.enter.data.call(this,l),this.config.exit.data.call(this,l)}}function yFe(t){let e=(t||{}).singleDollarTextMath;return e==null&&(e=!0),r.peek=i,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:e?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:n,inlineMath:r}};function n(a,s,o,l){const u=a.value||"",c=o.createTracker(l),d="$".repeat(Math.max(_re(u,"$")+1,2)),h=o.enter("mathFlow");let f=c.move(d);if(a.meta){const m=o.enter("mathFlowMeta");f+=c.move(o.safe(a.meta,{after:`
`,before:f,encode:["$"],...c.current()})),m()}return f+=c.move(`
`),u&&(f+=c.move(u+`
`)),f+=c.move(d),h(),f}function r(a,s,o){let l=a.value||"",u=1;for(e||u++;new RegExp("(^|[^$])"+"\\$".repeat(u)+"([^$]|$)").test(l);)u++;const c="$".repeat(u);/[^ \r\n]/.test(l)&&(/^[ \r\n]/.test(l)&&/[ \r\n]$/.test(l)||/^\$|\$$/.test(l))&&(l=" "+l+" ");let d=-1;for(;++d<o.unsafe.length;){const h=o.unsafe[d];if(!h.atBreak)continue;const f=o.compilePattern(h);let m;for(;m=f.exec(l);){let x=m.index;l.codePointAt(x)===10&&l.codePointAt(x-1)===13&&x--,l=l.slice(0,x)+" "+l.slice(m.index+1)}}return c+l+c}function i(){return"$"}}const xFe={tokenize:bFe,concrete:!0,name:"mathFlow"},Dz={tokenize:_Fe,partial:!0};function bFe(t,e,n){const r=this,i=r.events[r.events.length-1],a=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0;let s=0;return o;function o(w){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),l(w)}function l(w){return w===36?(t.consume(w),s++,l):s<2?n(w):(t.exit("mathFlowFenceSequence"),Un(t,u,"whitespace")(w))}function u(w){return w===null||en(w)?d(w):(t.enter("mathFlowFenceMeta"),t.enter("chunkString",{contentType:"string"}),c(w))}function c(w){return w===null||en(w)?(t.exit("chunkString"),t.exit("mathFlowFenceMeta"),d(w)):w===36?n(w):(t.consume(w),c)}function d(w){return t.exit("mathFlowFence"),r.interrupt?e(w):t.attempt(Dz,h,b)(w)}function h(w){return t.attempt({tokenize:y,partial:!0},b,f)(w)}function f(w){return(a?Un(t,m,"linePrefix",a+1):m)(w)}function m(w){return w===null?b(w):en(w)?t.attempt(Dz,h,b)(w):(t.enter("mathFlowValue"),x(w))}function x(w){return w===null||en(w)?(t.exit("mathFlowValue"),m(w)):(t.consume(w),x)}function b(w){return t.exit("mathFlow"),e(w)}function y(w,_,S){let M=0;return Un(w,E,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function E(k){return w.enter("mathFlowFence"),w.enter("mathFlowFenceSequence"),C(k)}function C(k){return k===36?(M++,w.consume(k),C):M<s?S(k):(w.exit("mathFlowFenceSequence"),Un(w,R,"whitespace")(k))}function R(k){return k===null||en(k)?(w.exit("mathFlowFence"),_(k)):S(k)}}}function _Fe(t,e,n){const r=this;return i;function i(s){return s===null?e(s):(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),a)}function a(s){return r.parser.lazy[r.now().line]?n(s):e(s)}}function wFe(t){let n=(t||{}).singleDollarTextMath;return n==null&&(n=!0),{tokenize:r,resolve:SFe,previous:EFe,name:"mathText"};function r(i,a,s){let o=0,l,u;return c;function c(x){return i.enter("mathText"),i.enter("mathTextSequence"),d(x)}function d(x){return x===36?(i.consume(x),o++,d):o<2&&!n?s(x):(i.exit("mathTextSequence"),h(x))}function h(x){return x===null?s(x):x===36?(u=i.enter("mathTextSequence"),l=0,m(x)):x===32?(i.enter("space"),i.consume(x),i.exit("space"),h):en(x)?(i.enter("lineEnding"),i.consume(x),i.exit("lineEnding"),h):(i.enter("mathTextData"),f(x))}function f(x){return x===null||x===32||x===36||en(x)?(i.exit("mathTextData"),h(x)):(i.consume(x),f)}function m(x){return x===36?(i.consume(x),l++,m):l===o?(i.exit("mathTextSequence"),i.exit("mathText"),a(x)):(u.type="mathTextData",f(x))}}}function SFe(t){let e=t.length-4,n=3,r,i;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="mathTextData"){t[e][1].type="mathTextPadding",t[n][1].type="mathTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(i=r):(r===e||t[r][1].type==="lineEnding")&&(t[i][1].type="mathTextData",r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function EFe(t){return t!==36||this.events[this.events.length-1][1].type==="characterEscape"}function TFe(t){return{flow:{36:xFe},text:{36:wFe(t)}}}class ys{constructor(e,n,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=n,this.end=r}static range(e,n){return n?!e||!e.loc||!n.loc||e.loc.lexer!==n.loc.lexer?null:new ys(e.loc.lexer,e.loc.start,n.loc.end):e&&e.loc}}class Ks{constructor(e,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=n}range(e,n){return new Ks(n,ys.range(this,e))}}class Mt{constructor(e,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,i,a,s=n&&n.loc;if(s&&s.start<=s.end){var o=s.lexer.input;i=s.start,a=s.end,i===o.length?r+=" at end of input: ":r+=" at position "+(i+1)+": ";var l=o.slice(i,a).replace(/[^]/g,"$&̲"),u;i>15?u="…"+o.slice(i-15,i):u=o.slice(0,i);var c;a+15<o.length?c=o.slice(a,a+15)+"…":c=o.slice(a),r+=u+l+c}var d=new Error(r);return d.name="ParseError",d.__proto__=Mt.prototype,d.position=i,i!=null&&a!=null&&(d.length=a-i),d.rawMessage=e,d}}Mt.prototype.__proto__=Error.prototype;var CFe=function(e,n){return e===void 0?n:e},MFe=/([A-Z])/g,AFe=function(e){return e.replace(MFe,"-$1").toLowerCase()},kFe={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},IFe=/[&><"']/g;function NFe(t){return String(t).replace(IFe,e=>kFe[e])}var Hre=function t(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?t(e.body[0]):e:e.type==="font"?t(e.body):e},RFe=function(e){var n=Hre(e);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},PFe=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},DFe=function(e){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},hr={deflt:CFe,escape:NFe,hyphenate:AFe,getBaseElem:Hre,isCharacterBox:RFe,protocolFromUrl:DFe},Gb={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:t=>"#"+t},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(t,e)=>(e.push(t),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:t=>Math.max(0,t),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:t=>Math.max(0,t),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:t=>Math.max(0,t),cli:"-e, --max-expand <n>",cliProcessor:t=>t==="Infinity"?1/0:parseInt(t)},globalGroup:{type:"boolean",cli:!1}};function OFe(t){if(t.default)return t.default;var e=t.type,n=Array.isArray(e)?e[0]:e;if(typeof n!="string")return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class BR{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var n in Gb)if(Gb.hasOwnProperty(n)){var r=Gb[n];this[n]=e[n]!==void 0?r.processor?r.processor(e[n]):e[n]:OFe(r)}}reportNonstrict(e,n,r){var i=this.strict;if(typeof i=="function"&&(i=i(e,n,r)),!(!i||i==="ignore")){if(i===!0||i==="error")throw new Mt("LaTeX-incompatible input and strict mode is set to 'error': "+(n+" ["+e+"]"),r);i==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+n+" ["+e+"]"))}}useStrictBehavior(e,n,r){var i=this.strict;if(typeof i=="function")try{i=i(e,n,r)}catch{i="error"}return!i||i==="ignore"?!1:i===!0||i==="error"?!0:i==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+n+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var n=hr.protocolFromUrl(e.url);if(n==null)return!1;e.protocol=n}var r=typeof this.trust=="function"?this.trust(e):this.trust;return!!r}}class Nc{constructor(e,n,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=n,this.cramped=r}sup(){return Cl[LFe[this.id]]}sub(){return Cl[FFe[this.id]]}fracNum(){return Cl[BFe[this.id]]}fracDen(){return Cl[UFe[this.id]]}cramp(){return Cl[zFe[this.id]]}text(){return Cl[jFe[this.id]]}isTight(){return this.size>=2}}var UR=0,Iw=1,n0=2,Lu=3,W1=4,go=5,T0=6,es=7,Cl=[new Nc(UR,0,!1),new Nc(Iw,0,!0),new Nc(n0,1,!1),new Nc(Lu,1,!0),new Nc(W1,2,!1),new Nc(go,2,!0),new Nc(T0,3,!1),new Nc(es,3,!0)],LFe=[W1,go,W1,go,T0,es,T0,es],FFe=[go,go,go,go,es,es,es,es],BFe=[n0,Lu,W1,go,T0,es,T0,es],UFe=[Lu,Lu,go,go,es,es,es,es],zFe=[Iw,Iw,Lu,Lu,go,go,es,es],jFe=[UR,Iw,n0,Lu,n0,Lu,n0,Lu],un={DISPLAY:Cl[UR],TEXT:Cl[n0],SCRIPT:Cl[W1],SCRIPTSCRIPT:Cl[T0]},HI=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function HFe(t){for(var e=0;e<HI.length;e++)for(var n=HI[e],r=0;r<n.blocks.length;r++){var i=n.blocks[r];if(t>=i[0]&&t<=i[1])return n.name}return null}var Wb=[];HI.forEach(t=>t.blocks.forEach(e=>Wb.push(...e)));function $re(t){for(var e=0;e<Wb.length;e+=2)if(t>=Wb[e]&&t<=Wb[e+1])return!0;return!1}var Fp=80,$Fe=function(e,n){return"M95,"+(622+e+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},VFe=function(e,n){return"M263,"+(601+e+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},qFe=function(e,n){return"M983 "+(10+e+n)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},GFe=function(e,n){return"M424,"+(2398+e+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+n+`
h400000v`+(40+e)+"h-400000z"},WFe=function(e,n){return"M473,"+(2713+e+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+n+"h400000v"+(40+e)+"H1017.7z"},YFe=function(e){var n=e/2;return"M400000 "+e+" H0 L"+n+" 0 l65 45 L145 "+(e-80)+" H400000z"},XFe=function(e,n,r){var i=r-54-n-e;return"M702 "+(e+n)+"H400000"+(40+e)+`
H742v`+i+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+e)+"H742z"},KFe=function(e,n,r){n=1e3*n;var i="";switch(e){case"sqrtMain":i=$Fe(n,Fp);break;case"sqrtSize1":i=VFe(n,Fp);break;case"sqrtSize2":i=qFe(n,Fp);break;case"sqrtSize3":i=GFe(n,Fp);break;case"sqrtSize4":i=WFe(n,Fp);break;case"sqrtTall":i=XFe(n,Fp,r)}return i},ZFe=function(e,n){switch(e){case"⎜":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"∣":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"∥":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"⎟":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"⎢":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"⎥":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"⎪":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"⏐":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"‖":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},Oz={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},JFe=function(e,n){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class Ov{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return this.classes.includes(e)}toNode(){for(var e=document.createDocumentFragment(),n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){for(var e="",n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e}toText(){var e=n=>n.toText();return this.children.map(e).join("")}}var Pl={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},lb={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},Lz={Å:"A",Ð:"D",Þ:"o",å:"a",ð:"d",þ:"o",А:"A",Б:"B",В:"B",Г:"F",Д:"A",Е:"E",Ж:"K",З:"3",И:"N",Й:"N",К:"K",Л:"N",М:"M",Н:"H",О:"O",П:"N",Р:"P",С:"C",Т:"T",У:"y",Ф:"O",Х:"X",Ц:"U",Ч:"h",Ш:"W",Щ:"W",Ъ:"B",Ы:"X",Ь:"B",Э:"3",Ю:"X",Я:"R",а:"a",б:"b",в:"a",г:"r",д:"y",е:"e",ж:"m",з:"e",и:"n",й:"n",к:"n",л:"n",м:"m",н:"n",о:"o",п:"n",р:"p",с:"c",т:"o",у:"y",ф:"b",х:"x",ц:"n",ч:"n",ш:"w",щ:"w",ъ:"a",ы:"m",ь:"a",э:"e",ю:"m",я:"r"};function QFe(t,e){Pl[t]=e}function zR(t,e,n){if(!Pl[e])throw new Error("Font metrics not found for font: "+e+".");var r=t.charCodeAt(0),i=Pl[e][r];if(!i&&t[0]in Lz&&(r=Lz[t[0]].charCodeAt(0),i=Pl[e][r]),!i&&n==="text"&&$re(r)&&(i=Pl[e][77]),i)return{depth:i[0],height:i[1],italic:i[2],skew:i[3],width:i[4]}}var TT={};function eBe(t){var e;if(t>=5?e=0:t>=3?e=1:e=2,!TT[e]){var n=TT[e]={cssEmPerMu:lb.quad[e]/18};for(var r in lb)lb.hasOwnProperty(r)&&(n[r]=lb[r][e])}return TT[e]}var tBe=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],Fz=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],Bz=function(e,n){return n.size<2?e:tBe[e-1][n.size-1]};class Au{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||Au.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=Fz[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var n={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return new Au(n)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:Bz(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:Fz[e-1]})}havingBaseStyle(e){e=e||this.style.text();var n=Bz(Au.BASESIZE,e);return this.size===n&&this.textSize===Au.BASESIZE&&this.style===e?this:this.extend({style:e,size:n})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==Au.BASESIZE?["sizing","reset-size"+this.size,"size"+Au.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=eBe(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}Au.BASESIZE=6;var $I={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},nBe={ex:!0,em:!0,mu:!0},Vre=function(e){return typeof e!="string"&&(e=e.unit),e in $I||e in nBe||e==="ex"},ci=function(e,n){var r;if(e.unit in $I)r=$I[e.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(e.unit==="mu")r=n.fontMetrics().cssEmPerMu;else{var i;if(n.style.isTight()?i=n.havingStyle(n.style.text()):i=n,e.unit==="ex")r=i.fontMetrics().xHeight;else if(e.unit==="em")r=i.fontMetrics().quad;else throw new Mt("Invalid unit: '"+e.unit+"'");i!==n&&(r*=i.sizeMultiplier/n.sizeMultiplier)}return Math.min(e.number*r,n.maxSize)},Rt=function(e){return+e.toFixed(4)+"em"},od=function(e){return e.filter(n=>n).join(" ")},qre=function(e,n,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},n){n.style.isTight()&&this.classes.push("mtight");var i=n.getColor();i&&(this.style.color=i)}},Gre=function(e){var n=document.createElement(e);n.className=od(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(n.style[r]=this.style[r]);for(var i in this.attributes)this.attributes.hasOwnProperty(i)&&n.setAttribute(i,this.attributes[i]);for(var a=0;a<this.children.length;a++)n.appendChild(this.children[a].toNode());return n},rBe=/[\s"'>/=\x00-\x1f]/,Wre=function(e){var n="<"+e;this.classes.length&&(n+=' class="'+hr.escape(od(this.classes))+'"');var r="";for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=hr.hyphenate(i)+":"+this.style[i]+";");r&&(n+=' style="'+hr.escape(r)+'"');for(var a in this.attributes)if(this.attributes.hasOwnProperty(a)){if(rBe.test(a))throw new Mt("Invalid attribute name '"+a+"'");n+=" "+a+'="'+hr.escape(this.attributes[a])+'"'}n+=">";for(var s=0;s<this.children.length;s++)n+=this.children[s].toMarkup();return n+="</"+e+">",n};class Lv{constructor(e,n,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,qre.call(this,e,r,i),this.children=n||[]}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return this.classes.includes(e)}toNode(){return Gre.call(this,"span")}toMarkup(){return Wre.call(this,"span")}}class jR{constructor(e,n,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,qre.call(this,n,i),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return this.classes.includes(e)}toNode(){return Gre.call(this,"a")}toMarkup(){return Wre.call(this,"a")}}class iBe{constructor(e,n,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(e.style[n]=this.style[n]);return e}toMarkup(){var e='<img src="'+hr.escape(this.src)+'"'+(' alt="'+hr.escape(this.alt)+'"'),n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=hr.hyphenate(r)+":"+this.style[r]+";");return n&&(e+=' style="'+hr.escape(n)+'"'),e+="'/>",e}}var aBe={î:"ı̂",ï:"ı̈",í:"ı́",ì:"ı̀"};class _o{constructor(e,n,r,i,a,s,o,l){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=n||0,this.depth=r||0,this.italic=i||0,this.skew=a||0,this.width=s||0,this.classes=o||[],this.style=l||{},this.maxFontSize=0;var u=HFe(this.text.charCodeAt(0));u&&this.classes.push(u+"_fallback"),/[îïíì]/.test(this.text)&&(this.text=aBe[this.text])}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=Rt(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=od(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(n=n||document.createElement("span"),n.style[r]=this.style[r]);return n?(n.appendChild(e),n):e}toMarkup(){var e=!1,n="<span";this.classes.length&&(e=!0,n+=' class="',n+=hr.escape(od(this.classes)),n+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=hr.hyphenate(i)+":"+this.style[i]+";");r&&(e=!0,n+=' style="'+hr.escape(r)+'"');var a=hr.escape(this.text);return e?(n+=">",n+=a,n+="</span>",n):a}}class ju{constructor(e,n){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=n||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);for(var i=0;i<this.children.length;i++)n.appendChild(this.children[i].toNode());return n}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+hr.escape(this.attributes[n])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class ld{constructor(e,n){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=n}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",Oz[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+hr.escape(this.alternate)+'"/>':'<path d="'+hr.escape(Oz[this.pathName])+'"/>'}}class VI{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);return n}toMarkup(){var e="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+hr.escape(this.attributes[n])+'"');return e+="/>",e}}function Uz(t){if(t instanceof _o)return t;throw new Error("Expected symbolNode but got "+String(t)+".")}function sBe(t){if(t instanceof Lv)return t;throw new Error("Expected span<HtmlDomNode> but got "+String(t)+".")}var oBe={bin:1,close:1,inner:1,open:1,punct:1,rel:1},lBe={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Hr={math:{},text:{}};function Y(t,e,n,r,i,a){Hr[t][i]={font:e,group:n,replace:r},a&&r&&(Hr[t][r]=Hr[t][i])}var ne="math",bt="text",he="main",Re="ams",ei="accent-token",qt="bin",as="close",W0="inner",ln="mathord",Vi="op-token",ro="open",y3="punct",Pe="rel",Zu="spacing",Ve="textord";Y(ne,he,Pe,"≡","\\equiv",!0);Y(ne,he,Pe,"≺","\\prec",!0);Y(ne,he,Pe,"≻","\\succ",!0);Y(ne,he,Pe,"∼","\\sim",!0);Y(ne,he,Pe,"⊥","\\perp");Y(ne,he,Pe,"⪯","\\preceq",!0);Y(ne,he,Pe,"⪰","\\succeq",!0);Y(ne,he,Pe,"≃","\\simeq",!0);Y(ne,he,Pe,"∣","\\mid",!0);Y(ne,he,Pe,"≪","\\ll",!0);Y(ne,he,Pe,"≫","\\gg",!0);Y(ne,he,Pe,"≍","\\asymp",!0);Y(ne,he,Pe,"∥","\\parallel");Y(ne,he,Pe,"⋈","\\bowtie",!0);Y(ne,he,Pe,"⌣","\\smile",!0);Y(ne,he,Pe,"⊑","\\sqsubseteq",!0);Y(ne,he,Pe,"⊒","\\sqsupseteq",!0);Y(ne,he,Pe,"≐","\\doteq",!0);Y(ne,he,Pe,"⌢","\\frown",!0);Y(ne,he,Pe,"∋","\\ni",!0);Y(ne,he,Pe,"∝","\\propto",!0);Y(ne,he,Pe,"⊢","\\vdash",!0);Y(ne,he,Pe,"⊣","\\dashv",!0);Y(ne,he,Pe,"∋","\\owns");Y(ne,he,y3,".","\\ldotp");Y(ne,he,y3,"⋅","\\cdotp");Y(ne,he,Ve,"#","\\#");Y(bt,he,Ve,"#","\\#");Y(ne,he,Ve,"&","\\&");Y(bt,he,Ve,"&","\\&");Y(ne,he,Ve,"ℵ","\\aleph",!0);Y(ne,he,Ve,"∀","\\forall",!0);Y(ne,he,Ve,"ℏ","\\hbar",!0);Y(ne,he,Ve,"∃","\\exists",!0);Y(ne,he,Ve,"∇","\\nabla",!0);Y(ne,he,Ve,"♭","\\flat",!0);Y(ne,he,Ve,"ℓ","\\ell",!0);Y(ne,he,Ve,"♮","\\natural",!0);Y(ne,he,Ve,"♣","\\clubsuit",!0);Y(ne,he,Ve,"℘","\\wp",!0);Y(ne,he,Ve,"♯","\\sharp",!0);Y(ne,he,Ve,"♢","\\diamondsuit",!0);Y(ne,he,Ve,"ℜ","\\Re",!0);Y(ne,he,Ve,"♡","\\heartsuit",!0);Y(ne,he,Ve,"ℑ","\\Im",!0);Y(ne,he,Ve,"♠","\\spadesuit",!0);Y(ne,he,Ve,"§","\\S",!0);Y(bt,he,Ve,"§","\\S");Y(ne,he,Ve,"¶","\\P",!0);Y(bt,he,Ve,"¶","\\P");Y(ne,he,Ve,"†","\\dag");Y(bt,he,Ve,"†","\\dag");Y(bt,he,Ve,"†","\\textdagger");Y(ne,he,Ve,"‡","\\ddag");Y(bt,he,Ve,"‡","\\ddag");Y(bt,he,Ve,"‡","\\textdaggerdbl");Y(ne,he,as,"⎱","\\rmoustache",!0);Y(ne,he,ro,"⎰","\\lmoustache",!0);Y(ne,he,as,"⟯","\\rgroup",!0);Y(ne,he,ro,"⟮","\\lgroup",!0);Y(ne,he,qt,"∓","\\mp",!0);Y(ne,he,qt,"⊖","\\ominus",!0);Y(ne,he,qt,"⊎","\\uplus",!0);Y(ne,he,qt,"⊓","\\sqcap",!0);Y(ne,he,qt,"∗","\\ast");Y(ne,he,qt,"⊔","\\sqcup",!0);Y(ne,he,qt,"◯","\\bigcirc",!0);Y(ne,he,qt,"∙","\\bullet",!0);Y(ne,he,qt,"‡","\\ddagger");Y(ne,he,qt,"≀","\\wr",!0);Y(ne,he,qt,"⨿","\\amalg");Y(ne,he,qt,"&","\\And");Y(ne,he,Pe,"⟵","\\longleftarrow",!0);Y(ne,he,Pe,"⇐","\\Leftarrow",!0);Y(ne,he,Pe,"⟸","\\Longleftarrow",!0);Y(ne,he,Pe,"⟶","\\longrightarrow",!0);Y(ne,he,Pe,"⇒","\\Rightarrow",!0);Y(ne,he,Pe,"⟹","\\Longrightarrow",!0);Y(ne,he,Pe,"↔","\\leftrightarrow",!0);Y(ne,he,Pe,"⟷","\\longleftrightarrow",!0);Y(ne,he,Pe,"⇔","\\Leftrightarrow",!0);Y(ne,he,Pe,"⟺","\\Longleftrightarrow",!0);Y(ne,he,Pe,"↦","\\mapsto",!0);Y(ne,he,Pe,"⟼","\\longmapsto",!0);Y(ne,he,Pe,"↗","\\nearrow",!0);Y(ne,he,Pe,"↩","\\hookleftarrow",!0);Y(ne,he,Pe,"↪","\\hookrightarrow",!0);Y(ne,he,Pe,"↘","\\searrow",!0);Y(ne,he,Pe,"↼","\\leftharpoonup",!0);Y(ne,he,Pe,"⇀","\\rightharpoonup",!0);Y(ne,he,Pe,"↙","\\swarrow",!0);Y(ne,he,Pe,"↽","\\leftharpoondown",!0);Y(ne,he,Pe,"⇁","\\rightharpoondown",!0);Y(ne,he,Pe,"↖","\\nwarrow",!0);Y(ne,he,Pe,"⇌","\\rightleftharpoons",!0);Y(ne,Re,Pe,"≮","\\nless",!0);Y(ne,Re,Pe,"","\\@nleqslant");Y(ne,Re,Pe,"","\\@nleqq");Y(ne,Re,Pe,"⪇","\\lneq",!0);Y(ne,Re,Pe,"≨","\\lneqq",!0);Y(ne,Re,Pe,"","\\@lvertneqq");Y(ne,Re,Pe,"⋦","\\lnsim",!0);Y(ne,Re,Pe,"⪉","\\lnapprox",!0);Y(ne,Re,Pe,"⊀","\\nprec",!0);Y(ne,Re,Pe,"⋠","\\npreceq",!0);Y(ne,Re,Pe,"⋨","\\precnsim",!0);Y(ne,Re,Pe,"⪹","\\precnapprox",!0);Y(ne,Re,Pe,"≁","\\nsim",!0);Y(ne,Re,Pe,"","\\@nshortmid");Y(ne,Re,Pe,"∤","\\nmid",!0);Y(ne,Re,Pe,"⊬","\\nvdash",!0);Y(ne,Re,Pe,"⊭","\\nvDash",!0);Y(ne,Re,Pe,"⋪","\\ntriangleleft");Y(ne,Re,Pe,"⋬","\\ntrianglelefteq",!0);Y(ne,Re,Pe,"⊊","\\subsetneq",!0);Y(ne,Re,Pe,"","\\@varsubsetneq");Y(ne,Re,Pe,"⫋","\\subsetneqq",!0);Y(ne,Re,Pe,"","\\@varsubsetneqq");Y(ne,Re,Pe,"≯","\\ngtr",!0);Y(ne,Re,Pe,"","\\@ngeqslant");Y(ne,Re,Pe,"","\\@ngeqq");Y(ne,Re,Pe,"⪈","\\gneq",!0);Y(ne,Re,Pe,"≩","\\gneqq",!0);Y(ne,Re,Pe,"","\\@gvertneqq");Y(ne,Re,Pe,"⋧","\\gnsim",!0);Y(ne,Re,Pe,"⪊","\\gnapprox",!0);Y(ne,Re,Pe,"⊁","\\nsucc",!0);Y(ne,Re,Pe,"⋡","\\nsucceq",!0);Y(ne,Re,Pe,"⋩","\\succnsim",!0);Y(ne,Re,Pe,"⪺","\\succnapprox",!0);Y(ne,Re,Pe,"≆","\\ncong",!0);Y(ne,Re,Pe,"","\\@nshortparallel");Y(ne,Re,Pe,"∦","\\nparallel",!0);Y(ne,Re,Pe,"⊯","\\nVDash",!0);Y(ne,Re,Pe,"⋫","\\ntriangleright");Y(ne,Re,Pe,"⋭","\\ntrianglerighteq",!0);Y(ne,Re,Pe,"","\\@nsupseteqq");Y(ne,Re,Pe,"⊋","\\supsetneq",!0);Y(ne,Re,Pe,"","\\@varsupsetneq");Y(ne,Re,Pe,"⫌","\\supsetneqq",!0);Y(ne,Re,Pe,"","\\@varsupsetneqq");Y(ne,Re,Pe,"⊮","\\nVdash",!0);Y(ne,Re,Pe,"⪵","\\precneqq",!0);Y(ne,Re,Pe,"⪶","\\succneqq",!0);Y(ne,Re,Pe,"","\\@nsubseteqq");Y(ne,Re,qt,"⊴","\\unlhd");Y(ne,Re,qt,"⊵","\\unrhd");Y(ne,Re,Pe,"↚","\\nleftarrow",!0);Y(ne,Re,Pe,"↛","\\nrightarrow",!0);Y(ne,Re,Pe,"⇍","\\nLeftarrow",!0);Y(ne,Re,Pe,"⇏","\\nRightarrow",!0);Y(ne,Re,Pe,"↮","\\nleftrightarrow",!0);Y(ne,Re,Pe,"⇎","\\nLeftrightarrow",!0);Y(ne,Re,Pe,"△","\\vartriangle");Y(ne,Re,Ve,"ℏ","\\hslash");Y(ne,Re,Ve,"▽","\\triangledown");Y(ne,Re,Ve,"◊","\\lozenge");Y(ne,Re,Ve,"Ⓢ","\\circledS");Y(ne,Re,Ve,"®","\\circledR");Y(bt,Re,Ve,"®","\\circledR");Y(ne,Re,Ve,"∡","\\measuredangle",!0);Y(ne,Re,Ve,"∄","\\nexists");Y(ne,Re,Ve,"℧","\\mho");Y(ne,Re,Ve,"Ⅎ","\\Finv",!0);Y(ne,Re,Ve,"⅁","\\Game",!0);Y(ne,Re,Ve,"‵","\\backprime");Y(ne,Re,Ve,"▲","\\blacktriangle");Y(ne,Re,Ve,"▼","\\blacktriangledown");Y(ne,Re,Ve,"■","\\blacksquare");Y(ne,Re,Ve,"⧫","\\blacklozenge");Y(ne,Re,Ve,"★","\\bigstar");Y(ne,Re,Ve,"∢","\\sphericalangle",!0);Y(ne,Re,Ve,"∁","\\complement",!0);Y(ne,Re,Ve,"ð","\\eth",!0);Y(bt,he,Ve,"ð","ð");Y(ne,Re,Ve,"╱","\\diagup");Y(ne,Re,Ve,"╲","\\diagdown");Y(ne,Re,Ve,"□","\\square");Y(ne,Re,Ve,"□","\\Box");Y(ne,Re,Ve,"◊","\\Diamond");Y(ne,Re,Ve,"¥","\\yen",!0);Y(bt,Re,Ve,"¥","\\yen",!0);Y(ne,Re,Ve,"✓","\\checkmark",!0);Y(bt,Re,Ve,"✓","\\checkmark");Y(ne,Re,Ve,"ℶ","\\beth",!0);Y(ne,Re,Ve,"ℸ","\\daleth",!0);Y(ne,Re,Ve,"ℷ","\\gimel",!0);Y(ne,Re,Ve,"ϝ","\\digamma",!0);Y(ne,Re,Ve,"ϰ","\\varkappa");Y(ne,Re,ro,"┌","\\@ulcorner",!0);Y(ne,Re,as,"┐","\\@urcorner",!0);Y(ne,Re,ro,"└","\\@llcorner",!0);Y(ne,Re,as,"┘","\\@lrcorner",!0);Y(ne,Re,Pe,"≦","\\leqq",!0);Y(ne,Re,Pe,"⩽","\\leqslant",!0);Y(ne,Re,Pe,"⪕","\\eqslantless",!0);Y(ne,Re,Pe,"≲","\\lesssim",!0);Y(ne,Re,Pe,"⪅","\\lessapprox",!0);Y(ne,Re,Pe,"≊","\\approxeq",!0);Y(ne,Re,qt,"⋖","\\lessdot");Y(ne,Re,Pe,"⋘","\\lll",!0);Y(ne,Re,Pe,"≶","\\lessgtr",!0);Y(ne,Re,Pe,"⋚","\\lesseqgtr",!0);Y(ne,Re,Pe,"⪋","\\lesseqqgtr",!0);Y(ne,Re,Pe,"≑","\\doteqdot");Y(ne,Re,Pe,"≓","\\risingdotseq",!0);Y(ne,Re,Pe,"≒","\\fallingdotseq",!0);Y(ne,Re,Pe,"∽","\\backsim",!0);Y(ne,Re,Pe,"⋍","\\backsimeq",!0);Y(ne,Re,Pe,"⫅","\\subseteqq",!0);Y(ne,Re,Pe,"⋐","\\Subset",!0);Y(ne,Re,Pe,"⊏","\\sqsubset",!0);Y(ne,Re,Pe,"≼","\\preccurlyeq",!0);Y(ne,Re,Pe,"⋞","\\curlyeqprec",!0);Y(ne,Re,Pe,"≾","\\precsim",!0);Y(ne,Re,Pe,"⪷","\\precapprox",!0);Y(ne,Re,Pe,"⊲","\\vartriangleleft");Y(ne,Re,Pe,"⊴","\\trianglelefteq");Y(ne,Re,Pe,"⊨","\\vDash",!0);Y(ne,Re,Pe,"⊪","\\Vvdash",!0);Y(ne,Re,Pe,"⌣","\\smallsmile");Y(ne,Re,Pe,"⌢","\\smallfrown");Y(ne,Re,Pe,"≏","\\bumpeq",!0);Y(ne,Re,Pe,"≎","\\Bumpeq",!0);Y(ne,Re,Pe,"≧","\\geqq",!0);Y(ne,Re,Pe,"⩾","\\geqslant",!0);Y(ne,Re,Pe,"⪖","\\eqslantgtr",!0);Y(ne,Re,Pe,"≳","\\gtrsim",!0);Y(ne,Re,Pe,"⪆","\\gtrapprox",!0);Y(ne,Re,qt,"⋗","\\gtrdot");Y(ne,Re,Pe,"⋙","\\ggg",!0);Y(ne,Re,Pe,"≷","\\gtrless",!0);Y(ne,Re,Pe,"⋛","\\gtreqless",!0);Y(ne,Re,Pe,"⪌","\\gtreqqless",!0);Y(ne,Re,Pe,"≖","\\eqcirc",!0);Y(ne,Re,Pe,"≗","\\circeq",!0);Y(ne,Re,Pe,"≜","\\triangleq",!0);Y(ne,Re,Pe,"∼","\\thicksim");Y(ne,Re,Pe,"≈","\\thickapprox");Y(ne,Re,Pe,"⫆","\\supseteqq",!0);Y(ne,Re,Pe,"⋑","\\Supset",!0);Y(ne,Re,Pe,"⊐","\\sqsupset",!0);Y(ne,Re,Pe,"≽","\\succcurlyeq",!0);Y(ne,Re,Pe,"⋟","\\curlyeqsucc",!0);Y(ne,Re,Pe,"≿","\\succsim",!0);Y(ne,Re,Pe,"⪸","\\succapprox",!0);Y(ne,Re,Pe,"⊳","\\vartriangleright");Y(ne,Re,Pe,"⊵","\\trianglerighteq");Y(ne,Re,Pe,"⊩","\\Vdash",!0);Y(ne,Re,Pe,"∣","\\shortmid");Y(ne,Re,Pe,"∥","\\shortparallel");Y(ne,Re,Pe,"≬","\\between",!0);Y(ne,Re,Pe,"⋔","\\pitchfork",!0);Y(ne,Re,Pe,"∝","\\varpropto");Y(ne,Re,Pe,"◀","\\blacktriangleleft");Y(ne,Re,Pe,"∴","\\therefore",!0);Y(ne,Re,Pe,"∍","\\backepsilon");Y(ne,Re,Pe,"▶","\\blacktriangleright");Y(ne,Re,Pe,"∵","\\because",!0);Y(ne,Re,Pe,"⋘","\\llless");Y(ne,Re,Pe,"⋙","\\gggtr");Y(ne,Re,qt,"⊲","\\lhd");Y(ne,Re,qt,"⊳","\\rhd");Y(ne,Re,Pe,"≂","\\eqsim",!0);Y(ne,he,Pe,"⋈","\\Join");Y(ne,Re,Pe,"≑","\\Doteq",!0);Y(ne,Re,qt,"∔","\\dotplus",!0);Y(ne,Re,qt,"∖","\\smallsetminus");Y(ne,Re,qt,"⋒","\\Cap",!0);Y(ne,Re,qt,"⋓","\\Cup",!0);Y(ne,Re,qt,"⩞","\\doublebarwedge",!0);Y(ne,Re,qt,"⊟","\\boxminus",!0);Y(ne,Re,qt,"⊞","\\boxplus",!0);Y(ne,Re,qt,"⋇","\\divideontimes",!0);Y(ne,Re,qt,"⋉","\\ltimes",!0);Y(ne,Re,qt,"⋊","\\rtimes",!0);Y(ne,Re,qt,"⋋","\\leftthreetimes",!0);Y(ne,Re,qt,"⋌","\\rightthreetimes",!0);Y(ne,Re,qt,"⋏","\\curlywedge",!0);Y(ne,Re,qt,"⋎","\\curlyvee",!0);Y(ne,Re,qt,"⊝","\\circleddash",!0);Y(ne,Re,qt,"⊛","\\circledast",!0);Y(ne,Re,qt,"⋅","\\centerdot");Y(ne,Re,qt,"⊺","\\intercal",!0);Y(ne,Re,qt,"⋒","\\doublecap");Y(ne,Re,qt,"⋓","\\doublecup");Y(ne,Re,qt,"⊠","\\boxtimes",!0);Y(ne,Re,Pe,"⇢","\\dashrightarrow",!0);Y(ne,Re,Pe,"⇠","\\dashleftarrow",!0);Y(ne,Re,Pe,"⇇","\\leftleftarrows",!0);Y(ne,Re,Pe,"⇆","\\leftrightarrows",!0);Y(ne,Re,Pe,"⇚","\\Lleftarrow",!0);Y(ne,Re,Pe,"↞","\\twoheadleftarrow",!0);Y(ne,Re,Pe,"↢","\\leftarrowtail",!0);Y(ne,Re,Pe,"↫","\\looparrowleft",!0);Y(ne,Re,Pe,"⇋","\\leftrightharpoons",!0);Y(ne,Re,Pe,"↶","\\curvearrowleft",!0);Y(ne,Re,Pe,"↺","\\circlearrowleft",!0);Y(ne,Re,Pe,"↰","\\Lsh",!0);Y(ne,Re,Pe,"⇈","\\upuparrows",!0);Y(ne,Re,Pe,"↿","\\upharpoonleft",!0);Y(ne,Re,Pe,"⇃","\\downharpoonleft",!0);Y(ne,he,Pe,"⊶","\\origof",!0);Y(ne,he,Pe,"⊷","\\imageof",!0);Y(ne,Re,Pe,"⊸","\\multimap",!0);Y(ne,Re,Pe,"↭","\\leftrightsquigarrow",!0);Y(ne,Re,Pe,"⇉","\\rightrightarrows",!0);Y(ne,Re,Pe,"⇄","\\rightleftarrows",!0);Y(ne,Re,Pe,"↠","\\twoheadrightarrow",!0);Y(ne,Re,Pe,"↣","\\rightarrowtail",!0);Y(ne,Re,Pe,"↬","\\looparrowright",!0);Y(ne,Re,Pe,"↷","\\curvearrowright",!0);Y(ne,Re,Pe,"↻","\\circlearrowright",!0);Y(ne,Re,Pe,"↱","\\Rsh",!0);Y(ne,Re,Pe,"⇊","\\downdownarrows",!0);Y(ne,Re,Pe,"↾","\\upharpoonright",!0);Y(ne,Re,Pe,"⇂","\\downharpoonright",!0);Y(ne,Re,Pe,"⇝","\\rightsquigarrow",!0);Y(ne,Re,Pe,"⇝","\\leadsto");Y(ne,Re,Pe,"⇛","\\Rrightarrow",!0);Y(ne,Re,Pe,"↾","\\restriction");Y(ne,he,Ve,"‘","`");Y(ne,he,Ve,"$","\\$");Y(bt,he,Ve,"$","\\$");Y(bt,he,Ve,"$","\\textdollar");Y(ne,he,Ve,"%","\\%");Y(bt,he,Ve,"%","\\%");Y(ne,he,Ve,"_","\\_");Y(bt,he,Ve,"_","\\_");Y(bt,he,Ve,"_","\\textunderscore");Y(ne,he,Ve,"∠","\\angle",!0);Y(ne,he,Ve,"∞","\\infty",!0);Y(ne,he,Ve,"′","\\prime");Y(ne,he,Ve,"△","\\triangle");Y(ne,he,Ve,"Γ","\\Gamma",!0);Y(ne,he,Ve,"Δ","\\Delta",!0);Y(ne,he,Ve,"Θ","\\Theta",!0);Y(ne,he,Ve,"Λ","\\Lambda",!0);Y(ne,he,Ve,"Ξ","\\Xi",!0);Y(ne,he,Ve,"Π","\\Pi",!0);Y(ne,he,Ve,"Σ","\\Sigma",!0);Y(ne,he,Ve,"Υ","\\Upsilon",!0);Y(ne,he,Ve,"Φ","\\Phi",!0);Y(ne,he,Ve,"Ψ","\\Psi",!0);Y(ne,he,Ve,"Ω","\\Omega",!0);Y(ne,he,Ve,"A","Α");Y(ne,he,Ve,"B","Β");Y(ne,he,Ve,"E","Ε");Y(ne,he,Ve,"Z","Ζ");Y(ne,he,Ve,"H","Η");Y(ne,he,Ve,"I","Ι");Y(ne,he,Ve,"K","Κ");Y(ne,he,Ve,"M","Μ");Y(ne,he,Ve,"N","Ν");Y(ne,he,Ve,"O","Ο");Y(ne,he,Ve,"P","Ρ");Y(ne,he,Ve,"T","Τ");Y(ne,he,Ve,"X","Χ");Y(ne,he,Ve,"¬","\\neg",!0);Y(ne,he,Ve,"¬","\\lnot");Y(ne,he,Ve,"⊤","\\top");Y(ne,he,Ve,"⊥","\\bot");Y(ne,he,Ve,"∅","\\emptyset");Y(ne,Re,Ve,"∅","\\varnothing");Y(ne,he,ln,"α","\\alpha",!0);Y(ne,he,ln,"β","\\beta",!0);Y(ne,he,ln,"γ","\\gamma",!0);Y(ne,he,ln,"δ","\\delta",!0);Y(ne,he,ln,"ϵ","\\epsilon",!0);Y(ne,he,ln,"ζ","\\zeta",!0);Y(ne,he,ln,"η","\\eta",!0);Y(ne,he,ln,"θ","\\theta",!0);Y(ne,he,ln,"ι","\\iota",!0);Y(ne,he,ln,"κ","\\kappa",!0);Y(ne,he,ln,"λ","\\lambda",!0);Y(ne,he,ln,"μ","\\mu",!0);Y(ne,he,ln,"ν","\\nu",!0);Y(ne,he,ln,"ξ","\\xi",!0);Y(ne,he,ln,"ο","\\omicron",!0);Y(ne,he,ln,"π","\\pi",!0);Y(ne,he,ln,"ρ","\\rho",!0);Y(ne,he,ln,"σ","\\sigma",!0);Y(ne,he,ln,"τ","\\tau",!0);Y(ne,he,ln,"υ","\\upsilon",!0);Y(ne,he,ln,"ϕ","\\phi",!0);Y(ne,he,ln,"χ","\\chi",!0);Y(ne,he,ln,"ψ","\\psi",!0);Y(ne,he,ln,"ω","\\omega",!0);Y(ne,he,ln,"ε","\\varepsilon",!0);Y(ne,he,ln,"ϑ","\\vartheta",!0);Y(ne,he,ln,"ϖ","\\varpi",!0);Y(ne,he,ln,"ϱ","\\varrho",!0);Y(ne,he,ln,"ς","\\varsigma",!0);Y(ne,he,ln,"φ","\\varphi",!0);Y(ne,he,qt,"∗","*",!0);Y(ne,he,qt,"+","+");Y(ne,he,qt,"−","-",!0);Y(ne,he,qt,"⋅","\\cdot",!0);Y(ne,he,qt,"∘","\\circ",!0);Y(ne,he,qt,"÷","\\div",!0);Y(ne,he,qt,"±","\\pm",!0);Y(ne,he,qt,"×","\\times",!0);Y(ne,he,qt,"∩","\\cap",!0);Y(ne,he,qt,"∪","\\cup",!0);Y(ne,he,qt,"∖","\\setminus",!0);Y(ne,he,qt,"∧","\\land");Y(ne,he,qt,"∨","\\lor");Y(ne,he,qt,"∧","\\wedge",!0);Y(ne,he,qt,"∨","\\vee",!0);Y(ne,he,Ve,"√","\\surd");Y(ne,he,ro,"⟨","\\langle",!0);Y(ne,he,ro,"∣","\\lvert");Y(ne,he,ro,"∥","\\lVert");Y(ne,he,as,"?","?");Y(ne,he,as,"!","!");Y(ne,he,as,"⟩","\\rangle",!0);Y(ne,he,as,"∣","\\rvert");Y(ne,he,as,"∥","\\rVert");Y(ne,he,Pe,"=","=");Y(ne,he,Pe,":",":");Y(ne,he,Pe,"≈","\\approx",!0);Y(ne,he,Pe,"≅","\\cong",!0);Y(ne,he,Pe,"≥","\\ge");Y(ne,he,Pe,"≥","\\geq",!0);Y(ne,he,Pe,"←","\\gets");Y(ne,he,Pe,">","\\gt",!0);Y(ne,he,Pe,"∈","\\in",!0);Y(ne,he,Pe,"","\\@not");Y(ne,he,Pe,"⊂","\\subset",!0);Y(ne,he,Pe,"⊃","\\supset",!0);Y(ne,he,Pe,"⊆","\\subseteq",!0);Y(ne,he,Pe,"⊇","\\supseteq",!0);Y(ne,Re,Pe,"⊈","\\nsubseteq",!0);Y(ne,Re,Pe,"⊉","\\nsupseteq",!0);Y(ne,he,Pe,"⊨","\\models");Y(ne,he,Pe,"←","\\leftarrow",!0);Y(ne,he,Pe,"≤","\\le");Y(ne,he,Pe,"≤","\\leq",!0);Y(ne,he,Pe,"<","\\lt",!0);Y(ne,he,Pe,"→","\\rightarrow",!0);Y(ne,he,Pe,"→","\\to");Y(ne,Re,Pe,"≱","\\ngeq",!0);Y(ne,Re,Pe,"≰","\\nleq",!0);Y(ne,he,Zu," ","\\ ");Y(ne,he,Zu," ","\\space");Y(ne,he,Zu," ","\\nobreakspace");Y(bt,he,Zu," ","\\ ");Y(bt,he,Zu," "," ");Y(bt,he,Zu," ","\\space");Y(bt,he,Zu," ","\\nobreakspace");Y(ne,he,Zu,null,"\\nobreak");Y(ne,he,Zu,null,"\\allowbreak");Y(ne,he,y3,",",",");Y(ne,he,y3,";",";");Y(ne,Re,qt,"⊼","\\barwedge",!0);Y(ne,Re,qt,"⊻","\\veebar",!0);Y(ne,he,qt,"⊙","\\odot",!0);Y(ne,he,qt,"⊕","\\oplus",!0);Y(ne,he,qt,"⊗","\\otimes",!0);Y(ne,he,Ve,"∂","\\partial",!0);Y(ne,he,qt,"⊘","\\oslash",!0);Y(ne,Re,qt,"⊚","\\circledcirc",!0);Y(ne,Re,qt,"⊡","\\boxdot",!0);Y(ne,he,qt,"△","\\bigtriangleup");Y(ne,he,qt,"▽","\\bigtriangledown");Y(ne,he,qt,"†","\\dagger");Y(ne,he,qt,"⋄","\\diamond");Y(ne,he,qt,"⋆","\\star");Y(ne,he,qt,"◃","\\triangleleft");Y(ne,he,qt,"▹","\\triangleright");Y(ne,he,ro,"{","\\{");Y(bt,he,Ve,"{","\\{");Y(bt,he,Ve,"{","\\textbraceleft");Y(ne,he,as,"}","\\}");Y(bt,he,Ve,"}","\\}");Y(bt,he,Ve,"}","\\textbraceright");Y(ne,he,ro,"{","\\lbrace");Y(ne,he,as,"}","\\rbrace");Y(ne,he,ro,"[","\\lbrack",!0);Y(bt,he,Ve,"[","\\lbrack",!0);Y(ne,he,as,"]","\\rbrack",!0);Y(bt,he,Ve,"]","\\rbrack",!0);Y(ne,he,ro,"(","\\lparen",!0);Y(ne,he,as,")","\\rparen",!0);Y(bt,he,Ve,"<","\\textless",!0);Y(bt,he,Ve,">","\\textgreater",!0);Y(ne,he,ro,"⌊","\\lfloor",!0);Y(ne,he,as,"⌋","\\rfloor",!0);Y(ne,he,ro,"⌈","\\lceil",!0);Y(ne,he,as,"⌉","\\rceil",!0);Y(ne,he,Ve,"\\","\\backslash");Y(ne,he,Ve,"∣","|");Y(ne,he,Ve,"∣","\\vert");Y(bt,he,Ve,"|","\\textbar",!0);Y(ne,he,Ve,"∥","\\|");Y(ne,he,Ve,"∥","\\Vert");Y(bt,he,Ve,"∥","\\textbardbl");Y(bt,he,Ve,"~","\\textasciitilde");Y(bt,he,Ve,"\\","\\textbackslash");Y(bt,he,Ve,"^","\\textasciicircum");Y(ne,he,Pe,"↑","\\uparrow",!0);Y(ne,he,Pe,"⇑","\\Uparrow",!0);Y(ne,he,Pe,"↓","\\downarrow",!0);Y(ne,he,Pe,"⇓","\\Downarrow",!0);Y(ne,he,Pe,"↕","\\updownarrow",!0);Y(ne,he,Pe,"⇕","\\Updownarrow",!0);Y(ne,he,Vi,"∐","\\coprod");Y(ne,he,Vi,"⋁","\\bigvee");Y(ne,he,Vi,"⋀","\\bigwedge");Y(ne,he,Vi,"⨄","\\biguplus");Y(ne,he,Vi,"⋂","\\bigcap");Y(ne,he,Vi,"⋃","\\bigcup");Y(ne,he,Vi,"∫","\\int");Y(ne,he,Vi,"∫","\\intop");Y(ne,he,Vi,"∬","\\iint");Y(ne,he,Vi,"∭","\\iiint");Y(ne,he,Vi,"∏","\\prod");Y(ne,he,Vi,"∑","\\sum");Y(ne,he,Vi,"⨂","\\bigotimes");Y(ne,he,Vi,"⨁","\\bigoplus");Y(ne,he,Vi,"⨀","\\bigodot");Y(ne,he,Vi,"∮","\\oint");Y(ne,he,Vi,"∯","\\oiint");Y(ne,he,Vi,"∰","\\oiiint");Y(ne,he,Vi,"⨆","\\bigsqcup");Y(ne,he,Vi,"∫","\\smallint");Y(bt,he,W0,"…","\\textellipsis");Y(ne,he,W0,"…","\\mathellipsis");Y(bt,he,W0,"…","\\ldots",!0);Y(ne,he,W0,"…","\\ldots",!0);Y(ne,he,W0,"⋯","\\@cdots",!0);Y(ne,he,W0,"⋱","\\ddots",!0);Y(ne,he,Ve,"⋮","\\varvdots");Y(bt,he,Ve,"⋮","\\varvdots");Y(ne,he,ei,"ˊ","\\acute");Y(ne,he,ei,"ˋ","\\grave");Y(ne,he,ei,"¨","\\ddot");Y(ne,he,ei,"~","\\tilde");Y(ne,he,ei,"ˉ","\\bar");Y(ne,he,ei,"˘","\\breve");Y(ne,he,ei,"ˇ","\\check");Y(ne,he,ei,"^","\\hat");Y(ne,he,ei,"⃗","\\vec");Y(ne,he,ei,"˙","\\dot");Y(ne,he,ei,"˚","\\mathring");Y(ne,he,ln,"","\\@imath");Y(ne,he,ln,"","\\@jmath");Y(ne,he,Ve,"ı","ı");Y(ne,he,Ve,"ȷ","ȷ");Y(bt,he,Ve,"ı","\\i",!0);Y(bt,he,Ve,"ȷ","\\j",!0);Y(bt,he,Ve,"ß","\\ss",!0);Y(bt,he,Ve,"æ","\\ae",!0);Y(bt,he,Ve,"œ","\\oe",!0);Y(bt,he,Ve,"ø","\\o",!0);Y(bt,he,Ve,"Æ","\\AE",!0);Y(bt,he,Ve,"Œ","\\OE",!0);Y(bt,he,Ve,"Ø","\\O",!0);Y(bt,he,ei,"ˊ","\\'");Y(bt,he,ei,"ˋ","\\`");Y(bt,he,ei,"ˆ","\\^");Y(bt,he,ei,"˜","\\~");Y(bt,he,ei,"ˉ","\\=");Y(bt,he,ei,"˘","\\u");Y(bt,he,ei,"˙","\\.");Y(bt,he,ei,"¸","\\c");Y(bt,he,ei,"˚","\\r");Y(bt,he,ei,"ˇ","\\v");Y(bt,he,ei,"¨",'\\"');Y(bt,he,ei,"˝","\\H");Y(bt,he,ei,"◯","\\textcircled");var Yre={"--":!0,"---":!0,"``":!0,"''":!0};Y(bt,he,Ve,"–","--",!0);Y(bt,he,Ve,"–","\\textendash");Y(bt,he,Ve,"—","---",!0);Y(bt,he,Ve,"—","\\textemdash");Y(bt,he,Ve,"‘","`",!0);Y(bt,he,Ve,"‘","\\textquoteleft");Y(bt,he,Ve,"’","'",!0);Y(bt,he,Ve,"’","\\textquoteright");Y(bt,he,Ve,"“","``",!0);Y(bt,he,Ve,"“","\\textquotedblleft");Y(bt,he,Ve,"”","''",!0);Y(bt,he,Ve,"”","\\textquotedblright");Y(ne,he,Ve,"°","\\degree",!0);Y(bt,he,Ve,"°","\\degree");Y(bt,he,Ve,"°","\\textdegree",!0);Y(ne,he,Ve,"£","\\pounds");Y(ne,he,Ve,"£","\\mathsterling",!0);Y(bt,he,Ve,"£","\\pounds");Y(bt,he,Ve,"£","\\textsterling",!0);Y(ne,Re,Ve,"✠","\\maltese");Y(bt,Re,Ve,"✠","\\maltese");var zz='0123456789/@."';for(var CT=0;CT<zz.length;CT++){var jz=zz.charAt(CT);Y(ne,he,Ve,jz,jz)}var Hz='0123456789!@*()-=+";:?/.,';for(var MT=0;MT<Hz.length;MT++){var $z=Hz.charAt(MT);Y(bt,he,Ve,$z,$z)}var Nw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var AT=0;AT<Nw.length;AT++){var ub=Nw.charAt(AT);Y(ne,he,ln,ub,ub),Y(bt,he,Ve,ub,ub)}Y(ne,Re,Ve,"C","ℂ");Y(bt,Re,Ve,"C","ℂ");Y(ne,Re,Ve,"H","ℍ");Y(bt,Re,Ve,"H","ℍ");Y(ne,Re,Ve,"N","ℕ");Y(bt,Re,Ve,"N","ℕ");Y(ne,Re,Ve,"P","ℙ");Y(bt,Re,Ve,"P","ℙ");Y(ne,Re,Ve,"Q","ℚ");Y(bt,Re,Ve,"Q","ℚ");Y(ne,Re,Ve,"R","ℝ");Y(bt,Re,Ve,"R","ℝ");Y(ne,Re,Ve,"Z","ℤ");Y(bt,Re,Ve,"Z","ℤ");Y(ne,he,ln,"h","ℎ");Y(bt,he,ln,"h","ℎ");var yn="";for(var Wa=0;Wa<Nw.length;Wa++){var yi=Nw.charAt(Wa);yn=String.fromCharCode(55349,56320+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56372+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56424+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56580+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56684+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56736+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56788+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56840+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56944+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),Wa<26&&(yn=String.fromCharCode(55349,56632+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn),yn=String.fromCharCode(55349,56476+Wa),Y(ne,he,ln,yi,yn),Y(bt,he,Ve,yi,yn))}yn="𝕜";Y(ne,he,ln,"k",yn);Y(bt,he,Ve,"k",yn);for(var ch=0;ch<10;ch++){var Rc=ch.toString();yn=String.fromCharCode(55349,57294+ch),Y(ne,he,ln,Rc,yn),Y(bt,he,Ve,Rc,yn),yn=String.fromCharCode(55349,57314+ch),Y(ne,he,ln,Rc,yn),Y(bt,he,Ve,Rc,yn),yn=String.fromCharCode(55349,57324+ch),Y(ne,he,ln,Rc,yn),Y(bt,he,Ve,Rc,yn),yn=String.fromCharCode(55349,57334+ch),Y(ne,he,ln,Rc,yn),Y(bt,he,Ve,Rc,yn)}var qI="ÐÞþ";for(var kT=0;kT<qI.length;kT++){var cb=qI.charAt(kT);Y(ne,he,ln,cb,cb),Y(bt,he,Ve,cb,cb)}var db=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],Vz=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],uBe=function(e,n){var r=e.charCodeAt(0),i=e.charCodeAt(1),a=(r-55296)*1024+(i-56320)+65536,s=n==="math"?0:1;if(119808<=a&&a<120484){var o=Math.floor((a-119808)/26);return[db[o][2],db[o][s]]}else if(120782<=a&&a<=120831){var l=Math.floor((a-120782)/10);return[Vz[l][2],Vz[l][s]]}else{if(a===120485||a===120486)return[db[0][2],db[0][s]];if(120486<a&&a<120782)return["",""];throw new Mt("Unsupported character: "+e)}},x3=function(e,n,r){return Hr[r][e]&&Hr[r][e].replace&&(e=Hr[r][e].replace),{value:e,metrics:zR(e,n,r)}},qo=function(e,n,r,i,a){var s=x3(e,n,r),o=s.metrics;e=s.value;var l;if(o){var u=o.italic;(r==="text"||i&&i.font==="mathit")&&(u=0),l=new _o(e,o.height,o.depth,u,o.skew,o.width,a)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+n+"' and mode '"+r+"'")),l=new _o(e,0,0,0,0,0,a);if(i){l.maxFontSize=i.sizeMultiplier,i.style.isTight()&&l.classes.push("mtight");var c=i.getColor();c&&(l.style.color=c)}return l},cBe=function(e,n,r,i){return i===void 0&&(i=[]),r.font==="boldsymbol"&&x3(e,"Main-Bold",n).metrics?qo(e,"Main-Bold",n,r,i.concat(["mathbf"])):e==="\\"||Hr[n][e].font==="main"?qo(e,"Main-Regular",n,r,i):qo(e,"AMS-Regular",n,r,i.concat(["amsrm"]))},dBe=function(e,n,r,i,a){return a!=="textord"&&x3(e,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},hBe=function(e,n,r){var i=e.mode,a=e.text,s=["mord"],o=i==="math"||i==="text"&&n.font,l=o?n.font:n.fontFamily,u="",c="";if(a.charCodeAt(0)===55349&&([u,c]=uBe(a,i)),u.length>0)return qo(a,u,i,n,s.concat(c));if(l){var d,h;if(l==="boldsymbol"){var f=dBe(a,i,n,s,r);d=f.fontName,h=[f.fontClass]}else o?(d=Zre[l].fontName,h=[l]):(d=hb(l,n.fontWeight,n.fontShape),h=[l,n.fontWeight,n.fontShape]);if(x3(a,d,i).metrics)return qo(a,d,i,n,s.concat(h));if(Yre.hasOwnProperty(a)&&d.slice(0,10)==="Typewriter"){for(var m=[],x=0;x<a.length;x++)m.push(qo(a[x],d,i,n,s.concat(h)));return Kre(m)}}if(r==="mathord")return qo(a,"Math-Italic",i,n,s.concat(["mathnormal"]));if(r==="textord"){var b=Hr[i][a]&&Hr[i][a].font;if(b==="ams"){var y=hb("amsrm",n.fontWeight,n.fontShape);return qo(a,y,i,n,s.concat("amsrm",n.fontWeight,n.fontShape))}else if(b==="main"||!b){var w=hb("textrm",n.fontWeight,n.fontShape);return qo(a,w,i,n,s.concat(n.fontWeight,n.fontShape))}else{var _=hb(b,n.fontWeight,n.fontShape);return qo(a,_,i,n,s.concat(_,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},fBe=(t,e)=>{if(od(t.classes)!==od(e.classes)||t.skew!==e.skew||t.maxFontSize!==e.maxFontSize)return!1;if(t.classes.length===1){var n=t.classes[0];if(n==="mbin"||n==="mord")return!1}for(var r in t.style)if(t.style.hasOwnProperty(r)&&t.style[r]!==e.style[r])return!1;for(var i in e.style)if(e.style.hasOwnProperty(i)&&t.style[i]!==e.style[i])return!1;return!0},pBe=t=>{for(var e=0;e<t.length-1;e++){var n=t[e],r=t[e+1];n instanceof _o&&r instanceof _o&&fBe(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,t.splice(e+1,1),e--)}return t},HR=function(e){for(var n=0,r=0,i=0,a=0;a<e.children.length;a++){var s=e.children[a];s.height>n&&(n=s.height),s.depth>r&&(r=s.depth),s.maxFontSize>i&&(i=s.maxFontSize)}e.height=n,e.depth=r,e.maxFontSize=i},ms=function(e,n,r,i){var a=new Lv(e,n,r,i);return HR(a),a},Xre=(t,e,n,r)=>new Lv(t,e,n,r),mBe=function(e,n,r){var i=ms([e],[],n);return i.height=Math.max(r||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),i.style.borderBottomWidth=Rt(i.height),i.maxFontSize=1,i},gBe=function(e,n,r,i){var a=new jR(e,n,r,i);return HR(a),a},Kre=function(e){var n=new Ov(e);return HR(n),n},vBe=function(e,n){return e instanceof Ov?ms([],[e],n):e},yBe=function(e){if(e.positionType==="individualShift"){for(var n=e.children,r=[n[0]],i=-n[0].shift-n[0].elem.depth,a=i,s=1;s<n.length;s++){var o=-n[s].shift-a-n[s].elem.depth,l=o-(n[s-1].elem.height+n[s-1].elem.depth);a=a+o,r.push({type:"kern",size:l}),r.push(n[s])}return{children:r,depth:i}}var u;if(e.positionType==="top"){for(var c=e.positionData,d=0;d<e.children.length;d++){var h=e.children[d];c-=h.type==="kern"?h.size:h.elem.height+h.elem.depth}u=c}else if(e.positionType==="bottom")u=-e.positionData;else{var f=e.children[0];if(f.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")u=-f.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")u=-f.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:u}},xBe=function(e,n){for(var{children:r,depth:i}=yBe(e),a=0,s=0;s<r.length;s++){var o=r[s];if(o.type==="elem"){var l=o.elem;a=Math.max(a,l.maxFontSize,l.height)}}a+=2;var u=ms(["pstrut"],[]);u.style.height=Rt(a);for(var c=[],d=i,h=i,f=i,m=0;m<r.length;m++){var x=r[m];if(x.type==="kern")f+=x.size;else{var b=x.elem,y=x.wrapperClasses||[],w=x.wrapperStyle||{},_=ms(y,[u,b],void 0,w);_.style.top=Rt(-a-f-b.depth),x.marginLeft&&(_.style.marginLeft=x.marginLeft),x.marginRight&&(_.style.marginRight=x.marginRight),c.push(_),f+=b.height+b.depth}d=Math.min(d,f),h=Math.max(h,f)}var S=ms(["vlist"],c);S.style.height=Rt(h);var M;if(d<0){var E=ms([],[]),C=ms(["vlist"],[E]);C.style.height=Rt(-d);var R=ms(["vlist-s"],[new _o("​")]);M=[ms(["vlist-r"],[S,R]),ms(["vlist-r"],[C])]}else M=[ms(["vlist-r"],[S])];var k=ms(["vlist-t"],M);return M.length===2&&k.classes.push("vlist-t2"),k.height=h,k.depth=-d,k},bBe=(t,e)=>{var n=ms(["mspace"],[],e),r=ci(t,e);return n.style.marginRight=Rt(r),n},hb=function(e,n,r){var i="";switch(e){case"amsrm":i="AMS";break;case"textrm":i="Main";break;case"textsf":i="SansSerif";break;case"texttt":i="Typewriter";break;default:i=e}var a;return n==="textbf"&&r==="textit"?a="BoldItalic":n==="textbf"?a="Bold":n==="textit"?a="Italic":a="Regular",i+"-"+a},Zre={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},Jre={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},_Be=function(e,n){var[r,i,a]=Jre[e],s=new ld(r),o=new ju([s],{width:Rt(i),height:Rt(a),style:"width:"+Rt(i),viewBox:"0 0 "+1e3*i+" "+1e3*a,preserveAspectRatio:"xMinYMin"}),l=Xre(["overlay"],[o],n);return l.height=a,l.style.height=Rt(a),l.style.width=Rt(i),l},tt={fontMap:Zre,makeSymbol:qo,mathsym:cBe,makeSpan:ms,makeSvgSpan:Xre,makeLineSpan:mBe,makeAnchor:gBe,makeFragment:Kre,wrapFragment:vBe,makeVList:xBe,makeOrd:hBe,makeGlue:bBe,staticSvg:_Be,svgData:Jre,tryCombineChars:pBe},oi={number:3,unit:"mu"},dh={number:4,unit:"mu"},Su={number:5,unit:"mu"},wBe={mord:{mop:oi,mbin:dh,mrel:Su,minner:oi},mop:{mord:oi,mop:oi,mrel:Su,minner:oi},mbin:{mord:dh,mop:dh,mopen:dh,minner:dh},mrel:{mord:Su,mop:Su,mopen:Su,minner:Su},mopen:{},mclose:{mop:oi,mbin:dh,mrel:Su,minner:oi},mpunct:{mord:oi,mop:oi,mrel:Su,mopen:oi,mclose:oi,mpunct:oi,minner:oi},minner:{mord:oi,mop:oi,mbin:dh,mrel:Su,mopen:oi,mpunct:oi,minner:oi}},SBe={mord:{mop:oi},mop:{mord:oi,mop:oi},mbin:{},mrel:{},mopen:{},mclose:{mop:oi},mpunct:{},minner:{mop:oi}},Qre={},Rw={},Pw={};function jt(t){for(var{type:e,names:n,props:r,handler:i,htmlBuilder:a,mathmlBuilder:s}=t,o={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:i},l=0;l<n.length;++l)Qre[n[l]]=o;e&&(a&&(Rw[e]=a),s&&(Pw[e]=s))}function _f(t){var{type:e,htmlBuilder:n,mathmlBuilder:r}=t;jt({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var Dw=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},Ci=function(e){return e.type==="ordgroup"?e.body:[e]},Hu=tt.makeSpan,EBe=["leftmost","mbin","mopen","mrel","mop","mpunct"],TBe=["rightmost","mrel","mclose","mpunct"],CBe={display:un.DISPLAY,text:un.TEXT,script:un.SCRIPT,scriptscript:un.SCRIPTSCRIPT},MBe={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},ea=function(e,n,r,i){i===void 0&&(i=[null,null]);for(var a=[],s=0;s<e.length;s++){var o=or(e[s],n);if(o instanceof Ov){var l=o.children;a.push(...l)}else a.push(o)}if(tt.tryCombineChars(a),!r)return a;var u=n;if(e.length===1){var c=e[0];c.type==="sizing"?u=n.havingSize(c.size):c.type==="styling"&&(u=n.havingStyle(CBe[c.style]))}var d=Hu([i[0]||"leftmost"],[],n),h=Hu([i[1]||"rightmost"],[],n),f=r==="root";return qz(a,(m,x)=>{var b=x.classes[0],y=m.classes[0];b==="mbin"&&TBe.includes(y)?x.classes[0]="mord":y==="mbin"&&EBe.includes(b)&&(m.classes[0]="mord")},{node:d},h,f),qz(a,(m,x)=>{var b=GI(x),y=GI(m),w=b&&y?m.hasClass("mtight")?SBe[b][y]:wBe[b][y]:null;if(w)return tt.makeGlue(w,u)},{node:d},h,f),a},qz=function t(e,n,r,i,a){i&&e.push(i);for(var s=0;s<e.length;s++){var o=e[s],l=eie(o);if(l){t(l.children,n,r,null,a);continue}var u=!o.hasClass("mspace");if(u){var c=n(o,r.node);c&&(r.insertAfter?r.insertAfter(c):(e.unshift(c),s++))}u?r.node=o:a&&o.hasClass("newline")&&(r.node=Hu(["leftmost"])),r.insertAfter=(d=>h=>{e.splice(d+1,0,h),s++})(s)}i&&e.pop()},eie=function(e){return e instanceof Ov||e instanceof jR||e instanceof Lv&&e.hasClass("enclosing")?e:null},ABe=function t(e,n){var r=eie(e);if(r){var i=r.children;if(i.length){if(n==="right")return t(i[i.length-1],"right");if(n==="left")return t(i[0],"left")}}return e},GI=function(e,n){return e?(n&&(e=ABe(e,n)),MBe[e.classes[0]]||null):null},Y1=function(e,n){var r=["nulldelimiter"].concat(e.baseSizingClasses());return Hu(n.concat(r))},or=function(e,n,r){if(!e)return Hu();if(Rw[e.type]){var i=Rw[e.type](e,n);if(r&&n.size!==r.size){i=Hu(n.sizingClasses(r),[i],n);var a=n.sizeMultiplier/r.sizeMultiplier;i.height*=a,i.depth*=a}return i}else throw new Mt("Got group of unknown type: '"+e.type+"'")};function fb(t,e){var n=Hu(["base"],t,e),r=Hu(["strut"]);return r.style.height=Rt(n.height+n.depth),n.depth&&(r.style.verticalAlign=Rt(-n.depth)),n.children.unshift(r),n}function WI(t,e){var n=null;t.length===1&&t[0].type==="tag"&&(n=t[0].tag,t=t[0].body);var r=ea(t,e,"root"),i;r.length===2&&r[1].hasClass("tag")&&(i=r.pop());for(var a=[],s=[],o=0;o<r.length;o++)if(s.push(r[o]),r[o].hasClass("mbin")||r[o].hasClass("mrel")||r[o].hasClass("allowbreak")){for(var l=!1;o<r.length-1&&r[o+1].hasClass("mspace")&&!r[o+1].hasClass("newline");)o++,s.push(r[o]),r[o].hasClass("nobreak")&&(l=!0);l||(a.push(fb(s,e)),s=[])}else r[o].hasClass("newline")&&(s.pop(),s.length>0&&(a.push(fb(s,e)),s=[]),a.push(r[o]));s.length>0&&a.push(fb(s,e));var u;n?(u=fb(ea(n,e,!0)),u.classes=["tag"],a.push(u)):i&&a.push(i);var c=Hu(["katex-html"],a);if(c.setAttribute("aria-hidden","true"),u){var d=u.children[0];d.style.height=Rt(c.height+c.depth),c.depth&&(d.style.verticalAlign=Rt(-c.depth))}return c}function tie(t){return new Ov(t)}class $s{constructor(e,n,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=n||[],this.classes=r||[]}setAttribute(e,n){this.attributes[e]=n}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&e.setAttribute(n,this.attributes[n]);this.classes.length>0&&(e.className=od(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof Dl&&this.children[r+1]instanceof Dl){for(var i=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof Dl;)i+=this.children[++r].toText();e.appendChild(new Dl(i).toNode())}else e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="',e+=hr.escape(this.attributes[n]),e+='"');this.classes.length>0&&(e+=' class ="'+hr.escape(od(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class Dl{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return hr.escape(this.toText())}toText(){return this.text}}class kBe{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character=" ":e>=.1666&&e<=.1667?this.character=" ":e>=.2222&&e<=.2223?this.character=" ":e>=.2777&&e<=.2778?this.character="  ":e>=-.05556&&e<=-.05555?this.character=" ⁣":e>=-.1667&&e<=-.1666?this.character=" ⁣":e>=-.2223&&e<=-.2222?this.character=" ⁣":e>=-.2778&&e<=-.2777?this.character=" ⁣":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",Rt(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+Rt(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var Tt={MathNode:$s,TextNode:Dl,SpaceNode:kBe,newDocumentFragment:tie},wo=function(e,n,r){return Hr[n][e]&&Hr[n][e].replace&&e.charCodeAt(0)!==55349&&!(Yre.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=Hr[n][e].replace),new Tt.TextNode(e)},$R=function(e){return e.length===1?e[0]:new Tt.MathNode("mrow",e)},VR=function(e,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var r=n.font;if(!r||r==="mathnormal")return null;var i=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var a=e.text;if(["\\imath","\\jmath"].includes(a))return null;Hr[i][a]&&Hr[i][a].replace&&(a=Hr[i][a].replace);var s=tt.fontMap[r].fontName;return zR(a,s,i)?tt.fontMap[r].variant:null};function IT(t){if(!t)return!1;if(t.type==="mi"&&t.children.length===1){var e=t.children[0];return e instanceof Dl&&e.text==="."}else if(t.type==="mo"&&t.children.length===1&&t.getAttribute("separator")==="true"&&t.getAttribute("lspace")==="0em"&&t.getAttribute("rspace")==="0em"){var n=t.children[0];return n instanceof Dl&&n.text===","}else return!1}var Ms=function(e,n,r){if(e.length===1){var i=Or(e[0],n);return r&&i instanceof $s&&i.type==="mo"&&(i.setAttribute("lspace","0em"),i.setAttribute("rspace","0em")),[i]}for(var a=[],s,o=0;o<e.length;o++){var l=Or(e[o],n);if(l instanceof $s&&s instanceof $s){if(l.type==="mtext"&&s.type==="mtext"&&l.getAttribute("mathvariant")===s.getAttribute("mathvariant")){s.children.push(...l.children);continue}else if(l.type==="mn"&&s.type==="mn"){s.children.push(...l.children);continue}else if(IT(l)&&s.type==="mn"){s.children.push(...l.children);continue}else if(l.type==="mn"&&IT(s))l.children=[...s.children,...l.children],a.pop();else if((l.type==="msup"||l.type==="msub")&&l.children.length>=1&&(s.type==="mn"||IT(s))){var u=l.children[0];u instanceof $s&&u.type==="mn"&&(u.children=[...s.children,...u.children],a.pop())}else if(s.type==="mi"&&s.children.length===1){var c=s.children[0];if(c instanceof Dl&&c.text==="̸"&&(l.type==="mo"||l.type==="mi"||l.type==="mn")){var d=l.children[0];d instanceof Dl&&d.text.length>0&&(d.text=d.text.slice(0,1)+"̸"+d.text.slice(1),a.pop())}}}a.push(l),s=l}return a},ud=function(e,n,r){return $R(Ms(e,n,r))},Or=function(e,n){if(!e)return new Tt.MathNode("mrow");if(Pw[e.type]){var r=Pw[e.type](e,n);return r}else throw new Mt("Got group of unknown type: '"+e.type+"'")};function Gz(t,e,n,r,i){var a=Ms(t,n),s;a.length===1&&a[0]instanceof $s&&["mrow","mtable"].includes(a[0].type)?s=a[0]:s=new Tt.MathNode("mrow",a);var o=new Tt.MathNode("annotation",[new Tt.TextNode(e)]);o.setAttribute("encoding","application/x-tex");var l=new Tt.MathNode("semantics",[s,o]),u=new Tt.MathNode("math",[l]);u.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&u.setAttribute("display","block");var c=i?"katex":"katex-mathml";return tt.makeSpan([c],[u])}var nie=function(e){return new Au({style:e.displayMode?un.DISPLAY:un.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},rie=function(e,n){if(n.displayMode){var r=["katex-display"];n.leqno&&r.push("leqno"),n.fleqn&&r.push("fleqn"),e=tt.makeSpan(r,[e])}return e},IBe=function(e,n,r){var i=nie(r),a;if(r.output==="mathml")return Gz(e,n,i,r.displayMode,!0);if(r.output==="html"){var s=WI(e,i);a=tt.makeSpan(["katex"],[s])}else{var o=Gz(e,n,i,r.displayMode,!1),l=WI(e,i);a=tt.makeSpan(["katex"],[o,l])}return rie(a,r)},NBe=function(e,n,r){var i=nie(r),a=WI(e,i),s=tt.makeSpan(["katex"],[a]);return rie(s,r)},RBe={widehat:"^",widecheck:"ˇ",widetilde:"~",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",undergroup:"⏡",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xrightleftarrows:"⇄",xrightequilibrium:"⇌",xleftequilibrium:"⇋","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},PBe=function(e){var n=new Tt.MathNode("mo",[new Tt.TextNode(RBe[e.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},DBe={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},OBe=function(e){return e.type==="ordgroup"?e.body.length:1},LBe=function(e,n){function r(){var o=4e5,l=e.label.slice(1);if(["widehat","widecheck","widetilde","utilde"].includes(l)){var u=e,c=OBe(u.base),d,h,f;if(c>5)l==="widehat"||l==="widecheck"?(d=420,o=2364,f=.42,h=l+"4"):(d=312,o=2340,f=.34,h="tilde4");else{var m=[1,1,2,2,3,3][c];l==="widehat"||l==="widecheck"?(o=[0,1062,2364,2364,2364][m],d=[0,239,300,360,420][m],f=[0,.24,.3,.3,.36,.42][m],h=l+m):(o=[0,600,1033,2339,2340][m],d=[0,260,286,306,312][m],f=[0,.26,.286,.3,.306,.34][m],h="tilde"+m)}var x=new ld(h),b=new ju([x],{width:"100%",height:Rt(f),viewBox:"0 0 "+o+" "+d,preserveAspectRatio:"none"});return{span:tt.makeSvgSpan([],[b],n),minWidth:0,height:f}}else{var y=[],w=DBe[l],[_,S,M]=w,E=M/1e3,C=_.length,R,k;if(C===1){var I=w[3];R=["hide-tail"],k=[I]}else if(C===2)R=["halfarrow-left","halfarrow-right"],k=["xMinYMin","xMaxYMin"];else if(C===3)R=["brace-left","brace-center","brace-right"],k=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+C+" children.");for(var N=0;N<C;N++){var D=new ld(_[N]),F=new ju([D],{width:"400em",height:Rt(E),viewBox:"0 0 "+o+" "+M,preserveAspectRatio:k[N]+" slice"}),L=tt.makeSvgSpan([R[N]],[F],n);if(C===1)return{span:L,minWidth:S,height:E};L.style.height=Rt(E),y.push(L)}return{span:tt.makeSpan(["stretchy"],y,n),minWidth:S,height:E}}}var{span:i,minWidth:a,height:s}=r();return i.height=s,i.style.height=Rt(s),a>0&&(i.style.minWidth=Rt(a)),i},FBe=function(e,n,r,i,a){var s,o=e.height+e.depth+r+i;if(/fbox|color|angl/.test(n)){if(s=tt.makeSpan(["stretchy",n],[],a),n==="fbox"){var l=a.color&&a.getColor();l&&(s.style.borderColor=l)}}else{var u=[];/^[bx]cancel$/.test(n)&&u.push(new VI({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&u.push(new VI({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new ju(u,{width:"100%",height:Rt(o)});s=tt.makeSvgSpan([],[c],a)}return s.height=o,s.style.height=Rt(o),s},$u={encloseSpan:FBe,mathMLnode:PBe,svgSpan:LBe};function Pn(t,e){if(!t||t.type!==e)throw new Error("Expected node of type "+e+", but got "+(t?"node of type "+t.type:String(t)));return t}function qR(t){var e=b3(t);if(!e)throw new Error("Expected node of symbol group type, but got "+(t?"node of type "+t.type:String(t)));return e}function b3(t){return t&&(t.type==="atom"||lBe.hasOwnProperty(t.type))?t:null}var GR=(t,e)=>{var n,r,i;t&&t.type==="supsub"?(r=Pn(t.base,"accent"),n=r.base,t.base=n,i=sBe(or(t,e)),t.base=r):(r=Pn(t,"accent"),n=r.base);var a=or(n,e.havingCrampedStyle()),s=r.isShifty&&hr.isCharacterBox(n),o=0;if(s){var l=hr.getBaseElem(n),u=or(l,e.havingCrampedStyle());o=Uz(u).skew}var c=r.label==="\\c",d=c?a.height+a.depth:Math.min(a.height,e.fontMetrics().xHeight),h;if(r.isStretchy)h=$u.svgSpan(r,e),h=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"elem",elem:h,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+Rt(2*o)+")",marginLeft:Rt(2*o)}:void 0}]},e);else{var f,m;r.label==="\\vec"?(f=tt.staticSvg("vec",e),m=tt.svgData.vec[1]):(f=tt.makeOrd({mode:r.mode,text:r.label},e,"textord"),f=Uz(f),f.italic=0,m=f.width,c&&(d+=f.depth)),h=tt.makeSpan(["accent-body"],[f]);var x=r.label==="\\textcircled";x&&(h.classes.push("accent-full"),d=a.height);var b=o;x||(b-=m/2),h.style.left=Rt(b),r.label==="\\textcircled"&&(h.style.top=".2em"),h=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"kern",size:-d},{type:"elem",elem:h}]},e)}var y=tt.makeSpan(["mord","accent"],[h],e);return i?(i.children[0]=y,i.height=Math.max(y.height,i.height),i.classes[0]="mord",i):y},iie=(t,e)=>{var n=t.isStretchy?$u.mathMLnode(t.label):new Tt.MathNode("mo",[wo(t.label,t.mode)]),r=new Tt.MathNode("mover",[Or(t.base,e),n]);return r.setAttribute("accent","true"),r},BBe=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(t=>"\\"+t).join("|"));jt({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(t,e)=>{var n=Dw(e[0]),r=!BBe.test(t.funcName),i=!r||t.funcName==="\\widehat"||t.funcName==="\\widetilde"||t.funcName==="\\widecheck";return{type:"accent",mode:t.parser.mode,label:t.funcName,isStretchy:r,isShifty:i,base:n}},htmlBuilder:GR,mathmlBuilder:iie});jt({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(t,e)=>{var n=e[0],r=t.parser.mode;return r==="math"&&(t.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+t.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:t.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:GR,mathmlBuilder:iie});jt({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0];return{type:"accentUnder",mode:n.mode,label:r,base:i}},htmlBuilder:(t,e)=>{var n=or(t.base,e),r=$u.svgSpan(t,e),i=t.label==="\\utilde"?.12:0,a=tt.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:i},{type:"elem",elem:n}]},e);return tt.makeSpan(["mord","accentunder"],[a],e)},mathmlBuilder:(t,e)=>{var n=$u.mathMLnode(t.label),r=new Tt.MathNode("munder",[Or(t.base,e),n]);return r.setAttribute("accentunder","true"),r}});var pb=t=>{var e=new Tt.MathNode("mpadded",t?[t]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};jt({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r,funcName:i}=t;return{type:"xArrow",mode:r.mode,label:i,body:e[0],below:n[0]}},htmlBuilder(t,e){var n=e.style,r=e.havingStyle(n.sup()),i=tt.wrapFragment(or(t.body,r,e),e),a=t.label.slice(0,2)==="\\x"?"x":"cd";i.classes.push(a+"-arrow-pad");var s;t.below&&(r=e.havingStyle(n.sub()),s=tt.wrapFragment(or(t.below,r,e),e),s.classes.push(a+"-arrow-pad"));var o=$u.svgSpan(t,e),l=-e.fontMetrics().axisHeight+.5*o.height,u=-e.fontMetrics().axisHeight-.5*o.height-.111;(i.depth>.25||t.label==="\\xleftequilibrium")&&(u-=i.depth);var c;if(s){var d=-e.fontMetrics().axisHeight+s.height+.5*o.height+.111;c=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:u},{type:"elem",elem:o,shift:l},{type:"elem",elem:s,shift:d}]},e)}else c=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:u},{type:"elem",elem:o,shift:l}]},e);return c.children[0].children[0].children[1].classes.push("svg-align"),tt.makeSpan(["mrel","x-arrow"],[c],e)},mathmlBuilder(t,e){var n=$u.mathMLnode(t.label);n.setAttribute("minsize",t.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(t.body){var i=pb(Or(t.body,e));if(t.below){var a=pb(Or(t.below,e));r=new Tt.MathNode("munderover",[n,a,i])}else r=new Tt.MathNode("mover",[n,i])}else if(t.below){var s=pb(Or(t.below,e));r=new Tt.MathNode("munder",[n,s])}else r=pb(),r=new Tt.MathNode("mover",[n,r]);return r}});var UBe=tt.makeSpan;function aie(t,e){var n=ea(t.body,e,!0);return UBe([t.mclass],n,e)}function sie(t,e){var n,r=Ms(t.body,e);return t.mclass==="minner"?n=new Tt.MathNode("mpadded",r):t.mclass==="mord"?t.isCharacterBox?(n=r[0],n.type="mi"):n=new Tt.MathNode("mi",r):(t.isCharacterBox?(n=r[0],n.type="mo"):n=new Tt.MathNode("mo",r),t.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):t.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):t.mclass==="mopen"||t.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):t.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}jt({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(t,e){var{parser:n,funcName:r}=t,i=e[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:Ci(i),isCharacterBox:hr.isCharacterBox(i)}},htmlBuilder:aie,mathmlBuilder:sie});var _3=t=>{var e=t.type==="ordgroup"&&t.body.length?t.body[0]:t;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};jt({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(t,e){var{parser:n}=t;return{type:"mclass",mode:n.mode,mclass:_3(e[0]),body:Ci(e[1]),isCharacterBox:hr.isCharacterBox(e[1])}}});jt({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(t,e){var{parser:n,funcName:r}=t,i=e[1],a=e[0],s;r!=="\\stackrel"?s=_3(i):s="mrel";var o={type:"op",mode:i.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:Ci(i)},l={type:"supsub",mode:a.mode,base:o,sup:r==="\\underset"?null:a,sub:r==="\\underset"?a:null};return{type:"mclass",mode:n.mode,mclass:s,body:[l],isCharacterBox:hr.isCharacterBox(l)}},htmlBuilder:aie,mathmlBuilder:sie});jt({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"pmb",mode:n.mode,mclass:_3(e[0]),body:Ci(e[0])}},htmlBuilder(t,e){var n=ea(t.body,e,!0),r=tt.makeSpan([t.mclass],n,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(t,e){var n=Ms(t.body,e),r=new Tt.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var zBe={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},Wz=()=>({type:"styling",body:[],mode:"math",style:"display"}),Yz=t=>t.type==="textord"&&t.text==="@",jBe=(t,e)=>(t.type==="mathord"||t.type==="atom")&&t.text===e;function HBe(t,e,n){var r=zBe[t];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var i=n.callFunction("\\\\cdleft",[e[0]],[]),a={type:"atom",text:r,mode:"math",family:"rel"},s=n.callFunction("\\Big",[a],[]),o=n.callFunction("\\\\cdright",[e[1]],[]),l={type:"ordgroup",mode:"math",body:[i,s,o]};return n.callFunction("\\\\cdparent",[l],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var u={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[u],[])}default:return{type:"textord",text:" ",mode:"math"}}}function $Be(t){var e=[];for(t.gullet.beginGroup(),t.gullet.macros.set("\\cr","\\\\\\relax"),t.gullet.beginGroup();;){e.push(t.parseExpression(!1,"\\\\")),t.gullet.endGroup(),t.gullet.beginGroup();var n=t.fetch().text;if(n==="&"||n==="\\\\")t.consume();else if(n==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new Mt("Expected \\\\ or \\cr or \\end",t.nextToken)}for(var r=[],i=[r],a=0;a<e.length;a++){for(var s=e[a],o=Wz(),l=0;l<s.length;l++)if(!Yz(s[l]))o.body.push(s[l]);else{r.push(o),l+=1;var u=qR(s[l]).text,c=new Array(2);if(c[0]={type:"ordgroup",mode:"math",body:[]},c[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(u)>-1))if("<>AV".indexOf(u)>-1)for(var d=0;d<2;d++){for(var h=!0,f=l+1;f<s.length;f++){if(jBe(s[f],u)){h=!1,l=f;break}if(Yz(s[f]))throw new Mt("Missing a "+u+" character to complete a CD arrow.",s[f]);c[d].body.push(s[f])}if(h)throw new Mt("Missing a "+u+" character to complete a CD arrow.",s[l])}else throw new Mt('Expected one of "<>AV=|." after @',s[l]);var m=HBe(u,c,t),x={type:"styling",body:[m],mode:"math",style:"display"};r.push(x),o=Wz()}a%2===0?r.push(o):r.shift(),r=[],i.push(r)}t.gullet.endGroup(),t.gullet.endGroup();var b=new Array(i[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:i,arraystretch:1,addJot:!0,rowGaps:[null],cols:b,colSeparationType:"CD",hLinesBeforeRow:new Array(i.length+1).fill([])}}jt({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:e[0]}},htmlBuilder(t,e){var n=e.havingStyle(e.style.sup()),r=tt.wrapFragment(or(t.label,n,e),e);return r.classes.push("cd-label-"+t.side),r.style.bottom=Rt(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(t,e){var n=new Tt.MathNode("mrow",[Or(t.label,e)]);return n=new Tt.MathNode("mpadded",[n]),n.setAttribute("width","0"),t.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new Tt.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}});jt({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(t,e){var{parser:n}=t;return{type:"cdlabelparent",mode:n.mode,fragment:e[0]}},htmlBuilder(t,e){var n=tt.wrapFragment(or(t.fragment,e),e);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(t,e){return new Tt.MathNode("mrow",[Or(t.fragment,e)])}});jt({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(t,e){for(var{parser:n}=t,r=Pn(e[0],"ordgroup"),i=r.body,a="",s=0;s<i.length;s++){var o=Pn(i[s],"textord");a+=o.text}var l=parseInt(a),u;if(isNaN(l))throw new Mt("\\@char has non-numeric argument "+a);if(l<0||l>=1114111)throw new Mt("\\@char with invalid code point "+a);return l<=65535?u=String.fromCharCode(l):(l-=65536,u=String.fromCharCode((l>>10)+55296,(l&1023)+56320)),{type:"textord",mode:n.mode,text:u}}});var oie=(t,e)=>{var n=ea(t.body,e.withColor(t.color),!1);return tt.makeFragment(n)},lie=(t,e)=>{var n=Ms(t.body,e.withColor(t.color)),r=new Tt.MathNode("mstyle",n);return r.setAttribute("mathcolor",t.color),r};jt({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(t,e){var{parser:n}=t,r=Pn(e[0],"color-token").color,i=e[1];return{type:"color",mode:n.mode,color:r,body:Ci(i)}},htmlBuilder:oie,mathmlBuilder:lie});jt({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(t,e){var{parser:n,breakOnTokenText:r}=t,i=Pn(e[0],"color-token").color;n.gullet.macros.set("\\current@color",i);var a=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:i,body:a}},htmlBuilder:oie,mathmlBuilder:lie});jt({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(t,e,n){var{parser:r}=t,i=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,a=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:a,size:i&&Pn(i,"size").value}},htmlBuilder(t,e){var n=tt.makeSpan(["mspace"],[],e);return t.newLine&&(n.classes.push("newline"),t.size&&(n.style.marginTop=Rt(ci(t.size,e)))),n},mathmlBuilder(t,e){var n=new Tt.MathNode("mspace");return t.newLine&&(n.setAttribute("linebreak","newline"),t.size&&n.setAttribute("height",Rt(ci(t.size,e)))),n}});var YI={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},uie=t=>{var e=t.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new Mt("Expected a control sequence",t);return e},VBe=t=>{var e=t.gullet.popToken();return e.text==="="&&(e=t.gullet.popToken(),e.text===" "&&(e=t.gullet.popToken())),e},cie=(t,e,n,r)=>{var i=t.gullet.macros.get(n.text);i==null&&(n.noexpand=!0,i={tokens:[n],numArgs:0,unexpandable:!t.gullet.isExpandable(n.text)}),t.gullet.macros.set(e,i,r)};jt({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(t){var{parser:e,funcName:n}=t;e.consumeSpaces();var r=e.fetch();if(YI[r.text])return(n==="\\global"||n==="\\\\globallong")&&(r.text=YI[r.text]),Pn(e.parseFunction(),"internal");throw new Mt("Invalid token after macro prefix",r)}});jt({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=e.gullet.popToken(),i=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(i))throw new Mt("Expected a control sequence",r);for(var a=0,s,o=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){s=e.gullet.future(),o[a].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new Mt('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==a+1)throw new Mt('Argument number "'+r.text+'" out of order');a++,o.push([])}else{if(r.text==="EOF")throw new Mt("Expected a macro definition");o[a].push(r.text)}var{tokens:l}=e.gullet.consumeArg();return s&&l.unshift(s),(n==="\\edef"||n==="\\xdef")&&(l=e.gullet.expandTokens(l),l.reverse()),e.gullet.macros.set(i,{tokens:l,numArgs:a,delimiters:o},n===YI[n]),{type:"internal",mode:e.mode}}});jt({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=uie(e.gullet.popToken());e.gullet.consumeSpaces();var i=VBe(e);return cie(e,r,i,n==="\\\\globallet"),{type:"internal",mode:e.mode}}});jt({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=uie(e.gullet.popToken()),i=e.gullet.popToken(),a=e.gullet.popToken();return cie(e,r,a,n==="\\\\globalfuture"),e.gullet.pushToken(a),e.gullet.pushToken(i),{type:"internal",mode:e.mode}}});var xg=function(e,n,r){var i=Hr.math[e]&&Hr.math[e].replace,a=zR(i||e,n,r);if(!a)throw new Error("Unsupported symbol "+e+" and font size "+n+".");return a},WR=function(e,n,r,i){var a=r.havingBaseStyle(n),s=tt.makeSpan(i.concat(a.sizingClasses(r)),[e],r),o=a.sizeMultiplier/r.sizeMultiplier;return s.height*=o,s.depth*=o,s.maxFontSize=a.sizeMultiplier,s},die=function(e,n,r){var i=n.havingBaseStyle(r),a=(1-n.sizeMultiplier/i.sizeMultiplier)*n.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=Rt(a),e.height-=a,e.depth+=a},qBe=function(e,n,r,i,a,s){var o=tt.makeSymbol(e,"Main-Regular",a,i),l=WR(o,n,i,s);return r&&die(l,i,n),l},GBe=function(e,n,r,i){return tt.makeSymbol(e,"Size"+n+"-Regular",r,i)},hie=function(e,n,r,i,a,s){var o=GBe(e,n,a,i),l=WR(tt.makeSpan(["delimsizing","size"+n],[o],i),un.TEXT,i,s);return r&&die(l,i,un.TEXT),l},NT=function(e,n,r){var i;n==="Size1-Regular"?i="delim-size1":i="delim-size4";var a=tt.makeSpan(["delimsizinginner",i],[tt.makeSpan([],[tt.makeSymbol(e,n,r)])]);return{type:"elem",elem:a}},RT=function(e,n,r){var i=Pl["Size4-Regular"][e.charCodeAt(0)]?Pl["Size4-Regular"][e.charCodeAt(0)][4]:Pl["Size1-Regular"][e.charCodeAt(0)][4],a=new ld("inner",ZFe(e,Math.round(1e3*n))),s=new ju([a],{width:Rt(i),height:Rt(n),style:"width:"+Rt(i),viewBox:"0 0 "+1e3*i+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),o=tt.makeSvgSpan([],[s],r);return o.height=n,o.style.height=Rt(n),o.style.width=Rt(i),{type:"elem",elem:o}},XI=.008,mb={type:"kern",size:-1*XI},WBe=["|","\\lvert","\\rvert","\\vert"],YBe=["\\|","\\lVert","\\rVert","\\Vert"],fie=function(e,n,r,i,a,s){var o,l,u,c,d="",h=0;o=u=c=e,l=null;var f="Size1-Regular";e==="\\uparrow"?u=c="⏐":e==="\\Uparrow"?u=c="‖":e==="\\downarrow"?o=u="⏐":e==="\\Downarrow"?o=u="‖":e==="\\updownarrow"?(o="\\uparrow",u="⏐",c="\\downarrow"):e==="\\Updownarrow"?(o="\\Uparrow",u="‖",c="\\Downarrow"):WBe.includes(e)?(u="∣",d="vert",h=333):YBe.includes(e)?(u="∥",d="doublevert",h=556):e==="["||e==="\\lbrack"?(o="⎡",u="⎢",c="⎣",f="Size4-Regular",d="lbrack",h=667):e==="]"||e==="\\rbrack"?(o="⎤",u="⎥",c="⎦",f="Size4-Regular",d="rbrack",h=667):e==="\\lfloor"||e==="⌊"?(u=o="⎢",c="⎣",f="Size4-Regular",d="lfloor",h=667):e==="\\lceil"||e==="⌈"?(o="⎡",u=c="⎢",f="Size4-Regular",d="lceil",h=667):e==="\\rfloor"||e==="⌋"?(u=o="⎥",c="⎦",f="Size4-Regular",d="rfloor",h=667):e==="\\rceil"||e==="⌉"?(o="⎤",u=c="⎥",f="Size4-Regular",d="rceil",h=667):e==="("||e==="\\lparen"?(o="⎛",u="⎜",c="⎝",f="Size4-Regular",d="lparen",h=875):e===")"||e==="\\rparen"?(o="⎞",u="⎟",c="⎠",f="Size4-Regular",d="rparen",h=875):e==="\\{"||e==="\\lbrace"?(o="⎧",l="⎨",c="⎩",u="⎪",f="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(o="⎫",l="⎬",c="⎭",u="⎪",f="Size4-Regular"):e==="\\lgroup"||e==="⟮"?(o="⎧",c="⎩",u="⎪",f="Size4-Regular"):e==="\\rgroup"||e==="⟯"?(o="⎫",c="⎭",u="⎪",f="Size4-Regular"):e==="\\lmoustache"||e==="⎰"?(o="⎧",c="⎭",u="⎪",f="Size4-Regular"):(e==="\\rmoustache"||e==="⎱")&&(o="⎫",c="⎩",u="⎪",f="Size4-Regular");var m=xg(o,f,a),x=m.height+m.depth,b=xg(u,f,a),y=b.height+b.depth,w=xg(c,f,a),_=w.height+w.depth,S=0,M=1;if(l!==null){var E=xg(l,f,a);S=E.height+E.depth,M=2}var C=x+_+S,R=Math.max(0,Math.ceil((n-C)/(M*y))),k=C+R*M*y,I=i.fontMetrics().axisHeight;r&&(I*=i.sizeMultiplier);var N=k/2-I,D=[];if(d.length>0){var F=k-x-_,L=Math.round(k*1e3),U=JFe(d,Math.round(F*1e3)),j=new ld(d,U),q=(h/1e3).toFixed(3)+"em",Z=(L/1e3).toFixed(3)+"em",Q=new ju([j],{width:q,height:Z,viewBox:"0 0 "+h+" "+L}),z=tt.makeSvgSpan([],[Q],i);z.height=L/1e3,z.style.width=q,z.style.height=Z,D.push({type:"elem",elem:z})}else{if(D.push(NT(c,f,a)),D.push(mb),l===null){var W=k-x-_+2*XI;D.push(RT(u,W,i))}else{var X=(k-x-_-S)/2+2*XI;D.push(RT(u,X,i)),D.push(mb),D.push(NT(l,f,a)),D.push(mb),D.push(RT(u,X,i))}D.push(mb),D.push(NT(o,f,a))}var H=i.havingBaseStyle(un.TEXT),J=tt.makeVList({positionType:"bottom",positionData:N,children:D},H);return WR(tt.makeSpan(["delimsizing","mult"],[J],H),un.TEXT,i,s)},PT=80,DT=.08,OT=function(e,n,r,i,a){var s=KFe(e,i,r),o=new ld(e,s),l=new ju([o],{width:"400em",height:Rt(n),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return tt.makeSvgSpan(["hide-tail"],[l],a)},XBe=function(e,n){var r=n.havingBaseSizing(),i=vie("\\surd",e*r.sizeMultiplier,gie,r),a=r.sizeMultiplier,s=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),o,l=0,u=0,c=0,d;return i.type==="small"?(c=1e3+1e3*s+PT,e<1?a=1:e<1.4&&(a=.7),l=(1+s+DT)/a,u=(1+s)/a,o=OT("sqrtMain",l,c,s,n),o.style.minWidth="0.853em",d=.833/a):i.type==="large"?(c=(1e3+PT)*Xg[i.size],u=(Xg[i.size]+s)/a,l=(Xg[i.size]+s+DT)/a,o=OT("sqrtSize"+i.size,l,c,s,n),o.style.minWidth="1.02em",d=1/a):(l=e+s+DT,u=e+s,c=Math.floor(1e3*e+s)+PT,o=OT("sqrtTall",l,c,s,n),o.style.minWidth="0.742em",d=1.056),o.height=u,o.style.height=Rt(l),{span:o,advanceWidth:d,ruleWidth:(n.fontMetrics().sqrtRuleThickness+s)*a}},pie=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","\\surd"],KBe=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱"],mie=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Xg=[0,1.2,1.8,2.4,3],ZBe=function(e,n,r,i,a){if(e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle"),pie.includes(e)||mie.includes(e))return hie(e,n,!1,r,i,a);if(KBe.includes(e))return fie(e,Xg[n],!1,r,i,a);throw new Mt("Illegal delimiter: '"+e+"'")},JBe=[{type:"small",style:un.SCRIPTSCRIPT},{type:"small",style:un.SCRIPT},{type:"small",style:un.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],QBe=[{type:"small",style:un.SCRIPTSCRIPT},{type:"small",style:un.SCRIPT},{type:"small",style:un.TEXT},{type:"stack"}],gie=[{type:"small",style:un.SCRIPTSCRIPT},{type:"small",style:un.SCRIPT},{type:"small",style:un.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],eUe=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},vie=function(e,n,r,i){for(var a=Math.min(2,3-i.style.size),s=a;s<r.length&&r[s].type!=="stack";s++){var o=xg(e,eUe(r[s]),"math"),l=o.height+o.depth;if(r[s].type==="small"){var u=i.havingBaseStyle(r[s].style);l*=u.sizeMultiplier}if(l>n)return r[s]}return r[r.length-1]},yie=function(e,n,r,i,a,s){e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle");var o;mie.includes(e)?o=JBe:pie.includes(e)?o=gie:o=QBe;var l=vie(e,n,o,i);return l.type==="small"?qBe(e,l.style,r,i,a,s):l.type==="large"?hie(e,l.size,r,i,a,s):fie(e,n,r,i,a,s)},tUe=function(e,n,r,i,a,s){var o=i.fontMetrics().axisHeight*i.sizeMultiplier,l=901,u=5/i.fontMetrics().ptPerEm,c=Math.max(n-o,r+o),d=Math.max(c/500*l,2*c-u);return yie(e,d,!0,i,a,s)},Fu={sqrtImage:XBe,sizedDelim:ZBe,sizeToMaxHeight:Xg,customSizedDelim:yie,leftRightDelim:tUe},Xz={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},nUe=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function w3(t,e){var n=b3(t);if(n&&nUe.includes(n.text))return n;throw n?new Mt("Invalid delimiter '"+n.text+"' after '"+e.funcName+"'",t):new Mt("Invalid delimiter type '"+t.type+"'",t)}jt({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(t,e)=>{var n=w3(e[0],t);return{type:"delimsizing",mode:t.parser.mode,size:Xz[t.funcName].size,mclass:Xz[t.funcName].mclass,delim:n.text}},htmlBuilder:(t,e)=>t.delim==="."?tt.makeSpan([t.mclass]):Fu.sizedDelim(t.delim,t.size,e,t.mode,[t.mclass]),mathmlBuilder:t=>{var e=[];t.delim!=="."&&e.push(wo(t.delim,t.mode));var n=new Tt.MathNode("mo",e);t.mclass==="mopen"||t.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=Rt(Fu.sizeToMaxHeight[t.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}});function Kz(t){if(!t.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}jt({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=t.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new Mt("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:t.parser.mode,delim:w3(e[0],t).text,color:n}}});jt({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=w3(e[0],t),r=t.parser;++r.leftrightDepth;var i=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var a=Pn(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:i,left:n.text,right:a.delim,rightColor:a.color}},htmlBuilder:(t,e)=>{Kz(t);for(var n=ea(t.body,e,!0,["mopen","mclose"]),r=0,i=0,a=!1,s=0;s<n.length;s++)n[s].isMiddle?a=!0:(r=Math.max(n[s].height,r),i=Math.max(n[s].depth,i));r*=e.sizeMultiplier,i*=e.sizeMultiplier;var o;if(t.left==="."?o=Y1(e,["mopen"]):o=Fu.leftRightDelim(t.left,r,i,e,t.mode,["mopen"]),n.unshift(o),a)for(var l=1;l<n.length;l++){var u=n[l],c=u.isMiddle;c&&(n[l]=Fu.leftRightDelim(c.delim,r,i,c.options,t.mode,[]))}var d;if(t.right===".")d=Y1(e,["mclose"]);else{var h=t.rightColor?e.withColor(t.rightColor):e;d=Fu.leftRightDelim(t.right,r,i,h,t.mode,["mclose"])}return n.push(d),tt.makeSpan(["minner"],n,e)},mathmlBuilder:(t,e)=>{Kz(t);var n=Ms(t.body,e);if(t.left!=="."){var r=new Tt.MathNode("mo",[wo(t.left,t.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if(t.right!=="."){var i=new Tt.MathNode("mo",[wo(t.right,t.mode)]);i.setAttribute("fence","true"),t.rightColor&&i.setAttribute("mathcolor",t.rightColor),n.push(i)}return $R(n)}});jt({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=w3(e[0],t);if(!t.parser.leftrightDepth)throw new Mt("\\middle without preceding \\left",n);return{type:"middle",mode:t.parser.mode,delim:n.text}},htmlBuilder:(t,e)=>{var n;if(t.delim===".")n=Y1(e,[]);else{n=Fu.sizedDelim(t.delim,1,e,t.mode,[]);var r={delim:t.delim,options:e};n.isMiddle=r}return n},mathmlBuilder:(t,e)=>{var n=t.delim==="\\vert"||t.delim==="|"?wo("|","text"):wo(t.delim,t.mode),r=new Tt.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var YR=(t,e)=>{var n=tt.wrapFragment(or(t.body,e),e),r=t.label.slice(1),i=e.sizeMultiplier,a,s=0,o=hr.isCharacterBox(t.body);if(r==="sout")a=tt.makeSpan(["stretchy","sout"]),a.height=e.fontMetrics().defaultRuleThickness/i,s=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var l=ci({number:.6,unit:"pt"},e),u=ci({number:.35,unit:"ex"},e),c=e.havingBaseSizing();i=i/c.sizeMultiplier;var d=n.height+n.depth+l+u;n.style.paddingLeft=Rt(d/2+l);var h=Math.floor(1e3*d*i),f=YFe(h),m=new ju([new ld("phase",f)],{width:"400em",height:Rt(h/1e3),viewBox:"0 0 400000 "+h,preserveAspectRatio:"xMinYMin slice"});a=tt.makeSvgSpan(["hide-tail"],[m],e),a.style.height=Rt(d),s=n.depth+l+u}else{/cancel/.test(r)?o||n.classes.push("cancel-pad"):r==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var x=0,b=0,y=0;/box/.test(r)?(y=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),x=e.fontMetrics().fboxsep+(r==="colorbox"?0:y),b=x):r==="angl"?(y=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),x=4*y,b=Math.max(0,.25-n.depth)):(x=o?.2:0,b=x),a=$u.encloseSpan(n,r,x,b,e),/fbox|boxed|fcolorbox/.test(r)?(a.style.borderStyle="solid",a.style.borderWidth=Rt(y)):r==="angl"&&y!==.049&&(a.style.borderTopWidth=Rt(y),a.style.borderRightWidth=Rt(y)),s=n.depth+b,t.backgroundColor&&(a.style.backgroundColor=t.backgroundColor,t.borderColor&&(a.style.borderColor=t.borderColor))}var w;if(t.backgroundColor)w=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:s},{type:"elem",elem:n,shift:0}]},e);else{var _=/cancel|phase/.test(r)?["svg-align"]:[];w=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:a,shift:s,wrapperClasses:_}]},e)}return/cancel/.test(r)&&(w.height=n.height,w.depth=n.depth),/cancel/.test(r)&&!o?tt.makeSpan(["mord","cancel-lap"],[w],e):tt.makeSpan(["mord"],[w],e)},XR=(t,e)=>{var n=0,r=new Tt.MathNode(t.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Or(t.body,e)]);switch(t.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),t.label==="\\fcolorbox"){var i=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+i+"em solid "+String(t.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return t.backgroundColor&&r.setAttribute("mathbackground",t.backgroundColor),r};jt({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(t,e,n){var{parser:r,funcName:i}=t,a=Pn(e[0],"color-token").color,s=e[1];return{type:"enclose",mode:r.mode,label:i,backgroundColor:a,body:s}},htmlBuilder:YR,mathmlBuilder:XR});jt({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(t,e,n){var{parser:r,funcName:i}=t,a=Pn(e[0],"color-token").color,s=Pn(e[1],"color-token").color,o=e[2];return{type:"enclose",mode:r.mode,label:i,backgroundColor:s,borderColor:a,body:o}},htmlBuilder:YR,mathmlBuilder:XR});jt({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\fbox",body:e[0]}}});jt({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t,i=e[0];return{type:"enclose",mode:n.mode,label:r,body:i}},htmlBuilder:YR,mathmlBuilder:XR});jt({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\angl",body:e[0]}}});var xie={};function Zl(t){for(var{type:e,names:n,props:r,handler:i,htmlBuilder:a,mathmlBuilder:s}=t,o={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:i},l=0;l<n.length;++l)xie[n[l]]=o;a&&(Rw[e]=a),s&&(Pw[e]=s)}var bie={};function ye(t,e){bie[t]=e}function Zz(t){var e=[];t.consumeSpaces();var n=t.fetch().text;for(n==="\\relax"&&(t.consume(),t.consumeSpaces(),n=t.fetch().text);n==="\\hline"||n==="\\hdashline";)t.consume(),e.push(n==="\\hdashline"),t.consumeSpaces(),n=t.fetch().text;return e}var S3=t=>{var e=t.parser.settings;if(!e.displayMode)throw new Mt("{"+t.envName+"} can be used only in display mode.")};function KR(t){if(t.indexOf("ed")===-1)return t.indexOf("*")===-1}function wd(t,e,n){var{hskipBeforeAndAfter:r,addJot:i,cols:a,arraystretch:s,colSeparationType:o,autoTag:l,singleRow:u,emptySingleRow:c,maxNumCols:d,leqno:h}=e;if(t.gullet.beginGroup(),u||t.gullet.macros.set("\\cr","\\\\\\relax"),!s){var f=t.gullet.expandMacroAsText("\\arraystretch");if(f==null)s=1;else if(s=parseFloat(f),!s||s<0)throw new Mt("Invalid \\arraystretch: "+f)}t.gullet.beginGroup();var m=[],x=[m],b=[],y=[],w=l!=null?[]:void 0;function _(){l&&t.gullet.macros.set("\\@eqnsw","1",!0)}function S(){w&&(t.gullet.macros.get("\\df@tag")?(w.push(t.subparse([new Ks("\\df@tag")])),t.gullet.macros.set("\\df@tag",void 0,!0)):w.push(!!l&&t.gullet.macros.get("\\@eqnsw")==="1"))}for(_(),y.push(Zz(t));;){var M=t.parseExpression(!1,u?"\\end":"\\\\");t.gullet.endGroup(),t.gullet.beginGroup(),M={type:"ordgroup",mode:t.mode,body:M},n&&(M={type:"styling",mode:t.mode,style:n,body:[M]}),m.push(M);var E=t.fetch().text;if(E==="&"){if(d&&m.length===d){if(u||o)throw new Mt("Too many tab characters: &",t.nextToken);t.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}t.consume()}else if(E==="\\end"){S(),m.length===1&&M.type==="styling"&&M.body[0].body.length===0&&(x.length>1||!c)&&x.pop(),y.length<x.length+1&&y.push([]);break}else if(E==="\\\\"){t.consume();var C=void 0;t.gullet.future().text!==" "&&(C=t.parseSizeGroup(!0)),b.push(C?C.value:null),S(),y.push(Zz(t)),m=[],x.push(m),_()}else throw new Mt("Expected & or \\\\ or \\cr or \\end",t.nextToken)}return t.gullet.endGroup(),t.gullet.endGroup(),{type:"array",mode:t.mode,addJot:i,arraystretch:s,body:x,cols:a,rowGaps:b,hskipBeforeAndAfter:r,hLinesBeforeRow:y,colSeparationType:o,tags:w,leqno:h}}function ZR(t){return t.slice(0,1)==="d"?"display":"text"}var Jl=function(e,n){var r,i,a=e.body.length,s=e.hLinesBeforeRow,o=0,l=new Array(a),u=[],c=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),d=1/n.fontMetrics().ptPerEm,h=5*d;if(e.colSeparationType&&e.colSeparationType==="small"){var f=n.havingStyle(un.SCRIPT).sizeMultiplier;h=.2778*(f/n.sizeMultiplier)}var m=e.colSeparationType==="CD"?ci({number:3,unit:"ex"},n):12*d,x=3*d,b=e.arraystretch*m,y=.7*b,w=.3*b,_=0;function S(G){for(var xe=0;xe<G.length;++xe)xe>0&&(_+=.25),u.push({pos:_,isDashed:G[xe]})}for(S(s[0]),r=0;r<e.body.length;++r){var M=e.body[r],E=y,C=w;o<M.length&&(o=M.length);var R=new Array(M.length);for(i=0;i<M.length;++i){var k=or(M[i],n);C<k.depth&&(C=k.depth),E<k.height&&(E=k.height),R[i]=k}var I=e.rowGaps[r],N=0;I&&(N=ci(I,n),N>0&&(N+=w,C<N&&(C=N),N=0)),e.addJot&&(C+=x),R.height=E,R.depth=C,_+=E,R.pos=_,_+=C+N,l[r]=R,S(s[r+1])}var D=_/2+n.fontMetrics().axisHeight,F=e.cols||[],L=[],U,j,q=[];if(e.tags&&e.tags.some(G=>G))for(r=0;r<a;++r){var Z=l[r],Q=Z.pos-D,z=e.tags[r],W=void 0;z===!0?W=tt.makeSpan(["eqn-num"],[],n):z===!1?W=tt.makeSpan([],[],n):W=tt.makeSpan([],ea(z,n,!0),n),W.depth=Z.depth,W.height=Z.height,q.push({type:"elem",elem:W,shift:Q})}for(i=0,j=0;i<o||j<F.length;++i,++j){for(var X=F[j]||{},H=!0;X.type==="separator";){if(H||(U=tt.makeSpan(["arraycolsep"],[]),U.style.width=Rt(n.fontMetrics().doubleRuleSep),L.push(U)),X.separator==="|"||X.separator===":"){var J=X.separator==="|"?"solid":"dashed",te=tt.makeSpan(["vertical-separator"],[],n);te.style.height=Rt(_),te.style.borderRightWidth=Rt(c),te.style.borderRightStyle=J,te.style.margin="0 "+Rt(-c/2);var ee=_-D;ee&&(te.style.verticalAlign=Rt(-ee)),L.push(te)}else throw new Mt("Invalid separator type: "+X.separator);j++,X=F[j]||{},H=!1}if(!(i>=o)){var se=void 0;(i>0||e.hskipBeforeAndAfter)&&(se=hr.deflt(X.pregap,h),se!==0&&(U=tt.makeSpan(["arraycolsep"],[]),U.style.width=Rt(se),L.push(U)));var ue=[];for(r=0;r<a;++r){var oe=l[r],Te=oe[i];if(Te){var Ne=oe.pos-D;Te.depth=oe.depth,Te.height=oe.height,ue.push({type:"elem",elem:Te,shift:Ne})}}ue=tt.makeVList({positionType:"individualShift",children:ue},n),ue=tt.makeSpan(["col-align-"+(X.align||"c")],[ue]),L.push(ue),(i<o-1||e.hskipBeforeAndAfter)&&(se=hr.deflt(X.postgap,h),se!==0&&(U=tt.makeSpan(["arraycolsep"],[]),U.style.width=Rt(se),L.push(U)))}}if(l=tt.makeSpan(["mtable"],L),u.length>0){for(var be=tt.makeLineSpan("hline",n,c),De=tt.makeLineSpan("hdashline",n,c),ke=[{type:"elem",elem:l,shift:0}];u.length>0;){var Me=u.pop(),Ie=Me.pos-D;Me.isDashed?ke.push({type:"elem",elem:De,shift:Ie}):ke.push({type:"elem",elem:be,shift:Ie})}l=tt.makeVList({positionType:"individualShift",children:ke},n)}if(q.length===0)return tt.makeSpan(["mord"],[l],n);var ce=tt.makeVList({positionType:"individualShift",children:q},n);return ce=tt.makeSpan(["tag"],[ce],n),tt.makeFragment([l,ce])},rUe={c:"center ",l:"left ",r:"right "},Ql=function(e,n){for(var r=[],i=new Tt.MathNode("mtd",[],["mtr-glue"]),a=new Tt.MathNode("mtd",[],["mml-eqn-num"]),s=0;s<e.body.length;s++){for(var o=e.body[s],l=[],u=0;u<o.length;u++)l.push(new Tt.MathNode("mtd",[Or(o[u],n)]));e.tags&&e.tags[s]&&(l.unshift(i),l.push(i),e.leqno?l.unshift(a):l.push(a)),r.push(new Tt.MathNode("mtr",l))}var c=new Tt.MathNode("mtable",r),d=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",Rt(d));var h="",f="";if(e.cols&&e.cols.length>0){var m=e.cols,x="",b=!1,y=0,w=m.length;m[0].type==="separator"&&(h+="top ",y=1),m[m.length-1].type==="separator"&&(h+="bottom ",w-=1);for(var _=y;_<w;_++)m[_].type==="align"?(f+=rUe[m[_].align],b&&(x+="none "),b=!0):m[_].type==="separator"&&b&&(x+=m[_].separator==="|"?"solid ":"dashed ",b=!1);c.setAttribute("columnalign",f.trim()),/[sd]/.test(x)&&c.setAttribute("columnlines",x.trim())}if(e.colSeparationType==="align"){for(var S=e.cols||[],M="",E=1;E<S.length;E++)M+=E%2?"0em ":"1em ";c.setAttribute("columnspacing",M.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?c.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?c.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var C="",R=e.hLinesBeforeRow;h+=R[0].length>0?"left ":"",h+=R[R.length-1].length>0?"right ":"";for(var k=1;k<R.length-1;k++)C+=R[k].length===0?"none ":R[k][0]?"dashed ":"solid ";return/[sd]/.test(C)&&c.setAttribute("rowlines",C.trim()),h!==""&&(c=new Tt.MathNode("menclose",[c]),c.setAttribute("notation",h.trim())),e.arraystretch&&e.arraystretch<1&&(c=new Tt.MathNode("mstyle",[c]),c.setAttribute("scriptlevel","1")),c},_ie=function(e,n){e.envName.indexOf("ed")===-1&&S3(e);var r=[],i=e.envName.indexOf("at")>-1?"alignat":"align",a=e.envName==="split",s=wd(e.parser,{cols:r,addJot:!0,autoTag:a?void 0:KR(e.envName),emptySingleRow:!0,colSeparationType:i,maxNumCols:a?2:void 0,leqno:e.parser.settings.leqno},"display"),o,l=0,u={type:"ordgroup",mode:e.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var c="",d=0;d<n[0].body.length;d++){var h=Pn(n[0].body[d],"textord");c+=h.text}o=Number(c),l=o*2}var f=!l;s.body.forEach(function(y){for(var w=1;w<y.length;w+=2){var _=Pn(y[w],"styling"),S=Pn(_.body[0],"ordgroup");S.body.unshift(u)}if(f)l<y.length&&(l=y.length);else{var M=y.length/2;if(o<M)throw new Mt("Too many math in a row: "+("expected "+o+", but got "+M),y[0])}});for(var m=0;m<l;++m){var x="r",b=0;m%2===1?x="l":m>0&&f&&(b=1),r[m]={type:"align",align:x,pregap:b,postgap:0}}return s.colSeparationType=f?"align":"alignat",s};Zl({type:"array",names:["array","darray"],props:{numArgs:1},handler(t,e){var n=b3(e[0]),r=n?[e[0]]:Pn(e[0],"ordgroup").body,i=r.map(function(s){var o=qR(s),l=o.text;if("lcr".indexOf(l)!==-1)return{type:"align",align:l};if(l==="|")return{type:"separator",separator:"|"};if(l===":")return{type:"separator",separator:":"};throw new Mt("Unknown column alignment: "+l,s)}),a={cols:i,hskipBeforeAndAfter:!0,maxNumCols:i.length};return wd(t.parser,a,ZR(t.envName))},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(t){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[t.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(t.envName.charAt(t.envName.length-1)==="*"){var i=t.parser;if(i.consumeSpaces(),i.fetch().text==="["){if(i.consume(),i.consumeSpaces(),n=i.fetch().text,"lcr".indexOf(n)===-1)throw new Mt("Expected l or c or r",i.nextToken);i.consume(),i.consumeSpaces(),i.expect("]"),i.consume(),r.cols=[{type:"align",align:n}]}}var a=wd(t.parser,r,ZR(t.envName)),s=Math.max(0,...a.body.map(o=>o.length));return a.cols=new Array(s).fill({type:"align",align:n}),e?{type:"leftright",mode:t.mode,body:[a],left:e[0],right:e[1],rightColor:void 0}:a},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(t){var e={arraystretch:.5},n=wd(t.parser,e,"script");return n.colSeparationType="small",n},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["subarray"],props:{numArgs:1},handler(t,e){var n=b3(e[0]),r=n?[e[0]]:Pn(e[0],"ordgroup").body,i=r.map(function(s){var o=qR(s),l=o.text;if("lc".indexOf(l)!==-1)return{type:"align",align:l};throw new Mt("Unknown column alignment: "+l,s)});if(i.length>1)throw new Mt("{subarray} can contain only one column");var a={cols:i,hskipBeforeAndAfter:!1,arraystretch:.5};if(a=wd(t.parser,a,"script"),a.body.length>0&&a.body[0].length>1)throw new Mt("{subarray} can contain only one column");return a},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(t){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=wd(t.parser,e,ZR(t.envName));return{type:"leftright",mode:t.mode,body:[n],left:t.envName.indexOf("r")>-1?".":"\\{",right:t.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:_ie,htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(t){["gather","gather*"].includes(t.envName)&&S3(t);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:KR(t.envName),emptySingleRow:!0,leqno:t.parser.settings.leqno};return wd(t.parser,e,"display")},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:_ie,htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(t){S3(t);var e={autoTag:KR(t.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:t.parser.settings.leqno};return wd(t.parser,e,"display")},htmlBuilder:Jl,mathmlBuilder:Ql});Zl({type:"array",names:["CD"],props:{numArgs:0},handler(t){return S3(t),$Be(t.parser)},htmlBuilder:Jl,mathmlBuilder:Ql});ye("\\nonumber","\\gdef\\@eqnsw{0}");ye("\\notag","\\nonumber");jt({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(t,e){throw new Mt(t.funcName+" valid only within array environment")}});var Jz=xie;jt({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(t,e){var{parser:n,funcName:r}=t,i=e[0];if(i.type!=="ordgroup")throw new Mt("Invalid environment name",i);for(var a="",s=0;s<i.body.length;++s)a+=Pn(i.body[s],"textord").text;if(r==="\\begin"){if(!Jz.hasOwnProperty(a))throw new Mt("No such environment: "+a,i);var o=Jz[a],{args:l,optArgs:u}=n.parseArguments("\\begin{"+a+"}",o),c={mode:n.mode,envName:a,parser:n},d=o.handler(c,l,u);n.expect("\\end",!1);var h=n.nextToken,f=Pn(n.parseFunction(),"environment");if(f.name!==a)throw new Mt("Mismatch: \\begin{"+a+"} matched by \\end{"+f.name+"}",h);return d}return{type:"environment",mode:n.mode,name:a,nameGroup:i}}});var wie=(t,e)=>{var n=t.font,r=e.withFont(n);return or(t.body,r)},Sie=(t,e)=>{var n=t.font,r=e.withFont(n);return Or(t.body,r)},Qz={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};jt({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=Dw(e[0]),a=r;return a in Qz&&(a=Qz[a]),{type:"font",mode:n.mode,font:a.slice(1),body:i}},htmlBuilder:wie,mathmlBuilder:Sie});jt({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(t,e)=>{var{parser:n}=t,r=e[0],i=hr.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:_3(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:i}}});jt({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,breakOnTokenText:i}=t,{mode:a}=n,s=n.parseExpression(!0,i),o="math"+r.slice(1);return{type:"font",mode:a,font:o,body:{type:"ordgroup",mode:n.mode,body:s}}},htmlBuilder:wie,mathmlBuilder:Sie});var Eie=(t,e)=>{var n=e;return t==="display"?n=n.id>=un.SCRIPT.id?n.text():un.DISPLAY:t==="text"&&n.size===un.DISPLAY.size?n=un.TEXT:t==="script"?n=un.SCRIPT:t==="scriptscript"&&(n=un.SCRIPTSCRIPT),n},JR=(t,e)=>{var n=Eie(t.size,e.style),r=n.fracNum(),i=n.fracDen(),a;a=e.havingStyle(r);var s=or(t.numer,a,e);if(t.continued){var o=8.5/e.fontMetrics().ptPerEm,l=3.5/e.fontMetrics().ptPerEm;s.height=s.height<o?o:s.height,s.depth=s.depth<l?l:s.depth}a=e.havingStyle(i);var u=or(t.denom,a,e),c,d,h;t.hasBarLine?(t.barSize?(d=ci(t.barSize,e),c=tt.makeLineSpan("frac-line",e,d)):c=tt.makeLineSpan("frac-line",e),d=c.height,h=c.height):(c=null,d=0,h=e.fontMetrics().defaultRuleThickness);var f,m,x;n.size===un.DISPLAY.size||t.size==="display"?(f=e.fontMetrics().num1,d>0?m=3*h:m=7*h,x=e.fontMetrics().denom1):(d>0?(f=e.fontMetrics().num2,m=h):(f=e.fontMetrics().num3,m=3*h),x=e.fontMetrics().denom2);var b;if(c){var w=e.fontMetrics().axisHeight;f-s.depth-(w+.5*d)<m&&(f+=m-(f-s.depth-(w+.5*d))),w-.5*d-(u.height-x)<m&&(x+=m-(w-.5*d-(u.height-x)));var _=-(w-.5*d);b=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:x},{type:"elem",elem:c,shift:_},{type:"elem",elem:s,shift:-f}]},e)}else{var y=f-s.depth-(u.height-x);y<m&&(f+=.5*(m-y),x+=.5*(m-y)),b=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:x},{type:"elem",elem:s,shift:-f}]},e)}a=e.havingStyle(n),b.height*=a.sizeMultiplier/e.sizeMultiplier,b.depth*=a.sizeMultiplier/e.sizeMultiplier;var S;n.size===un.DISPLAY.size?S=e.fontMetrics().delim1:n.size===un.SCRIPTSCRIPT.size?S=e.havingStyle(un.SCRIPT).fontMetrics().delim2:S=e.fontMetrics().delim2;var M,E;return t.leftDelim==null?M=Y1(e,["mopen"]):M=Fu.customSizedDelim(t.leftDelim,S,!0,e.havingStyle(n),t.mode,["mopen"]),t.continued?E=tt.makeSpan([]):t.rightDelim==null?E=Y1(e,["mclose"]):E=Fu.customSizedDelim(t.rightDelim,S,!0,e.havingStyle(n),t.mode,["mclose"]),tt.makeSpan(["mord"].concat(a.sizingClasses(e)),[M,tt.makeSpan(["mfrac"],[b]),E],e)},QR=(t,e)=>{var n=new Tt.MathNode("mfrac",[Or(t.numer,e),Or(t.denom,e)]);if(!t.hasBarLine)n.setAttribute("linethickness","0px");else if(t.barSize){var r=ci(t.barSize,e);n.setAttribute("linethickness",Rt(r))}var i=Eie(t.size,e.style);if(i.size!==e.style.size){n=new Tt.MathNode("mstyle",[n]);var a=i.size===un.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",a),n.setAttribute("scriptlevel","0")}if(t.leftDelim!=null||t.rightDelim!=null){var s=[];if(t.leftDelim!=null){var o=new Tt.MathNode("mo",[new Tt.TextNode(t.leftDelim.replace("\\",""))]);o.setAttribute("fence","true"),s.push(o)}if(s.push(n),t.rightDelim!=null){var l=new Tt.MathNode("mo",[new Tt.TextNode(t.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),s.push(l)}return $R(s)}return n};jt({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0],a=e[1],s,o=null,l=null,u="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":s=!0;break;case"\\\\atopfrac":s=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":s=!1,o="(",l=")";break;case"\\\\bracefrac":s=!1,o="\\{",l="\\}";break;case"\\\\brackfrac":s=!1,o="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":u="display";break;case"\\tfrac":case"\\tbinom":u="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:i,denom:a,hasBarLine:s,leftDelim:o,rightDelim:l,size:u,barSize:null}},htmlBuilder:JR,mathmlBuilder:QR});jt({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0],a=e[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:i,denom:a,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});jt({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(t){var{parser:e,funcName:n,token:r}=t,i;switch(n){case"\\over":i="\\frac";break;case"\\choose":i="\\binom";break;case"\\atop":i="\\\\atopfrac";break;case"\\brace":i="\\\\bracefrac";break;case"\\brack":i="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:i,token:r}}});var ej=["display","text","script","scriptscript"],tj=function(e){var n=null;return e.length>0&&(n=e,n=n==="."?null:n),n};jt({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(t,e){var{parser:n}=t,r=e[4],i=e[5],a=Dw(e[0]),s=a.type==="atom"&&a.family==="open"?tj(a.text):null,o=Dw(e[1]),l=o.type==="atom"&&o.family==="close"?tj(o.text):null,u=Pn(e[2],"size"),c,d=null;u.isBlank?c=!0:(d=u.value,c=d.number>0);var h="auto",f=e[3];if(f.type==="ordgroup"){if(f.body.length>0){var m=Pn(f.body[0],"textord");h=ej[Number(m.text)]}}else f=Pn(f,"textord"),h=ej[Number(f.text)];return{type:"genfrac",mode:n.mode,numer:r,denom:i,continued:!1,hasBarLine:c,barSize:d,leftDelim:s,rightDelim:l,size:h}},htmlBuilder:JR,mathmlBuilder:QR});jt({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(t,e){var{parser:n,funcName:r,token:i}=t;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Pn(e[0],"size").value,token:i}}});jt({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0],a=PFe(Pn(e[1],"infix").size),s=e[2],o=a.number>0;return{type:"genfrac",mode:n.mode,numer:i,denom:s,continued:!1,hasBarLine:o,barSize:a,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:JR,mathmlBuilder:QR});var Tie=(t,e)=>{var n=e.style,r,i;t.type==="supsub"?(r=t.sup?or(t.sup,e.havingStyle(n.sup()),e):or(t.sub,e.havingStyle(n.sub()),e),i=Pn(t.base,"horizBrace")):i=Pn(t,"horizBrace");var a=or(i.base,e.havingBaseStyle(un.DISPLAY)),s=$u.svgSpan(i,e),o;if(i.isOver?(o=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"kern",size:.1},{type:"elem",elem:s}]},e),o.children[0].children[0].children[1].classes.push("svg-align")):(o=tt.makeVList({positionType:"bottom",positionData:a.depth+.1+s.height,children:[{type:"elem",elem:s},{type:"kern",size:.1},{type:"elem",elem:a}]},e),o.children[0].children[0].children[0].classes.push("svg-align")),r){var l=tt.makeSpan(["mord",i.isOver?"mover":"munder"],[o],e);i.isOver?o=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:r}]},e):o=tt.makeVList({positionType:"bottom",positionData:l.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:l}]},e)}return tt.makeSpan(["mord",i.isOver?"mover":"munder"],[o],e)},iUe=(t,e)=>{var n=$u.mathMLnode(t.label);return new Tt.MathNode(t.isOver?"mover":"munder",[Or(t.base,e),n])};jt({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:Tie,mathmlBuilder:iUe});jt({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[1],i=Pn(e[0],"url").url;return n.settings.isTrusted({command:"\\href",url:i})?{type:"href",mode:n.mode,href:i,body:Ci(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(t,e)=>{var n=ea(t.body,e,!1);return tt.makeAnchor(t.href,[],n,e)},mathmlBuilder:(t,e)=>{var n=ud(t.body,e);return n instanceof $s||(n=new $s("mrow",[n])),n.setAttribute("href",t.href),n}});jt({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=Pn(e[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var i=[],a=0;a<r.length;a++){var s=r[a];s==="~"&&(s="\\textasciitilde"),i.push({type:"textord",mode:"text",text:s})}var o={type:"text",mode:n.mode,font:"\\texttt",body:i};return{type:"href",mode:n.mode,href:r,body:Ci(o)}}});jt({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(t,e){var{parser:n}=t;return{type:"hbox",mode:n.mode,body:Ci(e[0])}},htmlBuilder(t,e){var n=ea(t.body,e,!1);return tt.makeFragment(n)},mathmlBuilder(t,e){return new Tt.MathNode("mrow",Ms(t.body,e))}});jt({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,token:i}=t,a=Pn(e[0],"raw").string,s=e[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var o,l={};switch(r){case"\\htmlClass":l.class=a,o={command:"\\htmlClass",class:a};break;case"\\htmlId":l.id=a,o={command:"\\htmlId",id:a};break;case"\\htmlStyle":l.style=a,o={command:"\\htmlStyle",style:a};break;case"\\htmlData":{for(var u=a.split(","),c=0;c<u.length;c++){var d=u[c],h=d.indexOf("=");if(h<0)throw new Mt("\\htmlData key/value '"+d+"' missing equals sign");var f=d.slice(0,h),m=d.slice(h+1);l["data-"+f.trim()]=m}o={command:"\\htmlData",attributes:l};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(o)?{type:"html",mode:n.mode,attributes:l,body:Ci(s)}:n.formatUnsupportedCmd(r)},htmlBuilder:(t,e)=>{var n=ea(t.body,e,!1),r=["enclosing"];t.attributes.class&&r.push(...t.attributes.class.trim().split(/\s+/));var i=tt.makeSpan(r,n,e);for(var a in t.attributes)a!=="class"&&t.attributes.hasOwnProperty(a)&&i.setAttribute(a,t.attributes[a]);return i},mathmlBuilder:(t,e)=>ud(t.body,e)});jt({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"htmlmathml",mode:n.mode,html:Ci(e[0]),mathml:Ci(e[1])}},htmlBuilder:(t,e)=>{var n=ea(t.html,e,!1);return tt.makeFragment(n)},mathmlBuilder:(t,e)=>ud(t.mathml,e)});var LT=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!n)throw new Mt("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(n[1]+n[2]),unit:n[3]};if(!Vre(r))throw new Mt("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};jt({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(t,e,n)=>{var{parser:r}=t,i={number:0,unit:"em"},a={number:.9,unit:"em"},s={number:0,unit:"em"},o="";if(n[0])for(var l=Pn(n[0],"raw").string,u=l.split(","),c=0;c<u.length;c++){var d=u[c].split("=");if(d.length===2){var h=d[1].trim();switch(d[0].trim()){case"alt":o=h;break;case"width":i=LT(h);break;case"height":a=LT(h);break;case"totalheight":s=LT(h);break;default:throw new Mt("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var f=Pn(e[0],"url").url;return o===""&&(o=f,o=o.replace(/^.*[\\/]/,""),o=o.substring(0,o.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:f})?{type:"includegraphics",mode:r.mode,alt:o,width:i,height:a,totalheight:s,src:f}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(t,e)=>{var n=ci(t.height,e),r=0;t.totalheight.number>0&&(r=ci(t.totalheight,e)-n);var i=0;t.width.number>0&&(i=ci(t.width,e));var a={height:Rt(n+r)};i>0&&(a.width=Rt(i)),r>0&&(a.verticalAlign=Rt(-r));var s=new iBe(t.src,t.alt,a);return s.height=n,s.depth=r,s},mathmlBuilder:(t,e)=>{var n=new Tt.MathNode("mglyph",[]);n.setAttribute("alt",t.alt);var r=ci(t.height,e),i=0;if(t.totalheight.number>0&&(i=ci(t.totalheight,e)-r,n.setAttribute("valign",Rt(-i))),n.setAttribute("height",Rt(r+i)),t.width.number>0){var a=ci(t.width,e);n.setAttribute("width",Rt(a))}return n.setAttribute("src",t.src),n}});jt({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,i=Pn(e[0],"size");if(n.settings.strict){var a=r[1]==="m",s=i.value.unit==="mu";a?(s||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+i.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):s&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:i.value}},htmlBuilder(t,e){return tt.makeGlue(t.dimension,e)},mathmlBuilder(t,e){var n=ci(t.dimension,e);return new Tt.SpaceNode(n)}});jt({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:i}},htmlBuilder:(t,e)=>{var n;t.alignment==="clap"?(n=tt.makeSpan([],[or(t.body,e)]),n=tt.makeSpan(["inner"],[n],e)):n=tt.makeSpan(["inner"],[or(t.body,e)]);var r=tt.makeSpan(["fix"],[]),i=tt.makeSpan([t.alignment],[n,r],e),a=tt.makeSpan(["strut"]);return a.style.height=Rt(i.height+i.depth),i.depth&&(a.style.verticalAlign=Rt(-i.depth)),i.children.unshift(a),i=tt.makeSpan(["thinbox"],[i],e),tt.makeSpan(["mord","vbox"],[i],e)},mathmlBuilder:(t,e)=>{var n=new Tt.MathNode("mpadded",[Or(t.body,e)]);if(t.alignment!=="rlap"){var r=t.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}});jt({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){var{funcName:n,parser:r}=t,i=r.mode;r.switchMode("math");var a=n==="\\("?"\\)":"$",s=r.parseExpression(!1,a);return r.expect(a),r.switchMode(i),{type:"styling",mode:r.mode,style:"text",body:s}}});jt({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){throw new Mt("Mismatched "+t.funcName)}});var nj=(t,e)=>{switch(e.style.size){case un.DISPLAY.size:return t.display;case un.TEXT.size:return t.text;case un.SCRIPT.size:return t.script;case un.SCRIPTSCRIPT.size:return t.scriptscript;default:return t.text}};jt({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"mathchoice",mode:n.mode,display:Ci(e[0]),text:Ci(e[1]),script:Ci(e[2]),scriptscript:Ci(e[3])}},htmlBuilder:(t,e)=>{var n=nj(t,e),r=ea(n,e,!1);return tt.makeFragment(r)},mathmlBuilder:(t,e)=>{var n=nj(t,e);return ud(n,e)}});var Cie=(t,e,n,r,i,a,s)=>{t=tt.makeSpan([],[t]);var o=n&&hr.isCharacterBox(n),l,u;if(e){var c=or(e,r.havingStyle(i.sup()),r);u={elem:c,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-c.depth)}}if(n){var d=or(n,r.havingStyle(i.sub()),r);l={elem:d,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-d.height)}}var h;if(u&&l){var f=r.fontMetrics().bigOpSpacing5+l.elem.height+l.elem.depth+l.kern+t.depth+s;h=tt.makeVList({positionType:"bottom",positionData:f,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:Rt(-a)},{type:"kern",size:l.kern},{type:"elem",elem:t},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:Rt(a)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(l){var m=t.height-s;h=tt.makeVList({positionType:"top",positionData:m,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:Rt(-a)},{type:"kern",size:l.kern},{type:"elem",elem:t}]},r)}else if(u){var x=t.depth+s;h=tt.makeVList({positionType:"bottom",positionData:x,children:[{type:"elem",elem:t},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:Rt(a)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return t;var b=[h];if(l&&a!==0&&!o){var y=tt.makeSpan(["mspace"],[],r);y.style.marginRight=Rt(a),b.unshift(y)}return tt.makeSpan(["mop","op-limits"],b,r)},Mie=["\\smallint"],Y0=(t,e)=>{var n,r,i=!1,a;t.type==="supsub"?(n=t.sup,r=t.sub,a=Pn(t.base,"op"),i=!0):a=Pn(t,"op");var s=e.style,o=!1;s.size===un.DISPLAY.size&&a.symbol&&!Mie.includes(a.name)&&(o=!0);var l;if(a.symbol){var u=o?"Size2-Regular":"Size1-Regular",c="";if((a.name==="\\oiint"||a.name==="\\oiiint")&&(c=a.name.slice(1),a.name=c==="oiint"?"\\iint":"\\iiint"),l=tt.makeSymbol(a.name,u,"math",e,["mop","op-symbol",o?"large-op":"small-op"]),c.length>0){var d=l.italic,h=tt.staticSvg(c+"Size"+(o?"2":"1"),e);l=tt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:0},{type:"elem",elem:h,shift:o?.08:0}]},e),a.name="\\"+c,l.classes.unshift("mop"),l.italic=d}}else if(a.body){var f=ea(a.body,e,!0);f.length===1&&f[0]instanceof _o?(l=f[0],l.classes[0]="mop"):l=tt.makeSpan(["mop"],f,e)}else{for(var m=[],x=1;x<a.name.length;x++)m.push(tt.mathsym(a.name[x],a.mode,e));l=tt.makeSpan(["mop"],m,e)}var b=0,y=0;return(l instanceof _o||a.name==="\\oiint"||a.name==="\\oiiint")&&!a.suppressBaseShift&&(b=(l.height-l.depth)/2-e.fontMetrics().axisHeight,y=l.italic),i?Cie(l,n,r,e,s,y,b):(b&&(l.style.position="relative",l.style.top=Rt(b)),l)},Fv=(t,e)=>{var n;if(t.symbol)n=new $s("mo",[wo(t.name,t.mode)]),Mie.includes(t.name)&&n.setAttribute("largeop","false");else if(t.body)n=new $s("mo",Ms(t.body,e));else{n=new $s("mi",[new Dl(t.name.slice(1))]);var r=new $s("mo",[wo("⁡","text")]);t.parentIsSupSub?n=new $s("mrow",[n,r]):n=tie([n,r])}return n},aUe={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨆":"\\bigsqcup"};jt({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=r;return i.length===1&&(i=aUe[i]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:Y0,mathmlBuilder:Fv});jt({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Ci(r)}},htmlBuilder:Y0,mathmlBuilder:Fv});var sUe={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint"};jt({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Y0,mathmlBuilder:Fv});jt({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Y0,mathmlBuilder:Fv});jt({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","∫","∬","∭","∮","∯","∰"],props:{numArgs:0,allowedInArgument:!0},handler(t){var{parser:e,funcName:n}=t,r=n;return r.length===1&&(r=sUe[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Y0,mathmlBuilder:Fv});var Aie=(t,e)=>{var n,r,i=!1,a;t.type==="supsub"?(n=t.sup,r=t.sub,a=Pn(t.base,"operatorname"),i=!0):a=Pn(t,"operatorname");var s;if(a.body.length>0){for(var o=a.body.map(d=>{var h=d.text;return typeof h=="string"?{type:"textord",mode:d.mode,text:h}:d}),l=ea(o,e.withFont("mathrm"),!0),u=0;u<l.length;u++){var c=l[u];c instanceof _o&&(c.text=c.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}s=tt.makeSpan(["mop"],l,e)}else s=tt.makeSpan(["mop"],[],e);return i?Cie(s,n,r,e,e.style,0,0):s},oUe=(t,e)=>{for(var n=Ms(t.body,e.withFont("mathrm")),r=!0,i=0;i<n.length;i++){var a=n[i];if(!(a instanceof Tt.SpaceNode))if(a instanceof Tt.MathNode)switch(a.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var s=a.children[0];a.children.length===1&&s instanceof Tt.TextNode?s.text=s.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var o=n.map(c=>c.toText()).join("");n=[new Tt.TextNode(o)]}var l=new Tt.MathNode("mi",n);l.setAttribute("mathvariant","normal");var u=new Tt.MathNode("mo",[wo("⁡","text")]);return t.parentIsSupSub?new Tt.MathNode("mrow",[l,u]):Tt.newDocumentFragment([l,u])};jt({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,i=e[0];return{type:"operatorname",mode:n.mode,body:Ci(i),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:Aie,mathmlBuilder:oUe});ye("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");_f({type:"ordgroup",htmlBuilder(t,e){return t.semisimple?tt.makeFragment(ea(t.body,e,!1)):tt.makeSpan(["mord"],ea(t.body,e,!0),e)},mathmlBuilder(t,e){return ud(t.body,e,!0)}});jt({type:"overline",names:["\\overline"],props:{numArgs:1},handler(t,e){var{parser:n}=t,r=e[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(t,e){var n=or(t.body,e.havingCrampedStyle()),r=tt.makeLineSpan("overline-line",e),i=e.fontMetrics().defaultRuleThickness,a=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*i},{type:"elem",elem:r},{type:"kern",size:i}]},e);return tt.makeSpan(["mord","overline"],[a],e)},mathmlBuilder(t,e){var n=new Tt.MathNode("mo",[new Tt.TextNode("‾")]);n.setAttribute("stretchy","true");var r=new Tt.MathNode("mover",[Or(t.body,e),n]);return r.setAttribute("accent","true"),r}});jt({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"phantom",mode:n.mode,body:Ci(r)}},htmlBuilder:(t,e)=>{var n=ea(t.body,e.withPhantom(),!1);return tt.makeFragment(n)},mathmlBuilder:(t,e)=>{var n=Ms(t.body,e);return new Tt.MathNode("mphantom",n)}});jt({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=tt.makeSpan([],[or(t.body,e.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e),tt.makeSpan(["mord"],[n],e)},mathmlBuilder:(t,e)=>{var n=Ms(Ci(t.body),e),r=new Tt.MathNode("mphantom",n),i=new Tt.MathNode("mpadded",[r]);return i.setAttribute("height","0px"),i.setAttribute("depth","0px"),i}});jt({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=tt.makeSpan(["inner"],[or(t.body,e.withPhantom())]),r=tt.makeSpan(["fix"],[]);return tt.makeSpan(["mord","rlap"],[n,r],e)},mathmlBuilder:(t,e)=>{var n=Ms(Ci(t.body),e),r=new Tt.MathNode("mphantom",n),i=new Tt.MathNode("mpadded",[r]);return i.setAttribute("width","0px"),i}});jt({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t,r=Pn(e[0],"size").value,i=e[1];return{type:"raisebox",mode:n.mode,dy:r,body:i}},htmlBuilder(t,e){var n=or(t.body,e),r=ci(t.dy,e);return tt.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){var n=new Tt.MathNode("mpadded",[Or(t.body,e)]),r=t.dy.number+t.dy.unit;return n.setAttribute("voffset",r),n}});jt({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(t){var{parser:e}=t;return{type:"internal",mode:e.mode}}});jt({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(t,e,n){var{parser:r}=t,i=n[0],a=Pn(e[0],"size"),s=Pn(e[1],"size");return{type:"rule",mode:r.mode,shift:i&&Pn(i,"size").value,width:a.value,height:s.value}},htmlBuilder(t,e){var n=tt.makeSpan(["mord","rule"],[],e),r=ci(t.width,e),i=ci(t.height,e),a=t.shift?ci(t.shift,e):0;return n.style.borderRightWidth=Rt(r),n.style.borderTopWidth=Rt(i),n.style.bottom=Rt(a),n.width=r,n.height=i+a,n.depth=-a,n.maxFontSize=i*1.125*e.sizeMultiplier,n},mathmlBuilder(t,e){var n=ci(t.width,e),r=ci(t.height,e),i=t.shift?ci(t.shift,e):0,a=e.color&&e.getColor()||"black",s=new Tt.MathNode("mspace");s.setAttribute("mathbackground",a),s.setAttribute("width",Rt(n)),s.setAttribute("height",Rt(r));var o=new Tt.MathNode("mpadded",[s]);return i>=0?o.setAttribute("height",Rt(i)):(o.setAttribute("height",Rt(i)),o.setAttribute("depth",Rt(-i))),o.setAttribute("voffset",Rt(i)),o}});function kie(t,e,n){for(var r=ea(t,e,!1),i=e.sizeMultiplier/n.sizeMultiplier,a=0;a<r.length;a++){var s=r[a].classes.indexOf("sizing");s<0?Array.prototype.push.apply(r[a].classes,e.sizingClasses(n)):r[a].classes[s+1]==="reset-size"+e.size&&(r[a].classes[s+1]="reset-size"+n.size),r[a].height*=i,r[a].depth*=i}return tt.makeFragment(r)}var rj=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],lUe=(t,e)=>{var n=e.havingSize(t.size);return kie(t.body,n,e)};jt({type:"sizing",names:rj,props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{breakOnTokenText:n,funcName:r,parser:i}=t,a=i.parseExpression(!1,n);return{type:"sizing",mode:i.mode,size:rj.indexOf(r)+1,body:a}},htmlBuilder:lUe,mathmlBuilder:(t,e)=>{var n=e.havingSize(t.size),r=Ms(t.body,n),i=new Tt.MathNode("mstyle",r);return i.setAttribute("mathsize",Rt(n.sizeMultiplier)),i}});jt({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(t,e,n)=>{var{parser:r}=t,i=!1,a=!1,s=n[0]&&Pn(n[0],"ordgroup");if(s)for(var o="",l=0;l<s.body.length;++l){var u=s.body[l];if(o=u.text,o==="t")i=!0;else if(o==="b")a=!0;else{i=!1,a=!1;break}}else i=!0,a=!0;var c=e[0];return{type:"smash",mode:r.mode,body:c,smashHeight:i,smashDepth:a}},htmlBuilder:(t,e)=>{var n=tt.makeSpan([],[or(t.body,e)]);if(!t.smashHeight&&!t.smashDepth)return n;if(t.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(t.smashDepth&&(n.depth=0,n.children))for(var i=0;i<n.children.length;i++)n.children[i].depth=0;var a=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e);return tt.makeSpan(["mord"],[a],e)},mathmlBuilder:(t,e)=>{var n=new Tt.MathNode("mpadded",[Or(t.body,e)]);return t.smashHeight&&n.setAttribute("height","0px"),t.smashDepth&&n.setAttribute("depth","0px"),n}});jt({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r}=t,i=n[0],a=e[0];return{type:"sqrt",mode:r.mode,body:a,index:i}},htmlBuilder(t,e){var n=or(t.body,e.havingCrampedStyle());n.height===0&&(n.height=e.fontMetrics().xHeight),n=tt.wrapFragment(n,e);var r=e.fontMetrics(),i=r.defaultRuleThickness,a=i;e.style.id<un.TEXT.id&&(a=e.fontMetrics().xHeight);var s=i+a/4,o=n.height+n.depth+s+i,{span:l,ruleWidth:u,advanceWidth:c}=Fu.sqrtImage(o,e),d=l.height-u;d>n.height+n.depth+s&&(s=(s+d-n.height-n.depth)/2);var h=l.height-n.height-s-u;n.style.paddingLeft=Rt(c);var f=tt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+h)},{type:"elem",elem:l},{type:"kern",size:u}]},e);if(t.index){var m=e.havingStyle(un.SCRIPTSCRIPT),x=or(t.index,m,e),b=.6*(f.height-f.depth),y=tt.makeVList({positionType:"shift",positionData:-b,children:[{type:"elem",elem:x}]},e),w=tt.makeSpan(["root"],[y]);return tt.makeSpan(["mord","sqrt"],[w,f],e)}else return tt.makeSpan(["mord","sqrt"],[f],e)},mathmlBuilder(t,e){var{body:n,index:r}=t;return r?new Tt.MathNode("mroot",[Or(n,e),Or(r,e)]):new Tt.MathNode("msqrt",[Or(n,e)])}});var ij={display:un.DISPLAY,text:un.TEXT,script:un.SCRIPT,scriptscript:un.SCRIPTSCRIPT};jt({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t,e){var{breakOnTokenText:n,funcName:r,parser:i}=t,a=i.parseExpression(!0,n),s=r.slice(1,r.length-5);return{type:"styling",mode:i.mode,style:s,body:a}},htmlBuilder(t,e){var n=ij[t.style],r=e.havingStyle(n).withFont("");return kie(t.body,r,e)},mathmlBuilder(t,e){var n=ij[t.style],r=e.havingStyle(n),i=Ms(t.body,r),a=new Tt.MathNode("mstyle",i),s={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},o=s[t.style];return a.setAttribute("scriptlevel",o[0]),a.setAttribute("displaystyle",o[1]),a}});var uUe=function(e,n){var r=e.base;if(r)if(r.type==="op"){var i=r.limits&&(n.style.size===un.DISPLAY.size||r.alwaysHandleSupSub);return i?Y0:null}else if(r.type==="operatorname"){var a=r.alwaysHandleSupSub&&(n.style.size===un.DISPLAY.size||r.limits);return a?Aie:null}else{if(r.type==="accent")return hr.isCharacterBox(r.base)?GR:null;if(r.type==="horizBrace"){var s=!e.sub;return s===r.isOver?Tie:null}else return null}else return null};_f({type:"supsub",htmlBuilder(t,e){var n=uUe(t,e);if(n)return n(t,e);var{base:r,sup:i,sub:a}=t,s=or(r,e),o,l,u=e.fontMetrics(),c=0,d=0,h=r&&hr.isCharacterBox(r);if(i){var f=e.havingStyle(e.style.sup());o=or(i,f,e),h||(c=s.height-f.fontMetrics().supDrop*f.sizeMultiplier/e.sizeMultiplier)}if(a){var m=e.havingStyle(e.style.sub());l=or(a,m,e),h||(d=s.depth+m.fontMetrics().subDrop*m.sizeMultiplier/e.sizeMultiplier)}var x;e.style===un.DISPLAY?x=u.sup1:e.style.cramped?x=u.sup3:x=u.sup2;var b=e.sizeMultiplier,y=Rt(.5/u.ptPerEm/b),w=null;if(l){var _=t.base&&t.base.type==="op"&&t.base.name&&(t.base.name==="\\oiint"||t.base.name==="\\oiiint");(s instanceof _o||_)&&(w=Rt(-s.italic))}var S;if(o&&l){c=Math.max(c,x,o.depth+.25*u.xHeight),d=Math.max(d,u.sub2);var M=u.defaultRuleThickness,E=4*M;if(c-o.depth-(l.height-d)<E){d=E-(c-o.depth)+l.height;var C=.8*u.xHeight-(c-o.depth);C>0&&(c+=C,d-=C)}var R=[{type:"elem",elem:l,shift:d,marginRight:y,marginLeft:w},{type:"elem",elem:o,shift:-c,marginRight:y}];S=tt.makeVList({positionType:"individualShift",children:R},e)}else if(l){d=Math.max(d,u.sub1,l.height-.8*u.xHeight);var k=[{type:"elem",elem:l,marginLeft:w,marginRight:y}];S=tt.makeVList({positionType:"shift",positionData:d,children:k},e)}else if(o)c=Math.max(c,x,o.depth+.25*u.xHeight),S=tt.makeVList({positionType:"shift",positionData:-c,children:[{type:"elem",elem:o,marginRight:y}]},e);else throw new Error("supsub must have either sup or sub.");var I=GI(s,"right")||"mord";return tt.makeSpan([I],[s,tt.makeSpan(["msupsub"],[S])],e)},mathmlBuilder(t,e){var n=!1,r,i;t.base&&t.base.type==="horizBrace"&&(i=!!t.sup,i===t.base.isOver&&(n=!0,r=t.base.isOver)),t.base&&(t.base.type==="op"||t.base.type==="operatorname")&&(t.base.parentIsSupSub=!0);var a=[Or(t.base,e)];t.sub&&a.push(Or(t.sub,e)),t.sup&&a.push(Or(t.sup,e));var s;if(n)s=r?"mover":"munder";else if(t.sub)if(t.sup){var u=t.base;u&&u.type==="op"&&u.limits&&e.style===un.DISPLAY||u&&u.type==="operatorname"&&u.alwaysHandleSupSub&&(e.style===un.DISPLAY||u.limits)?s="munderover":s="msubsup"}else{var l=t.base;l&&l.type==="op"&&l.limits&&(e.style===un.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===un.DISPLAY)?s="munder":s="msub"}else{var o=t.base;o&&o.type==="op"&&o.limits&&(e.style===un.DISPLAY||o.alwaysHandleSupSub)||o&&o.type==="operatorname"&&o.alwaysHandleSupSub&&(o.limits||e.style===un.DISPLAY)?s="mover":s="msup"}return new Tt.MathNode(s,a)}});_f({type:"atom",htmlBuilder(t,e){return tt.mathsym(t.text,t.mode,e,["m"+t.family])},mathmlBuilder(t,e){var n=new Tt.MathNode("mo",[wo(t.text,t.mode)]);if(t.family==="bin"){var r=VR(t,e);r==="bold-italic"&&n.setAttribute("mathvariant",r)}else t.family==="punct"?n.setAttribute("separator","true"):(t.family==="open"||t.family==="close")&&n.setAttribute("stretchy","false");return n}});var Iie={mi:"italic",mn:"normal",mtext:"normal"};_f({type:"mathord",htmlBuilder(t,e){return tt.makeOrd(t,e,"mathord")},mathmlBuilder(t,e){var n=new Tt.MathNode("mi",[wo(t.text,t.mode,e)]),r=VR(t,e)||"italic";return r!==Iie[n.type]&&n.setAttribute("mathvariant",r),n}});_f({type:"textord",htmlBuilder(t,e){return tt.makeOrd(t,e,"textord")},mathmlBuilder(t,e){var n=wo(t.text,t.mode,e),r=VR(t,e)||"normal",i;return t.mode==="text"?i=new Tt.MathNode("mtext",[n]):/[0-9]/.test(t.text)?i=new Tt.MathNode("mn",[n]):t.text==="\\prime"?i=new Tt.MathNode("mo",[n]):i=new Tt.MathNode("mi",[n]),r!==Iie[i.type]&&i.setAttribute("mathvariant",r),i}});var FT={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},BT={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};_f({type:"spacing",htmlBuilder(t,e){if(BT.hasOwnProperty(t.text)){var n=BT[t.text].className||"";if(t.mode==="text"){var r=tt.makeOrd(t,e,"textord");return r.classes.push(n),r}else return tt.makeSpan(["mspace",n],[tt.mathsym(t.text,t.mode,e)],e)}else{if(FT.hasOwnProperty(t.text))return tt.makeSpan(["mspace",FT[t.text]],[],e);throw new Mt('Unknown type of space "'+t.text+'"')}},mathmlBuilder(t,e){var n;if(BT.hasOwnProperty(t.text))n=new Tt.MathNode("mtext",[new Tt.TextNode(" ")]);else{if(FT.hasOwnProperty(t.text))return new Tt.MathNode("mspace");throw new Mt('Unknown type of space "'+t.text+'"')}return n}});var aj=()=>{var t=new Tt.MathNode("mtd",[]);return t.setAttribute("width","50%"),t};_f({type:"tag",mathmlBuilder(t,e){var n=new Tt.MathNode("mtable",[new Tt.MathNode("mtr",[aj(),new Tt.MathNode("mtd",[ud(t.body,e)]),aj(),new Tt.MathNode("mtd",[ud(t.tag,e)])])]);return n.setAttribute("width","100%"),n}});var sj={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},oj={"\\textbf":"textbf","\\textmd":"textmd"},cUe={"\\textit":"textit","\\textup":"textup"},lj=(t,e)=>{var n=t.font;if(n){if(sj[n])return e.withTextFontFamily(sj[n]);if(oj[n])return e.withTextFontWeight(oj[n]);if(n==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(cUe[n])};jt({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,i=e[0];return{type:"text",mode:n.mode,body:Ci(i),font:r}},htmlBuilder(t,e){var n=lj(t,e),r=ea(t.body,n,!0);return tt.makeSpan(["mord","text"],r,n)},mathmlBuilder(t,e){var n=lj(t,e);return ud(t.body,n)}});jt({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"underline",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=or(t.body,e),r=tt.makeLineSpan("underline-line",e),i=e.fontMetrics().defaultRuleThickness,a=tt.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:i},{type:"elem",elem:r},{type:"kern",size:3*i},{type:"elem",elem:n}]},e);return tt.makeSpan(["mord","underline"],[a],e)},mathmlBuilder(t,e){var n=new Tt.MathNode("mo",[new Tt.TextNode("‾")]);n.setAttribute("stretchy","true");var r=new Tt.MathNode("munder",[Or(t.body,e),n]);return r.setAttribute("accentunder","true"),r}});jt({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"vcenter",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=or(t.body,e),r=e.fontMetrics().axisHeight,i=.5*(n.height-r-(n.depth+r));return tt.makeVList({positionType:"shift",positionData:i,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){return new Tt.MathNode("mpadded",[Or(t.body,e)],["vcenter"])}});jt({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(t,e,n){throw new Mt("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(t,e){for(var n=uj(t),r=[],i=e.havingStyle(e.style.text()),a=0;a<n.length;a++){var s=n[a];s==="~"&&(s="\\textasciitilde"),r.push(tt.makeSymbol(s,"Typewriter-Regular",t.mode,i,["mord","texttt"]))}return tt.makeSpan(["mord","text"].concat(i.sizingClasses(e)),tt.tryCombineChars(r),i)},mathmlBuilder(t,e){var n=new Tt.TextNode(uj(t)),r=new Tt.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var uj=t=>t.body.replace(/ /g,t.star?"␣":" "),Wc=Qre,Nie=`[ \r
	]`,dUe="\\\\[a-zA-Z@]+",hUe="\\\\[^\uD800-\uDFFF]",fUe="("+dUe+")"+Nie+"*",pUe=`\\\\(
|[ \r	]+
?)[ \r	]*`,KI="[̀-ͯ]",mUe=new RegExp(KI+"+$"),gUe="("+Nie+"+)|"+(pUe+"|")+"([!-\\[\\]-‧‪-퟿豈-￿]"+(KI+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(KI+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+fUe)+("|"+hUe+")");class cj{constructor(e,n){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=n,this.tokenRegex=new RegExp(gUe,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,n){this.catcodes[e]=n}lex(){var e=this.input,n=this.tokenRegex.lastIndex;if(n===e.length)return new Ks("EOF",new ys(this,n,n));var r=this.tokenRegex.exec(e);if(r===null||r.index!==n)throw new Mt("Unexpected character: '"+e[n]+"'",new Ks(e[n],new ys(this,n,n+1)));var i=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[i]===14){var a=e.indexOf(`
`,this.tokenRegex.lastIndex);return a===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=a+1,this.lex()}return new Ks(i,new ys(this,n,this.tokenRegex.lastIndex))}}class vUe{constructor(e,n){e===void 0&&(e={}),n===void 0&&(n={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=n,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new Mt("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var n in e)e.hasOwnProperty(n)&&(e[n]==null?delete this.current[n]:this.current[n]=e[n])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,n,r){if(r===void 0&&(r=!1),r){for(var i=0;i<this.undefStack.length;i++)delete this.undefStack[i][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=n)}else{var a=this.undefStack[this.undefStack.length-1];a&&!a.hasOwnProperty(e)&&(a[e]=this.current[e])}n==null?delete this.current[e]:this.current[e]=n}}var yUe=bie;ye("\\noexpand",function(t){var e=t.popToken();return t.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});ye("\\expandafter",function(t){var e=t.popToken();return t.expandOnce(!0),{tokens:[e],numArgs:0}});ye("\\@firstoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[0],numArgs:0}});ye("\\@secondoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[1],numArgs:0}});ye("\\@ifnextchar",function(t){var e=t.consumeArgs(3);t.consumeSpaces();var n=t.future();return e[0].length===1&&e[0][0].text===n.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});ye("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");ye("\\TextOrMath",function(t){var e=t.consumeArgs(2);return t.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var dj={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};ye("\\char",function(t){var e=t.popToken(),n,r="";if(e.text==="'")n=8,e=t.popToken();else if(e.text==='"')n=16,e=t.popToken();else if(e.text==="`")if(e=t.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new Mt("\\char` missing argument");r=e.text.charCodeAt(0)}else n=10;if(n){if(r=dj[e.text],r==null||r>=n)throw new Mt("Invalid base-"+n+" digit "+e.text);for(var i;(i=dj[t.future().text])!=null&&i<n;)r*=n,r+=i,t.popToken()}return"\\@char{"+r+"}"});var e7=(t,e,n,r)=>{var i=t.consumeArg().tokens;if(i.length!==1)throw new Mt("\\newcommand's first argument must be a macro name");var a=i[0].text,s=t.isDefined(a);if(s&&!e)throw new Mt("\\newcommand{"+a+"} attempting to redefine "+(a+"; use \\renewcommand"));if(!s&&!n)throw new Mt("\\renewcommand{"+a+"} when command "+a+" does not yet exist; use \\newcommand");var o=0;if(i=t.consumeArg().tokens,i.length===1&&i[0].text==="["){for(var l="",u=t.expandNextToken();u.text!=="]"&&u.text!=="EOF";)l+=u.text,u=t.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new Mt("Invalid number of arguments: "+l);o=parseInt(l),i=t.consumeArg().tokens}return s&&r||t.macros.set(a,{tokens:i,numArgs:o}),""};ye("\\newcommand",t=>e7(t,!1,!0,!1));ye("\\renewcommand",t=>e7(t,!0,!1,!1));ye("\\providecommand",t=>e7(t,!0,!0,!0));ye("\\message",t=>{var e=t.consumeArgs(1)[0];return console.log(e.reverse().map(n=>n.text).join("")),""});ye("\\errmessage",t=>{var e=t.consumeArgs(1)[0];return console.error(e.reverse().map(n=>n.text).join("")),""});ye("\\show",t=>{var e=t.popToken(),n=e.text;return console.log(e,t.macros.get(n),Wc[n],Hr.math[n],Hr.text[n]),""});ye("\\bgroup","{");ye("\\egroup","}");ye("~","\\nobreakspace");ye("\\lq","`");ye("\\rq","'");ye("\\aa","\\r a");ye("\\AA","\\r A");ye("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`©}");ye("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");ye("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`®}");ye("ℬ","\\mathscr{B}");ye("ℰ","\\mathscr{E}");ye("ℱ","\\mathscr{F}");ye("ℋ","\\mathscr{H}");ye("ℐ","\\mathscr{I}");ye("ℒ","\\mathscr{L}");ye("ℳ","\\mathscr{M}");ye("ℛ","\\mathscr{R}");ye("ℭ","\\mathfrak{C}");ye("ℌ","\\mathfrak{H}");ye("ℨ","\\mathfrak{Z}");ye("\\Bbbk","\\Bbb{k}");ye("·","\\cdotp");ye("\\llap","\\mathllap{\\textrm{#1}}");ye("\\rlap","\\mathrlap{\\textrm{#1}}");ye("\\clap","\\mathclap{\\textrm{#1}}");ye("\\mathstrut","\\vphantom{(}");ye("\\underbar","\\underline{\\text{#1}}");ye("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');ye("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`≠}}");ye("\\ne","\\neq");ye("≠","\\neq");ye("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`∉}}");ye("∉","\\notin");ye("≘","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`≘}}");ye("≙","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`≘}}");ye("≚","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`≚}}");ye("≛","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`≛}}");ye("≝","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`≝}}");ye("≞","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`≞}}");ye("≟","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`≟}}");ye("⟂","\\perp");ye("‼","\\mathclose{!\\mkern-0.8mu!}");ye("∌","\\notni");ye("⌜","\\ulcorner");ye("⌝","\\urcorner");ye("⌞","\\llcorner");ye("⌟","\\lrcorner");ye("©","\\copyright");ye("®","\\textregistered");ye("️","\\textregistered");ye("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');ye("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');ye("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');ye("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');ye("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");ye("⋮","\\vdots");ye("\\varGamma","\\mathit{\\Gamma}");ye("\\varDelta","\\mathit{\\Delta}");ye("\\varTheta","\\mathit{\\Theta}");ye("\\varLambda","\\mathit{\\Lambda}");ye("\\varXi","\\mathit{\\Xi}");ye("\\varPi","\\mathit{\\Pi}");ye("\\varSigma","\\mathit{\\Sigma}");ye("\\varUpsilon","\\mathit{\\Upsilon}");ye("\\varPhi","\\mathit{\\Phi}");ye("\\varPsi","\\mathit{\\Psi}");ye("\\varOmega","\\mathit{\\Omega}");ye("\\substack","\\begin{subarray}{c}#1\\end{subarray}");ye("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");ye("\\boxed","\\fbox{$\\displaystyle{#1}$}");ye("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");ye("\\implies","\\DOTSB\\;\\Longrightarrow\\;");ye("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");ye("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");ye("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var hj={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};ye("\\dots",function(t){var e="\\dotso",n=t.expandAfterFuture().text;return n in hj?e=hj[n]:(n.slice(0,4)==="\\not"||n in Hr.math&&["bin","rel"].includes(Hr.math[n].group))&&(e="\\dotsb"),e});var t7={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};ye("\\dotso",function(t){var e=t.future().text;return e in t7?"\\ldots\\,":"\\ldots"});ye("\\dotsc",function(t){var e=t.future().text;return e in t7&&e!==","?"\\ldots\\,":"\\ldots"});ye("\\cdots",function(t){var e=t.future().text;return e in t7?"\\@cdots\\,":"\\@cdots"});ye("\\dotsb","\\cdots");ye("\\dotsm","\\cdots");ye("\\dotsi","\\!\\cdots");ye("\\dotsx","\\ldots\\,");ye("\\DOTSI","\\relax");ye("\\DOTSB","\\relax");ye("\\DOTSX","\\relax");ye("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");ye("\\,","\\tmspace+{3mu}{.1667em}");ye("\\thinspace","\\,");ye("\\>","\\mskip{4mu}");ye("\\:","\\tmspace+{4mu}{.2222em}");ye("\\medspace","\\:");ye("\\;","\\tmspace+{5mu}{.2777em}");ye("\\thickspace","\\;");ye("\\!","\\tmspace-{3mu}{.1667em}");ye("\\negthinspace","\\!");ye("\\negmedspace","\\tmspace-{4mu}{.2222em}");ye("\\negthickspace","\\tmspace-{5mu}{.277em}");ye("\\enspace","\\kern.5em ");ye("\\enskip","\\hskip.5em\\relax");ye("\\quad","\\hskip1em\\relax");ye("\\qquad","\\hskip2em\\relax");ye("\\tag","\\@ifstar\\tag@literal\\tag@paren");ye("\\tag@paren","\\tag@literal{({#1})}");ye("\\tag@literal",t=>{if(t.macros.get("\\df@tag"))throw new Mt("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});ye("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");ye("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");ye("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");ye("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");ye("\\newline","\\\\\\relax");ye("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var Rie=Rt(Pl["Main-Regular"][84][1]-.7*Pl["Main-Regular"][65][1]);ye("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+Rie+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");ye("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+Rie+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");ye("\\hspace","\\@ifstar\\@hspacer\\@hspace");ye("\\@hspace","\\hskip #1\\relax");ye("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");ye("\\ordinarycolon",":");ye("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");ye("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');ye("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');ye("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');ye("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');ye("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');ye("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');ye("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');ye("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');ye("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');ye("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');ye("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');ye("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');ye("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');ye("∷","\\dblcolon");ye("∹","\\eqcolon");ye("≔","\\coloneqq");ye("≕","\\eqqcolon");ye("⩴","\\Coloneqq");ye("\\ratio","\\vcentcolon");ye("\\coloncolon","\\dblcolon");ye("\\colonequals","\\coloneqq");ye("\\coloncolonequals","\\Coloneqq");ye("\\equalscolon","\\eqqcolon");ye("\\equalscoloncolon","\\Eqqcolon");ye("\\colonminus","\\coloneq");ye("\\coloncolonminus","\\Coloneq");ye("\\minuscolon","\\eqcolon");ye("\\minuscoloncolon","\\Eqcolon");ye("\\coloncolonapprox","\\Colonapprox");ye("\\coloncolonsim","\\Colonsim");ye("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");ye("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");ye("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");ye("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");ye("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`∌}}");ye("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");ye("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");ye("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");ye("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");ye("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");ye("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");ye("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");ye("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");ye("\\gvertneqq","\\html@mathml{\\@gvertneqq}{≩}");ye("\\lvertneqq","\\html@mathml{\\@lvertneqq}{≨}");ye("\\ngeqq","\\html@mathml{\\@ngeqq}{≱}");ye("\\ngeqslant","\\html@mathml{\\@ngeqslant}{≱}");ye("\\nleqq","\\html@mathml{\\@nleqq}{≰}");ye("\\nleqslant","\\html@mathml{\\@nleqslant}{≰}");ye("\\nshortmid","\\html@mathml{\\@nshortmid}{∤}");ye("\\nshortparallel","\\html@mathml{\\@nshortparallel}{∦}");ye("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{⊈}");ye("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{⊉}");ye("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{⊊}");ye("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{⫋}");ye("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{⊋}");ye("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{⫌}");ye("\\imath","\\html@mathml{\\@imath}{ı}");ye("\\jmath","\\html@mathml{\\@jmath}{ȷ}");ye("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`⟦}}");ye("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`⟧}}");ye("⟦","\\llbracket");ye("⟧","\\rrbracket");ye("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`⦃}}");ye("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`⦄}}");ye("⦃","\\lBrace");ye("⦄","\\rBrace");ye("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`⦵}}");ye("⦵","\\minuso");ye("\\darr","\\downarrow");ye("\\dArr","\\Downarrow");ye("\\Darr","\\Downarrow");ye("\\lang","\\langle");ye("\\rang","\\rangle");ye("\\uarr","\\uparrow");ye("\\uArr","\\Uparrow");ye("\\Uarr","\\Uparrow");ye("\\N","\\mathbb{N}");ye("\\R","\\mathbb{R}");ye("\\Z","\\mathbb{Z}");ye("\\alef","\\aleph");ye("\\alefsym","\\aleph");ye("\\Alpha","\\mathrm{A}");ye("\\Beta","\\mathrm{B}");ye("\\bull","\\bullet");ye("\\Chi","\\mathrm{X}");ye("\\clubs","\\clubsuit");ye("\\cnums","\\mathbb{C}");ye("\\Complex","\\mathbb{C}");ye("\\Dagger","\\ddagger");ye("\\diamonds","\\diamondsuit");ye("\\empty","\\emptyset");ye("\\Epsilon","\\mathrm{E}");ye("\\Eta","\\mathrm{H}");ye("\\exist","\\exists");ye("\\harr","\\leftrightarrow");ye("\\hArr","\\Leftrightarrow");ye("\\Harr","\\Leftrightarrow");ye("\\hearts","\\heartsuit");ye("\\image","\\Im");ye("\\infin","\\infty");ye("\\Iota","\\mathrm{I}");ye("\\isin","\\in");ye("\\Kappa","\\mathrm{K}");ye("\\larr","\\leftarrow");ye("\\lArr","\\Leftarrow");ye("\\Larr","\\Leftarrow");ye("\\lrarr","\\leftrightarrow");ye("\\lrArr","\\Leftrightarrow");ye("\\Lrarr","\\Leftrightarrow");ye("\\Mu","\\mathrm{M}");ye("\\natnums","\\mathbb{N}");ye("\\Nu","\\mathrm{N}");ye("\\Omicron","\\mathrm{O}");ye("\\plusmn","\\pm");ye("\\rarr","\\rightarrow");ye("\\rArr","\\Rightarrow");ye("\\Rarr","\\Rightarrow");ye("\\real","\\Re");ye("\\reals","\\mathbb{R}");ye("\\Reals","\\mathbb{R}");ye("\\Rho","\\mathrm{P}");ye("\\sdot","\\cdot");ye("\\sect","\\S");ye("\\spades","\\spadesuit");ye("\\sub","\\subset");ye("\\sube","\\subseteq");ye("\\supe","\\supseteq");ye("\\Tau","\\mathrm{T}");ye("\\thetasym","\\vartheta");ye("\\weierp","\\wp");ye("\\Zeta","\\mathrm{Z}");ye("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");ye("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");ye("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");ye("\\bra","\\mathinner{\\langle{#1}|}");ye("\\ket","\\mathinner{|{#1}\\rangle}");ye("\\braket","\\mathinner{\\langle{#1}\\rangle}");ye("\\Bra","\\left\\langle#1\\right|");ye("\\Ket","\\left|#1\\right\\rangle");var Pie=t=>e=>{var n=e.consumeArg().tokens,r=e.consumeArg().tokens,i=e.consumeArg().tokens,a=e.consumeArg().tokens,s=e.macros.get("|"),o=e.macros.get("\\|");e.macros.beginGroup();var l=d=>h=>{t&&(h.macros.set("|",s),i.length&&h.macros.set("\\|",o));var f=d;if(!d&&i.length){var m=h.future();m.text==="|"&&(h.popToken(),f=!0)}return{tokens:f?i:r,numArgs:0}};e.macros.set("|",l(!1)),i.length&&e.macros.set("\\|",l(!0));var u=e.consumeArg().tokens,c=e.expandTokens([...a,...u,...n]);return e.macros.endGroup(),{tokens:c.reverse(),numArgs:0}};ye("\\bra@ket",Pie(!1));ye("\\bra@set",Pie(!0));ye("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");ye("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");ye("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");ye("\\angln","{\\angl n}");ye("\\blue","\\textcolor{##6495ed}{#1}");ye("\\orange","\\textcolor{##ffa500}{#1}");ye("\\pink","\\textcolor{##ff00af}{#1}");ye("\\red","\\textcolor{##df0030}{#1}");ye("\\green","\\textcolor{##28ae7b}{#1}");ye("\\gray","\\textcolor{gray}{#1}");ye("\\purple","\\textcolor{##9d38bd}{#1}");ye("\\blueA","\\textcolor{##ccfaff}{#1}");ye("\\blueB","\\textcolor{##80f6ff}{#1}");ye("\\blueC","\\textcolor{##63d9ea}{#1}");ye("\\blueD","\\textcolor{##11accd}{#1}");ye("\\blueE","\\textcolor{##0c7f99}{#1}");ye("\\tealA","\\textcolor{##94fff5}{#1}");ye("\\tealB","\\textcolor{##26edd5}{#1}");ye("\\tealC","\\textcolor{##01d1c1}{#1}");ye("\\tealD","\\textcolor{##01a995}{#1}");ye("\\tealE","\\textcolor{##208170}{#1}");ye("\\greenA","\\textcolor{##b6ffb0}{#1}");ye("\\greenB","\\textcolor{##8af281}{#1}");ye("\\greenC","\\textcolor{##74cf70}{#1}");ye("\\greenD","\\textcolor{##1fab54}{#1}");ye("\\greenE","\\textcolor{##0d923f}{#1}");ye("\\goldA","\\textcolor{##ffd0a9}{#1}");ye("\\goldB","\\textcolor{##ffbb71}{#1}");ye("\\goldC","\\textcolor{##ff9c39}{#1}");ye("\\goldD","\\textcolor{##e07d10}{#1}");ye("\\goldE","\\textcolor{##a75a05}{#1}");ye("\\redA","\\textcolor{##fca9a9}{#1}");ye("\\redB","\\textcolor{##ff8482}{#1}");ye("\\redC","\\textcolor{##f9685d}{#1}");ye("\\redD","\\textcolor{##e84d39}{#1}");ye("\\redE","\\textcolor{##bc2612}{#1}");ye("\\maroonA","\\textcolor{##ffbde0}{#1}");ye("\\maroonB","\\textcolor{##ff92c6}{#1}");ye("\\maroonC","\\textcolor{##ed5fa6}{#1}");ye("\\maroonD","\\textcolor{##ca337c}{#1}");ye("\\maroonE","\\textcolor{##9e034e}{#1}");ye("\\purpleA","\\textcolor{##ddd7ff}{#1}");ye("\\purpleB","\\textcolor{##c6b9fc}{#1}");ye("\\purpleC","\\textcolor{##aa87ff}{#1}");ye("\\purpleD","\\textcolor{##7854ab}{#1}");ye("\\purpleE","\\textcolor{##543b78}{#1}");ye("\\mintA","\\textcolor{##f5f9e8}{#1}");ye("\\mintB","\\textcolor{##edf2df}{#1}");ye("\\mintC","\\textcolor{##e0e5cc}{#1}");ye("\\grayA","\\textcolor{##f6f7f7}{#1}");ye("\\grayB","\\textcolor{##f0f1f2}{#1}");ye("\\grayC","\\textcolor{##e3e5e6}{#1}");ye("\\grayD","\\textcolor{##d6d8da}{#1}");ye("\\grayE","\\textcolor{##babec2}{#1}");ye("\\grayF","\\textcolor{##888d93}{#1}");ye("\\grayG","\\textcolor{##626569}{#1}");ye("\\grayH","\\textcolor{##3b3e40}{#1}");ye("\\grayI","\\textcolor{##21242c}{#1}");ye("\\kaBlue","\\textcolor{##314453}{#1}");ye("\\kaGreen","\\textcolor{##71B307}{#1}");var Die={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class xUe{constructor(e,n,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=n,this.expansionCount=0,this.feed(e),this.macros=new vUe(yUe,n.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new cj(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var n,r,i;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;n=this.popToken(),{tokens:i,end:r}=this.consumeArg(["]"])}else({tokens:i,start:n,end:r}=this.consumeArg());return this.pushToken(new Ks("EOF",r.loc)),this.pushTokens(i),new Ks("",ys.range(n,r))}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var n=[],r=e&&e.length>0;r||this.consumeSpaces();var i=this.future(),a,s=0,o=0;do{if(a=this.popToken(),n.push(a),a.text==="{")++s;else if(a.text==="}"){if(--s,s===-1)throw new Mt("Extra }",a)}else if(a.text==="EOF")throw new Mt("Unexpected end of input in a macro argument, expected '"+(e&&r?e[o]:"}")+"'",a);if(e&&r)if((s===0||s===1&&e[o]==="{")&&a.text===e[o]){if(++o,o===e.length){n.splice(-o,o);break}}else o=0}while(s!==0||r);return i.text==="{"&&n[n.length-1].text==="}"&&(n.pop(),n.shift()),n.reverse(),{tokens:n,start:i,end:a}}consumeArgs(e,n){if(n){if(n.length!==e+1)throw new Mt("The length of delimiters doesn't match the number of args!");for(var r=n[0],i=0;i<r.length;i++){var a=this.popToken();if(r[i]!==a.text)throw new Mt("Use of the macro doesn't match its definition",a)}}for(var s=[],o=0;o<e;o++)s.push(this.consumeArg(n&&n[o+1]).tokens);return s}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new Mt("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var n=this.popToken(),r=n.text,i=n.noexpand?null:this._getExpansion(r);if(i==null||e&&i.unexpandable){if(e&&i==null&&r[0]==="\\"&&!this.isDefined(r))throw new Mt("Undefined control sequence: "+r);return this.pushToken(n),!1}this.countExpansion(1);var a=i.tokens,s=this.consumeArgs(i.numArgs,i.delimiters);if(i.numArgs){a=a.slice();for(var o=a.length-1;o>=0;--o){var l=a[o];if(l.text==="#"){if(o===0)throw new Mt("Incomplete placeholder at end of macro body",l);if(l=a[--o],l.text==="#")a.splice(o+1,1);else if(/^[1-9]$/.test(l.text))a.splice(o,2,...s[+l.text-1]);else throw new Mt("Not a valid argument number",l)}}}return this.pushTokens(a),a.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new Ks(e)]):void 0}expandTokens(e){var n=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;)if(this.expandOnce(!0)===!1){var i=this.stack.pop();i.treatAsRelax&&(i.noexpand=!1,i.treatAsRelax=!1),n.push(i)}return this.countExpansion(n.length),n}expandMacroAsText(e){var n=this.expandMacro(e);return n&&n.map(r=>r.text).join("")}_getExpansion(e){var n=this.macros.get(e);if(n==null)return n;if(e.length===1){var r=this.lexer.catcodes[e];if(r!=null&&r!==13)return}var i=typeof n=="function"?n(this):n;if(typeof i=="string"){var a=0;if(i.indexOf("#")!==-1)for(var s=i.replace(/##/g,"");s.indexOf("#"+(a+1))!==-1;)++a;for(var o=new cj(i,this.settings),l=[],u=o.lex();u.text!=="EOF";)l.push(u),u=o.lex();l.reverse();var c={tokens:l,numArgs:a};return c}return i}isDefined(e){return this.macros.has(e)||Wc.hasOwnProperty(e)||Hr.math.hasOwnProperty(e)||Hr.text.hasOwnProperty(e)||Die.hasOwnProperty(e)}isExpandable(e){var n=this.macros.get(e);return n!=null?typeof n=="string"||typeof n=="function"||!n.unexpandable:Wc.hasOwnProperty(e)&&!Wc[e].primitive}}var fj=/^[₊₋₌₍₎₀₁₂₃₄₅₆₇₈₉ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓᵦᵧᵨᵩᵪ]/,gb=Object.freeze({"₊":"+","₋":"-","₌":"=","₍":"(","₎":")","₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9","ₐ":"a","ₑ":"e","ₕ":"h","ᵢ":"i","ⱼ":"j","ₖ":"k","ₗ":"l","ₘ":"m","ₙ":"n","ₒ":"o","ₚ":"p","ᵣ":"r","ₛ":"s","ₜ":"t","ᵤ":"u","ᵥ":"v","ₓ":"x","ᵦ":"β","ᵧ":"γ","ᵨ":"ρ","ᵩ":"ϕ","ᵪ":"χ","⁺":"+","⁻":"-","⁼":"=","⁽":"(","⁾":")","⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","ᴬ":"A","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ⱽ":"V","ᵂ":"W","ᵃ":"a","ᵇ":"b","ᶜ":"c","ᵈ":"d","ᵉ":"e","ᶠ":"f","ᵍ":"g",ʰ:"h","ⁱ":"i",ʲ:"j","ᵏ":"k",ˡ:"l","ᵐ":"m",ⁿ:"n","ᵒ":"o","ᵖ":"p",ʳ:"r",ˢ:"s","ᵗ":"t","ᵘ":"u","ᵛ":"v",ʷ:"w",ˣ:"x",ʸ:"y","ᶻ":"z","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"ϕ","ᵡ":"χ","ᶿ":"θ"}),UT={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"},"̧":{text:"\\c"}},pj={á:"á",à:"à",ä:"ä",ǟ:"ǟ",ã:"ã",ā:"ā",ă:"ă",ắ:"ắ",ằ:"ằ",ẵ:"ẵ",ǎ:"ǎ",â:"â",ấ:"ấ",ầ:"ầ",ẫ:"ẫ",ȧ:"ȧ",ǡ:"ǡ",å:"å",ǻ:"ǻ",ḃ:"ḃ",ć:"ć",ḉ:"ḉ",č:"č",ĉ:"ĉ",ċ:"ċ",ç:"ç",ď:"ď",ḋ:"ḋ",ḑ:"ḑ",é:"é",è:"è",ë:"ë",ẽ:"ẽ",ē:"ē",ḗ:"ḗ",ḕ:"ḕ",ĕ:"ĕ",ḝ:"ḝ",ě:"ě",ê:"ê",ế:"ế",ề:"ề",ễ:"ễ",ė:"ė",ȩ:"ȩ",ḟ:"ḟ",ǵ:"ǵ",ḡ:"ḡ",ğ:"ğ",ǧ:"ǧ",ĝ:"ĝ",ġ:"ġ",ģ:"ģ",ḧ:"ḧ",ȟ:"ȟ",ĥ:"ĥ",ḣ:"ḣ",ḩ:"ḩ",í:"í",ì:"ì",ï:"ï",ḯ:"ḯ",ĩ:"ĩ",ī:"ī",ĭ:"ĭ",ǐ:"ǐ",î:"î",ǰ:"ǰ",ĵ:"ĵ",ḱ:"ḱ",ǩ:"ǩ",ķ:"ķ",ĺ:"ĺ",ľ:"ľ",ļ:"ļ",ḿ:"ḿ",ṁ:"ṁ",ń:"ń",ǹ:"ǹ",ñ:"ñ",ň:"ň",ṅ:"ṅ",ņ:"ņ",ó:"ó",ò:"ò",ö:"ö",ȫ:"ȫ",õ:"õ",ṍ:"ṍ",ṏ:"ṏ",ȭ:"ȭ",ō:"ō",ṓ:"ṓ",ṑ:"ṑ",ŏ:"ŏ",ǒ:"ǒ",ô:"ô",ố:"ố",ồ:"ồ",ỗ:"ỗ",ȯ:"ȯ",ȱ:"ȱ",ő:"ő",ṕ:"ṕ",ṗ:"ṗ",ŕ:"ŕ",ř:"ř",ṙ:"ṙ",ŗ:"ŗ",ś:"ś",ṥ:"ṥ",š:"š",ṧ:"ṧ",ŝ:"ŝ",ṡ:"ṡ",ş:"ş",ẗ:"ẗ",ť:"ť",ṫ:"ṫ",ţ:"ţ",ú:"ú",ù:"ù",ü:"ü",ǘ:"ǘ",ǜ:"ǜ",ǖ:"ǖ",ǚ:"ǚ",ũ:"ũ",ṹ:"ṹ",ū:"ū",ṻ:"ṻ",ŭ:"ŭ",ǔ:"ǔ",û:"û",ů:"ů",ű:"ű",ṽ:"ṽ",ẃ:"ẃ",ẁ:"ẁ",ẅ:"ẅ",ŵ:"ŵ",ẇ:"ẇ",ẘ:"ẘ",ẍ:"ẍ",ẋ:"ẋ",ý:"ý",ỳ:"ỳ",ÿ:"ÿ",ỹ:"ỹ",ȳ:"ȳ",ŷ:"ŷ",ẏ:"ẏ",ẙ:"ẙ",ź:"ź",ž:"ž",ẑ:"ẑ",ż:"ż",Á:"Á",À:"À",Ä:"Ä",Ǟ:"Ǟ",Ã:"Ã",Ā:"Ā",Ă:"Ă",Ắ:"Ắ",Ằ:"Ằ",Ẵ:"Ẵ",Ǎ:"Ǎ",Â:"Â",Ấ:"Ấ",Ầ:"Ầ",Ẫ:"Ẫ",Ȧ:"Ȧ",Ǡ:"Ǡ",Å:"Å",Ǻ:"Ǻ",Ḃ:"Ḃ",Ć:"Ć",Ḉ:"Ḉ",Č:"Č",Ĉ:"Ĉ",Ċ:"Ċ",Ç:"Ç",Ď:"Ď",Ḋ:"Ḋ",Ḑ:"Ḑ",É:"É",È:"È",Ë:"Ë",Ẽ:"Ẽ",Ē:"Ē",Ḗ:"Ḗ",Ḕ:"Ḕ",Ĕ:"Ĕ",Ḝ:"Ḝ",Ě:"Ě",Ê:"Ê",Ế:"Ế",Ề:"Ề",Ễ:"Ễ",Ė:"Ė",Ȩ:"Ȩ",Ḟ:"Ḟ",Ǵ:"Ǵ",Ḡ:"Ḡ",Ğ:"Ğ",Ǧ:"Ǧ",Ĝ:"Ĝ",Ġ:"Ġ",Ģ:"Ģ",Ḧ:"Ḧ",Ȟ:"Ȟ",Ĥ:"Ĥ",Ḣ:"Ḣ",Ḩ:"Ḩ",Í:"Í",Ì:"Ì",Ï:"Ï",Ḯ:"Ḯ",Ĩ:"Ĩ",Ī:"Ī",Ĭ:"Ĭ",Ǐ:"Ǐ",Î:"Î",İ:"İ",Ĵ:"Ĵ",Ḱ:"Ḱ",Ǩ:"Ǩ",Ķ:"Ķ",Ĺ:"Ĺ",Ľ:"Ľ",Ļ:"Ļ",Ḿ:"Ḿ",Ṁ:"Ṁ",Ń:"Ń",Ǹ:"Ǹ",Ñ:"Ñ",Ň:"Ň",Ṅ:"Ṅ",Ņ:"Ņ",Ó:"Ó",Ò:"Ò",Ö:"Ö",Ȫ:"Ȫ",Õ:"Õ",Ṍ:"Ṍ",Ṏ:"Ṏ",Ȭ:"Ȭ",Ō:"Ō",Ṓ:"Ṓ",Ṑ:"Ṑ",Ŏ:"Ŏ",Ǒ:"Ǒ",Ô:"Ô",Ố:"Ố",Ồ:"Ồ",Ỗ:"Ỗ",Ȯ:"Ȯ",Ȱ:"Ȱ",Ő:"Ő",Ṕ:"Ṕ",Ṗ:"Ṗ",Ŕ:"Ŕ",Ř:"Ř",Ṙ:"Ṙ",Ŗ:"Ŗ",Ś:"Ś",Ṥ:"Ṥ",Š:"Š",Ṧ:"Ṧ",Ŝ:"Ŝ",Ṡ:"Ṡ",Ş:"Ş",Ť:"Ť",Ṫ:"Ṫ",Ţ:"Ţ",Ú:"Ú",Ù:"Ù",Ü:"Ü",Ǘ:"Ǘ",Ǜ:"Ǜ",Ǖ:"Ǖ",Ǚ:"Ǚ",Ũ:"Ũ",Ṹ:"Ṹ",Ū:"Ū",Ṻ:"Ṻ",Ŭ:"Ŭ",Ǔ:"Ǔ",Û:"Û",Ů:"Ů",Ű:"Ű",Ṽ:"Ṽ",Ẃ:"Ẃ",Ẁ:"Ẁ",Ẅ:"Ẅ",Ŵ:"Ŵ",Ẇ:"Ẇ",Ẍ:"Ẍ",Ẋ:"Ẋ",Ý:"Ý",Ỳ:"Ỳ",Ÿ:"Ÿ",Ỹ:"Ỹ",Ȳ:"Ȳ",Ŷ:"Ŷ",Ẏ:"Ẏ",Ź:"Ź",Ž:"Ž",Ẑ:"Ẑ",Ż:"Ż",ά:"ά",ὰ:"ὰ",ᾱ:"ᾱ",ᾰ:"ᾰ",έ:"έ",ὲ:"ὲ",ή:"ή",ὴ:"ὴ",ί:"ί",ὶ:"ὶ",ϊ:"ϊ",ΐ:"ΐ",ῒ:"ῒ",ῑ:"ῑ",ῐ:"ῐ",ό:"ό",ὸ:"ὸ",ύ:"ύ",ὺ:"ὺ",ϋ:"ϋ",ΰ:"ΰ",ῢ:"ῢ",ῡ:"ῡ",ῠ:"ῠ",ώ:"ώ",ὼ:"ὼ",Ύ:"Ύ",Ὺ:"Ὺ",Ϋ:"Ϋ",Ῡ:"Ῡ",Ῠ:"Ῠ",Ώ:"Ώ",Ὼ:"Ὼ"};let Oie=class Lie{constructor(e,n){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new xUe(e,n,this.mode),this.settings=n,this.leftrightDepth=0}expect(e,n){if(n===void 0&&(n=!0),this.fetch().text!==e)throw new Mt("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());n&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var n=this.nextToken;this.consume(),this.gullet.pushToken(new Ks("}")),this.gullet.pushTokens(e);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=n,r}parseExpression(e,n){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var i=this.fetch();if(Lie.endOfExpression.indexOf(i.text)!==-1||n&&i.text===n||e&&Wc[i.text]&&Wc[i.text].infix)break;var a=this.parseAtom(n);if(a){if(a.type==="internal")continue}else break;r.push(a)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(e){for(var n=-1,r,i=0;i<e.length;i++)if(e[i].type==="infix"){if(n!==-1)throw new Mt("only one infix operator per group",e[i].token);n=i,r=e[i].replaceWith}if(n!==-1&&r){var a,s,o=e.slice(0,n),l=e.slice(n+1);o.length===1&&o[0].type==="ordgroup"?a=o[0]:a={type:"ordgroup",mode:this.mode,body:o},l.length===1&&l[0].type==="ordgroup"?s=l[0]:s={type:"ordgroup",mode:this.mode,body:l};var u;return r==="\\\\abovefrac"?u=this.callFunction(r,[a,e[n],s],[]):u=this.callFunction(r,[a,s],[]),[u]}else return e}handleSupSubscript(e){var n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();var i;do{var a;i=this.parseGroup(e)}while(((a=i)==null?void 0:a.type)==="internal");if(!i)throw new Mt("Expected group after '"+r+"'",n);return i}formatUnsupportedCmd(e){for(var n=[],r=0;r<e.length;r++)n.push({type:"textord",mode:"text",text:e[r]});var i={type:"text",mode:this.mode,body:n},a={type:"color",mode:this.mode,color:this.settings.errorColor,body:[i]};return a}parseAtom(e){var n=this.parseGroup("atom",e);if(n?.type==="internal"||this.mode==="text")return n;for(var r,i;;){this.consumeSpaces();var a=this.fetch();if(a.text==="\\limits"||a.text==="\\nolimits"){if(n&&n.type==="op"){var s=a.text==="\\limits";n.limits=s,n.alwaysHandleSupSub=!0}else if(n&&n.type==="operatorname")n.alwaysHandleSupSub&&(n.limits=a.text==="\\limits");else throw new Mt("Limit controls must follow a math operator",a);this.consume()}else if(a.text==="^"){if(r)throw new Mt("Double superscript",a);r=this.handleSupSubscript("superscript")}else if(a.text==="_"){if(i)throw new Mt("Double subscript",a);i=this.handleSupSubscript("subscript")}else if(a.text==="'"){if(r)throw new Mt("Double superscript",a);var o={type:"textord",mode:this.mode,text:"\\prime"},l=[o];for(this.consume();this.fetch().text==="'";)l.push(o),this.consume();this.fetch().text==="^"&&l.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:l}}else if(gb[a.text]){var u=fj.test(a.text),c=[];for(c.push(new Ks(gb[a.text])),this.consume();;){var d=this.fetch().text;if(!gb[d]||fj.test(d)!==u)break;c.unshift(new Ks(gb[d])),this.consume()}var h=this.subparse(c);u?i={type:"ordgroup",mode:"math",body:h}:r={type:"ordgroup",mode:"math",body:h}}else break}return r||i?{type:"supsub",mode:this.mode,base:n,sup:r,sub:i}:n}parseFunction(e,n){var r=this.fetch(),i=r.text,a=Wc[i];if(!a)return null;if(this.consume(),n&&n!=="atom"&&!a.allowedInArgument)throw new Mt("Got function '"+i+"' with no arguments"+(n?" as "+n:""),r);if(this.mode==="text"&&!a.allowedInText)throw new Mt("Can't use function '"+i+"' in text mode",r);if(this.mode==="math"&&a.allowedInMath===!1)throw new Mt("Can't use function '"+i+"' in math mode",r);var{args:s,optArgs:o}=this.parseArguments(i,a);return this.callFunction(i,s,o,r,e)}callFunction(e,n,r,i,a){var s={funcName:e,parser:this,token:i,breakOnTokenText:a},o=Wc[e];if(o&&o.handler)return o.handler(s,n,r);throw new Mt("No function handler for "+e)}parseArguments(e,n){var r=n.numArgs+n.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var i=[],a=[],s=0;s<r;s++){var o=n.argTypes&&n.argTypes[s],l=s<n.numOptionalArgs;(n.primitive&&o==null||n.type==="sqrt"&&s===1&&a[0]==null)&&(o="primitive");var u=this.parseGroupOfType("argument to '"+e+"'",o,l);if(l)a.push(u);else if(u!=null)i.push(u);else throw new Mt("Null argument, please report this as a bug")}return{args:i,optArgs:a}}parseGroupOfType(e,n,r){switch(n){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,n);case"hbox":{var i=this.parseArgumentGroup(r,"text");return i!=null?{type:"styling",mode:i.mode,body:[i],style:"text"}:null}case"raw":{var a=this.parseStringGroup("raw",r);return a!=null?{type:"raw",mode:"text",string:a.text}:null}case"primitive":{if(r)throw new Mt("A primitive argument cannot be optional");var s=this.parseGroup(e);if(s==null)throw new Mt("Expected group as "+e,this.fetch());return s}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new Mt("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,n){var r=this.gullet.scanArgument(n);if(r==null)return null;for(var i="",a;(a=this.fetch()).text!=="EOF";)i+=a.text,this.consume();return this.consume(),r.text=i,r}parseRegexGroup(e,n){for(var r=this.fetch(),i=r,a="",s;(s=this.fetch()).text!=="EOF"&&e.test(a+s.text);)i=s,a+=i.text,this.consume();if(a==="")throw new Mt("Invalid "+n+": '"+r.text+"'",r);return r.range(i,a)}parseColorGroup(e){var n=this.parseStringGroup("color",e);if(n==null)return null;var r=/^(#[a-f0-9]{3,4}|#[a-f0-9]{6}|#[a-f0-9]{8}|[a-f0-9]{6}|[a-z]+)$/i.exec(n.text);if(!r)throw new Mt("Invalid color: '"+n.text+"'",n);var i=r[0];return/^[0-9a-f]{6}$/i.test(i)&&(i="#"+i),{type:"color-token",mode:this.mode,color:i}}parseSizeGroup(e){var n,r=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?n=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):n=this.parseStringGroup("size",e),!n)return null;!e&&n.text.length===0&&(n.text="0pt",r=!0);var i=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(n.text);if(!i)throw new Mt("Invalid size: '"+n.text+"'",n);var a={number:+(i[1]+i[2]),unit:i[3]};if(!Vre(a))throw new Mt("Invalid unit: '"+a.unit+"'",n);return{type:"size",mode:this.mode,value:a,isBlank:r}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var n=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),n==null)return null;var r=n.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,n){var r=this.gullet.scanArgument(e);if(r==null)return null;var i=this.mode;n&&this.switchMode(n),this.gullet.beginGroup();var a=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var s={type:"ordgroup",mode:this.mode,loc:r.loc,body:a};return n&&this.switchMode(i),s}parseGroup(e,n){var r=this.fetch(),i=r.text,a;if(i==="{"||i==="\\begingroup"){this.consume();var s=i==="{"?"}":"\\endgroup";this.gullet.beginGroup();var o=this.parseExpression(!1,s),l=this.fetch();this.expect(s),this.gullet.endGroup(),a={type:"ordgroup",mode:this.mode,loc:ys.range(r,l),body:o,semisimple:i==="\\begingroup"||void 0}}else if(a=this.parseFunction(n,e)||this.parseSymbol(),a==null&&i[0]==="\\"&&!Die.hasOwnProperty(i)){if(this.settings.throwOnError)throw new Mt("Undefined control sequence: "+i,r);a=this.formatUnsupportedCmd(i),this.consume()}return a}formLigatures(e){for(var n=e.length-1,r=0;r<n;++r){var i=e[r],a=i.text;a==="-"&&e[r+1].text==="-"&&(r+1<n&&e[r+2].text==="-"?(e.splice(r,3,{type:"textord",mode:"text",loc:ys.range(i,e[r+2]),text:"---"}),n-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:ys.range(i,e[r+1]),text:"--"}),n-=1)),(a==="'"||a==="`")&&e[r+1].text===a&&(e.splice(r,2,{type:"textord",mode:"text",loc:ys.range(i,e[r+1]),text:a+a}),n-=1)}}parseSymbol(){var e=this.fetch(),n=e.text;if(/^\\verb[^a-zA-Z]/.test(n)){this.consume();var r=n.slice(5),i=r.charAt(0)==="*";if(i&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new Mt(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:i}}pj.hasOwnProperty(n[0])&&!Hr[this.mode][n[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+n[0]+'" used in math mode',e),n=pj[n[0]]+n.slice(1));var a=mUe.exec(n);a&&(n=n.substring(0,a.index),n==="i"?n="ı":n==="j"&&(n="ȷ"));var s;if(Hr[this.mode][n]){this.settings.strict&&this.mode==="math"&&qI.indexOf(n)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+n[0]+'" used in math mode',e);var o=Hr[this.mode][n].group,l=ys.range(e),u;if(oBe.hasOwnProperty(o)){var c=o;u={type:"atom",mode:this.mode,family:c,loc:l,text:n}}else u={type:o,mode:this.mode,loc:l,text:n};s=u}else if(n.charCodeAt(0)>=128)this.settings.strict&&($re(n.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+n[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+n[0]+'"'+(" ("+n.charCodeAt(0)+")"),e)),s={type:"textord",mode:"text",loc:ys.range(e),text:n};else return null;if(this.consume(),a)for(var d=0;d<a[0].length;d++){var h=a[0][d];if(!UT[h])throw new Mt("Unknown accent ' "+h+"'",e);var f=UT[h][this.mode]||UT[h].text;if(!f)throw new Mt("Accent "+h+" unsupported in "+this.mode+" mode",e);s={type:"accent",mode:this.mode,loc:ys.range(e),label:f,isStretchy:!1,isShifty:!0,base:s}}return s}};Oie.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var n7=function(e,n){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new Oie(e,n);delete r.gullet.macros.current["\\df@tag"];var i=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!n.displayMode)throw new Mt("\\tag works only in display equations");i=[{type:"tag",mode:"text",body:i,tag:r.subparse([new Ks("\\df@tag")])}]}return i},Fie=function(e,n,r){n.textContent="";var i=r7(e,r).toNode();n.appendChild(i)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),Fie=function(){throw new Mt("KaTeX doesn't work in quirks mode.")});var bUe=function(e,n){var r=r7(e,n).toMarkup();return r},_Ue=function(e,n){var r=new BR(n);return n7(e,r)},Bie=function(e,n,r){if(r.throwOnError||!(e instanceof Mt))throw e;var i=tt.makeSpan(["katex-error"],[new _o(n)]);return i.setAttribute("title",e.toString()),i.setAttribute("style","color:"+r.errorColor),i},r7=function(e,n){var r=new BR(n);try{var i=n7(e,r);return IBe(i,e,r)}catch(a){return Bie(a,e,r)}},wUe=function(e,n){var r=new BR(n);try{var i=n7(e,r);return NBe(i,e,r)}catch(a){return Bie(a,e,r)}},SUe="0.16.27",EUe={Span:Lv,Anchor:jR,SymbolNode:_o,SvgNode:ju,PathNode:ld,LineNode:VI},mj={version:SUe,render:Fie,renderToString:bUe,ParseError:Mt,SETTINGS_SCHEMA:Gb,__parse:_Ue,__renderToDomTree:r7,__renderToHTMLTree:wUe,__setFontMetrics:QFe,__defineSymbol:Y,__defineFunction:jt,__defineMacro:ye,__domTree:EUe};const TUe={};function Uie(t){const e=this,n=t||TUe,r=e.data(),i=r.micromarkExtensions||(r.micromarkExtensions=[]),a=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),s=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);i.push(TFe(n)),a.push(vFe()),s.push(yFe(n))}function CUe(t){mre(t,[/\r?\n|\r/g,MUe])}function MUe(){return{type:"break"}}function zie(){return function(t){CUe(t)}}const gj=/[#.]/g;function AUe(t,e){const n=t||"",r={};let i=0,a,s;for(;i<n.length;){gj.lastIndex=i;const o=gj.exec(n),l=n.slice(i,o?o.index:n.length);l&&(a?a==="#"?r.id=l:Array.isArray(r.className)?r.className.push(l):r.className=[l]:s=l,i+=l.length),o&&(a=o[0],i++)}return{type:"element",tagName:s||e||"div",properties:r,children:[]}}function jie(t,e,n){const r=n?RUe(n):void 0;function i(a,s,...o){let l;if(a==null){l={type:"root",children:[]};const u=s;o.unshift(u)}else{l=AUe(a,e);const u=l.tagName.toLowerCase(),c=r?r.get(u):void 0;if(l.tagName=c||u,kUe(s))o.unshift(s);else for(const[d,h]of Object.entries(s))IUe(t,l.properties,d,h)}for(const u of o)ZI(l.children,u);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return i}function kUe(t){if(t===null||typeof t!="object"||Array.isArray(t))return!0;if(typeof t.type!="string")return!1;const e=t,n=Object.keys(t);for(const r of n){const i=e[r];if(i&&typeof i=="object"){if(!Array.isArray(i))return!0;const a=i;for(const s of a)if(typeof s!="number"&&typeof s!="string")return!0}}return!!("children"in t&&Array.isArray(t.children))}function IUe(t,e,n,r){const i=d3(t,n);let a;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;a=r}else typeof r=="boolean"?a=r:typeof r=="string"?i.spaceSeparated?a=WU(r):i.commaSeparated?a=HU(r):i.commaOrSpaceSeparated?a=WU(HU(r).join(" ")):a=vj(i,i.property,r):Array.isArray(r)?a=[...r]:a=i.property==="style"?NUe(r):String(r);if(Array.isArray(a)){const s=[];for(const o of a)s.push(vj(i,i.property,o));a=s}i.property==="className"&&Array.isArray(e.className)&&(a=e.className.concat(a)),e[i.property]=a}}function ZI(t,e){if(e!=null)if(typeof e=="number"||typeof e=="string")t.push({type:"text",value:String(e)});else if(Array.isArray(e))for(const n of e)ZI(t,n);else if(typeof e=="object"&&"type"in e)e.type==="root"?ZI(t,e.children):t.push(e);else throw new Error("Expected node, nodes, or string, got `"+e+"`")}function vj(t,e,n){if(typeof n=="string"){if(t.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((t.boolean||t.overloadedBoolean)&&(n===""||V1(n)===V1(e)))return!0}return n}function NUe(t){const e=[];for(const[n,r]of Object.entries(t))e.push([n,r].join(": "));return e.join("; ")}function RUe(t){const e=new Map;for(const n of t)e.set(n.toLowerCase(),n);return e}const PUe=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],Hie=jie(Nv,"div"),$ie=jie(bd,"g",PUe),Ol={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function DUe(t,e){return Vie(t,{})||{type:"root",children:[]}}function Vie(t,e){const n=OUe(t,e);return n&&e.afterTransform&&e.afterTransform(t,n),n}function OUe(t,e){switch(t.nodeType){case 1:return UUe(t,e);case 3:return FUe(t);case 8:return BUe(t);case 9:return yj(t,e);case 10:return LUe();case 11:return yj(t,e);default:return}}function yj(t,e){return{type:"root",children:qie(t,e)}}function LUe(){return{type:"doctype"}}function FUe(t){return{type:"text",value:t.nodeValue||""}}function BUe(t){return{type:"comment",value:t.nodeValue||""}}function UUe(t,e){const n=t.namespaceURI,r=n===Ol.svg?$ie:Hie,i=n===Ol.html?t.tagName.toLowerCase():t.tagName,a=n===Ol.html&&i==="template"?t.content:t,s=t.getAttributeNames(),o={};let l=-1;for(;++l<s.length;)o[s[l]]=t.getAttribute(s[l])||"";return r(i,o,qie(a,e))}function qie(t,e){const n=t.childNodes,r=[];let i=-1;for(;++i<n.length;){const a=Vie(n[i],e);a!==void 0&&r.push(a)}return r}new DOMParser;function zUe(t,e){const n=jUe(t);return DUe(n)}function jUe(t){const e=document.createElement("template");return e.innerHTML=t,e.content}const xj=(function(t,e,n){const r=Pv(n);if(!t||!t.type||!t.children)throw new Error("Expected parent node");if(typeof e=="number"){if(e<0||e===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(e=t.children.indexOf(e),e<0)throw new Error("Expected child node or index");for(;++e<t.children.length;)if(r(t.children[e],e,t))return t.children[e]}),wf=(function(t){if(t==null)return VUe;if(typeof t=="string")return $Ue(t);if(typeof t=="object")return HUe(t);if(typeof t=="function")return i7(t);throw new Error("Expected function, string, or array as `test`")});function HUe(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=wf(t[n]);return i7(r);function r(...i){let a=-1;for(;++a<e.length;)if(e[a].apply(this,i))return!0;return!1}}function $Ue(t){return i7(e);function e(n){return n.tagName===t}}function i7(t){return e;function e(n,r,i){return!!(qUe(n)&&t.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function VUe(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="element"&&"tagName"in t&&typeof t.tagName=="string")}function qUe(t){return t!==null&&typeof t=="object"&&"type"in t&&"tagName"in t}const bj=/\n/g,_j=/[\t ]+/g,JI=wf("br"),wj=wf(QUe),GUe=wf("p"),Sj=wf("tr"),WUe=wf(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",JUe,eze]),Gie=wf(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function YUe(t,e){const n=e||{},r="children"in t?t.children:[],i=Gie(t),a=Xie(t,{whitespace:n.whitespace||"normal"}),s=[];(t.type==="text"||t.type==="comment")&&s.push(...Yie(t,{breakBefore:!0,breakAfter:!0}));let o=-1;for(;++o<r.length;)s.push(...Wie(r[o],t,{whitespace:a,breakBefore:o?void 0:i,breakAfter:o<r.length-1?JI(r[o+1]):i}));const l=[];let u;for(o=-1;++o<s.length;){const c=s[o];typeof c=="number"?u!==void 0&&c>u&&(u=c):c&&(u!==void 0&&u>-1&&l.push(`
`.repeat(u)||" "),u=-1,l.push(c))}return l.join("")}function Wie(t,e,n){return t.type==="element"?XUe(t,e,n):t.type==="text"?n.whitespace==="normal"?Yie(t,n):KUe(t):[]}function XUe(t,e,n){const r=Xie(t,n),i=t.children||[];let a=-1,s=[];if(WUe(t))return s;let o,l;for(JI(t)||Sj(t)&&xj(e,t,Sj)?l=`
`:GUe(t)?(o=2,l=2):Gie(t)&&(o=1,l=1);++a<i.length;)s=s.concat(Wie(i[a],t,{whitespace:r,breakBefore:a?void 0:o,breakAfter:a<i.length-1?JI(i[a+1]):l}));return wj(t)&&xj(e,t,wj)&&s.push("	"),o&&s.unshift(o),l&&s.push(l),s}function Yie(t,e){const n=String(t.value),r=[],i=[];let a=0;for(;a<=n.length;){bj.lastIndex=a;const l=bj.exec(n),u=l&&"index"in l?l.index:n.length;r.push(ZUe(n.slice(a,u).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),a===0?e.breakBefore:!0,u===n.length?e.breakAfter:!0)),a=u+1}let s=-1,o;for(;++s<r.length;)r[s].charCodeAt(r[s].length-1)===8203||s<r.length-1&&r[s+1].charCodeAt(0)===8203?(i.push(r[s]),o=void 0):r[s]?(typeof o=="number"&&i.push(o),i.push(r[s]),o=0):(s===0||s===r.length-1)&&i.push(0);return i}function KUe(t){return[String(t.value)]}function ZUe(t,e,n){const r=[];let i=0,a;for(;i<t.length;){_j.lastIndex=i;const s=_j.exec(t);a=s?s.index:t.length,!i&&!a&&s&&!e&&r.push(""),i!==a&&r.push(t.slice(i,a)),i=s?a+s[0].length:a}return i!==a&&!n&&r.push(""),r.join(" ")}function Xie(t,e){if(t.type==="element"){const n=t.properties||{};switch(t.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return n.wrap?"pre-wrap":"pre";case"td":case"th":return n.noWrap?"nowrap":e.whitespace;case"textarea":return"pre-wrap"}}return e.whitespace}function JUe(t){return!!(t.properties||{}).hidden}function QUe(t){return t.tagName==="td"||t.tagName==="th"}function eze(t){return t.tagName==="dialog"&&!(t.properties||{}).open}const tze={},nze=[];function Kie(t){const e=t||tze;return function(n,r){PR(n,"element",function(i,a){const s=Array.isArray(i.properties.className)?i.properties.className:nze,o=s.includes("language-math"),l=s.includes("math-display"),u=s.includes("math-inline");let c=l;if(!o&&!l&&!u)return;let d=a[a.length-1],h=i;if(i.tagName==="code"&&o&&d&&d.type==="element"&&d.tagName==="pre"&&(h=d,d=a[a.length-2],c=!0),!d)return;const f=YUe(h,{whitespace:"pre"});let m;try{m=mj.renderToString(f,{...e,displayMode:c,throwOnError:!0})}catch(b){const y=b,w=y.name.toLowerCase();r.message("Could not render math with KaTeX",{ancestors:[...a,i],cause:y,place:i.position,ruleId:w,source:"rehype-katex"});try{m=mj.renderToString(f,{...e,displayMode:c,strict:"ignore",throwOnError:!1})}catch{m=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(e.errorColor||"#cc0000"),title:String(b)},children:[{type:"text",value:f}]}]}}typeof m=="string"&&(m=zUe(m).children);const x=d.children.indexOf(h);return d.children.splice(x,1,...m),hre})}}function rze(t){const e=String(t),n=[];return{toOffset:i,toPoint:r};function r(a){if(typeof a=="number"&&a>-1&&a<=e.length){let s=0;for(;;){let o=n[s];if(o===void 0){const l=Ej(e,n[s-1]);o=l===-1?e.length+1:l+1,n[s]=o}if(o>a)return{line:s+1,column:a-(s>0?n[s-1]:0)+1,offset:a};s++}}}function i(a){if(a&&typeof a.line=="number"&&typeof a.column=="number"&&!Number.isNaN(a.line)&&!Number.isNaN(a.column)){for(;n.length<a.line;){const o=n[n.length-1],l=Ej(e,o),u=l===-1?e.length+1:l+1;if(o===u)break;n.push(u)}const s=(a.line>1?n[a.line-2]:0)+a.column-1;if(s<n[a.line-1])return s}}}function Ej(t,e){const n=t.indexOf("\r",e),r=t.indexOf(`
`,e);return r===-1?n:n===-1||n+1===r?r:n<r?n:r}const Zie={}.hasOwnProperty,ize=Object.prototype;function aze(t,e){const n=e||{};return a7({file:n.file||void 0,location:!1,schema:n.space==="svg"?bd:Nv,verbose:n.verbose||!1},t)}function a7(t,e){let n;switch(e.nodeName){case"#comment":{const r=e;return n={type:"comment",value:r.data},Yb(t,r,n),n}case"#document":case"#document-fragment":{const r=e,i="mode"in r?r.mode==="quirks"||r.mode==="limited-quirks":!1;if(n={type:"root",children:Jie(t,e.childNodes),data:{quirksMode:i}},t.file&&t.location){const a=String(t.file),s=rze(a),o=s.toPoint(0),l=s.toPoint(a.length);n.position={start:o,end:l}}return n}case"#documentType":{const r=e;return n={type:"doctype"},Yb(t,r,n),n}case"#text":{const r=e;return n={type:"text",value:r.value},Yb(t,r,n),n}default:return n=sze(t,e),n}}function Jie(t,e){let n=-1;const r=[];for(;++n<e.length;){const i=a7(t,e[n]);r.push(i)}return r}function sze(t,e){const n=t.schema;t.schema=e.namespaceURI===Ol.svg?bd:Nv;let r=-1;const i={};for(;++r<e.attrs.length;){const o=e.attrs[r],l=(o.prefix?o.prefix+":":"")+o.name;Zie.call(ize,l)||(i[l]=o.value)}const s=(t.schema.space==="svg"?$ie:Hie)(e.tagName,i,Jie(t,e.childNodes));if(Yb(t,e,s),s.tagName==="template"){const o=e,l=o.sourceCodeLocation,u=l&&l.startTag&&Wp(l.startTag),c=l&&l.endTag&&Wp(l.endTag),d=a7(t,o.content);u&&c&&t.file&&(d.position={start:u.end,end:c.start}),s.content=d}return t.schema=n,s}function Yb(t,e,n){if("sourceCodeLocation"in e&&e.sourceCodeLocation&&t.file){const r=oze(t,n,e.sourceCodeLocation);r&&(t.location=!0,n.position=r)}}function oze(t,e,n){const r=Wp(n);if(e.type==="element"){const i=e.children[e.children.length-1];if(r&&!n.endTag&&i&&i.position&&i.position.end&&(r.end=Object.assign({},i.position.end)),t.verbose){const a={};let s;if(n.attrs)for(s in n.attrs)Zie.call(n.attrs,s)&&(a[d3(t.schema,s).property]=Wp(n.attrs[s]));n.startTag;const o=Wp(n.startTag),l=n.endTag?Wp(n.endTag):void 0,u={opening:o};l&&(u.closing=l),u.properties=a,e.data={position:u}}}return r}function Wp(t){const e=Tj({line:t.startLine,column:t.startCol,offset:t.startOffset}),n=Tj({line:t.endLine,column:t.endCol,offset:t.endOffset});return e||n?{start:e,end:n}:void 0}function Tj(t){return t.line&&t.column?t:void 0}const lze={},uze={}.hasOwnProperty,Qie=bre("type",{handlers:{root:dze,element:gze,text:pze,comment:mze,doctype:fze}});function cze(t,e){const r=(e||lze).space;return Qie(t,r==="svg"?bd:Nv)}function dze(t,e){const n={nodeName:"#document",mode:(t.data||{}).quirksMode?"quirks":"no-quirks",childNodes:[]};return n.childNodes=s7(t.children,n,e),X0(t,n),n}function hze(t,e){const n={nodeName:"#document-fragment",childNodes:[]};return n.childNodes=s7(t.children,n,e),X0(t,n),n}function fze(t){const e={nodeName:"#documentType",name:"html",publicId:"",systemId:"",parentNode:null};return X0(t,e),e}function pze(t){const e={nodeName:"#text",value:t.value,parentNode:null};return X0(t,e),e}function mze(t){const e={nodeName:"#comment",data:t.value,parentNode:null};return X0(t,e),e}function gze(t,e){const n=e;let r=n;t.type==="element"&&t.tagName.toLowerCase()==="svg"&&n.space==="html"&&(r=bd);const i=[];let a;if(t.properties){for(a in t.properties)if(a!=="children"&&uze.call(t.properties,a)){const l=vze(r,a,t.properties[a]);l&&i.push(l)}}const s=r.space,o={nodeName:t.tagName,tagName:t.tagName,attrs:i,namespaceURI:Ol[s],childNodes:[],parentNode:null};return o.childNodes=s7(t.children,o,r),X0(t,o),t.tagName==="template"&&t.content&&(o.content=hze(t.content,r)),o}function vze(t,e,n){const r=d3(t,e);if(n===!1||n===null||n===void 0||typeof n=="number"&&Number.isNaN(n)||!n&&r.boolean)return;Array.isArray(n)&&(n=r.commaSeparated?Rne(n):zne(n));const i={name:r.attribute,value:n===!0?"":String(n)};if(r.space&&r.space!=="html"&&r.space!=="svg"){const a=i.name.indexOf(":");a<0?i.prefix="":(i.name=i.name.slice(a+1),i.prefix=r.attribute.slice(0,a)),i.namespace=Ol[r.space]}return i}function s7(t,e,n){let r=-1;const i=[];if(t)for(;++r<t.length;){const a=Qie(t[r],n);a.parentNode=e,i.push(a)}return i}function X0(t,e){const n=t.position;n&&n.start&&n.end&&(n.start.offset,n.end.offset,e.sourceCodeLocation={startLine:n.start.line,startCol:n.start.column,startOffset:n.start.offset,endLine:n.end.line,endCol:n.end.column,endOffset:n.end.offset})}const yze=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],xze=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Xr="�";var Se;(function(t){t[t.EOF=-1]="EOF",t[t.NULL=0]="NULL",t[t.TABULATION=9]="TABULATION",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.LINE_FEED=10]="LINE_FEED",t[t.FORM_FEED=12]="FORM_FEED",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_9=57]="DIGIT_9",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",t[t.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_A=97]="LATIN_SMALL_A",t[t.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(Se||(Se={}));const hs={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function eae(t){return t>=55296&&t<=57343}function bze(t){return t>=56320&&t<=57343}function _ze(t,e){return(t-55296)*1024+9216+e}function tae(t){return t!==32&&t!==10&&t!==13&&t!==9&&t!==12&&t>=1&&t<=31||t>=127&&t<=159}function nae(t){return t>=64976&&t<=65007||xze.has(t)}var ct;(function(t){t.controlCharacterInInputStream="control-character-in-input-stream",t.noncharacterInInputStream="noncharacter-in-input-stream",t.surrogateInInputStream="surrogate-in-input-stream",t.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",t.endTagWithAttributes="end-tag-with-attributes",t.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",t.unexpectedSolidusInTag="unexpected-solidus-in-tag",t.unexpectedNullCharacter="unexpected-null-character",t.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",t.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",t.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",t.missingEndTagName="missing-end-tag-name",t.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",t.unknownNamedCharacterReference="unknown-named-character-reference",t.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",t.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",t.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",t.eofBeforeTagName="eof-before-tag-name",t.eofInTag="eof-in-tag",t.missingAttributeValue="missing-attribute-value",t.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",t.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",t.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",t.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",t.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",t.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",t.missingDoctypePublicIdentifier="missing-doctype-public-identifier",t.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",t.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",t.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",t.cdataInHtmlContent="cdata-in-html-content",t.incorrectlyOpenedComment="incorrectly-opened-comment",t.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",t.eofInDoctype="eof-in-doctype",t.nestedComment="nested-comment",t.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",t.eofInComment="eof-in-comment",t.incorrectlyClosedComment="incorrectly-closed-comment",t.eofInCdata="eof-in-cdata",t.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",t.nullCharacterReference="null-character-reference",t.surrogateCharacterReference="surrogate-character-reference",t.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",t.controlCharacterReference="control-character-reference",t.noncharacterCharacterReference="noncharacter-character-reference",t.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",t.missingDoctypeName="missing-doctype-name",t.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",t.duplicateAttribute="duplicate-attribute",t.nonConformingDoctype="non-conforming-doctype",t.missingDoctype="missing-doctype",t.misplacedDoctype="misplaced-doctype",t.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",t.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",t.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",t.openElementsLeftAfterEof="open-elements-left-after-eof",t.abandonedHeadElementChild="abandoned-head-element-child",t.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",t.nestedNoscriptInHead="nested-noscript-in-head",t.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(ct||(ct={}));const wze=65536;class Sze{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=wze,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,n){const{line:r,col:i,offset:a}=this,s=i+n,o=a+n;return{code:e,startLine:r,endLine:r,startCol:s,endCol:s,startOffset:o,endOffset:o}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(bze(n))return this.pos++,this._addGap(),_ze(e,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,Se.EOF;return this._err(ct.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,n){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,n){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(e,this.pos);for(let r=0;r<e.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==e.charCodeAt(r))return!1;return!0}peek(e){const n=this.pos+e;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Se.EOF;const r=this.html.charCodeAt(n);return r===Se.CARRIAGE_RETURN?Se.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Se.EOF;let e=this.html.charCodeAt(this.pos);return e===Se.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,Se.LINE_FEED):e===Se.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,eae(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===Se.LINE_FEED||e===Se.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){tae(e)?this._err(ct.controlCharacterInInputStream):nae(e)&&this._err(ct.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Bn;(function(t){t[t.CHARACTER=0]="CHARACTER",t[t.NULL_CHARACTER=1]="NULL_CHARACTER",t[t.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",t[t.START_TAG=3]="START_TAG",t[t.END_TAG=4]="END_TAG",t[t.COMMENT=5]="COMMENT",t[t.DOCTYPE=6]="DOCTYPE",t[t.EOF=7]="EOF",t[t.HIBERNATION=8]="HIBERNATION"})(Bn||(Bn={}));function rae(t,e){for(let n=t.attrs.length-1;n>=0;n--)if(t.attrs[n].name===e)return t.attrs[n].value;return null}const Eze=new Uint16Array('ᵁ<Õıʊҝջאٵ۞ޢߖࠏ੊ઑඡ๭༉༦჊ረዡᐕᒝᓃᓟᔥ\0\0\0\0\0\0ᕫᛍᦍᰒᷝ὾⁠↰⊍⏀⏻⑂⠤⤒ⴈ⹈⿎〖㊺㘹㞬㣾㨨㩱㫠㬮ࠀEMabcfglmnoprstu\\bfms¦³¹ÈÏlig耻Æ䃆P耻&䀦cute耻Á䃁reve;䄂Āiyx}rc耻Â䃂;䐐r;쀀𝔄rave耻À䃀pha;䎑acr;䄀d;橓Āgp¡on;䄄f;쀀𝔸plyFunction;恡ing耻Å䃅Ācs¾Ãr;쀀𝒜ign;扔ilde耻Ã䃃ml耻Ä䃄ЀaceforsuåûþėĜĢħĪĀcrêòkslash;或Ŷöø;櫧ed;挆y;䐑ƀcrtąċĔause;戵noullis;愬a;䎒r;쀀𝔅pf;쀀𝔹eve;䋘còēmpeq;扎܀HOacdefhilorsuōőŖƀƞƢƵƷƺǜȕɳɸɾcy;䐧PY耻©䂩ƀcpyŝŢźute;䄆Ā;iŧŨ拒talDifferentialD;慅leys;愭ȀaeioƉƎƔƘron;䄌dil耻Ç䃇rc;䄈nint;戰ot;䄊ĀdnƧƭilla;䂸terDot;䂷òſi;䎧rcleȀDMPTǇǋǑǖot;抙inus;抖lus;投imes;抗oĀcsǢǸkwiseContourIntegral;戲eCurlyĀDQȃȏoubleQuote;思uote;怙ȀlnpuȞȨɇɕonĀ;eȥȦ户;橴ƀgitȯȶȺruent;扡nt;戯ourIntegral;戮ĀfrɌɎ;愂oduct;成nterClockwiseContourIntegral;戳oss;樯cr;쀀𝒞pĀ;Cʄʅ拓ap;才րDJSZacefiosʠʬʰʴʸˋ˗ˡ˦̳ҍĀ;oŹʥtrahd;椑cy;䐂cy;䐅cy;䐏ƀgrsʿ˄ˇger;怡r;憡hv;櫤Āayː˕ron;䄎;䐔lĀ;t˝˞戇a;䎔r;쀀𝔇Āaf˫̧Ācm˰̢riticalȀADGT̖̜̀̆cute;䂴oŴ̋̍;䋙bleAcute;䋝rave;䁠ilde;䋜ond;拄ferentialD;慆Ѱ̽\0\0\0͔͂\0Ѕf;쀀𝔻ƀ;DE͈͉͍䂨ot;惜qual;扐blèCDLRUVͣͲ΂ϏϢϸontourIntegraìȹoɴ͹\0\0ͻ»͉nArrow;懓Āeo·ΤftƀARTΐΖΡrrow;懐ightArrow;懔eåˊngĀLRΫτeftĀARγιrrow;柸ightArrow;柺ightArrow;柹ightĀATϘϞrrow;懒ee;抨pɁϩ\0\0ϯrrow;懑ownArrow;懕erticalBar;戥ǹABLRTaВЪаўѿͼrrowƀ;BUНОТ憓ar;椓pArrow;懵reve;䌑eft˒к\0ц\0ѐightVector;楐eeVector;楞ectorĀ;Bљњ憽ar;楖ightǔѧ\0ѱeeVector;楟ectorĀ;BѺѻ懁ar;楗eeĀ;A҆҇护rrow;憧ĀctҒҗr;쀀𝒟rok;䄐ࠀNTacdfglmopqstuxҽӀӄӋӞӢӧӮӵԡԯԶՒ՝ՠեG;䅊H耻Ð䃐cute耻É䃉ƀaiyӒӗӜron;䄚rc耻Ê䃊;䐭ot;䄖r;쀀𝔈rave耻È䃈ement;戈ĀapӺӾcr;䄒tyɓԆ\0\0ԒmallSquare;旻erySmallSquare;斫ĀgpԦԪon;䄘f;쀀𝔼silon;䎕uĀaiԼՉlĀ;TՂՃ橵ilde;扂librium;懌Āci՗՚r;愰m;橳a;䎗ml耻Ë䃋Āipժկsts;戃onentialE;慇ʀcfiosօֈ֍ֲ׌y;䐤r;쀀𝔉lledɓ֗\0\0֣mallSquare;旼erySmallSquare;斪Ͱֺ\0ֿ\0\0ׄf;쀀𝔽All;戀riertrf;愱cò׋؀JTabcdfgorstר׬ׯ׺؀ؒؖ؛؝أ٬ٲcy;䐃耻>䀾mmaĀ;d׷׸䎓;䏜reve;䄞ƀeiy؇،ؐdil;䄢rc;䄜;䐓ot;䄠r;쀀𝔊;拙pf;쀀𝔾eater̀EFGLSTصلَٖٛ٦qualĀ;Lؾؿ扥ess;招ullEqual;执reater;檢ess;扷lantEqual;橾ilde;扳cr;쀀𝒢;扫ЀAacfiosuڅڋږڛڞڪھۊRDcy;䐪Āctڐڔek;䋇;䁞irc;䄤r;愌lbertSpace;愋ǰگ\0ڲf;愍izontalLine;攀Āctۃۅòکrok;䄦mpńېۘownHumðįqual;扏܀EJOacdfgmnostuۺ۾܃܇܎ܚܞܡܨ݄ݸދޏޕcy;䐕lig;䄲cy;䐁cute耻Í䃍Āiyܓܘrc耻Î䃎;䐘ot;䄰r;愑rave耻Ì䃌ƀ;apܠܯܿĀcgܴܷr;䄪inaryI;慈lieóϝǴ݉\0ݢĀ;eݍݎ戬Āgrݓݘral;戫section;拂isibleĀCTݬݲomma;恣imes;恢ƀgptݿރވon;䄮f;쀀𝕀a;䎙cr;愐ilde;䄨ǫޚ\0ޞcy;䐆l耻Ï䃏ʀcfosuެ޷޼߂ߐĀiyޱ޵rc;䄴;䐙r;쀀𝔍pf;쀀𝕁ǣ߇\0ߌr;쀀𝒥rcy;䐈kcy;䐄΀HJacfosߤߨ߽߬߱ࠂࠈcy;䐥cy;䐌ppa;䎚Āey߶߻dil;䄶;䐚r;쀀𝔎pf;쀀𝕂cr;쀀𝒦րJTaceflmostࠥࠩࠬࡐࡣ঳সে্਷ੇcy;䐉耻<䀼ʀcmnpr࠷࠼ࡁࡄࡍute;䄹bda;䎛g;柪lacetrf;愒r;憞ƀaeyࡗ࡜ࡡron;䄽dil;䄻;䐛Āfsࡨ॰tԀACDFRTUVarࡾࢩࢱࣦ࣠ࣼयज़ΐ४Ānrࢃ࢏gleBracket;柨rowƀ;BR࢙࢚࢞憐ar;懤ightArrow;懆eiling;挈oǵࢷ\0ࣃbleBracket;柦nǔࣈ\0࣒eeVector;楡ectorĀ;Bࣛࣜ懃ar;楙loor;挊ightĀAV࣯ࣵrrow;憔ector;楎Āerँगeƀ;AVउऊऐ抣rrow;憤ector;楚iangleƀ;BEतथऩ抲ar;槏qual;抴pƀDTVषूौownVector;楑eeVector;楠ectorĀ;Bॖॗ憿ar;楘ectorĀ;B॥०憼ar;楒ightáΜs̀EFGLSTॾঋকঝঢভqualGreater;拚ullEqual;扦reater;扶ess;檡lantEqual;橽ilde;扲r;쀀𝔏Ā;eঽা拘ftarrow;懚idot;䄿ƀnpw৔ਖਛgȀLRlr৞৷ਂਐeftĀAR০৬rrow;柵ightArrow;柷ightArrow;柶eftĀarγਊightáοightáϊf;쀀𝕃erĀLRਢਬeftArrow;憙ightArrow;憘ƀchtਾੀੂòࡌ;憰rok;䅁;扪Ѐacefiosuਗ਼੝੠੷੼અઋ઎p;椅y;䐜Ādl੥੯iumSpace;恟lintrf;愳r;쀀𝔐nusPlus;戓pf;쀀𝕄cò੶;䎜ҀJacefostuણધભીଔଙඑ඗ඞcy;䐊cute;䅃ƀaey઴હાron;䅇dil;䅅;䐝ƀgswે૰଎ativeƀMTV૓૟૨ediumSpace;怋hiĀcn૦૘ë૙eryThiî૙tedĀGL૸ଆreaterGreateòٳessLesóੈLine;䀊r;쀀𝔑ȀBnptଢନଷ଺reak;恠BreakingSpace;䂠f;愕ڀ;CDEGHLNPRSTV୕ୖ୪୼஡௫ఄ౞಄ದ೘ൡඅ櫬Āou୛୤ngruent;扢pCap;扭oubleVerticalBar;戦ƀlqxஃஊ஛ement;戉ualĀ;Tஒஓ扠ilde;쀀≂̸ists;戄reater΀;EFGLSTஶஷ஽௉௓௘௥扯qual;扱ullEqual;쀀≧̸reater;쀀≫̸ess;批lantEqual;쀀⩾̸ilde;扵umpń௲௽ownHump;쀀≎̸qual;쀀≏̸eĀfsఊధtTriangleƀ;BEచఛడ拪ar;쀀⧏̸qual;括s̀;EGLSTవశ఼ౄోౘ扮qual;扰reater;扸ess;쀀≪̸lantEqual;쀀⩽̸ilde;扴estedĀGL౨౹reaterGreater;쀀⪢̸essLess;쀀⪡̸recedesƀ;ESಒಓಛ技qual;쀀⪯̸lantEqual;拠ĀeiಫಹverseElement;戌ghtTriangleƀ;BEೋೌ೒拫ar;쀀⧐̸qual;拭ĀquೝഌuareSuĀbp೨೹setĀ;E೰ೳ쀀⊏̸qual;拢ersetĀ;Eഃആ쀀⊐̸qual;拣ƀbcpഓതൎsetĀ;Eഛഞ쀀⊂⃒qual;抈ceedsȀ;ESTലള഻െ抁qual;쀀⪰̸lantEqual;拡ilde;쀀≿̸ersetĀ;E൘൛쀀⊃⃒qual;抉ildeȀ;EFT൮൯൵ൿ扁qual;扄ullEqual;扇ilde;扉erticalBar;戤cr;쀀𝒩ilde耻Ñ䃑;䎝܀Eacdfgmoprstuvලෂ෉෕ෛ෠෧෼ขภยา฿ไlig;䅒cute耻Ó䃓Āiy෎ීrc耻Ô䃔;䐞blac;䅐r;쀀𝔒rave耻Ò䃒ƀaei෮ෲ෶cr;䅌ga;䎩cron;䎟pf;쀀𝕆enCurlyĀDQฎบoubleQuote;怜uote;怘;橔Āclวฬr;쀀𝒪ash耻Ø䃘iŬื฼de耻Õ䃕es;樷ml耻Ö䃖erĀBP๋๠Āar๐๓r;怾acĀek๚๜;揞et;掴arenthesis;揜Ҁacfhilors๿ງຊຏຒດຝະ໼rtialD;戂y;䐟r;쀀𝔓i;䎦;䎠usMinus;䂱Āipຢອncareplanåڝf;愙Ȁ;eio຺ູ໠໤檻cedesȀ;EST່້໏໚扺qual;檯lantEqual;扼ilde;找me;怳Ādp໩໮uct;戏ortionĀ;aȥ໹l;戝Āci༁༆r;쀀𝒫;䎨ȀUfos༑༖༛༟OT耻"䀢r;쀀𝔔pf;愚cr;쀀𝒬؀BEacefhiorsu༾གྷཇའཱིྦྷྪྭ႖ႩႴႾarr;椐G耻®䂮ƀcnrཎནབute;䅔g;柫rĀ;tཛྷཝ憠l;椖ƀaeyཧཬཱron;䅘dil;䅖;䐠Ā;vླྀཹ愜erseĀEUྂྙĀlq྇ྎement;戋uilibrium;懋pEquilibrium;楯r»ཹo;䎡ghtЀACDFTUVa࿁࿫࿳ဢဨၛႇϘĀnr࿆࿒gleBracket;柩rowƀ;BL࿜࿝࿡憒ar;懥eftArrow;懄eiling;按oǵ࿹\0စbleBracket;柧nǔည\0နeeVector;楝ectorĀ;Bဝသ懂ar;楕loor;挋Āerိ၃eƀ;AVဵံြ抢rrow;憦ector;楛iangleƀ;BEၐၑၕ抳ar;槐qual;抵pƀDTVၣၮၸownVector;楏eeVector;楜ectorĀ;Bႂႃ憾ar;楔ectorĀ;B႑႒懀ar;楓Āpuႛ႞f;愝ndImplies;楰ightarrow;懛ĀchႹႼr;愛;憱leDelayed;槴ڀHOacfhimoqstuფჱჷჽᄙᄞᅑᅖᅡᅧᆵᆻᆿĀCcჩხHcy;䐩y;䐨FTcy;䐬cute;䅚ʀ;aeiyᄈᄉᄎᄓᄗ檼ron;䅠dil;䅞rc;䅜;䐡r;쀀𝔖ortȀDLRUᄪᄴᄾᅉownArrow»ОeftArrow»࢚ightArrow»࿝pArrow;憑gma;䎣allCircle;战pf;쀀𝕊ɲᅭ\0\0ᅰt;戚areȀ;ISUᅻᅼᆉᆯ斡ntersection;抓uĀbpᆏᆞsetĀ;Eᆗᆘ抏qual;抑ersetĀ;Eᆨᆩ抐qual;抒nion;抔cr;쀀𝒮ar;拆ȀbcmpᇈᇛሉላĀ;sᇍᇎ拐etĀ;Eᇍᇕqual;抆ĀchᇠህeedsȀ;ESTᇭᇮᇴᇿ扻qual;檰lantEqual;扽ilde;承Tháྌ;我ƀ;esሒሓሣ拑rsetĀ;Eሜም抃qual;抇et»ሓրHRSacfhiorsሾቄ቉ቕ቞ቱቶኟዂወዑORN耻Þ䃞ADE;愢ĀHc቎ቒcy;䐋y;䐦Ābuቚቜ;䀉;䎤ƀaeyብቪቯron;䅤dil;䅢;䐢r;쀀𝔗Āeiቻ኉ǲኀ\0ኇefore;戴a;䎘Ācn኎ኘkSpace;쀀  Space;怉ldeȀ;EFTካኬኲኼ戼qual;扃ullEqual;扅ilde;扈pf;쀀𝕋ipleDot;惛Āctዖዛr;쀀𝒯rok;䅦ૡዷጎጚጦ\0ጬጱ\0\0\0\0\0ጸጽ፷ᎅ\0᏿ᐄᐊᐐĀcrዻጁute耻Ú䃚rĀ;oጇገ憟cir;楉rǣጓ\0጖y;䐎ve;䅬Āiyጞጣrc耻Û䃛;䐣blac;䅰r;쀀𝔘rave耻Ù䃙acr;䅪Ādiፁ፩erĀBPፈ፝Āarፍፐr;䁟acĀekፗፙ;揟et;掵arenthesis;揝onĀ;P፰፱拃lus;抎Āgp፻፿on;䅲f;쀀𝕌ЀADETadps᎕ᎮᎸᏄϨᏒᏗᏳrrowƀ;BDᅐᎠᎤar;椒ownArrow;懅ownArrow;憕quilibrium;楮eeĀ;AᏋᏌ报rrow;憥ownáϳerĀLRᏞᏨeftArrow;憖ightArrow;憗iĀ;lᏹᏺ䏒on;䎥ing;䅮cr;쀀𝒰ilde;䅨ml耻Ü䃜ҀDbcdefosvᐧᐬᐰᐳᐾᒅᒊᒐᒖash;披ar;櫫y;䐒ashĀ;lᐻᐼ抩;櫦Āerᑃᑅ;拁ƀbtyᑌᑐᑺar;怖Ā;iᑏᑕcalȀBLSTᑡᑥᑪᑴar;戣ine;䁼eparator;杘ilde;所ThinSpace;怊r;쀀𝔙pf;쀀𝕍cr;쀀𝒱dash;抪ʀcefosᒧᒬᒱᒶᒼirc;䅴dge;拀r;쀀𝔚pf;쀀𝕎cr;쀀𝒲Ȁfiosᓋᓐᓒᓘr;쀀𝔛;䎞pf;쀀𝕏cr;쀀𝒳ҀAIUacfosuᓱᓵᓹᓽᔄᔏᔔᔚᔠcy;䐯cy;䐇cy;䐮cute耻Ý䃝Āiyᔉᔍrc;䅶;䐫r;쀀𝔜pf;쀀𝕐cr;쀀𝒴ml;䅸ЀHacdefosᔵᔹᔿᕋᕏᕝᕠᕤcy;䐖cute;䅹Āayᕄᕉron;䅽;䐗ot;䅻ǲᕔ\0ᕛoWidtè૙a;䎖r;愨pf;愤cr;쀀𝒵௡ᖃᖊᖐ\0ᖰᖶᖿ\0\0\0\0ᗆᗛᗫᙟ᙭\0ᚕ᚛ᚲᚹ\0ᚾcute耻á䃡reve;䄃̀;Ediuyᖜᖝᖡᖣᖨᖭ戾;쀀∾̳;房rc耻â䃢te肻´̆;䐰lig耻æ䃦Ā;r²ᖺ;쀀𝔞rave耻à䃠ĀepᗊᗖĀfpᗏᗔsym;愵èᗓha;䎱ĀapᗟcĀclᗤᗧr;䄁g;樿ɤᗰ\0\0ᘊʀ;adsvᗺᗻᗿᘁᘇ戧nd;橕;橜lope;橘;橚΀;elmrszᘘᘙᘛᘞᘿᙏᙙ戠;榤e»ᘙsdĀ;aᘥᘦ戡ѡᘰᘲᘴᘶᘸᘺᘼᘾ;榨;榩;榪;榫;榬;榭;榮;榯tĀ;vᙅᙆ戟bĀ;dᙌᙍ抾;榝Āptᙔᙗh;戢»¹arr;捼Āgpᙣᙧon;䄅f;쀀𝕒΀;Eaeiop዁ᙻᙽᚂᚄᚇᚊ;橰cir;橯;扊d;手s;䀧roxĀ;e዁ᚒñᚃing耻å䃥ƀctyᚡᚦᚨr;쀀𝒶;䀪mpĀ;e዁ᚯñʈilde耻ã䃣ml耻ä䃤Āciᛂᛈoninôɲnt;樑ࠀNabcdefiklnoprsu᛭ᛱᜰ᜼ᝃᝈ᝸᝽០៦ᠹᡐᜍ᤽᥈ᥰot;櫭Ācrᛶ᜞kȀcepsᜀᜅᜍᜓong;扌psilon;䏶rime;怵imĀ;e᜚᜛戽q;拍Ŷᜢᜦee;抽edĀ;gᜬᜭ挅e»ᜭrkĀ;t፜᜷brk;掶Āoyᜁᝁ;䐱quo;怞ʀcmprtᝓ᝛ᝡᝤᝨausĀ;eĊĉptyv;榰séᜌnoõēƀahwᝯ᝱ᝳ;䎲;愶een;扬r;쀀𝔟g΀costuvwឍឝឳេ៕៛៞ƀaiuបពរðݠrc;旯p»፱ƀdptឤឨឭot;樀lus;樁imes;樂ɱឹ\0\0ើcup;樆ar;昅riangleĀdu៍្own;施p;斳plus;樄eåᑄåᒭarow;植ƀako៭ᠦᠵĀcn៲ᠣkƀlst៺֫᠂ozenge;槫riangleȀ;dlr᠒᠓᠘᠝斴own;斾eft;旂ight;斸k;搣Ʊᠫ\0ᠳƲᠯ\0ᠱ;斒;斑4;斓ck;斈ĀeoᠾᡍĀ;qᡃᡆ쀀=⃥uiv;쀀≡⃥t;挐Ȁptwxᡙᡞᡧᡬf;쀀𝕓Ā;tᏋᡣom»Ꮜtie;拈؀DHUVbdhmptuvᢅᢖᢪᢻᣗᣛᣬ᣿ᤅᤊᤐᤡȀLRlrᢎᢐᢒᢔ;敗;敔;敖;敓ʀ;DUduᢡᢢᢤᢦᢨ敐;敦;敩;敤;敧ȀLRlrᢳᢵᢷᢹ;敝;敚;敜;教΀;HLRhlrᣊᣋᣍᣏᣑᣓᣕ救;敬;散;敠;敫;敢;敟ox;槉ȀLRlrᣤᣦᣨᣪ;敕;敒;攐;攌ʀ;DUduڽ᣷᣹᣻᣽;敥;敨;攬;攴inus;抟lus;択imes;抠ȀLRlrᤙᤛᤝ᤟;敛;敘;攘;攔΀;HLRhlrᤰᤱᤳᤵᤷ᤻᤹攂;敪;敡;敞;攼;攤;攜Āevģ᥂bar耻¦䂦Ȁceioᥑᥖᥚᥠr;쀀𝒷mi;恏mĀ;e᜚᜜lƀ;bhᥨᥩᥫ䁜;槅sub;柈Ŭᥴ᥾lĀ;e᥹᥺怢t»᥺pƀ;Eeįᦅᦇ;檮Ā;qۜۛೡᦧ\0᧨ᨑᨕᨲ\0ᨷᩐ\0\0᪴\0\0᫁\0\0ᬡᬮ᭍᭒\0᯽\0ᰌƀcpr᦭ᦲ᧝ute;䄇̀;abcdsᦿᧀᧄ᧊᧕᧙戩nd;橄rcup;橉Āau᧏᧒p;橋p;橇ot;橀;쀀∩︀Āeo᧢᧥t;恁îړȀaeiu᧰᧻ᨁᨅǰ᧵\0᧸s;橍on;䄍dil耻ç䃧rc;䄉psĀ;sᨌᨍ橌m;橐ot;䄋ƀdmnᨛᨠᨦil肻¸ƭptyv;榲t脀¢;eᨭᨮ䂢räƲr;쀀𝔠ƀceiᨽᩀᩍy;䑇ckĀ;mᩇᩈ朓ark»ᩈ;䏇r΀;Ecefms᩟᩠ᩢᩫ᪤᪪᪮旋;槃ƀ;elᩩᩪᩭ䋆q;扗eɡᩴ\0\0᪈rrowĀlr᩼᪁eft;憺ight;憻ʀRSacd᪒᪔᪖᪚᪟»ཇ;擈st;抛irc;抚ash;抝nint;樐id;櫯cir;槂ubsĀ;u᪻᪼晣it»᪼ˬ᫇᫔᫺\0ᬊonĀ;eᫍᫎ䀺Ā;qÇÆɭ᫙\0\0᫢aĀ;t᫞᫟䀬;䁀ƀ;fl᫨᫩᫫戁îᅠeĀmx᫱᫶ent»᫩eóɍǧ᫾\0ᬇĀ;dኻᬂot;橭nôɆƀfryᬐᬔᬗ;쀀𝕔oäɔ脀©;sŕᬝr;愗Āaoᬥᬩrr;憵ss;朗Ācuᬲᬷr;쀀𝒸Ābpᬼ᭄Ā;eᭁᭂ櫏;櫑Ā;eᭉᭊ櫐;櫒dot;拯΀delprvw᭠᭬᭷ᮂᮬᯔ᯹arrĀlr᭨᭪;椸;椵ɰ᭲\0\0᭵r;拞c;拟arrĀ;p᭿ᮀ憶;椽̀;bcdosᮏᮐᮖᮡᮥᮨ截rcap;橈Āauᮛᮞp;橆p;橊ot;抍r;橅;쀀∪︀Ȁalrv᮵ᮿᯞᯣrrĀ;mᮼᮽ憷;椼yƀevwᯇᯔᯘqɰᯎ\0\0ᯒreã᭳uã᭵ee;拎edge;拏en耻¤䂤earrowĀlrᯮ᯳eft»ᮀight»ᮽeäᯝĀciᰁᰇoninôǷnt;戱lcty;挭ঀAHabcdefhijlorstuwz᰸᰻᰿ᱝᱩᱵᲊᲞᲬᲷ᳻᳿ᴍᵻᶑᶫᶻ᷆᷍rò΁ar;楥Ȁglrs᱈ᱍ᱒᱔ger;怠eth;愸òᄳhĀ;vᱚᱛ怐»ऊūᱡᱧarow;椏aã̕Āayᱮᱳron;䄏;䐴ƀ;ao̲ᱼᲄĀgrʿᲁr;懊tseq;橷ƀglmᲑᲔᲘ耻°䂰ta;䎴ptyv;榱ĀirᲣᲨsht;楿;쀀𝔡arĀlrᲳᲵ»ࣜ»သʀaegsv᳂͸᳖᳜᳠mƀ;oș᳊᳔ndĀ;ș᳑uit;晦amma;䏝in;拲ƀ;io᳧᳨᳸䃷de脀÷;o᳧ᳰntimes;拇nø᳷cy;䑒cɯᴆ\0\0ᴊrn;挞op;挍ʀlptuwᴘᴝᴢᵉᵕlar;䀤f;쀀𝕕ʀ;emps̋ᴭᴷᴽᵂqĀ;d͒ᴳot;扑inus;戸lus;戔quare;抡blebarwedgåúnƀadhᄮᵝᵧownarrowóᲃarpoonĀlrᵲᵶefôᲴighôᲶŢᵿᶅkaro÷གɯᶊ\0\0ᶎrn;挟op;挌ƀcotᶘᶣᶦĀryᶝᶡ;쀀𝒹;䑕l;槶rok;䄑Ādrᶰᶴot;拱iĀ;fᶺ᠖斿Āah᷀᷃ròЩaòྦangle;榦Āci᷒ᷕy;䑟grarr;柿ऀDacdefglmnopqrstuxḁḉḙḸոḼṉṡṾấắẽỡἪἷὄ὎὚ĀDoḆᴴoôᲉĀcsḎḔute耻é䃩ter;橮ȀaioyḢḧḱḶron;䄛rĀ;cḭḮ扖耻ê䃪lon;払;䑍ot;䄗ĀDrṁṅot;扒;쀀𝔢ƀ;rsṐṑṗ檚ave耻è䃨Ā;dṜṝ檖ot;檘Ȁ;ilsṪṫṲṴ檙nters;揧;愓Ā;dṹṺ檕ot;檗ƀapsẅẉẗcr;䄓tyƀ;svẒẓẕ戅et»ẓpĀ1;ẝẤĳạả;怄;怅怃ĀgsẪẬ;䅋p;怂ĀgpẴẸon;䄙f;쀀𝕖ƀalsỄỎỒrĀ;sỊị拕l;槣us;橱iƀ;lvỚớở䎵on»ớ;䏵ȀcsuvỪỳἋἣĀioữḱrc»Ḯɩỹ\0\0ỻíՈantĀglἂἆtr»ṝess»Ṻƀaeiἒ἖Ἒls;䀽st;扟vĀ;DȵἠD;橸parsl;槥ĀDaἯἳot;打rr;楱ƀcdiἾὁỸr;愯oô͒ĀahὉὋ;䎷耻ð䃰Āmrὓὗl耻ë䃫o;悬ƀcipὡὤὧl;䀡sôծĀeoὬὴctatioîՙnentialåչৡᾒ\0ᾞ\0ᾡᾧ\0\0ῆῌ\0ΐ\0ῦῪ \0 ⁚llingdotseñṄy;䑄male;晀ƀilrᾭᾳ῁lig;耀ﬃɩᾹ\0\0᾽g;耀ﬀig;耀ﬄ;쀀𝔣lig;耀ﬁlig;쀀fjƀaltῙ῜ῡt;晭ig;耀ﬂns;斱of;䆒ǰ΅\0ῳf;쀀𝕗ĀakֿῷĀ;vῼ´拔;櫙artint;樍Āao‌⁕Ācs‑⁒α‚‰‸⁅⁈\0⁐β•‥‧‪‬\0‮耻½䂽;慓耻¼䂼;慕;慙;慛Ƴ‴\0‶;慔;慖ʴ‾⁁\0\0⁃耻¾䂾;慗;慜5;慘ƶ⁌\0⁎;慚;慝8;慞l;恄wn;挢cr;쀀𝒻ࢀEabcdefgijlnorstv₂₉₟₥₰₴⃰⃵⃺⃿℃ℒℸ̗ℾ⅒↞Ā;lٍ₇;檌ƀcmpₐₕ₝ute;䇵maĀ;dₜ᳚䎳;檆reve;䄟Āiy₪₮rc;䄝;䐳ot;䄡Ȁ;lqsؾق₽⃉ƀ;qsؾٌ⃄lanô٥Ȁ;cdl٥⃒⃥⃕c;檩otĀ;o⃜⃝檀Ā;l⃢⃣檂;檄Ā;e⃪⃭쀀⋛︀s;檔r;쀀𝔤Ā;gٳ؛mel;愷cy;䑓Ȁ;Eajٚℌℎℐ;檒;檥;檤ȀEaesℛℝ℩ℴ;扩pĀ;p℣ℤ檊rox»ℤĀ;q℮ℯ檈Ā;q℮ℛim;拧pf;쀀𝕘Āci⅃ⅆr;愊mƀ;el٫ⅎ⅐;檎;檐茀>;cdlqr׮ⅠⅪⅮⅳⅹĀciⅥⅧ;檧r;橺ot;拗Par;榕uest;橼ʀadelsↄⅪ←ٖ↛ǰ↉\0↎proø₞r;楸qĀlqؿ↖lesó₈ií٫Āen↣↭rtneqq;쀀≩︀Å↪ԀAabcefkosy⇄⇇⇱⇵⇺∘∝∯≨≽ròΠȀilmr⇐⇔⇗⇛rsðᒄf»․ilôکĀdr⇠⇤cy;䑊ƀ;cwࣴ⇫⇯ir;楈;憭ar;意irc;䄥ƀalr∁∎∓rtsĀ;u∉∊晥it»∊lip;怦con;抹r;쀀𝔥sĀew∣∩arow;椥arow;椦ʀamopr∺∾≃≞≣rr;懿tht;戻kĀlr≉≓eftarrow;憩ightarrow;憪f;쀀𝕙bar;怕ƀclt≯≴≸r;쀀𝒽asè⇴rok;䄧Ābp⊂⊇ull;恃hen»ᱛૡ⊣\0⊪\0⊸⋅⋎\0⋕⋳\0\0⋸⌢⍧⍢⍿\0⎆⎪⎴cute耻í䃭ƀ;iyݱ⊰⊵rc耻î䃮;䐸Ācx⊼⊿y;䐵cl耻¡䂡ĀfrΟ⋉;쀀𝔦rave耻ì䃬Ȁ;inoܾ⋝⋩⋮Āin⋢⋦nt;樌t;戭fin;槜ta;愩lig;䄳ƀaop⋾⌚⌝ƀcgt⌅⌈⌗r;䄫ƀelpܟ⌏⌓inåގarôܠh;䄱f;抷ed;䆵ʀ;cfotӴ⌬⌱⌽⍁are;愅inĀ;t⌸⌹戞ie;槝doô⌙ʀ;celpݗ⍌⍐⍛⍡al;抺Āgr⍕⍙eróᕣã⍍arhk;樗rod;樼Ȁcgpt⍯⍲⍶⍻y;䑑on;䄯f;쀀𝕚a;䎹uest耻¿䂿Āci⎊⎏r;쀀𝒾nʀ;EdsvӴ⎛⎝⎡ӳ;拹ot;拵Ā;v⎦⎧拴;拳Ā;iݷ⎮lde;䄩ǫ⎸\0⎼cy;䑖l耻ï䃯̀cfmosu⏌⏗⏜⏡⏧⏵Āiy⏑⏕rc;䄵;䐹r;쀀𝔧ath;䈷pf;쀀𝕛ǣ⏬\0⏱r;쀀𝒿rcy;䑘kcy;䑔Ѐacfghjos␋␖␢␧␭␱␵␻ppaĀ;v␓␔䎺;䏰Āey␛␠dil;䄷;䐺r;쀀𝔨reen;䄸cy;䑅cy;䑜pf;쀀𝕜cr;쀀𝓀஀ABEHabcdefghjlmnoprstuv⑰⒁⒆⒍⒑┎┽╚▀♎♞♥♹♽⚚⚲⛘❝❨➋⟀⠁⠒ƀart⑷⑺⑼rò৆òΕail;椛arr;椎Ā;gঔ⒋;檋ar;楢ॣ⒥\0⒪\0⒱\0\0\0\0\0⒵Ⓔ\0ⓆⓈⓍ\0⓹ute;䄺mptyv;榴raîࡌbda;䎻gƀ;dlࢎⓁⓃ;榑åࢎ;檅uo耻«䂫rЀ;bfhlpst࢙ⓞⓦⓩ⓫⓮⓱⓵Ā;f࢝ⓣs;椟s;椝ë≒p;憫l;椹im;楳l;憢ƀ;ae⓿─┄檫il;椙Ā;s┉┊檭;쀀⪭︀ƀabr┕┙┝rr;椌rk;杲Āak┢┬cĀek┨┪;䁻;䁛Āes┱┳;榋lĀdu┹┻;榏;榍Ȁaeuy╆╋╖╘ron;䄾Ādi═╔il;䄼ìࢰâ┩;䐻Ȁcqrs╣╦╭╽a;椶uoĀ;rนᝆĀdu╲╷har;楧shar;楋h;憲ʀ;fgqs▋▌উ◳◿扤tʀahlrt▘▤▷◂◨rrowĀ;t࢙□aé⓶arpoonĀdu▯▴own»њp»०eftarrows;懇ightƀahs◍◖◞rrowĀ;sࣴࢧarpoonó྘quigarro÷⇰hreetimes;拋ƀ;qs▋ও◺lanôবʀ;cdgsব☊☍☝☨c;檨otĀ;o☔☕橿Ā;r☚☛檁;檃Ā;e☢☥쀀⋚︀s;檓ʀadegs☳☹☽♉♋pproøⓆot;拖qĀgq♃♅ôউgtò⒌ôছiíলƀilr♕࣡♚sht;楼;쀀𝔩Ā;Eজ♣;檑š♩♶rĀdu▲♮Ā;l॥♳;楪lk;斄cy;䑙ʀ;achtੈ⚈⚋⚑⚖rò◁orneòᴈard;楫ri;旺Āio⚟⚤dot;䅀ustĀ;a⚬⚭掰che»⚭ȀEaes⚻⚽⛉⛔;扨pĀ;p⛃⛄檉rox»⛄Ā;q⛎⛏檇Ā;q⛎⚻im;拦Ѐabnoptwz⛩⛴⛷✚✯❁❇❐Ānr⛮⛱g;柬r;懽rëࣁgƀlmr⛿✍✔eftĀar০✇ightá৲apsto;柼ightá৽parrowĀlr✥✩efô⓭ight;憬ƀafl✶✹✽r;榅;쀀𝕝us;樭imes;樴š❋❏st;戗áፎƀ;ef❗❘᠀旊nge»❘arĀ;l❤❥䀨t;榓ʀachmt❳❶❼➅➇ròࢨorneòᶌarĀ;d྘➃;業;怎ri;抿̀achiqt➘➝ੀ➢➮➻quo;怹r;쀀𝓁mƀ;egল➪➬;檍;檏Ābu┪➳oĀ;rฟ➹;怚rok;䅂萀<;cdhilqrࠫ⟒☹⟜⟠⟥⟪⟰Āci⟗⟙;檦r;橹reå◲mes;拉arr;楶uest;橻ĀPi⟵⟹ar;榖ƀ;ef⠀भ᠛旃rĀdu⠇⠍shar;楊har;楦Āen⠗⠡rtneqq;쀀≨︀Å⠞܀Dacdefhilnopsu⡀⡅⢂⢎⢓⢠⢥⢨⣚⣢⣤ઃ⣳⤂Dot;戺Ȁclpr⡎⡒⡣⡽r耻¯䂯Āet⡗⡙;時Ā;e⡞⡟朠se»⡟Ā;sျ⡨toȀ;dluျ⡳⡷⡻owîҌefôएðᏑker;斮Āoy⢇⢌mma;権;䐼ash;怔asuredangle»ᘦr;쀀𝔪o;愧ƀcdn⢯⢴⣉ro耻µ䂵Ȁ;acdᑤ⢽⣀⣄sôᚧir;櫰ot肻·Ƶusƀ;bd⣒ᤃ⣓戒Ā;uᴼ⣘;横ţ⣞⣡p;櫛ò−ðઁĀdp⣩⣮els;抧f;쀀𝕞Āct⣸⣽r;쀀𝓂pos»ᖝƀ;lm⤉⤊⤍䎼timap;抸ఀGLRVabcdefghijlmoprstuvw⥂⥓⥾⦉⦘⧚⧩⨕⨚⩘⩝⪃⪕⪤⪨⬄⬇⭄⭿⮮ⰴⱧⱼ⳩Āgt⥇⥋;쀀⋙̸Ā;v⥐௏쀀≫⃒ƀelt⥚⥲⥶ftĀar⥡⥧rrow;懍ightarrow;懎;쀀⋘̸Ā;v⥻ే쀀≪⃒ightarrow;懏ĀDd⦎⦓ash;抯ash;抮ʀbcnpt⦣⦧⦬⦱⧌la»˞ute;䅄g;쀀∠⃒ʀ;Eiop඄⦼⧀⧅⧈;쀀⩰̸d;쀀≋̸s;䅉roø඄urĀ;a⧓⧔普lĀ;s⧓ସǳ⧟\0⧣p肻 ଷmpĀ;e௹ఀʀaeouy⧴⧾⨃⨐⨓ǰ⧹\0⧻;橃on;䅈dil;䅆ngĀ;dൾ⨊ot;쀀⩭̸p;橂;䐽ash;怓΀;Aadqsxஒ⨩⨭⨻⩁⩅⩐rr;懗rĀhr⨳⨶k;椤Ā;oᏲᏰot;쀀≐̸uiöୣĀei⩊⩎ar;椨í஘istĀ;s஠டr;쀀𝔫ȀEest௅⩦⩹⩼ƀ;qs஼⩭௡ƀ;qs஼௅⩴lanô௢ií௪Ā;rஶ⪁»ஷƀAap⪊⪍⪑rò⥱rr;憮ar;櫲ƀ;svྍ⪜ྌĀ;d⪡⪢拼;拺cy;䑚΀AEadest⪷⪺⪾⫂⫅⫶⫹rò⥦;쀀≦̸rr;憚r;急Ȁ;fqs఻⫎⫣⫯tĀar⫔⫙rro÷⫁ightarro÷⪐ƀ;qs఻⪺⫪lanôౕĀ;sౕ⫴»శiíౝĀ;rవ⫾iĀ;eచథiäඐĀpt⬌⬑f;쀀𝕟膀¬;in⬙⬚⬶䂬nȀ;Edvஉ⬤⬨⬮;쀀⋹̸ot;쀀⋵̸ǡஉ⬳⬵;拷;拶iĀ;vಸ⬼ǡಸ⭁⭃;拾;拽ƀaor⭋⭣⭩rȀ;ast୻⭕⭚⭟lleì୻l;쀀⫽⃥;쀀∂̸lint;樔ƀ;ceಒ⭰⭳uåಥĀ;cಘ⭸Ā;eಒ⭽ñಘȀAait⮈⮋⮝⮧rò⦈rrƀ;cw⮔⮕⮙憛;쀀⤳̸;쀀↝̸ghtarrow»⮕riĀ;eೋೖ΀chimpqu⮽⯍⯙⬄୸⯤⯯Ȁ;cerല⯆ഷ⯉uå൅;쀀𝓃ortɭ⬅\0\0⯖ará⭖mĀ;e൮⯟Ā;q൴൳suĀbp⯫⯭å೸åഋƀbcp⯶ⰑⰙȀ;Ees⯿ⰀഢⰄ抄;쀀⫅̸etĀ;eഛⰋqĀ;qണⰀcĀ;eലⰗñസȀ;EesⰢⰣൟⰧ抅;쀀⫆̸etĀ;e൘ⰮqĀ;qൠⰣȀgilrⰽⰿⱅⱇìௗlde耻ñ䃱çృiangleĀlrⱒⱜeftĀ;eచⱚñదightĀ;eೋⱥñ೗Ā;mⱬⱭ䎽ƀ;esⱴⱵⱹ䀣ro;愖p;怇ҀDHadgilrsⲏⲔⲙⲞⲣⲰⲶⳓⳣash;抭arr;椄p;쀀≍⃒ash;抬ĀetⲨⲬ;쀀≥⃒;쀀>⃒nfin;槞ƀAetⲽⳁⳅrr;椂;쀀≤⃒Ā;rⳊⳍ쀀<⃒ie;쀀⊴⃒ĀAtⳘⳜrr;椃rie;쀀⊵⃒im;쀀∼⃒ƀAan⳰⳴ⴂrr;懖rĀhr⳺⳽k;椣Ā;oᏧᏥear;椧ቓ᪕\0\0\0\0\0\0\0\0\0\0\0\0\0ⴭ\0ⴸⵈⵠⵥ⵲ⶄᬇ\0\0ⶍⶫ\0ⷈⷎ\0ⷜ⸙⸫⸾⹃Ācsⴱ᪗ute耻ó䃳ĀiyⴼⵅrĀ;c᪞ⵂ耻ô䃴;䐾ʀabios᪠ⵒⵗǈⵚlac;䅑v;樸old;榼lig;䅓Ācr⵩⵭ir;榿;쀀𝔬ͯ⵹\0\0⵼\0ⶂn;䋛ave耻ò䃲;槁Ābmⶈ෴ar;榵Ȁacitⶕ⶘ⶥⶨrò᪀Āir⶝ⶠr;榾oss;榻nå๒;槀ƀaeiⶱⶵⶹcr;䅍ga;䏉ƀcdnⷀⷅǍron;䎿;榶pf;쀀𝕠ƀaelⷔ⷗ǒr;榷rp;榹΀;adiosvⷪⷫⷮ⸈⸍⸐⸖戨rò᪆Ȁ;efmⷷⷸ⸂⸅橝rĀ;oⷾⷿ愴f»ⷿ耻ª䂪耻º䂺gof;抶r;橖lope;橗;橛ƀclo⸟⸡⸧ò⸁ash耻ø䃸l;折iŬⸯ⸴de耻õ䃵esĀ;aǛ⸺s;樶ml耻ö䃶bar;挽ૡ⹞\0⹽\0⺀⺝\0⺢⺹\0\0⻋ຜ\0⼓\0\0⼫⾼\0⿈rȀ;astЃ⹧⹲຅脀¶;l⹭⹮䂶leìЃɩ⹸\0\0⹻m;櫳;櫽y;䐿rʀcimpt⺋⺏⺓ᡥ⺗nt;䀥od;䀮il;怰enk;怱r;쀀𝔭ƀimo⺨⺰⺴Ā;v⺭⺮䏆;䏕maô੶ne;明ƀ;tv⺿⻀⻈䏀chfork»´;䏖Āau⻏⻟nĀck⻕⻝kĀ;h⇴⻛;愎ö⇴sҀ;abcdemst⻳⻴ᤈ⻹⻽⼄⼆⼊⼎䀫cir;樣ir;樢Āouᵀ⼂;樥;橲n肻±ຝim;樦wo;樧ƀipu⼙⼠⼥ntint;樕f;쀀𝕡nd耻£䂣Ԁ;Eaceinosu່⼿⽁⽄⽇⾁⾉⾒⽾⾶;檳p;檷uå໙Ā;c໎⽌̀;acens່⽙⽟⽦⽨⽾pproø⽃urlyeñ໙ñ໎ƀaes⽯⽶⽺pprox;檹qq;檵im;拨iíໟmeĀ;s⾈ຮ怲ƀEas⽸⾐⽺ð⽵ƀdfp໬⾙⾯ƀals⾠⾥⾪lar;挮ine;挒urf;挓Ā;t໻⾴ï໻rel;抰Āci⿀⿅r;쀀𝓅;䏈ncsp;怈̀fiopsu⿚⋢⿟⿥⿫⿱r;쀀𝔮pf;쀀𝕢rime;恗cr;쀀𝓆ƀaeo⿸〉〓tĀei⿾々rnionóڰnt;樖stĀ;e【】䀿ñἙô༔઀ABHabcdefhilmnoprstux぀けさすムㄎㄫㅇㅢㅲㆎ㈆㈕㈤㈩㉘㉮㉲㊐㊰㊷ƀartぇおがròႳòϝail;検aròᱥar;楤΀cdenqrtとふへみわゔヌĀeuねぱ;쀀∽̱te;䅕iãᅮmptyv;榳gȀ;del࿑らるろ;榒;榥å࿑uo耻»䂻rր;abcfhlpstw࿜ガクシスゼゾダッデナp;極Ā;f࿠ゴs;椠;椳s;椞ë≝ð✮l;楅im;楴l;憣;憝Āaiパフil;椚oĀ;nホボ戶aló༞ƀabrョリヮrò៥rk;杳ĀakンヽcĀekヹ・;䁽;䁝Āes㄂㄄;榌lĀduㄊㄌ;榎;榐Ȁaeuyㄗㄜㄧㄩron;䅙Ādiㄡㄥil;䅗ì࿲âヺ;䑀Ȁclqsㄴㄷㄽㅄa;椷dhar;楩uoĀ;rȎȍh;憳ƀacgㅎㅟངlȀ;ipsླྀㅘㅛႜnåႻarôྩt;断ƀilrㅩဣㅮsht;楽;쀀𝔯ĀaoㅷㆆrĀduㅽㅿ»ѻĀ;l႑ㆄ;楬Ā;vㆋㆌ䏁;䏱ƀgns㆕ㇹㇼht̀ahlrstㆤㆰ㇂㇘㇤㇮rrowĀ;t࿜ㆭaéトarpoonĀduㆻㆿowîㅾp»႒eftĀah㇊㇐rrowó࿪arpoonóՑightarrows;應quigarro÷ニhreetimes;拌g;䋚ingdotseñἲƀahm㈍㈐㈓rò࿪aòՑ;怏oustĀ;a㈞㈟掱che»㈟mid;櫮Ȁabpt㈲㈽㉀㉒Ānr㈷㈺g;柭r;懾rëဃƀafl㉇㉊㉎r;榆;쀀𝕣us;樮imes;樵Āap㉝㉧rĀ;g㉣㉤䀩t;榔olint;樒arò㇣Ȁachq㉻㊀Ⴜ㊅quo;怺r;쀀𝓇Ābu・㊊oĀ;rȔȓƀhir㊗㊛㊠reåㇸmes;拊iȀ;efl㊪ၙᠡ㊫方tri;槎luhar;楨;愞ൡ㋕㋛㋟㌬㌸㍱\0㍺㎤\0\0㏬㏰\0㐨㑈㑚㒭㒱㓊㓱\0㘖\0\0㘳cute;䅛quï➺Ԁ;Eaceinpsyᇭ㋳㋵㋿㌂㌋㌏㌟㌦㌩;檴ǰ㋺\0㋼;檸on;䅡uåᇾĀ;dᇳ㌇il;䅟rc;䅝ƀEas㌖㌘㌛;檶p;檺im;择olint;樓iíሄ;䑁otƀ;be㌴ᵇ㌵担;橦΀Aacmstx㍆㍊㍗㍛㍞㍣㍭rr;懘rĀhr㍐㍒ë∨Ā;oਸ਼਴t耻§䂧i;䀻war;椩mĀin㍩ðnuóñt;朶rĀ;o㍶⁕쀀𝔰Ȁacoy㎂㎆㎑㎠rp;景Āhy㎋㎏cy;䑉;䑈rtɭ㎙\0\0㎜iäᑤaraì⹯耻­䂭Āgm㎨㎴maƀ;fv㎱㎲㎲䏃;䏂Ѐ;deglnprካ㏅㏉㏎㏖㏞㏡㏦ot;橪Ā;q኱ኰĀ;E㏓㏔檞;檠Ā;E㏛㏜檝;檟e;扆lus;樤arr;楲aròᄽȀaeit㏸㐈㐏㐗Āls㏽㐄lsetmé㍪hp;樳parsl;槤Ādlᑣ㐔e;挣Ā;e㐜㐝檪Ā;s㐢㐣檬;쀀⪬︀ƀflp㐮㐳㑂tcy;䑌Ā;b㐸㐹䀯Ā;a㐾㐿槄r;挿f;쀀𝕤aĀdr㑍ЂesĀ;u㑔㑕晠it»㑕ƀcsu㑠㑹㒟Āau㑥㑯pĀ;sᆈ㑫;쀀⊓︀pĀ;sᆴ㑵;쀀⊔︀uĀbp㑿㒏ƀ;esᆗᆜ㒆etĀ;eᆗ㒍ñᆝƀ;esᆨᆭ㒖etĀ;eᆨ㒝ñᆮƀ;afᅻ㒦ְrť㒫ֱ»ᅼaròᅈȀcemt㒹㒾㓂㓅r;쀀𝓈tmîñiì㐕aræᆾĀar㓎㓕rĀ;f㓔ឿ昆Āan㓚㓭ightĀep㓣㓪psiloîỠhé⺯s»⡒ʀbcmnp㓻㕞ሉ㖋㖎Ҁ;Edemnprs㔎㔏㔑㔕㔞㔣㔬㔱㔶抂;櫅ot;檽Ā;dᇚ㔚ot;櫃ult;櫁ĀEe㔨㔪;櫋;把lus;檿arr;楹ƀeiu㔽㕒㕕tƀ;en㔎㕅㕋qĀ;qᇚ㔏eqĀ;q㔫㔨m;櫇Ābp㕚㕜;櫕;櫓c̀;acensᇭ㕬㕲㕹㕻㌦pproø㋺urlyeñᇾñᇳƀaes㖂㖈㌛pproø㌚qñ㌗g;晪ڀ123;Edehlmnps㖩㖬㖯ሜ㖲㖴㗀㗉㗕㗚㗟㗨㗭耻¹䂹耻²䂲耻³䂳;櫆Āos㖹㖼t;檾ub;櫘Ā;dሢ㗅ot;櫄sĀou㗏㗒l;柉b;櫗arr;楻ult;櫂ĀEe㗤㗦;櫌;抋lus;櫀ƀeiu㗴㘉㘌tƀ;enሜ㗼㘂qĀ;qሢ㖲eqĀ;q㗧㗤m;櫈Ābp㘑㘓;櫔;櫖ƀAan㘜㘠㘭rr;懙rĀhr㘦㘨ë∮Ā;oਫ਩war;椪lig耻ß䃟௡㙑㙝㙠ዎ㙳㙹\0㙾㛂\0\0\0\0\0㛛㜃\0㜉㝬\0\0\0㞇ɲ㙖\0\0㙛get;挖;䏄rë๟ƀaey㙦㙫㙰ron;䅥dil;䅣;䑂lrec;挕r;쀀𝔱Ȁeiko㚆㚝㚵㚼ǲ㚋\0㚑eĀ4fኄኁaƀ;sv㚘㚙㚛䎸ym;䏑Ācn㚢㚲kĀas㚨㚮pproø዁im»ኬsðኞĀas㚺㚮ð዁rn耻þ䃾Ǭ̟㛆⋧es膀×;bd㛏㛐㛘䃗Ā;aᤏ㛕r;樱;樰ƀeps㛡㛣㜀á⩍Ȁ;bcf҆㛬㛰㛴ot;挶ir;櫱Ā;o㛹㛼쀀𝕥rk;櫚á㍢rime;怴ƀaip㜏㜒㝤dåቈ΀adempst㜡㝍㝀㝑㝗㝜㝟ngleʀ;dlqr㜰㜱㜶㝀㝂斵own»ᶻeftĀ;e⠀㜾ñम;扜ightĀ;e㊪㝋ñၚot;旬inus;樺lus;樹b;槍ime;樻ezium;揢ƀcht㝲㝽㞁Āry㝷㝻;쀀𝓉;䑆cy;䑛rok;䅧Āio㞋㞎xô᝷headĀlr㞗㞠eftarro÷ࡏightarrow»ཝऀAHabcdfghlmoprstuw㟐㟓㟗㟤㟰㟼㠎㠜㠣㠴㡑㡝㡫㢩㣌㣒㣪㣶ròϭar;楣Ācr㟜㟢ute耻ú䃺òᅐrǣ㟪\0㟭y;䑞ve;䅭Āiy㟵㟺rc耻û䃻;䑃ƀabh㠃㠆㠋ròᎭlac;䅱aòᏃĀir㠓㠘sht;楾;쀀𝔲rave耻ù䃹š㠧㠱rĀlr㠬㠮»ॗ»ႃlk;斀Āct㠹㡍ɯ㠿\0\0㡊rnĀ;e㡅㡆挜r»㡆op;挏ri;旸Āal㡖㡚cr;䅫肻¨͉Āgp㡢㡦on;䅳f;쀀𝕦̀adhlsuᅋ㡸㡽፲㢑㢠ownáᎳarpoonĀlr㢈㢌efô㠭ighô㠯iƀ;hl㢙㢚㢜䏅»ᏺon»㢚parrows;懈ƀcit㢰㣄㣈ɯ㢶\0\0㣁rnĀ;e㢼㢽挝r»㢽op;挎ng;䅯ri;旹cr;쀀𝓊ƀdir㣙㣝㣢ot;拰lde;䅩iĀ;f㜰㣨»᠓Āam㣯㣲rò㢨l耻ü䃼angle;榧ހABDacdeflnoprsz㤜㤟㤩㤭㦵㦸㦽㧟㧤㧨㧳㧹㧽㨁㨠ròϷarĀ;v㤦㤧櫨;櫩asèϡĀnr㤲㤷grt;榜΀eknprst㓣㥆㥋㥒㥝㥤㦖appá␕othinçẖƀhir㓫⻈㥙opô⾵Ā;hᎷ㥢ïㆍĀiu㥩㥭gmá㎳Ābp㥲㦄setneqĀ;q㥽㦀쀀⊊︀;쀀⫋︀setneqĀ;q㦏㦒쀀⊋︀;쀀⫌︀Āhr㦛㦟etá㚜iangleĀlr㦪㦯eft»थight»ၑy;䐲ash»ံƀelr㧄㧒㧗ƀ;beⷪ㧋㧏ar;抻q;扚lip;拮Ābt㧜ᑨaòᑩr;쀀𝔳tré㦮suĀbp㧯㧱»ജ»൙pf;쀀𝕧roð໻tré㦴Ācu㨆㨋r;쀀𝓋Ābp㨐㨘nĀEe㦀㨖»㥾nĀEe㦒㨞»㦐igzag;榚΀cefoprs㨶㨻㩖㩛㩔㩡㩪irc;䅵Ādi㩀㩑Ābg㩅㩉ar;機eĀ;qᗺ㩏;扙erp;愘r;쀀𝔴pf;쀀𝕨Ā;eᑹ㩦atèᑹcr;쀀𝓌ૣណ㪇\0㪋\0㪐㪛\0\0㪝㪨㪫㪯\0\0㫃㫎\0㫘ៜ៟tré៑r;쀀𝔵ĀAa㪔㪗ròσrò৶;䎾ĀAa㪡㪤ròθrò৫að✓is;拻ƀdptឤ㪵㪾Āfl㪺ឩ;쀀𝕩imåឲĀAa㫇㫊ròώròਁĀcq㫒ីr;쀀𝓍Āpt៖㫜ré។Ѐacefiosu㫰㫽㬈㬌㬑㬕㬛㬡cĀuy㫶㫻te耻ý䃽;䑏Āiy㬂㬆rc;䅷;䑋n耻¥䂥r;쀀𝔶cy;䑗pf;쀀𝕪cr;쀀𝓎Ācm㬦㬩y;䑎l耻ÿ䃿Ԁacdefhiosw㭂㭈㭔㭘㭤㭩㭭㭴㭺㮀cute;䅺Āay㭍㭒ron;䅾;䐷ot;䅼Āet㭝㭡træᕟa;䎶r;쀀𝔷cy;䐶grarr;懝pf;쀀𝕫cr;쀀𝓏Ājn㮅㮇;怍j;怌'.split("").map(t=>t.charCodeAt(0))),Tze=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function Cze(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=Tze.get(t))!==null&&e!==void 0?e:t}var sa;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(sa||(sa={}));const Mze=32;var Yc;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(Yc||(Yc={}));function QI(t){return t>=sa.ZERO&&t<=sa.NINE}function Aze(t){return t>=sa.UPPER_A&&t<=sa.UPPER_F||t>=sa.LOWER_A&&t<=sa.LOWER_F}function kze(t){return t>=sa.UPPER_A&&t<=sa.UPPER_Z||t>=sa.LOWER_A&&t<=sa.LOWER_Z||QI(t)}function Ize(t){return t===sa.EQUALS||kze(t)}var aa;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(aa||(aa={}));var Nu;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(Nu||(Nu={}));class Nze{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=aa.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Nu.Strict}startEntity(e){this.decodeMode=e,this.state=aa.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case aa.EntityStart:return e.charCodeAt(n)===sa.NUM?(this.state=aa.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=aa.NamedEntity,this.stateNamedEntity(e,n));case aa.NumericStart:return this.stateNumericStart(e,n);case aa.NumericDecimal:return this.stateNumericDecimal(e,n);case aa.NumericHex:return this.stateNumericHex(e,n);case aa.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|Mze)===sa.LOWER_X?(this.state=aa.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=aa.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,i){if(n!==r){const a=r-n;this.result=this.result*Math.pow(i,a)+Number.parseInt(e.substr(n,a),i),this.consumed+=a}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const i=e.charCodeAt(n);if(QI(i)||Aze(i))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(i,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const i=e.charCodeAt(n);if(QI(i))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(i,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===sa.SEMI)this.consumed+=1;else if(this.decodeMode===Nu.Strict)return 0;return this.emitCodePoint(Cze(this.result),this.consumed),this.errors&&(e!==sa.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let i=r[this.treeIndex],a=(i&Yc.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const s=e.charCodeAt(n);if(this.treeIndex=Rze(r,i,this.treeIndex+Math.max(1,a),s),this.treeIndex<0)return this.result===0||this.decodeMode===Nu.Attribute&&(a===0||Ize(s))?0:this.emitNotTerminatedNamedEntity();if(i=r[this.treeIndex],a=(i&Yc.VALUE_LENGTH)>>14,a!==0){if(s===sa.SEMI)return this.emitNamedEntityData(this.treeIndex,a,this.consumed+this.excess);this.decodeMode!==Nu.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,i=(r[n]&Yc.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,i,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:i}=this;return this.emitCodePoint(n===1?i[e]&~Yc.VALUE_LENGTH:i[e+1],r),n===3&&this.emitCodePoint(i[e+2],r),r}end(){var e;switch(this.state){case aa.NamedEntity:return this.result!==0&&(this.decodeMode!==Nu.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case aa.NumericDecimal:return this.emitNumericEntity(0,2);case aa.NumericHex:return this.emitNumericEntity(0,3);case aa.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case aa.EntityStart:return 0}}}function Rze(t,e,n,r){const i=(e&Yc.BRANCH_LENGTH)>>7,a=e&Yc.JUMP_TABLE;if(i===0)return a!==0&&r===a?n:-1;if(a){const l=r-a;return l<0||l>=i?-1:t[n+l]-1}let s=n,o=s+i-1;for(;s<=o;){const l=s+o>>>1,u=t[l];if(u<r)s=l+1;else if(u>r)o=l-1;else return t[l+i]}return-1}var _t;(function(t){t.HTML="http://www.w3.org/1999/xhtml",t.MATHML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLINK="http://www.w3.org/1999/xlink",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/"})(_t||(_t={}));var $h;(function(t){t.TYPE="type",t.ACTION="action",t.ENCODING="encoding",t.PROMPT="prompt",t.NAME="name",t.COLOR="color",t.FACE="face",t.SIZE="size"})($h||($h={}));var ho;(function(t){t.NO_QUIRKS="no-quirks",t.QUIRKS="quirks",t.LIMITED_QUIRKS="limited-quirks"})(ho||(ho={}));var et;(function(t){t.A="a",t.ADDRESS="address",t.ANNOTATION_XML="annotation-xml",t.APPLET="applet",t.AREA="area",t.ARTICLE="article",t.ASIDE="aside",t.B="b",t.BASE="base",t.BASEFONT="basefont",t.BGSOUND="bgsound",t.BIG="big",t.BLOCKQUOTE="blockquote",t.BODY="body",t.BR="br",t.BUTTON="button",t.CAPTION="caption",t.CENTER="center",t.CODE="code",t.COL="col",t.COLGROUP="colgroup",t.DD="dd",t.DESC="desc",t.DETAILS="details",t.DIALOG="dialog",t.DIR="dir",t.DIV="div",t.DL="dl",t.DT="dt",t.EM="em",t.EMBED="embed",t.FIELDSET="fieldset",t.FIGCAPTION="figcaption",t.FIGURE="figure",t.FONT="font",t.FOOTER="footer",t.FOREIGN_OBJECT="foreignObject",t.FORM="form",t.FRAME="frame",t.FRAMESET="frameset",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6",t.HEAD="head",t.HEADER="header",t.HGROUP="hgroup",t.HR="hr",t.HTML="html",t.I="i",t.IMG="img",t.IMAGE="image",t.INPUT="input",t.IFRAME="iframe",t.KEYGEN="keygen",t.LABEL="label",t.LI="li",t.LINK="link",t.LISTING="listing",t.MAIN="main",t.MALIGNMARK="malignmark",t.MARQUEE="marquee",t.MATH="math",t.MENU="menu",t.META="meta",t.MGLYPH="mglyph",t.MI="mi",t.MO="mo",t.MN="mn",t.MS="ms",t.MTEXT="mtext",t.NAV="nav",t.NOBR="nobr",t.NOFRAMES="noframes",t.NOEMBED="noembed",t.NOSCRIPT="noscript",t.OBJECT="object",t.OL="ol",t.OPTGROUP="optgroup",t.OPTION="option",t.P="p",t.PARAM="param",t.PLAINTEXT="plaintext",t.PRE="pre",t.RB="rb",t.RP="rp",t.RT="rt",t.RTC="rtc",t.RUBY="ruby",t.S="s",t.SCRIPT="script",t.SEARCH="search",t.SECTION="section",t.SELECT="select",t.SOURCE="source",t.SMALL="small",t.SPAN="span",t.STRIKE="strike",t.STRONG="strong",t.STYLE="style",t.SUB="sub",t.SUMMARY="summary",t.SUP="sup",t.TABLE="table",t.TBODY="tbody",t.TEMPLATE="template",t.TEXTAREA="textarea",t.TFOOT="tfoot",t.TD="td",t.TH="th",t.THEAD="thead",t.TITLE="title",t.TR="tr",t.TRACK="track",t.TT="tt",t.U="u",t.UL="ul",t.SVG="svg",t.VAR="var",t.WBR="wbr",t.XMP="xmp"})(et||(et={}));var $;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A=1]="A",t[t.ADDRESS=2]="ADDRESS",t[t.ANNOTATION_XML=3]="ANNOTATION_XML",t[t.APPLET=4]="APPLET",t[t.AREA=5]="AREA",t[t.ARTICLE=6]="ARTICLE",t[t.ASIDE=7]="ASIDE",t[t.B=8]="B",t[t.BASE=9]="BASE",t[t.BASEFONT=10]="BASEFONT",t[t.BGSOUND=11]="BGSOUND",t[t.BIG=12]="BIG",t[t.BLOCKQUOTE=13]="BLOCKQUOTE",t[t.BODY=14]="BODY",t[t.BR=15]="BR",t[t.BUTTON=16]="BUTTON",t[t.CAPTION=17]="CAPTION",t[t.CENTER=18]="CENTER",t[t.CODE=19]="CODE",t[t.COL=20]="COL",t[t.COLGROUP=21]="COLGROUP",t[t.DD=22]="DD",t[t.DESC=23]="DESC",t[t.DETAILS=24]="DETAILS",t[t.DIALOG=25]="DIALOG",t[t.DIR=26]="DIR",t[t.DIV=27]="DIV",t[t.DL=28]="DL",t[t.DT=29]="DT",t[t.EM=30]="EM",t[t.EMBED=31]="EMBED",t[t.FIELDSET=32]="FIELDSET",t[t.FIGCAPTION=33]="FIGCAPTION",t[t.FIGURE=34]="FIGURE",t[t.FONT=35]="FONT",t[t.FOOTER=36]="FOOTER",t[t.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",t[t.FORM=38]="FORM",t[t.FRAME=39]="FRAME",t[t.FRAMESET=40]="FRAMESET",t[t.H1=41]="H1",t[t.H2=42]="H2",t[t.H3=43]="H3",t[t.H4=44]="H4",t[t.H5=45]="H5",t[t.H6=46]="H6",t[t.HEAD=47]="HEAD",t[t.HEADER=48]="HEADER",t[t.HGROUP=49]="HGROUP",t[t.HR=50]="HR",t[t.HTML=51]="HTML",t[t.I=52]="I",t[t.IMG=53]="IMG",t[t.IMAGE=54]="IMAGE",t[t.INPUT=55]="INPUT",t[t.IFRAME=56]="IFRAME",t[t.KEYGEN=57]="KEYGEN",t[t.LABEL=58]="LABEL",t[t.LI=59]="LI",t[t.LINK=60]="LINK",t[t.LISTING=61]="LISTING",t[t.MAIN=62]="MAIN",t[t.MALIGNMARK=63]="MALIGNMARK",t[t.MARQUEE=64]="MARQUEE",t[t.MATH=65]="MATH",t[t.MENU=66]="MENU",t[t.META=67]="META",t[t.MGLYPH=68]="MGLYPH",t[t.MI=69]="MI",t[t.MO=70]="MO",t[t.MN=71]="MN",t[t.MS=72]="MS",t[t.MTEXT=73]="MTEXT",t[t.NAV=74]="NAV",t[t.NOBR=75]="NOBR",t[t.NOFRAMES=76]="NOFRAMES",t[t.NOEMBED=77]="NOEMBED",t[t.NOSCRIPT=78]="NOSCRIPT",t[t.OBJECT=79]="OBJECT",t[t.OL=80]="OL",t[t.OPTGROUP=81]="OPTGROUP",t[t.OPTION=82]="OPTION",t[t.P=83]="P",t[t.PARAM=84]="PARAM",t[t.PLAINTEXT=85]="PLAINTEXT",t[t.PRE=86]="PRE",t[t.RB=87]="RB",t[t.RP=88]="RP",t[t.RT=89]="RT",t[t.RTC=90]="RTC",t[t.RUBY=91]="RUBY",t[t.S=92]="S",t[t.SCRIPT=93]="SCRIPT",t[t.SEARCH=94]="SEARCH",t[t.SECTION=95]="SECTION",t[t.SELECT=96]="SELECT",t[t.SOURCE=97]="SOURCE",t[t.SMALL=98]="SMALL",t[t.SPAN=99]="SPAN",t[t.STRIKE=100]="STRIKE",t[t.STRONG=101]="STRONG",t[t.STYLE=102]="STYLE",t[t.SUB=103]="SUB",t[t.SUMMARY=104]="SUMMARY",t[t.SUP=105]="SUP",t[t.TABLE=106]="TABLE",t[t.TBODY=107]="TBODY",t[t.TEMPLATE=108]="TEMPLATE",t[t.TEXTAREA=109]="TEXTAREA",t[t.TFOOT=110]="TFOOT",t[t.TD=111]="TD",t[t.TH=112]="TH",t[t.THEAD=113]="THEAD",t[t.TITLE=114]="TITLE",t[t.TR=115]="TR",t[t.TRACK=116]="TRACK",t[t.TT=117]="TT",t[t.U=118]="U",t[t.UL=119]="UL",t[t.SVG=120]="SVG",t[t.VAR=121]="VAR",t[t.WBR=122]="WBR",t[t.XMP=123]="XMP"})($||($={}));const Pze=new Map([[et.A,$.A],[et.ADDRESS,$.ADDRESS],[et.ANNOTATION_XML,$.ANNOTATION_XML],[et.APPLET,$.APPLET],[et.AREA,$.AREA],[et.ARTICLE,$.ARTICLE],[et.ASIDE,$.ASIDE],[et.B,$.B],[et.BASE,$.BASE],[et.BASEFONT,$.BASEFONT],[et.BGSOUND,$.BGSOUND],[et.BIG,$.BIG],[et.BLOCKQUOTE,$.BLOCKQUOTE],[et.BODY,$.BODY],[et.BR,$.BR],[et.BUTTON,$.BUTTON],[et.CAPTION,$.CAPTION],[et.CENTER,$.CENTER],[et.CODE,$.CODE],[et.COL,$.COL],[et.COLGROUP,$.COLGROUP],[et.DD,$.DD],[et.DESC,$.DESC],[et.DETAILS,$.DETAILS],[et.DIALOG,$.DIALOG],[et.DIR,$.DIR],[et.DIV,$.DIV],[et.DL,$.DL],[et.DT,$.DT],[et.EM,$.EM],[et.EMBED,$.EMBED],[et.FIELDSET,$.FIELDSET],[et.FIGCAPTION,$.FIGCAPTION],[et.FIGURE,$.FIGURE],[et.FONT,$.FONT],[et.FOOTER,$.FOOTER],[et.FOREIGN_OBJECT,$.FOREIGN_OBJECT],[et.FORM,$.FORM],[et.FRAME,$.FRAME],[et.FRAMESET,$.FRAMESET],[et.H1,$.H1],[et.H2,$.H2],[et.H3,$.H3],[et.H4,$.H4],[et.H5,$.H5],[et.H6,$.H6],[et.HEAD,$.HEAD],[et.HEADER,$.HEADER],[et.HGROUP,$.HGROUP],[et.HR,$.HR],[et.HTML,$.HTML],[et.I,$.I],[et.IMG,$.IMG],[et.IMAGE,$.IMAGE],[et.INPUT,$.INPUT],[et.IFRAME,$.IFRAME],[et.KEYGEN,$.KEYGEN],[et.LABEL,$.LABEL],[et.LI,$.LI],[et.LINK,$.LINK],[et.LISTING,$.LISTING],[et.MAIN,$.MAIN],[et.MALIGNMARK,$.MALIGNMARK],[et.MARQUEE,$.MARQUEE],[et.MATH,$.MATH],[et.MENU,$.MENU],[et.META,$.META],[et.MGLYPH,$.MGLYPH],[et.MI,$.MI],[et.MO,$.MO],[et.MN,$.MN],[et.MS,$.MS],[et.MTEXT,$.MTEXT],[et.NAV,$.NAV],[et.NOBR,$.NOBR],[et.NOFRAMES,$.NOFRAMES],[et.NOEMBED,$.NOEMBED],[et.NOSCRIPT,$.NOSCRIPT],[et.OBJECT,$.OBJECT],[et.OL,$.OL],[et.OPTGROUP,$.OPTGROUP],[et.OPTION,$.OPTION],[et.P,$.P],[et.PARAM,$.PARAM],[et.PLAINTEXT,$.PLAINTEXT],[et.PRE,$.PRE],[et.RB,$.RB],[et.RP,$.RP],[et.RT,$.RT],[et.RTC,$.RTC],[et.RUBY,$.RUBY],[et.S,$.S],[et.SCRIPT,$.SCRIPT],[et.SEARCH,$.SEARCH],[et.SECTION,$.SECTION],[et.SELECT,$.SELECT],[et.SOURCE,$.SOURCE],[et.SMALL,$.SMALL],[et.SPAN,$.SPAN],[et.STRIKE,$.STRIKE],[et.STRONG,$.STRONG],[et.STYLE,$.STYLE],[et.SUB,$.SUB],[et.SUMMARY,$.SUMMARY],[et.SUP,$.SUP],[et.TABLE,$.TABLE],[et.TBODY,$.TBODY],[et.TEMPLATE,$.TEMPLATE],[et.TEXTAREA,$.TEXTAREA],[et.TFOOT,$.TFOOT],[et.TD,$.TD],[et.TH,$.TH],[et.THEAD,$.THEAD],[et.TITLE,$.TITLE],[et.TR,$.TR],[et.TRACK,$.TRACK],[et.TT,$.TT],[et.U,$.U],[et.UL,$.UL],[et.SVG,$.SVG],[et.VAR,$.VAR],[et.WBR,$.WBR],[et.XMP,$.XMP]]);function K0(t){var e;return(e=Pze.get(t))!==null&&e!==void 0?e:$.UNKNOWN}const Et=$,Dze={[_t.HTML]:new Set([Et.ADDRESS,Et.APPLET,Et.AREA,Et.ARTICLE,Et.ASIDE,Et.BASE,Et.BASEFONT,Et.BGSOUND,Et.BLOCKQUOTE,Et.BODY,Et.BR,Et.BUTTON,Et.CAPTION,Et.CENTER,Et.COL,Et.COLGROUP,Et.DD,Et.DETAILS,Et.DIR,Et.DIV,Et.DL,Et.DT,Et.EMBED,Et.FIELDSET,Et.FIGCAPTION,Et.FIGURE,Et.FOOTER,Et.FORM,Et.FRAME,Et.FRAMESET,Et.H1,Et.H2,Et.H3,Et.H4,Et.H5,Et.H6,Et.HEAD,Et.HEADER,Et.HGROUP,Et.HR,Et.HTML,Et.IFRAME,Et.IMG,Et.INPUT,Et.LI,Et.LINK,Et.LISTING,Et.MAIN,Et.MARQUEE,Et.MENU,Et.META,Et.NAV,Et.NOEMBED,Et.NOFRAMES,Et.NOSCRIPT,Et.OBJECT,Et.OL,Et.P,Et.PARAM,Et.PLAINTEXT,Et.PRE,Et.SCRIPT,Et.SECTION,Et.SELECT,Et.SOURCE,Et.STYLE,Et.SUMMARY,Et.TABLE,Et.TBODY,Et.TD,Et.TEMPLATE,Et.TEXTAREA,Et.TFOOT,Et.TH,Et.THEAD,Et.TITLE,Et.TR,Et.TRACK,Et.UL,Et.WBR,Et.XMP]),[_t.MATHML]:new Set([Et.MI,Et.MO,Et.MN,Et.MS,Et.MTEXT,Et.ANNOTATION_XML]),[_t.SVG]:new Set([Et.TITLE,Et.FOREIGN_OBJECT,Et.DESC]),[_t.XLINK]:new Set,[_t.XML]:new Set,[_t.XMLNS]:new Set},eN=new Set([Et.H1,Et.H2,Et.H3,Et.H4,Et.H5,Et.H6]);et.STYLE,et.SCRIPT,et.XMP,et.IFRAME,et.NOEMBED,et.NOFRAMES,et.PLAINTEXT;var Ae;(function(t){t[t.DATA=0]="DATA",t[t.RCDATA=1]="RCDATA",t[t.RAWTEXT=2]="RAWTEXT",t[t.SCRIPT_DATA=3]="SCRIPT_DATA",t[t.PLAINTEXT=4]="PLAINTEXT",t[t.TAG_OPEN=5]="TAG_OPEN",t[t.END_TAG_OPEN=6]="END_TAG_OPEN",t[t.TAG_NAME=7]="TAG_NAME",t[t.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",t[t.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",t[t.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",t[t.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",t[t.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",t[t.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",t[t.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",t[t.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",t[t.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",t[t.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",t[t.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",t[t.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",t[t.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",t[t.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",t[t.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",t[t.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",t[t.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",t[t.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",t[t.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",t[t.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",t[t.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",t[t.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",t[t.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",t[t.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",t[t.BOGUS_COMMENT=40]="BOGUS_COMMENT",t[t.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",t[t.COMMENT_START=42]="COMMENT_START",t[t.COMMENT_START_DASH=43]="COMMENT_START_DASH",t[t.COMMENT=44]="COMMENT",t[t.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",t[t.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",t[t.COMMENT_END_DASH=49]="COMMENT_END_DASH",t[t.COMMENT_END=50]="COMMENT_END",t[t.COMMENT_END_BANG=51]="COMMENT_END_BANG",t[t.DOCTYPE=52]="DOCTYPE",t[t.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",t[t.DOCTYPE_NAME=54]="DOCTYPE_NAME",t[t.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",t[t.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",t[t.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",t[t.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",t[t.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",t[t.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",t[t.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",t[t.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",t[t.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",t[t.CDATA_SECTION=68]="CDATA_SECTION",t[t.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",t[t.CDATA_SECTION_END=70]="CDATA_SECTION_END",t[t.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",t[t.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(Ae||(Ae={}));const Ei={DATA:Ae.DATA,RCDATA:Ae.RCDATA,RAWTEXT:Ae.RAWTEXT,SCRIPT_DATA:Ae.SCRIPT_DATA,PLAINTEXT:Ae.PLAINTEXT,CDATA_SECTION:Ae.CDATA_SECTION};function Oze(t){return t>=Se.DIGIT_0&&t<=Se.DIGIT_9}function bg(t){return t>=Se.LATIN_CAPITAL_A&&t<=Se.LATIN_CAPITAL_Z}function Lze(t){return t>=Se.LATIN_SMALL_A&&t<=Se.LATIN_SMALL_Z}function Fc(t){return Lze(t)||bg(t)}function Cj(t){return Fc(t)||Oze(t)}function vb(t){return t+32}function iae(t){return t===Se.SPACE||t===Se.LINE_FEED||t===Se.TABULATION||t===Se.FORM_FEED}function Mj(t){return iae(t)||t===Se.SOLIDUS||t===Se.GREATER_THAN_SIGN}function Fze(t){return t===Se.NULL?ct.nullCharacterReference:t>1114111?ct.characterReferenceOutsideUnicodeRange:eae(t)?ct.surrogateCharacterReference:nae(t)?ct.noncharacterCharacterReference:tae(t)||t===Se.CARRIAGE_RETURN?ct.controlCharacterReference:null}class Bze{constructor(e,n){this.options=e,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=Ae.DATA,this.returnState=Ae.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new Sze(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new Nze(Eze,(r,i)=>{this.preprocessor.pos=this.entityStartPos+i-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(ct.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err(ct.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const i=Fze(r);i&&this._err(i,1)}}:void 0)}_err(e,n=0){var r,i;(i=(r=this.handler).onParseError)===null||i===void 0||i.call(r,this.preprocessor.getError(e,n))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e?.())}write(e,n,r){this.active=!0,this.preprocessor.write(e,n),this._runParsingLoop(),this.paused||r?.()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let n=0;n<e;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,n){return this.preprocessor.startsWith(e,n)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Bn.START_TAG,tagName:"",tagID:$.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Bn.END_TAG,tagName:"",tagID:$.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:Bn.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:Bn.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,n){this.currentCharacterToken={type:e,chars:n,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,n;const r=this.currentToken;if(rae(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const i=(e=(n=r.location).attrs)!==null&&e!==void 0?e:n.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(ct.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=K0(e.tagName),e.type===Bn.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(ct.endTagWithAttributes),e.selfClosing&&this._err(ct.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case Bn.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Bn.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Bn.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:Bn.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,n)}_emitCodePoint(e){const n=iae(e)?Bn.WHITESPACE_CHARACTER:e===Se.NULL?Bn.NULL_CHARACTER:Bn.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(Bn.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=Ae.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?Nu.Attribute:Nu.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===Ae.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===Ae.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===Ae.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case Ae.DATA:{this._stateData(e);break}case Ae.RCDATA:{this._stateRcdata(e);break}case Ae.RAWTEXT:{this._stateRawtext(e);break}case Ae.SCRIPT_DATA:{this._stateScriptData(e);break}case Ae.PLAINTEXT:{this._statePlaintext(e);break}case Ae.TAG_OPEN:{this._stateTagOpen(e);break}case Ae.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case Ae.TAG_NAME:{this._stateTagName(e);break}case Ae.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case Ae.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case Ae.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case Ae.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case Ae.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case Ae.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case Ae.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case Ae.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case Ae.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case Ae.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case Ae.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case Ae.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case Ae.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case Ae.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case Ae.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case Ae.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case Ae.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case Ae.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case Ae.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case Ae.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case Ae.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case Ae.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case Ae.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case Ae.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case Ae.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case Ae.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case Ae.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case Ae.BOGUS_COMMENT:{this._stateBogusComment(e);break}case Ae.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case Ae.COMMENT_START:{this._stateCommentStart(e);break}case Ae.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case Ae.COMMENT:{this._stateComment(e);break}case Ae.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case Ae.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case Ae.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case Ae.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case Ae.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case Ae.COMMENT_END:{this._stateCommentEnd(e);break}case Ae.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case Ae.DOCTYPE:{this._stateDoctype(e);break}case Ae.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case Ae.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case Ae.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case Ae.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case Ae.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case Ae.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case Ae.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case Ae.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case Ae.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case Ae.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case Ae.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case Ae.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case Ae.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case Ae.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case Ae.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case Ae.CDATA_SECTION:{this._stateCdataSection(e);break}case Ae.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case Ae.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case Ae.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case Ae.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case Se.LESS_THAN_SIGN:{this.state=Ae.TAG_OPEN;break}case Se.AMPERSAND:{this._startCharacterReference();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitCodePoint(e);break}case Se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case Se.AMPERSAND:{this._startCharacterReference();break}case Se.LESS_THAN_SIGN:{this.state=Ae.RCDATA_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case Se.LESS_THAN_SIGN:{this.state=Ae.RAWTEXT_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Fc(e))this._createStartTagToken(),this.state=Ae.TAG_NAME,this._stateTagName(e);else switch(e){case Se.EXCLAMATION_MARK:{this.state=Ae.MARKUP_DECLARATION_OPEN;break}case Se.SOLIDUS:{this.state=Ae.END_TAG_OPEN;break}case Se.QUESTION_MARK:{this._err(ct.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=Ae.BOGUS_COMMENT,this._stateBogusComment(e);break}case Se.EOF:{this._err(ct.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(ct.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=Ae.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Fc(e))this._createEndTagToken(),this.state=Ae.TAG_NAME,this._stateTagName(e);else switch(e){case Se.GREATER_THAN_SIGN:{this._err(ct.missingEndTagName),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(ct.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=Ae.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.BEFORE_ATTRIBUTE_NAME;break}case Se.SOLIDUS:{this.state=Ae.SELF_CLOSING_START_TAG;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentTagToken();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.tagName+=Xr;break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(bg(e)?vb(e):e)}}_stateRcdataLessThanSign(e){e===Se.SOLIDUS?this.state=Ae.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=Ae.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Fc(e)?(this.state=Ae.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=Ae.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=Ae.BEFORE_ATTRIBUTE_NAME,!1;case Se.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=Ae.SELF_CLOSING_START_TAG,!1;case Se.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=Ae.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=Ae.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===Se.SOLIDUS?this.state=Ae.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=Ae.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Fc(e)?(this.state=Ae.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=Ae.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=Ae.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case Se.SOLIDUS:{this.state=Ae.SCRIPT_DATA_END_TAG_OPEN;break}case Se.EXCLAMATION_MARK:{this.state=Ae.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=Ae.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Fc(e)?(this.state=Ae.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=Ae.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=Ae.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===Se.HYPHEN_MINUS?(this.state=Ae.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=Ae.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===Se.HYPHEN_MINUS?(this.state=Ae.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=Ae.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.state=Ae.SCRIPT_DATA_ESCAPED,this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=Ae.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case Se.HYPHEN_MINUS:{this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.SCRIPT_DATA,this._emitChars(">");break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.state=Ae.SCRIPT_DATA_ESCAPED,this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=Ae.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===Se.SOLIDUS?this.state=Ae.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Fc(e)?(this._emitChars("<"),this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=Ae.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Fc(e)?(this.state=Ae.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=Ae.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=Ae.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(hs.SCRIPT,!1)&&Mj(this.preprocessor.peek(hs.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<hs.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=Ae.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case Se.HYPHEN_MINUS:{this._emitChars("-");break}case Se.LESS_THAN_SIGN:{this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Se.GREATER_THAN_SIGN:{this.state=Ae.SCRIPT_DATA,this._emitChars(">");break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Xr);break}case Se.EOF:{this._err(ct.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===Se.SOLIDUS?(this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(hs.SCRIPT,!1)&&Mj(this.preprocessor.peek(hs.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<hs.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=Ae.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=Ae.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.SOLIDUS:case Se.GREATER_THAN_SIGN:case Se.EOF:{this.state=Ae.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case Se.EQUALS_SIGN:{this._err(ct.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=Ae.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=Ae.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:case Se.SOLIDUS:case Se.GREATER_THAN_SIGN:case Se.EOF:{this._leaveAttrName(),this.state=Ae.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case Se.EQUALS_SIGN:{this._leaveAttrName(),this.state=Ae.BEFORE_ATTRIBUTE_VALUE;break}case Se.QUOTATION_MARK:case Se.APOSTROPHE:case Se.LESS_THAN_SIGN:{this._err(ct.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.currentAttr.name+=Xr;break}default:this.currentAttr.name+=String.fromCodePoint(bg(e)?vb(e):e)}}_stateAfterAttributeName(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.SOLIDUS:{this.state=Ae.SELF_CLOSING_START_TAG;break}case Se.EQUALS_SIGN:{this.state=Ae.BEFORE_ATTRIBUTE_VALUE;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentTagToken();break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=Ae.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.QUOTATION_MARK:{this.state=Ae.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{this.state=Ae.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingAttributeValue),this.state=Ae.DATA,this.emitCurrentTagToken();break}default:this.state=Ae.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case Se.QUOTATION_MARK:{this.state=Ae.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Se.AMPERSAND:{this._startCharacterReference();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.currentAttr.value+=Xr;break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case Se.APOSTROPHE:{this.state=Ae.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Se.AMPERSAND:{this._startCharacterReference();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.currentAttr.value+=Xr;break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this._leaveAttrValue(),this.state=Ae.BEFORE_ATTRIBUTE_NAME;break}case Se.AMPERSAND:{this._startCharacterReference();break}case Se.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=Ae.DATA,this.emitCurrentTagToken();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),this.currentAttr.value+=Xr;break}case Se.QUOTATION_MARK:case Se.APOSTROPHE:case Se.LESS_THAN_SIGN:case Se.EQUALS_SIGN:case Se.GRAVE_ACCENT:{this._err(ct.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this._leaveAttrValue(),this.state=Ae.BEFORE_ATTRIBUTE_NAME;break}case Se.SOLIDUS:{this._leaveAttrValue(),this.state=Ae.SELF_CLOSING_START_TAG;break}case Se.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=Ae.DATA,this.emitCurrentTagToken();break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this._err(ct.missingWhitespaceBetweenAttributes),this.state=Ae.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case Se.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=Ae.DATA,this.emitCurrentTagToken();break}case Se.EOF:{this._err(ct.eofInTag),this._emitEOFToken();break}default:this._err(ct.unexpectedSolidusInTag),this.state=Ae.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const n=this.currentToken;switch(e){case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentComment(n);break}case Se.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.data+=Xr;break}default:n.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(hs.DASH_DASH,!0)?(this._createCommentToken(hs.DASH_DASH.length+1),this.state=Ae.COMMENT_START):this._consumeSequenceIfMatch(hs.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(hs.DOCTYPE.length+1),this.state=Ae.DOCTYPE):this._consumeSequenceIfMatch(hs.CDATA_START,!0)?this.inForeignNode?this.state=Ae.CDATA_SECTION:(this._err(ct.cdataInHtmlContent),this._createCommentToken(hs.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=Ae.BOGUS_COMMENT):this._ensureHibernation()||(this._err(ct.incorrectlyOpenedComment),this._createCommentToken(2),this.state=Ae.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.COMMENT_START_DASH;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptClosingOfEmptyComment),this.state=Ae.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=Ae.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const n=this.currentToken;switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.COMMENT_END;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptClosingOfEmptyComment),this.state=Ae.DATA,this.emitCurrentComment(n);break}case Se.EOF:{this._err(ct.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=Ae.COMMENT,this._stateComment(e)}}_stateComment(e){const n=this.currentToken;switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.COMMENT_END_DASH;break}case Se.LESS_THAN_SIGN:{n.data+="<",this.state=Ae.COMMENT_LESS_THAN_SIGN;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.data+=Xr;break}case Se.EOF:{this._err(ct.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const n=this.currentToken;switch(e){case Se.EXCLAMATION_MARK:{n.data+="!",this.state=Ae.COMMENT_LESS_THAN_SIGN_BANG;break}case Se.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=Ae.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===Se.HYPHEN_MINUS?this.state=Ae.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=Ae.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===Se.HYPHEN_MINUS?this.state=Ae.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=Ae.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==Se.GREATER_THAN_SIGN&&e!==Se.EOF&&this._err(ct.nestedComment),this.state=Ae.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const n=this.currentToken;switch(e){case Se.HYPHEN_MINUS:{this.state=Ae.COMMENT_END;break}case Se.EOF:{this._err(ct.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=Ae.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const n=this.currentToken;switch(e){case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentComment(n);break}case Se.EXCLAMATION_MARK:{this.state=Ae.COMMENT_END_BANG;break}case Se.HYPHEN_MINUS:{n.data+="-";break}case Se.EOF:{this._err(ct.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=Ae.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const n=this.currentToken;switch(e){case Se.HYPHEN_MINUS:{n.data+="--!",this.state=Ae.COMMENT_END_DASH;break}case Se.GREATER_THAN_SIGN:{this._err(ct.incorrectlyClosedComment),this.state=Ae.DATA,this.emitCurrentComment(n);break}case Se.EOF:{this._err(ct.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=Ae.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.BEFORE_DOCTYPE_NAME;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case Se.EOF:{this._err(ct.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingWhitespaceBeforeDoctypeName),this.state=Ae.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(bg(e))this._createDoctypeToken(String.fromCharCode(vb(e))),this.state=Ae.DOCTYPE_NAME;else switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.NULL:{this._err(ct.unexpectedNullCharacter),this._createDoctypeToken(Xr),this.state=Ae.DOCTYPE_NAME;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=Ae.DOCTYPE_NAME}}_stateDoctypeName(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.AFTER_DOCTYPE_NAME;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.name+=Xr;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(bg(e)?vb(e):e)}}_stateAfterDoctypeName(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(hs.PUBLIC,!1)?this.state=Ae.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(hs.SYSTEM,!1)?this.state=Ae.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(ct.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case Se.QUOTATION_MARK:{this._err(ct.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=Ae.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{this._err(ct.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=Ae.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.QUOTATION_MARK:{n.publicId="",this.state=Ae.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{n.publicId="",this.state=Ae.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case Se.QUOTATION_MARK:{this.state=Ae.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.publicId+=Xr;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case Se.APOSTROPHE:{this.state=Ae.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.publicId+=Xr;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.QUOTATION_MARK:{this._err(ct.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{this._err(ct.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.QUOTATION_MARK:{n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:{this.state=Ae.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case Se.QUOTATION_MARK:{this._err(ct.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{this._err(ct.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.QUOTATION_MARK:{n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Se.APOSTROPHE:{n.systemId="",this.state=Ae.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Se.GREATER_THAN_SIGN:{this._err(ct.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.DATA,this.emitCurrentDoctype(n);break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case Se.QUOTATION_MARK:{this.state=Ae.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.systemId+=Xr;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case Se.APOSTROPHE:{this.state=Ae.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter),n.systemId+=Xr;break}case Se.GREATER_THAN_SIGN:{this._err(ct.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case Se.SPACE:case Se.LINE_FEED:case Se.TABULATION:case Se.FORM_FEED:break;case Se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.EOF:{this._err(ct.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(ct.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=Ae.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const n=this.currentToken;switch(e){case Se.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=Ae.DATA;break}case Se.NULL:{this._err(ct.unexpectedNullCharacter);break}case Se.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case Se.RIGHT_SQUARE_BRACKET:{this.state=Ae.CDATA_SECTION_BRACKET;break}case Se.EOF:{this._err(ct.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===Se.RIGHT_SQUARE_BRACKET?this.state=Ae.CDATA_SECTION_END:(this._emitChars("]"),this.state=Ae.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case Se.GREATER_THAN_SIGN:{this.state=Ae.DATA;break}case Se.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=Ae.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(Se.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&Cj(this.preprocessor.peek(1))?Ae.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){Cj(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===Se.SEMICOLON&&this._err(ct.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}}const aae=new Set([$.DD,$.DT,$.LI,$.OPTGROUP,$.OPTION,$.P,$.RB,$.RP,$.RT,$.RTC]),Aj=new Set([...aae,$.CAPTION,$.COLGROUP,$.TBODY,$.TD,$.TFOOT,$.TH,$.THEAD,$.TR]),Ow=new Set([$.APPLET,$.CAPTION,$.HTML,$.MARQUEE,$.OBJECT,$.TABLE,$.TD,$.TEMPLATE,$.TH]),Uze=new Set([...Ow,$.OL,$.UL]),zze=new Set([...Ow,$.BUTTON]),kj=new Set([$.ANNOTATION_XML,$.MI,$.MN,$.MO,$.MS,$.MTEXT]),Ij=new Set([$.DESC,$.FOREIGN_OBJECT,$.TITLE]),jze=new Set([$.TR,$.TEMPLATE,$.HTML]),Hze=new Set([$.TBODY,$.TFOOT,$.THEAD,$.TEMPLATE,$.HTML]),$ze=new Set([$.TABLE,$.TEMPLATE,$.HTML]),Vze=new Set([$.TD,$.TH]);class qze{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=$.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===$.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===_t.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,n){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,n,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,n){const r=this._indexOf(e);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(e,n,r){const i=this._indexOf(e)+1;this.items.splice(i,0,n),this.tagIDs.splice(i,0,r),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(e){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(e,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==_t.HTML);this.shortenToLength(Math.max(n,0))}shortenToLength(e){for(;this.stackTop>=e;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<e)}}popUntilElementPopped(e){const n=this._indexOf(e);this.shortenToLength(Math.max(n,0))}popUntilPopped(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(Math.max(r,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(eN,_t.HTML)}popUntilTableCellPopped(){this.popUntilPopped(Vze,_t.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,n){for(let r=this.stackTop;r>=0;r--)if(e.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo($ze,_t.HTML)}clearBackToTableBodyContext(){this.clearBackTo(Hze,_t.HTML)}clearBackToTableRowContext(){this.clearBackTo(jze,_t.HTML)}remove(e){const n=this._indexOf(e);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===$.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const n=this._indexOf(e)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===$.HTML}hasInDynamicScope(e,n){for(let r=this.stackTop;r>=0;r--){const i=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case _t.HTML:{if(i===e)return!0;if(n.has(i))return!1;break}case _t.SVG:{if(Ij.has(i))return!1;break}case _t.MATHML:{if(kj.has(i))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,Ow)}hasInListItemScope(e){return this.hasInDynamicScope(e,Uze)}hasInButtonScope(e){return this.hasInDynamicScope(e,zze)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const n=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case _t.HTML:{if(eN.has(n))return!0;if(Ow.has(n))return!1;break}case _t.SVG:{if(Ij.has(n))return!1;break}case _t.MATHML:{if(kj.has(n))return!1;break}}}return!0}hasInTableScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===_t.HTML)switch(this.tagIDs[n]){case e:return!0;case $.TABLE:case $.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===_t.HTML)switch(this.tagIDs[e]){case $.TBODY:case $.THEAD:case $.TFOOT:return!0;case $.TABLE:case $.HTML:return!1}return!0}hasInSelectScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===_t.HTML)switch(this.tagIDs[n]){case e:return!0;case $.OPTION:case $.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&aae.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&Aj.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==void 0&&this.currentTagId!==e&&Aj.has(this.currentTagId);)this.pop()}}const zT=3;var Ml;(function(t){t[t.Marker=0]="Marker",t[t.Element=1]="Element"})(Ml||(Ml={}));const Nj={type:Ml.Marker};class Gze{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,n){const r=[],i=n.length,a=this.treeAdapter.getTagName(e),s=this.treeAdapter.getNamespaceURI(e);for(let o=0;o<this.entries.length;o++){const l=this.entries[o];if(l.type===Ml.Marker)break;const{element:u}=l;if(this.treeAdapter.getTagName(u)===a&&this.treeAdapter.getNamespaceURI(u)===s){const c=this.treeAdapter.getAttrList(u);c.length===i&&r.push({idx:o,attrs:c})}}return r}_ensureNoahArkCondition(e){if(this.entries.length<zT)return;const n=this.treeAdapter.getAttrList(e),r=this._getNoahArkConditionCandidates(e,n);if(r.length<zT)return;const i=new Map(n.map(s=>[s.name,s.value]));let a=0;for(let s=0;s<r.length;s++){const o=r[s];o.attrs.every(l=>i.get(l.name)===l.value)&&(a+=1,a>=zT&&this.entries.splice(o.idx,1))}}insertMarker(){this.entries.unshift(Nj)}pushElement(e,n){this._ensureNoahArkCondition(e),this.entries.unshift({type:Ml.Element,element:e,token:n})}insertElementAfterBookmark(e,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:Ml.Element,element:e,token:n})}removeEntry(e){const n=this.entries.indexOf(e);n!==-1&&this.entries.splice(n,1)}clearToLastMarker(){const e=this.entries.indexOf(Nj);e===-1?this.entries.length=0:this.entries.splice(0,e+1)}getElementEntryInScopeWithTagName(e){const n=this.entries.find(r=>r.type===Ml.Marker||this.treeAdapter.getTagName(r.element)===e);return n&&n.type===Ml.Element?n:null}getElementEntry(e){return this.entries.find(n=>n.type===Ml.Element&&n.element===e)}}const Bc={createDocument(){return{nodeName:"#document",mode:ho.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(t,e,n){return{nodeName:t,tagName:t,attrs:n,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(t){return{nodeName:"#comment",data:t,parentNode:null}},createTextNode(t){return{nodeName:"#text",value:t,parentNode:null}},appendChild(t,e){t.childNodes.push(e),e.parentNode=t},insertBefore(t,e,n){const r=t.childNodes.indexOf(n);t.childNodes.splice(r,0,e),e.parentNode=t},setTemplateContent(t,e){t.content=e},getTemplateContent(t){return t.content},setDocumentType(t,e,n,r){const i=t.childNodes.find(a=>a.nodeName==="#documentType");if(i)i.name=e,i.publicId=n,i.systemId=r;else{const a={nodeName:"#documentType",name:e,publicId:n,systemId:r,parentNode:null};Bc.appendChild(t,a)}},setDocumentMode(t,e){t.mode=e},getDocumentMode(t){return t.mode},detachNode(t){if(t.parentNode){const e=t.parentNode.childNodes.indexOf(t);t.parentNode.childNodes.splice(e,1),t.parentNode=null}},insertText(t,e){if(t.childNodes.length>0){const n=t.childNodes[t.childNodes.length-1];if(Bc.isTextNode(n)){n.value+=e;return}}Bc.appendChild(t,Bc.createTextNode(e))},insertTextBefore(t,e,n){const r=t.childNodes[t.childNodes.indexOf(n)-1];r&&Bc.isTextNode(r)?r.value+=e:Bc.insertBefore(t,Bc.createTextNode(e),n)},adoptAttributes(t,e){const n=new Set(t.attrs.map(r=>r.name));for(let r=0;r<e.length;r++)n.has(e[r].name)||t.attrs.push(e[r])},getFirstChild(t){return t.childNodes[0]},getChildNodes(t){return t.childNodes},getParentNode(t){return t.parentNode},getAttrList(t){return t.attrs},getTagName(t){return t.tagName},getNamespaceURI(t){return t.namespaceURI},getTextNodeContent(t){return t.value},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){return t.name},getDocumentTypeNodePublicId(t){return t.publicId},getDocumentTypeNodeSystemId(t){return t.systemId},isTextNode(t){return t.nodeName==="#text"},isCommentNode(t){return t.nodeName==="#comment"},isDocumentTypeNode(t){return t.nodeName==="#documentType"},isElementNode(t){return Object.prototype.hasOwnProperty.call(t,"tagName")},setNodeSourceCodeLocation(t,e){t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){t.sourceCodeLocation={...t.sourceCodeLocation,...e}}},sae="html",Wze="about:legacy-compat",Yze="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",oae=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],Xze=[...oae,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],Kze=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),lae=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],Zze=[...lae,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function Rj(t,e){return e.some(n=>t.startsWith(n))}function Jze(t){return t.name===sae&&t.publicId===null&&(t.systemId===null||t.systemId===Wze)}function Qze(t){if(t.name!==sae)return ho.QUIRKS;const{systemId:e}=t;if(e&&e.toLowerCase()===Yze)return ho.QUIRKS;let{publicId:n}=t;if(n!==null){if(n=n.toLowerCase(),Kze.has(n))return ho.QUIRKS;let r=e===null?Xze:oae;if(Rj(n,r))return ho.QUIRKS;if(r=e===null?lae:Zze,Rj(n,r))return ho.LIMITED_QUIRKS}return ho.NO_QUIRKS}const Pj={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},eje="definitionurl",tje="definitionURL",nje=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),rje=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:_t.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:_t.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:_t.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:_t.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:_t.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:_t.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:_t.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:_t.XML}],["xml:space",{prefix:"xml",name:"space",namespace:_t.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:_t.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:_t.XMLNS}]]),ije=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),aje=new Set([$.B,$.BIG,$.BLOCKQUOTE,$.BODY,$.BR,$.CENTER,$.CODE,$.DD,$.DIV,$.DL,$.DT,$.EM,$.EMBED,$.H1,$.H2,$.H3,$.H4,$.H5,$.H6,$.HEAD,$.HR,$.I,$.IMG,$.LI,$.LISTING,$.MENU,$.META,$.NOBR,$.OL,$.P,$.PRE,$.RUBY,$.S,$.SMALL,$.SPAN,$.STRONG,$.STRIKE,$.SUB,$.SUP,$.TABLE,$.TT,$.U,$.UL,$.VAR]);function sje(t){const e=t.tagID;return e===$.FONT&&t.attrs.some(({name:r})=>r===$h.COLOR||r===$h.SIZE||r===$h.FACE)||aje.has(e)}function uae(t){for(let e=0;e<t.attrs.length;e++)if(t.attrs[e].name===eje){t.attrs[e].name=tje;break}}function cae(t){for(let e=0;e<t.attrs.length;e++){const n=nje.get(t.attrs[e].name);n!=null&&(t.attrs[e].name=n)}}function o7(t){for(let e=0;e<t.attrs.length;e++){const n=rje.get(t.attrs[e].name);n&&(t.attrs[e].prefix=n.prefix,t.attrs[e].name=n.name,t.attrs[e].namespace=n.namespace)}}function oje(t){const e=ije.get(t.tagName);e!=null&&(t.tagName=e,t.tagID=K0(t.tagName))}function lje(t,e){return e===_t.MATHML&&(t===$.MI||t===$.MO||t===$.MN||t===$.MS||t===$.MTEXT)}function uje(t,e,n){if(e===_t.MATHML&&t===$.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===$h.ENCODING){const i=n[r].value.toLowerCase();return i===Pj.TEXT_HTML||i===Pj.APPLICATION_XML}}return e===_t.SVG&&(t===$.FOREIGN_OBJECT||t===$.DESC||t===$.TITLE)}function cje(t,e,n,r){return(!r||r===_t.HTML)&&uje(t,e,n)||(!r||r===_t.MATHML)&&lje(t,e)}const dje="hidden",hje=8,fje=3;var Le;(function(t){t[t.INITIAL=0]="INITIAL",t[t.BEFORE_HTML=1]="BEFORE_HTML",t[t.BEFORE_HEAD=2]="BEFORE_HEAD",t[t.IN_HEAD=3]="IN_HEAD",t[t.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",t[t.AFTER_HEAD=5]="AFTER_HEAD",t[t.IN_BODY=6]="IN_BODY",t[t.TEXT=7]="TEXT",t[t.IN_TABLE=8]="IN_TABLE",t[t.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",t[t.IN_CAPTION=10]="IN_CAPTION",t[t.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",t[t.IN_TABLE_BODY=12]="IN_TABLE_BODY",t[t.IN_ROW=13]="IN_ROW",t[t.IN_CELL=14]="IN_CELL",t[t.IN_SELECT=15]="IN_SELECT",t[t.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",t[t.IN_TEMPLATE=17]="IN_TEMPLATE",t[t.AFTER_BODY=18]="AFTER_BODY",t[t.IN_FRAMESET=19]="IN_FRAMESET",t[t.AFTER_FRAMESET=20]="AFTER_FRAMESET",t[t.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",t[t.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(Le||(Le={}));const pje={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},dae=new Set([$.TABLE,$.TBODY,$.TFOOT,$.THEAD,$.TR]),Dj={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Bc,onParseError:null};class Oj{constructor(e,n,r=null,i=null){this.fragmentContext=r,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=Le.INITIAL,this.originalInsertionMode=Le.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...Dj,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new Bze(this.options,this),this.activeFormattingElements=new Gze(this.treeAdapter),this.fragmentContextID=r?K0(this.treeAdapter.getTagName(r)):$.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new qze(this.document,this.treeAdapter,this)}static parse(e,n){const r=new this(n);return r.tokenizer.write(e,!0),r.document}static getFragmentParser(e,n){const r={...Dj,...n};e??(e=r.treeAdapter.createElement(et.TEMPLATE,_t.HTML,[]));const i=r.treeAdapter.createElement("documentmock",_t.HTML,[]),a=new this(r,i,e);return a.fragmentContextID===$.TEMPLATE&&a.tmplInsertionModeStack.unshift(Le.IN_TEMPLATE),a._initTokenizerForFragmentParsing(),a._insertFakeRootElement(),a._resetInsertionMode(),a._findFormInFragmentContext(),a}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,n),n}_err(e,n,r){var i;if(!this.onParseError)return;const a=(i=e.location)!==null&&i!==void 0?i:pje,s={code:n,startLine:a.startLine,startCol:a.startCol,startOffset:a.startOffset,endLine:r?a.startLine:a.endLine,endCol:r?a.startCol:a.endCol,endOffset:r?a.startOffset:a.endOffset};this.onParseError(s)}onItemPush(e,n,r){var i,a;(a=(i=this.treeAdapter).onItemPush)===null||a===void 0||a.call(i,e),r&&this.openElements.stackTop>0&&this._setContextModes(e,n)}onItemPop(e,n){var r,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(i=(r=this.treeAdapter).onItemPop)===null||i===void 0||i.call(r,e,this.openElements.current),n){let a,s;this.openElements.stackTop===0&&this.fragmentContext?(a=this.fragmentContext,s=this.fragmentContextID):{current:a,currentTagId:s}=this.openElements,this._setContextModes(a,s)}}_setContextModes(e,n){const r=e===this.document||e&&this.treeAdapter.getNamespaceURI(e)===_t.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&e!==void 0&&n!==void 0&&!this._isIntegrationPoint(n,e)}_switchToTextParsing(e,n){this._insertElement(e,_t.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=Le.TEXT}switchToPlaintextParsing(){this.insertionMode=Le.TEXT,this.originalInsertionMode=Le.IN_BODY,this.tokenizer.state=Ei.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===et.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==_t.HTML))switch(this.fragmentContextID){case $.TITLE:case $.TEXTAREA:{this.tokenizer.state=Ei.RCDATA;break}case $.STYLE:case $.XMP:case $.IFRAME:case $.NOEMBED:case $.NOFRAMES:case $.NOSCRIPT:{this.tokenizer.state=Ei.RAWTEXT;break}case $.SCRIPT:{this.tokenizer.state=Ei.SCRIPT_DATA;break}case $.PLAINTEXT:{this.tokenizer.state=Ei.PLAINTEXT;break}}}_setDocumentType(e){const n=e.name||"",r=e.publicId||"",i=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,i),e.location){const s=this.treeAdapter.getChildNodes(this.document).find(o=>this.treeAdapter.isDocumentTypeNode(o));s&&this.treeAdapter.setNodeSourceCodeLocation(s,e.location)}}_attachElementToTree(e,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(e,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r??this.document,e)}}_appendElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location)}_insertElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location),this.openElements.push(r,e.tagID)}_insertFakeElement(e,n){const r=this.treeAdapter.createElement(e,_t.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(e){const n=this.treeAdapter.createElement(e.tagName,_t.HTML,e.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,e.location),this.openElements.push(n,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(et.HTML,_t.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,$.HTML)}_appendCommentNode(e,n){const r=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,e.location)}_insertCharacters(e){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,e.chars,r):this.treeAdapter.insertText(n,e.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,e.chars)),!e.location)return;const i=this.treeAdapter.getChildNodes(n),a=r?i.lastIndexOf(r):i.length,s=i[a-1];if(this.treeAdapter.getNodeSourceCodeLocation(s)){const{endLine:l,endCol:u,endOffset:c}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(s,{endLine:l,endCol:u,endOffset:c})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(s,e.location)}_adoptNodes(e,n){for(let r=this.treeAdapter.getFirstChild(e);r;r=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(e,n){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&n.location){const r=n.location,i=this.treeAdapter.getTagName(e),a=n.type===Bn.END_TAG&&i===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,a)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,e.tagID===$.SVG&&this.treeAdapter.getTagName(n)===et.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===_t.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===$.MGLYPH||e.tagID===$.MALIGNMARK)&&r!==void 0&&!this._isIntegrationPoint(r,n,_t.HTML)}_processToken(e){switch(e.type){case Bn.CHARACTER:{this.onCharacter(e);break}case Bn.NULL_CHARACTER:{this.onNullCharacter(e);break}case Bn.COMMENT:{this.onComment(e);break}case Bn.DOCTYPE:{this.onDoctype(e);break}case Bn.START_TAG:{this._processStartTag(e);break}case Bn.END_TAG:{this.onEndTag(e);break}case Bn.EOF:{this.onEof(e);break}case Bn.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,n,r){const i=this.treeAdapter.getNamespaceURI(n),a=this.treeAdapter.getAttrList(n);return cje(e,i,a,r)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const n=this.activeFormattingElements.entries.findIndex(i=>i.type===Ml.Marker||this.openElements.contains(i.element)),r=n===-1?e-1:n-1;for(let i=r;i>=0;i--){const a=this.activeFormattingElements.entries[i];this._insertElement(a.token,this.treeAdapter.getNamespaceURI(a.element)),a.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=Le.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion($.P),this.openElements.popUntilTagNamePopped($.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case $.TR:{this.insertionMode=Le.IN_ROW;return}case $.TBODY:case $.THEAD:case $.TFOOT:{this.insertionMode=Le.IN_TABLE_BODY;return}case $.CAPTION:{this.insertionMode=Le.IN_CAPTION;return}case $.COLGROUP:{this.insertionMode=Le.IN_COLUMN_GROUP;return}case $.TABLE:{this.insertionMode=Le.IN_TABLE;return}case $.BODY:{this.insertionMode=Le.IN_BODY;return}case $.FRAMESET:{this.insertionMode=Le.IN_FRAMESET;return}case $.SELECT:{this._resetInsertionModeForSelect(e);return}case $.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case $.HTML:{this.insertionMode=this.headElement?Le.AFTER_HEAD:Le.BEFORE_HEAD;return}case $.TD:case $.TH:{if(e>0){this.insertionMode=Le.IN_CELL;return}break}case $.HEAD:{if(e>0){this.insertionMode=Le.IN_HEAD;return}break}}this.insertionMode=Le.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let n=e-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===$.TEMPLATE)break;if(r===$.TABLE){this.insertionMode=Le.IN_SELECT_IN_TABLE;return}}this.insertionMode=Le.IN_SELECT}_isElementCausesFosterParenting(e){return dae.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const n=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case $.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===_t.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case $.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,e,n.beforeElement):this.treeAdapter.appendChild(n.parent,e)}_isSpecialElement(e,n){const r=this.treeAdapter.getNamespaceURI(e);return Dze[r].has(n)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){VHe(this,e);return}switch(this.insertionMode){case Le.INITIAL:{sg(this,e);break}case Le.BEFORE_HTML:{Kg(this,e);break}case Le.BEFORE_HEAD:{Zg(this,e);break}case Le.IN_HEAD:{Jg(this,e);break}case Le.IN_HEAD_NO_SCRIPT:{Qg(this,e);break}case Le.AFTER_HEAD:{e1(this,e);break}case Le.IN_BODY:case Le.IN_CAPTION:case Le.IN_CELL:case Le.IN_TEMPLATE:{fae(this,e);break}case Le.TEXT:case Le.IN_SELECT:case Le.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case Le.IN_TABLE:case Le.IN_TABLE_BODY:case Le.IN_ROW:{jT(this,e);break}case Le.IN_TABLE_TEXT:{xae(this,e);break}case Le.IN_COLUMN_GROUP:{Lw(this,e);break}case Le.AFTER_BODY:{Fw(this,e);break}case Le.AFTER_AFTER_BODY:{Xb(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){$He(this,e);return}switch(this.insertionMode){case Le.INITIAL:{sg(this,e);break}case Le.BEFORE_HTML:{Kg(this,e);break}case Le.BEFORE_HEAD:{Zg(this,e);break}case Le.IN_HEAD:{Jg(this,e);break}case Le.IN_HEAD_NO_SCRIPT:{Qg(this,e);break}case Le.AFTER_HEAD:{e1(this,e);break}case Le.TEXT:{this._insertCharacters(e);break}case Le.IN_TABLE:case Le.IN_TABLE_BODY:case Le.IN_ROW:{jT(this,e);break}case Le.IN_COLUMN_GROUP:{Lw(this,e);break}case Le.AFTER_BODY:{Fw(this,e);break}case Le.AFTER_AFTER_BODY:{Xb(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){tN(this,e);return}switch(this.insertionMode){case Le.INITIAL:case Le.BEFORE_HTML:case Le.BEFORE_HEAD:case Le.IN_HEAD:case Le.IN_HEAD_NO_SCRIPT:case Le.AFTER_HEAD:case Le.IN_BODY:case Le.IN_TABLE:case Le.IN_CAPTION:case Le.IN_COLUMN_GROUP:case Le.IN_TABLE_BODY:case Le.IN_ROW:case Le.IN_CELL:case Le.IN_SELECT:case Le.IN_SELECT_IN_TABLE:case Le.IN_TEMPLATE:case Le.IN_FRAMESET:case Le.AFTER_FRAMESET:{tN(this,e);break}case Le.IN_TABLE_TEXT:{og(this,e);break}case Le.AFTER_BODY:{_je(this,e);break}case Le.AFTER_AFTER_BODY:case Le.AFTER_AFTER_FRAMESET:{wje(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case Le.INITIAL:{Sje(this,e);break}case Le.BEFORE_HEAD:case Le.IN_HEAD:case Le.IN_HEAD_NO_SCRIPT:case Le.AFTER_HEAD:{this._err(e,ct.misplacedDoctype);break}case Le.IN_TABLE_TEXT:{og(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,ct.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?qHe(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case Le.INITIAL:{sg(this,e);break}case Le.BEFORE_HTML:{Eje(this,e);break}case Le.BEFORE_HEAD:{Cje(this,e);break}case Le.IN_HEAD:{ll(this,e);break}case Le.IN_HEAD_NO_SCRIPT:{kje(this,e);break}case Le.AFTER_HEAD:{Nje(this,e);break}case Le.IN_BODY:{ja(this,e);break}case Le.IN_TABLE:{C0(this,e);break}case Le.IN_TABLE_TEXT:{og(this,e);break}case Le.IN_CAPTION:{MHe(this,e);break}case Le.IN_COLUMN_GROUP:{c7(this,e);break}case Le.IN_TABLE_BODY:{C3(this,e);break}case Le.IN_ROW:{M3(this,e);break}case Le.IN_CELL:{IHe(this,e);break}case Le.IN_SELECT:{wae(this,e);break}case Le.IN_SELECT_IN_TABLE:{RHe(this,e);break}case Le.IN_TEMPLATE:{DHe(this,e);break}case Le.AFTER_BODY:{LHe(this,e);break}case Le.IN_FRAMESET:{FHe(this,e);break}case Le.AFTER_FRAMESET:{UHe(this,e);break}case Le.AFTER_AFTER_BODY:{jHe(this,e);break}case Le.AFTER_AFTER_FRAMESET:{HHe(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?GHe(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case Le.INITIAL:{sg(this,e);break}case Le.BEFORE_HTML:{Tje(this,e);break}case Le.BEFORE_HEAD:{Mje(this,e);break}case Le.IN_HEAD:{Aje(this,e);break}case Le.IN_HEAD_NO_SCRIPT:{Ije(this,e);break}case Le.AFTER_HEAD:{Rje(this,e);break}case Le.IN_BODY:{T3(this,e);break}case Le.TEXT:{vHe(this,e);break}case Le.IN_TABLE:{X1(this,e);break}case Le.IN_TABLE_TEXT:{og(this,e);break}case Le.IN_CAPTION:{AHe(this,e);break}case Le.IN_COLUMN_GROUP:{kHe(this,e);break}case Le.IN_TABLE_BODY:{nN(this,e);break}case Le.IN_ROW:{_ae(this,e);break}case Le.IN_CELL:{NHe(this,e);break}case Le.IN_SELECT:{Sae(this,e);break}case Le.IN_SELECT_IN_TABLE:{PHe(this,e);break}case Le.IN_TEMPLATE:{OHe(this,e);break}case Le.AFTER_BODY:{Tae(this,e);break}case Le.IN_FRAMESET:{BHe(this,e);break}case Le.AFTER_FRAMESET:{zHe(this,e);break}case Le.AFTER_AFTER_BODY:{Xb(this,e);break}}}onEof(e){switch(this.insertionMode){case Le.INITIAL:{sg(this,e);break}case Le.BEFORE_HTML:{Kg(this,e);break}case Le.BEFORE_HEAD:{Zg(this,e);break}case Le.IN_HEAD:{Jg(this,e);break}case Le.IN_HEAD_NO_SCRIPT:{Qg(this,e);break}case Le.AFTER_HEAD:{e1(this,e);break}case Le.IN_BODY:case Le.IN_TABLE:case Le.IN_CAPTION:case Le.IN_COLUMN_GROUP:case Le.IN_TABLE_BODY:case Le.IN_ROW:case Le.IN_CELL:case Le.IN_SELECT:case Le.IN_SELECT_IN_TABLE:{vae(this,e);break}case Le.TEXT:{yHe(this,e);break}case Le.IN_TABLE_TEXT:{og(this,e);break}case Le.IN_TEMPLATE:{Eae(this,e);break}case Le.AFTER_BODY:case Le.IN_FRAMESET:case Le.AFTER_FRAMESET:case Le.AFTER_AFTER_BODY:case Le.AFTER_AFTER_FRAMESET:{u7(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===Se.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case Le.IN_HEAD:case Le.IN_HEAD_NO_SCRIPT:case Le.AFTER_HEAD:case Le.TEXT:case Le.IN_COLUMN_GROUP:case Le.IN_SELECT:case Le.IN_SELECT_IN_TABLE:case Le.IN_FRAMESET:case Le.AFTER_FRAMESET:{this._insertCharacters(e);break}case Le.IN_BODY:case Le.IN_CAPTION:case Le.IN_CELL:case Le.IN_TEMPLATE:case Le.AFTER_BODY:case Le.AFTER_AFTER_BODY:case Le.AFTER_AFTER_FRAMESET:{hae(this,e);break}case Le.IN_TABLE:case Le.IN_TABLE_BODY:case Le.IN_ROW:{jT(this,e);break}case Le.IN_TABLE_TEXT:{yae(this,e);break}}}}function mje(t,e){let n=t.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return n?t.openElements.contains(n.element)?t.openElements.hasInScope(e.tagID)||(n=null):(t.activeFormattingElements.removeEntry(n),n=null):gae(t,e),n}function gje(t,e){let n=null,r=t.openElements.stackTop;for(;r>=0;r--){const i=t.openElements.items[r];if(i===e.element)break;t._isSpecialElement(i,t.openElements.tagIDs[r])&&(n=i)}return n||(t.openElements.shortenToLength(Math.max(r,0)),t.activeFormattingElements.removeEntry(e)),n}function vje(t,e,n){let r=e,i=t.openElements.getCommonAncestor(e);for(let a=0,s=i;s!==n;a++,s=i){i=t.openElements.getCommonAncestor(s);const o=t.activeFormattingElements.getElementEntry(s),l=o&&a>=fje;!o||l?(l&&t.activeFormattingElements.removeEntry(o),t.openElements.remove(s)):(s=yje(t,o),r===e&&(t.activeFormattingElements.bookmark=o),t.treeAdapter.detachNode(r),t.treeAdapter.appendChild(s,r),r=s)}return r}function yje(t,e){const n=t.treeAdapter.getNamespaceURI(e.element),r=t.treeAdapter.createElement(e.token.tagName,n,e.token.attrs);return t.openElements.replace(e.element,r),e.element=r,r}function xje(t,e,n){const r=t.treeAdapter.getTagName(e),i=K0(r);if(t._isElementCausesFosterParenting(i))t._fosterParentElement(n);else{const a=t.treeAdapter.getNamespaceURI(e);i===$.TEMPLATE&&a===_t.HTML&&(e=t.treeAdapter.getTemplateContent(e)),t.treeAdapter.appendChild(e,n)}}function bje(t,e,n){const r=t.treeAdapter.getNamespaceURI(n.element),{token:i}=n,a=t.treeAdapter.createElement(i.tagName,r,i.attrs);t._adoptNodes(e,a),t.treeAdapter.appendChild(e,a),t.activeFormattingElements.insertElementAfterBookmark(a,i),t.activeFormattingElements.removeEntry(n),t.openElements.remove(n.element),t.openElements.insertAfter(e,a,i.tagID)}function l7(t,e){for(let n=0;n<hje;n++){const r=mje(t,e);if(!r)break;const i=gje(t,r);if(!i)break;t.activeFormattingElements.bookmark=r;const a=vje(t,i,r.element),s=t.openElements.getCommonAncestor(r.element);t.treeAdapter.detachNode(a),s&&xje(t,s,a),bje(t,i,r)}}function tN(t,e){t._appendCommentNode(e,t.openElements.currentTmplContentOrNode)}function _je(t,e){t._appendCommentNode(e,t.openElements.items[0])}function wje(t,e){t._appendCommentNode(e,t.document)}function u7(t,e){if(t.stopped=!0,e.location){const n=t.fragmentContext?0:2;for(let r=t.openElements.stackTop;r>=n;r--)t._setEndLocation(t.openElements.items[r],e);if(!t.fragmentContext&&t.openElements.stackTop>=0){const r=t.openElements.items[0],i=t.treeAdapter.getNodeSourceCodeLocation(r);if(i&&!i.endTag&&(t._setEndLocation(r,e),t.openElements.stackTop>=1)){const a=t.openElements.items[1],s=t.treeAdapter.getNodeSourceCodeLocation(a);s&&!s.endTag&&t._setEndLocation(a,e)}}}}function Sje(t,e){t._setDocumentType(e);const n=e.forceQuirks?ho.QUIRKS:Qze(e);Jze(e)||t._err(e,ct.nonConformingDoctype),t.treeAdapter.setDocumentMode(t.document,n),t.insertionMode=Le.BEFORE_HTML}function sg(t,e){t._err(e,ct.missingDoctype,!0),t.treeAdapter.setDocumentMode(t.document,ho.QUIRKS),t.insertionMode=Le.BEFORE_HTML,t._processToken(e)}function Eje(t,e){e.tagID===$.HTML?(t._insertElement(e,_t.HTML),t.insertionMode=Le.BEFORE_HEAD):Kg(t,e)}function Tje(t,e){const n=e.tagID;(n===$.HTML||n===$.HEAD||n===$.BODY||n===$.BR)&&Kg(t,e)}function Kg(t,e){t._insertFakeRootElement(),t.insertionMode=Le.BEFORE_HEAD,t._processToken(e)}function Cje(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.HEAD:{t._insertElement(e,_t.HTML),t.headElement=t.openElements.current,t.insertionMode=Le.IN_HEAD;break}default:Zg(t,e)}}function Mje(t,e){const n=e.tagID;n===$.HEAD||n===$.BODY||n===$.HTML||n===$.BR?Zg(t,e):t._err(e,ct.endTagWithoutMatchingOpenElement)}function Zg(t,e){t._insertFakeElement(et.HEAD,$.HEAD),t.headElement=t.openElements.current,t.insertionMode=Le.IN_HEAD,t._processToken(e)}function ll(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.BASE:case $.BASEFONT:case $.BGSOUND:case $.LINK:case $.META:{t._appendElement(e,_t.HTML),e.ackSelfClosing=!0;break}case $.TITLE:{t._switchToTextParsing(e,Ei.RCDATA);break}case $.NOSCRIPT:{t.options.scriptingEnabled?t._switchToTextParsing(e,Ei.RAWTEXT):(t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_HEAD_NO_SCRIPT);break}case $.NOFRAMES:case $.STYLE:{t._switchToTextParsing(e,Ei.RAWTEXT);break}case $.SCRIPT:{t._switchToTextParsing(e,Ei.SCRIPT_DATA);break}case $.TEMPLATE:{t._insertTemplate(e),t.activeFormattingElements.insertMarker(),t.framesetOk=!1,t.insertionMode=Le.IN_TEMPLATE,t.tmplInsertionModeStack.unshift(Le.IN_TEMPLATE);break}case $.HEAD:{t._err(e,ct.misplacedStartTagForHeadElement);break}default:Jg(t,e)}}function Aje(t,e){switch(e.tagID){case $.HEAD:{t.openElements.pop(),t.insertionMode=Le.AFTER_HEAD;break}case $.BODY:case $.BR:case $.HTML:{Jg(t,e);break}case $.TEMPLATE:{Sf(t,e);break}default:t._err(e,ct.endTagWithoutMatchingOpenElement)}}function Sf(t,e){t.openElements.tmplCount>0?(t.openElements.generateImpliedEndTagsThoroughly(),t.openElements.currentTagId!==$.TEMPLATE&&t._err(e,ct.closingOfElementWithOpenChildElements),t.openElements.popUntilTagNamePopped($.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode()):t._err(e,ct.endTagWithoutMatchingOpenElement)}function Jg(t,e){t.openElements.pop(),t.insertionMode=Le.AFTER_HEAD,t._processToken(e)}function kje(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.BASEFONT:case $.BGSOUND:case $.HEAD:case $.LINK:case $.META:case $.NOFRAMES:case $.STYLE:{ll(t,e);break}case $.NOSCRIPT:{t._err(e,ct.nestedNoscriptInHead);break}default:Qg(t,e)}}function Ije(t,e){switch(e.tagID){case $.NOSCRIPT:{t.openElements.pop(),t.insertionMode=Le.IN_HEAD;break}case $.BR:{Qg(t,e);break}default:t._err(e,ct.endTagWithoutMatchingOpenElement)}}function Qg(t,e){const n=e.type===Bn.EOF?ct.openElementsLeftAfterEof:ct.disallowedContentInNoscriptInHead;t._err(e,n),t.openElements.pop(),t.insertionMode=Le.IN_HEAD,t._processToken(e)}function Nje(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.BODY:{t._insertElement(e,_t.HTML),t.framesetOk=!1,t.insertionMode=Le.IN_BODY;break}case $.FRAMESET:{t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_FRAMESET;break}case $.BASE:case $.BASEFONT:case $.BGSOUND:case $.LINK:case $.META:case $.NOFRAMES:case $.SCRIPT:case $.STYLE:case $.TEMPLATE:case $.TITLE:{t._err(e,ct.abandonedHeadElementChild),t.openElements.push(t.headElement,$.HEAD),ll(t,e),t.openElements.remove(t.headElement);break}case $.HEAD:{t._err(e,ct.misplacedStartTagForHeadElement);break}default:e1(t,e)}}function Rje(t,e){switch(e.tagID){case $.BODY:case $.HTML:case $.BR:{e1(t,e);break}case $.TEMPLATE:{Sf(t,e);break}default:t._err(e,ct.endTagWithoutMatchingOpenElement)}}function e1(t,e){t._insertFakeElement(et.BODY,$.BODY),t.insertionMode=Le.IN_BODY,E3(t,e)}function E3(t,e){switch(e.type){case Bn.CHARACTER:{fae(t,e);break}case Bn.WHITESPACE_CHARACTER:{hae(t,e);break}case Bn.COMMENT:{tN(t,e);break}case Bn.START_TAG:{ja(t,e);break}case Bn.END_TAG:{T3(t,e);break}case Bn.EOF:{vae(t,e);break}}}function hae(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e)}function fae(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e),t.framesetOk=!1}function Pje(t,e){t.openElements.tmplCount===0&&t.treeAdapter.adoptAttributes(t.openElements.items[0],e.attrs)}function Dje(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t.openElements.tmplCount===0&&(t.framesetOk=!1,t.treeAdapter.adoptAttributes(n,e.attrs))}function Oje(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();t.framesetOk&&n&&(t.treeAdapter.detachNode(n),t.openElements.popAllUpToHtmlElement(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_FRAMESET)}function Lje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML)}function Fje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t.openElements.currentTagId!==void 0&&eN.has(t.openElements.currentTagId)&&t.openElements.pop(),t._insertElement(e,_t.HTML)}function Bje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML),t.skipNextNewLine=!0,t.framesetOk=!1}function Uje(t,e){const n=t.openElements.tmplCount>0;(!t.formElement||n)&&(t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML),n||(t.formElement=t.openElements.current))}function zje(t,e){t.framesetOk=!1;const n=e.tagID;for(let r=t.openElements.stackTop;r>=0;r--){const i=t.openElements.tagIDs[r];if(n===$.LI&&i===$.LI||(n===$.DD||n===$.DT)&&(i===$.DD||i===$.DT)){t.openElements.generateImpliedEndTagsWithExclusion(i),t.openElements.popUntilTagNamePopped(i);break}if(i!==$.ADDRESS&&i!==$.DIV&&i!==$.P&&t._isSpecialElement(t.openElements.items[r],i))break}t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML)}function jje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML),t.tokenizer.state=Ei.PLAINTEXT}function Hje(t,e){t.openElements.hasInScope($.BUTTON)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped($.BUTTON)),t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML),t.framesetOk=!1}function $je(t,e){const n=t.activeFormattingElements.getElementEntryInScopeWithTagName(et.A);n&&(l7(t,e),t.openElements.remove(n.element),t.activeFormattingElements.removeEntry(n)),t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function Vje(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function qje(t,e){t._reconstructActiveFormattingElements(),t.openElements.hasInScope($.NOBR)&&(l7(t,e),t._reconstructActiveFormattingElements()),t._insertElement(e,_t.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function Gje(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML),t.activeFormattingElements.insertMarker(),t.framesetOk=!1}function Wje(t,e){t.treeAdapter.getDocumentMode(t.document)!==ho.QUIRKS&&t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._insertElement(e,_t.HTML),t.framesetOk=!1,t.insertionMode=Le.IN_TABLE}function pae(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,_t.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function mae(t){const e=rae(t,$h.TYPE);return e!=null&&e.toLowerCase()===dje}function Yje(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,_t.HTML),mae(e)||(t.framesetOk=!1),e.ackSelfClosing=!0}function Xje(t,e){t._appendElement(e,_t.HTML),e.ackSelfClosing=!0}function Kje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._appendElement(e,_t.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function Zje(t,e){e.tagName=et.IMG,e.tagID=$.IMG,pae(t,e)}function Jje(t,e){t._insertElement(e,_t.HTML),t.skipNextNewLine=!0,t.tokenizer.state=Ei.RCDATA,t.originalInsertionMode=t.insertionMode,t.framesetOk=!1,t.insertionMode=Le.TEXT}function Qje(t,e){t.openElements.hasInButtonScope($.P)&&t._closePElement(),t._reconstructActiveFormattingElements(),t.framesetOk=!1,t._switchToTextParsing(e,Ei.RAWTEXT)}function eHe(t,e){t.framesetOk=!1,t._switchToTextParsing(e,Ei.RAWTEXT)}function Lj(t,e){t._switchToTextParsing(e,Ei.RAWTEXT)}function tHe(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML),t.framesetOk=!1,t.insertionMode=t.insertionMode===Le.IN_TABLE||t.insertionMode===Le.IN_CAPTION||t.insertionMode===Le.IN_TABLE_BODY||t.insertionMode===Le.IN_ROW||t.insertionMode===Le.IN_CELL?Le.IN_SELECT_IN_TABLE:Le.IN_SELECT}function nHe(t,e){t.openElements.currentTagId===$.OPTION&&t.openElements.pop(),t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML)}function rHe(t,e){t.openElements.hasInScope($.RUBY)&&t.openElements.generateImpliedEndTags(),t._insertElement(e,_t.HTML)}function iHe(t,e){t.openElements.hasInScope($.RUBY)&&t.openElements.generateImpliedEndTagsWithExclusion($.RTC),t._insertElement(e,_t.HTML)}function aHe(t,e){t._reconstructActiveFormattingElements(),uae(e),o7(e),e.selfClosing?t._appendElement(e,_t.MATHML):t._insertElement(e,_t.MATHML),e.ackSelfClosing=!0}function sHe(t,e){t._reconstructActiveFormattingElements(),cae(e),o7(e),e.selfClosing?t._appendElement(e,_t.SVG):t._insertElement(e,_t.SVG),e.ackSelfClosing=!0}function Fj(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,_t.HTML)}function ja(t,e){switch(e.tagID){case $.I:case $.S:case $.B:case $.U:case $.EM:case $.TT:case $.BIG:case $.CODE:case $.FONT:case $.SMALL:case $.STRIKE:case $.STRONG:{Vje(t,e);break}case $.A:{$je(t,e);break}case $.H1:case $.H2:case $.H3:case $.H4:case $.H5:case $.H6:{Fje(t,e);break}case $.P:case $.DL:case $.OL:case $.UL:case $.DIV:case $.DIR:case $.NAV:case $.MAIN:case $.MENU:case $.ASIDE:case $.CENTER:case $.FIGURE:case $.FOOTER:case $.HEADER:case $.HGROUP:case $.DIALOG:case $.DETAILS:case $.ADDRESS:case $.ARTICLE:case $.SEARCH:case $.SECTION:case $.SUMMARY:case $.FIELDSET:case $.BLOCKQUOTE:case $.FIGCAPTION:{Lje(t,e);break}case $.LI:case $.DD:case $.DT:{zje(t,e);break}case $.BR:case $.IMG:case $.WBR:case $.AREA:case $.EMBED:case $.KEYGEN:{pae(t,e);break}case $.HR:{Kje(t,e);break}case $.RB:case $.RTC:{rHe(t,e);break}case $.RT:case $.RP:{iHe(t,e);break}case $.PRE:case $.LISTING:{Bje(t,e);break}case $.XMP:{Qje(t,e);break}case $.SVG:{sHe(t,e);break}case $.HTML:{Pje(t,e);break}case $.BASE:case $.LINK:case $.META:case $.STYLE:case $.TITLE:case $.SCRIPT:case $.BGSOUND:case $.BASEFONT:case $.TEMPLATE:{ll(t,e);break}case $.BODY:{Dje(t,e);break}case $.FORM:{Uje(t,e);break}case $.NOBR:{qje(t,e);break}case $.MATH:{aHe(t,e);break}case $.TABLE:{Wje(t,e);break}case $.INPUT:{Yje(t,e);break}case $.PARAM:case $.TRACK:case $.SOURCE:{Xje(t,e);break}case $.IMAGE:{Zje(t,e);break}case $.BUTTON:{Hje(t,e);break}case $.APPLET:case $.OBJECT:case $.MARQUEE:{Gje(t,e);break}case $.IFRAME:{eHe(t,e);break}case $.SELECT:{tHe(t,e);break}case $.OPTION:case $.OPTGROUP:{nHe(t,e);break}case $.NOEMBED:case $.NOFRAMES:{Lj(t,e);break}case $.FRAMESET:{Oje(t,e);break}case $.TEXTAREA:{Jje(t,e);break}case $.NOSCRIPT:{t.options.scriptingEnabled?Lj(t,e):Fj(t,e);break}case $.PLAINTEXT:{jje(t,e);break}case $.COL:case $.TH:case $.TD:case $.TR:case $.HEAD:case $.FRAME:case $.TBODY:case $.TFOOT:case $.THEAD:case $.CAPTION:case $.COLGROUP:break;default:Fj(t,e)}}function oHe(t,e){if(t.openElements.hasInScope($.BODY)&&(t.insertionMode=Le.AFTER_BODY,t.options.sourceCodeLocationInfo)){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t._setEndLocation(n,e)}}function lHe(t,e){t.openElements.hasInScope($.BODY)&&(t.insertionMode=Le.AFTER_BODY,Tae(t,e))}function uHe(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n))}function cHe(t){const e=t.openElements.tmplCount>0,{formElement:n}=t;e||(t.formElement=null),(n||e)&&t.openElements.hasInScope($.FORM)&&(t.openElements.generateImpliedEndTags(),e?t.openElements.popUntilTagNamePopped($.FORM):n&&t.openElements.remove(n))}function dHe(t){t.openElements.hasInButtonScope($.P)||t._insertFakeElement(et.P,$.P),t._closePElement()}function hHe(t){t.openElements.hasInListItemScope($.LI)&&(t.openElements.generateImpliedEndTagsWithExclusion($.LI),t.openElements.popUntilTagNamePopped($.LI))}function fHe(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTagsWithExclusion(n),t.openElements.popUntilTagNamePopped(n))}function pHe(t){t.openElements.hasNumberedHeaderInScope()&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilNumberedHeaderPopped())}function mHe(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker())}function gHe(t){t._reconstructActiveFormattingElements(),t._insertFakeElement(et.BR,$.BR),t.openElements.pop(),t.framesetOk=!1}function gae(t,e){const n=e.tagName,r=e.tagID;for(let i=t.openElements.stackTop;i>0;i--){const a=t.openElements.items[i],s=t.openElements.tagIDs[i];if(r===s&&(r!==$.UNKNOWN||t.treeAdapter.getTagName(a)===n)){t.openElements.generateImpliedEndTagsWithExclusion(r),t.openElements.stackTop>=i&&t.openElements.shortenToLength(i);break}if(t._isSpecialElement(a,s))break}}function T3(t,e){switch(e.tagID){case $.A:case $.B:case $.I:case $.S:case $.U:case $.EM:case $.TT:case $.BIG:case $.CODE:case $.FONT:case $.NOBR:case $.SMALL:case $.STRIKE:case $.STRONG:{l7(t,e);break}case $.P:{dHe(t);break}case $.DL:case $.UL:case $.OL:case $.DIR:case $.DIV:case $.NAV:case $.PRE:case $.MAIN:case $.MENU:case $.ASIDE:case $.BUTTON:case $.CENTER:case $.FIGURE:case $.FOOTER:case $.HEADER:case $.HGROUP:case $.DIALOG:case $.ADDRESS:case $.ARTICLE:case $.DETAILS:case $.SEARCH:case $.SECTION:case $.SUMMARY:case $.LISTING:case $.FIELDSET:case $.BLOCKQUOTE:case $.FIGCAPTION:{uHe(t,e);break}case $.LI:{hHe(t);break}case $.DD:case $.DT:{fHe(t,e);break}case $.H1:case $.H2:case $.H3:case $.H4:case $.H5:case $.H6:{pHe(t);break}case $.BR:{gHe(t);break}case $.BODY:{oHe(t,e);break}case $.HTML:{lHe(t,e);break}case $.FORM:{cHe(t);break}case $.APPLET:case $.OBJECT:case $.MARQUEE:{mHe(t,e);break}case $.TEMPLATE:{Sf(t,e);break}default:gae(t,e)}}function vae(t,e){t.tmplInsertionModeStack.length>0?Eae(t,e):u7(t,e)}function vHe(t,e){var n;e.tagID===$.SCRIPT&&((n=t.scriptHandler)===null||n===void 0||n.call(t,t.openElements.current)),t.openElements.pop(),t.insertionMode=t.originalInsertionMode}function yHe(t,e){t._err(e,ct.eofInElementThatCanContainOnlyText),t.openElements.pop(),t.insertionMode=t.originalInsertionMode,t.onEof(e)}function jT(t,e){if(t.openElements.currentTagId!==void 0&&dae.has(t.openElements.currentTagId))switch(t.pendingCharacterTokens.length=0,t.hasNonWhitespacePendingCharacterToken=!1,t.originalInsertionMode=t.insertionMode,t.insertionMode=Le.IN_TABLE_TEXT,e.type){case Bn.CHARACTER:{xae(t,e);break}case Bn.WHITESPACE_CHARACTER:{yae(t,e);break}}else Bv(t,e)}function xHe(t,e){t.openElements.clearBackToTableContext(),t.activeFormattingElements.insertMarker(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_CAPTION}function bHe(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_COLUMN_GROUP}function _He(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(et.COLGROUP,$.COLGROUP),t.insertionMode=Le.IN_COLUMN_GROUP,c7(t,e)}function wHe(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_TABLE_BODY}function SHe(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(et.TBODY,$.TBODY),t.insertionMode=Le.IN_TABLE_BODY,C3(t,e)}function EHe(t,e){t.openElements.hasInTableScope($.TABLE)&&(t.openElements.popUntilTagNamePopped($.TABLE),t._resetInsertionMode(),t._processStartTag(e))}function THe(t,e){mae(e)?t._appendElement(e,_t.HTML):Bv(t,e),e.ackSelfClosing=!0}function CHe(t,e){!t.formElement&&t.openElements.tmplCount===0&&(t._insertElement(e,_t.HTML),t.formElement=t.openElements.current,t.openElements.pop())}function C0(t,e){switch(e.tagID){case $.TD:case $.TH:case $.TR:{SHe(t,e);break}case $.STYLE:case $.SCRIPT:case $.TEMPLATE:{ll(t,e);break}case $.COL:{_He(t,e);break}case $.FORM:{CHe(t,e);break}case $.TABLE:{EHe(t,e);break}case $.TBODY:case $.TFOOT:case $.THEAD:{wHe(t,e);break}case $.INPUT:{THe(t,e);break}case $.CAPTION:{xHe(t,e);break}case $.COLGROUP:{bHe(t,e);break}default:Bv(t,e)}}function X1(t,e){switch(e.tagID){case $.TABLE:{t.openElements.hasInTableScope($.TABLE)&&(t.openElements.popUntilTagNamePopped($.TABLE),t._resetInsertionMode());break}case $.TEMPLATE:{Sf(t,e);break}case $.BODY:case $.CAPTION:case $.COL:case $.COLGROUP:case $.HTML:case $.TBODY:case $.TD:case $.TFOOT:case $.TH:case $.THEAD:case $.TR:break;default:Bv(t,e)}}function Bv(t,e){const n=t.fosterParentingEnabled;t.fosterParentingEnabled=!0,E3(t,e),t.fosterParentingEnabled=n}function yae(t,e){t.pendingCharacterTokens.push(e)}function xae(t,e){t.pendingCharacterTokens.push(e),t.hasNonWhitespacePendingCharacterToken=!0}function og(t,e){let n=0;if(t.hasNonWhitespacePendingCharacterToken)for(;n<t.pendingCharacterTokens.length;n++)Bv(t,t.pendingCharacterTokens[n]);else for(;n<t.pendingCharacterTokens.length;n++)t._insertCharacters(t.pendingCharacterTokens[n]);t.insertionMode=t.originalInsertionMode,t._processToken(e)}const bae=new Set([$.CAPTION,$.COL,$.COLGROUP,$.TBODY,$.TD,$.TFOOT,$.TH,$.THEAD,$.TR]);function MHe(t,e){const n=e.tagID;bae.has(n)?t.openElements.hasInTableScope($.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped($.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=Le.IN_TABLE,C0(t,e)):ja(t,e)}function AHe(t,e){const n=e.tagID;switch(n){case $.CAPTION:case $.TABLE:{t.openElements.hasInTableScope($.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped($.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=Le.IN_TABLE,n===$.TABLE&&X1(t,e));break}case $.BODY:case $.COL:case $.COLGROUP:case $.HTML:case $.TBODY:case $.TD:case $.TFOOT:case $.TH:case $.THEAD:case $.TR:break;default:T3(t,e)}}function c7(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.COL:{t._appendElement(e,_t.HTML),e.ackSelfClosing=!0;break}case $.TEMPLATE:{ll(t,e);break}default:Lw(t,e)}}function kHe(t,e){switch(e.tagID){case $.COLGROUP:{t.openElements.currentTagId===$.COLGROUP&&(t.openElements.pop(),t.insertionMode=Le.IN_TABLE);break}case $.TEMPLATE:{Sf(t,e);break}case $.COL:break;default:Lw(t,e)}}function Lw(t,e){t.openElements.currentTagId===$.COLGROUP&&(t.openElements.pop(),t.insertionMode=Le.IN_TABLE,t._processToken(e))}function C3(t,e){switch(e.tagID){case $.TR:{t.openElements.clearBackToTableBodyContext(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_ROW;break}case $.TH:case $.TD:{t.openElements.clearBackToTableBodyContext(),t._insertFakeElement(et.TR,$.TR),t.insertionMode=Le.IN_ROW,M3(t,e);break}case $.CAPTION:case $.COL:case $.COLGROUP:case $.TBODY:case $.TFOOT:case $.THEAD:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE,C0(t,e));break}default:C0(t,e)}}function nN(t,e){const n=e.tagID;switch(e.tagID){case $.TBODY:case $.TFOOT:case $.THEAD:{t.openElements.hasInTableScope(n)&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE);break}case $.TABLE:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE,X1(t,e));break}case $.BODY:case $.CAPTION:case $.COL:case $.COLGROUP:case $.HTML:case $.TD:case $.TH:case $.TR:break;default:X1(t,e)}}function M3(t,e){switch(e.tagID){case $.TH:case $.TD:{t.openElements.clearBackToTableRowContext(),t._insertElement(e,_t.HTML),t.insertionMode=Le.IN_CELL,t.activeFormattingElements.insertMarker();break}case $.CAPTION:case $.COL:case $.COLGROUP:case $.TBODY:case $.TFOOT:case $.THEAD:case $.TR:{t.openElements.hasInTableScope($.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE_BODY,C3(t,e));break}default:C0(t,e)}}function _ae(t,e){switch(e.tagID){case $.TR:{t.openElements.hasInTableScope($.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE_BODY);break}case $.TABLE:{t.openElements.hasInTableScope($.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE_BODY,nN(t,e));break}case $.TBODY:case $.TFOOT:case $.THEAD:{(t.openElements.hasInTableScope(e.tagID)||t.openElements.hasInTableScope($.TR))&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=Le.IN_TABLE_BODY,nN(t,e));break}case $.BODY:case $.CAPTION:case $.COL:case $.COLGROUP:case $.HTML:case $.TD:case $.TH:break;default:X1(t,e)}}function IHe(t,e){const n=e.tagID;bae.has(n)?(t.openElements.hasInTableScope($.TD)||t.openElements.hasInTableScope($.TH))&&(t._closeTableCell(),M3(t,e)):ja(t,e)}function NHe(t,e){const n=e.tagID;switch(n){case $.TD:case $.TH:{t.openElements.hasInTableScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=Le.IN_ROW);break}case $.TABLE:case $.TBODY:case $.TFOOT:case $.THEAD:case $.TR:{t.openElements.hasInTableScope(n)&&(t._closeTableCell(),_ae(t,e));break}case $.BODY:case $.CAPTION:case $.COL:case $.COLGROUP:case $.HTML:break;default:T3(t,e)}}function wae(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.OPTION:{t.openElements.currentTagId===$.OPTION&&t.openElements.pop(),t._insertElement(e,_t.HTML);break}case $.OPTGROUP:{t.openElements.currentTagId===$.OPTION&&t.openElements.pop(),t.openElements.currentTagId===$.OPTGROUP&&t.openElements.pop(),t._insertElement(e,_t.HTML);break}case $.HR:{t.openElements.currentTagId===$.OPTION&&t.openElements.pop(),t.openElements.currentTagId===$.OPTGROUP&&t.openElements.pop(),t._appendElement(e,_t.HTML),e.ackSelfClosing=!0;break}case $.INPUT:case $.KEYGEN:case $.TEXTAREA:case $.SELECT:{t.openElements.hasInSelectScope($.SELECT)&&(t.openElements.popUntilTagNamePopped($.SELECT),t._resetInsertionMode(),e.tagID!==$.SELECT&&t._processStartTag(e));break}case $.SCRIPT:case $.TEMPLATE:{ll(t,e);break}}}function Sae(t,e){switch(e.tagID){case $.OPTGROUP:{t.openElements.stackTop>0&&t.openElements.currentTagId===$.OPTION&&t.openElements.tagIDs[t.openElements.stackTop-1]===$.OPTGROUP&&t.openElements.pop(),t.openElements.currentTagId===$.OPTGROUP&&t.openElements.pop();break}case $.OPTION:{t.openElements.currentTagId===$.OPTION&&t.openElements.pop();break}case $.SELECT:{t.openElements.hasInSelectScope($.SELECT)&&(t.openElements.popUntilTagNamePopped($.SELECT),t._resetInsertionMode());break}case $.TEMPLATE:{Sf(t,e);break}}}function RHe(t,e){const n=e.tagID;n===$.CAPTION||n===$.TABLE||n===$.TBODY||n===$.TFOOT||n===$.THEAD||n===$.TR||n===$.TD||n===$.TH?(t.openElements.popUntilTagNamePopped($.SELECT),t._resetInsertionMode(),t._processStartTag(e)):wae(t,e)}function PHe(t,e){const n=e.tagID;n===$.CAPTION||n===$.TABLE||n===$.TBODY||n===$.TFOOT||n===$.THEAD||n===$.TR||n===$.TD||n===$.TH?t.openElements.hasInTableScope(n)&&(t.openElements.popUntilTagNamePopped($.SELECT),t._resetInsertionMode(),t.onEndTag(e)):Sae(t,e)}function DHe(t,e){switch(e.tagID){case $.BASE:case $.BASEFONT:case $.BGSOUND:case $.LINK:case $.META:case $.NOFRAMES:case $.SCRIPT:case $.STYLE:case $.TEMPLATE:case $.TITLE:{ll(t,e);break}case $.CAPTION:case $.COLGROUP:case $.TBODY:case $.TFOOT:case $.THEAD:{t.tmplInsertionModeStack[0]=Le.IN_TABLE,t.insertionMode=Le.IN_TABLE,C0(t,e);break}case $.COL:{t.tmplInsertionModeStack[0]=Le.IN_COLUMN_GROUP,t.insertionMode=Le.IN_COLUMN_GROUP,c7(t,e);break}case $.TR:{t.tmplInsertionModeStack[0]=Le.IN_TABLE_BODY,t.insertionMode=Le.IN_TABLE_BODY,C3(t,e);break}case $.TD:case $.TH:{t.tmplInsertionModeStack[0]=Le.IN_ROW,t.insertionMode=Le.IN_ROW,M3(t,e);break}default:t.tmplInsertionModeStack[0]=Le.IN_BODY,t.insertionMode=Le.IN_BODY,ja(t,e)}}function OHe(t,e){e.tagID===$.TEMPLATE&&Sf(t,e)}function Eae(t,e){t.openElements.tmplCount>0?(t.openElements.popUntilTagNamePopped($.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode(),t.onEof(e)):u7(t,e)}function LHe(t,e){e.tagID===$.HTML?ja(t,e):Fw(t,e)}function Tae(t,e){var n;if(e.tagID===$.HTML){if(t.fragmentContext||(t.insertionMode=Le.AFTER_AFTER_BODY),t.options.sourceCodeLocationInfo&&t.openElements.tagIDs[0]===$.HTML){t._setEndLocation(t.openElements.items[0],e);const r=t.openElements.items[1];r&&!(!((n=t.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&t._setEndLocation(r,e)}}else Fw(t,e)}function Fw(t,e){t.insertionMode=Le.IN_BODY,E3(t,e)}function FHe(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.FRAMESET:{t._insertElement(e,_t.HTML);break}case $.FRAME:{t._appendElement(e,_t.HTML),e.ackSelfClosing=!0;break}case $.NOFRAMES:{ll(t,e);break}}}function BHe(t,e){e.tagID===$.FRAMESET&&!t.openElements.isRootHtmlElementCurrent()&&(t.openElements.pop(),!t.fragmentContext&&t.openElements.currentTagId!==$.FRAMESET&&(t.insertionMode=Le.AFTER_FRAMESET))}function UHe(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.NOFRAMES:{ll(t,e);break}}}function zHe(t,e){e.tagID===$.HTML&&(t.insertionMode=Le.AFTER_AFTER_FRAMESET)}function jHe(t,e){e.tagID===$.HTML?ja(t,e):Xb(t,e)}function Xb(t,e){t.insertionMode=Le.IN_BODY,E3(t,e)}function HHe(t,e){switch(e.tagID){case $.HTML:{ja(t,e);break}case $.NOFRAMES:{ll(t,e);break}}}function $He(t,e){e.chars=Xr,t._insertCharacters(e)}function VHe(t,e){t._insertCharacters(e),t.framesetOk=!1}function Cae(t){for(;t.treeAdapter.getNamespaceURI(t.openElements.current)!==_t.HTML&&t.openElements.currentTagId!==void 0&&!t._isIntegrationPoint(t.openElements.currentTagId,t.openElements.current);)t.openElements.pop()}function qHe(t,e){if(sje(e))Cae(t),t._startTagOutsideForeignContent(e);else{const n=t._getAdjustedCurrentElement(),r=t.treeAdapter.getNamespaceURI(n);r===_t.MATHML?uae(e):r===_t.SVG&&(oje(e),cae(e)),o7(e),e.selfClosing?t._appendElement(e,r):t._insertElement(e,r),e.ackSelfClosing=!0}}function GHe(t,e){if(e.tagID===$.P||e.tagID===$.BR){Cae(t),t._endTagOutsideForeignContent(e);return}for(let n=t.openElements.stackTop;n>0;n--){const r=t.openElements.items[n];if(t.treeAdapter.getNamespaceURI(r)===_t.HTML){t._endTagOutsideForeignContent(e);break}const i=t.treeAdapter.getTagName(r);if(i.toLowerCase()===e.tagName){e.tagName=i,t.openElements.shortenToLength(n);break}}}et.AREA,et.BASE,et.BASEFONT,et.BGSOUND,et.BR,et.COL,et.EMBED,et.FRAME,et.HR,et.IMG,et.INPUT,et.KEYGEN,et.LINK,et.META,et.PARAM,et.SOURCE,et.TRACK,et.WBR;const WHe=/<(\/?)(iframe|noembed|noframes|plaintext|script|style|textarea|title|xmp)(?=[\t\n\f\r />])/gi,YHe=new Set(["mdxFlowExpression","mdxJsxFlowElement","mdxJsxTextElement","mdxTextExpression","mdxjsEsm"]),Bj={sourceCodeLocationInfo:!0,scriptingEnabled:!1};function Mae(t,e){const n=i$e(t),r=bre("type",{handlers:{root:XHe,element:KHe,text:ZHe,comment:kae,doctype:JHe,raw:e$e},unknown:t$e}),i={parser:n?new Oj(Bj):Oj.getFragmentParser(void 0,Bj),handle(o){r(o,i)},stitches:!1,options:e||{}};r(t,i),Z0(i,Xl());const a=n?i.parser.document:i.parser.getFragment(),s=aze(a,{file:i.options.file});return i.stitches&&v3(s,"comment",function(o,l,u){const c=o;if(c.value.stitch&&u&&l!==void 0){const d=u.children;return d[l]=c.value.stitch,l}}),s.type==="root"&&s.children.length===1&&s.children[0].type===t.type?s.children[0]:s}function Aae(t,e){let n=-1;if(t)for(;++n<t.length;)e.handle(t[n])}function XHe(t,e){Aae(t.children,e)}function KHe(t,e){n$e(t,e),Aae(t.children,e),r$e(t,e)}function ZHe(t,e){e.parser.tokenizer.state>4&&(e.parser.tokenizer.state=0);const n={type:Bn.CHARACTER,chars:t.value,location:Uv(t)};Z0(e,Xl(t)),e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)}function JHe(t,e){const n={type:Bn.DOCTYPE,name:"html",forceQuirks:!1,publicId:"",systemId:"",location:Uv(t)};Z0(e,Xl(t)),e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)}function QHe(t,e){e.stitches=!0;const n=a$e(t);if("children"in t&&"children"in n){const r=Mae({type:"root",children:t.children},e.options);n.children=r.children}kae({type:"comment",value:{stitch:n}},e)}function kae(t,e){const n=t.value,r={type:Bn.COMMENT,data:n,location:Uv(t)};Z0(e,Xl(t)),e.parser.currentToken=r,e.parser._processToken(e.parser.currentToken)}function e$e(t,e){if(e.parser.tokenizer.preprocessor.html="",e.parser.tokenizer.preprocessor.pos=-1,e.parser.tokenizer.preprocessor.lastGapPos=-2,e.parser.tokenizer.preprocessor.gapStack=[],e.parser.tokenizer.preprocessor.skipNextNewLine=!1,e.parser.tokenizer.preprocessor.lastChunkWritten=!1,e.parser.tokenizer.preprocessor.endOfChunkHit=!1,e.parser.tokenizer.preprocessor.isEol=!1,Iae(e,Xl(t)),e.parser.tokenizer.write(e.options.tagfilter?t.value.replace(WHe,"&lt;$1$2"):t.value,!1),e.parser.tokenizer._runParsingLoop(),e.parser.tokenizer.state===72||e.parser.tokenizer.state===78){e.parser.tokenizer.preprocessor.lastChunkWritten=!0;const n=e.parser.tokenizer._consume();e.parser.tokenizer._callState(n)}}function t$e(t,e){const n=t;if(e.options.passThrough&&e.options.passThrough.includes(n.type))QHe(n,e);else{let r="";throw YHe.has(n.type)&&(r=". It looks like you are using MDX nodes with `hast-util-raw` (or `rehype-raw`). If you use this because you are using remark or rehype plugins that inject `'html'` nodes, then please raise an issue with that plugin, as its a bad and slow idea. If you use this because you are using markdown syntax, then you have to configure this utility (or plugin) to pass through these nodes (see `passThrough` in docs), but you can also migrate to use the MDX syntax"),new Error("Cannot compile `"+n.type+"` node"+r)}}function Z0(t,e){Iae(t,e);const n=t.parser.tokenizer.currentCharacterToken;n&&n.location&&(n.location.endLine=t.parser.tokenizer.preprocessor.line,n.location.endCol=t.parser.tokenizer.preprocessor.col+1,n.location.endOffset=t.parser.tokenizer.preprocessor.offset+1,t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)),t.parser.tokenizer.paused=!1,t.parser.tokenizer.inLoop=!1,t.parser.tokenizer.active=!1,t.parser.tokenizer.returnState=Ei.DATA,t.parser.tokenizer.charRefCode=-1,t.parser.tokenizer.consumedAfterSnapshot=-1,t.parser.tokenizer.currentLocation=null,t.parser.tokenizer.currentCharacterToken=null,t.parser.tokenizer.currentToken=null,t.parser.tokenizer.currentAttr={name:"",value:""}}function Iae(t,e){if(e&&e.offset!==void 0){const n={startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:-1,endCol:-1,endOffset:-1};t.parser.tokenizer.preprocessor.lineStartPos=-e.column+1,t.parser.tokenizer.preprocessor.droppedBufferSize=e.offset,t.parser.tokenizer.preprocessor.line=e.line,t.parser.tokenizer.currentLocation=n}}function n$e(t,e){const n=t.tagName.toLowerCase();if(e.parser.tokenizer.state===Ei.PLAINTEXT)return;Z0(e,Xl(t));const r=e.parser.openElements.current;let i="namespaceURI"in r?r.namespaceURI:Ol.html;i===Ol.html&&n==="svg"&&(i=Ol.svg);const a=cze({...t,children:[]},{space:i===Ol.svg?"svg":"html"}),s={type:Bn.START_TAG,tagName:n,tagID:K0(n),selfClosing:!1,ackSelfClosing:!1,attrs:"attrs"in a?a.attrs:[],location:Uv(t)};e.parser.currentToken=s,e.parser._processToken(e.parser.currentToken),e.parser.tokenizer.lastStartTagName=n}function r$e(t,e){const n=t.tagName.toLowerCase();if(!e.parser.tokenizer.inForeignNode&&yze.includes(n)||e.parser.tokenizer.state===Ei.PLAINTEXT)return;Z0(e,h3(t));const r={type:Bn.END_TAG,tagName:n,tagID:K0(n),selfClosing:!1,ackSelfClosing:!1,attrs:[],location:Uv(t)};e.parser.currentToken=r,e.parser._processToken(e.parser.currentToken),n===e.parser.tokenizer.lastStartTagName&&(e.parser.tokenizer.state===Ei.RCDATA||e.parser.tokenizer.state===Ei.RAWTEXT||e.parser.tokenizer.state===Ei.SCRIPT_DATA)&&(e.parser.tokenizer.state=Ei.DATA)}function i$e(t){const e=t.type==="root"?t.children[0]:t;return!!(e&&(e.type==="doctype"||e.type==="element"&&e.tagName.toLowerCase()==="html"))}function Uv(t){const e=Xl(t)||{line:void 0,column:void 0,offset:void 0},n=h3(t)||{line:void 0,column:void 0,offset:void 0};return{startLine:e.line,startCol:e.column,startOffset:e.offset,endLine:n.line,endCol:n.column,endOffset:n.offset}}function a$e(t){return"children"in t?E0({...t,children:[]}):E0(t)}function Nae(t){return function(e,n){return Mae(e,{...t,file:n})}}function s$e({aiConfig:t,initialOpen:e=!1}){const[n,r]=P.useState(e),[i,a]=P.useState(!1),[s,o]=P.useState({x:0,y:0}),[l,u]=P.useState({x:0,y:0}),c=P.useRef(null),d=P.useRef(null),{messages:h,input:f,setInput:m,status:x,error:b,sendMessage:y,clearChat:w,stop:_,isConfigured:S}=e7e({aiConfig:t,systemPrompt:t7e,onError:k=>{w0.error("AI Floating Panel Error:",k)}});P.useEffect(()=>{if(typeof window<"u"){const k=()=>{o({x:window.innerWidth-420,y:window.innerHeight-(n?640:80)})};return k(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}}},[n]),P.useEffect(()=>{n&&d.current&&d.current.scrollIntoView({behavior:"smooth"})},[h,n]);const M=P.useCallback(k=>{const I=k.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.tagName==="BUTTON"||(a(!0),u({x:k.clientX-s.x,y:k.clientY-s.y}))},[s]),E=P.useRef(n);P.useEffect(()=>{E.current=n},[n]),P.useEffect(()=>{if(!i)return;const k=N=>{const D=N.clientX-l.x,F=N.clientY-l.y,L=window.innerWidth-(E.current?400:64),U=window.innerHeight-(E.current?600:64);o({x:Math.max(10,Math.min(D,L)),y:Math.max(10,Math.min(F,U))})},I=()=>{a(!1)};return document.addEventListener("mousemove",k),document.addEventListener("mouseup",I),()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",I)}},[i,l]);const C=P.useCallback(()=>{if(f.trim()&&x!=="streaming"&&x!=="loading"){if(!Nne(f,NI.MAX_MESSAGE_LENGTH)){w0.warn(`Message too long (max ${NI.MAX_MESSAGE_LENGTH} chars)`);return}y()}},[f,x,y]),R=P.useCallback(k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),C())},[C]);return S?n?g.jsx("div",{ref:c,className:"fixed z-50 flex flex-col",style:{left:s.x,top:s.y,width:"400px",height:"600px"},children:g.jsxs("div",{className:"rounded-2xl bg-[#1a1d2e]/98 backdrop-blur-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col h-full",children:[g.jsxs("div",{className:`px-5 py-4 border-b border-white/8 bg-gradient-to-b from-white/[0.02] to-transparent flex items-center justify-between ${i?"cursor-grabbing":"cursor-grab"}`,onMouseDown:M,children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600/20 to-purple-600/20 border border-blue-500/30 flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-sm font-semibold text-gray-100",children:"AI 助手"}),g.jsxs("p",{className:"text-xs text-gray-500",children:[t?.provider," · ",t?.model]})]})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[h.length>0&&g.jsx("button",{onClick:w,className:"p-2 hover:bg-white/5 rounded-lg transition-colors",title:"清空对话",children:g.jsx("svg",{className:"w-4 h-4 text-gray-500 hover:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),g.jsx("button",{onClick:()=>r(!1),className:"p-2 hover:bg-white/5 rounded-lg transition-colors",title:"最小化",children:g.jsx("svg",{className:"w-4 h-4 text-gray-500 hover:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[h.length===0&&g.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500 px-4",children:[g.jsx("svg",{className:"w-16 h-16 text-gray-600 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),g.jsx("p",{className:"text-sm",children:"开始与 AI 对话"}),g.jsx("p",{className:"text-xs mt-2 text-gray-600",children:"我可以帮助你整理思路、分析论点、提供建议"})]}),h.map(k=>g.jsx("div",{className:`flex ${k.role==="user"?"justify-end":"justify-start"}`,children:g.jsx("div",{className:`max-w-[85%] rounded-lg px-4 py-3 ${k.role==="user"?"bg-blue-600/20 border border-blue-500/30 text-gray-100":"bg-white/5 border border-white/10 text-gray-200"}`,children:k.role==="assistant"?g.jsx("div",{className:`prose prose-invert prose-sm max-w-none
                                prose-p:text-gray-200 prose-p:leading-relaxed prose-p:my-2
                                prose-headings:text-gray-100 prose-headings:font-semibold
                                prose-code:text-blue-300 prose-code:bg-blue-500/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:border prose-code:border-blue-500/20
                                prose-pre:bg-gray-900/90 prose-pre:border prose-pre:border-white/5 prose-pre:text-sm
                                prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline
                                prose-strong:text-gray-100
                                prose-ul:text-gray-200 prose-ol:text-gray-200 prose-li:text-gray-200`,children:g.jsx(pre,{remarkPlugins:[jre,Uie,zie],rehypePlugins:[Kie,Nae],children:k.content})}):g.jsx("p",{className:"text-sm whitespace-pre-wrap",children:k.content})})},k.id)),b&&g.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg px-4 py-3 text-red-300 text-sm",children:[g.jsx("p",{className:"font-semibold mb-1",children:"错误"}),g.jsx("p",{children:b.message})]}),g.jsx("div",{ref:d})]}),g.jsxs("div",{className:"px-5 py-4 border-t border-white/8 bg-white/[0.01]",children:[g.jsxs("div",{className:"flex items-end gap-2",children:[g.jsx("textarea",{value:f,onChange:k=>m(k.target.value),onKeyDown:R,placeholder:"输入消息... (Enter 发送, Shift+Enter 换行)",className:`flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-gray-200 text-sm 
                       focus:outline-none focus:border-blue-400/50 focus:ring-2 focus:ring-blue-400/10 
                       placeholder-gray-600 resize-none transition-all`,rows:1,style:{maxHeight:"120px"},disabled:x==="streaming"||x==="loading"}),x==="streaming"?g.jsx("button",{onClick:_,className:`p-3 bg-red-600/20 hover:bg-red-600/30 border border-red-500/30 rounded-lg 
                         text-red-300 transition-colors shrink-0`,title:"停止生成",children:g.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})})}):g.jsx("button",{onClick:C,disabled:!f.trim()||x==="loading",className:`p-3 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 rounded-lg 
                         text-blue-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0`,title:"发送消息",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),x==="streaming"&&g.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center gap-2",children:[g.jsx("span",{className:"inline-block w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),"AI 正在思考..."]})]})]})}):g.jsx("div",{ref:c,className:"fixed z-50 cursor-grab active:cursor-grabbing",style:{left:s.x,top:s.y},onMouseDown:M,children:g.jsx("button",{onClick:()=>r(!0),className:`w-14 h-14 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 
                     text-white flex items-center justify-center shadow-2xl transition-all hover:scale-110`,title:"打开 AI 助手",children:g.jsx("svg",{className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})}):g.jsx("div",{className:"fixed z-50",style:{left:s.x,top:s.y},children:g.jsx("div",{className:"bg-gray-800 text-gray-400 px-4 py-2 rounded-lg shadow-lg text-sm",children:"AI 未配置"})})}class o$e{cache=new Map;globalVersion=0;invalidate(){this.globalVersion++}clear(e){this.cache.delete(e)}clearAll(){this.cache.clear(),this.globalVersion++}get(e){const n=this.cache.get(e);return n?n.score:null}set(e,n,r,i){this.cache.set(e,{score:n,memoryVersion:this.globalVersion,memoryText:r.text,relationCount:i})}isValid(e,n,r){const i=this.cache.get(e);return!(!i||i.memoryVersion!==this.globalVersion||i.memoryText!==n.text||i.relationCount!==r)}getStats(){return{size:this.cache.size,globalVersion:this.globalVersion,hitRate:0}}}const Kb=new o$e;function l$e(t,e,n){const r=e.filter(a=>a.fromId===t.id||a.toId===t.id).length;if(Kb.isValid(t.id,t,r)){const a=Kb.get(t.id);if(a)return a}const i=n(t,e);return Kb.set(t.id,i,t,r),i}function u$e(t){return t.date instanceof Date?t:{...t,date:new Date(t.date)}}function c$e(t,e,n=c2.DEFAULT_WEIGHTS){t=u$e(t);const r=d$e(t),i=h$e(t),a=f$e(t),s=p$e(t,e),o=m$e(t);return{total:r*n.recency+i*n.revisit+a*n.depth+s*n.connectivity+o*n.actionability,recency:r,revisit:i,depth:a,connectivity:s,actionability:o}}function d$e(t){const e=Date.now(),n=t.date.getTime(),r=(e-n)/u2.ONE_DAY_MS,i=Math.exp(-r/30);return Math.min(Math.max(i,0),1)}function h$e(t){const e=t.visitCount||0,n=c2.NORMALIZATION_FACTORS.revisitCount;return Math.min(e/n,1)}function f$e(t){const e=t.editCount||0,n=c2.NORMALIZATION_FACTORS.editCount;return Math.min(e/n,1)}function p$e(t,e){const n=e.filter(i=>i.fromId===t.id||i.toId===t.id).length,r=c2.NORMALIZATION_FACTORS.connectionCount;return Math.min(n/r,1)}function m$e(t){return t.actionability?1:0}function g$e(t=[],e=[],n=!0){const r=new Date,i=new Map,a=u2.TIMELINE_DAYS;for(let s=0;s<a;s++){const o=new Date(r);o.setDate(o.getDate()-s);const l=o.getFullYear(),u=o.getMonth()+1,c=o.getDate(),d=s===0,h=t.filter(_=>jh(new Date(_.date),o)),f=h.length;let m=0;const x=[];if(h.length>0&&n)for(const _ of h){const S=l$e(_,e,c$e);x.push(S),S.total>m&&(m=S.total)}const b=`${l}-${u}`;i.has(b)||i.set(b,{year:l,month:u,label:u===r.getMonth()+1&&l===r.getFullYear()?`${u}月`:`${l}年${u}月`,days:[],sortedDays:[],totalMemories:0});const y=i.get(b),w={date:o,day:c,month:u,year:l,isToday:d,hasMemory:f>0,memoryCount:f,topActivationScore:m,activationScores:x};y.days.push(w),y.sortedDays.push(w),y.totalMemories+=f}for(const s of i.values())s.sortedDays=s.days.filter(o=>o.hasMemory).sort((o,l)=>l.day-o.day);return Array.from(i.values()).sort((s,o)=>s.year!==o.year?o.year-s.year:o.month-s.month)}function v$e({children:t,onClick:e,className:n,title:r}){return g.jsx("div",{className:"dock-item-container relative flex items-center justify-center w-full my-1",children:g.jsx("button",{onClick:e,title:r,className:`dock-item transition-all duration-75 ease-out ${n||""}`,style:{willChange:"transform",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased",transform:"translateZ(0)"},children:t})})}function y$e({memories:t=[],relations:e=[],onDateSelect:n,selectedDate:r,useActivationSort:i=!0}){const a=P.useMemo(()=>(Kb.invalidate(),g$e(t,e,i)),[t,e,i]),[s,o]=P.useState(()=>{const h=new Date;return new Set([`${h.getFullYear()}-${h.getMonth()+1}`])}),l=(h,f)=>{const m=`${h}-${f}`;o(x=>{const b=new Set(x);return b.has(m)?b.delete(m):b.add(m),b})},u=h=>{const m=h.currentTarget.querySelectorAll(".dock-item"),x=h.clientY,b=120,y=1.5;m.forEach(w=>{const _=w.getBoundingClientRect(),S=_.top+_.height/2,M=Math.abs(x-S);let E=1;if(M<b){const C=M/b,R=Math.exp(-3*C*C);E=1+(y-1)*R}w.style.transform=`scale(${E}) translateZ(0)`,w.style.zIndex=E>1.1?"10":"1"})},c=h=>{h.currentTarget.querySelectorAll(".dock-item").forEach(x=>{x.style.transform="scale(1) translateZ(0)",x.style.zIndex="1"})},d=()=>{const h=new Date;n?.(h);const f=`${h.getFullYear()}-${h.getMonth()+1}`;o(x=>{const b=new Set(x);return b.add(f),b});const m=document.querySelector(".timeline-scroll-container");m&&(m.scrollTop=0)};return g.jsxs("div",{className:"h-full w-full flex flex-col bg-gradient-to-r from-black/60 to-transparent backdrop-blur-md border-r border-white/5",children:[g.jsx("div",{className:"flex-none flex flex-col items-center border-b border-white/5 bg-black/30 backdrop-blur-md z-20 py-3",children:g.jsx("button",{onClick:d,className:"group relative flex flex-col items-center gap-1 transition-transform active:scale-95",title:"回到今天",children:g.jsx("div",{className:`
            w-10 h-10 rounded-full flex items-center justify-center 
            ${jh(r||new Date,new Date)?"bg-white/10 border-white/20 text-gray-100":"bg-white/5 hover:bg-white/10 border-white/10 text-gray-300"}
            backdrop-blur-sm border
            transition-all duration-200
          `,children:g.jsx("span",{className:"text-[11px] font-medium tracking-wide",children:"今天"})})})}),g.jsx("div",{className:"flex-1 w-full overflow-y-auto hide-scrollbar timeline-scroll-container pb-8",onMouseMove:u,onMouseLeave:c,children:g.jsx("div",{className:"flex flex-col items-center py-3 gap-3",children:a.map(h=>{const f=`${h.year}-${h.month}`,m=s.has(f);return g.jsxs("div",{className:"flex flex-col items-center w-full",children:[g.jsxs("button",{onClick:()=>l(h.year,h.month),className:`
                      group relative px-2 py-1 mb-2.5
                      transition-all duration-300
                      text-[10px] font-medium tracking-widest uppercase
                      ${m?"text-gray-300":"text-gray-600 hover:text-gray-400"}
                    `,children:[h.month," 月"]}),m&&g.jsx("div",{className:"flex flex-col items-center w-full gap-2.5",children:h.sortedDays.length>0?h.sortedDays.map(x=>{const b=r&&jh(r,x.date),w=(S=>{if(S===0)return null;const M=S<=3?2:S<=9?3:4,E=S<=3?.45:S<=9?.55:.65;return{size:M,opacity:E}})(x.memoryCount),_=x.isToday?`今天 · ${x.memoryCount>0?`${x.memoryCount} 条记忆`:"暂无记忆"}`:x.memoryCount>0?`${x.month}月${x.day}日 · ${x.memoryCount} 条记忆`:`${x.month}月${x.day}日`;return g.jsxs(v$e,{onClick:()=>n?.(x.date),title:_,className:`
                                relative w-9 h-9 rounded-full flex items-center justify-center
                                backdrop-blur-md border shadow-sm
                                ${b?"bg-white/10 border-white/20 text-gray-100":x.isToday?"bg-white/5 border-white/15 text-gray-200":"bg-white/4 border-white/10 text-gray-400 hover:bg-white/8 hover:border-white/15"}
                              `,children:[g.jsx("span",{className:`
                                text-[10px] font-medium
                                ${b?"text-gray-100":x.isToday?"text-gray-200":"text-gray-400"}
                              `,children:x.day}),w&&g.jsx("div",{className:"absolute -top-0.5 -right-0.5 rounded-full transition-all duration-200",style:{width:`${w.size}px`,height:`${w.size}px`,backgroundColor:`rgba(255, 255, 255, ${w.opacity})`},title:`${x.memoryCount} 条记忆`})]},x.date.toISOString())}):g.jsxs("div",{className:"flex flex-col items-center gap-1 py-2 opacity-40",children:[g.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-700"}),g.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-800"}),g.jsx("div",{className:"w-1 h-1 rounded-full bg-gray-900"})]})})]},f)})})})]})}function x$e({timelineOpen:t,setTimelineOpen:e,focusMode:n,visibleMemories:r,relations:i,selectedDate:a,onDateSelect:s}){return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"absolute top-3 left-3 z-30 flex items-center gap-2",children:g.jsx("button",{onClick:()=>e(!0),className:"md:hidden w-10 h-10 rounded-xl bg-gray-800/40 backdrop-blur-md border border-gray-700/40 hover:bg-gray-700/40 transition-all flex items-center justify-center text-gray-300 shadow-lg",title:"打开时间轴",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),t&&g.jsx("div",{className:"absolute inset-0 z-20 bg-black/40 md:hidden",onClick:()=>e(!1)}),g.jsx("div",{className:`absolute left-0 top-0 h-full z-30 w-20 sm:w-20 md:w-20 transition-transform duration-300 ${n?"-translate-x-full":t?"translate-x-0":"-translate-x-full"} md:${n?"-translate-x-full":"translate-x-0"}`,children:g.jsxs("div",{className:"relative h-full",children:[g.jsx("button",{onClick:()=>e(!1),className:"absolute top-2 right-2 z-40 md:hidden w-8 h-8 rounded-lg bg-black/40 border border-white/10 text-gray-200 hover:bg-black/60 transition-all flex items-center justify-center",title:"关闭时间轴",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),g.jsx(y$e,{memories:r,relations:i,onDateSelect:o=>{s(o),window.matchMedia("(max-width: 767px)").matches&&e(!1)},selectedDate:a})]})})]})}const b$e=typeof document<"u"?Xt.useLayoutEffect:()=>{},Sd=t=>{var e;return(e=t?.ownerDocument)!==null&&e!==void 0?e:document},Ah=t=>t&&"window"in t&&t.window===t?t:Sd(t).defaultView||window;function _$e(t){return t!==null&&typeof t=="object"&&"nodeType"in t&&typeof t.nodeType=="number"}function w$e(t){return _$e(t)&&t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"host"in t}let S$e=!1;function d7(){return S$e}function Rae(t,e){if(!d7())return e&&t?t.contains(e):!1;if(!t||!e)return!1;let n=e;for(;n!==null;){if(n===t)return!0;n.tagName==="SLOT"&&n.assignedSlot?n=n.assignedSlot.parentNode:w$e(n)?n=n.host:n=n.parentNode}return!1}const rN=(t=document)=>{var e;if(!d7())return t.activeElement;let n=t.activeElement;for(;n&&"shadowRoot"in n&&(!((e=n.shadowRoot)===null||e===void 0)&&e.activeElement);)n=n.shadowRoot.activeElement;return n};function Pae(t){return d7()&&t.target.shadowRoot&&t.composedPath?t.composedPath()[0]:t.target}function E$e(t){if(T$e())t.focus({preventScroll:!0});else{let e=C$e(t);t.focus(),M$e(e)}}let yb=null;function T$e(){if(yb==null){yb=!1;try{document.createElement("div").focus({get preventScroll(){return yb=!0,!0}})}catch{}}return yb}function C$e(t){let e=t.parentNode,n=[],r=document.scrollingElement||document.documentElement;for(;e instanceof HTMLElement&&e!==r;)(e.offsetHeight<e.scrollHeight||e.offsetWidth<e.scrollWidth)&&n.push({element:e,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),e=e.parentNode;return r instanceof HTMLElement&&n.push({element:r,scrollTop:r.scrollTop,scrollLeft:r.scrollLeft}),n}function M$e(t){for(let{element:e,scrollTop:n,scrollLeft:r}of t)e.scrollTop=n,e.scrollLeft=r}function A3(t){var e;if(typeof window>"u"||window.navigator==null)return!1;let n=(e=window.navigator.userAgentData)===null||e===void 0?void 0:e.brands;return Array.isArray(n)&&n.some(r=>t.test(r.brand))||t.test(window.navigator.userAgent)}function Dae(t){var e;return typeof window<"u"&&window.navigator!=null?t.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function J0(t){let e=null;return()=>(e==null&&(e=t()),e)}const Bw=J0(function(){return Dae(/^Mac/i)}),A$e=J0(function(){return Dae(/^iPad/i)||Bw()&&navigator.maxTouchPoints>1}),k$e=J0(function(){return A3(/AppleWebKit/i)&&!I$e()}),I$e=J0(function(){return A3(/Chrome/i)}),N$e=J0(function(){return A3(/Android/i)}),R$e=J0(function(){return A3(/Firefox/i)});function K1(t,e,n=!0){var r,i;let{metaKey:a,ctrlKey:s,altKey:o,shiftKey:l}=e;R$e()&&(!((i=window.event)===null||i===void 0||(r=i.type)===null||r===void 0)&&r.startsWith("key"))&&t.target==="_blank"&&(Bw()?a=!0:s=!0);let u=k$e()&&Bw()&&!A$e()?new KeyboardEvent("keydown",{keyIdentifier:"Enter",metaKey:a,ctrlKey:s,altKey:o,shiftKey:l}):new MouseEvent("click",{metaKey:a,ctrlKey:s,altKey:o,shiftKey:l,detail:1,bubbles:!0,cancelable:!0});K1.isOpening=n,E$e(t),t.dispatchEvent(u),K1.isOpening=!1}K1.isOpening=!1;function Oae(){let t=P.useRef(new Map),e=P.useCallback((i,a,s,o)=>{let l=o?.once?(...u)=>{t.current.delete(s),s(...u)}:s;t.current.set(s,{type:a,eventTarget:i,fn:l,options:o}),i.addEventListener(a,l,o)},[]),n=P.useCallback((i,a,s,o)=>{var l;let u=((l=t.current.get(s))===null||l===void 0?void 0:l.fn)||s;i.removeEventListener(a,u,o),t.current.delete(s)},[]),r=P.useCallback(()=>{t.current.forEach((i,a)=>{n(i.eventTarget,i.type,a,i.options)})},[n]);return P.useEffect(()=>r,[r]),{addGlobalListener:e,removeGlobalListener:n,removeAllGlobalListeners:r}}function P$e(t){return t.pointerType===""&&t.isTrusted?!0:N$e()&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}var Vu=Ahe();function Lae(t){let e=t;return e.nativeEvent=t,e.isDefaultPrevented=()=>e.defaultPrevented,e.isPropagationStopped=()=>e.cancelBubble,e.persist=()=>{},e}function D$e(t,e){Object.defineProperty(t,"target",{value:e}),Object.defineProperty(t,"currentTarget",{value:e})}function Fae(t){let e=P.useRef({isFocused:!1,observer:null});return b$e(()=>{const n=e.current;return()=>{n.observer&&(n.observer.disconnect(),n.observer=null)}},[]),P.useCallback(n=>{if(n.target instanceof HTMLButtonElement||n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLSelectElement){e.current.isFocused=!0;let r=n.target,i=a=>{if(e.current.isFocused=!1,r.disabled){let s=Lae(a);t?.(s)}e.current.observer&&(e.current.observer.disconnect(),e.current.observer=null)};r.addEventListener("focusout",i,{once:!0}),e.current.observer=new MutationObserver(()=>{if(e.current.isFocused&&r.disabled){var a;(a=e.current.observer)===null||a===void 0||a.disconnect();let s=r===document.activeElement?null:document.activeElement;r.dispatchEvent(new FocusEvent("blur",{relatedTarget:s})),r.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:s}))}}),e.current.observer.observe(r,{attributes:!0,attributeFilter:["disabled"]})}},[t])}let O$e=!1,zv=null,iN=new Set,t1=new Map,sf=!1,aN=!1;const L$e={Tab:!0,Escape:!0};function h7(t,e){for(let n of iN)n(t,e)}function F$e(t){return!(t.metaKey||!Bw()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}function Uw(t){sf=!0,!K1.isOpening&&F$e(t)&&(zv="keyboard",h7("keyboard",t))}function r0(t){zv="pointer","pointerType"in t&&t.pointerType,(t.type==="mousedown"||t.type==="pointerdown")&&(sf=!0,h7("pointer",t))}function Bae(t){!K1.isOpening&&P$e(t)&&(sf=!0,zv="virtual")}function Uae(t){t.target===window||t.target===document||O$e||!t.isTrusted||(!sf&&!aN&&(zv="virtual",h7("virtual",t)),sf=!1,aN=!1)}function zae(){sf=!1,aN=!0}function sN(t){if(typeof window>"u"||typeof document>"u"||t1.get(Ah(t)))return;const e=Ah(t),n=Sd(t);let r=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){sf=!0,r.apply(this,arguments)},n.addEventListener("keydown",Uw,!0),n.addEventListener("keyup",Uw,!0),n.addEventListener("click",Bae,!0),e.addEventListener("focus",Uae,!0),e.addEventListener("blur",zae,!1),typeof PointerEvent<"u"&&(n.addEventListener("pointerdown",r0,!0),n.addEventListener("pointermove",r0,!0),n.addEventListener("pointerup",r0,!0)),e.addEventListener("beforeunload",()=>{jae(t)},{once:!0}),t1.set(e,{focus:r})}const jae=(t,e)=>{const n=Ah(t),r=Sd(t);e&&r.removeEventListener("DOMContentLoaded",e),t1.has(n)&&(n.HTMLElement.prototype.focus=t1.get(n).focus,r.removeEventListener("keydown",Uw,!0),r.removeEventListener("keyup",Uw,!0),r.removeEventListener("click",Bae,!0),n.removeEventListener("focus",Uae,!0),n.removeEventListener("blur",zae,!1),typeof PointerEvent<"u"&&(r.removeEventListener("pointerdown",r0,!0),r.removeEventListener("pointermove",r0,!0),r.removeEventListener("pointerup",r0,!0)),t1.delete(n))};function B$e(t){const e=Sd(t);let n;return e.readyState!=="loading"?sN(t):(n=()=>{sN(t)},e.addEventListener("DOMContentLoaded",n)),()=>jae(t,n)}typeof document<"u"&&B$e();function Hae(){return zv!=="pointer"}const U$e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function z$e(t,e,n){let r=Sd(n?.target);const i=typeof window<"u"?Ah(n?.target).HTMLInputElement:HTMLInputElement,a=typeof window<"u"?Ah(n?.target).HTMLTextAreaElement:HTMLTextAreaElement,s=typeof window<"u"?Ah(n?.target).HTMLElement:HTMLElement,o=typeof window<"u"?Ah(n?.target).KeyboardEvent:KeyboardEvent;return t=t||r.activeElement instanceof i&&!U$e.has(r.activeElement.type)||r.activeElement instanceof a||r.activeElement instanceof s&&r.activeElement.isContentEditable,!(t&&e==="keyboard"&&n instanceof o&&!L$e[n.key])}function j$e(t,e,n){sN(),P.useEffect(()=>{let r=(i,a)=>{z$e(!!n?.isTextInput,i,a)&&t(Hae())};return iN.add(r),()=>{iN.delete(r)}},e)}function H$e(t){let{isDisabled:e,onFocus:n,onBlur:r,onFocusChange:i}=t;const a=P.useCallback(l=>{if(l.target===l.currentTarget)return r&&r(l),i&&i(!1),!0},[r,i]),s=Fae(a),o=P.useCallback(l=>{const u=Sd(l.target),c=u?rN(u):rN();l.target===l.currentTarget&&c===Pae(l.nativeEvent)&&(n&&n(l),i&&i(!0),s(l))},[i,n,s]);return{focusProps:{onFocus:!e&&(n||i||r)?o:void 0,onBlur:!e&&(r||i)?a:void 0}}}function $$e(t){let{isDisabled:e,onBlurWithin:n,onFocusWithin:r,onFocusWithinChange:i}=t,a=P.useRef({isFocusWithin:!1}),{addGlobalListener:s,removeAllGlobalListeners:o}=Oae(),l=P.useCallback(d=>{d.currentTarget.contains(d.target)&&a.current.isFocusWithin&&!d.currentTarget.contains(d.relatedTarget)&&(a.current.isFocusWithin=!1,o(),n&&n(d),i&&i(!1))},[n,i,a,o]),u=Fae(l),c=P.useCallback(d=>{if(!d.currentTarget.contains(d.target))return;const h=Sd(d.target),f=rN(h);if(!a.current.isFocusWithin&&f===Pae(d.nativeEvent)){r&&r(d),i&&i(!0),a.current.isFocusWithin=!0,u(d);let m=d.currentTarget;s(h,"focus",x=>{if(a.current.isFocusWithin&&!Rae(m,x.target)){let b=new h.defaultView.FocusEvent("blur",{relatedTarget:x.target});D$e(b,m);let y=Lae(b);l(y)}},{capture:!0})}},[r,i,u,s,l]);return e?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:c,onBlur:l}}}let oN=!1,xb=0;function V$e(){oN=!0,setTimeout(()=>{oN=!1},50)}function Uj(t){t.pointerType==="touch"&&V$e()}function q$e(){if(!(typeof document>"u"))return xb===0&&typeof PointerEvent<"u"&&document.addEventListener("pointerup",Uj),xb++,()=>{xb--,!(xb>0)&&typeof PointerEvent<"u"&&document.removeEventListener("pointerup",Uj)}}function $ae(t){let{onHoverStart:e,onHoverChange:n,onHoverEnd:r,isDisabled:i}=t,[a,s]=P.useState(!1),o=P.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;P.useEffect(q$e,[]);let{addGlobalListener:l,removeAllGlobalListeners:u}=Oae(),{hoverProps:c,triggerHoverEnd:d}=P.useMemo(()=>{let h=(x,b)=>{if(o.pointerType=b,i||b==="touch"||o.isHovered||!x.currentTarget.contains(x.target))return;o.isHovered=!0;let y=x.currentTarget;o.target=y,l(Sd(x.target),"pointerover",w=>{o.isHovered&&o.target&&!Rae(o.target,w.target)&&f(w,w.pointerType)},{capture:!0}),e&&e({type:"hoverstart",target:y,pointerType:b}),n&&n(!0),s(!0)},f=(x,b)=>{let y=o.target;o.pointerType="",o.target=null,!(b==="touch"||!o.isHovered||!y)&&(o.isHovered=!1,u(),r&&r({type:"hoverend",target:y,pointerType:b}),n&&n(!1),s(!1))},m={};return typeof PointerEvent<"u"&&(m.onPointerEnter=x=>{oN&&x.pointerType==="mouse"||h(x,x.pointerType)},m.onPointerLeave=x=>{!i&&x.currentTarget.contains(x.target)&&f(x,x.pointerType)}),{hoverProps:m,triggerHoverEnd:f}},[e,n,r,i,o,l,u]);return P.useEffect(()=>{i&&d({currentTarget:o.target},o.pointerType)},[i]),{hoverProps:c,isHovered:a}}function f7(t={}){let{autoFocus:e=!1,isTextInput:n,within:r}=t,i=P.useRef({isFocused:!1,isFocusVisible:e||Hae()}),[a,s]=P.useState(!1),[o,l]=P.useState(()=>i.current.isFocused&&i.current.isFocusVisible),u=P.useCallback(()=>l(i.current.isFocused&&i.current.isFocusVisible),[]),c=P.useCallback(f=>{i.current.isFocused=f,s(f),u()},[u]);j$e(f=>{i.current.isFocusVisible=f,u()},[],{isTextInput:n});let{focusProps:d}=H$e({isDisabled:r,onFocusChange:c}),{focusWithinProps:h}=$$e({isDisabled:!r,onFocusWithinChange:c});return{isFocused:a,isFocusVisible:o,focusProps:r?h:d}}var G$e=Object.defineProperty,W$e=(t,e,n)=>e in t?G$e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,HT=(t,e,n)=>(W$e(t,typeof e!="symbol"?e+"":e,n),n);let Y$e=class{constructor(){HT(this,"current",this.detect()),HT(this,"handoffState","pending"),HT(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Bl=new Y$e;function Ef(t){var e;return Bl.isServer?null:t==null?document:(e=t?.ownerDocument)!=null?e:document}function zw(t){var e,n;return Bl.isServer?null:t==null?document:(n=(e=t?.getRootNode)==null?void 0:e.call(t))!=null?n:document}function k3(t){var e,n;return(n=(e=zw(t))==null?void 0:e.activeElement)!=null?n:null}function Vae(t){return k3(t)===t}function jv(t){typeof queueMicrotask=="function"?queueMicrotask(t):Promise.resolve().then(t).catch(e=>setTimeout(()=>{throw e}))}function As(){let t=[],e={addEventListener(n,r,i,a){return n.addEventListener(r,i,a),e.add(()=>n.removeEventListener(r,i,a))},requestAnimationFrame(...n){let r=requestAnimationFrame(...n);return e.add(()=>cancelAnimationFrame(r))},nextFrame(...n){return e.requestAnimationFrame(()=>e.requestAnimationFrame(...n))},setTimeout(...n){let r=setTimeout(...n);return e.add(()=>clearTimeout(r))},microTask(...n){let r={current:!0};return jv(()=>{r.current&&n[0]()}),e.add(()=>{r.current=!1})},style(n,r,i){let a=n.style.getPropertyValue(r);return Object.assign(n.style,{[r]:i}),this.add(()=>{Object.assign(n.style,{[r]:a})})},group(n){let r=As();return n(r),this.add(()=>r.dispose())},add(n){return t.includes(n)||t.push(n),()=>{let r=t.indexOf(n);if(r>=0)for(let i of t.splice(r,1))i()}},dispose(){for(let n of t.splice(0))n()}};return e}function Tf(){let[t]=P.useState(As);return P.useEffect(()=>()=>t.dispose(),[t]),t}let Er=(t,e)=>{Bl.isServer?P.useEffect(t,e):P.useLayoutEffect(t,e)};function Jo(t){let e=P.useRef(t);return Er(()=>{e.current=t},[t]),e}let an=function(t){let e=Jo(t);return Xt.useCallback((...n)=>e.current(...n),[e])};function X$e(t){let e=t.width/2,n=t.height/2;return{top:t.clientY-n,right:t.clientX+e,bottom:t.clientY+n,left:t.clientX-e}}function K$e(t,e){return!(!t||!e||t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}function qae({disabled:t=!1}={}){let e=P.useRef(null),[n,r]=P.useState(!1),i=Tf(),a=an(()=>{e.current=null,r(!1),i.dispose()}),s=an(o=>{if(i.dispose(),e.current===null){e.current=o.currentTarget,r(!0);{let l=Ef(o.currentTarget);i.addEventListener(l,"pointerup",a,!1),i.addEventListener(l,"pointermove",u=>{if(e.current){let c=X$e(u);r(K$e(c,e.current.getBoundingClientRect()))}},!1),i.addEventListener(l,"pointercancel",a,!1)}}});return{pressed:n,pressProps:t?{}:{onPointerDown:s,onPointerUp:a,onClick:a}}}function ss(t){return P.useMemo(()=>t,Object.values(t))}let Z$e=P.createContext(void 0);function Gae(){return P.useContext(Z$e)}function lN(...t){return Array.from(new Set(t.flatMap(e=>typeof e=="string"?e.split(" "):[]))).filter(Boolean).join(" ")}function La(t,e,...n){if(t in e){let i=e[t];return typeof i=="function"?i(...n):i}let r=new Error(`Tried to handle "${t}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,La),r}var cd=(t=>(t[t.None=0]="None",t[t.RenderStrategy=1]="RenderStrategy",t[t.Static=2]="Static",t))(cd||{}),Xc=(t=>(t[t.Unmount=0]="Unmount",t[t.Hidden=1]="Hidden",t))(Xc||{});function qr(){let t=Q$e();return P.useCallback(e=>J$e({mergeRefs:t,...e}),[t])}function J$e({ourProps:t,theirProps:e,slot:n,defaultTag:r,features:i,visible:a=!0,name:s,mergeRefs:o}){o=o??eVe;let l=Wae(e,t);if(a)return bb(l,n,r,s,o);let u=i??0;if(u&2){let{static:c=!1,...d}=l;if(c)return bb(d,n,r,s,o)}if(u&1){let{unmount:c=!0,...d}=l;return La(c?0:1,{0(){return null},1(){return bb({...d,hidden:!0,style:{display:"none"}},n,r,s,o)}})}return bb(l,n,r,s,o)}function bb(t,e={},n,r,i){let{as:a=n,children:s,refName:o="ref",...l}=$T(t,["unmount","static"]),u=t.ref!==void 0?{[o]:t.ref}:{},c=typeof s=="function"?s(e):s;"className"in l&&l.className&&typeof l.className=="function"&&(l.className=l.className(e)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let d={};if(e){let h=!1,f=[];for(let[m,x]of Object.entries(e))typeof x=="boolean"&&(h=!0),x===!0&&f.push(m.replace(/([A-Z])/g,b=>`-${b.toLowerCase()}`));if(h){d["data-headlessui-state"]=f.join(" ");for(let m of f)d[`data-${m}`]=""}}if(n1(a)&&(Object.keys(vh(l)).length>0||Object.keys(vh(d)).length>0))if(!P.isValidElement(c)||Array.isArray(c)&&c.length>1||nVe(c)){if(Object.keys(vh(l)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${r} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(vh(l)).concat(Object.keys(vh(d))).map(h=>`  - ${h}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(h=>`  - ${h}`).join(`
`)].join(`
`))}else{let h=c.props,f=h?.className,m=typeof f=="function"?(...y)=>lN(f(...y),l.className):lN(f,l.className),x=m?{className:m}:{},b=Wae(c.props,vh($T(l,["ref"])));for(let y in d)y in b&&delete d[y];return P.cloneElement(c,Object.assign({},b,d,u,{ref:i(tVe(c),u.ref)},x))}return P.createElement(a,Object.assign({},$T(l,["ref"]),!n1(a)&&u,!n1(a)&&d),c)}function Q$e(){let t=P.useRef([]),e=P.useCallback(n=>{for(let r of t.current)r!=null&&(typeof r=="function"?r(n):r.current=n)},[]);return(...n)=>{if(!n.every(r=>r==null))return t.current=n,e}}function eVe(...t){return t.every(e=>e==null)?void 0:e=>{for(let n of t)n!=null&&(typeof n=="function"?n(e):n.current=e)}}function Wae(...t){if(t.length===0)return{};if(t.length===1)return t[0];let e={},n={};for(let r of t)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(n[i]!=null||(n[i]=[]),n[i].push(r[i])):e[i]=r[i];if(e.disabled||e["aria-disabled"])for(let r in n)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(r)&&(n[r]=[i=>{var a;return(a=i?.preventDefault)==null?void 0:a.call(i)}]);for(let r in n)Object.assign(e,{[r](i,...a){let s=n[r];for(let o of s){if((i instanceof Event||i?.nativeEvent instanceof Event)&&i.defaultPrevented)return;o(i,...a)}}});return e}function I3(...t){if(t.length===0)return{};if(t.length===1)return t[0];let e={},n={};for(let r of t)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(n[i]!=null||(n[i]=[]),n[i].push(r[i])):e[i]=r[i];for(let r in n)Object.assign(e,{[r](...i){let a=n[r];for(let s of a)s?.(...i)}});return e}function Br(t){var e;return Object.assign(P.forwardRef(t),{displayName:(e=t.displayName)!=null?e:t.name})}function vh(t){let e=Object.assign({},t);for(let n in e)e[n]===void 0&&delete e[n];return e}function $T(t,e=[]){let n=Object.assign({},t);for(let r of e)r in n&&delete n[r];return n}function tVe(t){return Xt.version.split(".")[0]>="19"?t.props.ref:t.ref}function n1(t){return t===P.Fragment||t===Symbol.for("react.fragment")}function nVe(t){return n1(t.type)}let rVe="span";var Z1=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(Z1||{});function iVe(t,e){var n;let{features:r=1,...i}=t,a={ref:e,"aria-hidden":(r&2)===2?!0:(n=i["aria-hidden"])!=null?n:void 0,hidden:(r&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return qr()({ourProps:a,theirProps:i,slot:{},defaultTag:rVe,name:"Hidden"})}let J1=Br(iVe),aVe=P.createContext(void 0);function sVe(){return P.useContext(aVe)}function Yae(t){return typeof t!="object"||t===null?!1:"nodeType"in t}function Bu(t){return Yae(t)&&"tagName"in t}function to(t){return Bu(t)&&"accessKey"in t}function Ll(t){return Bu(t)&&"tabIndex"in t}function oVe(t){return Bu(t)&&"style"in t}function lVe(t){return to(t)&&t.nodeName==="IFRAME"}function Xae(t){return to(t)&&t.nodeName==="INPUT"}function zj(t){return to(t)&&t.nodeName==="LABEL"}function uVe(t){return to(t)&&t.nodeName==="FIELDSET"}function Kae(t){return to(t)&&t.nodeName==="LEGEND"}function cVe(t){return Bu(t)?t.matches('a[href],audio[controls],button,details,embed,iframe,img[usemap],input:not([type="hidden"]),label,select,textarea,video[controls]'):!1}function jj(t){let e=t.parentElement,n=null;for(;e&&!uVe(e);)Kae(e)&&(n=e),e=e.parentElement;let r=e?.getAttribute("disabled")==="";return r&&dVe(n)?!1:r}function dVe(t){if(!t)return!1;let e=t.previousElementSibling;for(;e!==null;){if(Kae(e))return!1;e=e.previousElementSibling}return!0}let Zae=Symbol();function hVe(t,e=!0){return Object.assign(t,{[Zae]:e})}function qi(...t){let e=P.useRef(t);P.useEffect(()=>{e.current=t},[t]);let n=an(r=>{for(let i of e.current)i!=null&&(typeof i=="function"?i(r):i.current=r)});return t.every(r=>r==null||r?.[Zae])?void 0:n}let p7=P.createContext(null);p7.displayName="DescriptionContext";function Jae(){let t=P.useContext(p7);if(t===null){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,Jae),e}return t}function Qae(){let[t,e]=P.useState([]);return[t.length>0?t.join(" "):void 0,P.useMemo(()=>function(n){let r=an(a=>(e(s=>[...s,a]),()=>e(s=>{let o=s.slice(),l=o.indexOf(a);return l!==-1&&o.splice(l,1),o}))),i=P.useMemo(()=>({register:r,slot:n.slot,name:n.name,props:n.props,value:n.value}),[r,n.slot,n.name,n.props,n.value]);return Xt.createElement(p7.Provider,{value:i},n.children)},[e])]}let fVe="p";function pVe(t,e){let n=P.useId(),r=Gae(),{id:i=`headlessui-description-${n}`,...a}=t,s=Jae(),o=qi(e);Er(()=>s.register(i),[i,s.register]);let l=ss({...s.slot,disabled:r||!1}),u={ref:o,...s.props,id:i};return qr()({ourProps:u,theirProps:a,slot:l,defaultTag:fVe,name:s.name||"Description"})}let mVe=Br(pVe),gVe=Object.assign(mVe,{});var Mr=(t=>(t.Space=" ",t.Enter="Enter",t.Escape="Escape",t.Backspace="Backspace",t.Delete="Delete",t.ArrowLeft="ArrowLeft",t.ArrowUp="ArrowUp",t.ArrowRight="ArrowRight",t.ArrowDown="ArrowDown",t.Home="Home",t.End="End",t.PageUp="PageUp",t.PageDown="PageDown",t.Tab="Tab",t))(Mr||{});let N3=P.createContext(null);N3.displayName="LabelContext";function m7(){let t=P.useContext(N3);if(t===null){let e=new Error("You used a <Label /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,m7),e}return t}function vVe(t){var e,n,r;let i=(n=(e=P.useContext(N3))==null?void 0:e.value)!=null?n:void 0;return((r=void 0)!=null?r:0)>0?[i,...t].filter(Boolean).join(" "):i}function ese({inherit:t=!1}={}){let e=vVe(),[n,r]=P.useState([]),i=t?[e,...n].filter(Boolean):n;return[i.length>0?i.join(" "):void 0,P.useMemo(()=>function(a){let s=an(l=>(r(u=>[...u,l]),()=>r(u=>{let c=u.slice(),d=c.indexOf(l);return d!==-1&&c.splice(d,1),c}))),o=P.useMemo(()=>({register:s,slot:a.slot,name:a.name,props:a.props,value:a.value}),[s,a.slot,a.name,a.props,a.value]);return Xt.createElement(N3.Provider,{value:o},a.children)},[r])]}let yVe="label";function xVe(t,e){var n;let r=P.useId(),i=m7(),a=sVe(),s=Gae(),{id:o=`headlessui-label-${r}`,htmlFor:l=a??((n=i.props)==null?void 0:n.htmlFor),passive:u=!1,...c}=t,d=qi(e);Er(()=>i.register(o),[o,i.register]);let h=an(x=>{let b=x.currentTarget;if(!(x.target!==x.currentTarget&&cVe(x.target))&&(zj(b)&&x.preventDefault(),i.props&&"onClick"in i.props&&typeof i.props.onClick=="function"&&i.props.onClick(x),zj(b))){let y=document.getElementById(b.htmlFor);if(y){let w=y.getAttribute("disabled");if(w==="true"||w==="")return;let _=y.getAttribute("aria-disabled");if(_==="true"||_==="")return;(Xae(y)&&(y.type==="file"||y.type==="radio"||y.type==="checkbox")||y.role==="radio"||y.role==="checkbox"||y.role==="switch")&&y.click(),y.focus({preventScroll:!0})}}}),f=ss({...i.slot,disabled:s||!1}),m={ref:d,...i.props,id:o,htmlFor:l,onClick:h};return u&&("onClick"in m&&(delete m.htmlFor,delete m.onClick),"onClick"in c&&delete c.onClick),qr()({ourProps:m,theirProps:c,slot:f,defaultTag:l?yVe:"div",name:i.name||"Label"})}let bVe=Br(xVe);Object.assign(bVe,{});let _Ve=P.createContext(()=>{});function wVe({value:t,children:e}){return Xt.createElement(_Ve.Provider,{value:t},e)}function Hj(t){if(t===null)return{width:0,height:0};let{width:e,height:n}=t.getBoundingClientRect();return{width:e,height:n}}function SVe(t,e,n=!1){let[r,i]=P.useState(()=>Hj(e));return Er(()=>{if(!e||!t)return;let a=As();return a.requestAnimationFrame(function s(){a.requestAnimationFrame(s),i(o=>{let l=Hj(e);return l.width===o.width&&l.height===o.height?o:l})}),()=>{a.dispose()}},[e,t]),n?{width:`${r.width}px`,height:`${r.height}px`}:r}var tse=(t=>(t[t.Left=0]="Left",t[t.Right=2]="Right",t))(tse||{});function EVe(t){let e=P.useRef(null),n=an(i=>{e.current=i.pointerType,!jj(i.currentTarget)&&i.pointerType==="mouse"&&i.button===tse.Left&&(i.preventDefault(),t(i))}),r=an(i=>{e.current!=="mouse"&&(jj(i.currentTarget)||t(i))});return{onPointerDown:n,onClick:r}}let nse=class extends Map{constructor(e){super(),this.factory=e}get(e){let n=super.get(e);return n===void 0&&(n=this.factory(e),this.set(e,n)),n}};var TVe=Object.defineProperty,CVe=(t,e,n)=>e in t?TVe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,MVe=(t,e,n)=>(CVe(t,e+"",n),n),rse=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},uo=(t,e,n)=>(rse(t,e,"read from private field"),n?n.call(t):e.get(t)),VT=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},$j=(t,e,n,r)=>(rse(t,e,"write to private field"),e.set(t,n),n),wl,_g,wg;let ise=class{constructor(e){VT(this,wl,{}),VT(this,_g,new nse(()=>new Set)),VT(this,wg,new Set),MVe(this,"disposables",As()),$j(this,wl,e),Bl.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return uo(this,wl)}subscribe(e,n){if(Bl.isServer)return()=>{};let r={selector:e,callback:n,current:e(uo(this,wl))};return uo(this,wg).add(r),this.disposables.add(()=>{uo(this,wg).delete(r)})}on(e,n){return Bl.isServer?()=>{}:(uo(this,_g).get(e).add(n),this.disposables.add(()=>{uo(this,_g).get(e).delete(n)}))}send(e){let n=this.reduce(uo(this,wl),e);if(n!==uo(this,wl)){$j(this,wl,n);for(let r of uo(this,wg)){let i=r.selector(uo(this,wl));ase(r.current,i)||(r.current=i,r.callback(i))}for(let r of uo(this,_g).get(e.type))r(uo(this,wl),e)}}};wl=new WeakMap,_g=new WeakMap,wg=new WeakMap;function ase(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:Array.isArray(t)&&Array.isArray(e)?t.length!==e.length?!1:qT(t[Symbol.iterator](),e[Symbol.iterator]()):t instanceof Map&&e instanceof Map||t instanceof Set&&e instanceof Set?t.size!==e.size?!1:qT(t.entries(),e.entries()):Vj(t)&&Vj(e)?qT(Object.entries(t)[Symbol.iterator](),Object.entries(e)[Symbol.iterator]()):!1}function qT(t,e){do{let n=t.next(),r=e.next();if(n.done&&r.done)return!0;if(n.done||r.done||!Object.is(n.value,r.value))return!1}while(!0)}function Vj(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let e=Object.getPrototypeOf(t);return e===null||Object.getPrototypeOf(e)===null}function qj(t){let[e,n]=t(),r=As();return(...i)=>{e(...i),r.dispose(),r.microTask(n)}}var AVe=Object.defineProperty,kVe=(t,e,n)=>e in t?AVe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Gj=(t,e,n)=>(kVe(t,typeof e!="symbol"?e+"":e,n),n),sse=(t=>(t[t.Push=0]="Push",t[t.Pop=1]="Pop",t))(sse||{});let IVe={0(t,e){let n=e.id,r=t.stack,i=t.stack.indexOf(n);if(i!==-1){let a=t.stack.slice();return a.splice(i,1),a.push(n),r=a,{...t,stack:r}}return{...t,stack:[...t.stack,n]}},1(t,e){let n=e.id,r=t.stack.indexOf(n);if(r===-1)return t;let i=t.stack.slice();return i.splice(r,1),{...t,stack:i}}},NVe=class ose extends ise{constructor(){super(...arguments),Gj(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),Gj(this,"selectors",{isTop:(e,n)=>e.stack[e.stack.length-1]===n,inStack:(e,n)=>e.stack.includes(n)})}static new(){return new ose({stack:[]})}reduce(e,n){return La(n.type,IVe,e,n)}};const R3=new nse(()=>NVe.new());var GT={exports:{}},WT={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wj;function RVe(){if(Wj)return WT;Wj=1;var t=DN();function e(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var n=typeof Object.is=="function"?Object.is:e,r=t.useSyncExternalStore,i=t.useRef,a=t.useEffect,s=t.useMemo,o=t.useDebugValue;return WT.useSyncExternalStoreWithSelector=function(l,u,c,d,h){var f=i(null);if(f.current===null){var m={hasValue:!1,value:null};f.current=m}else m=f.current;f=s(function(){function b(M){if(!y){if(y=!0,w=M,M=d(M),h!==void 0&&m.hasValue){var E=m.value;if(h(E,M))return _=E}return _=M}if(E=_,n(w,M))return E;var C=d(M);return h!==void 0&&h(E,C)?(w=M,E):(w=M,_=C)}var y=!1,w,_,S=c===void 0?null:c;return[function(){return b(u())},S===null?void 0:function(){return b(S())}]},[u,c,d,h]);var x=r(l,f[0],f[1]);return a(function(){m.hasValue=!0,m.value=x},[x]),o(x),x},WT}var Yj;function PVe(){return Yj||(Yj=1,GT.exports=RVe()),GT.exports}var DVe=PVe();function mo(t,e,n=ase){return DVe.useSyncExternalStoreWithSelector(an(r=>t.subscribe(OVe,r)),an(()=>t.state),an(()=>t.state),an(e),n)}function OVe(t){return t}function Hv(t,e){let n=P.useId(),r=R3.get(e),[i,a]=mo(r,P.useCallback(s=>[r.selectors.isTop(s,n),r.selectors.inStack(s,n)],[r,n]));return Er(()=>{if(t)return r.actions.push(n),()=>r.actions.pop(n)},[r,t,n]),t?a?i:!0:!1}let uN=new Map,r1=new Map;function Xj(t){var e;let n=(e=r1.get(t))!=null?e:0;return r1.set(t,n+1),n!==0?()=>Kj(t):(uN.set(t,{"aria-hidden":t.getAttribute("aria-hidden"),inert:t.inert}),t.setAttribute("aria-hidden","true"),t.inert=!0,()=>Kj(t))}function Kj(t){var e;let n=(e=r1.get(t))!=null?e:1;if(n===1?r1.delete(t):r1.set(t,n-1),n!==1)return;let r=uN.get(t);r&&(r["aria-hidden"]===null?t.removeAttribute("aria-hidden"):t.setAttribute("aria-hidden",r["aria-hidden"]),t.inert=r.inert,uN.delete(t))}function lse(t,{allowed:e,disallowed:n}={}){let r=Hv(t,"inert-others");Er(()=>{var i,a;if(!r)return;let s=As();for(let l of(i=n?.())!=null?i:[])l&&s.add(Xj(l));let o=(a=e?.())!=null?a:[];for(let l of o){if(!l)continue;let u=Ef(l);if(!u)continue;let c=l.parentElement;for(;c&&c!==u.body;){for(let d of c.children)o.some(h=>d.contains(h))||s.add(Xj(d));c=c.parentElement}}return s.dispose},[r,e,n])}function use(t,e,n){let r=Jo(i=>{let a=i.getBoundingClientRect();a.x===0&&a.y===0&&a.width===0&&a.height===0&&n()});P.useEffect(()=>{if(!t)return;let i=e===null?null:to(e)?e:e.current;if(!i)return;let a=As();if(typeof ResizeObserver<"u"){let s=new ResizeObserver(()=>r.current(i));s.observe(i),a.add(()=>s.disconnect())}if(typeof IntersectionObserver<"u"){let s=new IntersectionObserver(()=>r.current(i));s.observe(i),a.add(()=>s.disconnect())}return()=>a.dispose()},[e,r,t])}let jw=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(t=>`${t}:not([tabindex='-1'])`).join(","),LVe=["[data-autofocus]"].map(t=>`${t}:not([tabindex='-1'])`).join(",");var wi=(t=>(t[t.First=1]="First",t[t.Previous=2]="Previous",t[t.Next=4]="Next",t[t.Last=8]="Last",t[t.WrapAround=16]="WrapAround",t[t.NoScroll=32]="NoScroll",t[t.AutoFocus=64]="AutoFocus",t))(wi||{}),kh=(t=>(t[t.Error=0]="Error",t[t.Overflow=1]="Overflow",t[t.Success=2]="Success",t[t.Underflow=3]="Underflow",t))(kh||{}),FVe=(t=>(t[t.Previous=-1]="Previous",t[t.Next=1]="Next",t))(FVe||{});function cse(t=document.body){return t==null?[]:Array.from(t.querySelectorAll(jw)).sort((e,n)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(n.tabIndex||Number.MAX_SAFE_INTEGER)))}function BVe(t=document.body){return t==null?[]:Array.from(t.querySelectorAll(LVe)).sort((e,n)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(n.tabIndex||Number.MAX_SAFE_INTEGER)))}var g7=(t=>(t[t.Strict=0]="Strict",t[t.Loose=1]="Loose",t))(g7||{});function v7(t,e=0){var n;return t===((n=Ef(t))==null?void 0:n.body)?!1:La(e,{0(){return t.matches(jw)},1(){let r=t;for(;r!==null;){if(r.matches(jw))return!0;r=r.parentElement}return!1}})}function dse(t){As().nextFrame(()=>{let e=k3(t);e&&Ll(e)&&!v7(e,0)&&Ul(t)})}var UVe=(t=>(t[t.Keyboard=0]="Keyboard",t[t.Mouse=1]="Mouse",t))(UVe||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",t=>{t.metaKey||t.altKey||t.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",t=>{t.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:t.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Ul(t){t?.focus({preventScroll:!0})}let zVe=["textarea","input"].join(",");function jVe(t){var e,n;return(n=(e=t?.matches)==null?void 0:e.call(t,zVe))!=null?n:!1}function Ih(t,e=n=>n){return t.slice().sort((n,r)=>{let i=e(n),a=e(r);if(i===null||a===null)return 0;let s=i.compareDocumentPosition(a);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function HVe(t,e,n=t===null?document.body:zw(t)){return fo(cse(n),e,{relativeTo:t})}function fo(t,e,{sorted:n=!0,relativeTo:r=null,skipElements:i=[]}={}){let a=Array.isArray(t)?t.length>0?zw(t[0]):document:zw(t),s=Array.isArray(t)?n?Ih(t):t:e&64?BVe(t):cse(t);i.length>0&&s.length>1&&(s=s.filter(f=>!i.some(m=>m!=null&&"current"in m?m?.current===f:m===f))),r=r??a?.activeElement;let o=(()=>{if(e&5)return 1;if(e&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),l=(()=>{if(e&1)return 0;if(e&2)return Math.max(0,s.indexOf(r))-1;if(e&4)return Math.max(0,s.indexOf(r))+1;if(e&8)return s.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=e&32?{preventScroll:!0}:{},c=0,d=s.length,h;do{if(c>=d||c+d<=0)return 0;let f=l+c;if(e&16)f=(f+d)%d;else{if(f<0)return 3;if(f>=d)return 1}h=s[f],h?.focus(u),c+=o}while(h!==k3(h));return e&6&&jVe(h)&&h.select(),2}function hse(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function $Ve(){return/Android/gi.test(window.navigator.userAgent)}function Zj(){return hse()||$Ve()}function Yp(t,e,n,r){let i=Jo(n);P.useEffect(()=>{if(!t)return;function a(s){i.current(s)}return document.addEventListener(e,a,r),()=>document.removeEventListener(e,a,r)},[t,e,r])}function fse(t,e,n,r){let i=Jo(n);P.useEffect(()=>{if(!t)return;function a(s){i.current(s)}return window.addEventListener(e,a,r),()=>window.removeEventListener(e,a,r)},[t,e,r])}const Jj=30;function pse(t,e,n){let r=Jo(n),i=P.useCallback(function(o,l){if(o.defaultPrevented)return;let u=l(o);if(u===null||!u.getRootNode().contains(u)||!u.isConnected)return;let c=(function d(h){return typeof h=="function"?d(h()):Array.isArray(h)||h instanceof Set?h:[h]})(e);for(let d of c)if(d!==null&&(d.contains(u)||o.composed&&o.composedPath().includes(d)))return;return!v7(u,g7.Loose)&&u.tabIndex!==-1&&o.preventDefault(),r.current(o,u)},[r,e]),a=P.useRef(null);Yp(t,"pointerdown",o=>{var l,u;Zj()||(a.current=((u=(l=o.composedPath)==null?void 0:l.call(o))==null?void 0:u[0])||o.target)},!0),Yp(t,"pointerup",o=>{if(Zj()||!a.current)return;let l=a.current;return a.current=null,i(o,()=>l)},!0);let s=P.useRef({x:0,y:0});Yp(t,"touchstart",o=>{s.current.x=o.touches[0].clientX,s.current.y=o.touches[0].clientY},!0),Yp(t,"touchend",o=>{let l={x:o.changedTouches[0].clientX,y:o.changedTouches[0].clientY};if(!(Math.abs(l.x-s.current.x)>=Jj||Math.abs(l.y-s.current.y)>=Jj))return i(o,()=>Ll(o.target)?o.target:null)},!0),fse(t,"blur",o=>i(o,()=>lVe(window.document.activeElement)?window.document.activeElement:null),!0)}function Q1(...t){return P.useMemo(()=>Ef(...t),[...t])}var VVe=(t=>(t[t.Ignore=0]="Ignore",t[t.Select=1]="Select",t[t.Close=2]="Close",t))(VVe||{});const _b={Ignore:{kind:0},Select:t=>({kind:1,target:t}),Close:{kind:2}},qVe=200,Qj=5;function GVe(t,{trigger:e,action:n,close:r,select:i}){let a=P.useRef(null),s=P.useRef(null),o=P.useRef(null);Yp(t&&e!==null,"pointerdown",l=>{Yae(l?.target)&&e!=null&&e.contains(l.target)&&(s.current=l.x,o.current=l.y,a.current=l.timeStamp)}),Yp(t&&e!==null,"pointerup",l=>{var u,c;let d=a.current;if(d===null||(a.current=null,!Ll(l.target))||Math.abs(l.x-((u=s.current)!=null?u:l.x))<Qj&&Math.abs(l.y-((c=o.current)!=null?c:l.y))<Qj)return;let h=n(l);switch(h.kind){case 0:return;case 1:{l.timeStamp-d>qVe&&(i(h.target),r());break}case 2:{r();break}}},{capture:!0})}function mse(t,e,n,r){let i=Jo(n);P.useEffect(()=>{t=t??window;function a(s){i.current(s)}return t.addEventListener(e,a,r),()=>t.removeEventListener(e,a,r)},[t,e,r])}function gse(t,e){return P.useMemo(()=>{var n;if(t.type)return t.type;let r=(n=t.as)!=null?n:"button";if(typeof r=="string"&&r.toLowerCase()==="button"||e?.tagName==="BUTTON"&&!e.hasAttribute("type"))return"button"},[t.type,t.as,e])}function WVe(t){return P.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot)}function YVe(t,e){let n=t(),r=new Set;return{getSnapshot(){return n},subscribe(i){return r.add(i),()=>r.delete(i)},dispatch(i,...a){let s=e[i].call(n,...a);s&&(n=s,r.forEach(o=>o()))}}}function XVe(){let t;return{before({doc:e}){var n;let r=e.documentElement,i=(n=e.defaultView)!=null?n:window;t=Math.max(0,i.innerWidth-r.clientWidth)},after({doc:e,d:n}){let r=e.documentElement,i=Math.max(0,r.clientWidth-r.offsetWidth),a=Math.max(0,t-i);n.style(r,"paddingRight",`${a}px`)}}}function KVe(){return hse()?{before({doc:t,d:e,meta:n}){function r(i){for(let a of n().containers)for(let s of a())if(s.contains(i))return!0;return!1}e.microTask(()=>{var i;if(window.getComputedStyle(t.documentElement).scrollBehavior!=="auto"){let o=As();o.style(t.documentElement,"scrollBehavior","auto"),e.add(()=>e.microTask(()=>o.dispose()))}let a=(i=window.scrollY)!=null?i:window.pageYOffset,s=null;e.addEventListener(t,"click",o=>{if(Ll(o.target))try{let l=o.target.closest("a");if(!l)return;let{hash:u}=new URL(l.href),c=t.querySelector(u);Ll(c)&&!r(c)&&(s=c)}catch{}},!0),e.group(o=>{e.addEventListener(t,"touchstart",l=>{if(o.dispose(),Ll(l.target)&&oVe(l.target))if(r(l.target)){let u=l.target;for(;u.parentElement&&r(u.parentElement);)u=u.parentElement;o.style(u,"overscrollBehavior","contain")}else o.style(l.target,"touchAction","none")})}),e.addEventListener(t,"touchmove",o=>{if(Ll(o.target)){if(Xae(o.target))return;if(r(o.target)){let l=o.target;for(;l.parentElement&&l.dataset.headlessuiPortal!==""&&!(l.scrollHeight>l.clientHeight||l.scrollWidth>l.clientWidth);)l=l.parentElement;l.dataset.headlessuiPortal===""&&o.preventDefault()}else o.preventDefault()}},{passive:!1}),e.add(()=>{var o;let l=(o=window.scrollY)!=null?o:window.pageYOffset;a!==l&&window.scrollTo(0,a),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)})})}}:{}}function ZVe(){return{before({doc:t,d:e}){e.style(t.documentElement,"overflow","hidden")}}}function eH(t){let e={};for(let n of t)Object.assign(e,n(e));return e}let Nh=YVe(()=>new Map,{PUSH(t,e){var n;let r=(n=this.get(t))!=null?n:{doc:t,count:0,d:As(),meta:new Set,computedMeta:{}};return r.count++,r.meta.add(e),r.computedMeta=eH(r.meta),this.set(t,r),this},POP(t,e){let n=this.get(t);return n&&(n.count--,n.meta.delete(e),n.computedMeta=eH(n.meta)),this},SCROLL_PREVENT(t){let e={doc:t.doc,d:t.d,meta(){return t.computedMeta}},n=[KVe(),XVe(),ZVe()];n.forEach(({before:r})=>r?.(e)),n.forEach(({after:r})=>r?.(e))},SCROLL_ALLOW({d:t}){t.dispose()},TEARDOWN({doc:t}){this.delete(t)}});Nh.subscribe(()=>{let t=Nh.getSnapshot(),e=new Map;for(let[n]of t)e.set(n,n.documentElement.style.overflow);for(let n of t.values()){let r=e.get(n.doc)==="hidden",i=n.count!==0;(i&&!r||!i&&r)&&Nh.dispatch(n.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",n),n.count===0&&Nh.dispatch("TEARDOWN",n)}});function JVe(t,e,n=()=>({containers:[]})){let r=WVe(Nh),i=e?r.get(e):void 0,a=i?i.count>0:!1;return Er(()=>{if(!(!e||!t))return Nh.dispatch("PUSH",e,n),()=>Nh.dispatch("POP",e,n)},[t,e]),a}function vse(t,e,n=()=>[document.body]){let r=Hv(t,"scroll-lock");JVe(r,e,i=>{var a;return{containers:[...(a=i.containers)!=null?a:[],n]}})}function tH(t){return[t.screenX,t.screenY]}function QVe(){let t=P.useRef([-1,-1]);return{wasMoved(e){let n=tH(e);return t.current[0]===n[0]&&t.current[1]===n[1]?!1:(t.current=n,!0)},update(e){t.current=tH(e)}}}function eqe(t=0){let[e,n]=P.useState(t),r=P.useCallback(l=>n(l),[]),i=P.useCallback(l=>n(u=>u|l),[]),a=P.useCallback(l=>(e&l)===l,[e]),s=P.useCallback(l=>n(u=>u&~l),[]),o=P.useCallback(l=>n(u=>u^l),[]);return{flags:e,setFlag:r,addFlag:i,hasFlag:a,removeFlag:s,toggleFlag:o}}var tqe={},nH,rH;typeof process<"u"&&typeof globalThis<"u"&&typeof Element<"u"&&((nH=process==null?void 0:tqe)==null?void 0:nH.NODE_ENV)==="test"&&typeof((rH=Element?.prototype)==null?void 0:rH.getAnimations)>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var nqe=(t=>(t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.Enter=2]="Enter",t[t.Leave=4]="Leave",t))(nqe||{});function yse(t){let e={};for(let n in t)t[n]===!0&&(e[`data-${n}`]="");return e}function xse(t,e,n,r){let[i,a]=P.useState(n),{hasFlag:s,addFlag:o,removeFlag:l}=eqe(t&&i?3:0),u=P.useRef(!1),c=P.useRef(!1),d=Tf();return Er(()=>{var h;if(t){if(n&&a(!0),!e){n&&o(3);return}return(h=r?.start)==null||h.call(r,n),rqe(e,{inFlight:u,prepare(){c.current?c.current=!1:c.current=u.current,u.current=!0,!c.current&&(n?(o(3),l(4)):(o(4),l(2)))},run(){c.current?n?(l(3),o(4)):(l(4),o(3)):n?l(1):o(1)},done(){var f;c.current&&sqe(e)||(u.current=!1,l(7),n||a(!1),(f=r?.end)==null||f.call(r,n))}})}},[t,n,e,d]),t?[i,{closed:s(1),enter:s(2),leave:s(4),transition:s(2)||s(4)}]:[n,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function rqe(t,{prepare:e,run:n,done:r,inFlight:i}){let a=As();return aqe(t,{prepare:e,inFlight:i}),a.nextFrame(()=>{n(),a.requestAnimationFrame(()=>{a.add(iqe(t,r))})}),a.dispose}function iqe(t,e){var n,r;let i=As();if(!t)return i.dispose;let a=!1;i.add(()=>{a=!0});let s=(r=(n=t.getAnimations)==null?void 0:n.call(t).filter(o=>o instanceof CSSTransition))!=null?r:[];return s.length===0?(e(),i.dispose):(Promise.allSettled(s.map(o=>o.finished)).then(()=>{a||e()}),i.dispose)}function aqe(t,{inFlight:e,prepare:n}){if(e!=null&&e.current){n();return}let r=t.style.transition;t.style.transition="none",n(),t.offsetHeight,t.style.transition=r}function sqe(t){var e,n;return((n=(e=t.getAnimations)==null?void 0:e.call(t))!=null?n:[]).some(r=>r instanceof CSSTransition&&r.playState!=="finished")}function oqe(t,{container:e,accept:n,walk:r}){let i=P.useRef(n),a=P.useRef(r);P.useEffect(()=>{i.current=n,a.current=r},[n,r]),Er(()=>{if(!e||!t)return;let s=Ef(e);if(!s)return;let o=i.current,l=a.current,u=Object.assign(d=>o(d),{acceptNode:o}),c=s.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,u,!1);for(;c.nextNode();)l(c.currentNode)},[e,t,i,a])}function y7(t,e){let n=P.useRef([]),r=an(t);P.useEffect(()=>{let i=[...n.current];for(let[a,s]of e.entries())if(n.current[a]!==s){let o=r(e,i);return n.current=e,o}},[r,...e])}function P3(){return typeof window<"u"}function Q0(t){return bse(t)?(t.nodeName||"").toLowerCase():"#document"}function Zs(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function eu(t){var e;return(e=(bse(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function bse(t){return P3()?t instanceof Node||t instanceof Zs(t).Node:!1}function ts(t){return P3()?t instanceof Element||t instanceof Zs(t).Element:!1}function ql(t){return P3()?t instanceof HTMLElement||t instanceof Zs(t).HTMLElement:!1}function iH(t){return!P3()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Zs(t).ShadowRoot}const lqe=new Set(["inline","contents"]);function $v(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=al(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!lqe.has(i)}const uqe=new Set(["table","td","th"]);function cqe(t){return uqe.has(Q0(t))}const dqe=[":popover-open",":modal"];function D3(t){return dqe.some(e=>{try{return t.matches(e)}catch{return!1}})}const hqe=["transform","translate","scale","rotate","perspective"],fqe=["transform","translate","scale","rotate","perspective","filter"],pqe=["paint","layout","strict","content"];function x7(t){const e=b7(),n=ts(t)?al(t):t;return hqe.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||fqe.some(r=>(n.willChange||"").includes(r))||pqe.some(r=>(n.contain||"").includes(r))}function mqe(t){let e=dd(t);for(;ql(e)&&!M0(e);){if(x7(e))return e;if(D3(e))return null;e=dd(e)}return null}function b7(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const gqe=new Set(["html","body","#document"]);function M0(t){return gqe.has(Q0(t))}function al(t){return Zs(t).getComputedStyle(t)}function O3(t){return ts(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function dd(t){if(Q0(t)==="html")return t;const e=t.assignedSlot||t.parentNode||iH(t)&&t.host||eu(t);return iH(e)?e.host:e}function _se(t){const e=dd(t);return M0(e)?t.ownerDocument?t.ownerDocument.body:t.body:ql(e)&&$v(e)?e:_se(e)}function ev(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=_se(t),a=i===((r=t.ownerDocument)==null?void 0:r.body),s=Zs(i);if(a){const o=cN(s);return e.concat(s,s.visualViewport||[],$v(i)?i:[],o&&n?ev(o):[])}return e.concat(i,ev(i,[],n))}function cN(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function vqe(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}const of=Math.min,Pa=Math.max,tv=Math.round,wb=Math.floor,zl=t=>({x:t,y:t}),yqe={left:"right",right:"left",bottom:"top",top:"bottom"},xqe={start:"end",end:"start"};function aH(t,e,n){return Pa(t,of(e,n))}function em(t,e){return typeof t=="function"?t(e):t}function hd(t){return t.split("-")[0]}function Vv(t){return t.split("-")[1]}function wse(t){return t==="x"?"y":"x"}function Sse(t){return t==="y"?"height":"width"}const bqe=new Set(["top","bottom"]);function Ru(t){return bqe.has(hd(t))?"y":"x"}function Ese(t){return wse(Ru(t))}function _qe(t,e,n){n===void 0&&(n=!1);const r=Vv(t),i=Ese(t),a=Sse(i);let s=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(s=Hw(s)),[s,Hw(s)]}function wqe(t){const e=Hw(t);return[dN(t),e,dN(e)]}function dN(t){return t.replace(/start|end/g,e=>xqe[e])}const sH=["left","right"],oH=["right","left"],Sqe=["top","bottom"],Eqe=["bottom","top"];function Tqe(t,e,n){switch(t){case"top":case"bottom":return n?e?oH:sH:e?sH:oH;case"left":case"right":return e?Sqe:Eqe;default:return[]}}function Cqe(t,e,n,r){const i=Vv(t);let a=Tqe(hd(t),n==="start",r);return i&&(a=a.map(s=>s+"-"+i),e&&(a=a.concat(a.map(dN)))),a}function Hw(t){return t.replace(/left|right|bottom|top/g,e=>yqe[e])}function Mqe(t){return{top:0,right:0,bottom:0,left:0,...t}}function Aqe(t){return typeof t!="number"?Mqe(t):{top:t,right:t,bottom:t,left:t}}function $w(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function lH(t,e,n){let{reference:r,floating:i}=t;const a=Ru(e),s=Ese(e),o=Sse(s),l=hd(e),u=a==="y",c=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[o]/2-i[o]/2;let f;switch(l){case"top":f={x:c,y:r.y-i.height};break;case"bottom":f={x:c,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:d};break;case"left":f={x:r.x-i.width,y:d};break;default:f={x:r.x,y:r.y}}switch(Vv(e)){case"start":f[s]-=h*(n&&u?-1:1);break;case"end":f[s]+=h*(n&&u?-1:1);break}return f}const kqe=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:a=[],platform:s}=n,o=a.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let u=await s.getElementRects({reference:t,floating:e,strategy:i}),{x:c,y:d}=lH(u,r,l),h=r,f={},m=0;for(let x=0;x<o.length;x++){const{name:b,fn:y}=o[x],{x:w,y:_,data:S,reset:M}=await y({x:c,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:f,rects:u,platform:s,elements:{reference:t,floating:e}});c=w??c,d=_??d,f={...f,[b]:{...f[b],...S}},M&&m<=50&&(m++,typeof M=="object"&&(M.placement&&(h=M.placement),M.rects&&(u=M.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:i}):M.rects),{x:c,y:d}=lH(u,h,l)),x=-1)}return{x:c,y:d,placement:h,strategy:i,middlewareData:f}};async function L3(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:a,rects:s,elements:o,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:c="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=em(e,t),m=Aqe(f),b=o[h?d==="floating"?"reference":"floating":d],y=$w(await a.getClippingRect({element:(n=await(a.isElement==null?void 0:a.isElement(b)))==null||n?b:b.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(o.floating)),boundary:u,rootBoundary:c,strategy:l})),w=d==="floating"?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,_=await(a.getOffsetParent==null?void 0:a.getOffsetParent(o.floating)),S=await(a.isElement==null?void 0:a.isElement(_))?await(a.getScale==null?void 0:a.getScale(_))||{x:1,y:1}:{x:1,y:1},M=$w(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:w,offsetParent:_,strategy:l}):w);return{top:(y.top-M.top+m.top)/S.y,bottom:(M.bottom-y.bottom+m.bottom)/S.y,left:(y.left-M.left+m.left)/S.x,right:(M.right-y.right+m.right)/S.x}}const Iqe=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:a,rects:s,initialPlacement:o,platform:l,elements:u}=e,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:x=!0,...b}=em(t,e);if((n=a.arrow)!=null&&n.alignmentOffset)return{};const y=hd(i),w=Ru(o),_=hd(o)===o,S=await(l.isRTL==null?void 0:l.isRTL(u.floating)),M=h||(_||!x?[Hw(o)]:wqe(o)),E=m!=="none";!h&&E&&M.push(...Cqe(o,x,m,S));const C=[o,...M],R=await L3(e,b),k=[];let I=((r=a.flip)==null?void 0:r.overflows)||[];if(c&&k.push(R[y]),d){const L=_qe(i,s,S);k.push(R[L[0]],R[L[1]])}if(I=[...I,{placement:i,overflows:k}],!k.every(L=>L<=0)){var N,D;const L=(((N=a.flip)==null?void 0:N.index)||0)+1,U=C[L];if(U&&(!(d==="alignment"?w!==Ru(U):!1)||I.every(Z=>Ru(Z.placement)===w?Z.overflows[0]>0:!0)))return{data:{index:L,overflows:I},reset:{placement:U}};let j=(D=I.filter(q=>q.overflows[0]<=0).sort((q,Z)=>q.overflows[1]-Z.overflows[1])[0])==null?void 0:D.placement;if(!j)switch(f){case"bestFit":{var F;const q=(F=I.filter(Z=>{if(E){const Q=Ru(Z.placement);return Q===w||Q==="y"}return!0}).map(Z=>[Z.placement,Z.overflows.filter(Q=>Q>0).reduce((Q,z)=>Q+z,0)]).sort((Z,Q)=>Z[1]-Q[1])[0])==null?void 0:F[0];q&&(j=q);break}case"initialPlacement":j=o;break}if(i!==j)return{reset:{placement:j}}}return{}}}},Nqe=new Set(["left","top"]);async function Rqe(t,e){const{placement:n,platform:r,elements:i}=t,a=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=hd(n),o=Vv(n),l=Ru(n)==="y",u=Nqe.has(s)?-1:1,c=a&&l?-1:1,d=em(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof m=="number"&&(f=o==="end"?m*-1:m),l?{x:f*c,y:h*u}:{x:h*u,y:f*c}}const Pqe=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:a,placement:s,middlewareData:o}=e,l=await Rqe(e,t);return s===((n=o.offset)==null?void 0:n.placement)&&(r=o.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:a+l.y,data:{...l,placement:s}}}}},Dqe=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:a=!0,crossAxis:s=!1,limiter:o={fn:b=>{let{x:y,y:w}=b;return{x:y,y:w}}},...l}=em(t,e),u={x:n,y:r},c=await L3(e,l),d=Ru(hd(i)),h=wse(d);let f=u[h],m=u[d];if(a){const b=h==="y"?"top":"left",y=h==="y"?"bottom":"right",w=f+c[b],_=f-c[y];f=aH(w,f,_)}if(s){const b=d==="y"?"top":"left",y=d==="y"?"bottom":"right",w=m+c[b],_=m-c[y];m=aH(w,m,_)}const x=o.fn({...e,[h]:f,[d]:m});return{...x,data:{x:x.x-n,y:x.y-r,enabled:{[h]:a,[d]:s}}}}}},Oqe=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:a,platform:s,elements:o}=e,{apply:l=()=>{},...u}=em(t,e),c=await L3(e,u),d=hd(i),h=Vv(i),f=Ru(i)==="y",{width:m,height:x}=a.floating;let b,y;d==="top"||d==="bottom"?(b=d,y=h===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(y=d,b=h==="end"?"top":"bottom");const w=x-c.top-c.bottom,_=m-c.left-c.right,S=of(x-c[b],w),M=of(m-c[y],_),E=!e.middlewareData.shift;let C=S,R=M;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(R=_),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(C=w),E&&!h){const I=Pa(c.left,0),N=Pa(c.right,0),D=Pa(c.top,0),F=Pa(c.bottom,0);f?R=m-2*(I!==0||N!==0?I+N:Pa(c.left,c.right)):C=x-2*(D!==0||F!==0?D+F:Pa(c.top,c.bottom))}await l({...e,availableWidth:R,availableHeight:C});const k=await s.getDimensions(o.floating);return m!==k.width||x!==k.height?{reset:{rects:!0}}:{}}}};function Tse(t){const e=al(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=ql(t),a=i?t.offsetWidth:n,s=i?t.offsetHeight:r,o=tv(n)!==a||tv(r)!==s;return o&&(n=a,r=s),{width:n,height:r,$:o}}function _7(t){return ts(t)?t:t.contextElement}function i0(t){const e=_7(t);if(!ql(e))return zl(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:a}=Tse(e);let s=(a?tv(n.width):n.width)/r,o=(a?tv(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const Lqe=zl(0);function Cse(t){const e=Zs(t);return!b7()||!e.visualViewport?Lqe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Fqe(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Zs(t)?!1:e}function lf(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),a=_7(t);let s=zl(1);e&&(r?ts(r)&&(s=i0(r)):s=i0(t));const o=Fqe(a,n,r)?Cse(a):zl(0);let l=(i.left+o.x)/s.x,u=(i.top+o.y)/s.y,c=i.width/s.x,d=i.height/s.y;if(a){const h=Zs(a),f=r&&ts(r)?Zs(r):r;let m=h,x=cN(m);for(;x&&r&&f!==m;){const b=i0(x),y=x.getBoundingClientRect(),w=al(x),_=y.left+(x.clientLeft+parseFloat(w.paddingLeft))*b.x,S=y.top+(x.clientTop+parseFloat(w.paddingTop))*b.y;l*=b.x,u*=b.y,c*=b.x,d*=b.y,l+=_,u+=S,m=Zs(x),x=cN(m)}}return $w({width:c,height:d,x:l,y:u})}function F3(t,e){const n=O3(t).scrollLeft;return e?e.left+n:lf(eu(t)).left+n}function Mse(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-F3(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function Bqe(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const a=i==="fixed",s=eu(r),o=e?D3(e.floating):!1;if(r===s||o&&a)return n;let l={scrollLeft:0,scrollTop:0},u=zl(1);const c=zl(0),d=ql(r);if((d||!d&&!a)&&((Q0(r)!=="body"||$v(s))&&(l=O3(r)),ql(r))){const f=lf(r);u=i0(r),c.x=f.x+r.clientLeft,c.y=f.y+r.clientTop}const h=s&&!d&&!a?Mse(s,l):zl(0);return{width:n.width*u.x,height:n.height*u.y,x:n.x*u.x-l.scrollLeft*u.x+c.x+h.x,y:n.y*u.y-l.scrollTop*u.y+c.y+h.y}}function Uqe(t){return Array.from(t.getClientRects())}function zqe(t){const e=eu(t),n=O3(t),r=t.ownerDocument.body,i=Pa(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),a=Pa(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+F3(t);const o=-n.scrollTop;return al(r).direction==="rtl"&&(s+=Pa(e.clientWidth,r.clientWidth)-i),{width:i,height:a,x:s,y:o}}const uH=25;function jqe(t,e){const n=Zs(t),r=eu(t),i=n.visualViewport;let a=r.clientWidth,s=r.clientHeight,o=0,l=0;if(i){a=i.width,s=i.height;const c=b7();(!c||c&&e==="fixed")&&(o=i.offsetLeft,l=i.offsetTop)}const u=F3(r);if(u<=0){const c=r.ownerDocument,d=c.body,h=getComputedStyle(d),f=c.compatMode==="CSS1Compat"&&parseFloat(h.marginLeft)+parseFloat(h.marginRight)||0,m=Math.abs(r.clientWidth-d.clientWidth-f);m<=uH&&(a-=m)}else u<=uH&&(a+=u);return{width:a,height:s,x:o,y:l}}const Hqe=new Set(["absolute","fixed"]);function $qe(t,e){const n=lf(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,a=ql(t)?i0(t):zl(1),s=t.clientWidth*a.x,o=t.clientHeight*a.y,l=i*a.x,u=r*a.y;return{width:s,height:o,x:l,y:u}}function cH(t,e,n){let r;if(e==="viewport")r=jqe(t,n);else if(e==="document")r=zqe(eu(t));else if(ts(e))r=$qe(e,n);else{const i=Cse(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return $w(r)}function Ase(t,e){const n=dd(t);return n===e||!ts(n)||M0(n)?!1:al(n).position==="fixed"||Ase(n,e)}function Vqe(t,e){const n=e.get(t);if(n)return n;let r=ev(t,[],!1).filter(o=>ts(o)&&Q0(o)!=="body"),i=null;const a=al(t).position==="fixed";let s=a?dd(t):t;for(;ts(s)&&!M0(s);){const o=al(s),l=x7(s);!l&&o.position==="fixed"&&(i=null),(a?!l&&!i:!l&&o.position==="static"&&!!i&&Hqe.has(i.position)||$v(s)&&!l&&Ase(t,s))?r=r.filter(c=>c!==s):i=o,s=dd(s)}return e.set(t,r),r}function qqe(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const s=[...n==="clippingAncestors"?D3(e)?[]:Vqe(e,this._c):[].concat(n),r],o=s[0],l=s.reduce((u,c)=>{const d=cH(e,c,i);return u.top=Pa(d.top,u.top),u.right=of(d.right,u.right),u.bottom=of(d.bottom,u.bottom),u.left=Pa(d.left,u.left),u},cH(e,o,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Gqe(t){const{width:e,height:n}=Tse(t);return{width:e,height:n}}function Wqe(t,e,n){const r=ql(e),i=eu(e),a=n==="fixed",s=lf(t,!0,a,e);let o={scrollLeft:0,scrollTop:0};const l=zl(0);function u(){l.x=F3(i)}if(r||!r&&!a)if((Q0(e)!=="body"||$v(i))&&(o=O3(e)),r){const f=lf(e,!0,a,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&u();a&&!r&&i&&u();const c=i&&!r&&!a?Mse(i,o):zl(0),d=s.left+o.scrollLeft-l.x-c.x,h=s.top+o.scrollTop-l.y-c.y;return{x:d,y:h,width:s.width,height:s.height}}function YT(t){return al(t).position==="static"}function dH(t,e){if(!ql(t)||al(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return eu(t)===n&&(n=n.ownerDocument.body),n}function kse(t,e){const n=Zs(t);if(D3(t))return n;if(!ql(t)){let i=dd(t);for(;i&&!M0(i);){if(ts(i)&&!YT(i))return i;i=dd(i)}return n}let r=dH(t,e);for(;r&&cqe(r)&&YT(r);)r=dH(r,e);return r&&M0(r)&&YT(r)&&!x7(r)?n:r||mqe(t)||n}const Yqe=async function(t){const e=this.getOffsetParent||kse,n=this.getDimensions,r=await n(t.floating);return{reference:Wqe(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Xqe(t){return al(t).direction==="rtl"}const Kqe={convertOffsetParentRelativeRectToViewportRelativeRect:Bqe,getDocumentElement:eu,getClippingRect:qqe,getOffsetParent:kse,getElementRects:Yqe,getClientRects:Uqe,getDimensions:Gqe,getScale:i0,isElement:ts,isRTL:Xqe};function Ise(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Zqe(t,e){let n=null,r;const i=eu(t);function a(){var o;clearTimeout(r),(o=n)==null||o.disconnect(),n=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),a();const u=t.getBoundingClientRect(),{left:c,top:d,width:h,height:f}=u;if(o||e(),!h||!f)return;const m=wb(d),x=wb(i.clientWidth-(c+h)),b=wb(i.clientHeight-(d+f)),y=wb(c),_={rootMargin:-m+"px "+-x+"px "+-b+"px "+-y+"px",threshold:Pa(0,of(1,l))||1};let S=!0;function M(E){const C=E[0].intersectionRatio;if(C!==l){if(!S)return s();C?s(!1,C):r=setTimeout(()=>{s(!1,1e-7)},1e3)}C===1&&!Ise(u,t.getBoundingClientRect())&&s(),S=!1}try{n=new IntersectionObserver(M,{..._,root:i.ownerDocument})}catch{n=new IntersectionObserver(M,_)}n.observe(t)}return s(!0),a}function Jqe(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,u=_7(t),c=i||a?[...u?ev(u):[],...ev(e)]:[];c.forEach(y=>{i&&y.addEventListener("scroll",n,{passive:!0}),a&&y.addEventListener("resize",n)});const d=u&&o?Zqe(u,n):null;let h=-1,f=null;s&&(f=new ResizeObserver(y=>{let[w]=y;w&&w.target===u&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var _;(_=f)==null||_.observe(e)})),n()}),u&&!l&&f.observe(u),f.observe(e));let m,x=l?lf(t):null;l&&b();function b(){const y=lf(t);x&&!Ise(x,y)&&n(),x=y,m=requestAnimationFrame(b)}return n(),()=>{var y;c.forEach(w=>{i&&w.removeEventListener("scroll",n),a&&w.removeEventListener("resize",n)}),d?.(),(y=f)==null||y.disconnect(),f=null,l&&cancelAnimationFrame(m)}}const XT=L3,Qqe=Pqe,eGe=Dqe,tGe=Iqe,nGe=Oqe,rGe=(t,e,n)=>{const r=new Map,i={platform:Kqe,...n},a={...i.platform,_c:r};return kqe(t,e,{...i,platform:a})};var iGe=typeof document<"u",aGe=function(){},Zb=iGe?P.useLayoutEffect:aGe;function Vw(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!Vw(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const a=i[r];if(!(a==="_owner"&&t.$$typeof)&&!Vw(t[a],e[a]))return!1}return!0}return t!==t&&e!==e}function Nse(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function hH(t,e){const n=Nse(t);return Math.round(e*n)/n}function KT(t){const e=P.useRef(t);return Zb(()=>{e.current=t}),e}function sGe(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:a,floating:s}={},transform:o=!0,whileElementsMounted:l,open:u}=t,[c,d]=P.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=P.useState(r);Vw(h,r)||f(r);const[m,x]=P.useState(null),[b,y]=P.useState(null),w=P.useCallback(Z=>{Z!==E.current&&(E.current=Z,x(Z))},[]),_=P.useCallback(Z=>{Z!==C.current&&(C.current=Z,y(Z))},[]),S=a||m,M=s||b,E=P.useRef(null),C=P.useRef(null),R=P.useRef(c),k=l!=null,I=KT(l),N=KT(i),D=KT(u),F=P.useCallback(()=>{if(!E.current||!C.current)return;const Z={placement:e,strategy:n,middleware:h};N.current&&(Z.platform=N.current),rGe(E.current,C.current,Z).then(Q=>{const z={...Q,isPositioned:D.current!==!1};L.current&&!Vw(R.current,z)&&(R.current=z,Vu.flushSync(()=>{d(z)}))})},[h,e,n,N,D]);Zb(()=>{u===!1&&R.current.isPositioned&&(R.current.isPositioned=!1,d(Z=>({...Z,isPositioned:!1})))},[u]);const L=P.useRef(!1);Zb(()=>(L.current=!0,()=>{L.current=!1}),[]),Zb(()=>{if(S&&(E.current=S),M&&(C.current=M),S&&M){if(I.current)return I.current(S,M,F);F()}},[S,M,F,I,k]);const U=P.useMemo(()=>({reference:E,floating:C,setReference:w,setFloating:_}),[w,_]),j=P.useMemo(()=>({reference:S,floating:M}),[S,M]),q=P.useMemo(()=>{const Z={position:n,left:0,top:0};if(!j.floating)return Z;const Q=hH(j.floating,c.x),z=hH(j.floating,c.y);return o?{...Z,transform:"translate("+Q+"px, "+z+"px)",...Nse(j.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:Q,top:z}},[n,o,j.floating,c.x,c.y]);return P.useMemo(()=>({...c,update:F,refs:U,elements:j,floatingStyles:q}),[c,F,U,j,q])}const Rse=(t,e)=>({...Qqe(t),options:[t,e]}),oGe=(t,e)=>({...eGe(t),options:[t,e]}),lGe=(t,e)=>({...tGe(t),options:[t,e]}),uGe=(t,e)=>({...nGe(t),options:[t,e]}),Pse={...D6},cGe=Pse.useInsertionEffect,dGe=cGe||(t=>t());function Dse(t){const e=P.useRef(()=>{});return dGe(()=>{e.current=t}),P.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var hN=typeof document<"u"?P.useLayoutEffect:P.useEffect;let fH=!1,hGe=0;const pH=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+hGe++;function fGe(){const[t,e]=P.useState(()=>fH?pH():void 0);return hN(()=>{t==null&&e(pH())},[]),P.useEffect(()=>{fH=!0},[]),t}const pGe=Pse.useId,mGe=pGe||fGe;function gGe(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var r;t.set(e,((r=t.get(e))==null?void 0:r.filter(i=>i!==n))||[])}}}const vGe=P.createContext(null),yGe=P.createContext(null),xGe=()=>{var t;return((t=P.useContext(vGe))==null?void 0:t.id)||null},bGe=()=>P.useContext(yGe),_Ge="data-floating-ui-focusable";function wGe(t){const{open:e=!1,onOpenChange:n,elements:r}=t,i=mGe(),a=P.useRef({}),[s]=P.useState(()=>gGe()),o=xGe()!=null,[l,u]=P.useState(r.reference),c=Dse((f,m,x)=>{a.current.openEvent=f?m:void 0,s.emit("openchange",{open:f,event:m,reason:x,nested:o}),n?.(f,m,x)}),d=P.useMemo(()=>({setPositionReference:u}),[]),h=P.useMemo(()=>({reference:l||r.reference||null,floating:r.floating||null,domReference:r.reference}),[l,r.reference,r.floating]);return P.useMemo(()=>({dataRef:a,open:e,onOpenChange:c,elements:h,events:s,floatingId:i,refs:d}),[e,c,h,s,i,d])}function SGe(t){t===void 0&&(t={});const{nodeId:e}=t,n=wGe({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,i=r.elements,[a,s]=P.useState(null),[o,l]=P.useState(null),c=i?.domReference||a,d=P.useRef(null),h=bGe();hN(()=>{c&&(d.current=c)},[c]);const f=sGe({...t,elements:{...i,...o&&{reference:o}}}),m=P.useCallback(_=>{const S=ts(_)?{getBoundingClientRect:()=>_.getBoundingClientRect(),contextElement:_}:_;l(S),f.refs.setReference(S)},[f.refs]),x=P.useCallback(_=>{(ts(_)||_===null)&&(d.current=_,s(_)),(ts(f.refs.reference.current)||f.refs.reference.current===null||_!==null&&!ts(_))&&f.refs.setReference(_)},[f.refs]),b=P.useMemo(()=>({...f.refs,setReference:x,setPositionReference:m,domReference:d}),[f.refs,x,m]),y=P.useMemo(()=>({...f.elements,domReference:c}),[f.elements,c]),w=P.useMemo(()=>({...f,...r,refs:b,elements:y,nodeId:e}),[f,b,y,e,r]);return hN(()=>{r.dataRef.current.floatingContext=w;const _=h?.nodesRef.current.find(S=>S.id===e);_&&(_.context=w)}),P.useMemo(()=>({...f,context:w,refs:b,elements:y}),[f,b,y,w])}const mH="active",gH="selected";function ZT(t,e,n){const r=new Map,i=n==="item";let a=t;if(i&&t){const{[mH]:s,[gH]:o,...l}=t;a=l}return{...n==="floating"&&{tabIndex:-1,[_Ge]:""},...a,...e.map(s=>{const o=s?s[n]:null;return typeof o=="function"?t?o(t):null:o}).concat(t).reduce((s,o)=>(o&&Object.entries(o).forEach(l=>{let[u,c]=l;if(!(i&&[mH,gH].includes(u)))if(u.indexOf("on")===0){if(r.has(u)||r.set(u,[]),typeof c=="function"){var d;(d=r.get(u))==null||d.push(c),s[u]=function(){for(var h,f=arguments.length,m=new Array(f),x=0;x<f;x++)m[x]=arguments[x];return(h=r.get(u))==null?void 0:h.map(b=>b(...m)).find(b=>b!==void 0)}}}else s[u]=c}),s),{})}}function EGe(t){t===void 0&&(t=[]);const e=t.map(o=>o?.reference),n=t.map(o=>o?.floating),r=t.map(o=>o?.item),i=P.useCallback(o=>ZT(o,t,"reference"),e),a=P.useCallback(o=>ZT(o,t,"floating"),n),s=P.useCallback(o=>ZT(o,t,"item"),r);return P.useMemo(()=>({getReferenceProps:i,getFloatingProps:a,getItemProps:s}),[i,a,s])}function vH(t,e){return{...t,rects:{...t.rects,floating:{...t.rects.floating,height:e}}}}const TGe=t=>({name:"inner",options:t,async fn(e){const{listRef:n,overflowRef:r,onFallbackChange:i,offset:a=0,index:s=0,minItemsVisible:o=4,referenceOverflowThreshold:l=0,scrollRef:u,...c}=em(t,e),{rects:d,elements:{floating:h}}=e,f=n.current[s],m=u?.current||h,x=h.clientTop||m.clientTop,b=h.clientTop!==0,y=m.clientTop!==0,w=h===m;if(!f)return{};const _={...e,...await Rse(-f.offsetTop-h.clientTop-d.reference.height/2-f.offsetHeight/2-a).fn(e)},S=await XT(vH(_,m.scrollHeight+x+h.clientTop),c),M=await XT(_,{...c,elementContext:"reference"}),E=Pa(0,S.top),C=_.y+E,I=(m.scrollHeight>m.clientHeight?N=>N:tv)(Pa(0,m.scrollHeight+(b&&w||y?x*2:0)-E-Pa(0,S.bottom)));if(m.style.maxHeight=I+"px",m.scrollTop=E,i){const N=m.offsetHeight<f.offsetHeight*of(o,n.current.length)-1||M.top>=-l||M.bottom>=-l;Vu.flushSync(()=>i(N))}return r&&(r.current=await XT(vH({..._,y:C},m.offsetHeight+x+h.clientTop),c)),{y:C}}});function CGe(t,e){const{open:n,elements:r}=t,{enabled:i=!0,overflowRef:a,scrollRef:s,onChange:o}=e,l=Dse(o),u=P.useRef(!1),c=P.useRef(null),d=P.useRef(null);P.useEffect(()=>{if(!i)return;function f(x){if(x.ctrlKey||!m||a.current==null)return;const b=x.deltaY,y=a.current.top>=-.5,w=a.current.bottom>=-.5,_=m.scrollHeight-m.clientHeight,S=b<0?-1:1,M=b<0?"max":"min";m.scrollHeight<=m.clientHeight||(!y&&b>0||!w&&b<0?(x.preventDefault(),Vu.flushSync(()=>{l(E=>E+Math[M](b,_*S))})):/firefox/i.test(vqe())&&(m.scrollTop+=b))}const m=s?.current||r.floating;if(n&&m)return m.addEventListener("wheel",f),requestAnimationFrame(()=>{c.current=m.scrollTop,a.current!=null&&(d.current={...a.current})}),()=>{c.current=null,d.current=null,m.removeEventListener("wheel",f)}},[i,n,r.floating,a,s,l]);const h=P.useMemo(()=>({onKeyDown(){u.current=!0},onWheel(){u.current=!1},onPointerMove(){u.current=!1},onScroll(){const f=s?.current||r.floating;if(!(!a.current||!f||!u.current)){if(c.current!==null){const m=f.scrollTop-c.current;(a.current.bottom<-.5&&m<-1||a.current.top<-.5&&m>1)&&Vu.flushSync(()=>l(x=>x+m))}requestAnimationFrame(()=>{c.current=f.scrollTop})}}}),[r.floating,l,a,s]);return P.useMemo(()=>i?{floating:h}:{},[i,h])}let tm=P.createContext({styles:void 0,setReference:()=>{},setFloating:()=>{},getReferenceProps:()=>({}),getFloatingProps:()=>({}),slot:{}});tm.displayName="FloatingContext";let w7=P.createContext(null);w7.displayName="PlacementContext";function MGe(t){return P.useMemo(()=>t?typeof t=="string"?{to:t}:t:null,[t])}function AGe(){return P.useContext(tm).setReference}function kGe(){return P.useContext(tm).getReferenceProps}function IGe(){let{getFloatingProps:t,slot:e}=P.useContext(tm);return P.useCallback((...n)=>Object.assign({},t(...n),{"data-anchor":e.anchor}),[t,e])}function NGe(t=null){t===!1&&(t=null),typeof t=="string"&&(t={to:t});let e=P.useContext(w7),n=P.useMemo(()=>t,[JSON.stringify(t,(i,a)=>{var s;return(s=a?.outerHTML)!=null?s:a})]);Er(()=>{e?.(n??null)},[e,n]);let r=P.useContext(tm);return P.useMemo(()=>[r.setFloating,t?r.styles:{}],[r.setFloating,t,r.styles])}let yH=4;function RGe({children:t,enabled:e=!0}){let[n,r]=P.useState(null),[i,a]=P.useState(0),s=P.useRef(null),[o,l]=P.useState(null);PGe(o);let u=e&&n!==null&&o!==null,{to:c="bottom",gap:d=0,offset:h=0,padding:f=0,inner:m}=DGe(n,o),[x,b="center"]=c.split(" ");Er(()=>{u&&a(0)},[u]);let{refs:y,floatingStyles:w,context:_}=SGe({open:u,placement:x==="selection"?b==="center"?"bottom":`bottom-${b}`:b==="center"?`${x}`:`${x}-${b}`,strategy:"absolute",transform:!1,middleware:[Rse({mainAxis:x==="selection"?0:d,crossAxis:h}),oGe({padding:f}),x!=="selection"&&lGe({padding:f}),x==="selection"&&m?TGe({...m,padding:f,overflowRef:s,offset:i,minItemsVisible:yH,referenceOverflowThreshold:f,onFallbackChange(N){var D,F;if(!N)return;let L=_.elements.floating;if(!L)return;let U=parseFloat(getComputedStyle(L).scrollPaddingBottom)||0,j=Math.min(yH,L.childElementCount),q=0,Z=0;for(let Q of(F=(D=_.elements.floating)==null?void 0:D.childNodes)!=null?F:[])if(to(Q)){let z=Q.offsetTop,W=z+Q.clientHeight+U,X=L.scrollTop,H=X+L.clientHeight;if(z>=X&&W<=H)j--;else{Z=Math.max(0,Math.min(W,H)-Math.max(z,X)),q=Q.clientHeight;break}}j>=1&&a(Q=>{let z=q*j-Z+U;return Q>=z?Q:z})}}):null,uGe({padding:f,apply({availableWidth:N,availableHeight:D,elements:F}){Object.assign(F.floating.style,{overflow:"auto",maxWidth:`${N}px`,maxHeight:`min(var(--anchor-max-height, 100vh), ${D}px)`})}})].filter(Boolean),whileElementsMounted:Jqe}),[S=x,M=b]=_.placement.split("-");x==="selection"&&(S="selection");let E=P.useMemo(()=>({anchor:[S,M].filter(Boolean).join(" ")}),[S,M]),C=CGe(_,{overflowRef:s,onChange:a}),{getReferenceProps:R,getFloatingProps:k}=EGe([C]),I=an(N=>{l(N),y.setFloating(N)});return P.createElement(w7.Provider,{value:r},P.createElement(tm.Provider,{value:{setFloating:I,setReference:y.setReference,styles:w,getReferenceProps:R,getFloatingProps:k,slot:E}},t))}function PGe(t){Er(()=>{if(!t)return;let e=new MutationObserver(()=>{let n=window.getComputedStyle(t).maxHeight,r=parseFloat(n);if(isNaN(r))return;let i=parseInt(n);isNaN(i)||r!==i&&(t.style.maxHeight=`${Math.ceil(r)}px`)});return e.observe(t,{attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}},[t])}function DGe(t,e){var n,r,i;let a=JT((n=t?.gap)!=null?n:"var(--anchor-gap, 0)",e),s=JT((r=t?.offset)!=null?r:"var(--anchor-offset, 0)",e),o=JT((i=t?.padding)!=null?i:"var(--anchor-padding, 0)",e);return{...t,gap:a,offset:s,padding:o}}function JT(t,e,n=void 0){let r=Tf(),i=an((l,u)=>{if(l==null)return[n,null];if(typeof l=="number")return[l,null];if(typeof l=="string"){if(!u)return[n,null];let c=xH(l,u);return[c,d=>{let h=Ose(l);{let f=h.map(m=>window.getComputedStyle(u).getPropertyValue(m));r.requestAnimationFrame(function m(){r.nextFrame(m);let x=!1;for(let[y,w]of h.entries()){let _=window.getComputedStyle(u).getPropertyValue(w);if(f[y]!==_){f[y]=_,x=!0;break}}if(!x)return;let b=xH(l,u);c!==b&&(d(b),c=b)})}return r.dispose}]}return[n,null]}),a=P.useMemo(()=>i(t,e)[0],[t,e]),[s=a,o]=P.useState();return Er(()=>{let[l,u]=i(t,e);if(o(l),!!u)return u(o)},[t,e]),s}function Ose(t){let e=/var\((.*)\)/.exec(t);if(e){let n=e[1].indexOf(",");if(n===-1)return[e[1]];let r=e[1].slice(0,n).trim(),i=e[1].slice(n+1).trim();return i?[r,...Ose(i)]:[r]}return[]}function xH(t,e){let n=document.createElement("div");e.appendChild(n),n.style.setProperty("margin-top","0px","important"),n.style.setProperty("margin-top",t,"important");let r=parseFloat(window.getComputedStyle(n).marginTop)||0;return e.removeChild(n),r}let B3=P.createContext(null);B3.displayName="OpenClosedContext";var ns=(t=>(t[t.Open=1]="Open",t[t.Closed=2]="Closed",t[t.Closing=4]="Closing",t[t.Opening=8]="Opening",t))(ns||{});function qv(){return P.useContext(B3)}function Lse({value:t,children:e}){return Xt.createElement(B3.Provider,{value:t},e)}function OGe({children:t}){return Xt.createElement(B3.Provider,{value:null},t)}function LGe(t){function e(){document.readyState!=="loading"&&(t(),document.removeEventListener("DOMContentLoaded",e))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",e),e())}let Hc=[];LGe(()=>{function t(e){if(!Ll(e.target)||e.target===document.body||Hc[0]===e.target)return;let n=e.target;n=n.closest(jw),Hc.unshift(n??e.target),Hc=Hc.filter(r=>r!=null&&r.isConnected),Hc.splice(10)}window.addEventListener("click",t,{capture:!0}),window.addEventListener("mousedown",t,{capture:!0}),window.addEventListener("focus",t,{capture:!0}),document.body.addEventListener("click",t,{capture:!0}),document.body.addEventListener("mousedown",t,{capture:!0}),document.body.addEventListener("focus",t,{capture:!0})});function FGe(t){throw new Error("Unexpected object: "+t)}var zi=(t=>(t[t.First=0]="First",t[t.Previous=1]="Previous",t[t.Next=2]="Next",t[t.Last=3]="Last",t[t.Specific=4]="Specific",t[t.Nothing=5]="Nothing",t))(zi||{});function Sb(t,e){let n=e.resolveItems();if(n.length<=0)return null;let r=e.resolveActiveIndex(),i=r??-1;switch(t.focus){case 0:{for(let a=0;a<n.length;++a)if(!e.resolveDisabled(n[a],a,n))return a;return r}case 1:{i===-1&&(i=n.length);for(let a=i-1;a>=0;--a)if(!e.resolveDisabled(n[a],a,n))return a;return r}case 2:{for(let a=i+1;a<n.length;++a)if(!e.resolveDisabled(n[a],a,n))return a;return r}case 3:{for(let a=n.length-1;a>=0;--a)if(!e.resolveDisabled(n[a],a,n))return a;return r}case 4:{for(let a=0;a<n.length;++a)if(e.resolveId(n[a],a,n)===t.id)return a;return r}case 5:return null;default:FGe(t)}}function S7(t){let e=an(t),n=P.useRef(!1);P.useEffect(()=>(n.current=!1,()=>{n.current=!0,jv(()=>{n.current&&e()})}),[e])}let Fse=P.createContext(!1);function BGe(){return P.useContext(Fse)}function bH(t){return Xt.createElement(Fse.Provider,{value:t.force},t.children)}function UGe(t){let e=BGe(),n=P.useContext(Use),[r,i]=P.useState(()=>{var a;if(!e&&n!==null)return(a=n.current)!=null?a:null;if(Bl.isServer)return null;let s=t?.getElementById("headlessui-portal-root");if(s)return s;if(t===null)return null;let o=t.createElement("div");return o.setAttribute("id","headlessui-portal-root"),t.body.appendChild(o)});return P.useEffect(()=>{r!==null&&(t!=null&&t.body.contains(r)||t==null||t.body.appendChild(r))},[r,t]),P.useEffect(()=>{e||n!==null&&i(n.current)},[n,i,e]),r}let Bse=P.Fragment,zGe=Br(function(t,e){let{ownerDocument:n=null,...r}=t,i=P.useRef(null),a=qi(hVe(h=>{i.current=h}),e),s=Q1(i.current),o=n??s,l=UGe(o),u=P.useContext(fN),c=Tf(),d=qr();return S7(()=>{var h;l&&l.childNodes.length<=0&&((h=l.parentElement)==null||h.removeChild(l))}),l?Vu.createPortal(Xt.createElement("div",{"data-headlessui-portal":"",ref:h=>{c.dispose(),u&&h&&c.add(u.register(h))}},d({ourProps:{ref:a},theirProps:r,slot:{},defaultTag:Bse,name:"Portal"})),l):null});function jGe(t,e){let n=qi(e),{enabled:r=!0,ownerDocument:i,...a}=t,s=qr();return r?Xt.createElement(zGe,{...a,ownerDocument:i,ref:n}):s({ourProps:{ref:n},theirProps:a,slot:{},defaultTag:Bse,name:"Portal"})}let HGe=P.Fragment,Use=P.createContext(null);function $Ge(t,e){let{target:n,...r}=t,i={ref:qi(e)},a=qr();return Xt.createElement(Use.Provider,{value:n},a({ourProps:i,theirProps:r,defaultTag:HGe,name:"Popover.Group"}))}let fN=P.createContext(null);function VGe(){let t=P.useContext(fN),e=P.useRef([]),n=an(a=>(e.current.push(a),t&&t.register(a),()=>r(a))),r=an(a=>{let s=e.current.indexOf(a);s!==-1&&e.current.splice(s,1),t&&t.unregister(a)}),i=P.useMemo(()=>({register:n,unregister:r,portals:e}),[n,r,e]);return[e,P.useMemo(()=>function({children:a}){return Xt.createElement(fN.Provider,{value:i},a)},[i])]}let qGe=Br(jGe),zse=Br($Ge),jse=Object.assign(qGe,{Group:zse});const Jb={Idle:{kind:"Idle"},Tracked:t=>({kind:"Tracked",position:t}),Moved:{kind:"Moved"}};function Hse(t){let e=t.getBoundingClientRect();return`${e.x},${e.y}`}function GGe(t,e,n){let r=As();if(e.kind==="Tracked"){let i=function(){a!==Hse(t)&&(r.dispose(),n())},{position:a}=e,s=new ResizeObserver(i);s.observe(t),r.add(()=>s.disconnect()),r.addEventListener(window,"scroll",i,{passive:!0}),r.addEventListener(window,"resize",i)}return()=>r.dispose()}function WGe(t,e=typeof document<"u"?document.defaultView:null,n){let r=Hv(t,"escape");mse(e,"keydown",i=>{r&&(i.defaultPrevented||i.key===Mr.Escape&&n(i))})}function YGe(){var t;let[e]=P.useState(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: coarse)"):null),[n,r]=P.useState((t=e?.matches)!=null?t:!1);return Er(()=>{if(!e)return;function i(a){r(a.matches)}return e.addEventListener("change",i),()=>e.removeEventListener("change",i)},[e]),n}function XGe({defaultContainers:t=[],portals:e,mainTreeNode:n}={}){let r=an(()=>{var i,a;let s=Ef(n),o=[];for(let l of t)l!==null&&(Bu(l)?o.push(l):"current"in l&&Bu(l.current)&&o.push(l.current));if(e!=null&&e.current)for(let l of e.current)o.push(l);for(let l of(i=s?.querySelectorAll("html > *, body > *"))!=null?i:[])l!==document.body&&l!==document.head&&Bu(l)&&l.id!=="headlessui-portal-root"&&(n&&(l.contains(n)||l.contains((a=n?.getRootNode())==null?void 0:a.host))||o.some(u=>l.contains(u))||o.push(l));return o});return{resolveContainers:r,contains:an(i=>r().some(a=>a.contains(i)))}}let $se=P.createContext(null);function _H({children:t,node:e}){let[n,r]=P.useState(null),i=Vse(e??n);return Xt.createElement($se.Provider,{value:i},t,i===null&&Xt.createElement(J1,{features:Z1.Hidden,ref:a=>{var s,o;if(a){for(let l of(o=(s=Ef(a))==null?void 0:s.querySelectorAll("html > *, body > *"))!=null?o:[])if(l!==document.body&&l!==document.head&&Bu(l)&&l!=null&&l.contains(a)){r(l);break}}}}))}function Vse(t=null){var e;return(e=P.useContext($se))!=null?e:t}function KGe(){let t=typeof document>"u";return"useSyncExternalStore"in D6?(e=>e.useSyncExternalStore)(D6)(()=>()=>{},()=>!1,()=>!t):!1}function U3(){let t=KGe(),[e,n]=P.useState(Bl.isHandoffComplete);return e&&Bl.isHandoffComplete===!1&&n(!1),P.useEffect(()=>{e!==!0&&n(!0)},[e]),P.useEffect(()=>Bl.handoff(),[]),t?!1:e}function z3(){let t=P.useRef(!1);return Er(()=>(t.current=!0,()=>{t.current=!1}),[]),t}var Sg=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(Sg||{});function ZGe(){let t=P.useRef(0);return fse(!0,"keydown",e=>{e.key==="Tab"&&(t.current=e.shiftKey?1:0)},!0),t}function qse(t){if(!t)return new Set;if(typeof t=="function")return new Set(t());let e=new Set;for(let n of t.current)Bu(n.current)&&e.add(n.current);return e}let JGe="div";var _h=(t=>(t[t.None=0]="None",t[t.InitialFocus=1]="InitialFocus",t[t.TabLock=2]="TabLock",t[t.FocusLock=4]="FocusLock",t[t.RestoreFocus=8]="RestoreFocus",t[t.AutoFocus=16]="AutoFocus",t))(_h||{});function QGe(t,e){let n=P.useRef(null),r=qi(n,e),{initialFocus:i,initialFocusFallback:a,containers:s,features:o=15,...l}=t;U3()||(o=0);let u=Q1(n.current);rWe(o,{ownerDocument:u});let c=iWe(o,{ownerDocument:u,container:n,initialFocus:i,initialFocusFallback:a});aWe(o,{ownerDocument:u,container:n,containers:s,previousActiveElement:c});let d=ZGe(),h=an(w=>{if(!to(n.current))return;let _=n.current;(S=>S())(()=>{La(d.current,{[Sg.Forwards]:()=>{fo(_,wi.First,{skipElements:[w.relatedTarget,a]})},[Sg.Backwards]:()=>{fo(_,wi.Last,{skipElements:[w.relatedTarget,a]})}})})}),f=Hv(!!(o&2),"focus-trap#tab-lock"),m=Tf(),x=P.useRef(!1),b={ref:r,onKeyDown(w){w.key=="Tab"&&(x.current=!0,m.requestAnimationFrame(()=>{x.current=!1}))},onBlur(w){if(!(o&4))return;let _=qse(s);to(n.current)&&_.add(n.current);let S=w.relatedTarget;Ll(S)&&S.dataset.headlessuiFocusGuard!=="true"&&(Gse(_,S)||(x.current?fo(n.current,La(d.current,{[Sg.Forwards]:()=>wi.Next,[Sg.Backwards]:()=>wi.Previous})|wi.WrapAround,{relativeTo:w.target}):Ll(w.target)&&Ul(w.target)))}},y=qr();return Xt.createElement(Xt.Fragment,null,f&&Xt.createElement(J1,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:h,features:Z1.Focusable}),y({ourProps:b,theirProps:l,defaultTag:JGe,name:"FocusTrap"}),f&&Xt.createElement(J1,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:h,features:Z1.Focusable}))}let eWe=Br(QGe),tWe=Object.assign(eWe,{features:_h});function nWe(t=!0){let e=P.useRef(Hc.slice());return y7(([n],[r])=>{r===!0&&n===!1&&jv(()=>{e.current.splice(0)}),r===!1&&n===!0&&(e.current=Hc.slice())},[t,Hc,e]),an(()=>{var n;return(n=e.current.find(r=>r!=null&&r.isConnected))!=null?n:null})}function rWe(t,{ownerDocument:e}){let n=!!(t&8),r=nWe(n);y7(()=>{n||Vae(e?.body)&&Ul(r())},[n]),S7(()=>{n&&Ul(r())})}function iWe(t,{ownerDocument:e,container:n,initialFocus:r,initialFocusFallback:i}){let a=P.useRef(null),s=Hv(!!(t&1),"focus-trap#initial-focus"),o=z3();return y7(()=>{if(t===0)return;if(!s){i!=null&&i.current&&Ul(i.current);return}let l=n.current;l&&jv(()=>{if(!o.current)return;let u=e?.activeElement;if(r!=null&&r.current){if(r?.current===u){a.current=u;return}}else if(l.contains(u)){a.current=u;return}if(r!=null&&r.current)Ul(r.current);else{if(t&16){if(fo(l,wi.First|wi.AutoFocus)!==kh.Error)return}else if(fo(l,wi.First)!==kh.Error)return;if(i!=null&&i.current&&(Ul(i.current),e?.activeElement===i.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}a.current=e?.activeElement})},[i,s,t]),a}function aWe(t,{ownerDocument:e,container:n,containers:r,previousActiveElement:i}){let a=z3(),s=!!(t&4);mse(e?.defaultView,"focus",o=>{if(!s||!a.current)return;let l=qse(r);to(n.current)&&l.add(n.current);let u=i.current;if(!u)return;let c=o.target;to(c)?Gse(l,c)?(i.current=c,Ul(c)):(o.preventDefault(),o.stopPropagation(),Ul(u)):Ul(i.current)},!0)}function Gse(t,e){for(let n of t)if(n.contains(e))return!0;return!1}function Wse(t){var e;return!!(t.enter||t.enterFrom||t.enterTo||t.leave||t.leaveFrom||t.leaveTo)||!n1((e=t.as)!=null?e:Xse)||Xt.Children.count(t.children)===1}let j3=P.createContext(null);j3.displayName="TransitionContext";var sWe=(t=>(t.Visible="visible",t.Hidden="hidden",t))(sWe||{});function oWe(){let t=P.useContext(j3);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}function lWe(){let t=P.useContext(H3);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}let H3=P.createContext(null);H3.displayName="NestingContext";function $3(t){return"children"in t?$3(t.children):t.current.filter(({el:e})=>e.current!==null).filter(({state:e})=>e==="visible").length>0}function Yse(t,e){let n=Jo(t),r=P.useRef([]),i=z3(),a=Tf(),s=an((f,m=Xc.Hidden)=>{let x=r.current.findIndex(({el:b})=>b===f);x!==-1&&(La(m,{[Xc.Unmount](){r.current.splice(x,1)},[Xc.Hidden](){r.current[x].state="hidden"}}),a.microTask(()=>{var b;!$3(r)&&i.current&&((b=n.current)==null||b.call(n))}))}),o=an(f=>{let m=r.current.find(({el:x})=>x===f);return m?m.state!=="visible"&&(m.state="visible"):r.current.push({el:f,state:"visible"}),()=>s(f,Xc.Unmount)}),l=P.useRef([]),u=P.useRef(Promise.resolve()),c=P.useRef({enter:[],leave:[]}),d=an((f,m,x)=>{l.current.splice(0),e&&(e.chains.current[m]=e.chains.current[m].filter(([b])=>b!==f)),e?.chains.current[m].push([f,new Promise(b=>{l.current.push(b)})]),e?.chains.current[m].push([f,new Promise(b=>{Promise.all(c.current[m].map(([y,w])=>w)).then(()=>b())})]),m==="enter"?u.current=u.current.then(()=>e?.wait.current).then(()=>x(m)):x(m)}),h=an((f,m,x)=>{Promise.all(c.current[m].splice(0).map(([b,y])=>y)).then(()=>{var b;(b=l.current.shift())==null||b()}).then(()=>x(m))});return P.useMemo(()=>({children:r,register:o,unregister:s,onStart:d,onStop:h,wait:u,chains:c}),[o,s,r,d,h,c,u])}let Xse=P.Fragment,Kse=cd.RenderStrategy;function uWe(t,e){var n,r;let{transition:i=!0,beforeEnter:a,afterEnter:s,beforeLeave:o,afterLeave:l,enter:u,enterFrom:c,enterTo:d,entered:h,leave:f,leaveFrom:m,leaveTo:x,...b}=t,[y,w]=P.useState(null),_=P.useRef(null),S=Wse(t),M=qi(...S?[_,e,w]:e===null?[]:[e]),E=(n=b.unmount)==null||n?Xc.Unmount:Xc.Hidden,{show:C,appear:R,initial:k}=oWe(),[I,N]=P.useState(C?"visible":"hidden"),D=lWe(),{register:F,unregister:L}=D;Er(()=>F(_),[F,_]),Er(()=>{if(E===Xc.Hidden&&_.current){if(C&&I!=="visible"){N("visible");return}return La(I,{hidden:()=>L(_),visible:()=>F(_)})}},[I,_,F,L,C,E]);let U=U3();Er(()=>{if(S&&U&&I==="visible"&&_.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[_,I,U,S]);let j=k&&!R,q=R&&C&&k,Z=P.useRef(!1),Q=Yse(()=>{Z.current||(N("hidden"),L(_))},D),z=an(se=>{Z.current=!0;let ue=se?"enter":"leave";Q.onStart(_,ue,oe=>{oe==="enter"?a?.():oe==="leave"&&o?.()})}),W=an(se=>{let ue=se?"enter":"leave";Z.current=!1,Q.onStop(_,ue,oe=>{oe==="enter"?s?.():oe==="leave"&&l?.()}),ue==="leave"&&!$3(Q)&&(N("hidden"),L(_))});P.useEffect(()=>{S&&i||(z(C),W(C))},[C,S,i]);let X=!(!i||!S||!U||j),[,H]=xse(X,y,C,{start:z,end:W}),J=vh({ref:M,className:((r=lN(b.className,q&&u,q&&c,H.enter&&u,H.enter&&H.closed&&c,H.enter&&!H.closed&&d,H.leave&&f,H.leave&&!H.closed&&m,H.leave&&H.closed&&x,!H.transition&&C&&h))==null?void 0:r.trim())||void 0,...yse(H)}),te=0;I==="visible"&&(te|=ns.Open),I==="hidden"&&(te|=ns.Closed),C&&I==="hidden"&&(te|=ns.Opening),!C&&I==="visible"&&(te|=ns.Closing);let ee=qr();return Xt.createElement(H3.Provider,{value:Q},Xt.createElement(Lse,{value:te},ee({ourProps:J,theirProps:b,defaultTag:Xse,features:Kse,visible:I==="visible",name:"Transition.Child"})))}function cWe(t,e){let{show:n,appear:r=!1,unmount:i=!0,...a}=t,s=P.useRef(null),o=Wse(t),l=qi(...o?[s,e]:e===null?[]:[e]);U3();let u=qv();if(n===void 0&&u!==null&&(n=(u&ns.Open)===ns.Open),n===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[c,d]=P.useState(n?"visible":"hidden"),h=Yse(()=>{n||d("hidden")}),[f,m]=P.useState(!0),x=P.useRef([n]);Er(()=>{f!==!1&&x.current[x.current.length-1]!==n&&(x.current.push(n),m(!1))},[x,n]);let b=P.useMemo(()=>({show:n,appear:r,initial:f}),[n,r,f]);Er(()=>{n?d("visible"):!$3(h)&&s.current!==null&&d("hidden")},[n,h]);let y={unmount:i},w=an(()=>{var M;f&&m(!1),(M=t.beforeEnter)==null||M.call(t)}),_=an(()=>{var M;f&&m(!1),(M=t.beforeLeave)==null||M.call(t)}),S=qr();return Xt.createElement(H3.Provider,{value:h},Xt.createElement(j3.Provider,{value:b},S({ourProps:{...y,as:P.Fragment,children:Xt.createElement(Zse,{ref:l,...y,...a,beforeEnter:w,beforeLeave:_})},theirProps:{},defaultTag:P.Fragment,features:Kse,visible:c==="visible",name:"Transition"})))}function dWe(t,e){let n=P.useContext(j3)!==null,r=qv()!==null;return Xt.createElement(Xt.Fragment,null,!n&&r?Xt.createElement(pN,{ref:e,...t}):Xt.createElement(Zse,{ref:e,...t}))}let pN=Br(cWe),Zse=Br(uWe),E7=Br(dWe),zn=Object.assign(pN,{Child:E7,Root:pN});var hWe=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(hWe||{}),fWe=(t=>(t[t.SetTitleId=0]="SetTitleId",t))(fWe||{});let pWe={0(t,e){return t.titleId===e.id?t:{...t,titleId:e.id}}},T7=P.createContext(null);T7.displayName="DialogContext";function V3(t){let e=P.useContext(T7);if(e===null){let n=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,V3),n}return e}function mWe(t,e){return La(e.type,pWe,t,e)}let wH=Br(function(t,e){let n=P.useId(),{id:r=`headlessui-dialog-${n}`,open:i,onClose:a,initialFocus:s,role:o="dialog",autoFocus:l=!0,__demoMode:u=!1,unmount:c=!1,...d}=t,h=P.useRef(!1);o=(function(){return o==="dialog"||o==="alertdialog"?o:(h.current||(h.current=!0,console.warn(`Invalid role [${o}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")})();let f=qv();i===void 0&&f!==null&&(i=(f&ns.Open)===ns.Open);let m=P.useRef(null),x=qi(m,e),b=Q1(m.current),y=i?0:1,[w,_]=P.useReducer(mWe,{titleId:null,descriptionId:null,panelRef:P.createRef()}),S=an(()=>a(!1)),M=an(H=>_({type:0,id:H})),E=U3()?y===0:!1,[C,R]=VGe(),k={get current(){var H;return(H=w.panelRef.current)!=null?H:m.current}},I=Vse(),{resolveContainers:N}=XGe({mainTreeNode:I,portals:C,defaultContainers:[k]}),D=f!==null?(f&ns.Closing)===ns.Closing:!1;lse(u||D?!1:E,{allowed:an(()=>{var H,J;return[(J=(H=m.current)==null?void 0:H.closest("[data-headlessui-portal]"))!=null?J:null]}),disallowed:an(()=>{var H;return[(H=I?.closest("body > *:not(#headlessui-portal-root)"))!=null?H:null]})});let F=R3.get(null);Er(()=>{if(E)return F.actions.push(r),()=>F.actions.pop(r)},[F,r,E]);let L=mo(F,P.useCallback(H=>F.selectors.isTop(H,r),[F,r]));pse(L,N,H=>{H.preventDefault(),S()}),WGe(L,b?.defaultView,H=>{H.preventDefault(),H.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),S()}),vse(u||D?!1:E,b,N),use(E,m,S);let[U,j]=Qae(),q=P.useMemo(()=>[{dialogState:y,close:S,setTitleId:M,unmount:c},w],[y,S,M,c,w]),Z=ss({open:y===0}),Q={ref:x,id:r,role:o,tabIndex:-1,"aria-modal":u?void 0:y===0?!0:void 0,"aria-labelledby":w.titleId,"aria-describedby":U,unmount:c},z=!YGe(),W=_h.None;E&&!u&&(W|=_h.RestoreFocus,W|=_h.TabLock,l&&(W|=_h.AutoFocus),z&&(W|=_h.InitialFocus));let X=qr();return Xt.createElement(OGe,null,Xt.createElement(bH,{force:!0},Xt.createElement(jse,null,Xt.createElement(T7.Provider,{value:q},Xt.createElement(zse,{target:m},Xt.createElement(bH,{force:!1},Xt.createElement(j,{slot:Z},Xt.createElement(R,null,Xt.createElement(tWe,{initialFocus:s,initialFocusFallback:m,containers:N,features:W},Xt.createElement(wVe,{value:S},X({ourProps:Q,theirProps:d,slot:Z,defaultTag:gWe,features:vWe,visible:y===0,name:"Dialog"})))))))))))}),gWe="div",vWe=cd.RenderStrategy|cd.Static;function yWe(t,e){let{transition:n=!1,open:r,...i}=t,a=qv(),s=t.hasOwnProperty("open")||a!==null,o=t.hasOwnProperty("onClose");if(!s&&!o)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!s)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!o)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!a&&typeof t.open!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${t.open}`);if(typeof t.onClose!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${t.onClose}`);return(r!==void 0||n)&&!i.static?Xt.createElement(_H,null,Xt.createElement(zn,{show:r,transition:n,unmount:i.unmount},Xt.createElement(wH,{ref:e,...i}))):Xt.createElement(_H,null,Xt.createElement(wH,{ref:e,open:r,...i}))}let xWe="div";function bWe(t,e){let n=P.useId(),{id:r=`headlessui-dialog-panel-${n}`,transition:i=!1,...a}=t,[{dialogState:s,unmount:o},l]=V3("Dialog.Panel"),u=qi(e,l.panelRef),c=ss({open:s===0}),d=an(b=>{b.stopPropagation()}),h={ref:u,id:r,onClick:d},f=i?E7:P.Fragment,m=i?{unmount:o}:{},x=qr();return Xt.createElement(f,{...m},x({ourProps:h,theirProps:a,slot:c,defaultTag:xWe,name:"Dialog.Panel"}))}let _We="div";function wWe(t,e){let{transition:n=!1,...r}=t,[{dialogState:i,unmount:a}]=V3("Dialog.Backdrop"),s=ss({open:i===0}),o={ref:e,"aria-hidden":!0},l=n?E7:P.Fragment,u=n?{unmount:a}:{},c=qr();return Xt.createElement(l,{...u},c({ourProps:o,theirProps:r,slot:s,defaultTag:_We,name:"Dialog.Backdrop"}))}let SWe="h2";function EWe(t,e){let n=P.useId(),{id:r=`headlessui-dialog-title-${n}`,...i}=t,[{dialogState:a,setTitleId:s}]=V3("Dialog.Title"),o=qi(e);P.useEffect(()=>(s(r),()=>s(null)),[r,s]);let l=ss({open:a===0}),u={ref:o,id:r};return qr()({ourProps:u,theirProps:i,slot:l,defaultTag:SWe,name:"Dialog.Title"})}let TWe=Br(yWe),CWe=Br(bWe);Br(wWe);let MWe=Br(EWe),ar=Object.assign(TWe,{Panel:CWe,Title:MWe,Description:gVe}),SH=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function EH(t){var e,n;let r=(e=t.innerText)!=null?e:"",i=t.cloneNode(!0);if(!to(i))return r;let a=!1;for(let o of i.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))o.remove(),a=!0;let s=a?(n=i.innerText)!=null?n:"":r;return SH.test(s)&&(s=s.replace(SH,"")),s}function AWe(t){let e=t.getAttribute("aria-label");if(typeof e=="string")return e.trim();let n=t.getAttribute("aria-labelledby");if(n){let r=n.split(" ").map(i=>{let a=document.getElementById(i);if(a){let s=a.getAttribute("aria-label");return typeof s=="string"?s.trim():EH(a).trim()}return null}).filter(Boolean);if(r.length>0)return r.join(", ")}return EH(t).trim()}function kWe(t){let e=P.useRef(""),n=P.useRef("");return an(()=>{let r=t.current;if(!r)return"";let i=r.innerText;if(e.current===i)return n.current;let a=AWe(r).trim().toLowerCase();return e.current=i,n.current=a,a})}var IWe=Object.defineProperty,NWe=(t,e,n)=>e in t?IWe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,TH=(t,e,n)=>(NWe(t,typeof e!="symbol"?e+"":e,n),n),Ra=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Ra||{}),qw=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(qw||{}),Rr=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItems=5]="RegisterItems",t[t.UnregisterItems=6]="UnregisterItems",t[t.SetButtonElement=7]="SetButtonElement",t[t.SetItemsElement=8]="SetItemsElement",t[t.SortItems=9]="SortItems",t[t.MarkButtonAsMoved=10]="MarkButtonAsMoved",t))(Rr||{});function CH(t,e=n=>n){let n=t.activeItemIndex!==null?t.items[t.activeItemIndex]:null,r=Ih(e(t.items.slice()),a=>a.dataRef.current.domRef.current),i=n?r.indexOf(n):null;return i===-1&&(i=null),{items:r,activeItemIndex:i}}let RWe={1(t){if(t.menuState===1)return t;let e=t.buttonElement?Jb.Tracked(Hse(t.buttonElement)):t.buttonPositionState;return{...t,activeItemIndex:null,pendingFocus:{focus:zi.Nothing},menuState:1,buttonPositionState:e}},0(t,e){return t.menuState===0?t:{...t,__demoMode:!1,pendingFocus:e.focus,menuState:0,buttonPositionState:Jb.Idle}},2:(t,e)=>{var n,r,i,a,s;if(t.menuState===1)return t;let o={...t,searchQuery:"",activationTrigger:(n=e.trigger)!=null?n:1,__demoMode:!1};if(e.focus===zi.Nothing)return{...o,activeItemIndex:null};if(e.focus===zi.Specific)return{...o,activeItemIndex:t.items.findIndex(c=>c.id===e.id)};if(e.focus===zi.Previous){let c=t.activeItemIndex;if(c!==null){let d=t.items[c].dataRef.current.domRef,h=Sb(e,{resolveItems:()=>t.items,resolveActiveIndex:()=>t.activeItemIndex,resolveId:f=>f.id,resolveDisabled:f=>f.dataRef.current.disabled});if(h!==null){let f=t.items[h].dataRef.current.domRef;if(((r=d.current)==null?void 0:r.previousElementSibling)===f.current||((i=f.current)==null?void 0:i.previousElementSibling)===null)return{...o,activeItemIndex:h}}}}else if(e.focus===zi.Next){let c=t.activeItemIndex;if(c!==null){let d=t.items[c].dataRef.current.domRef,h=Sb(e,{resolveItems:()=>t.items,resolveActiveIndex:()=>t.activeItemIndex,resolveId:f=>f.id,resolveDisabled:f=>f.dataRef.current.disabled});if(h!==null){let f=t.items[h].dataRef.current.domRef;if(((a=d.current)==null?void 0:a.nextElementSibling)===f.current||((s=f.current)==null?void 0:s.nextElementSibling)===null)return{...o,activeItemIndex:h}}}}let l=CH(t),u=Sb(e,{resolveItems:()=>l.items,resolveActiveIndex:()=>l.activeItemIndex,resolveId:c=>c.id,resolveDisabled:c=>c.dataRef.current.disabled});return{...o,...l,activeItemIndex:u}},3:(t,e)=>{let n=t.searchQuery!==""?0:1,r=t.searchQuery+e.value.toLowerCase(),i=(t.activeItemIndex!==null?t.items.slice(t.activeItemIndex+n).concat(t.items.slice(0,t.activeItemIndex+n)):t.items).find(s=>{var o;return((o=s.dataRef.current.textValue)==null?void 0:o.startsWith(r))&&!s.dataRef.current.disabled}),a=i?t.items.indexOf(i):-1;return a===-1||a===t.activeItemIndex?{...t,searchQuery:r}:{...t,searchQuery:r,activeItemIndex:a,activationTrigger:1}},4(t){return t.searchQuery===""?t:{...t,searchQuery:"",searchActiveItemIndex:null}},5:(t,e)=>{let n=t.items.concat(e.items.map(i=>i)),r=t.activeItemIndex;return t.pendingFocus.focus!==zi.Nothing&&(r=Sb(t.pendingFocus,{resolveItems:()=>n,resolveActiveIndex:()=>t.activeItemIndex,resolveId:i=>i.id,resolveDisabled:i=>i.dataRef.current.disabled})),{...t,items:n,activeItemIndex:r,pendingFocus:{focus:zi.Nothing},pendingShouldSort:!0}},6:(t,e)=>{let n=t.items,r=[],i=new Set(e.items);for(let[a,s]of n.entries())if(i.has(s.id)&&(r.push(a),i.delete(s.id),i.size===0))break;if(r.length>0){n=n.slice();for(let a of r.reverse())n.splice(a,1)}return{...t,items:n,activationTrigger:1}},7:(t,e)=>t.buttonElement===e.element?t:{...t,buttonElement:e.element},8:(t,e)=>t.itemsElement===e.element?t:{...t,itemsElement:e.element},9:t=>t.pendingShouldSort?{...t,...CH(t),pendingShouldSort:!1}:t,10(t){return t.buttonPositionState.kind!=="Tracked"?t:{...t,buttonPositionState:Jb.Moved}}},PWe=class Jse extends ise{constructor(e){super(e),TH(this,"actions",{registerItem:qj(()=>{let n=[],r=new Set;return[(i,a)=>{r.has(a)||(r.add(a),n.push({id:i,dataRef:a}))},()=>(r.clear(),this.send({type:5,items:n.splice(0)}))]}),unregisterItem:qj(()=>{let n=[];return[r=>n.push(r),()=>this.send({type:6,items:n.splice(0)})]})}),TH(this,"selectors",{activeDescendantId(n){var r;let i=n.activeItemIndex,a=n.items;return i===null||(r=a[i])==null?void 0:r.id},isActive(n,r){var i;let a=n.activeItemIndex,s=n.items;return a!==null?((i=s[a])==null?void 0:i.id)===r:!1},shouldScrollIntoView(n,r){return n.__demoMode||n.menuState!==0||n.activationTrigger===0?!1:this.isActive(n,r)},didButtonMove(n){return n.buttonPositionState.kind==="Moved"}}),this.on(5,()=>{this.disposables.requestAnimationFrame(()=>{this.send({type:9})})});{let n=this.state.id,r=R3.get(null);this.disposables.add(r.on(sse.Push,i=>{!r.selectors.isTop(i,n)&&this.state.menuState===0&&this.send({type:1})})),this.on(0,()=>r.actions.push(n)),this.on(1,()=>r.actions.pop(n))}this.disposables.group(n=>{this.on(1,r=>{r.buttonElement&&(n.dispose(),n.add(GGe(r.buttonElement,r.buttonPositionState,()=>{this.send({type:10})})))})})}static new({id:e,__demoMode:n=!1}){return new Jse({id:e,__demoMode:n,menuState:n?0:1,buttonElement:null,itemsElement:null,items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1,pendingShouldSort:!1,pendingFocus:{focus:zi.Nothing},buttonPositionState:Jb.Idle})}reduce(e,n){return La(n.type,RWe,e,n)}};const Qse=P.createContext(null);function C7(t){let e=P.useContext(Qse);if(e===null){let n=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,eoe),n}return e}function eoe({id:t,__demoMode:e=!1}){let n=P.useMemo(()=>PWe.new({id:t,__demoMode:e}),[]);return S7(()=>n.dispose()),n}let DWe=P.Fragment;function OWe(t,e){let n=P.useId(),{__demoMode:r=!1,...i}=t,a=eoe({id:n,__demoMode:r}),[s,o,l]=mo(a,b=>[b.menuState,b.itemsElement,b.buttonElement]),u=qi(e),c=R3.get(null),d=mo(c,P.useCallback(b=>c.selectors.isTop(b,n),[c,n]));pse(d,[l,o],(b,y)=>{var w;a.send({type:Rr.CloseMenu}),v7(y,g7.Loose)||(b.preventDefault(),(w=a.state.buttonElement)==null||w.focus())});let h=an(()=>{a.send({type:Rr.CloseMenu})}),f=ss({open:s===Ra.Open,close:h}),m={ref:u},x=qr();return Xt.createElement(RGe,null,Xt.createElement(Qse.Provider,{value:a},Xt.createElement(Lse,{value:La(s,{[Ra.Open]:ns.Open,[Ra.Closed]:ns.Closed})},x({ourProps:m,theirProps:i,slot:f,defaultTag:DWe,name:"Menu"}))))}let LWe="button";function FWe(t,e){let n=C7("Menu.Button"),r=P.useId(),{id:i=`headlessui-menu-button-${r}`,disabled:a=!1,autoFocus:s=!1,...o}=t,l=P.useRef(null),u=kGe(),c=qi(e,l,AGe(),an(I=>n.send({type:Rr.SetButtonElement,element:I}))),d=an(I=>{switch(I.key){case Mr.Space:case Mr.Enter:case Mr.ArrowDown:I.preventDefault(),I.stopPropagation(),n.send({type:Rr.OpenMenu,focus:{focus:zi.First}});break;case Mr.ArrowUp:I.preventDefault(),I.stopPropagation(),n.send({type:Rr.OpenMenu,focus:{focus:zi.Last}});break}}),h=an(I=>{switch(I.key){case Mr.Space:I.preventDefault();break}}),[f,m,x]=mo(n,I=>[I.menuState,I.buttonElement,I.itemsElement]),b=f===Ra.Open;GVe(b,{trigger:m,action:P.useCallback(I=>{if(m!=null&&m.contains(I.target))return _b.Ignore;let N=I.target.closest('[role="menuitem"]:not([data-disabled])');return to(N)?_b.Select(N):x!=null&&x.contains(I.target)?_b.Ignore:_b.Close},[m,x]),close:P.useCallback(()=>n.send({type:Rr.CloseMenu}),[]),select:P.useCallback(I=>I.click(),[])});let y=EVe(I=>{var N;a||(f===Ra.Open?(Vu.flushSync(()=>n.send({type:Rr.CloseMenu})),(N=l.current)==null||N.focus({preventScroll:!0})):(I.preventDefault(),n.send({type:Rr.OpenMenu,focus:{focus:zi.Nothing},trigger:qw.Pointer})))}),{isFocusVisible:w,focusProps:_}=f7({autoFocus:s}),{isHovered:S,hoverProps:M}=$ae({isDisabled:a}),{pressed:E,pressProps:C}=qae({disabled:a}),R=ss({open:f===Ra.Open,active:E||f===Ra.Open,disabled:a,hover:S,focus:w,autofocus:s}),k=I3(u(),{ref:c,id:i,type:gse(t,l.current),"aria-haspopup":"menu","aria-controls":x?.id,"aria-expanded":f===Ra.Open,disabled:a||void 0,autoFocus:s,onKeyDown:d,onKeyUp:h},y,_,M,C);return qr()({ourProps:k,theirProps:o,slot:R,defaultTag:LWe,name:"Menu.Button"})}let BWe="div",UWe=cd.RenderStrategy|cd.Static;function zWe(t,e){let n=P.useId(),{id:r=`headlessui-menu-items-${n}`,anchor:i,portal:a=!1,modal:s=!0,transition:o=!1,...l}=t,u=MGe(i),c=C7("Menu.Items"),[d,h]=NGe(u),f=IGe(),[m,x]=P.useState(null),b=qi(e,u?d:null,an(Z=>c.send({type:Rr.SetItemsElement,element:Z})),x),[y,w]=mo(c,Z=>[Z.menuState,Z.buttonElement]),_=Q1(w),S=Q1(m);u&&(a=!0);let M=qv(),[E,C]=xse(o,m,M!==null?(M&ns.Open)===ns.Open:y===Ra.Open);use(E,w,()=>{c.send({type:Rr.CloseMenu})});let R=mo(c,Z=>Z.__demoMode),k=R?!1:s&&y===Ra.Open;vse(k,S);let I=R?!1:s&&y===Ra.Open;lse(I,{allowed:P.useCallback(()=>[w,m],[w,m])});let N=mo(c,c.selectors.didButtonMove)?!1:E;P.useEffect(()=>{let Z=m;Z&&y===Ra.Open&&(Vae(Z)||Z.focus({preventScroll:!0}))},[y,m]),oqe(y===Ra.Open,{container:m,accept(Z){return Z.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:Z.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(Z){Z.setAttribute("role","none")}});let D=Tf(),F=an(Z=>{var Q,z,W;switch(D.dispose(),Z.key){case Mr.Space:if(c.state.searchQuery!=="")return Z.preventDefault(),Z.stopPropagation(),c.send({type:Rr.Search,value:Z.key});case Mr.Enter:if(Z.preventDefault(),Z.stopPropagation(),c.state.activeItemIndex!==null){let{dataRef:X}=c.state.items[c.state.activeItemIndex];(z=(Q=X.current)==null?void 0:Q.domRef.current)==null||z.click()}c.send({type:Rr.CloseMenu}),dse(c.state.buttonElement);break;case Mr.ArrowDown:return Z.preventDefault(),Z.stopPropagation(),c.send({type:Rr.GoToItem,focus:zi.Next});case Mr.ArrowUp:return Z.preventDefault(),Z.stopPropagation(),c.send({type:Rr.GoToItem,focus:zi.Previous});case Mr.Home:case Mr.PageUp:return Z.preventDefault(),Z.stopPropagation(),c.send({type:Rr.GoToItem,focus:zi.First});case Mr.End:case Mr.PageDown:return Z.preventDefault(),Z.stopPropagation(),c.send({type:Rr.GoToItem,focus:zi.Last});case Mr.Escape:Z.preventDefault(),Z.stopPropagation(),Vu.flushSync(()=>c.send({type:Rr.CloseMenu})),(W=c.state.buttonElement)==null||W.focus({preventScroll:!0});break;case Mr.Tab:Z.preventDefault(),Z.stopPropagation(),Vu.flushSync(()=>c.send({type:Rr.CloseMenu})),HVe(c.state.buttonElement,Z.shiftKey?wi.Previous:wi.Next);break;default:Z.key.length===1&&(c.send({type:Rr.Search,value:Z.key}),D.setTimeout(()=>c.send({type:Rr.ClearSearch}),350));break}}),L=an(Z=>{switch(Z.key){case Mr.Space:Z.preventDefault();break}}),U=ss({open:y===Ra.Open}),j=I3(u?f():{},{"aria-activedescendant":mo(c,c.selectors.activeDescendantId),"aria-labelledby":mo(c,Z=>{var Q;return(Q=Z.buttonElement)==null?void 0:Q.id}),id:r,onKeyDown:F,onKeyUp:L,role:"menu",tabIndex:y===Ra.Open?0:void 0,ref:b,style:{...l.style,...h,"--button-width":SVe(E,w,!0).width},...yse(C)}),q=qr();return Xt.createElement(jse,{enabled:a?t.static||E:!1,ownerDocument:_},q({ourProps:j,theirProps:l,slot:U,defaultTag:BWe,features:UWe,visible:N,name:"Menu.Items"}))}let jWe=P.Fragment;function HWe(t,e){let n=P.useId(),{id:r=`headlessui-menu-item-${n}`,disabled:i=!1,...a}=t,s=C7("Menu.Item"),o=mo(s,N=>s.selectors.isActive(N,r)),l=P.useRef(null),u=qi(e,l),c=mo(s,N=>s.selectors.shouldScrollIntoView(N,r));Er(()=>{if(c)return As().requestAnimationFrame(()=>{var N,D;(D=(N=l.current)==null?void 0:N.scrollIntoView)==null||D.call(N,{block:"nearest"})})},[c,l]);let d=kWe(l),h=P.useRef({disabled:i,domRef:l,get textValue(){return d()}});Er(()=>{h.current.disabled=i},[h,i]),Er(()=>(s.actions.registerItem(r,h),()=>s.actions.unregisterItem(r)),[h,r]);let f=an(()=>{s.send({type:Rr.CloseMenu})}),m=an(N=>{if(i)return N.preventDefault();s.send({type:Rr.CloseMenu}),dse(s.state.buttonElement)}),x=an(()=>{if(i)return s.send({type:Rr.GoToItem,focus:zi.Nothing});s.send({type:Rr.GoToItem,focus:zi.Specific,id:r})}),b=QVe(),y=an(N=>b.update(N)),w=an(N=>{b.wasMoved(N)&&(i||o||s.send({type:Rr.GoToItem,focus:zi.Specific,id:r,trigger:qw.Pointer}))}),_=an(N=>{b.wasMoved(N)&&(i||o&&s.state.activationTrigger===qw.Pointer&&s.send({type:Rr.GoToItem,focus:zi.Nothing}))}),[S,M]=ese(),[E,C]=Qae(),R=ss({active:o,focus:o,disabled:i,close:f}),k={id:r,ref:u,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,"aria-labelledby":S,"aria-describedby":E,disabled:void 0,onClick:m,onFocus:x,onPointerEnter:y,onMouseEnter:y,onPointerMove:w,onMouseMove:w,onPointerLeave:_,onMouseLeave:_},I=qr();return Xt.createElement(M,null,Xt.createElement(C,null,I({ourProps:k,theirProps:a,slot:R,defaultTag:jWe,name:"Menu.Item"})))}let $We="div";function VWe(t,e){let[n,r]=ese(),i=t,a={ref:e,"aria-labelledby":n,role:"group"},s=qr();return Xt.createElement(r,null,s({ourProps:a,theirProps:i,slot:{},defaultTag:$We,name:"Menu.Section"}))}let qWe="header";function GWe(t,e){let n=P.useId(),{id:r=`headlessui-menu-heading-${n}`,...i}=t,a=m7();Er(()=>a.register(r),[r,a.register]);let s={id:r,ref:e,role:"presentation",...a.props};return qr()({ourProps:s,theirProps:i,slot:{},defaultTag:qWe,name:"Menu.Heading"})}let WWe="div";function YWe(t,e){let n=t,r={ref:e,role:"separator"};return qr()({ourProps:r,theirProps:n,slot:{},defaultTag:WWe,name:"Menu.Separator"})}let XWe=Br(OWe),KWe=Br(FWe),ZWe=Br(zWe),JWe=Br(HWe),QWe=Br(VWe),eYe=Br(GWe),tYe=Br(YWe),Vo=Object.assign(XWe,{Button:KWe,Items:ZWe,Item:JWe,Section:QWe,Heading:eYe,Separator:tYe});function nYe({onFocus:t}){let[e,n]=P.useState(!0),r=z3();return e?Xt.createElement(J1,{as:"button",type:"button",features:Z1.Focusable,onFocus:i=>{i.preventDefault();let a,s=50;function o(){if(s--<=0){a&&cancelAnimationFrame(a);return}if(t()){if(cancelAnimationFrame(a),!r.current)return;n(!1);return}a=requestAnimationFrame(o)}a=requestAnimationFrame(o)}}):null}const toe=P.createContext(null);function rYe(){return{groups:new Map,get(t,e){var n;let r=this.groups.get(t);r||(r=new Map,this.groups.set(t,r));let i=(n=r.get(e))!=null?n:0;r.set(e,i+1);let a=Array.from(r.keys()).indexOf(e);function s(){let o=r.get(e);o>1?r.set(e,o-1):r.delete(e)}return[a,s]}}}function iYe({children:t}){let e=P.useRef(rYe());return P.createElement(toe.Provider,{value:e},t)}function noe(t){let e=P.useContext(toe);if(!e)throw new Error("You must wrap your component in a <StableCollection>");let n=P.useId(),[r,i]=e.current.get(t,n);return P.useEffect(()=>i,[]),r}var aYe=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(aYe||{}),sYe=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(sYe||{}),oYe=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(oYe||{});let lYe={0(t,e){var n;let r=Ih(t.tabs,c=>c.current),i=Ih(t.panels,c=>c.current),a=r.filter(c=>{var d;return!((d=c.current)!=null&&d.hasAttribute("disabled"))}),s={...t,tabs:r,panels:i};if(e.index<0||e.index>r.length-1){let c=La(Math.sign(e.index-t.selectedIndex),{[-1]:()=>1,0:()=>La(Math.sign(e.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(a.length===0)return s;let d=La(c,{0:()=>r.indexOf(a[0]),1:()=>r.indexOf(a[a.length-1])});return{...s,selectedIndex:d===-1?t.selectedIndex:d}}let o=r.slice(0,e.index),l=[...r.slice(e.index),...o].find(c=>a.includes(c));if(!l)return s;let u=(n=r.indexOf(l))!=null?n:t.selectedIndex;return u===-1&&(u=t.selectedIndex),{...s,selectedIndex:u}},1(t,e){if(t.tabs.includes(e.tab))return t;let n=t.tabs[t.selectedIndex],r=Ih([...t.tabs,e.tab],a=>a.current),i=t.selectedIndex;return t.info.current.isControlled||(i=r.indexOf(n),i===-1&&(i=t.selectedIndex)),{...t,tabs:r,selectedIndex:i}},2(t,e){return{...t,tabs:t.tabs.filter(n=>n!==e.tab)}},3(t,e){return t.panels.includes(e.panel)?t:{...t,panels:Ih([...t.panels,e.panel],n=>n.current)}},4(t,e){return{...t,panels:t.panels.filter(n=>n!==e.panel)}}},M7=P.createContext(null);M7.displayName="TabsDataContext";function A0(t){let e=P.useContext(M7);if(e===null){let n=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,A0),n}return e}let A7=P.createContext(null);A7.displayName="TabsActionsContext";function k7(t){let e=P.useContext(A7);if(e===null){let n=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,k7),n}return e}function uYe(t,e){return La(e.type,lYe,t,e)}let cYe="div";function dYe(t,e){let{defaultIndex:n=0,vertical:r=!1,manual:i=!1,onChange:a,selectedIndex:s=null,...o}=t;const l=r?"vertical":"horizontal",u=i?"manual":"auto";let c=s!==null,d=Jo({isControlled:c}),h=qi(e),[f,m]=P.useReducer(uYe,{info:d,selectedIndex:s??n,tabs:[],panels:[]}),x=ss({selectedIndex:f.selectedIndex}),b=Jo(a||(()=>{})),y=Jo(f.tabs),w=P.useMemo(()=>({orientation:l,activation:u,...f}),[l,u,f]),_=an(I=>(m({type:1,tab:I}),()=>m({type:2,tab:I}))),S=an(I=>(m({type:3,panel:I}),()=>m({type:4,panel:I}))),M=an(I=>{E.current!==I&&b.current(I),c||m({type:0,index:I})}),E=Jo(c?t.selectedIndex:f.selectedIndex),C=P.useMemo(()=>({registerTab:_,registerPanel:S,change:M}),[]);Er(()=>{m({type:0,index:s??n})},[s]),Er(()=>{if(E.current===void 0||f.tabs.length<=0)return;let I=Ih(f.tabs,N=>N.current);I.some((N,D)=>f.tabs[D]!==N)&&M(I.indexOf(f.tabs[E.current]))});let R={ref:h},k=qr();return Xt.createElement(iYe,null,Xt.createElement(A7.Provider,{value:C},Xt.createElement(M7.Provider,{value:w},w.tabs.length<=0&&Xt.createElement(nYe,{onFocus:()=>{var I,N;for(let D of y.current)if(((I=D.current)==null?void 0:I.tabIndex)===0)return(N=D.current)==null||N.focus(),!0;return!1}}),k({ourProps:R,theirProps:o,slot:x,defaultTag:cYe,name:"Tabs"}))))}let hYe="div";function fYe(t,e){let{orientation:n,selectedIndex:r}=A0("Tab.List"),i=qi(e),a=ss({selectedIndex:r}),s=t,o={ref:i,role:"tablist","aria-orientation":n};return qr()({ourProps:o,theirProps:s,slot:a,defaultTag:hYe,name:"Tabs.List"})}let pYe="button";function mYe(t,e){var n,r;let i=P.useId(),{id:a=`headlessui-tabs-tab-${i}`,disabled:s=!1,autoFocus:o=!1,...l}=t,{orientation:u,activation:c,selectedIndex:d,tabs:h,panels:f}=A0("Tab"),m=k7("Tab"),x=A0("Tab"),[b,y]=P.useState(null),w=P.useRef(null),_=qi(w,e,y);Er(()=>m.registerTab(w),[m,w]);let S=noe("tabs"),M=h.indexOf(w);M===-1&&(M=S);let E=M===d,C=an(z=>{let W=z();if(W===kh.Success&&c==="auto"){let X=k3(w.current),H=x.tabs.findIndex(J=>J.current===X);H!==-1&&m.change(H)}return W}),R=an(z=>{let W=h.map(X=>X.current).filter(Boolean);if(z.key===Mr.Space||z.key===Mr.Enter){z.preventDefault(),z.stopPropagation(),m.change(M);return}switch(z.key){case Mr.Home:case Mr.PageUp:return z.preventDefault(),z.stopPropagation(),C(()=>fo(W,wi.First));case Mr.End:case Mr.PageDown:return z.preventDefault(),z.stopPropagation(),C(()=>fo(W,wi.Last))}if(C(()=>La(u,{vertical(){return z.key===Mr.ArrowUp?fo(W,wi.Previous|wi.WrapAround):z.key===Mr.ArrowDown?fo(W,wi.Next|wi.WrapAround):kh.Error},horizontal(){return z.key===Mr.ArrowLeft?fo(W,wi.Previous|wi.WrapAround):z.key===Mr.ArrowRight?fo(W,wi.Next|wi.WrapAround):kh.Error}}))===kh.Success)return z.preventDefault()}),k=P.useRef(!1),I=an(()=>{var z;k.current||(k.current=!0,(z=w.current)==null||z.focus({preventScroll:!0}),m.change(M),jv(()=>{k.current=!1}))}),N=an(z=>{z.preventDefault()}),{isFocusVisible:D,focusProps:F}=f7({autoFocus:o}),{isHovered:L,hoverProps:U}=$ae({isDisabled:s}),{pressed:j,pressProps:q}=qae({disabled:s}),Z=ss({selected:E,hover:L,active:j,focus:D,autofocus:o,disabled:s}),Q=I3({ref:_,onKeyDown:R,onMouseDown:N,onClick:I,id:a,role:"tab",type:gse(t,b),"aria-controls":(r=(n=f[M])==null?void 0:n.current)==null?void 0:r.id,"aria-selected":E,tabIndex:E?0:-1,disabled:s||void 0,autoFocus:o},F,U,q);return qr()({ourProps:Q,theirProps:l,slot:Z,defaultTag:pYe,name:"Tabs.Tab"})}let gYe="div";function vYe(t,e){let{selectedIndex:n}=A0("Tab.Panels"),r=qi(e),i=ss({selectedIndex:n}),a=t,s={ref:r};return qr()({ourProps:s,theirProps:a,slot:i,defaultTag:gYe,name:"Tabs.Panels"})}let yYe="div",xYe=cd.RenderStrategy|cd.Static;function bYe(t,e){var n,r,i,a;let s=P.useId(),{id:o=`headlessui-tabs-panel-${s}`,tabIndex:l=0,...u}=t,{selectedIndex:c,tabs:d,panels:h}=A0("Tab.Panel"),f=k7("Tab.Panel"),m=P.useRef(null),x=qi(m,e);Er(()=>f.registerPanel(m),[f,m]);let b=noe("panels"),y=h.indexOf(m);y===-1&&(y=b);let w=y===c,{isFocusVisible:_,focusProps:S}=f7(),M=ss({selected:w,focus:_}),E=I3({ref:x,id:o,role:"tabpanel","aria-labelledby":(r=(n=d[y])==null?void 0:n.current)==null?void 0:r.id,tabIndex:w?l:-1},S),C=qr();return!w&&((i=u.unmount)==null||i)&&!((a=u.static)!=null&&a)?Xt.createElement(J1,{"aria-hidden":"true",...E}):C({ourProps:E,theirProps:u,slot:M,defaultTag:yYe,features:xYe,visible:w,name:"Tabs.Panel"})}let _Ye=Br(mYe),wYe=Br(dYe),SYe=Br(fYe),EYe=Br(vYe),TYe=Br(bYe),QT=Object.assign(_Ye,{Group:wYe,List:SYe,Panels:EYe,Panel:TYe});function roe(t,e){const n=t.toLowerCase();return e.filter(r=>r.text.toLowerCase().includes(n)).map(r=>({memory:r,similarity:1,matchType:"keyword"}))}async function CYe(t,e){const{searchMemoriesVector:n}=await Yh(async()=>{const{searchMemoriesVector:i}=await import("./vectorSearch.CYflu1JK.js");return{searchMemoriesVector:i}},__vite__mapDeps([0,1,2]));return(await n(t,e,{topK:10,minSimilarity:.3})).map(i=>({memory:i.memory,similarity:i.similarity,matchType:"semantic"}))}async function MYe(t,e,n={}){const{keywordThreshold:r=5,vectorLimit:i=50}=n,a=roe(t,e);if(console.log(`🔍 [HybridSearch] Keyword: ${a.length} results`),a.length>=r)return a.slice(0,10);console.log("⚡ [HybridSearch] Few keyword results, using vector search...");const s=[...e].sort((u,c)=>new Date(c.date).getTime()-new Date(u.date).getTime()).slice(0,i);let o=[];try{o=await CYe(t,s)}catch(u){return console.warn("⚠️ [HybridSearch] Vector search failed, fallback to keyword only:",u),a.slice(0,10)}console.log(`✨ [HybridSearch] Vector: ${o.length} results`);const l=new Map;return a.forEach(u=>{l.set(u.memory.id,u)}),o.forEach(u=>{l.has(u.memory.id)||l.set(u.memory.id,u)}),Array.from(l.values()).sort((u,c)=>c.similarity-u.similarity).slice(0,10)}function AYe(t,e){const n=t.trim();return n?roe(n,e).sort((i,a)=>{const s=i.memory.text.toLowerCase(),o=a.memory.text.toLowerCase(),l=n.toLowerCase(),u=(m,x)=>{if(!x)return 0;let b=0,y=0;for(;;){const w=m.indexOf(x,y);if(w===-1)break;b++,y=w+x.length}return b},c=u(s,l),d=u(o,l);if(c!==d)return d-c;const h=s.indexOf(l),f=o.indexOf(l);return h-f}).slice(0,10):[]}async function ioe(t,e,n={}){const{keywordThreshold:r=5,vectorLimit:i=50,minSimilarity:a=.3,topK:s=10,timeout:o=3e3}=n;if(!t.trim())return e.slice().sort((l,u)=>{const c=l.date?new Date(l.date).getTime():0;return(u.date?new Date(u.date).getTime():0)-c}).slice(0,s).map(l=>({memory:l,similarity:1,matchType:"keyword"}));try{const l=new Promise((d,h)=>{setTimeout(()=>h(new Error("Search timeout")),o)}),u=MYe(t,e,{keywordThreshold:r,vectorLimit:i,minSimilarity:a});return(await Promise.race([u,l])).slice(0,s).map(d=>({memory:d.memory,similarity:d.similarity,matchType:d.matchType||"hybrid"}))}catch(l){return console.warn("智能搜索失败，使用关键字兜底:",l),AYe(t,e).slice(0,s).map(c=>({memory:c.memory,similarity:c.similarity,matchType:"keyword"}))}}async function kYe(t,e,n={}){const{minSimilarity:r=.3,topK:i=10,timeout:a=3e3}=n;try{const{searchMemoriesVector:s}=await Yh(async()=>{const{searchMemoriesVector:c}=await import("./vectorSearch.CYflu1JK.js");return{searchMemoriesVector:c}},__vite__mapDeps([0,1,2])),o=new Promise((c,d)=>{setTimeout(()=>d(new Error("Recommendation timeout")),a)}),l=s(t.text,e,{topK:i,minSimilarity:r,useCache:!0});return(await Promise.race([l,o])).map(c=>({memory:c.memory,similarity:c.similarity,matchType:"semantic"}))}catch(s){return console.warn("语义推荐失败，使用时间排序兜底:",s),e.slice().sort((o,l)=>{const u=o.date?new Date(o.date).getTime():0;return(l.date?new Date(l.date).getTime():0)-u}).slice(0,i).map(o=>({memory:o,similarity:.5,matchType:"keyword"}))}}function IYe({memories:t,onSelect:e,className:n}){const[r,i]=P.useState(!1),[a,s]=P.useState(""),[o,l]=P.useState("all"),[u,c]=P.useState([]),[d,h]=P.useState(0),f=P.useRef(null),m=P.useRef(null),x=P.useRef(null),b=P.useMemo(()=>t?o==="all"?t:o==="memory"?t.filter(y=>y.type==="memory"||!y.type):o==="arena"?t.filter(y=>y.type==="arena"||y.type==="arena-v2"):t.filter(y=>y.type===o):[],[t,o]);return P.useEffect(()=>{r&&f.current?.focus()},[r]),P.useEffect(()=>{if(!r)return;const y=w=>{const _=x.current;_&&(_.contains(w.target)||i(!1))};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[r]),P.useEffect(()=>{if(r)return m.current&&window.clearTimeout(m.current),m.current=window.setTimeout(async()=>{const y=a.trim(),w=await ioe(y,b,{keywordThreshold:5,vectorLimit:50,topK:y?10:8,timeout:2500});c(w.map(_=>({memory:_.memory,similarity:_.similarity}))),h(0)},180),()=>{m.current&&window.clearTimeout(m.current)}},[r,a,b]),P.useEffect(()=>{if(!r)return;const y=w=>{if(w.key==="Escape"){i(!1);return}if(u.length){if(w.key==="ArrowDown")w.preventDefault(),h(_=>Math.min(_+1,u.length-1));else if(w.key==="ArrowUp")w.preventDefault(),h(_=>Math.max(_-1,0));else if(w.key==="Enter"){w.preventDefault();const _=u[d];_&&(e(_.memory),i(!1))}}};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[r,u,d,e]),g.jsx("div",{ref:x,className:n||"",children:g.jsxs("div",{className:"relative",children:[g.jsx("button",{type:"button",onClick:()=>i(y=>!y),className:"w-9 h-9 rounded-lg bg-transparent hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",title:"搜索记忆",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),r&&g.jsx("div",{className:"absolute right-0 mt-2 w-[min(26rem,calc(100vw-24px))] z-50",children:g.jsxs("div",{className:"rounded-2xl backdrop-blur-2xl border shadow-2xl overflow-hidden",style:{background:"#1a1d2e",borderColor:"rgba(255, 255, 255, 0.1)"},children:[g.jsxs("div",{className:"px-3 py-2.5 border-b border-white/5 flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{ref:f,value:a,onChange:y=>s(y.target.value),placeholder:"搜索所有记忆...",className:"flex-1 bg-transparent text-sm text-gray-200 placeholder-gray-400 outline-none"}),g.jsx("div",{className:"text-[11px] text-gray-500 select-none",children:"全局"})]}),g.jsxs("div",{className:"px-3 py-2 border-b border-white/5 flex items-center gap-2",children:[g.jsx("button",{onClick:()=>l("all"),className:`px-2.5 py-1 rounded-md text-[11px] transition-all ${o==="all"?"bg-blue-500/15 text-blue-300 border border-blue-400/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:"全部"}),g.jsx("button",{onClick:()=>l("memory"),className:`px-2.5 py-1 rounded-md text-[11px] transition-all ${o==="memory"?"bg-blue-500/15 text-blue-300 border border-blue-400/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:"记忆"}),g.jsx("button",{onClick:()=>l("card"),className:`px-2.5 py-1 rounded-md text-[11px] transition-all ${o==="card"?"bg-blue-500/15 text-blue-300 border border-blue-400/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:"卡片"}),g.jsx("button",{onClick:()=>l("index"),className:`px-2.5 py-1 rounded-md text-[11px] transition-all ${o==="index"?"bg-blue-500/15 text-blue-300 border border-blue-400/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:"索引"}),g.jsx("button",{onClick:()=>l("arena"),className:`px-2.5 py-1 rounded-md text-[11px] transition-all ${o==="arena"?"bg-blue-500/15 text-blue-300 border border-blue-400/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:"演武场"})]}),g.jsx("div",{className:"max-h-[18rem] overflow-y-auto",children:u.length===0?g.jsx("div",{className:"px-3 py-8 text-center text-sm text-gray-500",children:"暂无结果"}):g.jsx("div",{className:"py-1",children:u.map((y,w)=>{const _=y.memory,S=w===d,M=_.date?new Date(_.date):null,E=M?`${M.getFullYear()}-${M.getMonth()+1}-${M.getDate()}`:"";return g.jsx("button",{type:"button",onMouseEnter:()=>h(w),onClick:()=>{e(_),i(!1)},className:["w-full text-left px-3 py-2.5 transition-colors",S?"bg-white/[0.06]":"hover:bg-white/[0.04]"].join(" "),children:g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"text-[11px] text-gray-600 font-mono mt-0.5 shrink-0 w-[6.5rem]",children:E}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm text-gray-200 leading-relaxed line-clamp-2",children:_.text}),_.isHidden&&g.jsx("div",{className:"mt-1 text-[11px] text-gray-600",children:"隐藏"}),a&&y.similarity>0&&g.jsxs("div",{className:"flex items-center gap-2 mt-1.5",children:[g.jsx("div",{className:"flex-1 h-0.5 bg-white/5 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-500/60 rounded-full transition-all duration-300",style:{width:`${y.similarity*100}%`}})}),g.jsxs("span",{className:"text-[10px] text-gray-500 font-mono shrink-0 w-10 text-right",children:[(y.similarity*100).toFixed(0),"%"]})]})]})]})},_.id)})})})]})})]})})}function NYe({storageStatus:t,onStorageRefresh:e,vectorEngine:n,onVectorEngineRefresh:r,cacheStats:i,memories:a,showHidden:s,setShowHidden:o,advancedOpen:l,setAdvancedOpen:u,onCreateIndex:c,onExportClick:d,onClearAllRequest:h,onShowToast:f,onDateSelect:m,setFocusMemoryId:x,hasGhostNodes:b,focusMode:y,setFocusMode:w}){return g.jsxs("div",{className:"absolute top-3 right-3 z-30 flex flex-col items-end gap-2",children:[g.jsx(Vo,{as:"div",className:"relative",children:({open:_})=>g.jsxs(g.Fragment,{children:[g.jsx(Vo.Button,{className:"w-9 h-9 rounded-lg bg-transparent hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",children:g.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),g.jsx(zn,{show:_,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:g.jsxs(Vo.Items,{className:"absolute right-0 mt-2 w-60 origin-top-right bg-gray-900/95 backdrop-blur-xl rounded-xl border border-gray-700/40 shadow-2xl divide-y divide-gray-800/40 focus:outline-none overflow-hidden",children:[g.jsx("div",{className:"px-4 py-3",children:g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${t==="connected"?"bg-emerald-400/70":t==="syncing"?"bg-sky-400/70":t==="local"?"bg-white/30":"bg-rose-400/70"}`}),g.jsx("span",{className:"text-xs text-gray-300/90 truncate",children:t==="connected"?"GitHub 云端存储":t==="syncing"?"GitHub 同步中":t==="local"?"本地存储":"存储连接错误"})]}),g.jsx("button",{onClick:S=>{S.preventDefault(),t!=="syncing"&&e()},className:`text-xs px-2 py-1 rounded-lg transition-colors ${t==="syncing"?"text-gray-600 cursor-not-allowed":"text-gray-400 hover:text-gray-200 hover:bg-white/5"}`,children:t==="syncing"?"同步中":"刷新"})]})}),g.jsxs("div",{className:"px-4 py-3",children:[g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${n.status==="ready"?"bg-emerald-400/70":n.status==="loading"||n.status==="checking"?"bg-sky-400/70":n.status==="error"?"bg-rose-400/70":"bg-white/20"}`}),g.jsxs("span",{className:"text-xs text-gray-300/90 truncate",children:[n.status==="ready"&&"语义引擎：可用",(n.status==="loading"||n.status==="checking")&&"语义引擎：加载中",n.status==="idle"&&"语义引擎：未检测",n.status==="error"&&"语义引擎：不可用"]})]}),g.jsx("button",{onClick:r,className:"text-xs px-2 py-1 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors",title:"重新加载/重试语义引擎",children:"刷新"})]}),n.status==="error"&&g.jsx("div",{className:"mt-2 text-[11px] text-gray-500 leading-relaxed break-words",children:n.error})]}),i&&g.jsxs("div",{className:"px-4 py-3 border-b border-gray-800/50",children:[g.jsx("div",{className:"flex items-center justify-between mb-2",children:g.jsx("span",{className:"text-xs text-gray-400 font-medium",children:"本地缓存"})}),g.jsxs("div",{className:"text-xs text-gray-500 leading-relaxed space-y-1",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"数据量："}),g.jsxs("span",{className:"text-gray-400",children:[i.count," 条"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"大小："}),g.jsxs("span",{className:"text-gray-400",children:[(i.size/1024).toFixed(1)," KB"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{children:"上次同步："}),g.jsx("span",{className:"text-gray-400",children:i.age})]})]})]}),g.jsxs("div",{className:"py-1",children:[g.jsx(Vo.Item,{children:({active:S})=>g.jsxs("button",{onClick:c,className:`${S?"bg-white/[0.04]":""} group flex w-full items-center gap-3 px-4 py-2.5 text-sm text-gray-300 transition-colors`,children:[g.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),"创建索引入口"]})}),g.jsx("div",{children:g.jsxs("button",{type:"button",onClick:S=>{S.preventDefault(),S.stopPropagation(),u(!l)},className:"group flex w-full items-center justify-between px-4 py-2.5 text-sm text-gray-300 transition-colors hover:bg-white/[0.04]",children:[g.jsxs("span",{className:"flex items-center gap-3",children:[g.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 16v-2m8-6h-2M6 12H4m15.364 6.364l-1.414-1.414M7.05 7.05L5.636 5.636m12.728 0L16.95 7.05M7.05 16.95l-1.414 1.414"})}),"高级选项"]}),g.jsx("svg",{className:`w-4 h-4 text-gray-500 transition-transform ${l?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),l&&g.jsxs("div",{className:"pt-1 pb-2",children:[g.jsx(Vo.Item,{children:({active:S})=>g.jsxs("button",{onClick:()=>{o(!s),f(s?"已隐藏隐藏记忆":"已显示隐藏记忆","info",2e3)},className:`${S?"bg-white/[0.04]":""} group flex w-full items-center justify-between px-4 py-2 text-sm text-gray-300 transition-colors`,children:[g.jsxs("span",{className:"flex items-center gap-3",children:[g.jsxs("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"显示隐藏记忆"]}),g.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:g.jsx("div",{className:`w-3.5 h-3.5 rounded border ${s?"bg-white/10 border-white/20":"bg-transparent border-gray-600/60"}`})})]})}),g.jsx(Vo.Item,{children:({active:S})=>g.jsxs("a",{href:"/memories/admin",className:`${S?"bg-white/[0.04]":""} group flex w-full items-center gap-3 px-4 py-2 text-sm text-gray-300 transition-colors`,children:[g.jsx("span",{className:"text-base",children:"⚙️"}),"管理"]})}),g.jsx(Vo.Item,{children:({active:S})=>g.jsxs("button",{onClick:d,className:`${S?"bg-white/[0.04]":""} group flex w-full items-center gap-3 px-4 py-2 text-sm text-gray-300 transition-colors`,children:[g.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"导出数据"]})}),g.jsx(Vo.Item,{children:({active:S})=>g.jsxs("button",{onClick:h,className:`${S?"bg-rose-500/10":""} group flex w-full items-center gap-3 px-4 py-2 text-sm text-rose-300 transition-colors`,children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"清空所有"]})})]})]}),g.jsx("div",{className:"px-4 py-2.5 bg-gray-800/30",children:g.jsxs("div",{className:"text-xs text-gray-500",children:["共 ",g.jsx("span",{className:"text-gray-400 font-medium",children:a.length})," 条记忆"]})})]})})]})}),g.jsx(IYe,{memories:a,onSelect:_=>{const S=_.date?new Date(_.date):new Date,M=!!(_.isTemporary&&_.expiresAt&&Date.now()>new Date(_.expiresAt).getTime());(_.isHidden||M)&&(o(!0),f("已自动显示隐藏记忆以便定位","info",2500)),m(S),x(null),window.setTimeout(()=>x(_.id),0)}}),b&&g.jsxs("button",{onClick:()=>w(!y),className:"mt-2 p-2 rounded-lg bg-black/10 hover:bg-black/20 border border-white/10 hover:border-blue-400/30 text-gray-300 hover:text-blue-300 transition-all flex items-center justify-center group relative",title:y?"显示时间轴":"聚焦模式：隐藏时间轴，专注于关联网络",children:[y?g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}):g.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),!y&&g.jsx("div",{className:"absolute right-full mr-2 px-2 py-1 bg-black/80 text-xs text-gray-300 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:"聚焦网络"})]})]})}function RYe({inputText:t,setInputText:e,inputRef:n,onKeyDown:r,onAddMemory:i,isCurrentDateToday:a}){return a?g.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-20 w-full pointer-events-none",children:g.jsx("div",{className:"max-w-4xl mx-auto px-3 pb-3 md:pb-5 pointer-events-auto",style:{paddingBottom:"max(0.75rem, env(safe-area-inset-bottom))"},children:g.jsx("div",{className:"relative",children:g.jsx("div",{className:"relative transition-all duration-300 group",children:g.jsxs("div",{className:"flex items-end gap-2 px-1 md:px-2 pb-2.5 border-b transition-colors",style:{borderColor:t.trim()?"rgba(255, 255, 255, 0.2)":"rgba(255, 255, 255, 0.1)"},children:[g.jsx("textarea",{ref:n,value:t,onChange:s=>e(s.target.value),onKeyDown:r,placeholder:"记录想法或灵感...",rows:1,className:"flex-1 bg-transparent text-white text-base placeholder-gray-500 outline-none resize-none max-h-[30vh] overflow-y-auto scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent focus:placeholder-gray-600 transition-colors",style:{lineHeight:"1.5",minHeight:"1.5em"},maxLength:E9.MAX_MEMORY_LENGTH}),g.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[t&&g.jsxs("div",{className:"hidden md:block text-xs text-gray-500 tabular-nums font-medium",children:[t.length,"/",E9.MAX_MEMORY_LENGTH]}),g.jsx("button",{onClick:i,disabled:!t.trim(),className:"shrink-0 w-10 h-10 md:w-10 md:h-10 rounded-xl transition-all duration-200 flex items-center justify-center disabled:opacity-30 disabled:cursor-not-allowed hover:scale-105 active:scale-95",style:{background:t.trim()?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.03)",border:t.trim()?"1px solid rgba(255, 255, 255, 0.2)":"1px solid rgba(255, 255, 255, 0.08)",color:t.trim()?"rgba(255, 255, 255, 0.85)":"rgba(255, 255, 255, 0.3)"},title:"记录 (桌面: Enter | 手机: Ctrl+⏎)",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})})})})}):null}function PYe({currentMemory:t,allMemories:e,relatedMemoryIds:n,onAddRelation:r,onRemoveRelation:i,onDeleteMemory:a,onUpdateMemory:s,onCreateCard:o,onCreateIndex:l,onCreateArena:u,onClose:c,position:d}){const[h,f]=P.useState(0),m=["relation","manage","info"][h],[x,b]=P.useState(""),[y,w]=P.useState([]),[_,S]=P.useState(!1),[M,E]=P.useState(!1),[C,R]=P.useState({x:0,y:0}),[k,I]=P.useState(!1),N=P.useRef(null),D=P.useRef(null),F=P.useRef(null),[L,U]=P.useState({left:d.x,top:d.y}),j=async W=>{W.stopPropagation();try{await navigator.clipboard.writeText(t.text),I(!0),setTimeout(()=>I(!1),1500)}catch(X){console.error("复制失败:",X)}},q=P.useMemo(()=>e.filter(W=>W.id!==t.id),[e,t.id]);P.useEffect(()=>{if(!x.trim()){(async()=>{const X=await kYe(t,q,{topK:10,minSimilarity:.3,timeout:2500});w(X.map(H=>({id:H.memory.id,text:H.memory.text,similarity:H.similarity,matchType:H.matchType})))})();return}return F.current&&clearTimeout(F.current),F.current=setTimeout(async()=>{const W=await ioe(x,q,{keywordThreshold:5,vectorLimit:50,topK:10,timeout:2500});w(W.map(X=>({id:X.memory.id,text:X.memory.text,similarity:X.similarity,matchType:X.matchType})))},300),()=>{F.current&&clearTimeout(F.current)}},[x,q,t]),P.useEffect(()=>{if(m==="relation"&&D.current?.focus(),M)return;const W=X=>{N.current&&!N.current.contains(X.target)&&c()};return document.addEventListener("mousedown",W),()=>document.removeEventListener("mousedown",W)},[c,m,M]),P.useEffect(()=>{const W=N.current;if(!W)return;const X=()=>{const J=W.getBoundingClientRect(),te=12,ee=window.innerWidth,se=window.innerHeight;let ue=d.x,oe=d.y;ue+J.width+te>ee&&(ue=ee-J.width-te),oe+J.height+te>se&&(oe=se-J.height-te),ue<te&&(ue=te),oe<te&&(oe=te),U({left:ue,top:oe})},H=window.requestAnimationFrame(X);return window.addEventListener("resize",X),()=>{window.cancelAnimationFrame(H),window.removeEventListener("resize",X)}},[d.x,d.y,m,y.length]);const Z=W=>n.includes(W),Q=W=>{Z(W)?i(W):r(W)},z=W=>{const X=W.target;X.tagName==="INPUT"||X.tagName==="TEXTAREA"||X.tagName==="BUTTON"||X.closest("button")||X.closest("input")||(E(!0),R({x:W.clientX-L.left,y:W.clientY-L.top}))};return P.useEffect(()=>{if(!M)return;const W=H=>{const J=H.clientX-C.x,te=H.clientY-C.y,ee=N.current;if(!ee)return;const se=ee.getBoundingClientRect(),ue=window.innerWidth,oe=window.innerHeight,Te=Math.max(10,Math.min(J,ue-se.width-10)),Ne=Math.max(10,Math.min(te,oe-se.height-10));U({left:Te,top:Ne})},X=()=>{E(!1)};return document.addEventListener("mousemove",W),document.addEventListener("mouseup",X),()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",X)}},[M,C]),g.jsx("div",{ref:N,className:"fixed z-50 w-[min(26rem,calc(100vw-24px))] h-[min(34rem,calc(100vh-24px))] flex flex-col animate-dialog-enter",style:{left:`${L.left}px`,top:`${L.top}px`},children:g.jsxs("div",{className:`relative bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col h-full ${M?"cursor-grabbing":""}`,children:[g.jsxs("div",{className:`px-4 pt-3.5 pb-3 border-b border-white/5 shrink-0 bg-white/[0.02] ${M?"":"cursor-grab"}`,onMouseDown:z,children:[g.jsxs("div",{className:"flex items-start justify-between gap-3",children:[g.jsxs("div",{className:"min-w-0 flex-1 cursor-pointer group",onClick:()=>S(!_),children:[g.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1.5 mb-1.5",children:[g.jsxs("svg",{className:"w-3.5 h-3.5 shrink-0 opacity-60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("title",{children:"拖动移动窗口"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})]}),g.jsx("span",{children:"记忆"}),g.jsx("svg",{className:`w-3 h-3 transition-transform ${_?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g.jsx("div",{className:`text-sm text-gray-200 leading-relaxed ${_?"":"line-clamp-1"}`,children:t.text})]}),g.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[_&&g.jsx("button",{onClick:j,className:"w-7 h-7 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-all flex items-center justify-center group/copy",title:"复制记忆",children:k?g.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),g.jsx("button",{onClick:c,className:"w-7 h-7 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-all flex items-center justify-center",title:"关闭",children:g.jsx("svg",{className:"w-4.5 h-4.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]})]}),g.jsx(QT.Group,{selectedIndex:h,onChange:f,children:g.jsx("div",{className:"mt-3",children:g.jsxs("div",{className:"flex items-end gap-2 border-b border-white/10",children:[g.jsx(QT.List,{className:"flex items-end gap-3",children:[{label:"关联",badge:n.length},{label:"管理"},{label:"信息"}].map((W,X)=>g.jsx(QT,{as:P.Fragment,children:({selected:H})=>g.jsxs("button",{className:["relative -mb-px px-1 pb-2 text-sm transition-colors","focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/30 focus-visible:ring-offset-0",H?"text-gray-200":"text-gray-500 hover:text-gray-300"].join(" "),children:[g.jsxs("span",{className:"flex items-center gap-2",children:[g.jsx("span",{children:W.label}),typeof W.badge=="number"&&g.jsx("span",{className:["min-w-5 h-5 px-1.5 rounded-full text-[11px] leading-5 text-center font-mono",H?"bg-blue-500/10 text-blue-200":"bg-white/5 text-gray-400"].join(" "),children:W.badge})]}),g.jsx("span",{className:["pointer-events-none absolute left-0 right-0 bottom-[-1px] h-[2px] rounded-full transition-opacity",H?"bg-blue-400/60 opacity-100":"bg-transparent opacity-0"].join(" ")})]})},X))}),g.jsx("div",{className:"ml-auto pb-2",children:g.jsx("div",{className:"text-[11px] text-gray-600 font-mono",children:m==="relation"?`Total: ${y.length}`:""})})]})})}),m==="relation"&&g.jsxs("div",{className:"mt-3 px-3 py-2.5 rounded-lg bg-white/[0.02] border border-white/5 flex items-center gap-2.5",children:[g.jsx("svg",{className:"w-4 h-4 text-gray-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{ref:D,type:"text",value:x,onChange:W=>b(W.target.value),placeholder:"搜索其它记忆...",className:"flex-1 bg-transparent text-sm text-gray-200 placeholder-gray-600 outline-none"}),g.jsx("div",{className:"text-[11px] text-gray-600 select-none",children:"智能"})]})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",style:{minHeight:"300px"},children:[m==="relation"&&(y.length===0?g.jsx("div",{className:"px-4 py-12 text-center text-sm text-gray-500",children:x?"未找到相关记忆":"暂无更多记忆"}):g.jsx("div",{className:"py-1.5",children:y.map(W=>{const X=Z(W.id);return g.jsx("button",{onClick:()=>Q(W.id),className:`
                    group w-full text-left px-4 py-2.5 transition-colors
                    ${X?"bg-blue-500/10":"hover:bg-white/[0.04]"}
                  `,children:g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:`
                      shrink-0 w-4 h-4 rounded-full flex items-center justify-center mt-0.5 transition-all
                      ${X?"bg-blue-500":"bg-white/10"}
                    `,children:X?g.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})}):g.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-500"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:`text-sm leading-relaxed line-clamp-2 ${X?"text-gray-100":"text-gray-200"}`,children:W.text}),x&&W.similarity>0&&g.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[g.jsx("div",{className:"flex-1 h-0.5 bg-white/5 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-500/60 rounded-full transition-all duration-300",style:{width:`${W.similarity*100}%`}})}),g.jsxs("span",{className:"text-[10px] text-gray-500 font-mono shrink-0 w-10 text-right",children:[(W.similarity*100).toFixed(0),"%"]})]})]})]})},W.id)})})),m==="manage"&&g.jsxs("div",{className:"space-y-2 p-3",children:[g.jsxs("div",{className:"space-y-1.5",children:[t.type!=="card"&&t.type!=="index"&&o&&g.jsxs("button",{onClick:()=>{o([t.id]),c()},className:"w-full px-3.5 py-2.5 rounded bg-white/5 hover:bg-white/10 border border-white/10 transition-colors text-sm flex items-center gap-2 text-gray-300",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),g.jsx("span",{children:"💎 提炼为知识卡片"})]}),l&&g.jsxs("button",{onClick:()=>{l([t.id]),c()},className:"w-full px-3.5 py-2.5 rounded bg-white/5 hover:bg-white/10 border border-white/10 transition-colors text-sm flex items-center gap-2 text-gray-300",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),g.jsx("span",{children:"📚 添加到索引"})]}),t.type!=="arena"&&u&&g.jsxs("button",{onClick:()=>{u(t.id),c()},className:"w-full px-3.5 py-2.5 rounded bg-white/5 hover:bg-white/10 border border-white/10 transition-colors text-sm flex items-center gap-2 text-gray-300",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),g.jsx("span",{children:"🥋 创建 Arena 推导"})]})]}),g.jsxs("div",{className:"rounded bg-white/[0.02] border border-white/5 divide-y divide-white/5 overflow-hidden",children:[g.jsxs("label",{className:"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-white/[0.02] transition-colors",children:[g.jsx("span",{className:"text-sm text-gray-400",children:"隐藏记忆"}),g.jsx("input",{type:"checkbox",checked:!!t.isHidden,onChange:W=>s(t.id,{isHidden:W.target.checked}),className:"w-3.5 h-3.5 accent-white/20 cursor-pointer"})]}),g.jsxs("div",{className:"px-3 py-2",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-sm text-gray-400",children:"高亮提醒"}),t.highlightUntil&&g.jsxs("span",{className:"text-[10px] text-gray-600 font-mono",children:["至 ",new Date(t.highlightUntil).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})]})]}),g.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[g.jsx("button",{onClick:()=>s(t.id,{highlightUntil:new Date(Date.now()+10080*60*1e3)}),className:"px-2 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-400 text-xs transition-colors text-center",children:"1周"}),g.jsx("button",{onClick:()=>s(t.id,{highlightUntil:new Date(Date.now()+336*60*60*1e3)}),className:"px-2 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-400 text-xs transition-colors text-center",children:"2周"}),g.jsx("button",{onClick:()=>s(t.id,{highlightUntil:new Date(Date.now()+720*60*60*1e3)}),className:"px-2 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-400 text-xs transition-colors text-center",children:"1月"}),g.jsx("button",{onClick:()=>s(t.id,{highlightUntil:void 0}),className:"px-2 py-1.5 rounded bg-white/5 hover:bg-white/10 text-gray-500 text-xs transition-colors text-center",children:"清除"})]})]})]})]}),m==="info"&&g.jsxs("div",{className:"space-y-2.5 p-3 text-sm",children:[g.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] p-3.5",children:[g.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"创建时间"}),g.jsx("div",{className:"text-gray-200",children:new Date(t.date).toLocaleString("zh-CN")})]}),g.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] p-3.5",children:[g.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"ID"}),g.jsx("div",{className:"text-gray-300 font-mono text-[12px] break-all",children:t.id})]}),g.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] p-3.5",children:[g.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"行为"}),g.jsxs("div",{className:"text-gray-300 flex flex-wrap gap-2 text-[12px]",children:[g.jsxs("span",{className:"px-2 py-1 rounded-md bg-white/5 border border-white/10",children:["visit ",t.visitCount??0]}),g.jsxs("span",{className:"px-2 py-1 rounded-md bg-white/5 border border-white/10",children:["edit ",t.editCount??0]}),g.jsxs("span",{className:"px-2 py-1 rounded-md bg-white/5 border border-white/10",children:["action ",t.actionability??"null"]})]})]})]})]}),m==="relation"&&g.jsx("div",{className:"px-4 py-3 border-t border-white/5 bg-black/20 backdrop-blur-md shrink-0",children:g.jsxs("div",{className:"flex items-center justify-between text-xs",children:[g.jsx("div",{className:"flex items-center gap-2",children:g.jsxs("span",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-lg transition-colors ${n.length>0?"bg-blue-500/10 text-blue-400":"text-gray-500"}`,children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${n.length>0?"bg-blue-400 animate-pulse":"bg-gray-600"}`}),"已关联 ",n.length," 条"]})}),g.jsxs("div",{className:"text-gray-600 font-mono",children:["Total: ",y.length]})]})}),g.jsx("style",{dangerouslySetInnerHTML:{__html:`
          .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
          }
          .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
          }
          .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
          }
          .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
          }
        `}})]})})}const e5=[{id:"insight",name:"洞察",description:"认知升级",icon:"💡",getContent:t=>`## 核心观点



---
### 源记忆
${t.map(n=>`- ${n.date?new Date(n.date).toLocaleDateString("zh-CN"):""}: ${n.text}`).join(`
`)}`},{id:"reflection",name:"反思",description:"情绪管理",icon:"🌊",getContent:t=>`## 发生了什么


## 我的感受


## 深层原因


## 我学到


---
### 源记忆
${t.map(n=>`- ${n.date?new Date(n.date).toLocaleDateString("zh-CN"):""}: ${n.text}`).join(`
`)}`},{id:"experience",name:"经验",description:"生活管理",icon:"📝",getContent:t=>`## 背景


## 做法


## 结果


## 启示

有效：

改进：

---
### 源记忆
${t.map(n=>`- ${n.date?new Date(n.date).toLocaleDateString("zh-CN"):""}: ${n.text}`).join(`
`)}`}];function DYe(t){if(t.length===0)return"insight";const e=t.map(s=>s.text).join(" ").toLowerCase(),r=["感觉","觉得","情绪","心情","难受","开心","焦虑","紧张","愤怒","难过","委屈","失落","兴奋","害怕","担心"].some(s=>e.includes(s)),a=["遇到","发生","做了","完成","项目","任务","问题","解决","方法","尝试","效果"].some(s=>e.includes(s));return r?"reflection":a?"experience":"insight"}function OYe({isOpen:t,onClose:e,onConfirm:n,sourceMemories:r}){const[i,a]=P.useState(""),[s,o]=P.useState(""),[l,u]=P.useState("insight"),[c,d]=P.useState(!1),[h,f]=P.useState(!1),m=P.useRef(null),x=P.useRef(null),b=P.useRef(!1);P.useEffect(()=>{if(t&&!b.current&&r.length>0){a(""),f(!1),o("");const _=DYe(r);u(_),setTimeout(()=>m.current?.focus(),100)}b.current=t},[t]),P.useEffect(()=>{if(t&&r.length>0&&!h){const _=e5.find(S=>S.id===l);_&&o(_.getContent(r))}},[l,t,r,h]),P.useEffect(()=>{const _=x.current;_&&(_.style.height="auto",_.style.height=`${_.scrollHeight}px`)},[s]);const y=async()=>{const _=i.trim(),S=s.trim();if(!_){alert("请输入卡片标题"),m.current?.focus();return}if(!S){alert("请输入卡片内容"),x.current?.focus();return}d(!0);try{await n({title:_,content:S,sourceMemoryIds:r.map(M=>M.id)}),e()}catch(M){console.error("创建卡片失败:",M),alert("创建失败，请重试")}finally{d(!1)}},w=()=>{const _=e5.find(M=>M.id===l),S=_?_.getContent(r):"";(i.trim()||s.trim()!==S.trim())&&!confirm("确定要放弃编辑吗？")||e()};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:w,className:"relative z-[100]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full h-full md:h-auto md:max-w-3xl md:max-h-[90vh] bg-[#0f111a]/95 backdrop-blur-xl md:rounded-2xl border-0 md:border border-white/10 shadow-2xl flex flex-col overflow-hidden",children:[g.jsxs("div",{className:"px-5 py-4 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-2xl",children:"💎"}),g.jsx(ar.Title,{className:"text-lg font-semibold text-gray-200",children:"提炼为知识卡片"})]}),g.jsx("button",{onClick:w,className:"w-8 h-8 rounded-lg hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",title:"关闭",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs(ar.Description,{className:"flex items-center gap-2 text-xs text-gray-500",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsxs("span",{children:["基于 ",r.length," 条记忆提炼"]})]})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs text-gray-500 mb-2 ml-1",children:"标题"}),g.jsx("input",{ref:m,type:"text",value:i,onChange:_=>a(_.target.value),placeholder:"给这个卡片起个名字...",className:"w-full bg-transparent border-b border-gray-700 px-2 py-2 text-white text-lg focus:outline-none focus:border-blue-500/50 transition-colors placeholder-gray-600",disabled:c,maxLength:100})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("label",{className:"text-xs text-gray-500 ml-1",children:"卡片内容"}),g.jsx("span",{className:"text-xs text-gray-600",children:"支持 Markdown"})]}),g.jsx("div",{className:"mb-3 border-b border-white/10",children:g.jsx("div",{className:"flex items-end gap-3",children:e5.map(_=>{const S=_.id===l;return g.jsxs("button",{type:"button",onClick:()=>u(_.id),className:["group relative -mb-px px-1 pb-2 text-sm transition-colors",S?"text-gray-200":"text-gray-500 hover:text-gray-300"].join(" "),title:_.description,children:[g.jsxs("span",{className:"flex items-center gap-1.5",children:[g.jsx("span",{children:_.icon}),g.jsx("span",{children:_.name})]}),g.jsx("span",{className:["absolute left-0 right-0 bottom-[-1px] h-[2px] rounded-full transition-opacity",S?"bg-blue-400/60 opacity-100":"bg-transparent opacity-0"].join(" ")}),g.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-1 px-2 py-1 bg-gray-900/95 border border-white/10 rounded text-xs text-gray-400 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:_.description})]},_.id)})})}),g.jsx("textarea",{ref:x,value:s,onChange:_=>{o(_.target.value),f(!0)},placeholder:"开始编写...",className:"w-full bg-gray-950/50 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all placeholder-gray-600 font-mono text-sm leading-relaxed resize-none overflow-hidden",disabled:c,rows:10,style:{minHeight:"200px"}})]})]}),g.jsxs("div",{className:"px-5 py-4 border-t border-white/5 flex gap-3 sticky bottom-0 bg-[#0f111a]/95 backdrop-blur-xl",children:[g.jsx("button",{onClick:w,disabled:c,className:"flex-1 px-4 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors text-sm font-medium disabled:opacity-50",children:"取消"}),g.jsx("button",{onClick:y,disabled:c||!i.trim()||!s.trim(),className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg transition-all shadow-lg shadow-blue-500/20 text-sm font-medium flex items-center justify-center gap-2",children:c?g.jsxs(g.Fragment,{children:[g.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"创建中"]}):g.jsxs(g.Fragment,{children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"保存卡片"]})})]})]})})})]})})}function LYe({isOpen:t,onClose:e,card:n,sourceMemories:r,onNavigateToMemory:i,onUpdateCard:a,position:s}){const[o,l]=P.useState({left:s.x,top:s.y}),[u,c]=P.useState(!1),[d,h]=P.useState(n.title||""),[f,m]=P.useState(n.content||""),[x,b]=P.useState(!1),[y,w]=P.useState({x:0,y:0}),_=P.useRef(null),S=P.useRef(null);P.useEffect(()=>{if(!_.current||!t)return;const I=_.current.getBoundingClientRect(),N=window.innerWidth,D=window.innerHeight;let F=s.x,L=s.y;F+I.width>N-10&&(F=N-I.width-10),F<10&&(F=10),L+I.height>D-10&&(L=D-I.height-10),L<10&&(L=10),l({left:F,top:L})},[s,t]),P.useEffect(()=>{if(!t||u)return;const I=N=>{_.current&&!_.current.contains(N.target)&&e()};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[t,u,e]),P.useEffect(()=>{t&&(h(n.title||""),m(n.content||""),c(!1))},[t,n]),P.useEffect(()=>{const I=S.current;I&&u&&(I.style.height="auto",I.style.height=`${I.scrollHeight}px`)},[f,u]);const M=()=>{if(!d.trim()||!f.trim()){alert("标题和内容不能为空");return}a&&a({...n,title:d.trim(),content:f.trim(),lastEditedAt:new Date}),c(!1)},E=()=>{(d!==n.title||f!==n.content)&&!confirm("确定要放弃修改吗？")||(h(n.title||""),m(n.content||""),c(!1))},C=I=>{const N=I.target;N.tagName==="INPUT"||N.tagName==="TEXTAREA"||N.tagName==="BUTTON"||N.closest("button")||(b(!0),w({x:I.clientX-o.left,y:I.clientY-o.top}))};P.useEffect(()=>{if(!x)return;const I=D=>{const F=D.clientX-y.x,L=D.clientY-y.y,U=_.current;if(!U)return;const j=U.getBoundingClientRect(),q=window.innerWidth,Z=window.innerHeight,Q=Math.max(10,Math.min(F,q-j.width-10)),z=Math.max(10,Math.min(L,Z-j.height-10));l({left:Q,top:z})},N=()=>{b(!1)};return document.addEventListener("mousemove",I),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",N)}},[x,y]);const R=Xt.useMemo(()=>(n.content||"").replace(/\n{4,}/g,N=>{const D=N.length-2;return`

`+Array(D).fill('<p class="empty-line-spacer">&nbsp;</p>').join(`
`)+`

`}),[n.content]);if(!t)return null;const k=n.date?new Date(n.date).toLocaleDateString("zh-CN"):"";return g.jsx("div",{ref:_,className:`fixed z-50 flex flex-col animate-dialog-enter
        inset-0 md:inset-auto
        md:w-[min(36rem,calc(100vw-24px))] md:max-h-[min(40rem,calc(100vh-24px))]`,style:{left:typeof window<"u"&&window.innerWidth>=768?`${o.left}px`:void 0,top:typeof window<"u"&&window.innerWidth>=768?`${o.top}px`:void 0},children:g.jsxs("div",{className:`rounded-2xl bg-[#1a1d2e]/98 backdrop-blur-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col ${x?"cursor-grabbing":""}`,children:[g.jsxs("div",{className:`px-5 py-4 border-b border-white/8 bg-gradient-to-b from-white/[0.02] to-transparent flex items-start justify-between gap-3 ${x?"":"cursor-grab"}`,onMouseDown:C,children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2.5 mb-1.5",children:[g.jsxs("svg",{className:"w-3.5 h-3.5 text-gray-500/60 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("title",{children:"拖动移动窗口"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})]}),g.jsx("span",{className:"text-xl",children:"💎"}),g.jsx("span",{className:"text-xs text-gray-500 font-mono",children:k}),u&&g.jsx("span",{className:"text-xs text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded border border-blue-500/20",children:"编辑中"})]}),u?g.jsx("input",{type:"text",value:d,onChange:I=>h(I.target.value),placeholder:"卡片标题...",className:"w-full bg-transparent border-b border-white/10 px-1 py-1.5 text-base font-semibold text-gray-100 leading-snug focus:outline-none focus:border-blue-400/50 transition-colors placeholder-gray-500",maxLength:100}):g.jsx("h3",{className:"text-base font-semibold text-gray-100 leading-snug",children:n.title||"无标题卡片"})]}),g.jsx("div",{className:"flex items-center gap-2 shrink-0",children:u?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:M,className:"px-3 py-1.5 rounded-lg bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 text-blue-300 text-sm transition-colors",title:"保存",children:"保存"}),g.jsx("button",{onClick:E,className:"px-3 py-1.5 rounded-lg hover:bg-white/5 text-gray-500 hover:text-gray-300 text-sm transition-colors",title:"取消",children:"取消"})]}):g.jsxs(g.Fragment,{children:[a&&g.jsx("button",{onClick:()=>c(!0),className:"px-3 py-1.5 rounded-lg hover:bg-white/5 text-gray-500 hover:text-gray-300 text-sm transition-colors",title:"编辑卡片 (E)",children:"编辑"}),g.jsx("button",{onClick:e,className:"w-7 h-7 rounded-lg hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",title:"关闭",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-5 space-y-5 card-content-scroll",children:[u?g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsx("label",{className:"text-xs font-medium text-gray-400 uppercase tracking-wider",children:"卡片内容"}),g.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[g.jsxs("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:[g.jsx("path",{d:"M13 7H7v6h6V7z"}),g.jsx("path",{fillRule:"evenodd",d:"M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z",clipRule:"evenodd"})]}),"Markdown"]})]}),g.jsx("textarea",{ref:S,value:f,onChange:I=>m(I.target.value),placeholder:"编写卡片内容...\n\n支持 Markdown 语法：\n# 标题\n**粗体** *斜体*\n- 列表项\n```代码块```",className:"w-full bg-[#0f111a]/60 border border-white/10 rounded-xl px-4 py-3.5 text-gray-200 focus:outline-none focus:border-blue-400/50 focus:ring-2 focus:ring-blue-400/10 transition-all placeholder-gray-600 font-mono text-sm leading-[1.7] resize-none",style:{minHeight:"320px"}})]}):g.jsx("div",{className:`prose prose-invert prose-sm max-w-none 
                            prose-headings:font-semibold prose-headings:text-gray-100
                            prose-h1:text-2xl prose-h1:border-b prose-h1:border-white/10 prose-h1:pb-3 prose-h1:mb-4
                            prose-h2:text-xl prose-h2:mb-4
                            prose-h3:text-lg prose-h3:mb-3
                            prose-h4:text-base prose-h4:mb-2
                            prose-h5:text-sm prose-h5:mb-2
                            prose-h6:text-sm prose-h6:mb-2
                            prose-p:text-gray-300 prose-p:leading-relaxed
                            prose-a:text-blue-400 prose-a:no-underline hover:prose-a:text-blue-300 hover:prose-a:underline
                            prose-strong:text-gray-100 prose-strong:font-semibold
                            prose-code:text-blue-300 prose-code:bg-blue-500/10 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:border prose-code:border-blue-500/20 prose-code:before:content-none prose-code:after:content-none
                            prose-pre:bg-gray-900/90 prose-pre:border prose-pre:border-white/5
                            prose-blockquote:border-l-blue-500/50 prose-blockquote:bg-blue-500/5 prose-blockquote:text-gray-300
                            prose-th:text-gray-300 prose-td:text-gray-400
                            prose-hr:border-white/10
                            prose-ul:text-gray-300 prose-ul:my-4 
                            prose-ol:text-gray-300 prose-ol:my-4
                            prose-li:text-gray-300
                            markdown-content-enhanced`,children:g.jsx(pre,{remarkPlugins:[jre,Uie,zie],rehypePlugins:[Kie,Nae],children:R})}),r.length>0&&g.jsxs("div",{className:"pt-5 mt-5 border-t border-white/10",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[g.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),g.jsxs("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:["源记忆 (",r.length,")"]})]}),g.jsx("div",{className:"space-y-2.5",children:r.map(I=>{const N=I.date?new Date(I.date).toLocaleDateString("zh-CN"):"";return g.jsx("button",{onClick:()=>i?.(I.id),className:"w-full text-left bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/10 rounded-lg px-4 py-3 transition-all group",children:g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("span",{className:"text-xs text-gray-600 font-mono shrink-0 mt-0.5 group-hover:text-blue-400 transition-colors",children:N}),g.jsx("p",{className:"text-xs text-gray-400 leading-[1.6] line-clamp-2 group-hover:text-gray-300 transition-colors",children:I.text})]})},I.id)})})]})]})]})})}function FYe({isOpen:t,onClose:e,onConfirm:n,allMemories:r,preselectedIds:i=[]}){const[a,s]=P.useState(""),[o,l]=P.useState(""),[u,c]=P.useState(i),[d,h]=P.useState(""),[f,m]=P.useState(!1),x=P.useRef(null);P.useEffect(()=>{t&&(s(""),l(""),c(i),h(""),setTimeout(()=>x.current?.focus(),100))},[t,i]);const b=r.filter(C=>{if(C.isTemporary||C.isHidden)return!1;if(d.trim()){const R=d.toLowerCase(),k=C.title?.toLowerCase().includes(R),I=C.text.toLowerCase().includes(R);return k||I}return!0}),y=C=>{c(R=>R.includes(C)?R.filter(k=>k!==C):[...R,C])},w=async()=>{const C=a.trim(),R=o.trim();if(!C){alert("请输入索引名称"),x.current?.focus();return}if(u.length===0){alert("请至少选择一个内容添加到索引");return}m(!0);try{await n({title:C,description:R,linkedIds:u}),e()}catch(k){console.error("创建索引失败:",k),alert("创建失败，请重试")}finally{m(!1)}},_=()=>{(a.trim()||o.trim()||u.length>0)&&!confirm("确定要放弃创建吗？")||e()},S=C=>C.type==="card"?"💎 卡片":C.type==="index"?"📚 索引":"💭 记忆",M=C=>C.title?C.title:C.text.slice(0,50)+(C.text.length>50?"...":""),E=r.filter(C=>u.includes(C.id));return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:_,className:"relative z-[100]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-3xl max-h-[90vh] bg-[#0f111a]/95 backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl flex flex-col overflow-hidden",children:[g.jsxs("div",{className:"px-5 py-4 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-2xl",children:"📚"}),g.jsx(ar.Title,{className:"text-lg font-semibold text-gray-200",children:"创建索引入口"})]}),g.jsx("button",{onClick:_,className:"w-8 h-8 rounded-lg hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",title:"关闭",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx(ar.Description,{className:"text-xs text-gray-500",children:"索引入口是某个主题的目录，汇总相关的记忆、卡片和其他索引"})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[g.jsxs("div",{children:[g.jsxs("label",{className:"block text-xs text-gray-500 mb-2 ml-1",children:["索引名称 ",g.jsx("span",{className:"text-red-400",children:"*"})]}),g.jsx("input",{ref:x,type:"text",value:a,onChange:C=>s(C.target.value),placeholder:"例如：个人成长、项目管理、健康生活...",className:"w-full bg-transparent border-b border-gray-700 px-2 py-2 text-white text-lg focus:outline-none focus:border-blue-500/50 transition-colors placeholder-gray-600",disabled:f,maxLength:50})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs text-gray-500 mb-2 ml-1",children:"索引描述（可选）"}),g.jsx("input",{type:"text",value:o,onChange:C=>l(C.target.value),placeholder:"简要说明这个索引包含什么内容...",className:"w-full bg-gray-950/50 border border-gray-700 rounded-xl px-4 py-2 text-white text-sm focus:outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all placeholder-gray-600",disabled:f,maxLength:200})]}),E.length>0&&g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("label",{className:"text-xs text-gray-500 ml-1",children:["已选内容（",E.length,"）"]}),g.jsx("button",{onClick:()=>c([]),className:"text-xs text-gray-600 hover:text-gray-400 transition-colors",children:"清空"})]}),g.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent",children:E.map(C=>g.jsxs("div",{className:"flex items-center gap-2 bg-blue-500/10 border border-blue-500/20 rounded-lg px-3 py-2 text-sm",children:[g.jsx("span",{className:"text-xs",children:S(C)}),g.jsx("span",{className:"flex-1 text-gray-300 truncate",children:M(C)}),g.jsx("button",{onClick:()=>y(C.id),className:"text-gray-500 hover:text-gray-300 transition-colors",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},C.id))})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("label",{className:"text-xs text-gray-500 ml-1",children:["选择要包含的内容 ",g.jsx("span",{className:"text-red-400",children:"*"})]}),g.jsxs("span",{className:"text-xs text-gray-600",children:["可选 ",b.length," 条"]})]}),g.jsx("input",{type:"text",value:d,onChange:C=>h(C.target.value),placeholder:"搜索记忆、卡片或索引...",className:"w-full bg-gray-950/50 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500/50 transition-colors placeholder-gray-600 mb-2"}),g.jsx("div",{className:"space-y-1 max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent border border-gray-700 rounded-lg p-2",children:b.length===0?g.jsx("div",{className:"text-center py-8 text-gray-600 text-sm",children:d?"没有找到匹配的内容":"没有可选内容"}):b.map(C=>{const R=u.includes(C.id);return g.jsxs("button",{onClick:()=>y(C.id),className:`w-full text-left flex items-start gap-2 px-3 py-2 rounded-lg transition-all ${R?"bg-blue-500/20 border border-blue-500/30":"hover:bg-white/5 border border-transparent"}`,children:[g.jsx("div",{className:`w-5 h-5 rounded border-2 shrink-0 mt-0.5 flex items-center justify-center transition-all ${R?"bg-blue-600 border-blue-600":"border-gray-600"}`,children:R&&g.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:S(C)}),g.jsx("div",{className:"text-sm text-gray-300 line-clamp-2",children:M(C)})]})]},C.id)})})]})]}),g.jsxs("div",{className:"px-5 py-4 border-t border-white/5 flex gap-3",children:[g.jsx("button",{onClick:_,disabled:f,className:"flex-1 px-4 py-2.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors text-sm font-medium disabled:opacity-50",children:"取消"}),g.jsx("button",{onClick:w,disabled:f||!a.trim()||u.length===0,className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-800 disabled:text-gray-600 text-white rounded-lg transition-all shadow-lg shadow-blue-500/20 text-sm font-medium flex items-center justify-center gap-2",children:f?g.jsxs(g.Fragment,{children:[g.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"创建中"]}):g.jsxs(g.Fragment,{children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"创建索引"]})})]})]})})})]})})}function BYe({isOpen:t,onClose:e,index:n,linkedMemories:r,allMemories:i,onNavigateToMemory:a,onUpdateIndex:s,position:o}){const[l,u]=P.useState({left:o.x,top:o.y}),[c,d]=P.useState(!1),[h,f]=P.useState(n.title||""),[m,x]=P.useState(n.description||""),[b,y]=P.useState(!1),[w,_]=P.useState({x:0,y:0}),[S,M]=P.useState(!1),[E,C]=P.useState(""),R=P.useRef(null),k=P.useRef(null);P.useEffect(()=>{if(!R.current||!t)return;const Q=R.current.getBoundingClientRect(),z=window.innerWidth,W=window.innerHeight;let X=o.x,H=o.y;X+Q.width>z-10&&(X=z-Q.width-10),X<10&&(X=10),H+Q.height>W-10&&(H=W-Q.height-10),H<10&&(H=10),u({left:X,top:H})},[o,t]),P.useEffect(()=>{if(!t||c||b)return;const Q=z=>{R.current&&!R.current.contains(z.target)&&e()};return document.addEventListener("mousedown",Q),()=>document.removeEventListener("mousedown",Q)},[t,c,b,e]),P.useEffect(()=>{t&&(f(n.title||""),x(n.description||""),d(!1))},[t,n]);const I=()=>{if(!h.trim()){alert("索引名称不能为空");return}s&&s({...n,title:h.trim(),description:m.trim(),lastEditedAt:new Date}),d(!1)},N=()=>{(h!==n.title||m!==n.description)&&!confirm("确定要放弃修改吗？")||(f(n.title||""),x(n.description||""),d(!1))},D=Q=>{if(s){const z=n.linkedIds||[];z.includes(Q)||s({...n,linkedIds:[...z,Q],lastEditedAt:new Date})}C(""),M(!1)},F=Q=>{if(confirm("确定要从索引中移除这条记忆吗？")&&s){const z=n.linkedIds||[];s({...n,linkedIds:z.filter(W=>W!==Q),lastEditedAt:new Date})}},L=P.useMemo(()=>{const Q=n.linkedIds||[];return i.filter(z=>!Q.includes(z.id)&&z.id!==n.id&&(E===""||z.text.toLowerCase().includes(E.toLowerCase())||z.title?.toLowerCase().includes(E.toLowerCase()))).slice(0,10)},[i,n.linkedIds,n.id,E]);P.useEffect(()=>{S&&k.current&&k.current.focus()},[S]);const U=Q=>{const z=Q.target;z.tagName==="INPUT"||z.tagName==="TEXTAREA"||z.tagName==="BUTTON"||z.closest("button")||(y(!0),_({x:Q.clientX-l.left,y:Q.clientY-l.top}))};if(P.useEffect(()=>{if(!b)return;const Q=W=>{const X=W.clientX-w.x,H=W.clientY-w.y,J=R.current;if(!J)return;const te=J.getBoundingClientRect(),ee=window.innerWidth,se=window.innerHeight,ue=Math.max(10,Math.min(X,ee-te.width-10)),oe=Math.max(10,Math.min(H,se-te.height-10));u({left:ue,top:oe})},z=()=>{y(!1)};return document.addEventListener("mousemove",Q),document.addEventListener("mouseup",z),()=>{document.removeEventListener("mousemove",Q),document.removeEventListener("mouseup",z)}},[b,w]),!t)return null;const j=n.date?new Date(n.date).toLocaleDateString("zh-CN"):"",q=Q=>Q.type==="card"?"💎":Q.type==="index"?"📚":"💭",Z=Q=>Q.title?Q.title:Q.text;return g.jsx("div",{ref:R,className:"fixed z-50 w-[min(36rem,calc(100vw-24px))] max-h-[min(40rem,calc(100vh-24px))] flex flex-col animate-dialog-enter",style:{left:`${l.left}px`,top:`${l.top}px`},children:g.jsxs("div",{className:`rounded-2xl bg-[#0f111a]/95 backdrop-blur-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col ${b?"cursor-grabbing":""}`,children:[g.jsxs("div",{className:`px-4 py-3 border-b border-white/5 flex items-start justify-between gap-3 ${b?"":"cursor-grab"}`,onMouseDown:U,children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsxs("svg",{className:"w-4 h-4 text-gray-600 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("title",{children:"拖动移动窗口"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})]}),g.jsx("span",{className:"text-xl",children:"📚"}),g.jsx("span",{className:"text-xs text-gray-600 font-mono",children:j}),c&&g.jsx("span",{className:"text-xs text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded",children:"编辑中"})]}),c?g.jsx("input",{type:"text",value:h,onChange:Q=>f(Q.target.value),placeholder:"索引名称...",className:"w-full bg-transparent border-b border-gray-700 px-1 py-1 text-base font-semibold text-gray-200 leading-snug focus:outline-none focus:border-blue-500/50 transition-colors placeholder-gray-600",maxLength:50}):g.jsx("h3",{className:"text-base font-semibold text-gray-200 leading-snug",children:n.title||"无标题索引"}),c?g.jsx("input",{type:"text",value:m,onChange:Q=>x(Q.target.value),placeholder:"索引描述...",className:"w-full mt-1 bg-transparent border-b border-gray-700 px-1 py-1 text-xs text-gray-400 focus:outline-none focus:border-blue-500/50 transition-colors placeholder-gray-600",maxLength:200}):n.description&&g.jsx("p",{className:"text-xs text-gray-400 mt-1",children:n.description})]}),g.jsx("div",{className:"flex items-center gap-2 shrink-0",children:c?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:I,className:"px-3 py-1.5 rounded-lg bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 text-blue-300 text-sm transition-colors",title:"保存",children:"保存"}),g.jsx("button",{onClick:N,className:"px-3 py-1.5 rounded-lg hover:bg-white/5 text-gray-500 hover:text-gray-300 text-sm transition-colors",title:"取消",children:"取消"})]}):g.jsxs(g.Fragment,{children:[s&&g.jsx("button",{onClick:()=>d(!0),className:"px-3 py-1.5 rounded-lg hover:bg-white/5 text-gray-500 hover:text-gray-300 text-sm transition-colors",title:"编辑索引 (E)",children:"编辑"}),g.jsx("button",{onClick:e,className:"w-7 h-7 rounded-lg hover:bg-white/5 transition-colors flex items-center justify-center text-gray-500 hover:text-gray-300",title:"关闭",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}),g.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"text-xs text-gray-500",children:["包含内容（",r.length,"）"]}),s&&g.jsxs("button",{onClick:()=>M(!S),className:"px-2 py-1 rounded text-xs transition-colors flex items-center gap-1",style:{background:S?"#1e40af20":"#ffffff08",border:S?"1px solid #3b82f650":"1px solid #ffffff10",color:S?"#60a5fa":"#9ca3af"},children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:S?g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),S?"取消":"添加"]})]}),S&&g.jsxs("div",{className:"mb-3 space-y-2",children:[g.jsx("input",{ref:k,type:"text",value:E,onChange:Q=>C(Q.target.value),placeholder:"搜索记忆/卡片/索引...",className:"w-full bg-white/5 border border-blue-500/30 rounded-lg px-3 py-2 text-sm text-gray-200 placeholder-gray-600 focus:outline-none focus:border-blue-500/50 transition-colors"}),L.length>0&&g.jsx("div",{className:"max-h-40 overflow-y-auto space-y-1 bg-black/20 rounded-lg p-2 border border-white/5",children:L.map(Q=>{const z=Q.date?new Date(Q.date).toLocaleDateString("zh-CN"):"";return g.jsx("button",{onClick:()=>D(Q.id),className:"w-full text-left bg-white/5 hover:bg-white/10 border border-white/5 rounded px-2 py-1.5 transition-colors group",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-base shrink-0",children:q(Q)}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"flex items-center gap-2",children:g.jsx("span",{className:"text-xs text-gray-600 font-mono shrink-0",children:z})}),g.jsx("p",{className:"text-xs text-gray-300 leading-relaxed line-clamp-1",children:Z(Q)})]}),g.jsx("svg",{className:"w-3 h-3 text-blue-400 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})]})},Q.id)})}),E&&L.length===0&&g.jsx("div",{className:"text-center py-4 text-gray-600 text-xs",children:"没有找到匹配的记忆"})]}),r.length===0?g.jsx("div",{className:"text-center py-8 text-gray-600 text-sm",children:"此索引暂无内容"}):g.jsx("div",{className:"space-y-2",children:r.map(Q=>{const z=Q.date?new Date(Q.date).toLocaleDateString("zh-CN"):"";return g.jsx("div",{className:"bg-white/5 hover:bg-white/10 border border-white/5 rounded-lg px-3 py-2 transition-colors group",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsxs("button",{onClick:()=>a?.(Q.id),className:"flex-1 text-left flex items-start gap-2 min-w-0",children:[g.jsx("span",{className:"text-xl shrink-0",children:q(Q)}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[g.jsx("span",{className:"text-xs text-gray-600 font-mono shrink-0 group-hover:text-blue-400 transition-colors",children:z}),Q.type==="card"&&g.jsx("span",{className:"text-xs text-gray-600",children:"卡片"}),Q.type==="index"&&g.jsx("span",{className:"text-xs text-gray-600",children:"索引"})]}),g.jsx("p",{className:"text-sm text-gray-300 leading-relaxed line-clamp-2 group-hover:text-gray-200 transition-colors",children:Z(Q)})]})]}),s&&g.jsx("button",{onClick:()=>F(Q.id),className:"shrink-0 w-6 h-6 rounded hover:bg-red-500/20 text-gray-600 hover:text-red-400 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",title:"移除",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},Q.id)})})]})})]})})}function UYe({isOpen:t,onClose:e,onConfirm:n,title:r="验证密码",description:i="为了您的数据安全，请验证访问密码"}){const[a,s]=P.useState(""),[o,l]=P.useState(!1),[u,c]=P.useState(""),d=P.useRef(null);P.useEffect(()=>{t&&(s(""),c(""),l(!1))},[t]);const h=async()=>{if(a){l(!0),c("");try{await n(a),e()}catch(f){const m=f instanceof Error?f.message:"密码错误";c(m)}finally{l(!1)}}};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:e,className:"relative z-[100]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-sm bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.02]",children:[g.jsx(ar.Title,{className:"text-base font-medium text-gray-200",children:r}),i&&g.jsx(ar.Description,{className:"text-sm text-gray-500 mt-1",children:i})]}),g.jsxs("div",{className:"px-6 py-5",children:[g.jsx("input",{ref:d,type:"password",value:a,onChange:f=>s(f.target.value),placeholder:"请输入密码",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2.5 text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-white/30 transition-colors",onKeyDown:f=>f.key==="Enter"&&h(),disabled:o}),u&&g.jsx("div",{className:"text-red-400 text-xs bg-red-500/10 border border-red-500/20 rounded p-2 mt-3",children:u})]}),g.jsxs("div",{className:"px-6 py-4 border-t border-white/5 flex justify-end gap-2",children:[g.jsx("button",{onClick:e,disabled:o,className:"px-4 py-2 rounded text-sm text-gray-400 hover:text-gray-300 hover:bg-white/5 transition-colors",children:"取消"}),g.jsx("button",{onClick:h,disabled:o||!a,className:"px-4 py-2 rounded text-sm bg-white/10 hover:bg-white/15 text-white transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:o?"验证中...":"确认"})]})]})})})]})})}function zYe({isOpen:t,onClose:e,onValidatePassword:n,onConfirmDanger:r,title:i="高危操作确认",description:a="该操作不可恢复，请认真确认。",requiredPhrase:s}){const[o,l]=P.useState(""),[u,c]=P.useState(""),[d,h]=P.useState(!1),[f,m]=P.useState(""),x=P.useRef(null);P.useEffect(()=>{t&&(l(""),c(""),h(!1),m(""))},[t]);const b=P.useMemo(()=>u.trim()===s,[u,s]),y=P.useMemo(()=>o.trim().length>0,[o]),w=b&&y&&!d,_=async()=>{if(w){h(!0),m("");try{if(n&&await n(o),!b)throw new Error("确认语句不匹配");await r(),e()}catch(S){const M=S instanceof Error?S.message:"操作失败";m(M)}finally{h(!1)}}};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:e,className:"relative z-[120]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/20"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-md bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden",children:[g.jsx("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.02]",children:g.jsxs("div",{className:"flex items-start justify-between gap-3",children:[g.jsxs("div",{children:[g.jsx(ar.Title,{className:"text-base font-medium text-gray-200",children:i}),g.jsx(ar.Description,{className:"text-sm text-gray-500 mt-1",children:a})]}),g.jsx("button",{onClick:e,disabled:d,className:"w-7 h-7 rounded hover:bg-white/10 text-gray-500 hover:text-gray-300 transition-colors flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),g.jsxs("div",{className:"px-6 py-5 space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"密码"}),g.jsx("input",{ref:x,type:"password",value:o,onChange:S=>l(S.target.value),placeholder:"请输入访问密码",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2.5 text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-white/30 transition-colors",onKeyDown:S=>S.key==="Enter"&&_(),disabled:d})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"确认语句（必须完全一致）"}),g.jsx("input",{type:"text",value:u,onChange:S=>c(S.target.value),placeholder:s,className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2.5 text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-white/30 transition-colors",onKeyDown:S=>S.key==="Enter"&&_(),disabled:d}),g.jsxs("div",{className:"mt-1.5 text-xs text-gray-600 font-mono",children:["需要输入：",s]})]}),f&&g.jsx("div",{className:"text-red-400 text-xs bg-red-500/10 border border-red-500/20 rounded p-2",children:f})]}),g.jsxs("div",{className:"px-6 py-4 border-t border-white/5 flex justify-end gap-2",children:[g.jsx("button",{onClick:e,disabled:d,className:"px-4 py-2 rounded text-sm text-gray-400 hover:text-gray-300 hover:bg-white/5 transition-colors",children:"取消"}),g.jsx("button",{onClick:_,disabled:!w,className:"px-4 py-2 rounded text-sm bg-red-600 hover:bg-red-700 disabled:bg-white/5 disabled:text-gray-600 text-white transition-colors",children:d?"处理中...":"我已确认，执行"})]})]})})})]})})}function jYe(){return`arena-node-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function HYe(t,e){if(!t)return 0;const n=e[t];return n?n.depth+1:0}function $Ye(t,e){if(!t)return 0;const n=e[t];return n?n.children.length:0}function VYe(t){const[e,n]=P.useState(t.arenaNodes||{}),[r,i]=P.useState(null),[a,s]=P.useState(null),[o,l]=P.useState(!1),u=t.arenaRootNodeId||null,c=P.useCallback((_,S)=>{const M=jYe(),E={id:M,text:S,parentId:_,status:"exploring",children:[],depth:HYe(_,e),order:$Ye(_,e),createdAt:new Date};return n(C=>{const R={...C,[M]:E};return _&&R[_]&&(R[_]={...R[_],children:[...R[_].children,M]}),R}),l(!0),M},[e]),d=P.useCallback((_,S)=>{n(M=>M[_]?{...M,[_]:{...M[_],...S,lastEditedAt:new Date}}:M),l(!0)},[]),h=P.useCallback(_=>{n(S=>{const M=S[_];if(!M)return S;const E={...S},C=R=>{const k=E[R];k&&(k.children.forEach(I=>C(I)),delete E[R])};return M.parentId&&E[M.parentId]&&(E[M.parentId]={...E[M.parentId],children:E[M.parentId].children.filter(R=>R!==_)}),C(_),E}),r===_&&i(null),a===_&&s(null),l(!0)},[r,a]),f=P.useCallback((_,S,M)=>{n(E=>{const C={...E},R=I=>{const N=C[I];N&&(C[I]={...N,dependsOnInvalid:!0},N.children.forEach(D=>{R(D)}))},k=I=>{const N=C[I];N&&(C[I]={...N,dependsOnInvalid:!1},N.children.forEach(D=>{k(D)}))};return C[_]&&(C[_]={...C[_],status:S,lastEditedAt:new Date,...S==="invalid"&&M?{invalidReason:M}:{},...S==="invalid"?{dependsOnInvalid:!1}:{}},S==="invalid"?C[_].children.forEach(N=>{R(N)}):E[_]?.status==="invalid"&&C[_].children.forEach(N=>{k(N)})),C}),l(!0)},[]),m=P.useCallback(_=>{const S=e[_];return S?S.children.map(M=>e[M]).filter(M=>!!M):[]},[e]),x=P.useCallback(_=>{const S=[];let M=_;for(;M;){const E=e[M];if(!E)break;S.unshift(E),M=E.parentId}return S},[e]),b=P.useCallback(()=>Object.values(e).filter(_=>_.dependsOnInvalid===!0).length,[e]),y=P.useCallback(()=>Object.values(e).filter(_=>_.status==="invalid"||_.dependsOnInvalid===!0),[e]),w=P.useCallback(()=>{Object.values(e).filter(S=>S.status==="invalid").map(S=>S.id).forEach(S=>{h(S)})},[e,h]);return{nodes:e,selectedNodeId:r,editingNodeId:a,rootNodeId:u,setSelectedNodeId:i,setEditingNodeId:s,addNode:c,updateNode:d,deleteNode:h,markStatus:f,getNodeChildren:m,getNodePath:x,hasUnsavedChanges:o,countInvalidDependentNodes:b,getInvalidNodes:y,cleanupInvalidBranches:w}}const qYe={"?":{bg:"bg-cyan-500/20",text:"text-cyan-300",border:"border-cyan-400/40",symbol:"?",label:"术语"},"!":{bg:"bg-orange-500/20",text:"text-orange-300",border:"border-orange-400/40",symbol:"!",label:"假设"},"->":{bg:"bg-green-500/20",text:"text-green-300",border:"border-green-400/40",symbol:"→",label:"推论"}};function GYe({type:t,className:e=""}){const n=qYe[t];return g.jsx("span",{className:`inline-flex items-center justify-center w-5 h-5 rounded-full border ${n.bg} ${n.text} ${n.border} text-[10px] font-bold flex-shrink-0 ${e}`,title:`分类：${n.label}`,children:n.symbol})}const WYe={exploring:"bg-blue-400/5",valid:"bg-green-400/5",invalid:"bg-gray-500/5 opacity-60"},YYe={exploring:"🔵",valid:"✅",invalid:"❌"},XYe="bg-yellow-500/5 border-yellow-400/30 opacity-75",KYe=({node:t,depth:e,isSelected:n,isCollapsed:r,onClick:i,onAddChild:a,onEdit:s,onDelete:o,onToggleStatus:l,onToggleCollapse:u,allMemories:c=[]})=>{const[d,h]=P.useState(!1),f=m=>{m.stopPropagation(),s()};return g.jsxs("div",{className:`
        group relative
        border border-white/5 rounded-xl p-2 mb-2 cursor-pointer transition-all duration-200
        hover:shadow-lg hover:shadow-black/10 hover:border-white/10 hover:bg-white/[0.02]
        ${t.dependsOnInvalid?XYe:WYe[t.status]}
        ${n?"ring-1 ring-blue-400/30 shadow-lg shadow-blue-500/5 border-blue-400/20 bg-blue-500/5":""}
        ${t.status==="invalid"?"line-through":""}
        ${t.dependsOnInvalid?"italic":""}
      `,onClick:i,onDoubleClick:f,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[g.jsxs("div",{className:"flex items-center gap-2",children:[t.children.length>0&&g.jsx("button",{onClick:m=>{m.stopPropagation(),u()},className:"shrink-0 w-4 h-4 flex items-center justify-center hover:bg-white/10 rounded transition-colors",title:r?"展开延伸":"折叠延伸",children:g.jsx("svg",{className:`w-3 h-3 text-gray-400 transition-transform ${r?"":"rotate-90"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),g.jsx("div",{className:"shrink-0 text-sm leading-none",children:YYe[t.status]}),t.dependsOnInvalid&&g.jsx("div",{className:"shrink-0 text-xs text-yellow-400",title:"⚠️ 此节点依赖于无效的前提",children:"🔘"}),t.classificationType&&g.jsx(GYe,{type:t.classificationType}),g.jsxs("div",{className:"flex-1 min-w-0 flex items-start gap-2",children:[g.jsxs("div",{className:"flex-1 text-xs text-gray-100 leading-relaxed line-clamp-3 relative group/text",children:[t.text,g.jsx("div",{className:"absolute -right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover/text:opacity-100 transition-opacity pointer-events-none",children:g.jsxs("div",{className:"flex items-center gap-1 bg-blue-500/20 text-blue-300 text-[10px] px-1.5 py-0.5 rounded whitespace-nowrap",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),g.jsx("span",{children:"双击编辑"})]})})]}),t.metadataTags&&t.metadataTags.length>0&&g.jsxs("div",{className:"flex flex-wrap gap-1 mt-0.5",children:[t.metadataTags.slice(0,2).map(m=>g.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] bg-white/10 text-gray-400 border border-white/10",title:m,children:m},m)),t.metadataTags.length>2&&g.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] bg-white/10 text-gray-400 border border-white/10",title:`还有 ${t.metadataTags.length-2} 个标签`,children:["+",t.metadataTags.length-2]})]})]}),r&&t.children.length>0&&g.jsx("div",{className:"shrink-0 text-[10px] text-gray-500 px-1.5 py-0.5 bg-white/5 rounded",children:t.children.length}),g.jsx("button",{onClick:m=>{m.stopPropagation(),a()},className:`
            shrink-0 w-6 h-6 flex items-center justify-center
            text-blue-400/70 hover:text-blue-400 transition-all duration-200
            hover:scale-110
            ${n?"opacity-100 scale-100":"opacity-0 scale-90 pointer-events-none"}
          `,title:"延伸推导 (Tab)",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),g.jsxs("div",{className:"hidden",children:[g.jsx("button",{onClick:m=>{m.stopPropagation(),a()},className:"w-5 h-5 rounded hover:bg-white/10 text-gray-500 hover:text-white transition-all flex items-center justify-center",title:"添加子节点 (Tab)",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 4v16m8-8H4"})})}),g.jsx("button",{onClick:m=>{m.stopPropagation(),s()},className:"w-5 h-5 rounded hover:bg-white/10 text-gray-500 hover:text-white transition-all flex items-center justify-center",title:"编辑 (Enter)",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g.jsx("button",{onClick:m=>{m.stopPropagation(),l()},className:"w-5 h-5 rounded hover:bg-white/10 text-gray-500 hover:text-white transition-all flex items-center justify-center",title:"切换状态",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx("button",{onClick:m=>{m.stopPropagation(),confirm("确定要删除这个节点及其所有子节点吗？")&&o()},className:"w-5 h-5 rounded hover:bg-red-500/20 text-gray-500 hover:text-red-400 transition-all flex items-center justify-center",title:"删除 (Del)",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),d&&(t.reasoning||t.invalidReason||t.dependsOnInvalid||t.evidenceIds&&t.evidenceIds.length>0)&&g.jsxs("div",{className:"mt-1 pt-1 border-t border-white/5 space-y-0.5",children:[t.reasoning&&g.jsxs("div",{className:"text-[10px] text-gray-400 leading-tight",children:["💭 ",t.reasoning]}),t.invalidReason&&g.jsxs("div",{className:"text-[10px] text-red-400 leading-tight",children:["⚠️ ",t.invalidReason]}),t.dependsOnInvalid&&g.jsx("div",{className:"text-[10px] text-yellow-400 leading-tight",children:"🔘 此节点依赖于无效的前提，推论可能不成立"}),t.evidenceIds&&t.evidenceIds.length>0&&g.jsxs("div",{className:"text-[10px] text-gray-400 leading-tight",children:[g.jsx("div",{className:"font-medium mb-0.5",children:"📎 证据支持："}),t.evidenceIds.slice(0,2).map(m=>{const x=c.find(b=>b.id===m);return x?g.jsxs("div",{className:"ml-2 text-[9px] text-gray-500",children:[x.type==="card"?"💎":"💭"," ",(x.title||x.text).slice(0,40),"..."]},m):null}),t.evidenceIds.length>2&&g.jsxs("div",{className:"ml-2 text-[9px] text-gray-600",children:["还有 ",t.evidenceIds.length-2," 条证据..."]})]})]})]})},ZYe=({nodes:t,rootNodeId:e,selectedNodeId:n,editingNodeId:r,onSelectNode:i,onAddChild:a,onEditNode:s,onDeleteNode:o,onToggleStatus:l,onAddRootNode:u,allMemories:c=[]})=>{const[d,h]=P.useState(new Set),f=x=>{h(b=>{const y=new Set(b);return y.has(x)?y.delete(x):y.add(x),y})},m=(x,b=0)=>{const y=t[x];if(!y)return null;const w=d.has(x);return g.jsxs("div",{children:[g.jsxs("div",{style:{marginLeft:`${b*2}rem`},className:"relative",children:[b>0&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"absolute left-0 top-0 w-[2px] bg-gradient-to-b from-white/30 via-white/20 to-white/10",style:{height:"100%",marginLeft:"-1rem"}}),g.jsx("div",{className:"absolute top-4 h-[2px] bg-gradient-to-r from-white/30 to-transparent",style:{width:"1rem",marginLeft:"-1rem"}}),g.jsx("div",{className:"absolute top-4 w-1.5 h-1.5 rounded-full bg-white/40",style:{marginLeft:"-0.25rem"}})]}),g.jsx(KYe,{node:y,depth:b,isSelected:n===x,isEditing:r===x,isCollapsed:w,onClick:()=>i(x),onAddChild:()=>a(x),onEdit:()=>s(x),onDelete:()=>o(x),onToggleStatus:()=>l(x),onToggleCollapse:()=>f(x),allMemories:c})]}),!w&&y.children.map(_=>m(_,b+1))]},x)};return!e||!t[e]?g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsxs("div",{className:"text-center max-w-md px-4",children:[g.jsx("div",{className:"text-4xl mb-3 opacity-40",children:"🤔"}),g.jsx("div",{className:"text-gray-500 text-sm mb-6",children:"从一个问题开始，逐步推导和探索思维路径"}),g.jsxs("button",{onClick:u,className:"group px-5 py-2.5 rounded-lg bg-white/5 hover:bg-white/10 backdrop-blur-sm border border-white/10 hover:border-white/20 text-gray-400 hover:text-white transition-all duration-300 flex items-center gap-2 mx-auto text-sm",children:[g.jsx("svg",{className:"w-4 h-4 transition-transform group-hover:scale-110",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),g.jsx("span",{children:"设定起点"})]})]})}):g.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar p-3",children:[m(e),g.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.2);
        }
      `}})]})};function MH(t){const n=t.toLowerCase().replace(/[^\u4e00-\u9fa5a-z0-9\s]/gi," ").split(/\s+/).filter(i=>i.length>0),r=[];return n.forEach(i=>{/[\u4e00-\u9fa5]/.test(i)?r.push(...i.split("")):r.push(i)}),r}function JYe(t,e){if(!t||!e)return 0;if(t===e)return 1;const n=new Set(MH(t)),r=new Set(MH(e));if(n.size===0||r.size===0)return 0;const i=new Set([...n].filter(s=>r.has(s))),a=new Set([...n,...r]);return i.size/a.size}function QYe(t,e){const n=t.length,r=e.length,i=Array(n+1).fill(null).map(()=>Array(r+1).fill(0));for(let a=0;a<=n;a++)i[a][0]=a;for(let a=0;a<=r;a++)i[0][a]=a;for(let a=1;a<=n;a++)for(let s=1;s<=r;s++)t[a-1]===e[s-1]?i[a][s]=i[a-1][s-1]:i[a][s]=Math.min(i[a-1][s]+1,i[a][s-1]+1,i[a-1][s-1]+1);return i[n][r]}function eXe(t,e){if(!t||!e)return 0;if(t===e)return 1;const n=QYe(t,e),r=Math.max(t.length,e.length);return 1-n/r}function tXe(t,e){const n=JYe(t,e),r=eXe(t,e);return n*.7+r*.3}function nXe(t,e,n=.5){const r=[];return Object.values(e).forEach(i=>{const a=tXe(t,i.text);a>=n&&a<1&&r.push({node:i,similarity:a})}),r.sort((i,a)=>a.similarity-i.similarity)}function rXe(t){return`${Math.round(t*100)}%`}const iXe=({allMemories:t,onSelect:e,onClose:n})=>{const[r,i]=P.useState(""),a=P.useMemo(()=>t.filter(l=>l.type==="memory"||l.type==="card"||!l.type),[t]),s=P.useMemo(()=>{if(!r.trim())return a;const l=r.toLowerCase();return a.filter(u=>{const c=(u.text||"").toLowerCase(),d=(u.title||"").toLowerCase(),h=(u.content||"").toLowerCase();return c.includes(l)||d.includes(l)||h.includes(l)})},[a,r]),o=l=>{e(l),n()};return g.jsx(zn,{show:!0,children:g.jsxs("div",{className:"fixed inset-0 z-[250] overflow-hidden flex items-center justify-center p-4",children:[g.jsx(zn.Child,{enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm",onClick:n})}),g.jsx(zn.Child,{enter:"transform transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transform transition ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] bg-gradient-to-br from-[#0f111a] to-[#1a1c2a] backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl flex flex-col",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex items-center justify-between flex-shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-400/20 flex items-center justify-center",children:g.jsx("svg",{className:"w-6 h-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium text-gray-100",children:"选择证据"}),g.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"从记忆或卡片中选择证据支持此推论"})]})]}),g.jsx("button",{onClick:n,className:"w-8 h-8 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors flex items-center justify-center",title:"关闭 (ESC)",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"px-6 py-3 border-b border-white/5 flex-shrink-0",children:g.jsxs("div",{className:"relative",children:[g.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{type:"text",value:r,onChange:l=>i(l.target.value),placeholder:"搜索记忆或卡片...",className:"w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-blue-400/50 transition-colors",autoFocus:!0,onKeyDown:l=>{l.key==="Escape"&&n()}})]})}),g.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-2 custom-scrollbar",children:s.length===0?g.jsxs("div",{className:"py-12 text-center text-gray-500",children:[g.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("p",{className:"text-sm",children:r?"没有找到匹配的记忆":"还没有可用的记忆或卡片"})]}):s.map(l=>g.jsx("button",{onClick:()=>o(l.id),className:"w-full text-left p-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 hover:border-blue-400/30 transition-all",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("div",{className:"text-lg shrink-0",children:l.type==="card"?"💎":"💭"}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm text-gray-200 line-clamp-2 leading-relaxed",children:l.title||l.text}),l.type==="card"&&l.content&&g.jsxs("div",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:[l.content.slice(0,100),"..."]}),g.jsxs("div",{className:"text-[10px] text-gray-600 mt-1",children:[l.type==="card"?"知识卡片":"记忆"," · "," ",new Date(l.date).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})]})]})]})},l.id))})]})})]})})},AH=({node:t,position:e,onSave:n,onCancel:r,onStatusChange:i,allNodes:a={},allMemories:s=[],evidenceIds:o=[],onAddEvidence:l,onRemoveEvidence:u})=>{const[c,d]=P.useState(t?.text||""),[h,f]=P.useState(t?.reasoning||""),[m,x]=P.useState(!!t?.reasoning),[b,y]=P.useState(!1),w=P.useRef(null),_=P.useMemo(()=>{if(!c.trim()||c.trim().length<3)return[];const E=t?Object.fromEntries(Object.entries(a).filter(([C])=>C!==t.id)):a;return nXe(c,E,.6)},[c,a,t]);P.useEffect(()=>{w.current?.focus(),t&&w.current?.select()},[t]);const S=()=>{c.trim()&&n(c.trim(),h.trim()||void 0)},M=E=>{E.key==="Escape"?r():E.key==="Enter"&&(E.metaKey||E.ctrlKey)?(E.preventDefault(),S()):E.key==="Tab"&&(E.preventDefault(),m||x(!0))};return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 bg-black/70 z-40 flex items-center justify-center",onClick:r,children:g.jsx("div",{className:"w-full max-w-2xl mx-4",onClick:E=>E.stopPropagation(),children:g.jsxs("div",{className:"bg-[#0f111a] rounded-xl border border-white/20 shadow-2xl animate-fade-in",children:[g.jsxs("div",{className:"px-4 py-2 border-b border-white/10 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[g.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),g.jsx("span",{children:t?"编辑节点":"新建节点"})]}),g.jsxs("div",{className:"text-xs text-gray-600",children:[g.jsx("kbd",{className:"px-1.5 py-0.5 bg-white/5 rounded text-[10px]",children:"Esc"})," 关闭"]})]}),g.jsxs("div",{className:"p-4 space-y-3",children:[g.jsx("textarea",{ref:w,value:c,onChange:E=>d(E.target.value),onKeyDown:M,placeholder:"输入推导论点...",rows:2,className:"w-full bg-transparent border-none outline-none text-gray-100 placeholder-gray-600 text-sm resize-none",maxLength:500,autoFocus:!0}),_.length>0&&g.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-400/20 rounded-lg space-y-2",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("svg",{className:"w-4 h-4 text-yellow-400 shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),g.jsxs("div",{className:"flex-1",children:[g.jsxs("div",{className:"text-xs text-yellow-300 font-medium mb-1",children:["发现 ",_.length," 个相似节点"]}),g.jsx("div",{className:"text-[10px] text-yellow-400/80 mb-2",children:"可能存在重复推导，请检查是否需要合并"}),g.jsxs("div",{className:"space-y-1.5 max-h-24 overflow-y-auto",children:[_.slice(0,3).map(({node:E,similarity:C})=>g.jsx("div",{className:"text-[10px] text-gray-300 bg-gray-800/50 rounded p-1.5 border border-gray-700/30",children:g.jsxs("div",{className:"flex items-start justify-between gap-2 mb-0.5",children:[g.jsx("span",{className:"flex-1 line-clamp-1",children:E.text}),g.jsx("span",{className:"text-yellow-400 font-medium shrink-0",children:rXe(C)})]})},E.id)),_.length>3&&g.jsxs("div",{className:"text-[9px] text-gray-500 text-center",children:["还有 ",_.length-3," 个相似节点..."]})]})]})]})}),m&&g.jsx("textarea",{value:h,onChange:E=>f(E.target.value),onKeyDown:M,placeholder:"推导理由（可选）",rows:1,className:"w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-gray-300 placeholder-gray-600 outline-none resize-none",maxLength:300}),t&&l&&u&&g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-xs text-gray-500",children:"📎 证据支持"}),g.jsxs("button",{onClick:()=>y(!0),className:"px-2 py-1 rounded text-xs text-blue-400 hover:text-blue-300 hover:bg-blue-500/10 border border-blue-400/20 hover:border-blue-400/40 transition-colors flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),g.jsx("span",{children:"添加证据"})]})]}),o.length>0&&g.jsx("div",{className:"space-y-1.5",children:o.map(E=>{const C=s.find(R=>R.id===E);return C?g.jsxs("div",{className:"flex items-start gap-2 p-2 bg-white/5 border border-white/10 rounded text-xs group hover:border-blue-400/30 transition-colors",children:[g.jsx("span",{className:"shrink-0",children:C.type==="card"?"💎":"💭"}),g.jsx("span",{className:"flex-1 text-gray-300 line-clamp-2 leading-relaxed",children:C.title||C.text}),g.jsx("button",{onClick:()=>u(E),className:"shrink-0 w-5 h-5 rounded text-gray-600 hover:text-red-400 hover:bg-red-500/10 transition-colors opacity-0 group-hover:opacity-100 flex items-center justify-center",title:"移除证据",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},E):null})})]}),t&&g.jsx("div",{className:"flex items-center justify-between text-[10px] text-gray-700 pt-1 opacity-40",children:g.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="exploring"&&"○ 探索中",t.status==="valid"&&"✓ 有效",t.status==="invalid"&&"× 无效"]})})]}),g.jsxs("div",{className:"px-4 py-3 border-t border-white/10 flex justify-between items-center gap-3",children:[!m&&g.jsxs("button",{onClick:()=>x(!0),className:"px-3 py-1.5 rounded-lg text-xs text-gray-500 hover:text-gray-300 hover:bg-white/5 border border-white/10 transition-colors flex items-center gap-1",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),g.jsx("span",{children:"添加理由"})]}),g.jsxs("div",{className:"flex-1 text-[10px] text-gray-600 space-x-2",children:[g.jsxs("span",{children:[g.jsx("kbd",{className:"px-1 py-0.5 bg-white/5 rounded",children:"⌘Enter"})," 保存"]}),!m&&g.jsxs("span",{children:[g.jsx("kbd",{className:"px-1 py-0.5 bg-white/5 rounded",children:"Tab"})," 理由"]})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{onClick:r,className:"px-4 py-1.5 rounded-lg text-xs text-gray-400 hover:text-gray-200 hover:bg-white/5 border border-white/10 transition-colors",children:"取消"}),g.jsx("button",{onClick:S,disabled:!c.trim(),className:"px-4 py-1.5 rounded-lg text-xs bg-blue-500 hover:bg-blue-600 text-white font-medium transition-colors disabled:opacity-30 disabled:cursor-not-allowed disabled:bg-gray-700",children:t?"保存":"创建"})]})]})]})})}),b&&l&&g.jsx(iXe,{allMemories:s,onSelect:E=>{l(E),y(!1)},onClose:()=>y(!1)})]})};function aXe(t,e){const n=t.nodesSnapshot,r=e.nodesSnapshot,i=new Set(Object.keys(n)),a=new Set(Object.keys(r)),s=[],o=[],l=[],u=[];for(const c of a)if(!i.has(c))s.push(r[c]);else{const d=n[c],h=r[c];d.text!==h.text||d.status!==h.status||d.classificationType!==h.classificationType||JSON.stringify(d.metadataTags||[])!==JSON.stringify(h.metadataTags||[])?l.push({node1:d,node2:h}):u.push(h)}for(const c of i)a.has(c)||o.push(n[c]);return{added:s,deleted:o,modified:l,unchanged:u}}function sXe({snapshot1:t,snapshot2:e,onClose:n}){const r=P.useMemo(()=>aXe(t,e),[t,e]),i=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=(s,o=40)=>s.length>o?s.slice(0,o)+"...":s;return g.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:g.jsxs("div",{className:"w-full max-w-3xl max-h-[80vh] bg-gray-900 rounded-2xl border border-gray-700/50 shadow-2xl flex flex-col m-4",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-gray-800/50 flex items-center justify-between flex-shrink-0",children:[g.jsxs("div",{children:[g.jsxs("h3",{className:"text-lg font-semibold text-gray-100 flex items-center gap-2",children:[g.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"快照对比"]}),g.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"查看两个快照之间的差异"})]}),g.jsx("button",{onClick:n,className:"w-8 h-8 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors flex items-center justify-center",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"px-6 py-3 border-b border-gray-800/30 bg-gray-800/20 flex-shrink-0",children:g.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[g.jsxs("div",{children:[g.jsx("div",{className:"text-gray-500 mb-1",children:"左侧 (旧版)"}),g.jsx("div",{className:"text-gray-200 font-medium",children:t.name}),g.jsx("div",{className:"text-gray-500 mt-0.5",children:i(t.createdAt)})]}),g.jsxs("div",{children:[g.jsx("div",{className:"text-gray-500 mb-1",children:"右侧 (新版)"}),g.jsx("div",{className:"text-gray-200 font-medium",children:e.name}),g.jsx("div",{className:"text-gray-500 mt-0.5",children:i(e.createdAt)})]})]})}),g.jsx("div",{className:"px-6 py-3 border-b border-gray-800/30 bg-gray-800/10 flex-shrink-0",children:g.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),g.jsx("span",{className:"text-gray-400",children:"新增:"}),g.jsx("span",{className:"text-green-400 font-medium",children:r.added.length})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),g.jsx("span",{className:"text-gray-400",children:"删除:"}),g.jsx("span",{className:"text-red-400 font-medium",children:r.deleted.length})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),g.jsx("span",{className:"text-gray-400",children:"修改:"}),g.jsx("span",{className:"text-yellow-400 font-medium",children:r.modified.length})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500"}),g.jsx("span",{className:"text-gray-400",children:"未变:"}),g.jsx("span",{className:"text-gray-400 font-medium",children:r.unchanged.length})]})]})}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[r.added.length>0&&g.jsxs("div",{children:[g.jsxs("h4",{className:"text-sm font-medium text-green-400 mb-2 flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"新增节点 (",r.added.length,")"]}),g.jsx("div",{className:"space-y-2",children:r.added.map(s=>g.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-400/20 rounded-lg",children:[g.jsx("div",{className:"text-xs text-green-300",children:a(s.text)}),g.jsxs("div",{className:"text-[10px] text-green-400/60 mt-1",children:["深度: ",s.depth," | 状态: ",s.status]})]},s.id))})]}),r.deleted.length>0&&g.jsxs("div",{children:[g.jsxs("h4",{className:"text-sm font-medium text-red-400 mb-2 flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"删除节点 (",r.deleted.length,")"]}),g.jsx("div",{className:"space-y-2",children:r.deleted.map(s=>g.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-400/20 rounded-lg line-through opacity-75",children:[g.jsx("div",{className:"text-xs text-red-300",children:a(s.text)}),g.jsxs("div",{className:"text-[10px] text-red-400/60 mt-1",children:["深度: ",s.depth," | 状态: ",s.status]})]},s.id))})]}),r.modified.length>0&&g.jsxs("div",{children:[g.jsxs("h4",{className:"text-sm font-medium text-yellow-400 mb-2 flex items-center gap-2",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"修改节点 (",r.modified.length,")"]}),g.jsx("div",{className:"space-y-3",children:r.modified.map(({node1:s,node2:o})=>g.jsxs("div",{className:"p-3 bg-yellow-500/10 border border-yellow-400/20 rounded-lg",children:[g.jsxs("div",{className:"text-xs text-red-300 line-through opacity-75 mb-1",children:["旧: ",a(s.text)]}),g.jsxs("div",{className:"text-xs text-green-300",children:["新: ",a(o.text)]}),s.status!==o.status&&g.jsxs("div",{className:"text-[10px] text-yellow-400/60 mt-1",children:["状态变化: ",s.status," → ",o.status]})]},o.id))})]}),r.added.length===0&&r.deleted.length===0&&r.modified.length===0&&g.jsxs("div",{className:"py-12 text-center text-gray-500",children:[g.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("p",{className:"text-sm",children:"两个快照完全相同"}),g.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"没有检测到任何差异"})]})]}),g.jsx("div",{className:"px-6 py-4 border-t border-gray-800/50 bg-gray-800/20 flex-shrink-0",children:g.jsx("button",{onClick:n,className:"w-full px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg border border-blue-400/30 hover:border-blue-400/50 transition-all font-medium",children:"关闭对比"})})]})})}function oXe({snapshots:t,onCreateSnapshot:e,onRestoreSnapshot:n,onDeleteSnapshot:r}){const[i,a]=P.useState(!1),[s,o]=P.useState(!1),[l,u]=P.useState(""),[c,d]=P.useState(""),[h,f]=P.useState(!1),[m,x]=P.useState([]);P.useEffect(()=>{const R=k=>{k.shiftKey&&k.key==="S"&&(k.preventDefault(),a(I=>!I)),k.key==="Escape"&&i&&a(!1)};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[i]);const b=()=>{if(!l.trim()){alert("请输入快照名称");return}e(l,c||void 0),u(""),d(""),o(!1)},y=(R,k)=>{confirm(`确定要恢复到快照「${k}」吗？

当前状态将被覆盖（建议先创建快照备份）。`)&&(n(R),a(!1))},w=(R,k)=>{confirm(`确定要删除快照「${k}」吗？

此操作不可恢复。`)&&r(R)},_=R=>{const k=new Date(R),N=new Date().getTime()-k.getTime(),D=Math.floor(N/1e3/60),F=Math.floor(D/60),L=Math.floor(F/24);return D<1?"刚刚":D<60?`${D} 分钟前`:F<24?`${F} 小时前`:L<7?`${L} 天前`:k.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},S=()=>{},M=m[0]?t.find(R=>R.id===m[0]):null,E=m[1]?t.find(R=>R.id===m[1]):null,C=M&&E;return g.jsxs(g.Fragment,{children:[g.jsxs("button",{onClick:()=>a(!0),className:"fixed left-0 top-1/2 -translate-y-1/2 z-10 w-12 h-24 bg-gradient-to-r from-gray-800/90 to-gray-800/70 backdrop-blur-sm border-r border-t border-b border-gray-700/50 rounded-r-xl hover:from-blue-900/90 hover:to-blue-800/70 hover:border-blue-500/50 transition-all duration-200 flex flex-col items-center justify-center gap-1 group shadow-lg",title:"快照管理 (Shift+S)",children:[g.jsxs("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-blue-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),g.jsx("span",{className:"text-[10px] text-gray-400 group-hover:text-blue-300 transition-colors font-medium",children:"快照"}),t.length>0&&g.jsx("div",{className:"absolute top-2 right-2 w-4 h-4 bg-blue-500 rounded-full text-[9px] text-white flex items-center justify-center font-bold",children:t.length})]}),g.jsx(zn,{show:i,children:g.jsxs("div",{className:"fixed inset-0 z-[100] overflow-hidden",children:[g.jsx(zn.Child,{enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>a(!1)})}),g.jsx(zn.Child,{enter:"transform transition ease-out duration-200",enterFrom:"-translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in duration-150",leaveFrom:"translate-x-0",leaveTo:"-translate-x-full",children:g.jsxs("div",{className:"fixed left-0 top-0 h-full w-full max-w-[min(340px,80vw)] bg-gray-900/98 backdrop-blur-xl border-r border-gray-700/50 shadow-2xl flex flex-col",children:[g.jsxs("div",{className:"px-5 py-4 border-b border-gray-800/50 flex items-center justify-between flex-shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-9 h-9 rounded-lg bg-blue-500/10 border border-blue-400/20 flex items-center justify-center",children:g.jsxs("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-base font-semibold text-gray-100",children:"快照管理"}),g.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"保存和恢复推导状态"})]})]}),g.jsx("button",{onClick:()=>a(!1),className:"w-8 h-8 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors flex items-center justify-center",title:"关闭 (ESC)",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 arena-snapshot-sidebar-scroll",children:[!s&&g.jsxs("button",{onClick:()=>o(!0),className:"w-full px-4 py-3 bg-blue-500/10 hover:bg-blue-500/20 text-blue-300 rounded-xl border border-blue-400/20 hover:border-blue-400/40 transition-all flex items-center justify-center gap-2 mb-4 font-medium",children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),g.jsx("span",{children:"创建新快照"})]}),s&&g.jsxs("div",{className:"mb-4 p-4 bg-gray-800/50 rounded-xl border border-gray-700/50",children:[g.jsxs("div",{className:"mb-3",children:[g.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"快照名称*"}),g.jsx("input",{type:"text",value:l,onChange:R=>u(R.target.value),placeholder:"例如：初版、改进版、最终版",className:"w-full px-3 py-2 bg-gray-900/50 border border-gray-700/50 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:border-blue-400/50 text-sm",autoFocus:!0,onKeyDown:R=>{R.key==="Enter"&&b(),R.key==="Escape"&&(o(!1),u(""),d(""))}})]}),g.jsxs("div",{className:"mb-4",children:[g.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"描述（可选）"}),g.jsx("textarea",{value:c,onChange:R=>d(R.target.value),placeholder:"添加一些说明...",rows:2,className:"w-full px-3 py-2 bg-gray-900/50 border border-gray-700/50 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:border-blue-400/50 resize-none text-sm"})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{onClick:b,className:"flex-1 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg border border-blue-400/30 hover:border-blue-400/50 transition-all font-medium text-sm",children:"保存"}),g.jsx("button",{onClick:()=>{o(!1),u(""),d("")},className:"px-4 py-2 bg-gray-700/30 hover:bg-gray-700/50 text-gray-300 rounded-lg border border-gray-600/30 hover:border-gray-600/50 transition-all text-sm",children:"取消"})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsxs("h4",{className:"text-sm font-medium text-gray-400",children:["快照列表 (",t.length,")"]}),t.length>=2&&g.jsx("button",{onClick:()=>{f(!h),x([])},className:`px-2 py-1 text-xs rounded border transition-all ${h?"bg-blue-500/20 border-blue-400/40 text-blue-300":"bg-gray-700/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:h?"取消对比":"对比模式"})]}),h&&g.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-400/20 rounded-lg",children:[g.jsxs("div",{className:"text-xs text-blue-300",children:[m.length===0&&"请选择两个快照进行对比",m.length===1&&"请再选择一个快照",m.length===2&&'✓ 已选择两个快照，点击下方"查看对比"']}),m.length===2&&g.jsx("button",{onClick:S,className:"w-full mt-2 px-3 py-1.5 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 text-xs rounded border border-blue-400/30 hover:border-blue-400/50 transition-all font-medium",children:"查看对比"})]}),t.length===0&&g.jsxs("div",{className:"py-12 text-center text-gray-500",children:[g.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"})}),g.jsx("p",{className:"text-sm",children:"还没有快照"}),g.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"创建快照可以保存当前推导状态"})]}),t.map(R=>{const k=m.includes(R.id);return g.jsxs("div",{className:`p-3 rounded-xl border transition-all ${h?k?"bg-blue-500/20 border-blue-400/50 ring-1 ring-blue-400/30":"bg-gray-800/30 hover:bg-gray-800/50 border-gray-700/30 hover:border-gray-600/50 cursor-pointer":"bg-gray-800/30 hover:bg-gray-800/50 border-gray-700/30 hover:border-gray-600/50"}`,onClick:()=>{h&&(k?x(I=>I.filter(N=>N!==R.id)):m.length<2&&x(I=>[...I,R.id]))},children:[g.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("h5",{className:"text-sm font-medium text-gray-200 truncate flex items-center gap-2",children:[h&&k&&g.jsx("svg",{className:"w-4 h-4 text-blue-400 shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),R.name]}),g.jsx("p",{className:"text-xs text-gray-500 mt-1",children:_(R.createdAt)})]})}),R.description&&g.jsx("p",{className:"text-xs text-gray-400 mt-2 leading-relaxed line-clamp-2",children:R.description}),g.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700/30 flex items-center gap-4 text-xs text-gray-500",children:g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),Object.keys(R.nodesSnapshot).length," 节点"]})}),!h&&g.jsxs("div",{className:"mt-3 flex gap-2",children:[g.jsx("button",{onClick:I=>{I.stopPropagation(),y(R.id,R.name)},className:"flex-1 px-3 py-1.5 bg-green-500/10 hover:bg-green-500/20 text-green-300 text-xs rounded-lg border border-green-400/20 hover:border-green-400/40 transition-all font-medium",children:"恢复"}),g.jsx("button",{onClick:I=>{I.stopPropagation(),w(R.id,R.name)},className:"px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-300 text-xs rounded-lg border border-red-400/20 hover:border-red-400/40 transition-all",children:"删除"})]})]},R.id)})]})]}),g.jsx("div",{className:"px-5 py-3 border-t border-gray-800/50 bg-gray-800/20 flex-shrink-0",children:g.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["💡 提示：快捷键 ",g.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700/50 rounded text-gray-400",children:"Shift+S"})," 切换侧边栏"]})})]})})]})}),C&&M&&E&&g.jsx(sXe,{snapshot1:M,snapshot2:E,onClose:()=>{x([]),f(!1)}})]})}const kH={"#事实":"bg-blue-500/20 border-blue-400/40 text-blue-300","#直觉":"bg-purple-500/20 border-purple-400/40 text-purple-300","#谬误":"bg-red-500/20 border-red-400/40 text-red-300","#假设":"bg-orange-500/20 border-orange-400/40 text-orange-300","#推论":"bg-green-500/20 border-green-400/40 text-green-300","#术语":"bg-cyan-500/20 border-cyan-400/40 text-cyan-300","#反例":"bg-pink-500/20 border-pink-400/40 text-pink-300","#证据":"bg-emerald-500/20 border-emerald-400/40 text-emerald-300","#疑问":"bg-yellow-500/20 border-yellow-400/40 text-yellow-300"},IH={"#事实":"客观事实，可验证","#直觉":"直觉判断，待验证","#谬误":"已识别的逻辑错误","#假设":"核心假设，需要验证","#推论":"逻辑推导结果","#术语":"待澄清的概念","#反例":"反面案例","#证据":"支持性证据","#疑问":"待解决的问题"},lXe=["#事实","#直觉","#谬误","#假设","#推论","#术语","#反例","#证据","#疑问"];function uXe({selectedTags:t,onChange:e}){const[n,r]=P.useState(!1),i=s=>{t.includes(s)?e(t.filter(o=>o!==s)):e([...t,s])},a=s=>{e(t.filter(o=>o!==s))};return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.length===0&&g.jsx("span",{className:"text-xs text-gray-500",children:"未添加标签"}),t.map(s=>g.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs border ${kH[s]}`,children:[s,g.jsx("button",{onClick:()=>a(s),className:"hover:opacity-70 transition-opacity",title:"移除标签",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},s)),g.jsxs("button",{onClick:()=>r(!n),className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs border border-gray-600/50 text-gray-400 hover:text-gray-300 hover:border-gray-500/50 transition-colors",title:"添加标签",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"添加"]})]}),n&&g.jsxs("div",{className:"mt-2 p-3 bg-gray-800/50 rounded-lg border border-gray-700/50 space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("span",{className:"text-xs font-medium text-gray-400",children:"选择标签"}),g.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-300 transition-colors",title:"关闭",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx("div",{className:"grid grid-cols-2 gap-2",children:lXe.map(s=>{const o=t.includes(s);return g.jsxs("button",{onClick:()=>i(s),className:`text-left px-3 py-2 rounded-lg text-xs border transition-all ${o?kH[s]:"bg-gray-700/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50 hover:border-gray-600/50"}`,title:IH[s],children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"font-medium",children:s}),o&&g.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),g.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5",children:IH[s]})]},s)})})]})]})}function cXe(t,e){const n=e[t.arenaRootNodeId];let r=`# ${t.title||t.text}

`;return t.metadata?.templateName&&(r+=`> 推导框架：${t.metadata.templateName}

`),t.metadata?.triggerQuestion&&(r+=`## 💭 核心问题

${t.metadata.triggerQuestion}

`),r+=`## 🌳 推导过程

`,r+=aoe(n,e,0),t.metadata?.conclusion&&(r+=`
## ✅ 结论

${t.metadata.conclusion}
`),r}function aoe(t,e,n){const r="  ".repeat(n);let a=`${r}${n===0?"###":"-"} ${t.text}`;t.reasoning&&(a+=`
${r}  > 💭 ${t.reasoning}`);const s=t.children.map(o=>e[o]).filter(o=>o&&o.status!=="invalid");return s.length>0&&(a+=`
`,s.forEach(o=>{a+=aoe(o,e,n+1)})),a+`
`}const dXe=({arena:t,arenaNodes:e,onConfirm:n,onClose:r})=>{const[i,a]=P.useState(t.title||t.text),[s,o]=P.useState(""),l=P.useRef(null);P.useEffect(()=>{const d=cXe(t,e);o(d)},[t,e]),P.useEffect(()=>{l.current&&(l.current.style.height="auto",l.current.style.height=l.current.scrollHeight+"px")},[s]);const u=()=>{!i.trim()||!s.trim()||(n({title:i.trim(),content:s.trim()}),r())},c=d=>{d.key==="Escape"?r():d.key==="Enter"&&(d.metaKey||d.ctrlKey)&&(d.preventDefault(),u())};return g.jsx(zn,{show:!0,children:g.jsxs("div",{className:"fixed inset-0 z-[200] overflow-hidden flex items-center justify-center p-4",children:[g.jsx(zn.Child,{enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm",onClick:r})}),g.jsx(zn.Child,{enter:"transform transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transform transition ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs("div",{className:"relative w-full max-w-4xl max-h-[90vh] bg-gradient-to-br from-[#0f111a] to-[#1a1c2a] backdrop-blur-xl rounded-2xl border border-white/10 shadow-2xl flex flex-col",children:[g.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex items-center justify-between flex-shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/10 border border-purple-400/20 flex items-center justify-center",children:g.jsx("svg",{className:"w-6 h-6 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-medium text-gray-100",children:"提炼为知识卡片"}),g.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"将推导过程沉淀为可复用的知识"})]})]}),g.jsx("button",{onClick:r,className:"w-8 h-8 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors flex items-center justify-center",title:"关闭 (ESC)",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-5 space-y-4 custom-scrollbar",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"卡片标题*"}),g.jsx("input",{type:"text",value:i,onChange:d=>a(d.target.value),onKeyDown:c,placeholder:"例如：如何提高个人效率的三个方法",className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-gray-100 placeholder-gray-600 outline-none focus:border-blue-400/50 transition-colors",maxLength:100,autoFocus:!0})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("label",{className:"block text-sm text-gray-400",children:"Markdown内容*"}),g.jsx("span",{className:"text-xs text-gray-600",children:"支持Markdown格式"})]}),g.jsx("textarea",{ref:l,value:s,onChange:d=>o(d.target.value),onKeyDown:c,placeholder:"自动生成的Markdown内容，可以编辑...",className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-gray-100 placeholder-gray-600 outline-none focus:border-blue-400/50 transition-colors resize-none font-mono text-xs leading-relaxed min-h-[400px]"})]}),g.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-500/10 rounded-lg border border-blue-400/20",children:[g.jsx("svg",{className:"w-4 h-4 text-blue-400 mt-0.5 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsxs("div",{className:"text-xs text-blue-300",children:[g.jsx("p",{className:"font-medium mb-1",children:"💡 提示"}),g.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-300/80",children:[g.jsx("li",{children:"自动生成的内容包含有效的推导路径（排除无效节点）"}),g.jsx("li",{children:"卡片将自动关联到这个Arena，可在关联网络中查看"}),g.jsx("li",{children:"你可以自由编辑内容，调整格式和表述"})]})]})]})]}),g.jsxs("div",{className:"px-6 py-4 border-t border-white/10 flex justify-between items-center flex-shrink-0",children:[g.jsx("div",{className:"text-xs text-gray-600",children:"⌘Enter 确认 • Esc 取消"}),g.jsxs("div",{className:"flex gap-3",children:[g.jsx("button",{onClick:r,className:"px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 transition-colors text-sm",children:"取消"}),g.jsxs("button",{onClick:u,disabled:!i.trim()||!s.trim(),className:"px-4 py-2 rounded-xl bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 border border-purple-400/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 text-sm",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"确认提炼"]})]})]})]})})]})})},Eb={tree:{type:"tree",name:"树形图",icon:"🌳",description:"经典的层级结构，适合逻辑推导和问题分解",bestFor:["逻辑推导","问题分解","层级分析"],characteristics:{direction:"vertical",emphasis:"hierarchy"}},mindmap:{type:"mindmap",name:"思维导图",icon:"🧠",description:"径向发散，适合头脑风暴和自由联想",bestFor:["头脑风暴","创意发散","知识整理"],characteristics:{direction:"radial",emphasis:"association"}},fishbone:{type:"fishbone",name:"鱼骨图",icon:"🐟",description:"因果分析，适合问题诊断和根因分析",bestFor:["问题诊断","根因分析","因果推理"],characteristics:{direction:"horizontal",emphasis:"causality"}},flowchart:{type:"flowchart",name:"流程图",icon:"📊",description:"步骤清晰，适合流程设计和算法推导",bestFor:["流程设计","算法推导","步骤分解"],characteristics:{direction:"vertical",emphasis:"sequence"}},debate:{type:"debate",name:"辩证图",icon:"⚖️",description:"正反对比，适合批判性思考和决策分析",bestFor:["批判性思考","决策分析","优缺点对比"],characteristics:{direction:"horizontal",emphasis:"contrast"}},timeline:{type:"timeline",name:"时间轴",icon:"📅",description:"线性展开，适合事件梳理和历史分析",bestFor:["事件梳理","历史分析","进程追溯"],characteristics:{direction:"horizontal",emphasis:"sequence"}}},hXe={"critical-thinking":["debate","tree"],socratic:["tree","flowchart"],brainstorming:["mindmap","tree"],decision:["debate","tree"],"problem-solving":["fishbone","tree"],"logic-chain":["tree","flowchart"],"causal-analysis":["fishbone","tree"],"process-design":["flowchart","timeline"],"free-exploration":["mindmap","tree"]};function fXe(t){return t&&hXe[t]?.[0]||"tree"}function Gi(t){if(typeof t=="string"||typeof t=="number")return""+t;let e="";if(Array.isArray(t))for(let n=0,r;n<t.length;n++)(r=Gi(t[n]))!==""&&(e+=(e&&" ")+r);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}var pXe={value:()=>{}};function q3(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Qb(n)}function Qb(t){this._=t}function mXe(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Qb.prototype=q3.prototype={constructor:Qb,on:function(t,e){var n=this._,r=mXe(t+"",n),i,a=-1,s=r.length;if(arguments.length<2){for(;++a<s;)if((i=(t=r[a]).type)&&(i=gXe(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(i=(t=r[a]).type)n[i]=NH(n[i],t.name,e);else if(e==null)for(i in n)n[i]=NH(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Qb(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function gXe(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function NH(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=pXe,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var mN="http://www.w3.org/1999/xhtml";const RH={svg:"http://www.w3.org/2000/svg",xhtml:mN,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function G3(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),RH.hasOwnProperty(e)?{space:RH[e],local:t}:t}function vXe(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===mN&&e.documentElement.namespaceURI===mN?e.createElement(t):e.createElementNS(n,t)}}function yXe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function soe(t){var e=G3(t);return(e.local?yXe:vXe)(e)}function xXe(){}function I7(t){return t==null?xXe:function(){return this.querySelector(t)}}function bXe(t){typeof t!="function"&&(t=I7(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=t.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new no(r,this._parents)}function _Xe(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function wXe(){return[]}function ooe(t){return t==null?wXe:function(){return this.querySelectorAll(t)}}function SXe(t){return function(){return _Xe(t.apply(this,arguments))}}function EXe(t){typeof t=="function"?t=SXe(t):t=ooe(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),i.push(l));return new no(r,i)}function loe(t){return function(){return this.matches(t)}}function uoe(t){return function(e){return e.matches(t)}}var TXe=Array.prototype.find;function CXe(t){return function(){return TXe.call(this.children,t)}}function MXe(){return this.firstElementChild}function AXe(t){return this.select(t==null?MXe:CXe(typeof t=="function"?t:uoe(t)))}var kXe=Array.prototype.filter;function IXe(){return Array.from(this.children)}function NXe(t){return function(){return kXe.call(this.children,t)}}function RXe(t){return this.selectAll(t==null?IXe:NXe(typeof t=="function"?t:uoe(t)))}function PXe(t){typeof t!="function"&&(t=loe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new no(r,this._parents)}function coe(t){return new Array(t.length)}function DXe(){return new no(this._enter||this._groups.map(coe),this._parents)}function Gw(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Gw.prototype={constructor:Gw,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function OXe(t){return function(){return t}}function LXe(t,e,n,r,i,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):n[s]=new Gw(t,a[s]);for(;s<l;++s)(o=e[s])&&(i[s]=o)}function FXe(t,e,n,r,i,a,s){var o,l,u=new Map,c=e.length,d=a.length,h=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(h[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?i[o]=l:u.set(f,l));for(o=0;o<d;++o)f=s.call(t,a[o],o,a)+"",(l=u.get(f))?(r[o]=l,l.__data__=a[o],u.delete(f)):n[o]=new Gw(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(h[o])===l&&(i[o]=l)}function BXe(t){return t.__data__}function UXe(t,e){if(!arguments.length)return Array.from(this,BXe);var n=e?FXe:LXe,r=this._parents,i=this._groups;typeof t!="function"&&(t=OXe(t));for(var a=i.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=i[u],h=d.length,f=zXe(t.call(c,c&&c.__data__,u,r)),m=f.length,x=o[u]=new Array(m),b=s[u]=new Array(m),y=l[u]=new Array(h);n(c,d,x,b,y,f,e);for(var w=0,_=0,S,M;w<m;++w)if(S=x[w]){for(w>=_&&(_=w+1);!(M=b[_])&&++_<m;);S._next=M||null}}return s=new no(s,r),s._enter=o,s._exit=l,s}function zXe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function jXe(){return new no(this._exit||this._groups.map(coe),this._parents)}function HXe(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function $Xe(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,s=Math.min(i,a),o=new Array(i),l=0;l<s;++l)for(var u=n[l],c=r[l],d=u.length,h=o[l]=new Array(d),f,m=0;m<d;++m)(f=u[m]||c[m])&&(h[m]=f);for(;l<i;++l)o[l]=n[l];return new no(o,this._parents)}function VXe(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],s;--i>=0;)(s=r[i])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function qXe(t){t||(t=GXe);function e(d,h){return d&&h?t(d.__data__,h.__data__):!d-!h}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var s=n[a],o=s.length,l=i[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new no(i,this._parents).order()}function GXe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function WXe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function YXe(){return Array.from(this)}function XXe(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var s=r[i];if(s)return s}return null}function KXe(){let t=0;for(const e of this)++t;return t}function ZXe(){return!this.node()}function JXe(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,s=i.length,o;a<s;++a)(o=i[a])&&t.call(o,o.__data__,a,i);return this}function QXe(t){return function(){this.removeAttribute(t)}}function eKe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function tKe(t,e){return function(){this.setAttribute(t,e)}}function nKe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function rKe(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function iKe(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function aKe(t,e){var n=G3(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?eKe:QXe:typeof e=="function"?n.local?iKe:rKe:n.local?nKe:tKe)(n,e))}function doe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function sKe(t){return function(){this.style.removeProperty(t)}}function oKe(t,e,n){return function(){this.style.setProperty(t,e,n)}}function lKe(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function uKe(t,e,n){return arguments.length>1?this.each((e==null?sKe:typeof e=="function"?lKe:oKe)(t,e,n??"")):k0(this.node(),t)}function k0(t,e){return t.style.getPropertyValue(e)||doe(t).getComputedStyle(t,null).getPropertyValue(e)}function cKe(t){return function(){delete this[t]}}function dKe(t,e){return function(){this[t]=e}}function hKe(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function fKe(t,e){return arguments.length>1?this.each((e==null?cKe:typeof e=="function"?hKe:dKe)(t,e)):this.node()[t]}function hoe(t){return t.trim().split(/^|\s+/)}function N7(t){return t.classList||new foe(t)}function foe(t){this._node=t,this._names=hoe(t.getAttribute("class")||"")}foe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function poe(t,e){for(var n=N7(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function moe(t,e){for(var n=N7(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function pKe(t){return function(){poe(this,t)}}function mKe(t){return function(){moe(this,t)}}function gKe(t,e){return function(){(e.apply(this,arguments)?poe:moe)(this,t)}}function vKe(t,e){var n=hoe(t+"");if(arguments.length<2){for(var r=N7(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?gKe:e?pKe:mKe)(n,e))}function yKe(){this.textContent=""}function xKe(t){return function(){this.textContent=t}}function bKe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function _Ke(t){return arguments.length?this.each(t==null?yKe:(typeof t=="function"?bKe:xKe)(t)):this.node().textContent}function wKe(){this.innerHTML=""}function SKe(t){return function(){this.innerHTML=t}}function EKe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function TKe(t){return arguments.length?this.each(t==null?wKe:(typeof t=="function"?EKe:SKe)(t)):this.node().innerHTML}function CKe(){this.nextSibling&&this.parentNode.appendChild(this)}function MKe(){return this.each(CKe)}function AKe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kKe(){return this.each(AKe)}function IKe(t){var e=typeof t=="function"?t:soe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function NKe(){return null}function RKe(t,e){var n=typeof t=="function"?t:soe(t),r=e==null?NKe:typeof e=="function"?e:I7(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function PKe(){var t=this.parentNode;t&&t.removeChild(this)}function DKe(){return this.each(PKe)}function OKe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function LKe(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function FKe(t){return this.select(t?LKe:OKe)}function BKe(t){return arguments.length?this.property("__data__",t):this.node().__data__}function UKe(t){return function(e){t.call(this,e,this.__data__)}}function zKe(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function jKe(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function HKe(t,e,n){return function(){var r=this.__on,i,a=UKe(e);if(r){for(var s=0,o=r.length;s<o;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function $Ke(t,e,n){var r=zKe(t+""),i,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(i=0,c=o[l];i<a;++i)if((s=r[i]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?HKe:jKe,i=0;i<a;++i)this.each(o(r[i],e,n));return this}function goe(t,e,n){var r=doe(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function VKe(t,e){return function(){return goe(this,t,e)}}function qKe(t,e){return function(){return goe(this,t,e.apply(this,arguments))}}function GKe(t,e){return this.each((typeof e=="function"?qKe:VKe)(t,e))}function*WKe(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,s;i<a;++i)(s=r[i])&&(yield s)}var voe=[null];function no(t,e){this._groups=t,this._parents=e}function Gv(){return new no([[document.documentElement]],voe)}function YKe(){return this}no.prototype=Gv.prototype={constructor:no,select:bXe,selectAll:EXe,selectChild:AXe,selectChildren:RXe,filter:PXe,data:UXe,enter:DXe,exit:jXe,join:HXe,merge:$Xe,selection:YKe,order:VXe,sort:qXe,call:WXe,nodes:YXe,node:XXe,size:KXe,empty:ZXe,each:JXe,attr:aKe,style:uKe,property:fKe,classed:vKe,text:_Ke,html:TKe,raise:MKe,lower:kKe,append:IKe,insert:RKe,remove:DKe,clone:FKe,datum:BKe,on:$Ke,dispatch:GKe,[Symbol.iterator]:WKe};function Vs(t){return typeof t=="string"?new no([[document.querySelector(t)]],[document.documentElement]):new no([[t]],voe)}function XKe(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Go(t,e){if(t=XKe(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const KKe={passive:!1},nv={capture:!0,passive:!1};function t5(t){t.stopImmediatePropagation()}function a0(t){t.preventDefault(),t.stopImmediatePropagation()}function yoe(t){var e=t.document.documentElement,n=Vs(t).on("dragstart.drag",a0,nv);"onselectstart"in e?n.on("selectstart.drag",a0,nv):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function xoe(t,e){var n=t.document.documentElement,r=Vs(t).on("dragstart.drag",null);e&&(r.on("click.drag",a0,nv),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Tb=t=>()=>t;function gN(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:a,x:s,y:o,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}gN.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function ZKe(t){return!t.ctrlKey&&!t.button}function JKe(){return this.parentNode}function QKe(t,e){return e??{x:t.x,y:t.y}}function eZe(){return navigator.maxTouchPoints||"ontouchstart"in this}function boe(){var t=ZKe,e=JKe,n=QKe,r=eZe,i={},a=q3("start","drag","end"),s=0,o,l,u,c,d=0;function h(S){S.on("mousedown.drag",f).filter(r).on("touchstart.drag",b).on("touchmove.drag",y,KKe).on("touchend.drag touchcancel.drag",w).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(S,M){if(!(c||!t.call(this,S,M))){var E=_(this,e.call(this,S,M),S,M,"mouse");E&&(Vs(S.view).on("mousemove.drag",m,nv).on("mouseup.drag",x,nv),yoe(S.view),t5(S),u=!1,o=S.clientX,l=S.clientY,E("start",S))}}function m(S){if(a0(S),!u){var M=S.clientX-o,E=S.clientY-l;u=M*M+E*E>d}i.mouse("drag",S)}function x(S){Vs(S.view).on("mousemove.drag mouseup.drag",null),xoe(S.view,u),a0(S),i.mouse("end",S)}function b(S,M){if(t.call(this,S,M)){var E=S.changedTouches,C=e.call(this,S,M),R=E.length,k,I;for(k=0;k<R;++k)(I=_(this,C,S,M,E[k].identifier,E[k]))&&(t5(S),I("start",S,E[k]))}}function y(S){var M=S.changedTouches,E=M.length,C,R;for(C=0;C<E;++C)(R=i[M[C].identifier])&&(a0(S),R("drag",S,M[C]))}function w(S){var M=S.changedTouches,E=M.length,C,R;for(c&&clearTimeout(c),c=setTimeout(function(){c=null},500),C=0;C<E;++C)(R=i[M[C].identifier])&&(t5(S),R("end",S,M[C]))}function _(S,M,E,C,R,k){var I=a.copy(),N=Go(k||E,M),D,F,L;if((L=n.call(S,new gN("beforestart",{sourceEvent:E,target:h,identifier:R,active:s,x:N[0],y:N[1],dx:0,dy:0,dispatch:I}),C))!=null)return D=L.x-N[0]||0,F=L.y-N[1]||0,function U(j,q,Z){var Q=N,z;switch(j){case"start":i[R]=U,z=s++;break;case"end":delete i[R],--s;case"drag":N=Go(Z||q,M),z=s;break}I.call(j,S,new gN(j,{sourceEvent:q,subject:L,target:h,identifier:R,active:z,x:N[0]+D,y:N[1]+F,dx:N[0]-Q[0],dy:N[1]-Q[1],dispatch:I}),C)}}return h.filter=function(S){return arguments.length?(t=typeof S=="function"?S:Tb(!!S),h):t},h.container=function(S){return arguments.length?(e=typeof S=="function"?S:Tb(S),h):e},h.subject=function(S){return arguments.length?(n=typeof S=="function"?S:Tb(S),h):n},h.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Tb(!!S),h):r},h.on=function(){var S=a.on.apply(a,arguments);return S===a?h:S},h.clickDistance=function(S){return arguments.length?(d=(S=+S)*S,h):Math.sqrt(d)},h}function R7(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function _oe(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Wv(){}var rv=.7,Ww=1/rv,s0="\\s*([+-]?\\d+)\\s*",iv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",jl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",tZe=/^#([0-9a-f]{3,8})$/,nZe=new RegExp(`^rgb\\(${s0},${s0},${s0}\\)$`),rZe=new RegExp(`^rgb\\(${jl},${jl},${jl}\\)$`),iZe=new RegExp(`^rgba\\(${s0},${s0},${s0},${iv}\\)$`),aZe=new RegExp(`^rgba\\(${jl},${jl},${jl},${iv}\\)$`),sZe=new RegExp(`^hsl\\(${iv},${jl},${jl}\\)$`),oZe=new RegExp(`^hsla\\(${iv},${jl},${jl},${iv}\\)$`),PH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};R7(Wv,uf,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:DH,formatHex:DH,formatHex8:lZe,formatHsl:uZe,formatRgb:OH,toString:OH});function DH(){return this.rgb().formatHex()}function lZe(){return this.rgb().formatHex8()}function uZe(){return woe(this).formatHsl()}function OH(){return this.rgb().formatRgb()}function uf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=tZe.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?LH(e):n===3?new _s(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Cb(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Cb(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=nZe.exec(t))?new _s(e[1],e[2],e[3],1):(e=rZe.exec(t))?new _s(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=iZe.exec(t))?Cb(e[1],e[2],e[3],e[4]):(e=aZe.exec(t))?Cb(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=sZe.exec(t))?UH(e[1],e[2]/100,e[3]/100,1):(e=oZe.exec(t))?UH(e[1],e[2]/100,e[3]/100,e[4]):PH.hasOwnProperty(t)?LH(PH[t]):t==="transparent"?new _s(NaN,NaN,NaN,0):null}function LH(t){return new _s(t>>16&255,t>>8&255,t&255,1)}function Cb(t,e,n,r){return r<=0&&(t=e=n=NaN),new _s(t,e,n,r)}function cZe(t){return t instanceof Wv||(t=uf(t)),t?(t=t.rgb(),new _s(t.r,t.g,t.b,t.opacity)):new _s}function vN(t,e,n,r){return arguments.length===1?cZe(t):new _s(t,e,n,r??1)}function _s(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}R7(_s,vN,_oe(Wv,{brighter(t){return t=t==null?Ww:Math.pow(Ww,t),new _s(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?rv:Math.pow(rv,t),new _s(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new _s(Vh(this.r),Vh(this.g),Vh(this.b),Yw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:FH,formatHex:FH,formatHex8:dZe,formatRgb:BH,toString:BH}));function FH(){return`#${Rh(this.r)}${Rh(this.g)}${Rh(this.b)}`}function dZe(){return`#${Rh(this.r)}${Rh(this.g)}${Rh(this.b)}${Rh((isNaN(this.opacity)?1:this.opacity)*255)}`}function BH(){const t=Yw(this.opacity);return`${t===1?"rgb(":"rgba("}${Vh(this.r)}, ${Vh(this.g)}, ${Vh(this.b)}${t===1?")":`, ${t})`}`}function Yw(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Vh(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Rh(t){return t=Vh(t),(t<16?"0":"")+t.toString(16)}function UH(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Yo(t,e,n,r)}function woe(t){if(t instanceof Yo)return new Yo(t.h,t.s,t.l,t.opacity);if(t instanceof Wv||(t=uf(t)),!t)return new Yo;if(t instanceof Yo)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),s=NaN,o=a-i,l=(a+i)/2;return o?(e===a?s=(n-r)/o+(n<r)*6:n===a?s=(r-e)/o+2:s=(e-n)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new Yo(s,o,l,t.opacity)}function hZe(t,e,n,r){return arguments.length===1?woe(t):new Yo(t,e,n,r??1)}function Yo(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}R7(Yo,hZe,_oe(Wv,{brighter(t){return t=t==null?Ww:Math.pow(Ww,t),new Yo(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?rv:Math.pow(rv,t),new Yo(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new _s(n5(t>=240?t-240:t+120,i,r),n5(t,i,r),n5(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Yo(zH(this.h),Mb(this.s),Mb(this.l),Yw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Yw(this.opacity);return`${t===1?"hsl(":"hsla("}${zH(this.h)}, ${Mb(this.s)*100}%, ${Mb(this.l)*100}%${t===1?")":`, ${t})`}`}}));function zH(t){return t=(t||0)%360,t<0?t+360:t}function Mb(t){return Math.max(0,Math.min(1,t||0))}function n5(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const P7=t=>()=>t;function fZe(t,e){return function(n){return t+n*e}}function pZe(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function mZe(t){return(t=+t)==1?Soe:function(e,n){return n-e?pZe(e,n,t):P7(isNaN(e)?n:e)}}function Soe(t,e){var n=e-t;return n?fZe(t,n):P7(isNaN(t)?e:t)}const Xw=(function t(e){var n=mZe(e);function r(i,a){var s=n((i=vN(i)).r,(a=vN(a)).r),o=n(i.g,a.g),l=n(i.b,a.b),u=Soe(i.opacity,a.opacity);return function(c){return i.r=s(c),i.g=o(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=t,r})(1);function gZe(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function vZe(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function yZe(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),s;for(s=0;s<r;++s)i[s]=i1(t[s],e[s]);for(;s<n;++s)a[s]=e[s];return function(o){for(s=0;s<r;++s)a[s]=i[s](o);return a}}function xZe(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Al(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function bZe(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=i1(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var yN=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,r5=new RegExp(yN.source,"g");function _Ze(t){return function(){return t}}function wZe(t){return function(e){return t(e)+""}}function Eoe(t,e){var n=yN.lastIndex=r5.lastIndex=0,r,i,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(r=yN.exec(t))&&(i=r5.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),o[s]?o[s]+=a:o[++s]=a),(r=r[0])===(i=i[0])?o[s]?o[s]+=i:o[++s]=i:(o[++s]=null,l.push({i:s,x:Al(r,i)})),n=r5.lastIndex;return n<e.length&&(a=e.slice(n),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?wZe(l[0].x):_Ze(e):(e=l.length,function(u){for(var c=0,d;c<e;++c)o[(d=l[c]).i]=d.x(u);return o.join("")})}function i1(t,e){var n=typeof e,r;return e==null||n==="boolean"?P7(e):(n==="number"?Al:n==="string"?(r=uf(e))?(e=r,Xw):Eoe:e instanceof uf?Xw:e instanceof Date?xZe:vZe(e)?gZe:Array.isArray(e)?yZe:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?bZe:Al)(t,e)}var jH=180/Math.PI,xN={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Toe(t,e,n,r,i,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,l/=o),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*jH,skewX:Math.atan(l)*jH,scaleX:s,scaleY:o}}var Ab;function SZe(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?xN:Toe(e.a,e.b,e.c,e.d,e.e,e.f)}function EZe(t){return t==null||(Ab||(Ab=document.createElementNS("http://www.w3.org/2000/svg","g")),Ab.setAttribute("transform",t),!(t=Ab.transform.baseVal.consolidate()))?xN:(t=t.matrix,Toe(t.a,t.b,t.c,t.d,t.e,t.f))}function Coe(t,e,n,r){function i(u){return u.length?u.pop()+" ":""}function a(u,c,d,h,f,m){if(u!==d||c!==h){var x=f.push("translate(",null,e,null,n);m.push({i:x-4,x:Al(u,d)},{i:x-2,x:Al(c,h)})}else(d||h)&&f.push("translate("+d+e+h+n)}function s(u,c,d,h){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:Al(u,c)})):c&&d.push(i(d)+"rotate("+c+r)}function o(u,c,d,h){u!==c?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:Al(u,c)}):c&&d.push(i(d)+"skewX("+c+r)}function l(u,c,d,h,f,m){if(u!==d||c!==h){var x=f.push(i(f)+"scale(",null,",",null,")");m.push({i:x-4,x:Al(u,d)},{i:x-2,x:Al(c,h)})}else(d!==1||h!==1)&&f.push(i(f)+"scale("+d+","+h+")")}return function(u,c){var d=[],h=[];return u=t(u),c=t(c),a(u.translateX,u.translateY,c.translateX,c.translateY,d,h),s(u.rotate,c.rotate,d,h),o(u.skewX,c.skewX,d,h),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,d,h),u=c=null,function(f){for(var m=-1,x=h.length,b;++m<x;)d[(b=h[m]).i]=b.x(f);return d.join("")}}}var TZe=Coe(SZe,"px, ","px)","deg)"),CZe=Coe(EZe,", ",")",")"),MZe=1e-12;function HH(t){return((t=Math.exp(t))+1/t)/2}function AZe(t){return((t=Math.exp(t))-1/t)/2}function kZe(t){return((t=Math.exp(2*t))-1)/(t+1)}const e_=(function t(e,n,r){function i(a,s){var o=a[0],l=a[1],u=a[2],c=s[0],d=s[1],h=s[2],f=c-o,m=d-l,x=f*f+m*m,b,y;if(x<MZe)y=Math.log(h/u)/e,b=function(C){return[o+C*f,l+C*m,u*Math.exp(e*C*y)]};else{var w=Math.sqrt(x),_=(h*h-u*u+r*x)/(2*u*n*w),S=(h*h-u*u-r*x)/(2*h*n*w),M=Math.log(Math.sqrt(_*_+1)-_),E=Math.log(Math.sqrt(S*S+1)-S);y=(E-M)/e,b=function(C){var R=C*y,k=HH(M),I=u/(n*w)*(k*kZe(e*R+M)-AZe(M));return[o+I*f,l+I*m,u*k/HH(e*R+M)]}}return b.duration=y*1e3*e/Math.SQRT2,b}return i.rho=function(a){var s=Math.max(.001,+a),o=s*s,l=o*o;return t(s,o,l)},i})(Math.SQRT2,2,4);var I0=0,Eg=0,lg=0,Moe=1e3,Kw,Tg,Zw=0,cf=0,W3=0,av=typeof performance=="object"&&performance.now?performance:Date,Aoe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function D7(){return cf||(Aoe(IZe),cf=av.now()+W3)}function IZe(){cf=0}function Jw(){this._call=this._time=this._next=null}Jw.prototype=koe.prototype={constructor:Jw,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?D7():+n)+(e==null?0:+e),!this._next&&Tg!==this&&(Tg?Tg._next=this:Kw=this,Tg=this),this._call=t,this._time=n,bN()},stop:function(){this._call&&(this._call=null,this._time=1/0,bN())}};function koe(t,e,n){var r=new Jw;return r.restart(t,e,n),r}function NZe(){D7(),++I0;for(var t=Kw,e;t;)(e=cf-t._time)>=0&&t._call.call(void 0,e),t=t._next;--I0}function $H(){cf=(Zw=av.now())+W3,I0=Eg=0;try{NZe()}finally{I0=0,PZe(),cf=0}}function RZe(){var t=av.now(),e=t-Zw;e>Moe&&(W3-=e,Zw=t)}function PZe(){for(var t,e=Kw,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Kw=n);Tg=t,bN(r)}function bN(t){if(!I0){Eg&&(Eg=clearTimeout(Eg));var e=t-cf;e>24?(t<1/0&&(Eg=setTimeout($H,t-av.now()-W3)),lg&&(lg=clearInterval(lg))):(lg||(Zw=av.now(),lg=setInterval(RZe,Moe)),I0=1,Aoe($H))}}function VH(t,e,n){var r=new Jw;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var DZe=q3("start","end","cancel","interrupt"),OZe=[],Ioe=0,qH=1,_N=2,t_=3,GH=4,wN=5,n_=6;function Y3(t,e,n,r,i,a){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;LZe(t,n,{name:e,index:r,group:i,on:DZe,tween:OZe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ioe})}function O7(t,e){var n=ul(t,e);if(n.state>Ioe)throw new Error("too late; already scheduled");return n}function tu(t,e){var n=ul(t,e);if(n.state>t_)throw new Error("too late; already running");return n}function ul(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function LZe(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=koe(a,0,n.time);function a(u){n.state=qH,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var c,d,h,f;if(n.state!==qH)return l();for(c in r)if(f=r[c],f.name===n.name){if(f.state===t_)return VH(s);f.state===GH?(f.state=n_,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[c]):+c<e&&(f.state=n_,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[c])}if(VH(function(){n.state===t_&&(n.state=GH,n.timer.restart(o,n.delay,n.time),o(u))}),n.state=_N,n.on.call("start",t,t.__data__,n.index,n.group),n.state===_N){for(n.state=t_,i=new Array(h=n.tween.length),c=0,d=-1;c<h;++c)(f=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=f);i.length=d+1}}function o(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=wN,1),d=-1,h=i.length;++d<h;)i[d].call(t,c);n.state===wN&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=n_,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function r_(t,e){var n=t.__transition,r,i,a=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){a=!1;continue}i=r.state>_N&&r.state<wN,r.state=n_,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}a&&delete t.__transition}}function FZe(t){return this.each(function(){r_(this,t)})}function BZe(t,e){var n,r;return function(){var i=tu(this,t),a=i.tween;if(a!==n){r=n=a;for(var s=0,o=r.length;s<o;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function UZe(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=tu(this,t),s=a.tween;if(s!==r){i=(r=s).slice();for(var o={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=o;break}l===u&&i.push(o)}a.tween=i}}function zZe(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=ul(this.node(),n).tween,i=0,a=r.length,s;i<a;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?BZe:UZe)(n,t,e))}function L7(t,e,n){var r=t._id;return t.each(function(){var i=tu(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return ul(i,r).value[e]}}function Noe(t,e){var n;return(typeof e=="number"?Al:e instanceof uf?Xw:(n=uf(e))?(e=n,Xw):Eoe)(t,e)}function jZe(t){return function(){this.removeAttribute(t)}}function HZe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function $Ze(t,e,n){var r,i=n+"",a;return function(){var s=this.getAttribute(t);return s===i?null:s===r?a:a=e(r=s,n)}}function VZe(t,e,n){var r,i=n+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?a:a=e(r=s,n)}}function qZe(t,e,n){var r,i,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o)))}}function GZe(t,e,n){var r,i,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o)))}}function WZe(t,e){var n=G3(t),r=n==="transform"?CZe:Noe;return this.attrTween(t,typeof e=="function"?(n.local?GZe:qZe)(n,r,L7(this,"attr."+t,e)):e==null?(n.local?HZe:jZe)(n):(n.local?VZe:$Ze)(n,r,e))}function YZe(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function XZe(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function KZe(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&XZe(t,a)),n}return i._value=e,i}function ZZe(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&YZe(t,a)),n}return i._value=e,i}function JZe(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=G3(t);return this.tween(n,(r.local?KZe:ZZe)(r,e))}function QZe(t,e){return function(){O7(this,t).delay=+e.apply(this,arguments)}}function eJe(t,e){return e=+e,function(){O7(this,t).delay=e}}function tJe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?QZe:eJe)(e,t)):ul(this.node(),e).delay}function nJe(t,e){return function(){tu(this,t).duration=+e.apply(this,arguments)}}function rJe(t,e){return e=+e,function(){tu(this,t).duration=e}}function iJe(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?nJe:rJe)(e,t)):ul(this.node(),e).duration}function aJe(t,e){if(typeof e!="function")throw new Error;return function(){tu(this,t).ease=e}}function sJe(t){var e=this._id;return arguments.length?this.each(aJe(e,t)):ul(this.node(),e).ease}function oJe(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;tu(this,t).ease=n}}function lJe(t){if(typeof t!="function")throw new Error;return this.each(oJe(this._id,t))}function uJe(t){typeof t!="function"&&(t=loe(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=[],l,u=0;u<s;++u)(l=a[u])&&t.call(l,l.__data__,u,a)&&o.push(l);return new qu(r,this._parents,this._name,this._id)}function cJe(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),s=new Array(r),o=0;o<a;++o)for(var l=e[o],u=n[o],c=l.length,d=s[o]=new Array(c),h,f=0;f<c;++f)(h=l[f]||u[f])&&(d[f]=h);for(;o<r;++o)s[o]=e[o];return new qu(s,this._parents,this._name,this._id)}function dJe(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function hJe(t,e,n){var r,i,a=dJe(e)?O7:tu;return function(){var s=a(this,t),o=s.on;o!==r&&(i=(r=o).copy()).on(e,n),s.on=i}}function fJe(t,e){var n=this._id;return arguments.length<2?ul(this.node(),n).on.on(t):this.each(hJe(n,t,e))}function pJe(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function mJe(){return this.on("end.remove",pJe(this._id))}function gJe(t){var e=this._name,n=this._id;typeof t!="function"&&(t=I7(t));for(var r=this._groups,i=r.length,a=new Array(i),s=0;s<i;++s)for(var o=r[s],l=o.length,u=a[s]=new Array(l),c,d,h=0;h<l;++h)(c=o[h])&&(d=t.call(c,c.__data__,h,o))&&("__data__"in c&&(d.__data__=c.__data__),u[h]=d,Y3(u[h],e,n,h,u,ul(c,n)));return new qu(a,this._parents,e,n)}function vJe(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ooe(t));for(var r=this._groups,i=r.length,a=[],s=[],o=0;o<i;++o)for(var l=r[o],u=l.length,c,d=0;d<u;++d)if(c=l[d]){for(var h=t.call(c,c.__data__,d,l),f,m=ul(c,n),x=0,b=h.length;x<b;++x)(f=h[x])&&Y3(f,e,n,x,h,m);a.push(h),s.push(c)}return new qu(a,s,e,n)}var yJe=Gv.prototype.constructor;function xJe(){return new yJe(this._groups,this._parents)}function bJe(t,e){var n,r,i;return function(){var a=k0(this,t),s=(this.style.removeProperty(t),k0(this,t));return a===s?null:a===n&&s===r?i:i=e(n=a,r=s)}}function Roe(t){return function(){this.style.removeProperty(t)}}function _Je(t,e,n){var r,i=n+"",a;return function(){var s=k0(this,t);return s===i?null:s===r?a:a=e(r=s,n)}}function wJe(t,e,n){var r,i,a;return function(){var s=k0(this,t),o=n(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),k0(this,t))),s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o))}}function SJe(t,e){var n,r,i,a="style."+e,s="end."+a,o;return function(){var l=tu(this,t),u=l.on,c=l.value[a]==null?o||(o=Roe(e)):void 0;(u!==n||i!==c)&&(r=(n=u).copy()).on(s,i=c),l.on=r}}function EJe(t,e,n){var r=(t+="")=="transform"?TZe:Noe;return e==null?this.styleTween(t,bJe(t,r)).on("end.style."+t,Roe(t)):typeof e=="function"?this.styleTween(t,wJe(t,r,L7(this,"style."+t,e))).each(SJe(this._id,t)):this.styleTween(t,_Je(t,r,e),n).on("end.style."+t,null)}function TJe(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function CJe(t,e,n){var r,i;function a(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&TJe(t,s,n)),r}return a._value=e,a}function MJe(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,CJe(t,e,n??""))}function AJe(t){return function(){this.textContent=t}}function kJe(t){return function(){var e=t(this);this.textContent=e??""}}function IJe(t){return this.tween("text",typeof t=="function"?kJe(L7(this,"text",t)):AJe(t==null?"":t+""))}function NJe(t){return function(e){this.textContent=t.call(this,e)}}function RJe(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&NJe(i)),e}return r._value=t,r}function PJe(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,RJe(t))}function DJe(){for(var t=this._name,e=this._id,n=Poe(),r=this._groups,i=r.length,a=0;a<i;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)if(l=s[u]){var c=ul(l,e);Y3(l,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new qu(r,this._parents,t,n)}function OJe(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--i===0&&a()}};n.each(function(){var u=tu(this,r),c=u.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),u.on=e}),i===0&&a()})}var LJe=0;function qu(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Poe(){return++LJe}var Eu=Gv.prototype;qu.prototype={constructor:qu,select:gJe,selectAll:vJe,selectChild:Eu.selectChild,selectChildren:Eu.selectChildren,filter:uJe,merge:cJe,selection:xJe,transition:DJe,call:Eu.call,nodes:Eu.nodes,node:Eu.node,size:Eu.size,empty:Eu.empty,each:Eu.each,on:fJe,attr:WZe,attrTween:JZe,style:EJe,styleTween:MJe,text:IJe,textTween:PJe,remove:mJe,tween:zZe,delay:tJe,duration:iJe,ease:sJe,easeVarying:lJe,end:OJe,[Symbol.iterator]:Eu[Symbol.iterator]};function FJe(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var BJe={time:null,delay:0,duration:250,ease:FJe};function UJe(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function zJe(t){var e,n;t instanceof qu?(e=t._id,t=t._name):(e=Poe(),(n=BJe).time=D7(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var s=r[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&Y3(l,t,e,u,s,n||UJe(l,e));return new qu(r,this._parents,t,e)}Gv.prototype.interrupt=FZe;Gv.prototype.transition=zJe;const kb=t=>()=>t;function jJe(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Pu(t,e,n){this.k=t,this.x=e,this.y=n}Pu.prototype={constructor:Pu,scale:function(t){return t===1?this:new Pu(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Pu(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var X3=new Pu(1,0,0);Doe.prototype=Pu.prototype;function Doe(t){for(;!t.__zoom;)if(!(t=t.parentNode))return X3;return t.__zoom}function i5(t){t.stopImmediatePropagation()}function ug(t){t.preventDefault(),t.stopImmediatePropagation()}function HJe(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function $Je(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function WH(){return this.__zoom||X3}function VJe(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function qJe(){return navigator.maxTouchPoints||"ontouchstart"in this}function GJe(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>a?(a+s)/2:Math.min(0,a)||Math.max(0,s))}function Ooe(){var t=HJe,e=$Je,n=GJe,r=VJe,i=qJe,a=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],o=250,l=e_,u=q3("start","zoom","end"),c,d,h,f=500,m=150,x=0,b=10;function y(L){L.property("__zoom",WH).on("wheel.zoom",R,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",I).filter(i).on("touchstart.zoom",N).on("touchmove.zoom",D).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(L,U,j,q){var Z=L.selection?L.selection():L;Z.property("__zoom",WH),L!==Z?M(L,U,j,q):Z.interrupt().each(function(){E(this,arguments).event(q).start().zoom(null,typeof U=="function"?U.apply(this,arguments):U).end()})},y.scaleBy=function(L,U,j,q){y.scaleTo(L,function(){var Z=this.__zoom.k,Q=typeof U=="function"?U.apply(this,arguments):U;return Z*Q},j,q)},y.scaleTo=function(L,U,j,q){y.transform(L,function(){var Z=e.apply(this,arguments),Q=this.__zoom,z=j==null?S(Z):typeof j=="function"?j.apply(this,arguments):j,W=Q.invert(z),X=typeof U=="function"?U.apply(this,arguments):U;return n(_(w(Q,X),z,W),Z,s)},j,q)},y.translateBy=function(L,U,j,q){y.transform(L,function(){return n(this.__zoom.translate(typeof U=="function"?U.apply(this,arguments):U,typeof j=="function"?j.apply(this,arguments):j),e.apply(this,arguments),s)},null,q)},y.translateTo=function(L,U,j,q,Z){y.transform(L,function(){var Q=e.apply(this,arguments),z=this.__zoom,W=q==null?S(Q):typeof q=="function"?q.apply(this,arguments):q;return n(X3.translate(W[0],W[1]).scale(z.k).translate(typeof U=="function"?-U.apply(this,arguments):-U,typeof j=="function"?-j.apply(this,arguments):-j),Q,s)},q,Z)};function w(L,U){return U=Math.max(a[0],Math.min(a[1],U)),U===L.k?L:new Pu(U,L.x,L.y)}function _(L,U,j){var q=U[0]-j[0]*L.k,Z=U[1]-j[1]*L.k;return q===L.x&&Z===L.y?L:new Pu(L.k,q,Z)}function S(L){return[(+L[0][0]+ +L[1][0])/2,(+L[0][1]+ +L[1][1])/2]}function M(L,U,j,q){L.on("start.zoom",function(){E(this,arguments).event(q).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(q).end()}).tween("zoom",function(){var Z=this,Q=arguments,z=E(Z,Q).event(q),W=e.apply(Z,Q),X=j==null?S(W):typeof j=="function"?j.apply(Z,Q):j,H=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),J=Z.__zoom,te=typeof U=="function"?U.apply(Z,Q):U,ee=l(J.invert(X).concat(H/J.k),te.invert(X).concat(H/te.k));return function(se){if(se===1)se=te;else{var ue=ee(se),oe=H/ue[2];se=new Pu(oe,X[0]-ue[0]*oe,X[1]-ue[1]*oe)}z.zoom(null,se)}})}function E(L,U,j){return!j&&L.__zooming||new C(L,U)}function C(L,U){this.that=L,this.args=U,this.active=0,this.sourceEvent=null,this.extent=e.apply(L,U),this.taps=0}C.prototype={event:function(L){return L&&(this.sourceEvent=L),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(L,U){return this.mouse&&L!=="mouse"&&(this.mouse[1]=U.invert(this.mouse[0])),this.touch0&&L!=="touch"&&(this.touch0[1]=U.invert(this.touch0[0])),this.touch1&&L!=="touch"&&(this.touch1[1]=U.invert(this.touch1[0])),this.that.__zoom=U,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(L){var U=Vs(this.that).datum();u.call(L,this.that,new jJe(L,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:u}),U)}};function R(L,...U){if(!t.apply(this,arguments))return;var j=E(this,U).event(L),q=this.__zoom,Z=Math.max(a[0],Math.min(a[1],q.k*Math.pow(2,r.apply(this,arguments)))),Q=Go(L);if(j.wheel)(j.mouse[0][0]!==Q[0]||j.mouse[0][1]!==Q[1])&&(j.mouse[1]=q.invert(j.mouse[0]=Q)),clearTimeout(j.wheel);else{if(q.k===Z)return;j.mouse=[Q,q.invert(Q)],r_(this),j.start()}ug(L),j.wheel=setTimeout(z,m),j.zoom("mouse",n(_(w(q,Z),j.mouse[0],j.mouse[1]),j.extent,s));function z(){j.wheel=null,j.end()}}function k(L,...U){if(h||!t.apply(this,arguments))return;var j=L.currentTarget,q=E(this,U,!0).event(L),Z=Vs(L.view).on("mousemove.zoom",X,!0).on("mouseup.zoom",H,!0),Q=Go(L,j),z=L.clientX,W=L.clientY;yoe(L.view),i5(L),q.mouse=[Q,this.__zoom.invert(Q)],r_(this),q.start();function X(J){if(ug(J),!q.moved){var te=J.clientX-z,ee=J.clientY-W;q.moved=te*te+ee*ee>x}q.event(J).zoom("mouse",n(_(q.that.__zoom,q.mouse[0]=Go(J,j),q.mouse[1]),q.extent,s))}function H(J){Z.on("mousemove.zoom mouseup.zoom",null),xoe(J.view,q.moved),ug(J),q.event(J).end()}}function I(L,...U){if(t.apply(this,arguments)){var j=this.__zoom,q=Go(L.changedTouches?L.changedTouches[0]:L,this),Z=j.invert(q),Q=j.k*(L.shiftKey?.5:2),z=n(_(w(j,Q),q,Z),e.apply(this,U),s);ug(L),o>0?Vs(this).transition().duration(o).call(M,z,q,L):Vs(this).call(y.transform,z,q,L)}}function N(L,...U){if(t.apply(this,arguments)){var j=L.touches,q=j.length,Z=E(this,U,L.changedTouches.length===q).event(L),Q,z,W,X;for(i5(L),z=0;z<q;++z)W=j[z],X=Go(W,this),X=[X,this.__zoom.invert(X),W.identifier],Z.touch0?!Z.touch1&&Z.touch0[2]!==X[2]&&(Z.touch1=X,Z.taps=0):(Z.touch0=X,Q=!0,Z.taps=1+!!c);c&&(c=clearTimeout(c)),Q&&(Z.taps<2&&(d=X[0],c=setTimeout(function(){c=null},f)),r_(this),Z.start())}}function D(L,...U){if(this.__zooming){var j=E(this,U).event(L),q=L.changedTouches,Z=q.length,Q,z,W,X;for(ug(L),Q=0;Q<Z;++Q)z=q[Q],W=Go(z,this),j.touch0&&j.touch0[2]===z.identifier?j.touch0[0]=W:j.touch1&&j.touch1[2]===z.identifier&&(j.touch1[0]=W);if(z=j.that.__zoom,j.touch1){var H=j.touch0[0],J=j.touch0[1],te=j.touch1[0],ee=j.touch1[1],se=(se=te[0]-H[0])*se+(se=te[1]-H[1])*se,ue=(ue=ee[0]-J[0])*ue+(ue=ee[1]-J[1])*ue;z=w(z,Math.sqrt(se/ue)),W=[(H[0]+te[0])/2,(H[1]+te[1])/2],X=[(J[0]+ee[0])/2,(J[1]+ee[1])/2]}else if(j.touch0)W=j.touch0[0],X=j.touch0[1];else return;j.zoom("touch",n(_(z,W,X),j.extent,s))}}function F(L,...U){if(this.__zooming){var j=E(this,U).event(L),q=L.changedTouches,Z=q.length,Q,z;for(i5(L),h&&clearTimeout(h),h=setTimeout(function(){h=null},f),Q=0;Q<Z;++Q)z=q[Q],j.touch0&&j.touch0[2]===z.identifier?delete j.touch0:j.touch1&&j.touch1[2]===z.identifier&&delete j.touch1;if(j.touch1&&!j.touch0&&(j.touch0=j.touch1,delete j.touch1),j.touch0)j.touch0[1]=this.__zoom.invert(j.touch0[0]);else if(j.end(),j.taps===2&&(z=Go(z,this),Math.hypot(d[0]-z[0],d[1]-z[1])<b)){var W=Vs(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return y.wheelDelta=function(L){return arguments.length?(r=typeof L=="function"?L:kb(+L),y):r},y.filter=function(L){return arguments.length?(t=typeof L=="function"?L:kb(!!L),y):t},y.touchable=function(L){return arguments.length?(i=typeof L=="function"?L:kb(!!L),y):i},y.extent=function(L){return arguments.length?(e=typeof L=="function"?L:kb([[+L[0][0],+L[0][1]],[+L[1][0],+L[1][1]]]),y):e},y.scaleExtent=function(L){return arguments.length?(a[0]=+L[0],a[1]=+L[1],y):[a[0],a[1]]},y.translateExtent=function(L){return arguments.length?(s[0][0]=+L[0][0],s[1][0]=+L[1][0],s[0][1]=+L[0][1],s[1][1]=+L[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(L){return arguments.length?(n=L,y):n},y.duration=function(L){return arguments.length?(o=+L,y):o},y.interpolate=function(L){return arguments.length?(l=L,y):l},y.on=function(){var L=u.on.apply(u,arguments);return L===u?y:L},y.clickDistance=function(L){return arguments.length?(x=(L=+L)*L,y):Math.sqrt(x)},y.tapDistance=function(L){return arguments.length?(b=+L,y):b},y}const Gl={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},sv=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Loe=["Enter"," ","Escape"],Foe={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var N0;(function(t){t.Strict="strict",t.Loose="loose"})(N0||(N0={}));var qh;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(qh||(qh={}));var ov;(function(t){t.Partial="partial",t.Full="full"})(ov||(ov={}));const Boe={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var $c;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})($c||($c={}));var Qw;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Qw||(Qw={}));var rn;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(rn||(rn={}));const YH={[rn.Left]:rn.Right,[rn.Right]:rn.Left,[rn.Top]:rn.Bottom,[rn.Bottom]:rn.Top};function Uoe(t){return t===null?null:t?"valid":"invalid"}const zoe=t=>"id"in t&&"source"in t&&"target"in t,WJe=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),F7=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),Yv=(t,e=[0,0])=>{const{width:n,height:r}=Ju(t),i=t.origin??e,a=n*i[0],s=r*i[1];return{x:t.position.x-a,y:t.position.y-s}},YJe=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,i)=>{const a=typeof i=="string";let s=!e.nodeLookup&&!a?i:void 0;e.nodeLookup&&(s=a?e.nodeLookup.get(i):F7(i)?i:e.nodeLookup.get(i.id));const o=s?e2(s,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return K3(r,o)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Z3(n)},Xv=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(i=>{(e.filter===void 0||e.filter(i))&&(n=K3(n,e2(i)),r=!0)}),r?Z3(n):{x:0,y:0,width:0,height:0}},B7=(t,e,[n,r,i]=[0,0,1],a=!1,s=!1)=>{const o={...Zv(e,[n,r,i]),width:e.width/i,height:e.height/i},l=[];for(const u of t.values()){const{measured:c,selectable:d=!0,hidden:h=!1}=u;if(s&&!d||h)continue;const f=c.width??u.width??u.initialWidth??null,m=c.height??u.height??u.initialHeight??null,x=lv(o,P0(u)),b=(f??0)*(m??0),y=a&&x>0;(!u.internals.handleBounds||y||x>=b||u.dragging)&&l.push(u)}return l},XJe=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function KJe(t,e){const n=new Map,r=e?.nodes?new Set(e.nodes.map(i=>i.id)):null;return t.forEach(i=>{i.measured.width&&i.measured.height&&(e?.includeHiddenNodes||!i.hidden)&&(!r||r.has(i.id))&&n.set(i.id,i)}),n}async function ZJe({nodes:t,width:e,height:n,panZoom:r,minZoom:i,maxZoom:a},s){if(t.size===0)return Promise.resolve(!0);const o=KJe(t,s),l=Xv(o),u=U7(l,e,n,s?.minZoom??i,s?.maxZoom??a,s?.padding??.1);return await r.setViewport(u,{duration:s?.duration,ease:s?.ease,interpolate:s?.interpolate}),Promise.resolve(!0)}function joe({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:i,onError:a}){const s=n.get(t),o=s.parentId?n.get(s.parentId):void 0,{x:l,y:u}=o?o.internals.positionAbsolute:{x:0,y:0},c=s.origin??r;let d=s.extent||i;if(s.extent==="parent"&&!s.expandParent)if(!o)a?.("005",Gl.error005());else{const f=o.measured.width,m=o.measured.height;f&&m&&(d=[[l,u],[l+f,u+m]])}else o&&D0(s.extent)&&(d=[[s.extent[0][0]+l,s.extent[0][1]+u],[s.extent[1][0]+l,s.extent[1][1]+u]]);const h=D0(d)?df(e,d,s.measured):e;return(s.measured.width===void 0||s.measured.height===void 0)&&a?.("015",Gl.error015()),{position:{x:h.x-l+(s.measured.width??0)*c[0],y:h.y-u+(s.measured.height??0)*c[1]},positionAbsolute:h}}async function JJe({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:i}){const a=new Set(t.map(h=>h.id)),s=[];for(const h of n){if(h.deletable===!1)continue;const f=a.has(h.id),m=!f&&h.parentId&&s.find(x=>x.id===h.parentId);(f||m)&&s.push(h)}const o=new Set(e.map(h=>h.id)),l=r.filter(h=>h.deletable!==!1),c=XJe(s,l);for(const h of l)o.has(h.id)&&!c.find(m=>m.id===h.id)&&c.push(h);if(!i)return{edges:c,nodes:s};const d=await i({nodes:s,edges:c});return typeof d=="boolean"?d?{edges:c,nodes:s}:{edges:[],nodes:[]}:d}const R0=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),df=(t={x:0,y:0},e,n)=>({x:R0(t.x,e[0][0],e[1][0]-(n?.width??0)),y:R0(t.y,e[0][1],e[1][1]-(n?.height??0))});function Hoe(t,e,n){const{width:r,height:i}=Ju(n),{x:a,y:s}=n.internals.positionAbsolute;return df(t,[[a,s],[a+r,s+i]],e)}const XH=(t,e,n)=>t<e?R0(Math.abs(t-e),1,e)/e:t>n?-R0(Math.abs(t-n),1,e)/e:0,$oe=(t,e,n=15,r=40)=>{const i=XH(t.x,r,e.width-r)*n,a=XH(t.y,r,e.height-r)*n;return[i,a]},K3=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),SN=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),Z3=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),P0=(t,e=[0,0])=>{const{x:n,y:r}=F7(t)?t.internals.positionAbsolute:Yv(t,e);return{x:n,y:r,width:t.measured?.width??t.width??t.initialWidth??0,height:t.measured?.height??t.height??t.initialHeight??0}},e2=(t,e=[0,0])=>{const{x:n,y:r}=F7(t)?t.internals.positionAbsolute:Yv(t,e);return{x:n,y:r,x2:n+(t.measured?.width??t.width??t.initialWidth??0),y2:r+(t.measured?.height??t.height??t.initialHeight??0)}},Voe=(t,e)=>Z3(K3(SN(t),SN(e))),lv=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},KH=t=>Qo(t.width)&&Qo(t.height)&&Qo(t.x)&&Qo(t.y),Qo=t=>!isNaN(t)&&isFinite(t),QJe=(t,e)=>{},Kv=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),Zv=({x:t,y:e},[n,r,i],a=!1,s=[1,1])=>{const o={x:(t-n)/i,y:(e-r)/i};return a?Kv(o,s):o},t2=({x:t,y:e},[n,r,i])=>({x:t*i+n,y:e*i+r});function Bp(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function eQe(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=Bp(t,n),i=Bp(t,e);return{top:r,right:i,bottom:r,left:i,x:i*2,y:r*2}}if(typeof t=="object"){const r=Bp(t.top??t.y??0,n),i=Bp(t.bottom??t.y??0,n),a=Bp(t.left??t.x??0,e),s=Bp(t.right??t.x??0,e);return{top:r,right:s,bottom:i,left:a,x:a+s,y:r+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function tQe(t,e,n,r,i,a){const{x:s,y:o}=t2(t,[e,n,r]),{x:l,y:u}=t2({x:t.x+t.width,y:t.y+t.height},[e,n,r]),c=i-l,d=a-u;return{left:Math.floor(s),top:Math.floor(o),right:Math.floor(c),bottom:Math.floor(d)}}const U7=(t,e,n,r,i,a)=>{const s=eQe(a,e,n),o=(e-s.x)/t.width,l=(n-s.y)/t.height,u=Math.min(o,l),c=R0(u,r,i),d=t.x+t.width/2,h=t.y+t.height/2,f=e/2-d*c,m=n/2-h*c,x=tQe(t,f,m,c,e,n),b={left:Math.min(x.left-s.left,0),top:Math.min(x.top-s.top,0),right:Math.min(x.right-s.right,0),bottom:Math.min(x.bottom-s.bottom,0)};return{x:f-b.left+b.right,y:m-b.top+b.bottom,zoom:c}},uv=()=>typeof navigator<"u"&&navigator?.userAgent?.indexOf("Mac")>=0;function D0(t){return t!=null&&t!=="parent"}function Ju(t){return{width:t.measured?.width??t.width??t.initialWidth??0,height:t.measured?.height??t.height??t.initialHeight??0}}function qoe(t){return(t.measured?.width??t.width??t.initialWidth)!==void 0&&(t.measured?.height??t.height??t.initialHeight)!==void 0}function Goe(t,e={width:0,height:0},n,r,i){const a={...t},s=r.get(n);if(s){const o=s.origin||i;a.x+=s.internals.positionAbsolute.x-(e.width??0)*o[0],a.y+=s.internals.positionAbsolute.y-(e.height??0)*o[1]}return a}function ZH(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}function nQe(){let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}}function rQe(t){return{...Foe,...t||{}}}function a1(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:i}){const{x:a,y:s}=el(t),o=Zv({x:a-(i?.left??0),y:s-(i?.top??0)},r),{x:l,y:u}=n?Kv(o,e):o;return{xSnapped:l,ySnapped:u,...o}}const z7=t=>({width:t.offsetWidth,height:t.offsetHeight}),Woe=t=>t?.getRootNode?.()||window?.document,iQe=["INPUT","SELECT","TEXTAREA"];function Yoe(t){const e=t.composedPath?.()?.[0]||t.target;return e?.nodeType!==1?!1:iQe.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const Xoe=t=>"clientX"in t,el=(t,e)=>{const n=Xoe(t),r=n?t.clientX:t.touches?.[0].clientX,i=n?t.clientY:t.touches?.[0].clientY;return{x:r-(e?.left??0),y:i-(e?.top??0)}},JH=(t,e,n,r,i)=>{const a=e.querySelectorAll(`.${t}`);return!a||!a.length?null:Array.from(a).map(s=>{const o=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:t,nodeId:i,position:s.getAttribute("data-handlepos"),x:(o.left-n.left)/r,y:(o.top-n.top)/r,...z7(s)}})};function Koe({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:i,sourceControlY:a,targetControlX:s,targetControlY:o}){const l=t*.125+i*.375+s*.375+n*.125,u=e*.125+a*.375+o*.375+r*.125,c=Math.abs(l-t),d=Math.abs(u-e);return[l,u,c,d]}function Ib(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function QH({pos:t,x1:e,y1:n,x2:r,y2:i,c:a}){switch(t){case rn.Left:return[e-Ib(e-r,a),n];case rn.Right:return[e+Ib(r-e,a),n];case rn.Top:return[e,n-Ib(n-i,a)];case rn.Bottom:return[e,n+Ib(i-n,a)]}}function Zoe({sourceX:t,sourceY:e,sourcePosition:n=rn.Bottom,targetX:r,targetY:i,targetPosition:a=rn.Top,curvature:s=.25}){const[o,l]=QH({pos:n,x1:t,y1:e,x2:r,y2:i,c:s}),[u,c]=QH({pos:a,x1:r,y1:i,x2:t,y2:e,c:s}),[d,h,f,m]=Koe({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:o,sourceControlY:l,targetControlX:u,targetControlY:c});return[`M${t},${e} C${o},${l} ${u},${c} ${r},${i}`,d,h,f,m]}function Joe({sourceX:t,sourceY:e,targetX:n,targetY:r}){const i=Math.abs(n-t)/2,a=n<t?n+i:n-i,s=Math.abs(r-e)/2,o=r<e?r+s:r-s;return[a,o,i,s]}function aQe({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:i=!1,zIndexMode:a="basic"}){if(a==="manual")return r;const s=i&&n?r+1e3:r,o=Math.max(t.parentId||i&&t.selected?t.internals.z:0,e.parentId||i&&e.selected?e.internals.z:0);return s+o}function sQe({sourceNode:t,targetNode:e,width:n,height:r,transform:i}){const a=K3(e2(t),e2(e));a.x===a.x2&&(a.x2+=1),a.y===a.y2&&(a.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:r/i[2]};return lv(s,Z3(a))>0}const oQe=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,lQe=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),uQe=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||oQe;let i;return zoe(t)?i={...t}:i={...t,id:r(t)},lQe(i,e)?e:(i.sourceHandle===null&&delete i.sourceHandle,i.targetHandle===null&&delete i.targetHandle,e.concat(i))};function Qoe({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[i,a,s,o]=Joe({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,i,a,s,o]}const e$={[rn.Left]:{x:-1,y:0},[rn.Right]:{x:1,y:0},[rn.Top]:{x:0,y:-1},[rn.Bottom]:{x:0,y:1}},cQe=({source:t,sourcePosition:e=rn.Bottom,target:n})=>e===rn.Left||e===rn.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},t$=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function dQe({source:t,sourcePosition:e=rn.Bottom,target:n,targetPosition:r=rn.Top,center:i,offset:a,stepPosition:s}){const o=e$[e],l=e$[r],u={x:t.x+o.x*a,y:t.y+o.y*a},c={x:n.x+l.x*a,y:n.y+l.y*a},d=cQe({source:u,sourcePosition:e,target:c}),h=d.x!==0?"x":"y",f=d[h];let m=[],x,b;const y={x:0,y:0},w={x:0,y:0},[,,_,S]=Joe({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(o[h]*l[h]===-1){h==="x"?(x=i.x??u.x+(c.x-u.x)*s,b=i.y??(u.y+c.y)/2):(x=i.x??(u.x+c.x)/2,b=i.y??u.y+(c.y-u.y)*s);const E=[{x,y:u.y},{x,y:c.y}],C=[{x:u.x,y:b},{x:c.x,y:b}];o[h]===f?m=h==="x"?E:C:m=h==="x"?C:E}else{const E=[{x:u.x,y:c.y}],C=[{x:c.x,y:u.y}];if(h==="x"?m=o.x===f?C:E:m=o.y===f?E:C,e===r){const D=Math.abs(t[h]-n[h]);if(D<=a){const F=Math.min(a-1,a-D);o[h]===f?y[h]=(u[h]>t[h]?-1:1)*F:w[h]=(c[h]>n[h]?-1:1)*F}}if(e!==r){const D=h==="x"?"y":"x",F=o[h]===l[D],L=u[D]>c[D],U=u[D]<c[D];(o[h]===1&&(!F&&L||F&&U)||o[h]!==1&&(!F&&U||F&&L))&&(m=h==="x"?E:C)}const R={x:u.x+y.x,y:u.y+y.y},k={x:c.x+w.x,y:c.y+w.y},I=Math.max(Math.abs(R.x-m[0].x),Math.abs(k.x-m[0].x)),N=Math.max(Math.abs(R.y-m[0].y),Math.abs(k.y-m[0].y));I>=N?(x=(R.x+k.x)/2,b=m[0].y):(x=m[0].x,b=(R.y+k.y)/2)}return[[t,{x:u.x+y.x,y:u.y+y.y},...m,{x:c.x+w.x,y:c.y+w.y},n],x,b,_,S]}function hQe(t,e,n,r){const i=Math.min(t$(t,e)/2,t$(e,n)/2,r),{x:a,y:s}=e;if(t.x===a&&a===n.x||t.y===s&&s===n.y)return`L${a} ${s}`;if(t.y===s){const u=t.x<n.x?-1:1,c=t.y<n.y?1:-1;return`L ${a+i*u},${s}Q ${a},${s} ${a},${s+i*c}`}const o=t.x<n.x?1:-1,l=t.y<n.y?-1:1;return`L ${a},${s+i*l}Q ${a},${s} ${a+i*o},${s}`}function EN({sourceX:t,sourceY:e,sourcePosition:n=rn.Bottom,targetX:r,targetY:i,targetPosition:a=rn.Top,borderRadius:s=5,centerX:o,centerY:l,offset:u=20,stepPosition:c=.5}){const[d,h,f,m,x]=dQe({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:i},targetPosition:a,center:{x:o,y:l},offset:u,stepPosition:c});return[d.reduce((y,w,_)=>{let S="";return _>0&&_<d.length-1?S=hQe(d[_-1],w,d[_+1],s):S=`${_===0?"M":"L"}${w.x} ${w.y}`,y+=S,y},""),h,f,m,x]}function n$(t){return t&&!!(t.internals.handleBounds||t.handles?.length)&&!!(t.measured.width||t.width||t.initialWidth)}function fQe(t){const{sourceNode:e,targetNode:n}=t;if(!n$(e)||!n$(n))return null;const r=e.internals.handleBounds||r$(e.handles),i=n.internals.handleBounds||r$(n.handles),a=i$(r?.source??[],t.sourceHandle),s=i$(t.connectionMode===N0.Strict?i?.target??[]:(i?.target??[]).concat(i?.source??[]),t.targetHandle);if(!a||!s)return t.onError?.("008",Gl.error008(a?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const o=a?.position||rn.Bottom,l=s?.position||rn.Top,u=hf(e,a,o),c=hf(n,s,l);return{sourceX:u.x,sourceY:u.y,targetX:c.x,targetY:c.y,sourcePosition:o,targetPosition:l}}function r$(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function hf(t,e,n=rn.Left,r=!1){const i=(e?.x??0)+t.internals.positionAbsolute.x,a=(e?.y??0)+t.internals.positionAbsolute.y,{width:s,height:o}=e??Ju(t);if(r)return{x:i+s/2,y:a+o/2};switch(e?.position??n){case rn.Top:return{x:i+s/2,y:a};case rn.Right:return{x:i+s,y:a+o/2};case rn.Bottom:return{x:i+s/2,y:a+o};case rn.Left:return{x:i,y:a+o/2}}}function i$(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function TN(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function pQe(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:i}){const a=new Set;return t.reduce((s,o)=>([o.markerStart||r,o.markerEnd||i].forEach(l=>{if(l&&typeof l=="object"){const u=TN(l,e);a.has(u)||(s.push({id:u,color:l.color||n,...l}),a.add(u))}}),s),[]).sort((s,o)=>s.id.localeCompare(o.id))}const ele=1e3,mQe=10,j7={nodeOrigin:[0,0],nodeExtent:sv,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},gQe={...j7,checkEquality:!0};function H7(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function vQe(t,e,n){const r=H7(j7,n);for(const i of t.values())if(i.parentId)V7(i,t,e,r);else{const a=Yv(i,r.nodeOrigin),s=D0(i.extent)?i.extent:r.nodeExtent,o=df(a,s,Ju(i));i.internals.positionAbsolute=o}}function yQe(t,e){if(!t.handles)return t.measured?e?.internals.handleBounds:void 0;const n=[],r=[];for(const i of t.handles){const a={id:i.id,width:i.width??1,height:i.height??1,nodeId:t.id,x:i.x,y:i.y,position:i.position,type:i.type};i.type==="source"?n.push(a):i.type==="target"&&r.push(a)}return{source:n,target:r}}function $7(t){return t==="manual"}function CN(t,e,n,r={}){const i=H7(gQe,r),a={i:0},s=new Map(e),o=i?.elevateNodesOnSelect&&!$7(i.zIndexMode)?ele:0;let l=t.length>0;e.clear(),n.clear();for(const u of t){let c=s.get(u.id);if(i.checkEquality&&u===c?.internals.userNode)e.set(u.id,c);else{const d=Yv(u,i.nodeOrigin),h=D0(u.extent)?u.extent:i.nodeExtent,f=df(d,h,Ju(u));c={...i.defaults,...u,measured:{width:u.measured?.width,height:u.measured?.height},internals:{positionAbsolute:f,handleBounds:yQe(u,c),z:tle(u,o,i.zIndexMode),userNode:u}},e.set(u.id,c)}(c.measured===void 0||c.measured.width===void 0||c.measured.height===void 0)&&!c.hidden&&(l=!1),u.parentId&&V7(c,e,n,r,a)}return l}function xQe(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function V7(t,e,n,r,i){const{elevateNodesOnSelect:a,nodeOrigin:s,nodeExtent:o,zIndexMode:l}=H7(j7,r),u=t.parentId,c=e.get(u);if(!c){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}xQe(t,n),i&&!c.parentId&&c.internals.rootParentIndex===void 0&&l==="auto"&&(c.internals.rootParentIndex=++i.i,c.internals.z=c.internals.z+i.i*mQe),i&&c.internals.rootParentIndex!==void 0&&(i.i=c.internals.rootParentIndex);const d=a&&!$7(l)?ele:0,{x:h,y:f,z:m}=bQe(t,c,s,o,d,l),{positionAbsolute:x}=t.internals,b=h!==x.x||f!==x.y;(b||m!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:b?{x:h,y:f}:x,z:m}})}function tle(t,e,n){const r=Qo(t.zIndex)?t.zIndex:0;return $7(n)?r:r+(t.selected?e:0)}function bQe(t,e,n,r,i,a){const{x:s,y:o}=e.internals.positionAbsolute,l=Ju(t),u=Yv(t,n),c=D0(t.extent)?df(u,t.extent,l):u;let d=df({x:s+c.x,y:o+c.y},r,l);t.extent==="parent"&&(d=Hoe(d,l,e));const h=tle(t,i,a),f=e.internals.z??0;return{x:d.x,y:d.y,z:f>=h?f+1:h}}function q7(t,e,n,r=[0,0]){const i=[],a=new Map;for(const s of t){const o=e.get(s.parentId);if(!o)continue;const l=a.get(s.parentId)?.expandedRect??P0(o),u=Voe(l,s.rect);a.set(s.parentId,{expandedRect:u,parent:o})}return a.size>0&&a.forEach(({expandedRect:s,parent:o},l)=>{const u=o.internals.positionAbsolute,c=Ju(o),d=o.origin??r,h=s.x<u.x?Math.round(Math.abs(u.x-s.x)):0,f=s.y<u.y?Math.round(Math.abs(u.y-s.y)):0,m=Math.max(c.width,Math.round(s.width)),x=Math.max(c.height,Math.round(s.height)),b=(m-c.width)*d[0],y=(x-c.height)*d[1];(h>0||f>0||b||y)&&(i.push({id:l,type:"position",position:{x:o.position.x-h+b,y:o.position.y-f+y}}),n.get(l)?.forEach(w=>{t.some(_=>_.id===w.id)||i.push({id:w.id,type:"position",position:{x:w.position.x+h,y:w.position.y+f}})})),(c.width<s.width||c.height<s.height||h||f)&&i.push({id:l,type:"dimensions",setAttributes:!0,dimensions:{width:m+(h?d[0]*h-b:0),height:x+(f?d[1]*f-y:0)}})}),i}function _Qe(t,e,n,r,i,a,s){const o=r?.querySelector(".xyflow__viewport");let l=!1;if(!o)return{changes:[],updatedInternals:l};const u=[],c=window.getComputedStyle(o),{m22:d}=new window.DOMMatrixReadOnly(c.transform),h=[];for(const f of t.values()){const m=e.get(f.id);if(!m)continue;if(m.hidden){e.set(m.id,{...m,internals:{...m.internals,handleBounds:void 0}}),l=!0;continue}const x=z7(f.nodeElement),b=m.measured.width!==x.width||m.measured.height!==x.height;if(!!(x.width&&x.height&&(b||!m.internals.handleBounds||f.force))){const w=f.nodeElement.getBoundingClientRect(),_=D0(m.extent)?m.extent:a;let{positionAbsolute:S}=m.internals;m.parentId&&m.extent==="parent"?S=Hoe(S,x,e.get(m.parentId)):_&&(S=df(S,_,x));const M={...m,measured:x,internals:{...m.internals,positionAbsolute:S,handleBounds:{source:JH("source",f.nodeElement,w,d,m.id),target:JH("target",f.nodeElement,w,d,m.id)}}};e.set(m.id,M),m.parentId&&V7(M,e,n,{nodeOrigin:i,zIndexMode:s}),l=!0,b&&(u.push({id:m.id,type:"dimensions",dimensions:x}),m.expandParent&&m.parentId&&h.push({id:m.id,parentId:m.parentId,rect:P0(M,i)}))}}if(h.length>0){const f=q7(h,e,n,i);u.push(...f)}return{changes:u,updatedInternals:l}}async function wQe({delta:t,panZoom:e,transform:n,translateExtent:r,width:i,height:a}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const s=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[i,a]],r),o=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(o)}function a$(t,e,n,r,i,a){let s=i;const o=r.get(s)||new Map;r.set(s,o.set(n,e)),s=`${i}-${t}`;const l=r.get(s)||new Map;if(r.set(s,l.set(n,e)),a){s=`${i}-${t}-${a}`;const u=r.get(s)||new Map;r.set(s,u.set(n,e))}}function nle(t,e,n){t.clear(),e.clear();for(const r of n){const{source:i,target:a,sourceHandle:s=null,targetHandle:o=null}=r,l={edgeId:r.id,source:i,target:a,sourceHandle:s,targetHandle:o},u=`${i}-${s}--${a}-${o}`,c=`${a}-${o}--${i}-${s}`;a$("source",l,c,t,i,s),a$("target",l,u,t,a,o),e.set(r.id,r)}}function rle(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:rle(n,e):!1}function s$(t,e,n){let r=t;do{if(r?.matches?.(e))return!0;if(r===n)return!1;r=r?.parentElement}while(r);return!1}function SQe(t,e,n,r){const i=new Map;for(const[a,s]of t)if((s.selected||s.id===r)&&(!s.parentId||!rle(s,t))&&(s.draggable||e&&typeof s.draggable>"u")){const o=t.get(a);o&&i.set(a,{id:a,position:o.position||{x:0,y:0},distance:{x:n.x-o.internals.positionAbsolute.x,y:n.y-o.internals.positionAbsolute.y},extent:o.extent,parentId:o.parentId,origin:o.origin,expandParent:o.expandParent,internals:{positionAbsolute:o.internals.positionAbsolute||{x:0,y:0}},measured:{width:o.measured.width??0,height:o.measured.height??0}})}return i}function a5({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){const i=[];for(const[s,o]of e){const l=n.get(s)?.internals.userNode;l&&i.push({...l,position:o.position,dragging:r})}if(!t)return[i[0],i];const a=n.get(t)?.internals.userNode;return[a?{...a,position:e.get(t)?.position||a.position,dragging:r}:i[0],i]}function EQe({dragItems:t,snapGrid:e,x:n,y:r}){const i=t.values().next().value;if(!i)return null;const a={x:n-i.distance.x,y:r-i.distance.y},s=Kv(a,e);return{x:s.x-a.x,y:s.y-a.y}}function TQe({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:i}){let a={x:null,y:null},s=0,o=new Map,l=!1,u={x:0,y:0},c=null,d=!1,h=null,f=!1,m=!1,x=null;function b({noDragClassName:w,handleSelector:_,domNode:S,isSelectable:M,nodeId:E,nodeClickDistance:C=0}){h=Vs(S);function R({x:D,y:F}){const{nodeLookup:L,nodeExtent:U,snapGrid:j,snapToGrid:q,nodeOrigin:Z,onNodeDrag:Q,onSelectionDrag:z,onError:W,updateNodePositions:X}=e();a={x:D,y:F};let H=!1;const J=o.size>1,te=J&&U?SN(Xv(o)):null,ee=J&&q?EQe({dragItems:o,snapGrid:j,x:D,y:F}):null;for(const[se,ue]of o){if(!L.has(se))continue;let oe={x:D-ue.distance.x,y:F-ue.distance.y};q&&(oe=ee?{x:Math.round(oe.x+ee.x),y:Math.round(oe.y+ee.y)}:Kv(oe,j));let Te=null;if(J&&U&&!ue.extent&&te){const{positionAbsolute:De}=ue.internals,ke=De.x-te.x+U[0][0],Me=De.x+ue.measured.width-te.x2+U[1][0],Ie=De.y-te.y+U[0][1],ce=De.y+ue.measured.height-te.y2+U[1][1];Te=[[ke,Ie],[Me,ce]]}const{position:Ne,positionAbsolute:be}=joe({nodeId:se,nextPosition:oe,nodeLookup:L,nodeExtent:Te||U,nodeOrigin:Z,onError:W});H=H||ue.position.x!==Ne.x||ue.position.y!==Ne.y,ue.position=Ne,ue.internals.positionAbsolute=be}if(m=m||H,!!H&&(X(o,!0),x&&(r||Q||!E&&z))){const[se,ue]=a5({nodeId:E,dragItems:o,nodeLookup:L});r?.(x,o,se,ue),Q?.(x,se,ue),E||z?.(x,ue)}}async function k(){if(!c)return;const{transform:D,panBy:F,autoPanSpeed:L,autoPanOnNodeDrag:U}=e();if(!U){l=!1,cancelAnimationFrame(s);return}const[j,q]=$oe(u,c,L);(j!==0||q!==0)&&(a.x=(a.x??0)-j/D[2],a.y=(a.y??0)-q/D[2],await F({x:j,y:q})&&R(a)),s=requestAnimationFrame(k)}function I(D){const{nodeLookup:F,multiSelectionActive:L,nodesDraggable:U,transform:j,snapGrid:q,snapToGrid:Z,selectNodesOnDrag:Q,onNodeDragStart:z,onSelectionDragStart:W,unselectNodesAndEdges:X}=e();d=!0,(!Q||!M)&&!L&&E&&(F.get(E)?.selected||X()),M&&Q&&E&&t?.(E);const H=a1(D.sourceEvent,{transform:j,snapGrid:q,snapToGrid:Z,containerBounds:c});if(a=H,o=SQe(F,U,H,E),o.size>0&&(n||z||!E&&W)){const[J,te]=a5({nodeId:E,dragItems:o,nodeLookup:F});n?.(D.sourceEvent,o,J,te),z?.(D.sourceEvent,J,te),E||W?.(D.sourceEvent,te)}}const N=boe().clickDistance(C).on("start",D=>{const{domNode:F,nodeDragThreshold:L,transform:U,snapGrid:j,snapToGrid:q}=e();c=F?.getBoundingClientRect()||null,f=!1,m=!1,x=D.sourceEvent,L===0&&I(D),a=a1(D.sourceEvent,{transform:U,snapGrid:j,snapToGrid:q,containerBounds:c}),u=el(D.sourceEvent,c)}).on("drag",D=>{const{autoPanOnNodeDrag:F,transform:L,snapGrid:U,snapToGrid:j,nodeDragThreshold:q,nodeLookup:Z}=e(),Q=a1(D.sourceEvent,{transform:L,snapGrid:U,snapToGrid:j,containerBounds:c});if(x=D.sourceEvent,(D.sourceEvent.type==="touchmove"&&D.sourceEvent.touches.length>1||E&&!Z.has(E))&&(f=!0),!f){if(!l&&F&&d&&(l=!0,k()),!d){const z=el(D.sourceEvent,c),W=z.x-u.x,X=z.y-u.y;Math.sqrt(W*W+X*X)>q&&I(D)}(a.x!==Q.xSnapped||a.y!==Q.ySnapped)&&o&&d&&(u=el(D.sourceEvent,c),R(Q))}}).on("end",D=>{if(!(!d||f)&&(l=!1,d=!1,cancelAnimationFrame(s),o.size>0)){const{nodeLookup:F,updateNodePositions:L,onNodeDragStop:U,onSelectionDragStop:j}=e();if(m&&(L(o,!1),m=!1),i||U||!E&&j){const[q,Z]=a5({nodeId:E,dragItems:o,nodeLookup:F,dragging:!1});i?.(D.sourceEvent,o,q,Z),U?.(D.sourceEvent,q,Z),E||j?.(D.sourceEvent,Z)}}}).filter(D=>{const F=D.target;return!D.button&&(!w||!s$(F,`.${w}`,S))&&(!_||s$(F,_,S))});h.call(N)}function y(){h?.on(".drag",null)}return{update:b,destroy:y}}function CQe(t,e,n){const r=[],i={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const a of e.values())lv(i,P0(a))>0&&r.push(a);return r}const MQe=250;function AQe(t,e,n,r){let i=[],a=1/0;const s=CQe(t,n,e+MQe);for(const o of s){const l=[...o.internals.handleBounds?.source??[],...o.internals.handleBounds?.target??[]];for(const u of l){if(r.nodeId===u.nodeId&&r.type===u.type&&r.id===u.id)continue;const{x:c,y:d}=hf(o,u,u.position,!0),h=Math.sqrt(Math.pow(c-t.x,2)+Math.pow(d-t.y,2));h>e||(h<a?(i=[{...u,x:c,y:d}],a=h):h===a&&i.push({...u,x:c,y:d}))}}if(!i.length)return null;if(i.length>1){const o=r.type==="source"?"target":"source";return i.find(l=>l.type===o)??i[0]}return i[0]}function ile(t,e,n,r,i,a=!1){const s=r.get(t);if(!s)return null;const o=i==="strict"?s.internals.handleBounds?.[e]:[...s.internals.handleBounds?.source??[],...s.internals.handleBounds?.target??[]],l=(n?o?.find(u=>u.id===n):o?.[0])??null;return l&&a?{...l,...hf(s,l,l.position,!0)}:l}function ale(t,e){return t||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function kQe(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const sle=()=>!0;function IQe(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:i,edgeUpdaterType:a,isTarget:s,domNode:o,nodeLookup:l,lib:u,autoPanOnConnect:c,flowId:d,panBy:h,cancelConnection:f,onConnectStart:m,onConnect:x,onConnectEnd:b,isValidConnection:y=sle,onReconnectEnd:w,updateConnection:_,getTransform:S,getFromHandle:M,autoPanSpeed:E,dragThreshold:C=1,handleDomNode:R}){const k=Woe(t.target);let I=0,N;const{x:D,y:F}=el(t),L=ale(a,R),U=o?.getBoundingClientRect();let j=!1;if(!U||!L)return;const q=ile(i,L,r,l,e);if(!q)return;let Z=el(t,U),Q=!1,z=null,W=!1,X=null;function H(){if(!c||!U)return;const[Ne,be]=$oe(Z,U,E);h({x:Ne,y:be}),I=requestAnimationFrame(H)}const J={...q,nodeId:i,type:L,position:q.position},te=l.get(i);let se={inProgress:!0,isValid:null,from:hf(te,J,rn.Left,!0),fromHandle:J,fromPosition:J.position,fromNode:te,to:Z,toHandle:null,toPosition:YH[J.position],toNode:null,pointer:Z};function ue(){j=!0,_(se),m?.(t,{nodeId:i,handleId:r,handleType:L})}C===0&&ue();function oe(Ne){if(!j){const{x:ce,y:G}=el(Ne),xe=ce-D,Oe=G-F;if(!(xe*xe+Oe*Oe>C*C))return;ue()}if(!M()||!J){Te(Ne);return}const be=S();Z=el(Ne,U),N=AQe(Zv(Z,be,!1,[1,1]),n,l,J),Q||(H(),Q=!0);const De=ole(Ne,{handle:N,connectionMode:e,fromNodeId:i,fromHandleId:r,fromType:s?"target":"source",isValidConnection:y,doc:k,lib:u,flowId:d,nodeLookup:l});X=De.handleDomNode,z=De.connection,W=kQe(!!N,De.isValid);const ke=l.get(i),Me=ke?hf(ke,J,rn.Left,!0):se.from,Ie={...se,from:Me,isValid:W,to:De.toHandle&&W?t2({x:De.toHandle.x,y:De.toHandle.y},be):Z,toHandle:De.toHandle,toPosition:W&&De.toHandle?De.toHandle.position:YH[J.position],toNode:De.toHandle?l.get(De.toHandle.nodeId):null,pointer:Z};_(Ie),se=Ie}function Te(Ne){if(!("touches"in Ne&&Ne.touches.length>0)){if(j){(N||X)&&z&&W&&x?.(z);const{inProgress:be,...De}=se,ke={...De,toPosition:se.toHandle?se.toPosition:null};b?.(Ne,ke),a&&w?.(Ne,ke)}f(),cancelAnimationFrame(I),Q=!1,W=!1,z=null,X=null,k.removeEventListener("mousemove",oe),k.removeEventListener("mouseup",Te),k.removeEventListener("touchmove",oe),k.removeEventListener("touchend",Te)}}k.addEventListener("mousemove",oe),k.addEventListener("mouseup",Te),k.addEventListener("touchmove",oe),k.addEventListener("touchend",Te)}function ole(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:i,fromType:a,doc:s,lib:o,flowId:l,isValidConnection:u=sle,nodeLookup:c}){const d=a==="target",h=e?s.querySelector(`.${o}-flow__handle[data-id="${l}-${e?.nodeId}-${e?.id}-${e?.type}"]`):null,{x:f,y:m}=el(t),x=s.elementFromPoint(f,m),b=x?.classList.contains(`${o}-flow__handle`)?x:h,y={handleDomNode:b,isValid:!1,connection:null,toHandle:null};if(b){const w=ale(void 0,b),_=b.getAttribute("data-nodeid"),S=b.getAttribute("data-handleid"),M=b.classList.contains("connectable"),E=b.classList.contains("connectableend");if(!_||!w)return y;const C={source:d?_:r,sourceHandle:d?S:i,target:d?r:_,targetHandle:d?i:S};y.connection=C;const k=M&&E&&(n===N0.Strict?d&&w==="source"||!d&&w==="target":_!==r||S!==i);y.isValid=k&&u(C),y.toHandle=ile(_,w,S,c,n,!0)}return y}const MN={onPointerDown:IQe,isValid:ole};function NQe({domNode:t,panZoom:e,getTransform:n,getViewScale:r}){const i=Vs(t);function a({translateExtent:o,width:l,height:u,zoomStep:c=1,pannable:d=!0,zoomable:h=!0,inversePan:f=!1}){const m=_=>{if(_.sourceEvent.type!=="wheel"||!e)return;const S=n(),M=_.sourceEvent.ctrlKey&&uv()?10:1,E=-_.sourceEvent.deltaY*(_.sourceEvent.deltaMode===1?.05:_.sourceEvent.deltaMode?1:.002)*c,C=S[2]*Math.pow(2,E*M);e.scaleTo(C)};let x=[0,0];const b=_=>{(_.sourceEvent.type==="mousedown"||_.sourceEvent.type==="touchstart")&&(x=[_.sourceEvent.clientX??_.sourceEvent.touches[0].clientX,_.sourceEvent.clientY??_.sourceEvent.touches[0].clientY])},y=_=>{const S=n();if(_.sourceEvent.type!=="mousemove"&&_.sourceEvent.type!=="touchmove"||!e)return;const M=[_.sourceEvent.clientX??_.sourceEvent.touches[0].clientX,_.sourceEvent.clientY??_.sourceEvent.touches[0].clientY],E=[M[0]-x[0],M[1]-x[1]];x=M;const C=r()*Math.max(S[2],Math.log(S[2]))*(f?-1:1),R={x:S[0]-E[0]*C,y:S[1]-E[1]*C},k=[[0,0],[l,u]];e.setViewportConstrained({x:R.x,y:R.y,zoom:S[2]},k,o)},w=Ooe().on("start",b).on("zoom",d?y:null).on("zoom.wheel",h?m:null);i.call(w,{})}function s(){i.on("zoom",null)}return{update:a,destroy:s,pointer:Go}}const J3=t=>({x:t.x,y:t.y,zoom:t.k}),s5=({x:t,y:e,zoom:n})=>X3.translate(t,e).scale(n),Xp=(t,e)=>t.target.closest(`.${e}`),lle=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),RQe=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,o5=(t,e=0,n=RQe,r=()=>{})=>{const i=typeof e=="number"&&e>0;return i||r(),i?t.transition().duration(e).ease(n).on("end",r):t},ule=t=>{const e=t.ctrlKey&&uv()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function PQe({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:i,panOnScrollSpeed:a,zoomOnPinch:s,onPanZoomStart:o,onPanZoom:l,onPanZoomEnd:u}){return c=>{if(Xp(c,e))return c.ctrlKey&&c.preventDefault(),!1;c.preventDefault(),c.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(c.ctrlKey&&s){const b=Go(c),y=ule(c),w=d*Math.pow(2,y);r.scaleTo(n,w,b,c);return}const h=c.deltaMode===1?20:1;let f=i===qh.Vertical?0:c.deltaX*h,m=i===qh.Horizontal?0:c.deltaY*h;!uv()&&c.shiftKey&&i!==qh.Vertical&&(f=c.deltaY*h,m=0),r.translateBy(n,-(f/d)*a,-(m/d)*a,{internal:!0});const x=J3(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(l?.(c,x),t.panScrollTimeout=setTimeout(()=>{u?.(c,x),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,o?.(c,x))}}function DQe({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,i){const a=r.type==="wheel",s=!e&&a&&!r.ctrlKey,o=Xp(r,t);if(r.ctrlKey&&a&&o&&r.preventDefault(),s||o)return null;r.preventDefault(),n.call(this,r,i)}}function OQe({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{if(r.sourceEvent?.internal)return;const i=J3(r.transform);t.mouseButton=r.sourceEvent?.button||0,t.isZoomingOrPanning=!0,t.prevViewport=i,r.sourceEvent?.type==="mousedown"&&e(!0),n&&n?.(r.sourceEvent,i)}}function LQe({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:i}){return a=>{t.usedRightMouseButton=!!(n&&lle(e,t.mouseButton??0)),a.sourceEvent?.sync||r([a.transform.x,a.transform.y,a.transform.k]),i&&!a.sourceEvent?.internal&&i?.(a.sourceEvent,J3(a.transform))}}function FQe({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:i,onPaneContextMenu:a}){return s=>{if(!s.sourceEvent?.internal&&(t.isZoomingOrPanning=!1,a&&lle(e,t.mouseButton??0)&&!t.usedRightMouseButton&&s.sourceEvent&&a(s.sourceEvent),t.usedRightMouseButton=!1,r(!1),i)){const o=J3(s.transform);t.prevViewport=o,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{i?.(s.sourceEvent,o)},n?150:0)}}}function BQe({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:i,zoomOnDoubleClick:a,userSelectionActive:s,noWheelClassName:o,noPanClassName:l,lib:u,connectionInProgress:c}){return d=>{const h=t||e,f=n&&d.ctrlKey,m=d.type==="wheel";if(d.button===1&&d.type==="mousedown"&&(Xp(d,`${u}-flow__node`)||Xp(d,`${u}-flow__edge`)))return!0;if(!r&&!h&&!i&&!a&&!n||s||c&&!m||Xp(d,o)&&m||Xp(d,l)&&(!m||i&&m&&!t)||!n&&d.ctrlKey&&m)return!1;if(!n&&d.type==="touchstart"&&d.touches?.length>1)return d.preventDefault(),!1;if(!h&&!i&&!f&&m||!r&&(d.type==="mousedown"||d.type==="touchstart")||Array.isArray(r)&&!r.includes(d.button)&&d.type==="mousedown")return!1;const x=Array.isArray(r)&&r.includes(d.button)||!d.button||d.button<=1;return(!d.ctrlKey||m)&&x}}function UQe({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:i,onPanZoom:a,onPanZoomStart:s,onPanZoomEnd:o,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},c=t.getBoundingClientRect(),d=Ooe().scaleExtent([e,n]).translateExtent(r),h=Vs(t).call(d);w({x:i.x,y:i.y,zoom:R0(i.zoom,e,n)},[[0,0],[c.width,c.height]],r);const f=h.on("wheel.zoom"),m=h.on("dblclick.zoom");d.wheelDelta(ule);function x(N,D){return h?new Promise(F=>{d?.interpolate(D?.interpolate==="linear"?i1:e_).transform(o5(h,D?.duration,D?.ease,()=>F(!0)),N)}):Promise.resolve(!1)}function b({noWheelClassName:N,noPanClassName:D,onPaneContextMenu:F,userSelectionActive:L,panOnScroll:U,panOnDrag:j,panOnScrollMode:q,panOnScrollSpeed:Z,preventScrolling:Q,zoomOnPinch:z,zoomOnScroll:W,zoomOnDoubleClick:X,zoomActivationKeyPressed:H,lib:J,onTransformChange:te,connectionInProgress:ee,paneClickDistance:se,selectionOnDrag:ue}){L&&!u.isZoomingOrPanning&&y();const oe=U&&!H&&!L;d.clickDistance(ue?1/0:!Qo(se)||se<0?0:se);const Te=oe?PQe({zoomPanValues:u,noWheelClassName:N,d3Selection:h,d3Zoom:d,panOnScrollMode:q,panOnScrollSpeed:Z,zoomOnPinch:z,onPanZoomStart:s,onPanZoom:a,onPanZoomEnd:o}):DQe({noWheelClassName:N,preventScrolling:Q,d3ZoomHandler:f});if(h.on("wheel.zoom",Te,{passive:!1}),!L){const be=OQe({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:s});d.on("start",be);const De=LQe({zoomPanValues:u,panOnDrag:j,onPaneContextMenu:!!F,onPanZoom:a,onTransformChange:te});d.on("zoom",De);const ke=FQe({zoomPanValues:u,panOnDrag:j,panOnScroll:U,onPaneContextMenu:F,onPanZoomEnd:o,onDraggingChange:l});d.on("end",ke)}const Ne=BQe({zoomActivationKeyPressed:H,panOnDrag:j,zoomOnScroll:W,panOnScroll:U,zoomOnDoubleClick:X,zoomOnPinch:z,userSelectionActive:L,noPanClassName:D,noWheelClassName:N,lib:J,connectionInProgress:ee});d.filter(Ne),X?h.on("dblclick.zoom",m):h.on("dblclick.zoom",null)}function y(){d.on("zoom",null)}async function w(N,D,F){const L=s5(N),U=d?.constrain()(L,D,F);return U&&await x(U),new Promise(j=>j(U))}async function _(N,D){const F=s5(N);return await x(F,D),new Promise(L=>L(F))}function S(N){if(h){const D=s5(N),F=h.property("__zoom");(F.k!==N.zoom||F.x!==N.x||F.y!==N.y)&&d?.transform(h,D,null,{sync:!0})}}function M(){const N=h?Doe(h.node()):{x:0,y:0,k:1};return{x:N.x,y:N.y,zoom:N.k}}function E(N,D){return h?new Promise(F=>{d?.interpolate(D?.interpolate==="linear"?i1:e_).scaleTo(o5(h,D?.duration,D?.ease,()=>F(!0)),N)}):Promise.resolve(!1)}function C(N,D){return h?new Promise(F=>{d?.interpolate(D?.interpolate==="linear"?i1:e_).scaleBy(o5(h,D?.duration,D?.ease,()=>F(!0)),N)}):Promise.resolve(!1)}function R(N){d?.scaleExtent(N)}function k(N){d?.translateExtent(N)}function I(N){const D=!Qo(N)||N<0?0:N;d?.clickDistance(D)}return{update:b,destroy:y,setViewport:_,setViewportConstrained:w,getViewport:M,scaleTo:E,scaleBy:C,setScaleExtent:R,setTranslateExtent:k,syncViewport:S,setClickDistance:I}}var O0;(function(t){t.Line="line",t.Handle="handle"})(O0||(O0={}));function zQe({width:t,prevWidth:e,height:n,prevHeight:r,affectsX:i,affectsY:a}){const s=t-e,o=n-r,l=[s>0?1:s<0?-1:0,o>0?1:o<0?-1:0];return s&&i&&(l[0]=l[0]*-1),o&&a&&(l[1]=l[1]*-1),l}function o$(t){const e=t.includes("right")||t.includes("left"),n=t.includes("bottom")||t.includes("top"),r=t.includes("left"),i=t.includes("top");return{isHorizontal:e,isVertical:n,affectsX:r,affectsY:i}}function Pc(t,e){return Math.max(0,e-t)}function Dc(t,e){return Math.max(0,t-e)}function Nb(t,e,n){return Math.max(0,e-t,t-n)}function l$(t,e){return t?!e:e}function jQe(t,e,n,r,i,a,s,o){let{affectsX:l,affectsY:u}=e;const{isHorizontal:c,isVertical:d}=e,h=c&&d,{xSnapped:f,ySnapped:m}=n,{minWidth:x,maxWidth:b,minHeight:y,maxHeight:w}=r,{x:_,y:S,width:M,height:E,aspectRatio:C}=t;let R=Math.floor(c?f-t.pointerX:0),k=Math.floor(d?m-t.pointerY:0);const I=M+(l?-R:R),N=E+(u?-k:k),D=-a[0]*M,F=-a[1]*E;let L=Nb(I,x,b),U=Nb(N,y,w);if(s){let Z=0,Q=0;l&&R<0?Z=Pc(_+R+D,s[0][0]):!l&&R>0&&(Z=Dc(_+I+D,s[1][0])),u&&k<0?Q=Pc(S+k+F,s[0][1]):!u&&k>0&&(Q=Dc(S+N+F,s[1][1])),L=Math.max(L,Z),U=Math.max(U,Q)}if(o){let Z=0,Q=0;l&&R>0?Z=Dc(_+R,o[0][0]):!l&&R<0&&(Z=Pc(_+I,o[1][0])),u&&k>0?Q=Dc(S+k,o[0][1]):!u&&k<0&&(Q=Pc(S+N,o[1][1])),L=Math.max(L,Z),U=Math.max(U,Q)}if(i){if(c){const Z=Nb(I/C,y,w)*C;if(L=Math.max(L,Z),s){let Q=0;!l&&!u||l&&!u&&h?Q=Dc(S+F+I/C,s[1][1])*C:Q=Pc(S+F+(l?R:-R)/C,s[0][1])*C,L=Math.max(L,Q)}if(o){let Q=0;!l&&!u||l&&!u&&h?Q=Pc(S+I/C,o[1][1])*C:Q=Dc(S+(l?R:-R)/C,o[0][1])*C,L=Math.max(L,Q)}}if(d){const Z=Nb(N*C,x,b)/C;if(U=Math.max(U,Z),s){let Q=0;!l&&!u||u&&!l&&h?Q=Dc(_+N*C+D,s[1][0])/C:Q=Pc(_+(u?k:-k)*C+D,s[0][0])/C,U=Math.max(U,Q)}if(o){let Q=0;!l&&!u||u&&!l&&h?Q=Pc(_+N*C,o[1][0])/C:Q=Dc(_+(u?k:-k)*C,o[0][0])/C,U=Math.max(U,Q)}}}k=k+(k<0?U:-U),R=R+(R<0?L:-L),i&&(h?I>N*C?k=(l$(l,u)?-R:R)/C:R=(l$(l,u)?-k:k)*C:c?(k=R/C,u=l):(R=k*C,l=u));const j=l?_+R:_,q=u?S+k:S;return{width:M+(l?-R:R),height:E+(u?-k:k),x:a[0]*R*(l?-1:1)+j,y:a[1]*k*(u?-1:1)+q}}const cle={width:0,height:0,x:0,y:0},HQe={...cle,pointerX:0,pointerY:0,aspectRatio:1};function $Qe(t){return[[0,0],[t.measured.width,t.measured.height]]}function VQe(t,e,n){const r=e.position.x+t.position.x,i=e.position.y+t.position.y,a=t.measured.width??0,s=t.measured.height??0,o=n[0]*a,l=n[1]*s;return[[r-o,i-l],[r+a-o,i+s-l]]}function qQe({domNode:t,nodeId:e,getStoreItems:n,onChange:r,onEnd:i}){const a=Vs(t);let s={controlDirection:o$("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function o({controlPosition:u,boundaries:c,keepAspectRatio:d,resizeDirection:h,onResizeStart:f,onResize:m,onResizeEnd:x,shouldResize:b}){let y={...cle},w={...HQe};s={boundaries:c,resizeDirection:h,keepAspectRatio:d,controlDirection:o$(u)};let _,S=null,M=[],E,C,R,k=!1;const I=boe().on("start",N=>{const{nodeLookup:D,transform:F,snapGrid:L,snapToGrid:U,nodeOrigin:j,paneDomNode:q}=n();if(_=D.get(e),!_)return;S=q?.getBoundingClientRect()??null;const{xSnapped:Z,ySnapped:Q}=a1(N.sourceEvent,{transform:F,snapGrid:L,snapToGrid:U,containerBounds:S});y={width:_.measured.width??0,height:_.measured.height??0,x:_.position.x??0,y:_.position.y??0},w={...y,pointerX:Z,pointerY:Q,aspectRatio:y.width/y.height},E=void 0,_.parentId&&(_.extent==="parent"||_.expandParent)&&(E=D.get(_.parentId),C=E&&_.extent==="parent"?$Qe(E):void 0),M=[],R=void 0;for(const[z,W]of D)if(W.parentId===e&&(M.push({id:z,position:{...W.position},extent:W.extent}),W.extent==="parent"||W.expandParent)){const X=VQe(W,_,W.origin??j);R?R=[[Math.min(X[0][0],R[0][0]),Math.min(X[0][1],R[0][1])],[Math.max(X[1][0],R[1][0]),Math.max(X[1][1],R[1][1])]]:R=X}f?.(N,{...y})}).on("drag",N=>{const{transform:D,snapGrid:F,snapToGrid:L,nodeOrigin:U}=n(),j=a1(N.sourceEvent,{transform:D,snapGrid:F,snapToGrid:L,containerBounds:S}),q=[];if(!_)return;const{x:Z,y:Q,width:z,height:W}=y,X={},H=_.origin??U,{width:J,height:te,x:ee,y:se}=jQe(w,s.controlDirection,j,s.boundaries,s.keepAspectRatio,H,C,R),ue=J!==z,oe=te!==W,Te=ee!==Z&&ue,Ne=se!==Q&&oe;if(!Te&&!Ne&&!ue&&!oe)return;if((Te||Ne||H[0]===1||H[1]===1)&&(X.x=Te?ee:y.x,X.y=Ne?se:y.y,y.x=X.x,y.y=X.y,M.length>0)){const Me=ee-Z,Ie=se-Q;for(const ce of M)ce.position={x:ce.position.x-Me+H[0]*(J-z),y:ce.position.y-Ie+H[1]*(te-W)},q.push(ce)}if((ue||oe)&&(X.width=ue&&(!s.resizeDirection||s.resizeDirection==="horizontal")?J:y.width,X.height=oe&&(!s.resizeDirection||s.resizeDirection==="vertical")?te:y.height,y.width=X.width,y.height=X.height),E&&_.expandParent){const Me=H[0]*(X.width??0);X.x&&X.x<Me&&(y.x=Me,w.x=w.x-(X.x-Me));const Ie=H[1]*(X.height??0);X.y&&X.y<Ie&&(y.y=Ie,w.y=w.y-(X.y-Ie))}const be=zQe({width:y.width,prevWidth:z,height:y.height,prevHeight:W,affectsX:s.controlDirection.affectsX,affectsY:s.controlDirection.affectsY}),De={...y,direction:be};b?.(N,De)!==!1&&(k=!0,m?.(N,De),r(X,q))}).on("end",N=>{k&&(x?.(N,{...y}),i?.({...y}),k=!1)});a.call(I)}function l(){a.on(".drag",null)}return{update:o,destroy:l}}const{useDebugValue:GQe}=Xt,{useSyncExternalStoreWithSelector:WQe}=hZ,YQe=t=>t;function dle(t,e=YQe,n){const r=WQe(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return GQe(r),r}const u$=(t,e)=>{const n=J_e(t),r=(i,a=e)=>dle(n,i,a);return Object.assign(r,n),r},XQe=(t,e)=>t?u$(t,e):u$;function Zr(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,i]of t)if(!Object.is(i,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}const Q3=P.createContext(null),KQe=Q3.Provider,hle=Gl.error001();function rr(t,e){const n=P.useContext(Q3);if(n===null)throw new Error(hle);return dle(n,t,e)}function ti(){const t=P.useContext(Q3);if(t===null)throw new Error(hle);return P.useMemo(()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe}),[t])}const c$={display:"none"},ZQe={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},fle="react-flow__node-desc",ple="react-flow__edge-desc",JQe="react-flow__aria-live",QQe=t=>t.ariaLiveMessage,eet=t=>t.ariaLabelConfig;function tet({rfId:t}){const e=rr(QQe);return g.jsx("div",{id:`${JQe}-${t}`,"aria-live":"assertive","aria-atomic":"true",style:ZQe,children:e})}function net({rfId:t,disableKeyboardA11y:e}){const n=rr(eet);return g.jsxs(g.Fragment,{children:[g.jsx("div",{id:`${fle}-${t}`,style:c$,children:e?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),g.jsx("div",{id:`${ple}-${t}`,style:c$,children:n["edge.a11yDescription.default"]}),!e&&g.jsx(tet,{rfId:t})]})}const eS=P.forwardRef(({position:t="top-left",children:e,className:n,style:r,...i},a)=>{const s=`${t}`.split("-");return g.jsx("div",{className:Gi(["react-flow__panel",n,...s]),style:r,ref:a,...i,children:e})});eS.displayName="Panel";function ret({proOptions:t,position:e="bottom-right"}){return t?.hideAttribution?null:g.jsx(eS,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:g.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const iet=t=>{const e=[],n=[];for(const[,r]of t.nodeLookup)r.selected&&e.push(r.internals.userNode);for(const[,r]of t.edgeLookup)r.selected&&n.push(r);return{selectedNodes:e,selectedEdges:n}},Rb=t=>t.id;function aet(t,e){return Zr(t.selectedNodes.map(Rb),e.selectedNodes.map(Rb))&&Zr(t.selectedEdges.map(Rb),e.selectedEdges.map(Rb))}function set({onSelectionChange:t}){const e=ti(),{selectedNodes:n,selectedEdges:r}=rr(iet,aet);return P.useEffect(()=>{const i={nodes:n,edges:r};t?.(i),e.getState().onSelectionChangeHandlers.forEach(a=>a(i))},[n,r,t]),null}const oet=t=>!!t.onSelectionChangeHandlers;function uet({onSelectionChange:t}){const e=rr(oet);return t||e?g.jsx(set,{onSelectionChange:t}):null}const mle=[0,0],cet={x:0,y:0,zoom:1},det=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","zIndexMode"],d$=[...det,"rfId"],het=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges}),h$={translateExtent:sv,nodeOrigin:mle,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function fet(t){const{setNodes:e,setEdges:n,setMinZoom:r,setMaxZoom:i,setTranslateExtent:a,setNodeExtent:s,reset:o,setDefaultNodesAndEdges:l}=rr(het,Zr),u=ti();P.useEffect(()=>(l(t.defaultNodes,t.defaultEdges),()=>{c.current=h$,o()}),[]);const c=P.useRef(h$);return P.useEffect(()=>{for(const d of d$){const h=t[d],f=c.current[d];h!==f&&(typeof t[d]>"u"||(d==="nodes"?e(h):d==="edges"?n(h):d==="minZoom"?r(h):d==="maxZoom"?i(h):d==="translateExtent"?a(h):d==="nodeExtent"?s(h):d==="ariaLabelConfig"?u.setState({ariaLabelConfig:rQe(h)}):d==="fitView"?u.setState({fitViewQueued:h}):d==="fitViewOptions"?u.setState({fitViewOptions:h}):u.setState({[d]:h})))}c.current=t},d$.map(d=>t[d])),null}function f$(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function pet(t){const[e,n]=P.useState(t==="system"?null:t);return P.useEffect(()=>{if(t!=="system"){n(t);return}const r=f$(),i=()=>n(r?.matches?"dark":"light");return i(),r?.addEventListener("change",i),()=>{r?.removeEventListener("change",i)}},[t]),e!==null?e:f$()?.matches?"dark":"light"}const p$=typeof document<"u"?document:null;function cv(t=null,e={target:p$,actInsideInputWithModifier:!0}){const[n,r]=P.useState(!1),i=P.useRef(!1),a=P.useRef(new Set([])),[s,o]=P.useMemo(()=>{if(t!==null){const u=(Array.isArray(t)?t:[t]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),c=u.reduce((d,h)=>d.concat(...h),[]);return[u,c]}return[[],[]]},[t]);return P.useEffect(()=>{const l=e?.target??p$,u=e?.actInsideInputWithModifier??!0;if(t!==null){const c=f=>{if(i.current=f.ctrlKey||f.metaKey||f.shiftKey||f.altKey,(!i.current||i.current&&!u)&&Yoe(f))return!1;const x=g$(f.code,o);if(a.current.add(f[x]),m$(s,a.current,!1)){const b=f.composedPath?.()?.[0]||f.target,y=b?.nodeName==="BUTTON"||b?.nodeName==="A";e.preventDefault!==!1&&(i.current||!y)&&f.preventDefault(),r(!0)}},d=f=>{const m=g$(f.code,o);m$(s,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(f[m]),f.key==="Meta"&&a.current.clear(),i.current=!1},h=()=>{a.current.clear(),r(!1)};return l?.addEventListener("keydown",c),l?.addEventListener("keyup",d),window.addEventListener("blur",h),window.addEventListener("contextmenu",h),()=>{l?.removeEventListener("keydown",c),l?.removeEventListener("keyup",d),window.removeEventListener("blur",h),window.removeEventListener("contextmenu",h)}}},[t,r]),n}function m$(t,e,n){return t.filter(r=>n||r.length===e.size).some(r=>r.every(i=>e.has(i)))}function g$(t,e){return e.includes(t)?"code":"key"}const met=()=>{const t=ti();return P.useMemo(()=>({zoomIn:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomOut:e=>{const{panZoom:n}=t.getState();return n?n.scaleBy(1/1.2,{duration:e?.duration}):Promise.resolve(!1)},zoomTo:(e,n)=>{const{panZoom:r}=t.getState();return r?r.scaleTo(e,{duration:n?.duration}):Promise.resolve(!1)},getZoom:()=>t.getState().transform[2],setViewport:async(e,n)=>{const{transform:[r,i,a],panZoom:s}=t.getState();return s?(await s.setViewport({x:e.x??r,y:e.y??i,zoom:e.zoom??a},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},setCenter:async(e,n,r)=>t.getState().setCenter(e,n,r),fitBounds:async(e,n)=>{const{width:r,height:i,minZoom:a,maxZoom:s,panZoom:o}=t.getState(),l=U7(e,r,i,a,s,n?.padding??.1);return o?(await o.setViewport(l,{duration:n?.duration,ease:n?.ease,interpolate:n?.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(e,n={})=>{const{transform:r,snapGrid:i,snapToGrid:a,domNode:s}=t.getState();if(!s)return e;const{x:o,y:l}=s.getBoundingClientRect(),u={x:e.x-o,y:e.y-l},c=n.snapGrid??i,d=n.snapToGrid??a;return Zv(u,r,d,c)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:i,y:a}=r.getBoundingClientRect(),s=t2(e,n);return{x:s.x+i,y:s.y+a}}}),[])};function gle(t,e){const n=[],r=new Map,i=[];for(const a of t)if(a.type==="add"){i.push(a);continue}else if(a.type==="remove"||a.type==="replace")r.set(a.id,[a]);else{const s=r.get(a.id);s?s.push(a):r.set(a.id,[a])}for(const a of e){const s=r.get(a.id);if(!s){n.push(a);continue}if(s[0].type==="remove")continue;if(s[0].type==="replace"){n.push({...s[0].item});continue}const o={...a};for(const l of s)get(l,o);n.push(o)}return i.length&&i.forEach(a=>{a.index!==void 0?n.splice(a.index,0,{...a.item}):n.push({...a.item})}),n}function get(t,e){switch(t.type){case"select":{e.selected=t.selected;break}case"position":{typeof t.position<"u"&&(e.position=t.position),typeof t.dragging<"u"&&(e.dragging=t.dragging);break}case"dimensions":{typeof t.dimensions<"u"&&(e.measured={...t.dimensions},t.setAttributes&&((t.setAttributes===!0||t.setAttributes==="width")&&(e.width=t.dimensions.width),(t.setAttributes===!0||t.setAttributes==="height")&&(e.height=t.dimensions.height))),typeof t.resizing=="boolean"&&(e.resizing=t.resizing);break}}}function vet(t,e){return gle(t,e)}function yet(t,e){return gle(t,e)}function yh(t,e){return{id:t,type:"select",selected:e}}function Kp(t,e=new Set,n=!1){const r=[];for(const[i,a]of t){const s=e.has(i);!(a.selected===void 0&&!s)&&a.selected!==s&&(n&&(a.selected=s),r.push(yh(a.id,s)))}return r}function v$({items:t=[],lookup:e}){const n=[],r=new Map(t.map(i=>[i.id,i]));for(const[i,a]of t.entries()){const s=e.get(a.id),o=s?.internals?.userNode??s;o!==void 0&&o!==a&&n.push({id:a.id,item:a,type:"replace"}),o===void 0&&n.push({item:a,type:"add",index:i})}for(const[i]of e)r.get(i)===void 0&&n.push({id:i,type:"remove"});return n}function y$(t){return{id:t.id,type:"remove"}}const x$=t=>WJe(t),xet=t=>zoe(t);function vle(t){return P.forwardRef(t)}const bet=typeof window<"u"?P.useLayoutEffect:P.useEffect;function b$(t){const[e,n]=P.useState(BigInt(0)),[r]=P.useState(()=>_et(()=>n(i=>i+BigInt(1))));return bet(()=>{const i=r.get();i.length&&(t(i),r.reset())},[e]),r}function _et(t){let e=[];return{get:()=>e,reset:()=>{e=[]},push:n=>{e.push(n),t()}}}const yle=P.createContext(null);function wet({children:t}){const e=ti(),n=P.useCallback(o=>{const{nodes:l=[],setNodes:u,hasDefaultNodes:c,onNodesChange:d,nodeLookup:h,fitViewQueued:f,onNodesChangeMiddlewareMap:m}=e.getState();let x=l;for(const y of o)x=typeof y=="function"?y(x):y;let b=v$({items:x,lookup:h});for(const y of m.values())b=y(b);c&&u(x),b.length>0?d?.(b):f&&window.requestAnimationFrame(()=>{const{fitViewQueued:y,nodes:w,setNodes:_}=e.getState();y&&_(w)})},[]),r=b$(n),i=P.useCallback(o=>{const{edges:l=[],setEdges:u,hasDefaultEdges:c,onEdgesChange:d,edgeLookup:h}=e.getState();let f=l;for(const m of o)f=typeof m=="function"?m(f):m;c?u(f):d&&d(v$({items:f,lookup:h}))},[]),a=b$(i),s=P.useMemo(()=>({nodeQueue:r,edgeQueue:a}),[]);return g.jsx(yle.Provider,{value:s,children:t})}function Eet(){const t=P.useContext(yle);if(!t)throw new Error("useBatchContext must be used within a BatchProvider");return t}const Tet=t=>!!t.panZoom;function G7(){const t=met(),e=ti(),n=Eet(),r=rr(Tet),i=P.useMemo(()=>{const a=d=>e.getState().nodeLookup.get(d),s=d=>{n.nodeQueue.push(d)},o=d=>{n.edgeQueue.push(d)},l=d=>{const{nodeLookup:h,nodeOrigin:f}=e.getState(),m=x$(d)?d:h.get(d.id),x=m.parentId?Goe(m.position,m.measured,m.parentId,h,f):m.position,b={...m,position:x,width:m.measured?.width??m.width,height:m.measured?.height??m.height};return P0(b)},u=(d,h,f={replace:!1})=>{s(m=>m.map(x=>{if(x.id===d){const b=typeof h=="function"?h(x):h;return f.replace&&x$(b)?b:{...x,...b}}return x}))},c=(d,h,f={replace:!1})=>{o(m=>m.map(x=>{if(x.id===d){const b=typeof h=="function"?h(x):h;return f.replace&&xet(b)?b:{...x,...b}}return x}))};return{getNodes:()=>e.getState().nodes.map(d=>({...d})),getNode:d=>a(d)?.internals.userNode,getInternalNode:a,getEdges:()=>{const{edges:d=[]}=e.getState();return d.map(h=>({...h}))},getEdge:d=>e.getState().edgeLookup.get(d),setNodes:s,setEdges:o,addNodes:d=>{const h=Array.isArray(d)?d:[d];n.nodeQueue.push(f=>[...f,...h])},addEdges:d=>{const h=Array.isArray(d)?d:[d];n.edgeQueue.push(f=>[...f,...h])},toObject:()=>{const{nodes:d=[],edges:h=[],transform:f}=e.getState(),[m,x,b]=f;return{nodes:d.map(y=>({...y})),edges:h.map(y=>({...y})),viewport:{x:m,y:x,zoom:b}}},deleteElements:async({nodes:d=[],edges:h=[]})=>{const{nodes:f,edges:m,onNodesDelete:x,onEdgesDelete:b,triggerNodeChanges:y,triggerEdgeChanges:w,onDelete:_,onBeforeDelete:S}=e.getState(),{nodes:M,edges:E}=await JJe({nodesToRemove:d,edgesToRemove:h,nodes:f,edges:m,onBeforeDelete:S}),C=E.length>0,R=M.length>0;if(C){const k=E.map(y$);b?.(E),w(k)}if(R){const k=M.map(y$);x?.(M),y(k)}return(R||C)&&_?.({nodes:M,edges:E}),{deletedNodes:M,deletedEdges:E}},getIntersectingNodes:(d,h=!0,f)=>{const m=KH(d),x=m?d:l(d),b=f!==void 0;return x?(f||e.getState().nodes).filter(y=>{const w=e.getState().nodeLookup.get(y.id);if(w&&!m&&(y.id===d.id||!w.internals.positionAbsolute))return!1;const _=P0(b?y:w),S=lv(_,x);return h&&S>0||S>=_.width*_.height||S>=x.width*x.height}):[]},isNodeIntersecting:(d,h,f=!0)=>{const x=KH(d)?d:l(d);if(!x)return!1;const b=lv(x,h);return f&&b>0||b>=h.width*h.height||b>=x.width*x.height},updateNode:u,updateNodeData:(d,h,f={replace:!1})=>{u(d,m=>{const x=typeof h=="function"?h(m):h;return f.replace?{...m,data:x}:{...m,data:{...m.data,...x}}},f)},updateEdge:c,updateEdgeData:(d,h,f={replace:!1})=>{c(d,m=>{const x=typeof h=="function"?h(m):h;return f.replace?{...m,data:x}:{...m,data:{...m.data,...x}}},f)},getNodesBounds:d=>{const{nodeLookup:h,nodeOrigin:f}=e.getState();return YJe(d,{nodeLookup:h,nodeOrigin:f})},getHandleConnections:({type:d,id:h,nodeId:f})=>Array.from(e.getState().connectionLookup.get(`${f}-${d}${h?`-${h}`:""}`)?.values()??[]),getNodeConnections:({type:d,handleId:h,nodeId:f})=>Array.from(e.getState().connectionLookup.get(`${f}${d?h?`-${d}-${h}`:`-${d}`:""}`)?.values()??[]),fitView:async d=>{const h=e.getState().fitViewResolver??nQe();return e.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:h}),n.nodeQueue.push(f=>[...f]),h.promise}}},[]);return P.useMemo(()=>({...i,...t,viewportInitialized:r}),[r])}const _$=t=>t.selected,Cet=typeof window<"u"?window:void 0;function Met({deleteKeyCode:t,multiSelectionKeyCode:e}){const n=ti(),{deleteElements:r}=G7(),i=cv(t,{actInsideInputWithModifier:!1}),a=cv(e,{target:Cet});P.useEffect(()=>{if(i){const{edges:s,nodes:o}=n.getState();r({nodes:o.filter(_$),edges:s.filter(_$)}),n.setState({nodesSelectionActive:!1})}},[i]),P.useEffect(()=>{n.setState({multiSelectionActive:a})},[a])}function Aet(t){const e=ti();P.useEffect(()=>{const n=()=>{if(!t.current||!(t.current.checkVisibility?.()??!0))return!1;const r=z7(t.current);(r.height===0||r.width===0)&&e.getState().onError?.("004",Gl.error004()),e.setState({width:r.width||500,height:r.height||500})};if(t.current){n(),window.addEventListener("resize",n);const r=new ResizeObserver(()=>n());return r.observe(t.current),()=>{window.removeEventListener("resize",n),r&&t.current&&r.unobserve(t.current)}}},[])}const tS={position:"absolute",width:"100%",height:"100%",top:0,left:0},ket=t=>({userSelectionActive:t.userSelectionActive,lib:t.lib,connectionInProgress:t.connection.inProgress});function Iet({onPaneContextMenu:t,zoomOnScroll:e=!0,zoomOnPinch:n=!0,panOnScroll:r=!1,panOnScrollSpeed:i=.5,panOnScrollMode:a=qh.Free,zoomOnDoubleClick:s=!0,panOnDrag:o=!0,defaultViewport:l,translateExtent:u,minZoom:c,maxZoom:d,zoomActivationKeyCode:h,preventScrolling:f=!0,children:m,noWheelClassName:x,noPanClassName:b,onViewportChange:y,isControlledViewport:w,paneClickDistance:_,selectionOnDrag:S}){const M=ti(),E=P.useRef(null),{userSelectionActive:C,lib:R,connectionInProgress:k}=rr(ket,Zr),I=cv(h),N=P.useRef();Aet(E);const D=P.useCallback(F=>{y?.({x:F[0],y:F[1],zoom:F[2]}),w||M.setState({transform:F})},[y,w]);return P.useEffect(()=>{if(E.current){N.current=UQe({domNode:E.current,minZoom:c,maxZoom:d,translateExtent:u,viewport:l,onDraggingChange:j=>M.setState({paneDragging:j}),onPanZoomStart:(j,q)=>{const{onViewportChangeStart:Z,onMoveStart:Q}=M.getState();Q?.(j,q),Z?.(q)},onPanZoom:(j,q)=>{const{onViewportChange:Z,onMove:Q}=M.getState();Q?.(j,q),Z?.(q)},onPanZoomEnd:(j,q)=>{const{onViewportChangeEnd:Z,onMoveEnd:Q}=M.getState();Q?.(j,q),Z?.(q)}});const{x:F,y:L,zoom:U}=N.current.getViewport();return M.setState({panZoom:N.current,transform:[F,L,U],domNode:E.current.closest(".react-flow")}),()=>{N.current?.destroy()}}},[]),P.useEffect(()=>{N.current?.update({onPaneContextMenu:t,zoomOnScroll:e,zoomOnPinch:n,panOnScroll:r,panOnScrollSpeed:i,panOnScrollMode:a,zoomOnDoubleClick:s,panOnDrag:o,zoomActivationKeyPressed:I,preventScrolling:f,noPanClassName:b,userSelectionActive:C,noWheelClassName:x,lib:R,onTransformChange:D,connectionInProgress:k,selectionOnDrag:S,paneClickDistance:_})},[t,e,n,r,i,a,s,o,I,f,b,C,x,R,D,k,S,_]),g.jsx("div",{className:"react-flow__renderer",ref:E,style:tS,children:m})}const Net=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function Ret(){const{userSelectionActive:t,userSelectionRect:e}=rr(Net,Zr);return t&&e?g.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}const l5=(t,e)=>n=>{n.target===e.current&&t?.(n)},Pet=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,connectionInProgress:t.connection.inProgress,dragging:t.paneDragging});function Det({isSelecting:t,selectionKeyPressed:e,selectionMode:n=ov.Full,panOnDrag:r,paneClickDistance:i,selectionOnDrag:a,onSelectionStart:s,onSelectionEnd:o,onPaneClick:l,onPaneContextMenu:u,onPaneScroll:c,onPaneMouseEnter:d,onPaneMouseMove:h,onPaneMouseLeave:f,children:m}){const x=ti(),{userSelectionActive:b,elementsSelectable:y,dragging:w,connectionInProgress:_}=rr(Pet,Zr),S=y&&(t||b),M=P.useRef(null),E=P.useRef(),C=P.useRef(new Set),R=P.useRef(new Set),k=P.useRef(!1),I=Z=>{if(k.current||_){k.current=!1;return}l?.(Z),x.getState().resetSelectedElements(),x.setState({nodesSelectionActive:!1})},N=Z=>{if(Array.isArray(r)&&r?.includes(2)){Z.preventDefault();return}u?.(Z)},D=c?Z=>c(Z):void 0,F=Z=>{k.current&&(Z.stopPropagation(),k.current=!1)},L=Z=>{const{domNode:Q}=x.getState();if(E.current=Q?.getBoundingClientRect(),!E.current)return;const z=Z.target===M.current;if(!z&&!!Z.target.closest(".nokey")||!t||!(a&&z||e)||Z.button!==0||!Z.isPrimary)return;Z.target?.setPointerCapture?.(Z.pointerId),k.current=!1;const{x:H,y:J}=el(Z.nativeEvent,E.current);x.setState({userSelectionRect:{width:0,height:0,startX:H,startY:J,x:H,y:J}}),z||(Z.stopPropagation(),Z.preventDefault())},U=Z=>{const{userSelectionRect:Q,transform:z,nodeLookup:W,edgeLookup:X,connectionLookup:H,triggerNodeChanges:J,triggerEdgeChanges:te,defaultEdgeOptions:ee,resetSelectedElements:se}=x.getState();if(!E.current||!Q)return;const{x:ue,y:oe}=el(Z.nativeEvent,E.current),{startX:Te,startY:Ne}=Q;if(!k.current){const Ie=e?0:i;if(Math.hypot(ue-Te,oe-Ne)<=Ie)return;se(),s?.(Z)}k.current=!0;const be={startX:Te,startY:Ne,x:ue<Te?ue:Te,y:oe<Ne?oe:Ne,width:Math.abs(ue-Te),height:Math.abs(oe-Ne)},De=C.current,ke=R.current;C.current=new Set(B7(W,be,z,n===ov.Partial,!0).map(Ie=>Ie.id)),R.current=new Set;const Me=ee?.selectable??!0;for(const Ie of C.current){const ce=H.get(Ie);if(ce)for(const{edgeId:G}of ce.values()){const xe=X.get(G);xe&&(xe.selectable??Me)&&R.current.add(G)}}if(!ZH(De,C.current)){const Ie=Kp(W,C.current,!0);J(Ie)}if(!ZH(ke,R.current)){const Ie=Kp(X,R.current);te(Ie)}x.setState({userSelectionRect:be,userSelectionActive:!0,nodesSelectionActive:!1})},j=Z=>{Z.button===0&&(Z.target?.releasePointerCapture?.(Z.pointerId),!b&&Z.target===M.current&&x.getState().userSelectionRect&&I?.(Z),x.setState({userSelectionActive:!1,userSelectionRect:null}),k.current&&(o?.(Z),x.setState({nodesSelectionActive:C.current.size>0})))},q=r===!0||Array.isArray(r)&&r.includes(0);return g.jsxs("div",{className:Gi(["react-flow__pane",{draggable:q,dragging:w,selection:t}]),onClick:S?void 0:l5(I,M),onContextMenu:l5(N,M),onWheel:l5(D,M),onPointerEnter:S?void 0:d,onPointerMove:S?U:h,onPointerUp:S?j:void 0,onPointerDownCapture:S?L:void 0,onClickCapture:S?F:void 0,onPointerLeave:f,ref:M,style:tS,children:[m,g.jsx(Ret,{})]})}function AN({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:a,multiSelectionActive:s,nodeLookup:o,onError:l}=e.getState(),u=o.get(t);if(!u){l?.("012",Gl.error012(t));return}e.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&s)&&(a({nodes:[u],edges:[]}),requestAnimationFrame(()=>r?.current?.blur())):i([t])}function xle({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:a,nodeClickDistance:s}){const o=ti(),[l,u]=P.useState(!1),c=P.useRef();return P.useEffect(()=>{c.current=TQe({getStoreItems:()=>o.getState(),onNodeMouseDown:d=>{AN({id:d,store:o,nodeRef:t})},onDragStart:()=>{u(!0)},onDragStop:()=>{u(!1)}})},[]),P.useEffect(()=>{if(e)c.current?.destroy();else if(t.current)return c.current?.update({noDragClassName:n,handleSelector:r,domNode:t.current,isSelectable:a,nodeId:i,nodeClickDistance:s}),()=>{c.current?.destroy()}},[n,r,e,a,t,i]),l}const Oet=t=>e=>e.selected&&(e.draggable||t&&typeof e.draggable>"u");function ble(){const t=ti();return P.useCallback(n=>{const{nodeExtent:r,snapToGrid:i,snapGrid:a,nodesDraggable:s,onError:o,updateNodePositions:l,nodeLookup:u,nodeOrigin:c}=t.getState(),d=new Map,h=Oet(s),f=i?a[0]:5,m=i?a[1]:5,x=n.direction.x*f*n.factor,b=n.direction.y*m*n.factor;for(const[,y]of u){if(!h(y))continue;let w={x:y.internals.positionAbsolute.x+x,y:y.internals.positionAbsolute.y+b};i&&(w=Kv(w,a));const{position:_,positionAbsolute:S}=joe({nodeId:y.id,nextPosition:w,nodeLookup:u,nodeExtent:r,nodeOrigin:c,onError:o});y.position=_,y.internals.positionAbsolute=S,d.set(y.id,y)}l(d)},[])}const W7=P.createContext(null),Let=W7.Provider;W7.Consumer;const _le=()=>P.useContext(W7),Fet=t=>({connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName,rfId:t.rfId}),Bet=(t,e,n)=>r=>{const{connectionClickStartHandle:i,connectionMode:a,connection:s}=r,{fromHandle:o,toHandle:l,isValid:u}=s,c=l?.nodeId===t&&l?.id===e&&l?.type===n;return{connectingFrom:o?.nodeId===t&&o?.id===e&&o?.type===n,connectingTo:c,clickConnecting:i?.nodeId===t&&i?.id===e&&i?.type===n,isPossibleEndHandle:a===N0.Strict?o?.type!==n:t!==o?.nodeId||e!==o?.id,connectionInProcess:!!o,clickConnectionInProcess:!!i,valid:c&&u}};function Uet({type:t="source",position:e=rn.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:a=!0,id:s,onConnect:o,children:l,className:u,onMouseDown:c,onTouchStart:d,...h},f){const m=s||null,x=t==="target",b=ti(),y=_le(),{connectOnClick:w,noPanClassName:_,rfId:S}=rr(Fet,Zr),{connectingFrom:M,connectingTo:E,clickConnecting:C,isPossibleEndHandle:R,connectionInProcess:k,clickConnectionInProcess:I,valid:N}=rr(Bet(y,m,t),Zr);y||b.getState().onError?.("010",Gl.error010());const D=U=>{const{defaultEdgeOptions:j,onConnect:q,hasDefaultEdges:Z}=b.getState(),Q={...j,...U};if(Z){const{edges:z,setEdges:W}=b.getState();W(uQe(Q,z))}q?.(Q),o?.(Q)},F=U=>{if(!y)return;const j=Xoe(U.nativeEvent);if(i&&(j&&U.button===0||!j)){const q=b.getState();MN.onPointerDown(U.nativeEvent,{handleDomNode:U.currentTarget,autoPanOnConnect:q.autoPanOnConnect,connectionMode:q.connectionMode,connectionRadius:q.connectionRadius,domNode:q.domNode,nodeLookup:q.nodeLookup,lib:q.lib,isTarget:x,handleId:m,nodeId:y,flowId:q.rfId,panBy:q.panBy,cancelConnection:q.cancelConnection,onConnectStart:q.onConnectStart,onConnectEnd:q.onConnectEnd,updateConnection:q.updateConnection,onConnect:D,isValidConnection:n||q.isValidConnection,getTransform:()=>b.getState().transform,getFromHandle:()=>b.getState().connection.fromHandle,autoPanSpeed:q.autoPanSpeed,dragThreshold:q.connectionDragThreshold})}j?c?.(U):d?.(U)},L=U=>{const{onClickConnectStart:j,onClickConnectEnd:q,connectionClickStartHandle:Z,connectionMode:Q,isValidConnection:z,lib:W,rfId:X,nodeLookup:H,connection:J}=b.getState();if(!y||!Z&&!i)return;if(!Z){j?.(U.nativeEvent,{nodeId:y,handleId:m,handleType:t}),b.setState({connectionClickStartHandle:{nodeId:y,type:t,id:m}});return}const te=Woe(U.target),ee=n||z,{connection:se,isValid:ue}=MN.isValid(U.nativeEvent,{handle:{nodeId:y,id:m,type:t},connectionMode:Q,fromNodeId:Z.nodeId,fromHandleId:Z.id||null,fromType:Z.type,isValidConnection:ee,flowId:X,doc:te,lib:W,nodeLookup:H});ue&&se&&D(se);const oe=structuredClone(J);delete oe.inProgress,oe.toPosition=oe.toHandle?oe.toHandle.position:null,q?.(U,oe),b.setState({connectionClickStartHandle:null})};return g.jsx("div",{"data-handleid":m,"data-nodeid":y,"data-handlepos":e,"data-id":`${S}-${y}-${m}-${t}`,className:Gi(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",_,u,{source:!x,target:x,connectable:r,connectablestart:i,connectableend:a,clickconnecting:C,connectingfrom:M,connectingto:E,valid:N,connectionindicator:r&&(!k||R)&&(k||I?a:i)}]),onMouseDown:F,onTouchStart:F,onClick:w?L:void 0,ref:f,...h,children:l})}const L0=P.memo(vle(Uet));function zet({data:t,isConnectable:e,sourcePosition:n=rn.Bottom}){return g.jsxs(g.Fragment,{children:[t?.label,g.jsx(L0,{type:"source",position:n,isConnectable:e})]})}function jet({data:t,isConnectable:e,targetPosition:n=rn.Top,sourcePosition:r=rn.Bottom}){return g.jsxs(g.Fragment,{children:[g.jsx(L0,{type:"target",position:n,isConnectable:e}),t?.label,g.jsx(L0,{type:"source",position:r,isConnectable:e})]})}function Het(){return null}function $et({data:t,isConnectable:e,targetPosition:n=rn.Top}){return g.jsxs(g.Fragment,{children:[g.jsx(L0,{type:"target",position:n,isConnectable:e}),t?.label]})}const n2={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},w$={input:zet,default:jet,output:$et,group:Het};function Vet(t){return t.internals.handleBounds===void 0?{width:t.width??t.initialWidth??t.style?.width,height:t.height??t.initialHeight??t.style?.height}:{width:t.width??t.style?.width,height:t.height??t.style?.height}}const qet=t=>{const{width:e,height:n,x:r,y:i}=Xv(t.nodeLookup,{filter:a=>!!a.selected});return{width:Qo(e)?e:null,height:Qo(n)?n:null,userSelectionActive:t.userSelectionActive,transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]}) translate(${r}px,${i}px)`}};function Get({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const r=ti(),{width:i,height:a,transformString:s,userSelectionActive:o}=rr(qet,Zr),l=ble(),u=P.useRef(null);if(P.useEffect(()=>{n||u.current?.focus({preventScroll:!0})},[n]),xle({nodeRef:u}),o||!i||!a)return null;const c=t?h=>{const f=r.getState().nodes.filter(m=>m.selected);t(h,f)}:void 0,d=h=>{Object.prototype.hasOwnProperty.call(n2,h.key)&&(h.preventDefault(),l({direction:n2[h.key],factor:h.shiftKey?4:1}))};return g.jsx("div",{className:Gi(["react-flow__nodesselection","react-flow__container",e]),style:{transform:s},children:g.jsx("div",{ref:u,className:"react-flow__nodesselection-rect",onContextMenu:c,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:i,height:a}})})}const S$=typeof window<"u"?window:void 0,Wet=t=>({nodesSelectionActive:t.nodesSelectionActive,userSelectionActive:t.userSelectionActive});function wle({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:a,onPaneScroll:s,paneClickDistance:o,deleteKeyCode:l,selectionKeyCode:u,selectionOnDrag:c,selectionMode:d,onSelectionStart:h,onSelectionEnd:f,multiSelectionKeyCode:m,panActivationKeyCode:x,zoomActivationKeyCode:b,elementsSelectable:y,zoomOnScroll:w,zoomOnPinch:_,panOnScroll:S,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:R,defaultViewport:k,translateExtent:I,minZoom:N,maxZoom:D,preventScrolling:F,onSelectionContextMenu:L,noWheelClassName:U,noPanClassName:j,disableKeyboardA11y:q,onViewportChange:Z,isControlledViewport:Q}){const{nodesSelectionActive:z,userSelectionActive:W}=rr(Wet,Zr),X=cv(u,{target:S$}),H=cv(x,{target:S$}),J=H||R,te=H||S,ee=c&&J!==!0,se=X||W||ee;return Met({deleteKeyCode:l,multiSelectionKeyCode:m}),g.jsx(Iet,{onPaneContextMenu:a,elementsSelectable:y,zoomOnScroll:w,zoomOnPinch:_,panOnScroll:te,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:C,panOnDrag:!X&&J,defaultViewport:k,translateExtent:I,minZoom:N,maxZoom:D,zoomActivationKeyCode:b,preventScrolling:F,noWheelClassName:U,noPanClassName:j,onViewportChange:Z,isControlledViewport:Q,paneClickDistance:o,selectionOnDrag:ee,children:g.jsxs(Det,{onSelectionStart:h,onSelectionEnd:f,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:a,onPaneScroll:s,panOnDrag:J,isSelecting:!!se,selectionMode:d,selectionKeyPressed:X,paneClickDistance:o,selectionOnDrag:ee,children:[t,z&&g.jsx(Get,{onSelectionContextMenu:L,noPanClassName:j,disableKeyboardA11y:q})]})})}wle.displayName="FlowRenderer";const Yet=P.memo(wle),Xet=t=>e=>t?B7(e.nodeLookup,{x:0,y:0,width:e.width,height:e.height},e.transform,!0).map(n=>n.id):Array.from(e.nodeLookup.keys());function Ket(t){return rr(P.useCallback(Xet(t),[t]),Zr)}const Zet=t=>t.updateNodeInternals;function Jet(){const t=rr(Zet),[e]=P.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const r=new Map;n.forEach(i=>{const a=i.target.getAttribute("data-id");r.set(a,{id:a,nodeElement:i.target,force:!0})}),t(r)}));return P.useEffect(()=>()=>{e?.disconnect()},[e]),e}function Qet({node:t,nodeType:e,hasDimensions:n,resizeObserver:r}){const i=ti(),a=P.useRef(null),s=P.useRef(null),o=P.useRef(t.sourcePosition),l=P.useRef(t.targetPosition),u=P.useRef(e),c=n&&!!t.internals.handleBounds;return P.useEffect(()=>{a.current&&!t.hidden&&(!c||s.current!==a.current)&&(s.current&&r?.unobserve(s.current),r?.observe(a.current),s.current=a.current)},[c,t.hidden]),P.useEffect(()=>()=>{s.current&&(r?.unobserve(s.current),s.current=null)},[]),P.useEffect(()=>{if(a.current){const d=u.current!==e,h=o.current!==t.sourcePosition,f=l.current!==t.targetPosition;(d||h||f)&&(u.current=e,o.current=t.sourcePosition,l.current=t.targetPosition,i.getState().updateNodeInternals(new Map([[t.id,{id:t.id,nodeElement:a.current,force:!0}]])))}},[t.id,e,t.sourcePosition,t.targetPosition]),a}function ett({id:t,onClick:e,onMouseEnter:n,onMouseMove:r,onMouseLeave:i,onContextMenu:a,onDoubleClick:s,nodesDraggable:o,elementsSelectable:l,nodesConnectable:u,nodesFocusable:c,resizeObserver:d,noDragClassName:h,noPanClassName:f,disableKeyboardA11y:m,rfId:x,nodeTypes:b,nodeClickDistance:y,onError:w}){const{node:_,internals:S,isParent:M}=rr(ue=>{const oe=ue.nodeLookup.get(t),Te=ue.parentLookup.has(t);return{node:oe,internals:oe.internals,isParent:Te}},Zr);let E=_.type||"default",C=b?.[E]||w$[E];C===void 0&&(w?.("003",Gl.error003(E)),E="default",C=b?.default||w$.default);const R=!!(_.draggable||o&&typeof _.draggable>"u"),k=!!(_.selectable||l&&typeof _.selectable>"u"),I=!!(_.connectable||u&&typeof _.connectable>"u"),N=!!(_.focusable||c&&typeof _.focusable>"u"),D=ti(),F=qoe(_),L=Qet({node:_,nodeType:E,hasDimensions:F,resizeObserver:d}),U=xle({nodeRef:L,disabled:_.hidden||!R,noDragClassName:h,handleSelector:_.dragHandle,nodeId:t,isSelectable:k,nodeClickDistance:y}),j=ble();if(_.hidden)return null;const q=Ju(_),Z=Vet(_),Q=k||R||e||n||r||i,z=n?ue=>n(ue,{...S.userNode}):void 0,W=r?ue=>r(ue,{...S.userNode}):void 0,X=i?ue=>i(ue,{...S.userNode}):void 0,H=a?ue=>a(ue,{...S.userNode}):void 0,J=s?ue=>s(ue,{...S.userNode}):void 0,te=ue=>{const{selectNodesOnDrag:oe,nodeDragThreshold:Te}=D.getState();k&&(!oe||!R||Te>0)&&AN({id:t,store:D,nodeRef:L}),e&&e(ue,{...S.userNode})},ee=ue=>{if(!(Yoe(ue.nativeEvent)||m)){if(Loe.includes(ue.key)&&k){const oe=ue.key==="Escape";AN({id:t,store:D,unselect:oe,nodeRef:L})}else if(R&&_.selected&&Object.prototype.hasOwnProperty.call(n2,ue.key)){ue.preventDefault();const{ariaLabelConfig:oe}=D.getState();D.setState({ariaLiveMessage:oe["node.a11yDescription.ariaLiveMessage"]({direction:ue.key.replace("Arrow","").toLowerCase(),x:~~S.positionAbsolute.x,y:~~S.positionAbsolute.y})}),j({direction:n2[ue.key],factor:ue.shiftKey?4:1})}}},se=()=>{if(m||!L.current?.matches(":focus-visible"))return;const{transform:ue,width:oe,height:Te,autoPanOnNodeFocus:Ne,setCenter:be}=D.getState();if(!Ne)return;B7(new Map([[t,_]]),{x:0,y:0,width:oe,height:Te},ue,!0).length>0||be(_.position.x+q.width/2,_.position.y+q.height/2,{zoom:ue[2]})};return g.jsx("div",{className:Gi(["react-flow__node",`react-flow__node-${E}`,{[f]:R},_.className,{selected:_.selected,selectable:k,parent:M,draggable:R,dragging:U}]),ref:L,style:{zIndex:S.z,transform:`translate(${S.positionAbsolute.x}px,${S.positionAbsolute.y}px)`,pointerEvents:Q?"all":"none",visibility:F?"visible":"hidden",..._.style,...Z},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:z,onMouseMove:W,onMouseLeave:X,onContextMenu:H,onClick:te,onDoubleClick:J,onKeyDown:N?ee:void 0,tabIndex:N?0:void 0,onFocus:N?se:void 0,role:_.ariaRole??(N?"group":void 0),"aria-roledescription":"node","aria-describedby":m?void 0:`${fle}-${x}`,"aria-label":_.ariaLabel,..._.domAttributes,children:g.jsx(Let,{value:t,children:g.jsx(C,{id:t,data:_.data,type:E,positionAbsoluteX:S.positionAbsolute.x,positionAbsoluteY:S.positionAbsolute.y,selected:_.selected??!1,selectable:k,draggable:R,deletable:_.deletable??!0,isConnectable:I,sourcePosition:_.sourcePosition,targetPosition:_.targetPosition,dragging:U,dragHandle:_.dragHandle,zIndex:S.z,parentId:_.parentId,...q})})})}var ttt=P.memo(ett);const ntt=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,onError:t.onError});function Sle(t){const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,onError:a}=rr(ntt,Zr),s=Ket(t.onlyRenderVisibleElements),o=Jet();return g.jsx("div",{className:"react-flow__nodes",style:tS,children:s.map(l=>g.jsx(ttt,{id:l,nodeTypes:t.nodeTypes,nodeExtent:t.nodeExtent,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,resizeObserver:o,nodesDraggable:e,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,nodeClickDistance:t.nodeClickDistance,onError:a},l))})}Sle.displayName="NodeRenderer";const rtt=P.memo(Sle);function itt(t){return rr(P.useCallback(n=>{if(!t)return n.edges.map(i=>i.id);const r=[];if(n.width&&n.height)for(const i of n.edges){const a=n.nodeLookup.get(i.source),s=n.nodeLookup.get(i.target);a&&s&&sQe({sourceNode:a,targetNode:s,width:n.width,height:n.height,transform:n.transform})&&r.push(i.id)}return r},[t]),Zr)}const att=({color:t="none",strokeWidth:e=1})=>{const n={strokeWidth:e,...t&&{stroke:t}};return g.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},stt=({color:t="none",strokeWidth:e=1})=>{const n={strokeWidth:e,...t&&{stroke:t,fill:t}};return g.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},E$={[Qw.Arrow]:att,[Qw.ArrowClosed]:stt};function ott(t){const e=ti();return P.useMemo(()=>Object.prototype.hasOwnProperty.call(E$,t)?E$[t]:(e.getState().onError?.("009",Gl.error009(t)),null),[t])}const ltt=({id:t,type:e,color:n,width:r=12.5,height:i=12.5,markerUnits:a="strokeWidth",strokeWidth:s,orient:o="auto-start-reverse"})=>{const l=ott(e);return l?g.jsx("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:o,refX:"0",refY:"0",children:g.jsx(l,{color:n,strokeWidth:s})}):null},Ele=({defaultColor:t,rfId:e})=>{const n=rr(a=>a.edges),r=rr(a=>a.defaultEdgeOptions),i=P.useMemo(()=>pQe(n,{id:e,defaultColor:t,defaultMarkerStart:r?.markerStart,defaultMarkerEnd:r?.markerEnd}),[n,r,e,t]);return i.length?g.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:g.jsx("defs",{children:i.map(a=>g.jsx(ltt,{id:a.id,type:a.type,color:a.color,width:a.width,height:a.height,markerUnits:a.markerUnits,strokeWidth:a.strokeWidth,orient:a.orient},a.id))})}):null};Ele.displayName="MarkerDefinitions";var utt=P.memo(Ele);function Tle({x:t,y:e,label:n,labelStyle:r,labelShowBg:i=!0,labelBgStyle:a,labelBgPadding:s=[2,4],labelBgBorderRadius:o=2,children:l,className:u,...c}){const[d,h]=P.useState({x:1,y:0,width:0,height:0}),f=Gi(["react-flow__edge-textwrapper",u]),m=P.useRef(null);return P.useEffect(()=>{if(m.current){const x=m.current.getBBox();h({x:x.x,y:x.y,width:x.width,height:x.height})}},[n]),n?g.jsxs("g",{transform:`translate(${t-d.width/2} ${e-d.height/2})`,className:f,visibility:d.width?"visible":"hidden",...c,children:[i&&g.jsx("rect",{width:d.width+2*s[0],x:-s[0],y:-s[1],height:d.height+2*s[1],className:"react-flow__edge-textbg",style:a,rx:o,ry:o}),g.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:m,style:r,children:n}),l]}):null}Tle.displayName="EdgeText";const ctt=P.memo(Tle);function nS({path:t,labelX:e,labelY:n,label:r,labelStyle:i,labelShowBg:a,labelBgStyle:s,labelBgPadding:o,labelBgBorderRadius:l,interactionWidth:u=20,...c}){return g.jsxs(g.Fragment,{children:[g.jsx("path",{...c,d:t,fill:"none",className:Gi(["react-flow__edge-path",c.className])}),u?g.jsx("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:u,className:"react-flow__edge-interaction"}):null,r&&Qo(e)&&Qo(n)?g.jsx(ctt,{x:e,y:n,label:r,labelStyle:i,labelShowBg:a,labelBgStyle:s,labelBgPadding:o,labelBgBorderRadius:l}):null]})}function T$({pos:t,x1:e,y1:n,x2:r,y2:i}){return t===rn.Left||t===rn.Right?[.5*(e+r),n]:[e,.5*(n+i)]}function Cle({sourceX:t,sourceY:e,sourcePosition:n=rn.Bottom,targetX:r,targetY:i,targetPosition:a=rn.Top}){const[s,o]=T$({pos:n,x1:t,y1:e,x2:r,y2:i}),[l,u]=T$({pos:a,x1:r,y1:i,x2:t,y2:e}),[c,d,h,f]=Koe({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:s,sourceControlY:o,targetControlX:l,targetControlY:u});return[`M${t},${e} C${s},${o} ${l},${u} ${r},${i}`,c,d,h,f]}function Mle(t){return P.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:a,sourcePosition:s,targetPosition:o,label:l,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:x,markerStart:b,interactionWidth:y})=>{const[w,_,S]=Cle({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:a,targetPosition:o}),M=t.isInternal?void 0:e;return g.jsx(nS,{id:M,path:w,labelX:_,labelY:S,label:l,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:x,markerStart:b,interactionWidth:y})})}const dtt=Mle({isInternal:!1}),Ale=Mle({isInternal:!0});dtt.displayName="SimpleBezierEdge";Ale.displayName="SimpleBezierEdgeInternal";function kle(t){return P.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:a,label:s,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:c,labelBgBorderRadius:d,style:h,sourcePosition:f=rn.Bottom,targetPosition:m=rn.Top,markerEnd:x,markerStart:b,pathOptions:y,interactionWidth:w})=>{const[_,S,M]=EN({sourceX:n,sourceY:r,sourcePosition:f,targetX:i,targetY:a,targetPosition:m,borderRadius:y?.borderRadius,offset:y?.offset,stepPosition:y?.stepPosition}),E=t.isInternal?void 0:e;return g.jsx(nS,{id:E,path:_,labelX:S,labelY:M,label:s,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:c,labelBgBorderRadius:d,style:h,markerEnd:x,markerStart:b,interactionWidth:w})})}const Ile=kle({isInternal:!1}),Nle=kle({isInternal:!0});Ile.displayName="SmoothStepEdge";Nle.displayName="SmoothStepEdgeInternal";function Rle(t){return P.memo(({id:e,...n})=>{const r=t.isInternal?void 0:e;return g.jsx(Ile,{...n,id:r,pathOptions:P.useMemo(()=>({borderRadius:0,offset:n.pathOptions?.offset}),[n.pathOptions?.offset])})})}const htt=Rle({isInternal:!1}),Ple=Rle({isInternal:!0});htt.displayName="StepEdge";Ple.displayName="StepEdgeInternal";function Dle(t){return P.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:a,label:s,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:c,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:m,interactionWidth:x})=>{const[b,y,w]=Qoe({sourceX:n,sourceY:r,targetX:i,targetY:a}),_=t.isInternal?void 0:e;return g.jsx(nS,{id:_,path:b,labelX:y,labelY:w,label:s,labelStyle:o,labelShowBg:l,labelBgStyle:u,labelBgPadding:c,labelBgBorderRadius:d,style:h,markerEnd:f,markerStart:m,interactionWidth:x})})}const ftt=Dle({isInternal:!1}),Ole=Dle({isInternal:!0});ftt.displayName="StraightEdge";Ole.displayName="StraightEdgeInternal";function Lle(t){return P.memo(({id:e,sourceX:n,sourceY:r,targetX:i,targetY:a,sourcePosition:s=rn.Bottom,targetPosition:o=rn.Top,label:l,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:x,markerStart:b,pathOptions:y,interactionWidth:w})=>{const[_,S,M]=Zoe({sourceX:n,sourceY:r,sourcePosition:s,targetX:i,targetY:a,targetPosition:o,curvature:y?.curvature}),E=t.isInternal?void 0:e;return g.jsx(nS,{id:E,path:_,labelX:S,labelY:M,label:l,labelStyle:u,labelShowBg:c,labelBgStyle:d,labelBgPadding:h,labelBgBorderRadius:f,style:m,markerEnd:x,markerStart:b,interactionWidth:w})})}const ptt=Lle({isInternal:!1}),Fle=Lle({isInternal:!0});ptt.displayName="BezierEdge";Fle.displayName="BezierEdgeInternal";const C$={default:Fle,straight:Ole,step:Ple,smoothstep:Nle,simplebezier:Ale},M$={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},mtt=(t,e,n)=>n===rn.Left?t-e:n===rn.Right?t+e:t,gtt=(t,e,n)=>n===rn.Top?t-e:n===rn.Bottom?t+e:t,A$="react-flow__edgeupdater";function k$({position:t,centerX:e,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:a,onMouseOut:s,type:o}){return g.jsx("circle",{onMouseDown:i,onMouseEnter:a,onMouseOut:s,className:Gi([A$,`${A$}-${o}`]),cx:mtt(e,r,t),cy:gtt(n,r,t),r,stroke:"transparent",fill:"transparent"})}function vtt({isReconnectable:t,reconnectRadius:e,edge:n,sourceX:r,sourceY:i,targetX:a,targetY:s,sourcePosition:o,targetPosition:l,onReconnect:u,onReconnectStart:c,onReconnectEnd:d,setReconnecting:h,setUpdateHover:f}){const m=ti(),x=(S,M)=>{if(S.button!==0)return;const{autoPanOnConnect:E,domNode:C,isValidConnection:R,connectionMode:k,connectionRadius:I,lib:N,onConnectStart:D,onConnectEnd:F,cancelConnection:L,nodeLookup:U,rfId:j,panBy:q,updateConnection:Z}=m.getState(),Q=M.type==="target",z=(H,J)=>{h(!1),d?.(H,n,M.type,J)},W=H=>u?.(n,H),X=(H,J)=>{h(!0),c?.(S,n,M.type),D?.(H,J)};MN.onPointerDown(S.nativeEvent,{autoPanOnConnect:E,connectionMode:k,connectionRadius:I,domNode:C,handleId:M.id,nodeId:M.nodeId,nodeLookup:U,isTarget:Q,edgeUpdaterType:M.type,lib:N,flowId:j,cancelConnection:L,panBy:q,isValidConnection:R,onConnect:W,onConnectStart:X,onConnectEnd:F,onReconnectEnd:z,updateConnection:Z,getTransform:()=>m.getState().transform,getFromHandle:()=>m.getState().connection.fromHandle,dragThreshold:m.getState().connectionDragThreshold,handleDomNode:S.currentTarget})},b=S=>x(S,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),y=S=>x(S,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),w=()=>f(!0),_=()=>f(!1);return g.jsxs(g.Fragment,{children:[(t===!0||t==="source")&&g.jsx(k$,{position:o,centerX:r,centerY:i,radius:e,onMouseDown:b,onMouseEnter:w,onMouseOut:_,type:"source"}),(t===!0||t==="target")&&g.jsx(k$,{position:l,centerX:a,centerY:s,radius:e,onMouseDown:y,onMouseEnter:w,onMouseOut:_,type:"target"})]})}function ytt({id:t,edgesFocusable:e,edgesReconnectable:n,elementsSelectable:r,onClick:i,onDoubleClick:a,onContextMenu:s,onMouseEnter:o,onMouseMove:l,onMouseLeave:u,reconnectRadius:c,onReconnect:d,onReconnectStart:h,onReconnectEnd:f,rfId:m,edgeTypes:x,noPanClassName:b,onError:y,disableKeyboardA11y:w}){let _=rr(be=>be.edgeLookup.get(t));const S=rr(be=>be.defaultEdgeOptions);_=S?{...S,..._}:_;let M=_.type||"default",E=x?.[M]||C$[M];E===void 0&&(y?.("011",Gl.error011(M)),M="default",E=x?.default||C$.default);const C=!!(_.focusable||e&&typeof _.focusable>"u"),R=typeof d<"u"&&(_.reconnectable||n&&typeof _.reconnectable>"u"),k=!!(_.selectable||r&&typeof _.selectable>"u"),I=P.useRef(null),[N,D]=P.useState(!1),[F,L]=P.useState(!1),U=ti(),{zIndex:j,sourceX:q,sourceY:Z,targetX:Q,targetY:z,sourcePosition:W,targetPosition:X}=rr(P.useCallback(be=>{const De=be.nodeLookup.get(_.source),ke=be.nodeLookup.get(_.target);if(!De||!ke)return{zIndex:_.zIndex,...M$};const Me=fQe({id:t,sourceNode:De,targetNode:ke,sourceHandle:_.sourceHandle||null,targetHandle:_.targetHandle||null,connectionMode:be.connectionMode,onError:y});return{zIndex:aQe({selected:_.selected,zIndex:_.zIndex,sourceNode:De,targetNode:ke,elevateOnSelect:be.elevateEdgesOnSelect,zIndexMode:be.zIndexMode}),...Me||M$}},[_.source,_.target,_.sourceHandle,_.targetHandle,_.selected,_.zIndex]),Zr),H=P.useMemo(()=>_.markerStart?`url('#${TN(_.markerStart,m)}')`:void 0,[_.markerStart,m]),J=P.useMemo(()=>_.markerEnd?`url('#${TN(_.markerEnd,m)}')`:void 0,[_.markerEnd,m]);if(_.hidden||q===null||Z===null||Q===null||z===null)return null;const te=be=>{const{addSelectedEdges:De,unselectNodesAndEdges:ke,multiSelectionActive:Me}=U.getState();k&&(U.setState({nodesSelectionActive:!1}),_.selected&&Me?(ke({nodes:[],edges:[_]}),I.current?.blur()):De([t])),i&&i(be,_)},ee=a?be=>{a(be,{..._})}:void 0,se=s?be=>{s(be,{..._})}:void 0,ue=o?be=>{o(be,{..._})}:void 0,oe=l?be=>{l(be,{..._})}:void 0,Te=u?be=>{u(be,{..._})}:void 0,Ne=be=>{if(!w&&Loe.includes(be.key)&&k){const{unselectNodesAndEdges:De,addSelectedEdges:ke}=U.getState();be.key==="Escape"?(I.current?.blur(),De({edges:[_]})):ke([t])}};return g.jsx("svg",{style:{zIndex:j},children:g.jsxs("g",{className:Gi(["react-flow__edge",`react-flow__edge-${M}`,_.className,b,{selected:_.selected,animated:_.animated,inactive:!k&&!i,updating:N,selectable:k}]),onClick:te,onDoubleClick:ee,onContextMenu:se,onMouseEnter:ue,onMouseMove:oe,onMouseLeave:Te,onKeyDown:C?Ne:void 0,tabIndex:C?0:void 0,role:_.ariaRole??(C?"group":"img"),"aria-roledescription":"edge","data-id":t,"data-testid":`rf__edge-${t}`,"aria-label":_.ariaLabel===null?void 0:_.ariaLabel||`Edge from ${_.source} to ${_.target}`,"aria-describedby":C?`${ple}-${m}`:void 0,ref:I,..._.domAttributes,children:[!F&&g.jsx(E,{id:t,source:_.source,target:_.target,type:_.type,selected:_.selected,animated:_.animated,selectable:k,deletable:_.deletable??!0,label:_.label,labelStyle:_.labelStyle,labelShowBg:_.labelShowBg,labelBgStyle:_.labelBgStyle,labelBgPadding:_.labelBgPadding,labelBgBorderRadius:_.labelBgBorderRadius,sourceX:q,sourceY:Z,targetX:Q,targetY:z,sourcePosition:W,targetPosition:X,data:_.data,style:_.style,sourceHandleId:_.sourceHandle,targetHandleId:_.targetHandle,markerStart:H,markerEnd:J,pathOptions:"pathOptions"in _?_.pathOptions:void 0,interactionWidth:_.interactionWidth}),R&&g.jsx(vtt,{edge:_,isReconnectable:R,reconnectRadius:c,onReconnect:d,onReconnectStart:h,onReconnectEnd:f,sourceX:q,sourceY:Z,targetX:Q,targetY:z,sourcePosition:W,targetPosition:X,setUpdateHover:D,setReconnecting:L})]})})}var xtt=P.memo(ytt);const btt=t=>({edgesFocusable:t.edgesFocusable,edgesReconnectable:t.edgesReconnectable,elementsSelectable:t.elementsSelectable,connectionMode:t.connectionMode,onError:t.onError});function Ble({defaultMarkerColor:t,onlyRenderVisibleElements:e,rfId:n,edgeTypes:r,noPanClassName:i,onReconnect:a,onEdgeContextMenu:s,onEdgeMouseEnter:o,onEdgeMouseMove:l,onEdgeMouseLeave:u,onEdgeClick:c,reconnectRadius:d,onEdgeDoubleClick:h,onReconnectStart:f,onReconnectEnd:m,disableKeyboardA11y:x}){const{edgesFocusable:b,edgesReconnectable:y,elementsSelectable:w,onError:_}=rr(btt,Zr),S=itt(e);return g.jsxs("div",{className:"react-flow__edges",children:[g.jsx(utt,{defaultColor:t,rfId:n}),S.map(M=>g.jsx(xtt,{id:M,edgesFocusable:b,edgesReconnectable:y,elementsSelectable:w,noPanClassName:i,onReconnect:a,onContextMenu:s,onMouseEnter:o,onMouseMove:l,onMouseLeave:u,onClick:c,reconnectRadius:d,onDoubleClick:h,onReconnectStart:f,onReconnectEnd:m,rfId:n,onError:_,edgeTypes:r,disableKeyboardA11y:x},M))]})}Ble.displayName="EdgeRenderer";const _tt=P.memo(Ble),wtt=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function Stt({children:t}){const e=rr(wtt);return g.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:e},children:t})}function Ett(t){const e=G7(),n=P.useRef(!1);P.useEffect(()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout(()=>t(e),1),n.current=!0)},[t,e.viewportInitialized])}const Ttt=t=>t.panZoom?.syncViewport;function Ctt(t){const e=rr(Ttt),n=ti();return P.useEffect(()=>{t&&(e?.(t),n.setState({transform:[t.x,t.y,t.zoom]}))},[t,e]),null}function Mtt(t){return t.connection.inProgress?{...t.connection,to:Zv(t.connection.to,t.transform)}:{...t.connection}}function Att(t){return Mtt}function ktt(t){const e=Att();return rr(e,Zr)}const Itt=t=>({nodesConnectable:t.nodesConnectable,isValid:t.connection.isValid,inProgress:t.connection.inProgress,width:t.width,height:t.height});function Ntt({containerStyle:t,style:e,type:n,component:r}){const{nodesConnectable:i,width:a,height:s,isValid:o,inProgress:l}=rr(Itt,Zr);return!(a&&i&&l)?null:g.jsx("svg",{style:t,width:a,height:s,className:"react-flow__connectionline react-flow__container",children:g.jsx("g",{className:Gi(["react-flow__connection",Uoe(o)]),children:g.jsx(Ule,{style:e,type:n,CustomComponent:r,isValid:o})})})}const Ule=({style:t,type:e=$c.Bezier,CustomComponent:n,isValid:r})=>{const{inProgress:i,from:a,fromNode:s,fromHandle:o,fromPosition:l,to:u,toNode:c,toHandle:d,toPosition:h,pointer:f}=ktt();if(!i)return;if(n)return g.jsx(n,{connectionLineType:e,connectionLineStyle:t,fromNode:s,fromHandle:o,fromX:a.x,fromY:a.y,toX:u.x,toY:u.y,fromPosition:l,toPosition:h,connectionStatus:Uoe(r),toNode:c,toHandle:d,pointer:f});let m="";const x={sourceX:a.x,sourceY:a.y,sourcePosition:l,targetX:u.x,targetY:u.y,targetPosition:h};switch(e){case $c.Bezier:[m]=Zoe(x);break;case $c.SimpleBezier:[m]=Cle(x);break;case $c.Step:[m]=EN({...x,borderRadius:0});break;case $c.SmoothStep:[m]=EN(x);break;default:[m]=Qoe(x)}return g.jsx("path",{d:m,fill:"none",className:"react-flow__connection-path",style:t})};Ule.displayName="ConnectionLine";const Rtt={};function I$(t=Rtt){P.useRef(t),ti(),P.useEffect(()=>{},[t])}function Ptt(){ti(),P.useRef(!1),P.useEffect(()=>{},[])}function zle({nodeTypes:t,edgeTypes:e,onInit:n,onNodeClick:r,onEdgeClick:i,onNodeDoubleClick:a,onEdgeDoubleClick:s,onNodeMouseEnter:o,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:c,onSelectionContextMenu:d,onSelectionStart:h,onSelectionEnd:f,connectionLineType:m,connectionLineStyle:x,connectionLineComponent:b,connectionLineContainerStyle:y,selectionKeyCode:w,selectionOnDrag:_,selectionMode:S,multiSelectionKeyCode:M,panActivationKeyCode:E,zoomActivationKeyCode:C,deleteKeyCode:R,onlyRenderVisibleElements:k,elementsSelectable:I,defaultViewport:N,translateExtent:D,minZoom:F,maxZoom:L,preventScrolling:U,defaultMarkerColor:j,zoomOnScroll:q,zoomOnPinch:Z,panOnScroll:Q,panOnScrollSpeed:z,panOnScrollMode:W,zoomOnDoubleClick:X,panOnDrag:H,onPaneClick:J,onPaneMouseEnter:te,onPaneMouseMove:ee,onPaneMouseLeave:se,onPaneScroll:ue,onPaneContextMenu:oe,paneClickDistance:Te,nodeClickDistance:Ne,onEdgeContextMenu:be,onEdgeMouseEnter:De,onEdgeMouseMove:ke,onEdgeMouseLeave:Me,reconnectRadius:Ie,onReconnect:ce,onReconnectStart:G,onReconnectEnd:xe,noDragClassName:Oe,noWheelClassName:Fe,noPanClassName:ze,disableKeyboardA11y:le,nodeExtent:re,rfId:me,viewport:de,onViewportChange:ve}){return I$(t),I$(e),Ptt(),Ett(n),Ctt(de),g.jsx(Yet,{onPaneClick:J,onPaneMouseEnter:te,onPaneMouseMove:ee,onPaneMouseLeave:se,onPaneContextMenu:oe,onPaneScroll:ue,paneClickDistance:Te,deleteKeyCode:R,selectionKeyCode:w,selectionOnDrag:_,selectionMode:S,onSelectionStart:h,onSelectionEnd:f,multiSelectionKeyCode:M,panActivationKeyCode:E,zoomActivationKeyCode:C,elementsSelectable:I,zoomOnScroll:q,zoomOnPinch:Z,zoomOnDoubleClick:X,panOnScroll:Q,panOnScrollSpeed:z,panOnScrollMode:W,panOnDrag:H,defaultViewport:N,translateExtent:D,minZoom:F,maxZoom:L,onSelectionContextMenu:d,preventScrolling:U,noDragClassName:Oe,noWheelClassName:Fe,noPanClassName:ze,disableKeyboardA11y:le,onViewportChange:ve,isControlledViewport:!!de,children:g.jsxs(Stt,{children:[g.jsx(_tt,{edgeTypes:e,onEdgeClick:i,onEdgeDoubleClick:s,onReconnect:ce,onReconnectStart:G,onReconnectEnd:xe,onlyRenderVisibleElements:k,onEdgeContextMenu:be,onEdgeMouseEnter:De,onEdgeMouseMove:ke,onEdgeMouseLeave:Me,reconnectRadius:Ie,defaultMarkerColor:j,noPanClassName:ze,disableKeyboardA11y:le,rfId:me}),g.jsx(Ntt,{style:x,type:m,component:b,containerStyle:y}),g.jsx("div",{className:"react-flow__edgelabel-renderer"}),g.jsx(rtt,{nodeTypes:t,onNodeClick:r,onNodeDoubleClick:a,onNodeMouseEnter:o,onNodeMouseMove:l,onNodeMouseLeave:u,onNodeContextMenu:c,nodeClickDistance:Ne,onlyRenderVisibleElements:k,noPanClassName:ze,noDragClassName:Oe,disableKeyboardA11y:le,nodeExtent:re,rfId:me}),g.jsx("div",{className:"react-flow__viewport-portal"})]})})}zle.displayName="GraphView";const Dtt=P.memo(zle),N$=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:a,fitView:s,fitViewOptions:o,minZoom:l=.5,maxZoom:u=2,nodeOrigin:c,nodeExtent:d,zIndexMode:h="basic"}={})=>{const f=new Map,m=new Map,x=new Map,b=new Map,y=r??e??[],w=n??t??[],_=c??[0,0],S=d??sv;nle(x,b,y);const M=CN(w,f,m,{nodeOrigin:_,nodeExtent:S,zIndexMode:h});let E=[0,0,1];if(s&&i&&a){const C=Xv(f,{filter:N=>!!((N.width||N.initialWidth)&&(N.height||N.initialHeight))}),{x:R,y:k,zoom:I}=U7(C,i,a,l,u,o?.padding??.1);E=[R,k,I]}return{rfId:"1",width:i??0,height:a??0,transform:E,nodes:w,nodesInitialized:M,nodeLookup:f,parentLookup:m,edges:y,edgeLookup:b,connectionLookup:x,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:r!==void 0,panZoom:null,minZoom:l,maxZoom:u,translateExtent:sv,nodeExtent:S,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:N0.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:_,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:o,fitViewResolver:null,connection:{...Boe},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:QJe,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Foe,zIndexMode:h,onNodesChangeMiddlewareMap:new Map,onEdgesChangeMiddlewareMap:new Map}},Ott=({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:a,fitView:s,fitViewOptions:o,minZoom:l,maxZoom:u,nodeOrigin:c,nodeExtent:d,zIndexMode:h})=>XQe((f,m)=>{async function x(){const{nodeLookup:b,panZoom:y,fitViewOptions:w,fitViewResolver:_,width:S,height:M,minZoom:E,maxZoom:C}=m();y&&(await ZJe({nodes:b,width:S,height:M,panZoom:y,minZoom:E,maxZoom:C},w),_?.resolve(!0),f({fitViewResolver:null}))}return{...N$({nodes:t,edges:e,width:i,height:a,fitView:s,fitViewOptions:o,minZoom:l,maxZoom:u,nodeOrigin:c,nodeExtent:d,defaultNodes:n,defaultEdges:r,zIndexMode:h}),setNodes:b=>{const{nodeLookup:y,parentLookup:w,nodeOrigin:_,elevateNodesOnSelect:S,fitViewQueued:M,zIndexMode:E}=m(),C=CN(b,y,w,{nodeOrigin:_,nodeExtent:d,elevateNodesOnSelect:S,checkEquality:!0,zIndexMode:E});M&&C?(x(),f({nodes:b,nodesInitialized:C,fitViewQueued:!1,fitViewOptions:void 0})):f({nodes:b,nodesInitialized:C})},setEdges:b=>{const{connectionLookup:y,edgeLookup:w}=m();nle(y,w,b),f({edges:b})},setDefaultNodesAndEdges:(b,y)=>{if(b){const{setNodes:w}=m();w(b),f({hasDefaultNodes:!0})}if(y){const{setEdges:w}=m();w(y),f({hasDefaultEdges:!0})}},updateNodeInternals:b=>{const{triggerNodeChanges:y,nodeLookup:w,parentLookup:_,domNode:S,nodeOrigin:M,nodeExtent:E,debug:C,fitViewQueued:R,zIndexMode:k}=m(),{changes:I,updatedInternals:N}=_Qe(b,w,_,S,M,E,k);N&&(vQe(w,_,{nodeOrigin:M,nodeExtent:E,zIndexMode:k}),R?(x(),f({fitViewQueued:!1,fitViewOptions:void 0})):f({}),I?.length>0&&(C&&console.log("React Flow: trigger node changes",I),y?.(I)))},updateNodePositions:(b,y=!1)=>{const w=[];let _=[];const{nodeLookup:S,triggerNodeChanges:M,connection:E,updateConnection:C,onNodesChangeMiddlewareMap:R}=m();for(const[k,I]of b){const N=S.get(k),D=!!(N?.expandParent&&N?.parentId&&I?.position),F={id:k,type:"position",position:D?{x:Math.max(0,I.position.x),y:Math.max(0,I.position.y)}:I.position,dragging:y};if(N&&E.inProgress&&E.fromNode.id===N.id){const L=hf(N,E.fromHandle,rn.Left,!0);C({...E,from:L})}D&&N.parentId&&w.push({id:k,parentId:N.parentId,rect:{...I.internals.positionAbsolute,width:I.measured.width??0,height:I.measured.height??0}}),_.push(F)}if(w.length>0){const{parentLookup:k,nodeOrigin:I}=m(),N=q7(w,S,k,I);_.push(...N)}for(const k of R.values())_=k(_);M(_)},triggerNodeChanges:b=>{const{onNodesChange:y,setNodes:w,nodes:_,hasDefaultNodes:S,debug:M}=m();if(b?.length){if(S){const E=vet(b,_);w(E)}M&&console.log("React Flow: trigger node changes",b),y?.(b)}},triggerEdgeChanges:b=>{const{onEdgesChange:y,setEdges:w,edges:_,hasDefaultEdges:S,debug:M}=m();if(b?.length){if(S){const E=yet(b,_);w(E)}M&&console.log("React Flow: trigger edge changes",b),y?.(b)}},addSelectedNodes:b=>{const{multiSelectionActive:y,edgeLookup:w,nodeLookup:_,triggerNodeChanges:S,triggerEdgeChanges:M}=m();if(y){const E=b.map(C=>yh(C,!0));S(E);return}S(Kp(_,new Set([...b]),!0)),M(Kp(w))},addSelectedEdges:b=>{const{multiSelectionActive:y,edgeLookup:w,nodeLookup:_,triggerNodeChanges:S,triggerEdgeChanges:M}=m();if(y){const E=b.map(C=>yh(C,!0));M(E);return}M(Kp(w,new Set([...b]))),S(Kp(_,new Set,!0))},unselectNodesAndEdges:({nodes:b,edges:y}={})=>{const{edges:w,nodes:_,nodeLookup:S,triggerNodeChanges:M,triggerEdgeChanges:E}=m(),C=b||_,R=y||w,k=C.map(N=>{const D=S.get(N.id);return D&&(D.selected=!1),yh(N.id,!1)}),I=R.map(N=>yh(N.id,!1));M(k),E(I)},setMinZoom:b=>{const{panZoom:y,maxZoom:w}=m();y?.setScaleExtent([b,w]),f({minZoom:b})},setMaxZoom:b=>{const{panZoom:y,minZoom:w}=m();y?.setScaleExtent([w,b]),f({maxZoom:b})},setTranslateExtent:b=>{m().panZoom?.setTranslateExtent(b),f({translateExtent:b})},resetSelectedElements:()=>{const{edges:b,nodes:y,triggerNodeChanges:w,triggerEdgeChanges:_,elementsSelectable:S}=m();if(!S)return;const M=y.reduce((C,R)=>R.selected?[...C,yh(R.id,!1)]:C,[]),E=b.reduce((C,R)=>R.selected?[...C,yh(R.id,!1)]:C,[]);w(M),_(E)},setNodeExtent:b=>{const{nodes:y,nodeLookup:w,parentLookup:_,nodeOrigin:S,elevateNodesOnSelect:M,nodeExtent:E,zIndexMode:C}=m();b[0][0]===E[0][0]&&b[0][1]===E[0][1]&&b[1][0]===E[1][0]&&b[1][1]===E[1][1]||(CN(y,w,_,{nodeOrigin:S,nodeExtent:b,elevateNodesOnSelect:M,checkEquality:!1,zIndexMode:C}),f({nodeExtent:b}))},panBy:b=>{const{transform:y,width:w,height:_,panZoom:S,translateExtent:M}=m();return wQe({delta:b,panZoom:S,transform:y,translateExtent:M,width:w,height:_})},setCenter:async(b,y,w)=>{const{width:_,height:S,maxZoom:M,panZoom:E}=m();if(!E)return Promise.resolve(!1);const C=typeof w?.zoom<"u"?w.zoom:M;return await E.setViewport({x:_/2-b*C,y:S/2-y*C,zoom:C},{duration:w?.duration,ease:w?.ease,interpolate:w?.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{f({connection:{...Boe}})},updateConnection:b=>{f({connection:b})},reset:()=>f({...N$()})}},Object.is);function Ltt({initialNodes:t,initialEdges:e,defaultNodes:n,defaultEdges:r,initialWidth:i,initialHeight:a,initialMinZoom:s,initialMaxZoom:o,initialFitViewOptions:l,fitView:u,nodeOrigin:c,nodeExtent:d,zIndexMode:h,children:f}){const[m]=P.useState(()=>Ott({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,width:i,height:a,fitView:u,minZoom:s,maxZoom:o,fitViewOptions:l,nodeOrigin:c,nodeExtent:d,zIndexMode:h}));return g.jsx(KQe,{value:m,children:g.jsx(wet,{children:f})})}function Ftt({children:t,nodes:e,edges:n,defaultNodes:r,defaultEdges:i,width:a,height:s,fitView:o,fitViewOptions:l,minZoom:u,maxZoom:c,nodeOrigin:d,nodeExtent:h,zIndexMode:f}){return P.useContext(Q3)?g.jsx(g.Fragment,{children:t}):g.jsx(Ltt,{initialNodes:e,initialEdges:n,defaultNodes:r,defaultEdges:i,initialWidth:a,initialHeight:s,fitView:o,initialFitViewOptions:l,initialMinZoom:u,initialMaxZoom:c,nodeOrigin:d,nodeExtent:h,zIndexMode:f,children:t})}const Btt={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function Utt({nodes:t,edges:e,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:a,edgeTypes:s,onNodeClick:o,onEdgeClick:l,onInit:u,onMove:c,onMoveStart:d,onMoveEnd:h,onConnect:f,onConnectStart:m,onConnectEnd:x,onClickConnectStart:b,onClickConnectEnd:y,onNodeMouseEnter:w,onNodeMouseMove:_,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,onNodeDragStart:C,onNodeDrag:R,onNodeDragStop:k,onNodesDelete:I,onEdgesDelete:N,onDelete:D,onSelectionChange:F,onSelectionDragStart:L,onSelectionDrag:U,onSelectionDragStop:j,onSelectionContextMenu:q,onSelectionStart:Z,onSelectionEnd:Q,onBeforeDelete:z,connectionMode:W,connectionLineType:X=$c.Bezier,connectionLineStyle:H,connectionLineComponent:J,connectionLineContainerStyle:te,deleteKeyCode:ee="Backspace",selectionKeyCode:se="Shift",selectionOnDrag:ue=!1,selectionMode:oe=ov.Full,panActivationKeyCode:Te="Space",multiSelectionKeyCode:Ne=uv()?"Meta":"Control",zoomActivationKeyCode:be=uv()?"Meta":"Control",snapToGrid:De,snapGrid:ke,onlyRenderVisibleElements:Me=!1,selectNodesOnDrag:Ie,nodesDraggable:ce,autoPanOnNodeFocus:G,nodesConnectable:xe,nodesFocusable:Oe,nodeOrigin:Fe=mle,edgesFocusable:ze,edgesReconnectable:le,elementsSelectable:re=!0,defaultViewport:me=cet,minZoom:de=.5,maxZoom:ve=2,translateExtent:_e=sv,preventScrolling:Be=!0,nodeExtent:He,defaultMarkerColor:pt="#b1b1b7",zoomOnScroll:gt=!0,zoomOnPinch:We=!0,panOnScroll:Je=!1,panOnScrollSpeed:ot=.5,panOnScrollMode:Ee=qh.Free,zoomOnDoubleClick:je=!0,panOnDrag:mt=!0,onPaneClick:fe,onPaneMouseEnter:$e,onPaneMouseMove:Ge,onPaneMouseLeave:st,onPaneScroll:Qe,onPaneContextMenu:Ye,paneClickDistance:ft=1,nodeClickDistance:Ct=0,children:At,onReconnect:Ht,onReconnectStart:wn,onReconnectEnd:Vt,onEdgeContextMenu:En,onEdgeDoubleClick:kr,onEdgeMouseEnter:Yi,onEdgeMouseMove:ki,onEdgeMouseLeave:Gr,reconnectRadius:pi=10,onNodesChange:fr,onEdgesChange:Tr,noDragClassName:Wr="nodrag",noWheelClassName:Ha="nowheel",noPanClassName:Ir="nopan",fitView:Ii,fitViewOptions:mi,connectOnClick:Ur,attributionPosition:$a,proOptions:Kt,defaultEdgeOptions:yr,elevateNodesOnSelect:la=!0,elevateEdgesOnSelect:ba=!1,disableKeyboardA11y:_a=!1,autoPanOnConnect:Pt,autoPanOnNodeDrag:ge,autoPanSpeed:qe,connectionRadius:Xe,isValidConnection:nt,onError:Ke,style:St,id:Lt,nodeDragThreshold:yt,connectionDragThreshold:$t,viewport:Gt,onViewportChange:nn,width:Qt,height:_n,colorMode:Dn="light",debug:lr,onScroll:qn,ariaLabelConfig:mn,zIndexMode:Dt="basic",...On},cn){const Yr=Lt||"1",ua=pet(Dn),pr=P.useCallback(wa=>{wa.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),qn?.(wa)},[qn]);return g.jsx("div",{"data-testid":"rf__wrapper",...On,onScroll:pr,style:{...St,...Btt},ref:cn,className:Gi(["react-flow",i,ua]),id:Lt,role:"application",children:g.jsxs(Ftt,{nodes:t,edges:e,width:Qt,height:_n,fitView:Ii,fitViewOptions:mi,minZoom:de,maxZoom:ve,nodeOrigin:Fe,nodeExtent:He,zIndexMode:Dt,children:[g.jsx(Dtt,{onInit:u,onNodeClick:o,onEdgeClick:l,onNodeMouseEnter:w,onNodeMouseMove:_,onNodeMouseLeave:S,onNodeContextMenu:M,onNodeDoubleClick:E,nodeTypes:a,edgeTypes:s,connectionLineType:X,connectionLineStyle:H,connectionLineComponent:J,connectionLineContainerStyle:te,selectionKeyCode:se,selectionOnDrag:ue,selectionMode:oe,deleteKeyCode:ee,multiSelectionKeyCode:Ne,panActivationKeyCode:Te,zoomActivationKeyCode:be,onlyRenderVisibleElements:Me,defaultViewport:me,translateExtent:_e,minZoom:de,maxZoom:ve,preventScrolling:Be,zoomOnScroll:gt,zoomOnPinch:We,zoomOnDoubleClick:je,panOnScroll:Je,panOnScrollSpeed:ot,panOnScrollMode:Ee,panOnDrag:mt,onPaneClick:fe,onPaneMouseEnter:$e,onPaneMouseMove:Ge,onPaneMouseLeave:st,onPaneScroll:Qe,onPaneContextMenu:Ye,paneClickDistance:ft,nodeClickDistance:Ct,onSelectionContextMenu:q,onSelectionStart:Z,onSelectionEnd:Q,onReconnect:Ht,onReconnectStart:wn,onReconnectEnd:Vt,onEdgeContextMenu:En,onEdgeDoubleClick:kr,onEdgeMouseEnter:Yi,onEdgeMouseMove:ki,onEdgeMouseLeave:Gr,reconnectRadius:pi,defaultMarkerColor:pt,noDragClassName:Wr,noWheelClassName:Ha,noPanClassName:Ir,rfId:Yr,disableKeyboardA11y:_a,nodeExtent:He,viewport:Gt,onViewportChange:nn}),g.jsx(fet,{nodes:t,edges:e,defaultNodes:n,defaultEdges:r,onConnect:f,onConnectStart:m,onConnectEnd:x,onClickConnectStart:b,onClickConnectEnd:y,nodesDraggable:ce,autoPanOnNodeFocus:G,nodesConnectable:xe,nodesFocusable:Oe,edgesFocusable:ze,edgesReconnectable:le,elementsSelectable:re,elevateNodesOnSelect:la,elevateEdgesOnSelect:ba,minZoom:de,maxZoom:ve,nodeExtent:He,onNodesChange:fr,onEdgesChange:Tr,snapToGrid:De,snapGrid:ke,connectionMode:W,translateExtent:_e,connectOnClick:Ur,defaultEdgeOptions:yr,fitView:Ii,fitViewOptions:mi,onNodesDelete:I,onEdgesDelete:N,onDelete:D,onNodeDragStart:C,onNodeDrag:R,onNodeDragStop:k,onSelectionDrag:U,onSelectionDragStart:L,onSelectionDragStop:j,onMove:c,onMoveStart:d,onMoveEnd:h,noPanClassName:Ir,nodeOrigin:Fe,rfId:Yr,autoPanOnConnect:Pt,autoPanOnNodeDrag:ge,autoPanSpeed:qe,onError:Ke,connectionRadius:Xe,isValidConnection:nt,selectNodesOnDrag:Ie,nodeDragThreshold:yt,connectionDragThreshold:$t,onBeforeDelete:z,debug:lr,ariaLabelConfig:mn,zIndexMode:Dt}),g.jsx(uet,{onSelectionChange:F}),At,g.jsx(ret,{proOptions:Kt,position:$a}),g.jsx(net,{rfId:Yr,disableKeyboardA11y:_a})]})})}var Jv=vle(Utt);function ztt({dimensions:t,lineWidth:e,variant:n,className:r}){return g.jsx("path",{strokeWidth:e,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`,className:Gi(["react-flow__background-pattern",n,r])})}function jtt({radius:t,className:e}){return g.jsx("circle",{cx:t,cy:t,r:t,className:Gi(["react-flow__background-pattern","dots",e])})}var Jc;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(Jc||(Jc={}));const Htt={[Jc.Dots]:1,[Jc.Lines]:1,[Jc.Cross]:6},$tt=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function jle({id:t,variant:e=Jc.Dots,gap:n=20,size:r,lineWidth:i=1,offset:a=0,color:s,bgColor:o,style:l,className:u,patternClassName:c}){const d=P.useRef(null),{transform:h,patternId:f}=rr($tt,Zr),m=r||Htt[e],x=e===Jc.Dots,b=e===Jc.Cross,y=Array.isArray(n)?n:[n,n],w=[y[0]*h[2]||1,y[1]*h[2]||1],_=m*h[2],S=Array.isArray(a)?a:[a,a],M=b?[_,_]:w,E=[S[0]*h[2]||1+M[0]/2,S[1]*h[2]||1+M[1]/2],C=`${f}${t||""}`;return g.jsxs("svg",{className:Gi(["react-flow__background",u]),style:{...l,...tS,"--xy-background-color-props":o,"--xy-background-pattern-color-props":s},ref:d,"data-testid":"rf__background",children:[g.jsx("pattern",{id:C,x:h[0]%w[0],y:h[1]%w[1],width:w[0],height:w[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:x?g.jsx(jtt,{radius:_/2,className:c}):g.jsx(ztt,{dimensions:M,lineWidth:i,variant:e,className:c})}),g.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${C})`})]})}jle.displayName="Background";const Qv=P.memo(jle);function Vtt(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:g.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function qtt(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:g.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Gtt(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:g.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Wtt(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:g.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Ytt(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:g.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Pb({children:t,className:e,...n}){return g.jsx("button",{type:"button",className:Gi(["react-flow__controls-button",e]),...n,children:t})}const Xtt=t=>({isInteractive:t.nodesDraggable||t.nodesConnectable||t.elementsSelectable,minZoomReached:t.transform[2]<=t.minZoom,maxZoomReached:t.transform[2]>=t.maxZoom,ariaLabelConfig:t.ariaLabelConfig});function Hle({style:t,showZoom:e=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:a,onZoomOut:s,onFitView:o,onInteractiveChange:l,className:u,children:c,position:d="bottom-left",orientation:h="vertical","aria-label":f}){const m=ti(),{isInteractive:x,minZoomReached:b,maxZoomReached:y,ariaLabelConfig:w}=rr(Xtt,Zr),{zoomIn:_,zoomOut:S,fitView:M}=G7(),E=()=>{_(),a?.()},C=()=>{S(),s?.()},R=()=>{M(i),o?.()},k=()=>{m.setState({nodesDraggable:!x,nodesConnectable:!x,elementsSelectable:!x}),l?.(!x)},I=h==="horizontal"?"horizontal":"vertical";return g.jsxs(eS,{className:Gi(["react-flow__controls",I,u]),position:d,style:t,"data-testid":"rf__controls","aria-label":f??w["controls.ariaLabel"],children:[e&&g.jsxs(g.Fragment,{children:[g.jsx(Pb,{onClick:E,className:"react-flow__controls-zoomin",title:w["controls.zoomIn.ariaLabel"],"aria-label":w["controls.zoomIn.ariaLabel"],disabled:y,children:g.jsx(Vtt,{})}),g.jsx(Pb,{onClick:C,className:"react-flow__controls-zoomout",title:w["controls.zoomOut.ariaLabel"],"aria-label":w["controls.zoomOut.ariaLabel"],disabled:b,children:g.jsx(qtt,{})})]}),n&&g.jsx(Pb,{className:"react-flow__controls-fitview",onClick:R,title:w["controls.fitView.ariaLabel"],"aria-label":w["controls.fitView.ariaLabel"],children:g.jsx(Gtt,{})}),r&&g.jsx(Pb,{className:"react-flow__controls-interactive",onClick:k,title:w["controls.interactive.ariaLabel"],"aria-label":w["controls.interactive.ariaLabel"],children:x?g.jsx(Ytt,{}):g.jsx(Wtt,{})}),c]})}Hle.displayName="Controls";const ey=P.memo(Hle);function Ktt({id:t,x:e,y:n,width:r,height:i,style:a,color:s,strokeColor:o,strokeWidth:l,className:u,borderRadius:c,shapeRendering:d,selected:h,onClick:f}){const{background:m,backgroundColor:x}=a||{},b=s||m||x;return g.jsx("rect",{className:Gi(["react-flow__minimap-node",{selected:h},u]),x:e,y:n,rx:c,ry:c,width:r,height:i,style:{fill:b,stroke:o,strokeWidth:l},shapeRendering:d,onClick:f?y=>f(y,t):void 0})}const Ztt=P.memo(Ktt),Jtt=t=>t.nodes.map(e=>e.id),u5=t=>t instanceof Function?t:()=>t;function Qtt({nodeStrokeColor:t,nodeColor:e,nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:i,nodeComponent:a=Ztt,onClick:s}){const o=rr(Jtt,Zr),l=u5(e),u=u5(t),c=u5(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return g.jsx(g.Fragment,{children:o.map(h=>g.jsx(tnt,{id:h,nodeColorFunc:l,nodeStrokeColorFunc:u,nodeClassNameFunc:c,nodeBorderRadius:r,nodeStrokeWidth:i,NodeComponent:a,onClick:s,shapeRendering:d},h))})}function ent({id:t,nodeColorFunc:e,nodeStrokeColorFunc:n,nodeClassNameFunc:r,nodeBorderRadius:i,nodeStrokeWidth:a,shapeRendering:s,NodeComponent:o,onClick:l}){const{node:u,x:c,y:d,width:h,height:f}=rr(m=>{const{internals:x}=m.nodeLookup.get(t),b=x.userNode,{x:y,y:w}=x.positionAbsolute,{width:_,height:S}=Ju(b);return{node:b,x:y,y:w,width:_,height:S}},Zr);return!u||u.hidden||!qoe(u)?null:g.jsx(o,{x:c,y:d,width:h,height:f,style:u.style,selected:!!u.selected,className:r(u),color:e(u),borderRadius:i,strokeColor:n(u),strokeWidth:a,shapeRendering:s,onClick:l,id:u.id})}const tnt=P.memo(ent);var nnt=P.memo(Qtt);const rnt=200,int=150,ant=t=>!t.hidden,snt=t=>{const e={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:e,boundingRect:t.nodeLookup.size>0?Voe(Xv(t.nodeLookup,{filter:ant}),e):e,rfId:t.rfId,panZoom:t.panZoom,translateExtent:t.translateExtent,flowWidth:t.width,flowHeight:t.height,ariaLabelConfig:t.ariaLabelConfig}},ont="react-flow__minimap-desc";function $le({style:t,className:e,nodeStrokeColor:n,nodeColor:r,nodeClassName:i="",nodeBorderRadius:a=5,nodeStrokeWidth:s,nodeComponent:o,bgColor:l,maskColor:u,maskStrokeColor:c,maskStrokeWidth:d,position:h="bottom-right",onClick:f,onNodeClick:m,pannable:x=!1,zoomable:b=!1,ariaLabel:y,inversePan:w,zoomStep:_=1,offsetScale:S=5}){const M=ti(),E=P.useRef(null),{boundingRect:C,viewBB:R,rfId:k,panZoom:I,translateExtent:N,flowWidth:D,flowHeight:F,ariaLabelConfig:L}=rr(snt,Zr),U=t?.width??rnt,j=t?.height??int,q=C.width/U,Z=C.height/j,Q=Math.max(q,Z),z=Q*U,W=Q*j,X=S*Q,H=C.x-(z-C.width)/2-X,J=C.y-(W-C.height)/2-X,te=z+X*2,ee=W+X*2,se=`${ont}-${k}`,ue=P.useRef(0),oe=P.useRef();ue.current=Q,P.useEffect(()=>{if(E.current&&I)return oe.current=NQe({domNode:E.current,panZoom:I,getTransform:()=>M.getState().transform,getViewScale:()=>ue.current}),()=>{oe.current?.destroy()}},[I]),P.useEffect(()=>{oe.current?.update({translateExtent:N,width:D,height:F,inversePan:w,pannable:x,zoomStep:_,zoomable:b})},[x,b,w,_,N,D,F]);const Te=f?De=>{const[ke,Me]=oe.current?.pointer(De)||[0,0];f(De,{x:ke,y:Me})}:void 0,Ne=m?P.useCallback((De,ke)=>{const Me=M.getState().nodeLookup.get(ke).internals.userNode;m(De,Me)},[]):void 0,be=y??L["minimap.ariaLabel"];return g.jsx(eS,{position:h,style:{...t,"--xy-minimap-background-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-stroke-color-props":typeof c=="string"?c:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*Q:void 0,"--xy-minimap-node-background-color-props":typeof r=="string"?r:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof s=="number"?s:void 0},className:Gi(["react-flow__minimap",e]),"data-testid":"rf__minimap",children:g.jsxs("svg",{width:U,height:j,viewBox:`${H} ${J} ${te} ${ee}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":se,ref:E,onClick:Te,children:[be&&g.jsx("title",{id:se,children:be}),g.jsx(nnt,{onClick:Ne,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:a,nodeClassName:i,nodeStrokeWidth:s,nodeComponent:o}),g.jsx("path",{className:"react-flow__minimap-mask",d:`M${H-X},${J-X}h${te+X*2}v${ee+X*2}h${-te-X*2}z
        M${R.x},${R.y}h${R.width}v${R.height}h${-R.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}$le.displayName="MiniMap";const ty=P.memo($le),lnt=t=>e=>t?`${Math.max(1/e.transform[2],1)}`:void 0,unt={[O0.Line]:"right",[O0.Handle]:"bottom-right"};function cnt({nodeId:t,position:e,variant:n=O0.Handle,className:r,style:i=void 0,children:a,color:s,minWidth:o=10,minHeight:l=10,maxWidth:u=Number.MAX_VALUE,maxHeight:c=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:h,autoScale:f=!0,shouldResize:m,onResizeStart:x,onResize:b,onResizeEnd:y}){const w=_le(),_=typeof t=="string"?t:w,S=ti(),M=P.useRef(null),E=n===O0.Handle,C=rr(P.useCallback(lnt(E&&f),[E,f]),Zr),R=P.useRef(null),k=e??unt[n];P.useEffect(()=>{if(!(!M.current||!_))return R.current||(R.current=qQe({domNode:M.current,nodeId:_,getStoreItems:()=>{const{nodeLookup:N,transform:D,snapGrid:F,snapToGrid:L,nodeOrigin:U,domNode:j}=S.getState();return{nodeLookup:N,transform:D,snapGrid:F,snapToGrid:L,nodeOrigin:U,paneDomNode:j}},onChange:(N,D)=>{const{triggerNodeChanges:F,nodeLookup:L,parentLookup:U,nodeOrigin:j}=S.getState(),q=[],Z={x:N.x,y:N.y},Q=L.get(_);if(Q&&Q.expandParent&&Q.parentId){const z=Q.origin??j,W=N.width??Q.measured.width??0,X=N.height??Q.measured.height??0,H={id:Q.id,parentId:Q.parentId,rect:{width:W,height:X,...Goe({x:N.x??Q.position.x,y:N.y??Q.position.y},{width:W,height:X},Q.parentId,L,z)}},J=q7([H],L,U,j);q.push(...J),Z.x=N.x?Math.max(z[0]*W,N.x):void 0,Z.y=N.y?Math.max(z[1]*X,N.y):void 0}if(Z.x!==void 0&&Z.y!==void 0){const z={id:_,type:"position",position:{...Z}};q.push(z)}if(N.width!==void 0&&N.height!==void 0){const W={id:_,type:"dimensions",resizing:!0,setAttributes:h?h==="horizontal"?"width":"height":!0,dimensions:{width:N.width,height:N.height}};q.push(W)}for(const z of D){const W={...z,type:"position"};q.push(W)}F(q)},onEnd:({width:N,height:D})=>{const F={id:_,type:"dimensions",resizing:!1,dimensions:{width:N,height:D}};S.getState().triggerNodeChanges([F])}})),R.current.update({controlPosition:k,boundaries:{minWidth:o,minHeight:l,maxWidth:u,maxHeight:c},keepAspectRatio:d,resizeDirection:h,onResizeStart:x,onResize:b,onResizeEnd:y,shouldResize:m}),()=>{R.current?.destroy()}},[k,o,l,u,c,d,x,b,y,m]);const I=k.split("-");return g.jsx("div",{className:Gi(["react-flow__resize-control","nodrag",...I,n,r]),ref:M,style:{...i,scale:C,...s&&{[E?"backgroundColor":"borderColor"]:s}},children:a})}P.memo(cnt);function Y7(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var c5,R$;function dnt(){if(R$)return c5;R$=1;function t(){this.__data__=[],this.size=0}return c5=t,c5}var d5,P$;function nm(){if(P$)return d5;P$=1;function t(e,n){return e===n||e!==e&&n!==n}return d5=t,d5}var h5,D$;function rS(){if(D$)return h5;D$=1;var t=nm();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return h5=e,h5}var f5,O$;function hnt(){if(O$)return f5;O$=1;var t=rS(),e=Array.prototype,n=e.splice;function r(i){var a=this.__data__,s=t(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():n.call(a,s,1),--this.size,!0}return f5=r,f5}var p5,L$;function fnt(){if(L$)return p5;L$=1;var t=rS();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return p5=e,p5}var m5,F$;function pnt(){if(F$)return m5;F$=1;var t=rS();function e(n){return t(this.__data__,n)>-1}return m5=e,m5}var g5,B$;function mnt(){if(B$)return g5;B$=1;var t=rS();function e(n,r){var i=this.__data__,a=t(i,n);return a<0?(++this.size,i.push([n,r])):i[a][1]=r,this}return g5=e,g5}var v5,U$;function iS(){if(U$)return v5;U$=1;var t=dnt(),e=hnt(),n=fnt(),r=pnt(),i=mnt();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=i,v5=a,v5}var y5,z$;function gnt(){if(z$)return y5;z$=1;var t=iS();function e(){this.__data__=new t,this.size=0}return y5=e,y5}var x5,j$;function vnt(){if(j$)return x5;j$=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return x5=t,x5}var b5,H$;function ynt(){if(H$)return b5;H$=1;function t(e){return this.__data__.get(e)}return b5=t,b5}var _5,$$;function xnt(){if($$)return _5;$$=1;function t(e){return this.__data__.has(e)}return _5=t,_5}var w5,V$;function Vle(){if(V$)return w5;V$=1;var t=typeof Yy=="object"&&Yy&&Yy.Object===Object&&Yy;return w5=t,w5}var S5,q$;function cl(){if(q$)return S5;q$=1;var t=Vle(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return S5=n,S5}var E5,G$;function rm(){if(G$)return E5;G$=1;var t=cl(),e=t.Symbol;return E5=e,E5}var T5,W$;function bnt(){if(W$)return T5;W$=1;var t=rm(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function a(s){var o=n.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=r.call(s);return u&&(o?s[i]=l:delete s[i]),c}return T5=a,T5}var C5,Y$;function _nt(){if(Y$)return C5;Y$=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return C5=n,C5}var M5,X$;function Cf(){if(X$)return M5;X$=1;var t=rm(),e=bnt(),n=_nt(),r="[object Null]",i="[object Undefined]",a=t?t.toStringTag:void 0;function s(o){return o==null?o===void 0?i:r:a&&a in Object(o)?e(o):n(o)}return M5=s,M5}var A5,K$;function Co(){if(K$)return A5;K$=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return A5=t,A5}var k5,Z$;function ny(){if(Z$)return k5;Z$=1;var t=Cf(),e=Co(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=t(o);return l==r||l==i||l==n||l==a}return k5=s,k5}var I5,J$;function wnt(){if(J$)return I5;J$=1;var t=cl(),e=t["__core-js_shared__"];return I5=e,I5}var N5,Q$;function Snt(){if(Q$)return N5;Q$=1;var t=wnt(),e=(function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""})();function n(r){return!!e&&e in r}return N5=n,N5}var R5,eV;function qle(){if(eV)return R5;eV=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return R5=n,R5}var P5,tV;function Ent(){if(tV)return P5;tV=1;var t=ny(),e=Snt(),n=Co(),r=qle(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d(h){if(!n(h)||e(h))return!1;var f=t(h)?c:a;return f.test(r(h))}return P5=d,P5}var D5,nV;function Tnt(){if(nV)return D5;nV=1;function t(e,n){return e?.[n]}return D5=t,D5}var O5,rV;function Mf(){if(rV)return O5;rV=1;var t=Ent(),e=Tnt();function n(r,i){var a=e(r,i);return t(a)?a:void 0}return O5=n,O5}var L5,iV;function X7(){if(iV)return L5;iV=1;var t=Mf(),e=cl(),n=t(e,"Map");return L5=n,L5}var F5,aV;function aS(){if(aV)return F5;aV=1;var t=Mf(),e=t(Object,"create");return F5=e,F5}var B5,sV;function Cnt(){if(sV)return B5;sV=1;var t=aS();function e(){this.__data__=t?t(null):{},this.size=0}return B5=e,B5}var U5,oV;function Mnt(){if(oV)return U5;oV=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return U5=t,U5}var z5,lV;function Ant(){if(lV)return z5;lV=1;var t=aS(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(a){var s=this.__data__;if(t){var o=s[a];return o===e?void 0:o}return r.call(s,a)?s[a]:void 0}return z5=i,z5}var j5,uV;function knt(){if(uV)return j5;uV=1;var t=aS(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var a=this.__data__;return t?a[i]!==void 0:n.call(a,i)}return j5=r,j5}var H5,cV;function Int(){if(cV)return H5;cV=1;var t=aS(),e="__lodash_hash_undefined__";function n(r,i){var a=this.__data__;return this.size+=this.has(r)?0:1,a[r]=t&&i===void 0?e:i,this}return H5=n,H5}var $5,dV;function Nnt(){if(dV)return $5;dV=1;var t=Cnt(),e=Mnt(),n=Ant(),r=knt(),i=Int();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=i,$5=a,$5}var V5,hV;function Rnt(){if(hV)return V5;hV=1;var t=Nnt(),e=iS(),n=X7();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return V5=r,V5}var q5,fV;function Pnt(){if(fV)return q5;fV=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return q5=t,q5}var G5,pV;function sS(){if(pV)return G5;pV=1;var t=Pnt();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return G5=e,G5}var W5,mV;function Dnt(){if(mV)return W5;mV=1;var t=sS();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return W5=e,W5}var Y5,gV;function Ont(){if(gV)return Y5;gV=1;var t=sS();function e(n){return t(this,n).get(n)}return Y5=e,Y5}var X5,vV;function Lnt(){if(vV)return X5;vV=1;var t=sS();function e(n){return t(this,n).has(n)}return X5=e,X5}var K5,yV;function Fnt(){if(yV)return K5;yV=1;var t=sS();function e(n,r){var i=t(this,n),a=i.size;return i.set(n,r),this.size+=i.size==a?0:1,this}return K5=e,K5}var Z5,xV;function K7(){if(xV)return Z5;xV=1;var t=Rnt(),e=Dnt(),n=Ont(),r=Lnt(),i=Fnt();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=t,a.prototype.delete=e,a.prototype.get=n,a.prototype.has=r,a.prototype.set=i,Z5=a,Z5}var J5,bV;function Bnt(){if(bV)return J5;bV=1;var t=iS(),e=X7(),n=K7(),r=200;function i(a,s){var o=this.__data__;if(o instanceof t){var l=o.__data__;if(!e||l.length<r-1)return l.push([a,s]),this.size=++o.size,this;o=this.__data__=new n(l)}return o.set(a,s),this.size=o.size,this}return J5=i,J5}var Q5,_V;function oS(){if(_V)return Q5;_V=1;var t=iS(),e=gnt(),n=vnt(),r=ynt(),i=xnt(),a=Bnt();function s(o){var l=this.__data__=new t(o);this.size=l.size}return s.prototype.clear=e,s.prototype.delete=n,s.prototype.get=r,s.prototype.has=i,s.prototype.set=a,Q5=s,Q5}var eC,wV;function Z7(){if(wV)return eC;wV=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return eC=t,eC}var tC,SV;function Gle(){if(SV)return tC;SV=1;var t=Mf(),e=(function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}})();return tC=e,tC}var nC,EV;function lS(){if(EV)return nC;EV=1;var t=Gle();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return nC=e,nC}var rC,TV;function uS(){if(TV)return rC;TV=1;var t=lS(),e=nm(),n=Object.prototype,r=n.hasOwnProperty;function i(a,s,o){var l=a[s];(!(r.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&t(a,s,o)}return rC=i,rC}var iC,CV;function ry(){if(CV)return iC;CV=1;var t=uS(),e=lS();function n(r,i,a,s){var o=!a;a||(a={});for(var l=-1,u=i.length;++l<u;){var c=i[l],d=s?s(a[c],r[c],c,a,r):void 0;d===void 0&&(d=r[c]),o?e(a,c,d):t(a,c,d)}return a}return iC=n,iC}var aC,MV;function Unt(){if(MV)return aC;MV=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return aC=t,aC}var sC,AV;function nu(){if(AV)return sC;AV=1;function t(e){return e!=null&&typeof e=="object"}return sC=t,sC}var oC,kV;function znt(){if(kV)return oC;kV=1;var t=Cf(),e=nu(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return oC=r,oC}var lC,IV;function iy(){if(IV)return lC;IV=1;var t=znt(),e=nu(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,a=t((function(){return arguments})())?t:function(s){return e(s)&&r.call(s,"callee")&&!i.call(s,"callee")};return lC=a,lC}var uC,NV;function Wi(){if(NV)return uC;NV=1;var t=Array.isArray;return uC=t,uC}var Cg={exports:{}},cC,RV;function jnt(){if(RV)return cC;RV=1;function t(){return!1}return cC=t,cC}Cg.exports;var PV;function im(){return PV||(PV=1,(function(t,e){var n=cl(),r=jnt(),i=e&&!e.nodeType&&e,a=i&&!0&&t&&!t.nodeType&&t,s=a&&a.exports===i,o=s?n.Buffer:void 0,l=o?o.isBuffer:void 0,u=l||r;t.exports=u})(Cg,Cg.exports)),Cg.exports}var dC,DV;function cS(){if(DV)return dC;DV=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var a=typeof r;return i=i??t,!!i&&(a=="number"||a!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return dC=n,dC}var hC,OV;function J7(){if(OV)return hC;OV=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return hC=e,hC}var fC,LV;function Hnt(){if(LV)return fC;LV=1;var t=Cf(),e=J7(),n=nu(),r="[object Arguments]",i="[object Array]",a="[object Boolean]",s="[object Date]",o="[object Error]",l="[object Function]",u="[object Map]",c="[object Number]",d="[object Object]",h="[object RegExp]",f="[object Set]",m="[object String]",x="[object WeakMap]",b="[object ArrayBuffer]",y="[object DataView]",w="[object Float32Array]",_="[object Float64Array]",S="[object Int8Array]",M="[object Int16Array]",E="[object Int32Array]",C="[object Uint8Array]",R="[object Uint8ClampedArray]",k="[object Uint16Array]",I="[object Uint32Array]",N={};N[w]=N[_]=N[S]=N[M]=N[E]=N[C]=N[R]=N[k]=N[I]=!0,N[r]=N[i]=N[b]=N[a]=N[y]=N[s]=N[o]=N[l]=N[u]=N[c]=N[d]=N[h]=N[f]=N[m]=N[x]=!1;function D(F){return n(F)&&e(F.length)&&!!N[t(F)]}return fC=D,fC}var pC,FV;function dS(){if(FV)return pC;FV=1;function t(e){return function(n){return e(n)}}return pC=t,pC}var Mg={exports:{}};Mg.exports;var BV;function Q7(){return BV||(BV=1,(function(t,e){var n=Vle(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===r,s=a&&n.process,o=(function(){try{var l=i&&i.require&&i.require("util").types;return l||s&&s.binding&&s.binding("util")}catch{}})();t.exports=o})(Mg,Mg.exports)),Mg.exports}var mC,UV;function ay(){if(UV)return mC;UV=1;var t=Hnt(),e=dS(),n=Q7(),r=n&&n.isTypedArray,i=r?e(r):t;return mC=i,mC}var gC,zV;function Wle(){if(zV)return gC;zV=1;var t=Unt(),e=iy(),n=Wi(),r=im(),i=cS(),a=ay(),s=Object.prototype,o=s.hasOwnProperty;function l(u,c){var d=n(u),h=!d&&e(u),f=!d&&!h&&r(u),m=!d&&!h&&!f&&a(u),x=d||h||f||m,b=x?t(u.length,String):[],y=b.length;for(var w in u)(c||o.call(u,w))&&!(x&&(w=="length"||f&&(w=="offset"||w=="parent")||m&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||i(w,y)))&&b.push(w);return b}return gC=l,gC}var vC,jV;function hS(){if(jV)return vC;jV=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return vC=e,vC}var yC,HV;function Yle(){if(HV)return yC;HV=1;function t(e,n){return function(r){return e(n(r))}}return yC=t,yC}var xC,$V;function $nt(){if($V)return xC;$V=1;var t=Yle(),e=t(Object.keys,Object);return xC=e,xC}var bC,VV;function eP(){if(VV)return bC;VV=1;var t=hS(),e=$nt(),n=Object.prototype,r=n.hasOwnProperty;function i(a){if(!t(a))return e(a);var s=[];for(var o in Object(a))r.call(a,o)&&o!="constructor"&&s.push(o);return s}return bC=i,bC}var _C,qV;function Qu(){if(qV)return _C;qV=1;var t=ny(),e=J7();function n(r){return r!=null&&e(r.length)&&!t(r)}return _C=n,_C}var wC,GV;function Ed(){if(GV)return wC;GV=1;var t=Wle(),e=eP(),n=Qu();function r(i){return n(i)?t(i):e(i)}return wC=r,wC}var SC,WV;function Vnt(){if(WV)return SC;WV=1;var t=ry(),e=Ed();function n(r,i){return r&&t(i,e(i),r)}return SC=n,SC}var EC,YV;function qnt(){if(YV)return EC;YV=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return EC=t,EC}var TC,XV;function Gnt(){if(XV)return TC;XV=1;var t=Co(),e=hS(),n=qnt(),r=Object.prototype,i=r.hasOwnProperty;function a(s){if(!t(s))return n(s);var o=e(s),l=[];for(var u in s)u=="constructor"&&(o||!i.call(s,u))||l.push(u);return l}return TC=a,TC}var CC,KV;function Af(){if(KV)return CC;KV=1;var t=Wle(),e=Gnt(),n=Qu();function r(i){return n(i)?t(i,!0):e(i)}return CC=r,CC}var MC,ZV;function Wnt(){if(ZV)return MC;ZV=1;var t=ry(),e=Af();function n(r,i){return r&&t(i,e(i),r)}return MC=n,MC}var Ag={exports:{}};Ag.exports;var JV;function Xle(){return JV||(JV=1,(function(t,e){var n=cl(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===r,s=a?n.Buffer:void 0,o=s?s.allocUnsafe:void 0;function l(u,c){if(c)return u.slice();var d=u.length,h=o?o(d):new u.constructor(d);return u.copy(h),h}t.exports=l})(Ag,Ag.exports)),Ag.exports}var AC,QV;function Kle(){if(QV)return AC;QV=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return AC=t,AC}var kC,eq;function Zle(){if(eq)return kC;eq=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,a=0,s=[];++r<i;){var o=e[r];n(o,r,e)&&(s[a++]=o)}return s}return kC=t,kC}var IC,tq;function Jle(){if(tq)return IC;tq=1;function t(){return[]}return IC=t,IC}var NC,nq;function tP(){if(nq)return NC;nq=1;var t=Zle(),e=Jle(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,a=i?function(s){return s==null?[]:(s=Object(s),t(i(s),function(o){return r.call(s,o)}))}:e;return NC=a,NC}var RC,rq;function Ynt(){if(rq)return RC;rq=1;var t=ry(),e=tP();function n(r,i){return t(r,e(r),i)}return RC=n,RC}var PC,iq;function nP(){if(iq)return PC;iq=1;function t(e,n){for(var r=-1,i=n.length,a=e.length;++r<i;)e[a+r]=n[r];return e}return PC=t,PC}var DC,aq;function fS(){if(aq)return DC;aq=1;var t=Yle(),e=t(Object.getPrototypeOf,Object);return DC=e,DC}var OC,sq;function Qle(){if(sq)return OC;sq=1;var t=nP(),e=fS(),n=tP(),r=Jle(),i=Object.getOwnPropertySymbols,a=i?function(s){for(var o=[];s;)t(o,n(s)),s=e(s);return o}:r;return OC=a,OC}var LC,oq;function Xnt(){if(oq)return LC;oq=1;var t=ry(),e=Qle();function n(r,i){return t(r,e(r),i)}return LC=n,LC}var FC,lq;function eue(){if(lq)return FC;lq=1;var t=nP(),e=Wi();function n(r,i,a){var s=i(r);return e(r)?s:t(s,a(r))}return FC=n,FC}var BC,uq;function tue(){if(uq)return BC;uq=1;var t=eue(),e=tP(),n=Ed();function r(i){return t(i,n,e)}return BC=r,BC}var UC,cq;function Knt(){if(cq)return UC;cq=1;var t=eue(),e=Qle(),n=Af();function r(i){return t(i,n,e)}return UC=r,UC}var zC,dq;function Znt(){if(dq)return zC;dq=1;var t=Mf(),e=cl(),n=t(e,"DataView");return zC=n,zC}var jC,hq;function Jnt(){if(hq)return jC;hq=1;var t=Mf(),e=cl(),n=t(e,"Promise");return jC=n,jC}var HC,fq;function nue(){if(fq)return HC;fq=1;var t=Mf(),e=cl(),n=t(e,"Set");return HC=n,HC}var $C,pq;function Qnt(){if(pq)return $C;pq=1;var t=Mf(),e=cl(),n=t(e,"WeakMap");return $C=n,$C}var VC,mq;function am(){if(mq)return VC;mq=1;var t=Znt(),e=X7(),n=Jnt(),r=nue(),i=Qnt(),a=Cf(),s=qle(),o="[object Map]",l="[object Object]",u="[object Promise]",c="[object Set]",d="[object WeakMap]",h="[object DataView]",f=s(t),m=s(e),x=s(n),b=s(r),y=s(i),w=a;return(t&&w(new t(new ArrayBuffer(1)))!=h||e&&w(new e)!=o||n&&w(n.resolve())!=u||r&&w(new r)!=c||i&&w(new i)!=d)&&(w=function(_){var S=a(_),M=S==l?_.constructor:void 0,E=M?s(M):"";if(E)switch(E){case f:return h;case m:return o;case x:return u;case b:return c;case y:return d}return S}),VC=w,VC}var qC,gq;function ert(){if(gq)return qC;gq=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,a=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(a.index=r.index,a.input=r.input),a}return qC=n,qC}var GC,vq;function rue(){if(vq)return GC;vq=1;var t=cl(),e=t.Uint8Array;return GC=e,GC}var WC,yq;function rP(){if(yq)return WC;yq=1;var t=rue();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return WC=e,WC}var YC,xq;function trt(){if(xq)return YC;xq=1;var t=rP();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return YC=e,YC}var XC,bq;function nrt(){if(bq)return XC;bq=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return XC=e,XC}var KC,_q;function rrt(){if(_q)return KC;_q=1;var t=rm(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return KC=r,KC}var ZC,wq;function iue(){if(wq)return ZC;wq=1;var t=rP();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return ZC=e,ZC}var JC,Sq;function irt(){if(Sq)return JC;Sq=1;var t=rP(),e=trt(),n=nrt(),r=rrt(),i=iue(),a="[object Boolean]",s="[object Date]",o="[object Map]",l="[object Number]",u="[object RegExp]",c="[object Set]",d="[object String]",h="[object Symbol]",f="[object ArrayBuffer]",m="[object DataView]",x="[object Float32Array]",b="[object Float64Array]",y="[object Int8Array]",w="[object Int16Array]",_="[object Int32Array]",S="[object Uint8Array]",M="[object Uint8ClampedArray]",E="[object Uint16Array]",C="[object Uint32Array]";function R(k,I,N){var D=k.constructor;switch(I){case f:return t(k);case a:case s:return new D(+k);case m:return e(k,N);case x:case b:case y:case w:case _:case S:case M:case E:case C:return i(k,N);case o:return new D;case l:case d:return new D(k);case u:return n(k);case c:return new D;case h:return r(k)}}return JC=R,JC}var QC,Eq;function aue(){if(Eq)return QC;Eq=1;var t=Co(),e=Object.create,n=(function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var a=new r;return r.prototype=void 0,a}})();return QC=n,QC}var eM,Tq;function sue(){if(Tq)return eM;Tq=1;var t=aue(),e=fS(),n=hS();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return eM=r,eM}var tM,Cq;function art(){if(Cq)return tM;Cq=1;var t=am(),e=nu(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return tM=r,tM}var nM,Mq;function srt(){if(Mq)return nM;Mq=1;var t=art(),e=dS(),n=Q7(),r=n&&n.isMap,i=r?e(r):t;return nM=i,nM}var rM,Aq;function ort(){if(Aq)return rM;Aq=1;var t=am(),e=nu(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return rM=r,rM}var iM,kq;function lrt(){if(kq)return iM;kq=1;var t=ort(),e=dS(),n=Q7(),r=n&&n.isSet,i=r?e(r):t;return iM=i,iM}var aM,Iq;function oue(){if(Iq)return aM;Iq=1;var t=oS(),e=Z7(),n=uS(),r=Vnt(),i=Wnt(),a=Xle(),s=Kle(),o=Ynt(),l=Xnt(),u=tue(),c=Knt(),d=am(),h=ert(),f=irt(),m=sue(),x=Wi(),b=im(),y=srt(),w=Co(),_=lrt(),S=Ed(),M=Af(),E=1,C=2,R=4,k="[object Arguments]",I="[object Array]",N="[object Boolean]",D="[object Date]",F="[object Error]",L="[object Function]",U="[object GeneratorFunction]",j="[object Map]",q="[object Number]",Z="[object Object]",Q="[object RegExp]",z="[object Set]",W="[object String]",X="[object Symbol]",H="[object WeakMap]",J="[object ArrayBuffer]",te="[object DataView]",ee="[object Float32Array]",se="[object Float64Array]",ue="[object Int8Array]",oe="[object Int16Array]",Te="[object Int32Array]",Ne="[object Uint8Array]",be="[object Uint8ClampedArray]",De="[object Uint16Array]",ke="[object Uint32Array]",Me={};Me[k]=Me[I]=Me[J]=Me[te]=Me[N]=Me[D]=Me[ee]=Me[se]=Me[ue]=Me[oe]=Me[Te]=Me[j]=Me[q]=Me[Z]=Me[Q]=Me[z]=Me[W]=Me[X]=Me[Ne]=Me[be]=Me[De]=Me[ke]=!0,Me[F]=Me[L]=Me[H]=!1;function Ie(ce,G,xe,Oe,Fe,ze){var le,re=G&E,me=G&C,de=G&R;if(xe&&(le=Fe?xe(ce,Oe,Fe,ze):xe(ce)),le!==void 0)return le;if(!w(ce))return ce;var ve=x(ce);if(ve){if(le=h(ce),!re)return s(ce,le)}else{var _e=d(ce),Be=_e==L||_e==U;if(b(ce))return a(ce,re);if(_e==Z||_e==k||Be&&!Fe){if(le=me||Be?{}:m(ce),!re)return me?l(ce,i(le,ce)):o(ce,r(le,ce))}else{if(!Me[_e])return Fe?ce:{};le=f(ce,_e,re)}}ze||(ze=new t);var He=ze.get(ce);if(He)return He;ze.set(ce,le),_(ce)?ce.forEach(function(We){le.add(Ie(We,G,xe,We,ce,ze))}):y(ce)&&ce.forEach(function(We,Je){le.set(Je,Ie(We,G,xe,Je,ce,ze))});var pt=de?me?c:u:me?M:S,gt=ve?void 0:pt(ce);return e(gt||ce,function(We,Je){gt&&(Je=We,We=ce[Je]),n(le,Je,Ie(We,G,xe,Je,ce,ze))}),le}return aM=Ie,aM}var sM,Nq;function urt(){if(Nq)return sM;Nq=1;var t=oue(),e=4;function n(r){return t(r,e)}return sM=n,sM}var oM,Rq;function iP(){if(Rq)return oM;Rq=1;function t(e){return function(){return e}}return oM=t,oM}var lM,Pq;function crt(){if(Pq)return lM;Pq=1;function t(e){return function(n,r,i){for(var a=-1,s=Object(n),o=i(n),l=o.length;l--;){var u=o[e?l:++a];if(r(s[u],u,s)===!1)break}return n}}return lM=t,lM}var uM,Dq;function aP(){if(Dq)return uM;Dq=1;var t=crt(),e=t();return uM=e,uM}var cM,Oq;function sP(){if(Oq)return cM;Oq=1;var t=aP(),e=Ed();function n(r,i){return r&&t(r,i,e)}return cM=n,cM}var dM,Lq;function drt(){if(Lq)return dM;Lq=1;var t=Qu();function e(n,r){return function(i,a){if(i==null)return i;if(!t(i))return n(i,a);for(var s=i.length,o=r?s:-1,l=Object(i);(r?o--:++o<s)&&a(l[o],o,l)!==!1;);return i}}return dM=e,dM}var hM,Fq;function pS(){if(Fq)return hM;Fq=1;var t=sP(),e=drt(),n=e(t);return hM=n,hM}var fM,Bq;function kf(){if(Bq)return fM;Bq=1;function t(e){return e}return fM=t,fM}var pM,Uq;function lue(){if(Uq)return pM;Uq=1;var t=kf();function e(n){return typeof n=="function"?n:t}return pM=e,pM}var mM,zq;function uue(){if(zq)return mM;zq=1;var t=Z7(),e=pS(),n=lue(),r=Wi();function i(a,s){var o=r(a)?t:e;return o(a,n(s))}return mM=i,mM}var gM,jq;function cue(){return jq||(jq=1,gM=uue()),gM}var vM,Hq;function hrt(){if(Hq)return vM;Hq=1;var t=pS();function e(n,r){var i=[];return t(n,function(a,s,o){r(a,s,o)&&i.push(a)}),i}return vM=e,vM}var yM,$q;function frt(){if($q)return yM;$q=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return yM=e,yM}var xM,Vq;function prt(){if(Vq)return xM;Vq=1;function t(e){return this.__data__.has(e)}return xM=t,xM}var bM,qq;function due(){if(qq)return bM;qq=1;var t=K7(),e=frt(),n=prt();function r(i){var a=-1,s=i==null?0:i.length;for(this.__data__=new t;++a<s;)this.add(i[a])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,bM=r,bM}var _M,Gq;function mrt(){if(Gq)return _M;Gq=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return _M=t,_M}var wM,Wq;function hue(){if(Wq)return wM;Wq=1;function t(e,n){return e.has(n)}return wM=t,wM}var SM,Yq;function fue(){if(Yq)return SM;Yq=1;var t=due(),e=mrt(),n=hue(),r=1,i=2;function a(s,o,l,u,c,d){var h=l&r,f=s.length,m=o.length;if(f!=m&&!(h&&m>f))return!1;var x=d.get(s),b=d.get(o);if(x&&b)return x==o&&b==s;var y=-1,w=!0,_=l&i?new t:void 0;for(d.set(s,o),d.set(o,s);++y<f;){var S=s[y],M=o[y];if(u)var E=h?u(M,S,y,o,s,d):u(S,M,y,s,o,d);if(E!==void 0){if(E)continue;w=!1;break}if(_){if(!e(o,function(C,R){if(!n(_,R)&&(S===C||c(S,C,l,u,d)))return _.push(R)})){w=!1;break}}else if(!(S===M||c(S,M,l,u,d))){w=!1;break}}return d.delete(s),d.delete(o),w}return SM=a,SM}var EM,Xq;function grt(){if(Xq)return EM;Xq=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,a){r[++n]=[a,i]}),r}return EM=t,EM}var TM,Kq;function oP(){if(Kq)return TM;Kq=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return TM=t,TM}var CM,Zq;function vrt(){if(Zq)return CM;Zq=1;var t=rm(),e=rue(),n=nm(),r=fue(),i=grt(),a=oP(),s=1,o=2,l="[object Boolean]",u="[object Date]",c="[object Error]",d="[object Map]",h="[object Number]",f="[object RegExp]",m="[object Set]",x="[object String]",b="[object Symbol]",y="[object ArrayBuffer]",w="[object DataView]",_=t?t.prototype:void 0,S=_?_.valueOf:void 0;function M(E,C,R,k,I,N,D){switch(R){case w:if(E.byteLength!=C.byteLength||E.byteOffset!=C.byteOffset)return!1;E=E.buffer,C=C.buffer;case y:return!(E.byteLength!=C.byteLength||!N(new e(E),new e(C)));case l:case u:case h:return n(+E,+C);case c:return E.name==C.name&&E.message==C.message;case f:case x:return E==C+"";case d:var F=i;case m:var L=k&s;if(F||(F=a),E.size!=C.size&&!L)return!1;var U=D.get(E);if(U)return U==C;k|=o,D.set(E,C);var j=r(F(E),F(C),k,I,N,D);return D.delete(E),j;case b:if(S)return S.call(E)==S.call(C)}return!1}return CM=M,CM}var MM,Jq;function yrt(){if(Jq)return MM;Jq=1;var t=tue(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(a,s,o,l,u,c){var d=o&e,h=t(a),f=h.length,m=t(s),x=m.length;if(f!=x&&!d)return!1;for(var b=f;b--;){var y=h[b];if(!(d?y in s:r.call(s,y)))return!1}var w=c.get(a),_=c.get(s);if(w&&_)return w==s&&_==a;var S=!0;c.set(a,s),c.set(s,a);for(var M=d;++b<f;){y=h[b];var E=a[y],C=s[y];if(l)var R=d?l(C,E,y,s,a,c):l(E,C,y,a,s,c);if(!(R===void 0?E===C||u(E,C,o,l,c):R)){S=!1;break}M||(M=y=="constructor")}if(S&&!M){var k=a.constructor,I=s.constructor;k!=I&&"constructor"in a&&"constructor"in s&&!(typeof k=="function"&&k instanceof k&&typeof I=="function"&&I instanceof I)&&(S=!1)}return c.delete(a),c.delete(s),S}return MM=i,MM}var AM,Qq;function xrt(){if(Qq)return AM;Qq=1;var t=oS(),e=fue(),n=vrt(),r=yrt(),i=am(),a=Wi(),s=im(),o=ay(),l=1,u="[object Arguments]",c="[object Array]",d="[object Object]",h=Object.prototype,f=h.hasOwnProperty;function m(x,b,y,w,_,S){var M=a(x),E=a(b),C=M?c:i(x),R=E?c:i(b);C=C==u?d:C,R=R==u?d:R;var k=C==d,I=R==d,N=C==R;if(N&&s(x)){if(!s(b))return!1;M=!0,k=!1}if(N&&!k)return S||(S=new t),M||o(x)?e(x,b,y,w,_,S):n(x,b,C,y,w,_,S);if(!(y&l)){var D=k&&f.call(x,"__wrapped__"),F=I&&f.call(b,"__wrapped__");if(D||F){var L=D?x.value():x,U=F?b.value():b;return S||(S=new t),_(L,U,y,w,S)}}return N?(S||(S=new t),r(x,b,y,w,_,S)):!1}return AM=m,AM}var kM,eG;function pue(){if(eG)return kM;eG=1;var t=xrt(),e=nu();function n(r,i,a,s,o){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,a,s,n,o)}return kM=n,kM}var IM,tG;function brt(){if(tG)return IM;tG=1;var t=oS(),e=pue(),n=1,r=2;function i(a,s,o,l){var u=o.length,c=u,d=!l;if(a==null)return!c;for(a=Object(a);u--;){var h=o[u];if(d&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++u<c;){h=o[u];var f=h[0],m=a[f],x=h[1];if(d&&h[2]){if(m===void 0&&!(f in a))return!1}else{var b=new t;if(l)var y=l(m,x,f,a,s,b);if(!(y===void 0?e(x,m,n|r,l,b):y))return!1}}return!0}return IM=i,IM}var NM,nG;function mue(){if(nG)return NM;nG=1;var t=Co();function e(n){return n===n&&!t(n)}return NM=e,NM}var RM,rG;function _rt(){if(rG)return RM;rG=1;var t=mue(),e=Ed();function n(r){for(var i=e(r),a=i.length;a--;){var s=i[a],o=r[s];i[a]=[s,o,t(o)]}return i}return RM=n,RM}var PM,iG;function gue(){if(iG)return PM;iG=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return PM=t,PM}var DM,aG;function wrt(){if(aG)return DM;aG=1;var t=brt(),e=_rt(),n=gue();function r(i){var a=e(i);return a.length==1&&a[0][2]?n(a[0][0],a[0][1]):function(s){return s===i||t(s,i,a)}}return DM=r,DM}var OM,sG;function sm(){if(sG)return OM;sG=1;var t=Cf(),e=nu(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return OM=r,OM}var LM,oG;function lP(){if(oG)return LM;oG=1;var t=Wi(),e=sm(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(a,s){if(t(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:r.test(a)||!n.test(a)||s!=null&&a in Object(s)}return LM=i,LM}var FM,lG;function Srt(){if(lG)return FM;lG=1;var t=K7(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=r.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(n.Cache||t),a}return n.Cache=t,FM=n,FM}var BM,uG;function Ert(){if(uG)return BM;uG=1;var t=Srt(),e=500;function n(r){var i=t(r,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return BM=n,BM}var UM,cG;function Trt(){if(cG)return UM;cG=1;var t=Ert(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(n,"$1"):o||s)}),a});return UM=r,UM}var zM,dG;function mS(){if(dG)return zM;dG=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,a=Array(i);++r<i;)a[r]=n(e[r],r,e);return a}return zM=t,zM}var jM,hG;function Crt(){if(hG)return jM;hG=1;var t=rm(),e=mS(),n=Wi(),r=sm(),i=t?t.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(n(o))return e(o,s)+"";if(r(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return jM=s,jM}var HM,fG;function vue(){if(fG)return HM;fG=1;var t=Crt();function e(n){return n==null?"":t(n)}return HM=e,HM}var $M,pG;function gS(){if(pG)return $M;pG=1;var t=Wi(),e=lP(),n=Trt(),r=vue();function i(a,s){return t(a)?a:e(a,s)?[a]:n(r(a))}return $M=i,$M}var VM,mG;function sy(){if(mG)return VM;mG=1;var t=sm();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return VM=e,VM}var qM,gG;function vS(){if(gG)return qM;gG=1;var t=gS(),e=sy();function n(r,i){i=t(i,r);for(var a=0,s=i.length;r!=null&&a<s;)r=r[e(i[a++])];return a&&a==s?r:void 0}return qM=n,qM}var GM,vG;function Mrt(){if(vG)return GM;vG=1;var t=vS();function e(n,r,i){var a=n==null?void 0:t(n,r);return a===void 0?i:a}return GM=e,GM}var WM,yG;function Art(){if(yG)return WM;yG=1;function t(e,n){return e!=null&&n in Object(e)}return WM=t,WM}var YM,xG;function yue(){if(xG)return YM;xG=1;var t=gS(),e=iy(),n=Wi(),r=cS(),i=J7(),a=sy();function s(o,l,u){l=t(l,o);for(var c=-1,d=l.length,h=!1;++c<d;){var f=a(l[c]);if(!(h=o!=null&&u(o,f)))break;o=o[f]}return h||++c!=d?h:(d=o==null?0:o.length,!!d&&i(d)&&r(f,d)&&(n(o)||e(o)))}return YM=s,YM}var XM,bG;function xue(){if(bG)return XM;bG=1;var t=Art(),e=yue();function n(r,i){return r!=null&&e(r,i,t)}return XM=n,XM}var KM,_G;function krt(){if(_G)return KM;_G=1;var t=pue(),e=Mrt(),n=xue(),r=lP(),i=mue(),a=gue(),s=sy(),o=1,l=2;function u(c,d){return r(c)&&i(d)?a(s(c),d):function(h){var f=e(h,c);return f===void 0&&f===d?n(h,c):t(d,f,o|l)}}return KM=u,KM}var ZM,wG;function bue(){if(wG)return ZM;wG=1;function t(e){return function(n){return n?.[e]}}return ZM=t,ZM}var JM,SG;function Irt(){if(SG)return JM;SG=1;var t=vS();function e(n){return function(r){return t(r,n)}}return JM=e,JM}var QM,EG;function Nrt(){if(EG)return QM;EG=1;var t=bue(),e=Irt(),n=lP(),r=sy();function i(a){return n(a)?t(r(a)):e(a)}return QM=i,QM}var eA,TG;function ec(){if(TG)return eA;TG=1;var t=wrt(),e=krt(),n=kf(),r=Wi(),i=Nrt();function a(s){return typeof s=="function"?s:s==null?n:typeof s=="object"?r(s)?e(s[0],s[1]):t(s):i(s)}return eA=a,eA}var tA,CG;function _ue(){if(CG)return tA;CG=1;var t=Zle(),e=hrt(),n=ec(),r=Wi();function i(a,s){var o=r(a)?t:e;return o(a,n(s,3))}return tA=i,tA}var nA,MG;function Rrt(){if(MG)return nA;MG=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,i){return r!=null&&e.call(r,i)}return nA=n,nA}var rA,AG;function wue(){if(AG)return rA;AG=1;var t=Rrt(),e=yue();function n(r,i){return r!=null&&e(r,i,t)}return rA=n,rA}var iA,kG;function Prt(){if(kG)return iA;kG=1;var t=eP(),e=am(),n=iy(),r=Wi(),i=Qu(),a=im(),s=hS(),o=ay(),l="[object Map]",u="[object Set]",c=Object.prototype,d=c.hasOwnProperty;function h(f){if(f==null)return!0;if(i(f)&&(r(f)||typeof f=="string"||typeof f.splice=="function"||a(f)||o(f)||n(f)))return!f.length;var m=e(f);if(m==l||m==u)return!f.size;if(s(f))return!t(f).length;for(var x in f)if(d.call(f,x))return!1;return!0}return iA=h,iA}var aA,IG;function Sue(){if(IG)return aA;IG=1;function t(e){return e===void 0}return aA=t,aA}var sA,NG;function Eue(){if(NG)return sA;NG=1;var t=pS(),e=Qu();function n(r,i){var a=-1,s=e(r)?Array(r.length):[];return t(r,function(o,l,u){s[++a]=i(o,l,u)}),s}return sA=n,sA}var oA,RG;function Tue(){if(RG)return oA;RG=1;var t=mS(),e=ec(),n=Eue(),r=Wi();function i(a,s){var o=r(a)?t:n;return o(a,e(s,3))}return oA=i,oA}var lA,PG;function Drt(){if(PG)return lA;PG=1;function t(e,n,r,i){var a=-1,s=e==null?0:e.length;for(i&&s&&(r=e[++a]);++a<s;)r=n(r,e[a],a,e);return r}return lA=t,lA}var uA,DG;function Ort(){if(DG)return uA;DG=1;function t(e,n,r,i,a){return a(e,function(s,o,l){r=i?(i=!1,s):n(r,s,o,l)}),r}return uA=t,uA}var cA,OG;function Cue(){if(OG)return cA;OG=1;var t=Drt(),e=pS(),n=ec(),r=Ort(),i=Wi();function a(s,o,l){var u=i(s)?t:r,c=arguments.length<3;return u(s,n(o,4),l,c,e)}return cA=a,cA}var dA,LG;function Lrt(){if(LG)return dA;LG=1;var t=Cf(),e=Wi(),n=nu(),r="[object String]";function i(a){return typeof a=="string"||!e(a)&&n(a)&&t(a)==r}return dA=i,dA}var hA,FG;function Frt(){if(FG)return hA;FG=1;var t=bue(),e=t("length");return hA=e,hA}var fA,BG;function Brt(){if(BG)return fA;BG=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,a="\\ufe0e\\ufe0f",s="\\u200d",o=RegExp("["+s+t+i+a+"]");function l(u){return o.test(u)}return fA=l,fA}var pA,UG;function Urt(){if(UG)return pA;UG=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,a="\\ufe0e\\ufe0f",s="["+t+"]",o="["+i+"]",l="\\ud83c[\\udffb-\\udfff]",u="(?:"+o+"|"+l+")",c="[^"+t+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",f="\\u200d",m=u+"?",x="["+a+"]?",b="(?:"+f+"(?:"+[c,d,h].join("|")+")"+x+m+")*",y=x+m+b,w="(?:"+[c+o+"?",o,d,h,s].join("|")+")",_=RegExp(l+"(?="+l+")|"+w+y,"g");function S(M){for(var E=_.lastIndex=0;_.test(M);)++E;return E}return pA=S,pA}var mA,zG;function zrt(){if(zG)return mA;zG=1;var t=Frt(),e=Brt(),n=Urt();function r(i){return e(i)?n(i):t(i)}return mA=r,mA}var gA,jG;function jrt(){if(jG)return gA;jG=1;var t=eP(),e=am(),n=Qu(),r=Lrt(),i=zrt(),a="[object Map]",s="[object Set]";function o(l){if(l==null)return 0;if(n(l))return r(l)?i(l):l.length;var u=e(l);return u==a||u==s?l.size:t(l).length}return gA=o,gA}var vA,HG;function Hrt(){if(HG)return vA;HG=1;var t=Z7(),e=aue(),n=sP(),r=ec(),i=fS(),a=Wi(),s=im(),o=ny(),l=Co(),u=ay();function c(d,h,f){var m=a(d),x=m||s(d)||u(d);if(h=r(h,4),f==null){var b=d&&d.constructor;x?f=m?new b:[]:l(d)?f=o(b)?e(i(d)):{}:f={}}return(x?t:n)(d,function(y,w,_){return h(f,y,w,_)}),f}return vA=c,vA}var yA,$G;function $rt(){if($G)return yA;$G=1;var t=rm(),e=iy(),n=Wi(),r=t?t.isConcatSpreadable:void 0;function i(a){return n(a)||e(a)||!!(r&&a&&a[r])}return yA=i,yA}var xA,VG;function uP(){if(VG)return xA;VG=1;var t=nP(),e=$rt();function n(r,i,a,s,o){var l=-1,u=r.length;for(a||(a=e),o||(o=[]);++l<u;){var c=r[l];i>0&&a(c)?i>1?n(c,i-1,a,s,o):t(o,c):s||(o[o.length]=c)}return o}return xA=n,xA}var bA,qG;function Vrt(){if(qG)return bA;qG=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return bA=t,bA}var _A,GG;function Mue(){if(GG)return _A;GG=1;var t=Vrt(),e=Math.max;function n(r,i,a){return i=e(i===void 0?r.length-1:i,0),function(){for(var s=arguments,o=-1,l=e(s.length-i,0),u=Array(l);++o<l;)u[o]=s[i+o];o=-1;for(var c=Array(i+1);++o<i;)c[o]=s[o];return c[i]=a(u),t(r,this,c)}}return _A=n,_A}var wA,WG;function qrt(){if(WG)return wA;WG=1;var t=iP(),e=Gle(),n=kf(),r=e?function(i,a){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(a),writable:!0})}:n;return wA=r,wA}var SA,YG;function Grt(){if(YG)return SA;YG=1;var t=800,e=16,n=Date.now;function r(i){var a=0,s=0;return function(){var o=n(),l=e-(o-s);if(s=o,l>0){if(++a>=t)return arguments[0]}else a=0;return i.apply(void 0,arguments)}}return SA=r,SA}var EA,XG;function Aue(){if(XG)return EA;XG=1;var t=qrt(),e=Grt(),n=e(t);return EA=n,EA}var TA,KG;function yS(){if(KG)return TA;KG=1;var t=kf(),e=Mue(),n=Aue();function r(i,a){return n(e(i,a,t),i+"")}return TA=r,TA}var CA,ZG;function kue(){if(ZG)return CA;ZG=1;function t(e,n,r,i){for(var a=e.length,s=r+(i?1:-1);i?s--:++s<a;)if(n(e[s],s,e))return s;return-1}return CA=t,CA}var MA,JG;function Wrt(){if(JG)return MA;JG=1;function t(e){return e!==e}return MA=t,MA}var AA,QG;function Yrt(){if(QG)return AA;QG=1;function t(e,n,r){for(var i=r-1,a=e.length;++i<a;)if(e[i]===n)return i;return-1}return AA=t,AA}var kA,eW;function Xrt(){if(eW)return kA;eW=1;var t=kue(),e=Wrt(),n=Yrt();function r(i,a,s){return a===a?n(i,a,s):t(i,e,s)}return kA=r,kA}var IA,tW;function Krt(){if(tW)return IA;tW=1;var t=Xrt();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return IA=e,IA}var NA,nW;function Zrt(){if(nW)return NA;nW=1;function t(e,n,r){for(var i=-1,a=e==null?0:e.length;++i<a;)if(r(n,e[i]))return!0;return!1}return NA=t,NA}var RA,rW;function Jrt(){if(rW)return RA;rW=1;function t(){}return RA=t,RA}var PA,iW;function Qrt(){if(iW)return PA;iW=1;var t=nue(),e=Jrt(),n=oP(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(a){return new t(a)}:e;return PA=i,PA}var DA,aW;function eit(){if(aW)return DA;aW=1;var t=due(),e=Krt(),n=Zrt(),r=hue(),i=Qrt(),a=oP(),s=200;function o(l,u,c){var d=-1,h=e,f=l.length,m=!0,x=[],b=x;if(c)m=!1,h=n;else if(f>=s){var y=u?null:i(l);if(y)return a(y);m=!1,h=r,b=new t}else b=u?[]:x;e:for(;++d<f;){var w=l[d],_=u?u(w):w;if(w=c||w!==0?w:0,m&&_===_){for(var S=b.length;S--;)if(b[S]===_)continue e;u&&b.push(_),x.push(w)}else h(b,_,c)||(b!==x&&b.push(_),x.push(w))}return x}return DA=o,DA}var OA,sW;function Iue(){if(sW)return OA;sW=1;var t=Qu(),e=nu();function n(r){return e(r)&&t(r)}return OA=n,OA}var LA,oW;function tit(){if(oW)return LA;oW=1;var t=uP(),e=yS(),n=eit(),r=Iue(),i=e(function(a){return n(t(a,1,r,!0))});return LA=i,LA}var FA,lW;function nit(){if(lW)return FA;lW=1;var t=mS();function e(n,r){return t(r,function(i){return n[i]})}return FA=e,FA}var BA,uW;function Nue(){if(uW)return BA;uW=1;var t=nit(),e=Ed();function n(r){return r==null?[]:t(r,e(r))}return BA=n,BA}var UA,cW;function Mo(){if(cW)return UA;cW=1;var t;if(typeof Y7=="function")try{t={clone:urt(),constant:iP(),each:cue(),filter:_ue(),has:wue(),isArray:Wi(),isEmpty:Prt(),isFunction:ny(),isUndefined:Sue(),keys:Ed(),map:Tue(),reduce:Cue(),size:jrt(),transform:Hrt(),union:tit(),values:Nue()}}catch{}return t||(t=window._),UA=t,UA}var zA,dW;function cP(){if(dW)return zA;dW=1;var t=Mo();zA=i;var e="\0",n="\0",r="";function i(c){this._isDirected=t.has(c,"directed")?c.directed:!0,this._isMultigraph=t.has(c,"multigraph")?c.multigraph:!1,this._isCompound=t.has(c,"compound")?c.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(c){return this._label=c,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(c){return t.isFunction(c)||(c=t.constant(c)),this._defaultNodeLabelFn=c,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var c=this;return t.filter(this.nodes(),function(d){return t.isEmpty(c._in[d])})},i.prototype.sinks=function(){var c=this;return t.filter(this.nodes(),function(d){return t.isEmpty(c._out[d])})},i.prototype.setNodes=function(c,d){var h=arguments,f=this;return t.each(c,function(m){h.length>1?f.setNode(m,d):f.setNode(m)}),this},i.prototype.setNode=function(c,d){return t.has(this._nodes,c)?(arguments.length>1&&(this._nodes[c]=d),this):(this._nodes[c]=arguments.length>1?d:this._defaultNodeLabelFn(c),this._isCompound&&(this._parent[c]=n,this._children[c]={},this._children[n][c]=!0),this._in[c]={},this._preds[c]={},this._out[c]={},this._sucs[c]={},++this._nodeCount,this)},i.prototype.node=function(c){return this._nodes[c]},i.prototype.hasNode=function(c){return t.has(this._nodes,c)},i.prototype.removeNode=function(c){var d=this;if(t.has(this._nodes,c)){var h=function(f){d.removeEdge(d._edgeObjs[f])};delete this._nodes[c],this._isCompound&&(this._removeFromParentsChildList(c),delete this._parent[c],t.each(this.children(c),function(f){d.setParent(f)}),delete this._children[c]),t.each(t.keys(this._in[c]),h),delete this._in[c],delete this._preds[c],t.each(t.keys(this._out[c]),h),delete this._out[c],delete this._sucs[c],--this._nodeCount}return this},i.prototype.setParent=function(c,d){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(d))d=n;else{d+="";for(var h=d;!t.isUndefined(h);h=this.parent(h))if(h===c)throw new Error("Setting "+d+" as parent of "+c+" would create a cycle");this.setNode(d)}return this.setNode(c),this._removeFromParentsChildList(c),this._parent[c]=d,this._children[d][c]=!0,this},i.prototype._removeFromParentsChildList=function(c){delete this._children[this._parent[c]][c]},i.prototype.parent=function(c){if(this._isCompound){var d=this._parent[c];if(d!==n)return d}},i.prototype.children=function(c){if(t.isUndefined(c)&&(c=n),this._isCompound){var d=this._children[c];if(d)return t.keys(d)}else{if(c===n)return this.nodes();if(this.hasNode(c))return[]}},i.prototype.predecessors=function(c){var d=this._preds[c];if(d)return t.keys(d)},i.prototype.successors=function(c){var d=this._sucs[c];if(d)return t.keys(d)},i.prototype.neighbors=function(c){var d=this.predecessors(c);if(d)return t.union(d,this.successors(c))},i.prototype.isLeaf=function(c){var d;return this.isDirected()?d=this.successors(c):d=this.neighbors(c),d.length===0},i.prototype.filterNodes=function(c){var d=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});d.setGraph(this.graph());var h=this;t.each(this._nodes,function(x,b){c(b)&&d.setNode(b,x)}),t.each(this._edgeObjs,function(x){d.hasNode(x.v)&&d.hasNode(x.w)&&d.setEdge(x,h.edge(x))});var f={};function m(x){var b=h.parent(x);return b===void 0||d.hasNode(b)?(f[x]=b,b):b in f?f[b]:m(b)}return this._isCompound&&t.each(d.nodes(),function(x){d.setParent(x,m(x))}),d},i.prototype.setDefaultEdgeLabel=function(c){return t.isFunction(c)||(c=t.constant(c)),this._defaultEdgeLabelFn=c,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(c,d){var h=this,f=arguments;return t.reduce(c,function(m,x){return f.length>1?h.setEdge(m,x,d):h.setEdge(m,x),x}),this},i.prototype.setEdge=function(){var c,d,h,f,m=!1,x=arguments[0];typeof x=="object"&&x!==null&&"v"in x?(c=x.v,d=x.w,h=x.name,arguments.length===2&&(f=arguments[1],m=!0)):(c=x,d=arguments[1],h=arguments[3],arguments.length>2&&(f=arguments[2],m=!0)),c=""+c,d=""+d,t.isUndefined(h)||(h=""+h);var b=o(this._isDirected,c,d,h);if(t.has(this._edgeLabels,b))return m&&(this._edgeLabels[b]=f),this;if(!t.isUndefined(h)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(c),this.setNode(d),this._edgeLabels[b]=m?f:this._defaultEdgeLabelFn(c,d,h);var y=l(this._isDirected,c,d,h);return c=y.v,d=y.w,Object.freeze(y),this._edgeObjs[b]=y,a(this._preds[d],c),a(this._sucs[c],d),this._in[d][b]=y,this._out[c][b]=y,this._edgeCount++,this},i.prototype.edge=function(c,d,h){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,d,h);return this._edgeLabels[f]},i.prototype.hasEdge=function(c,d,h){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,d,h);return t.has(this._edgeLabels,f)},i.prototype.removeEdge=function(c,d,h){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,d,h),m=this._edgeObjs[f];return m&&(c=m.v,d=m.w,delete this._edgeLabels[f],delete this._edgeObjs[f],s(this._preds[d],c),s(this._sucs[c],d),delete this._in[d][f],delete this._out[c][f],this._edgeCount--),this},i.prototype.inEdges=function(c,d){var h=this._in[c];if(h){var f=t.values(h);return d?t.filter(f,function(m){return m.v===d}):f}},i.prototype.outEdges=function(c,d){var h=this._out[c];if(h){var f=t.values(h);return d?t.filter(f,function(m){return m.w===d}):f}},i.prototype.nodeEdges=function(c,d){var h=this.inEdges(c,d);if(h)return h.concat(this.outEdges(c,d))};function a(c,d){c[d]?c[d]++:c[d]=1}function s(c,d){--c[d]||delete c[d]}function o(c,d,h,f){var m=""+d,x=""+h;if(!c&&m>x){var b=m;m=x,x=b}return m+r+x+r+(t.isUndefined(f)?e:f)}function l(c,d,h,f){var m=""+d,x=""+h;if(!c&&m>x){var b=m;m=x,x=b}var y={v:m,w:x};return f&&(y.name=f),y}function u(c,d){return o(c,d.v,d.w,d.name)}return zA}var jA,hW;function rit(){return hW||(hW=1,jA="2.1.8"),jA}var HA,fW;function iit(){return fW||(fW=1,HA={Graph:cP(),version:rit()}),HA}var $A,pW;function ait(){if(pW)return $A;pW=1;var t=Mo(),e=cP();$A={write:n,read:a};function n(s){var o={options:{directed:s.isDirected(),multigraph:s.isMultigraph(),compound:s.isCompound()},nodes:r(s),edges:i(s)};return t.isUndefined(s.graph())||(o.value=t.clone(s.graph())),o}function r(s){return t.map(s.nodes(),function(o){var l=s.node(o),u=s.parent(o),c={v:o};return t.isUndefined(l)||(c.value=l),t.isUndefined(u)||(c.parent=u),c})}function i(s){return t.map(s.edges(),function(o){var l=s.edge(o),u={v:o.v,w:o.w};return t.isUndefined(o.name)||(u.name=o.name),t.isUndefined(l)||(u.value=l),u})}function a(s){var o=new e(s.options).setGraph(s.value);return t.each(s.nodes,function(l){o.setNode(l.v,l.value),l.parent&&o.setParent(l.v,l.parent)}),t.each(s.edges,function(l){o.setEdge({v:l.v,w:l.w,name:l.name},l.value)}),o}return $A}var VA,mW;function sit(){if(mW)return VA;mW=1;var t=Mo();VA=e;function e(n){var r={},i=[],a;function s(o){t.has(r,o)||(r[o]=!0,a.push(o),t.each(n.successors(o),s),t.each(n.predecessors(o),s))}return t.each(n.nodes(),function(o){a=[],s(o),a.length&&i.push(a)}),i}return VA}var qA,gW;function Rue(){if(gW)return qA;gW=1;var t=Mo();qA=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var i=this._keyIndices;if(n=String(n),!t.has(i,n)){var a=this._arr,s=a.length;return i[n]=s,a.push({key:n,priority:r}),this._decrease(s),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var i=this._keyIndices[n];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(n){var r=this._arr,i=2*n,a=i+1,s=n;i<r.length&&(s=r[i].priority<r[s].priority?i:s,a<r.length&&(s=r[a].priority<r[s].priority?a:s),s!==n&&(this._swap(n,s),this._heapify(s)))},e.prototype._decrease=function(n){for(var r=this._arr,i=r[n].priority,a;n!==0&&(a=n>>1,!(r[a].priority<i));)this._swap(n,a),n=a},e.prototype._swap=function(n,r){var i=this._arr,a=this._keyIndices,s=i[n],o=i[r];i[n]=o,i[r]=s,a[o.key]=n,a[s.key]=r},qA}var GA,vW;function Pue(){if(vW)return GA;vW=1;var t=Mo(),e=Rue();GA=r;var n=t.constant(1);function r(a,s,o,l){return i(a,String(s),o||n,l||function(u){return a.outEdges(u)})}function i(a,s,o,l){var u={},c=new e,d,h,f=function(m){var x=m.v!==d?m.v:m.w,b=u[x],y=o(m),w=h.distance+y;if(y<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+m+" Weight: "+y);w<b.distance&&(b.distance=w,b.predecessor=d,c.decrease(x,w))};for(a.nodes().forEach(function(m){var x=m===s?0:Number.POSITIVE_INFINITY;u[m]={distance:x},c.add(m,x)});c.size()>0&&(d=c.removeMin(),h=u[d],h.distance!==Number.POSITIVE_INFINITY);)l(d).forEach(f);return u}return GA}var WA,yW;function oit(){if(yW)return WA;yW=1;var t=Pue(),e=Mo();WA=n;function n(r,i,a){return e.transform(r.nodes(),function(s,o){s[o]=t(r,o,i,a)},{})}return WA}var YA,xW;function Due(){if(xW)return YA;xW=1;var t=Mo();YA=e;function e(n){var r=0,i=[],a={},s=[];function o(l){var u=a[l]={onStack:!0,lowlink:r,index:r++};if(i.push(l),n.successors(l).forEach(function(h){t.has(a,h)?a[h].onStack&&(u.lowlink=Math.min(u.lowlink,a[h].index)):(o(h),u.lowlink=Math.min(u.lowlink,a[h].lowlink))}),u.lowlink===u.index){var c=[],d;do d=i.pop(),a[d].onStack=!1,c.push(d);while(l!==d);s.push(c)}}return n.nodes().forEach(function(l){t.has(a,l)||o(l)}),s}return YA}var XA,bW;function lit(){if(bW)return XA;bW=1;var t=Mo(),e=Due();XA=n;function n(r){return t.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return XA}var KA,_W;function uit(){if(_W)return KA;_W=1;var t=Mo();KA=n;var e=t.constant(1);function n(i,a,s){return r(i,a||e,s||function(o){return i.outEdges(o)})}function r(i,a,s){var o={},l=i.nodes();return l.forEach(function(u){o[u]={},o[u][u]={distance:0},l.forEach(function(c){u!==c&&(o[u][c]={distance:Number.POSITIVE_INFINITY})}),s(u).forEach(function(c){var d=c.v===u?c.w:c.v,h=a(c);o[u][d]={distance:h,predecessor:u}})}),l.forEach(function(u){var c=o[u];l.forEach(function(d){var h=o[d];l.forEach(function(f){var m=h[u],x=c[f],b=h[f],y=m.distance+x.distance;y<b.distance&&(b.distance=y,b.predecessor=x.predecessor)})})}),o}return KA}var ZA,wW;function Oue(){if(wW)return ZA;wW=1;var t=Mo();ZA=e,e.CycleException=n;function e(r){var i={},a={},s=[];function o(l){if(t.has(a,l))throw new n;t.has(i,l)||(a[l]=!0,i[l]=!0,t.each(r.predecessors(l),o),delete a[l],s.push(l))}if(t.each(r.sinks(),o),t.size(i)!==r.nodeCount())throw new n;return s}function n(){}return n.prototype=new Error,ZA}var JA,SW;function cit(){if(SW)return JA;SW=1;var t=Oue();JA=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return JA}var QA,EW;function Lue(){if(EW)return QA;EW=1;var t=Mo();QA=e;function e(r,i,a){t.isArray(i)||(i=[i]);var s=(r.isDirected()?r.successors:r.neighbors).bind(r),o=[],l={};return t.each(i,function(u){if(!r.hasNode(u))throw new Error("Graph does not have node: "+u);n(r,u,a==="post",l,s,o)}),o}function n(r,i,a,s,o,l){t.has(s,i)||(s[i]=!0,a||l.push(i),t.each(o(i),function(u){n(r,u,a,s,o,l)}),a&&l.push(i))}return QA}var ek,TW;function dit(){if(TW)return ek;TW=1;var t=Lue();ek=e;function e(n,r){return t(n,r,"post")}return ek}var tk,CW;function hit(){if(CW)return tk;CW=1;var t=Lue();tk=e;function e(n,r){return t(n,r,"pre")}return tk}var nk,MW;function fit(){if(MW)return nk;MW=1;var t=Mo(),e=cP(),n=Rue();nk=r;function r(i,a){var s=new e,o={},l=new n,u;function c(h){var f=h.v===u?h.w:h.v,m=l.priority(f);if(m!==void 0){var x=a(h);x<m&&(o[f]=u,l.decrease(f,x))}}if(i.nodeCount()===0)return s;t.each(i.nodes(),function(h){l.add(h,Number.POSITIVE_INFINITY),s.setNode(h)}),l.decrease(i.nodes()[0],0);for(var d=!1;l.size()>0;){if(u=l.removeMin(),t.has(o,u))s.setEdge(u,o[u]);else{if(d)throw new Error("Input graph is not connected: "+i);d=!0}i.nodeEdges(u).forEach(c)}return s}return nk}var rk,AW;function pit(){return AW||(AW=1,rk={components:sit(),dijkstra:Pue(),dijkstraAll:oit(),findCycles:lit(),floydWarshall:uit(),isAcyclic:cit(),postorder:dit(),preorder:hit(),prim:fit(),tarjan:Due(),topsort:Oue()}),rk}var ik,kW;function mit(){if(kW)return ik;kW=1;var t=iit();return ik={Graph:t.Graph,json:ait(),alg:pit(),version:t.version},ik}var ak,IW;function sl(){if(IW)return ak;IW=1;var t;if(typeof Y7=="function")try{t=mit()}catch{}return t||(t=window.graphlib),ak=t,ak}var sk,NW;function git(){if(NW)return sk;NW=1;var t=oue(),e=1,n=4;function r(i){return t(i,e|n)}return sk=r,sk}var ok,RW;function xS(){if(RW)return ok;RW=1;var t=nm(),e=Qu(),n=cS(),r=Co();function i(a,s,o){if(!r(o))return!1;var l=typeof s;return(l=="number"?e(o)&&n(s,o.length):l=="string"&&s in o)?t(o[s],a):!1}return ok=i,ok}var lk,PW;function vit(){if(PW)return lk;PW=1;var t=yS(),e=nm(),n=xS(),r=Af(),i=Object.prototype,a=i.hasOwnProperty,s=t(function(o,l){o=Object(o);var u=-1,c=l.length,d=c>2?l[2]:void 0;for(d&&n(l[0],l[1],d)&&(c=1);++u<c;)for(var h=l[u],f=r(h),m=-1,x=f.length;++m<x;){var b=f[m],y=o[b];(y===void 0||e(y,i[b])&&!a.call(o,b))&&(o[b]=h[b])}return o});return lk=s,lk}var uk,DW;function yit(){if(DW)return uk;DW=1;var t=ec(),e=Qu(),n=Ed();function r(i){return function(a,s,o){var l=Object(a);if(!e(a)){var u=t(s,3);a=n(a),s=function(d){return u(l[d],d,l)}}var c=i(a,s,o);return c>-1?l[u?a[c]:c]:void 0}}return uk=r,uk}var ck,OW;function xit(){if(OW)return ck;OW=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return ck=e,ck}var dk,LW;function bit(){if(LW)return dk;LW=1;var t=xit(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return dk=n,dk}var hk,FW;function _it(){if(FW)return hk;FW=1;var t=bit(),e=Co(),n=sm(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(n(u))return r;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=t(u);var d=a.test(u);return d||s.test(u)?o(u.slice(2),d?2:8):i.test(u)?r:+u}return hk=l,hk}var fk,BW;function Fue(){if(BW)return fk;BW=1;var t=_it(),e=1/0,n=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-e){var a=i<0?-1:1;return a*n}return i===i?i:0}return fk=r,fk}var pk,UW;function wit(){if(UW)return pk;UW=1;var t=Fue();function e(n){var r=t(n),i=r%1;return r===r?i?r-i:r:0}return pk=e,pk}var mk,zW;function Sit(){if(zW)return mk;zW=1;var t=kue(),e=ec(),n=wit(),r=Math.max;function i(a,s,o){var l=a==null?0:a.length;if(!l)return-1;var u=o==null?0:n(o);return u<0&&(u=r(l+u,0)),t(a,e(s,3),u)}return mk=i,mk}var gk,jW;function Eit(){if(jW)return gk;jW=1;var t=yit(),e=Sit(),n=t(e);return gk=n,gk}var vk,HW;function Bue(){if(HW)return vk;HW=1;var t=uP();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return vk=e,vk}var yk,$W;function Tit(){if($W)return yk;$W=1;var t=aP(),e=lue(),n=Af();function r(i,a){return i==null?i:t(i,e(a),n)}return yk=r,yk}var xk,VW;function Cit(){if(VW)return xk;VW=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return xk=t,xk}var bk,qW;function Mit(){if(qW)return bk;qW=1;var t=lS(),e=sP(),n=ec();function r(i,a){var s={};return a=n(a,3),e(i,function(o,l,u){t(s,l,a(o,l,u))}),s}return bk=r,bk}var _k,GW;function dP(){if(GW)return _k;GW=1;var t=sm();function e(n,r,i){for(var a=-1,s=n.length;++a<s;){var o=n[a],l=r(o);if(l!=null&&(u===void 0?l===l&&!t(l):i(l,u)))var u=l,c=o}return c}return _k=e,_k}var wk,WW;function Ait(){if(WW)return wk;WW=1;function t(e,n){return e>n}return wk=t,wk}var Sk,YW;function kit(){if(YW)return Sk;YW=1;var t=dP(),e=Ait(),n=kf();function r(i){return i&&i.length?t(i,n,e):void 0}return Sk=r,Sk}var Ek,XW;function Uue(){if(XW)return Ek;XW=1;var t=lS(),e=nm();function n(r,i,a){(a!==void 0&&!e(r[i],a)||a===void 0&&!(i in r))&&t(r,i,a)}return Ek=n,Ek}var Tk,KW;function Iit(){if(KW)return Tk;KW=1;var t=Cf(),e=fS(),n=nu(),r="[object Object]",i=Function.prototype,a=Object.prototype,s=i.toString,o=a.hasOwnProperty,l=s.call(Object);function u(c){if(!n(c)||t(c)!=r)return!1;var d=e(c);if(d===null)return!0;var h=o.call(d,"constructor")&&d.constructor;return typeof h=="function"&&h instanceof h&&s.call(h)==l}return Tk=u,Tk}var Ck,ZW;function zue(){if(ZW)return Ck;ZW=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return Ck=t,Ck}var Mk,JW;function Nit(){if(JW)return Mk;JW=1;var t=ry(),e=Af();function n(r){return t(r,e(r))}return Mk=n,Mk}var Ak,QW;function Rit(){if(QW)return Ak;QW=1;var t=Uue(),e=Xle(),n=iue(),r=Kle(),i=sue(),a=iy(),s=Wi(),o=Iue(),l=im(),u=ny(),c=Co(),d=Iit(),h=ay(),f=zue(),m=Nit();function x(b,y,w,_,S,M,E){var C=f(b,w),R=f(y,w),k=E.get(R);if(k){t(b,w,k);return}var I=M?M(C,R,w+"",b,y,E):void 0,N=I===void 0;if(N){var D=s(R),F=!D&&l(R),L=!D&&!F&&h(R);I=R,D||F||L?s(C)?I=C:o(C)?I=r(C):F?(N=!1,I=e(R,!0)):L?(N=!1,I=n(R,!0)):I=[]:d(R)||a(R)?(I=C,a(C)?I=m(C):(!c(C)||u(C))&&(I=i(R))):N=!1}N&&(E.set(R,I),S(I,R,_,M,E),E.delete(R)),t(b,w,I)}return Ak=x,Ak}var kk,eY;function Pit(){if(eY)return kk;eY=1;var t=oS(),e=Uue(),n=aP(),r=Rit(),i=Co(),a=Af(),s=zue();function o(l,u,c,d,h){l!==u&&n(u,function(f,m){if(h||(h=new t),i(f))r(l,u,m,c,o,d,h);else{var x=d?d(s(l,m),f,m+"",l,u,h):void 0;x===void 0&&(x=f),e(l,m,x)}},a)}return kk=o,kk}var Ik,tY;function Dit(){if(tY)return Ik;tY=1;var t=yS(),e=xS();function n(r){return t(function(i,a){var s=-1,o=a.length,l=o>1?a[o-1]:void 0,u=o>2?a[2]:void 0;for(l=r.length>3&&typeof l=="function"?(o--,l):void 0,u&&e(a[0],a[1],u)&&(l=o<3?void 0:l,o=1),i=Object(i);++s<o;){var c=a[s];c&&r(i,c,s,l)}return i})}return Ik=n,Ik}var Nk,nY;function Oit(){if(nY)return Nk;nY=1;var t=Pit(),e=Dit(),n=e(function(r,i,a){t(r,i,a)});return Nk=n,Nk}var Rk,rY;function jue(){if(rY)return Rk;rY=1;function t(e,n){return e<n}return Rk=t,Rk}var Pk,iY;function Lit(){if(iY)return Pk;iY=1;var t=dP(),e=jue(),n=kf();function r(i){return i&&i.length?t(i,n,e):void 0}return Pk=r,Pk}var Dk,aY;function Fit(){if(aY)return Dk;aY=1;var t=dP(),e=ec(),n=jue();function r(i,a){return i&&i.length?t(i,e(a,2),n):void 0}return Dk=r,Dk}var Ok,sY;function Bit(){if(sY)return Ok;sY=1;var t=cl(),e=function(){return t.Date.now()};return Ok=e,Ok}var Lk,oY;function Uit(){if(oY)return Lk;oY=1;var t=uS(),e=gS(),n=cS(),r=Co(),i=sy();function a(s,o,l,u){if(!r(s))return s;o=e(o,s);for(var c=-1,d=o.length,h=d-1,f=s;f!=null&&++c<d;){var m=i(o[c]),x=l;if(m==="__proto__"||m==="constructor"||m==="prototype")return s;if(c!=h){var b=f[m];x=u?u(b,m,f):void 0,x===void 0&&(x=r(b)?b:n(o[c+1])?[]:{})}t(f,m,x),f=f[m]}return s}return Lk=a,Lk}var Fk,lY;function zit(){if(lY)return Fk;lY=1;var t=vS(),e=Uit(),n=gS();function r(i,a,s){for(var o=-1,l=a.length,u={};++o<l;){var c=a[o],d=t(i,c);s(d,c)&&e(u,n(c,i),d)}return u}return Fk=r,Fk}var Bk,uY;function jit(){if(uY)return Bk;uY=1;var t=zit(),e=xue();function n(r,i){return t(r,i,function(a,s){return e(r,s)})}return Bk=n,Bk}var Uk,cY;function Hit(){if(cY)return Uk;cY=1;var t=Bue(),e=Mue(),n=Aue();function r(i){return n(e(i,void 0,t),i+"")}return Uk=r,Uk}var zk,dY;function $it(){if(dY)return zk;dY=1;var t=jit(),e=Hit(),n=e(function(r,i){return r==null?{}:t(r,i)});return zk=n,zk}var jk,hY;function Vit(){if(hY)return jk;hY=1;var t=Math.ceil,e=Math.max;function n(r,i,a,s){for(var o=-1,l=e(t((i-r)/(a||1)),0),u=Array(l);l--;)u[s?l:++o]=r,r+=a;return u}return jk=n,jk}var Hk,fY;function qit(){if(fY)return Hk;fY=1;var t=Vit(),e=xS(),n=Fue();function r(i){return function(a,s,o){return o&&typeof o!="number"&&e(a,s,o)&&(s=o=void 0),a=n(a),s===void 0?(s=a,a=0):s=n(s),o=o===void 0?a<s?1:-1:n(o),t(a,s,o,i)}}return Hk=r,Hk}var $k,pY;function Git(){if(pY)return $k;pY=1;var t=qit(),e=t();return $k=e,$k}var Vk,mY;function Wit(){if(mY)return Vk;mY=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return Vk=t,Vk}var qk,gY;function Yit(){if(gY)return qk;gY=1;var t=sm();function e(n,r){if(n!==r){var i=n!==void 0,a=n===null,s=n===n,o=t(n),l=r!==void 0,u=r===null,c=r===r,d=t(r);if(!u&&!d&&!o&&n>r||o&&l&&c&&!u&&!d||a&&l&&c||!i&&c||!s)return 1;if(!a&&!o&&!d&&n<r||d&&i&&s&&!a&&!o||u&&i&&s||!l&&s||!c)return-1}return 0}return qk=e,qk}var Gk,vY;function Xit(){if(vY)return Gk;vY=1;var t=Yit();function e(n,r,i){for(var a=-1,s=n.criteria,o=r.criteria,l=s.length,u=i.length;++a<l;){var c=t(s[a],o[a]);if(c){if(a>=u)return c;var d=i[a];return c*(d=="desc"?-1:1)}}return n.index-r.index}return Gk=e,Gk}var Wk,yY;function Kit(){if(yY)return Wk;yY=1;var t=mS(),e=vS(),n=ec(),r=Eue(),i=Wit(),a=dS(),s=Xit(),o=kf(),l=Wi();function u(c,d,h){d.length?d=t(d,function(x){return l(x)?function(b){return e(b,x.length===1?x[0]:x)}:x}):d=[o];var f=-1;d=t(d,a(n));var m=r(c,function(x,b,y){var w=t(d,function(_){return _(x)});return{criteria:w,index:++f,value:x}});return i(m,function(x,b){return s(x,b,h)})}return Wk=u,Wk}var Yk,xY;function Zit(){if(xY)return Yk;xY=1;var t=uP(),e=Kit(),n=yS(),r=xS(),i=n(function(a,s){if(a==null)return[];var o=s.length;return o>1&&r(a,s[0],s[1])?s=[]:o>2&&r(s[0],s[1],s[2])&&(s=[s[0]]),e(a,t(s,1),[])});return Yk=i,Yk}var Xk,bY;function Jit(){if(bY)return Xk;bY=1;var t=vue(),e=0;function n(r){var i=++e;return t(r)+i}return Xk=n,Xk}var Kk,_Y;function Qit(){if(_Y)return Kk;_Y=1;function t(e,n,r){for(var i=-1,a=e.length,s=n.length,o={};++i<a;){var l=i<s?n[i]:void 0;r(o,e[i],l)}return o}return Kk=t,Kk}var Zk,wY;function eat(){if(wY)return Zk;wY=1;var t=uS(),e=Qit();function n(r,i){return e(r||[],i||[],t)}return Zk=n,Zk}var Jk,SY;function ni(){if(SY)return Jk;SY=1;var t;if(typeof Y7=="function")try{t={cloneDeep:git(),constant:iP(),defaults:vit(),each:cue(),filter:_ue(),find:Eit(),flatten:Bue(),forEach:uue(),forIn:Tit(),has:wue(),isUndefined:Sue(),last:Cit(),map:Tue(),mapValues:Mit(),max:kit(),merge:Oit(),min:Lit(),minBy:Fit(),now:Bit(),pick:$it(),range:Git(),reduce:Cue(),sortBy:Zit(),uniqueId:Jit(),values:Nue(),zipObject:eat()}}catch{}return t||(t=window._),Jk=t,Jk}var Qk,EY;function tat(){if(EY)return Qk;EY=1,Qk=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},t.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},t.prototype.toString=function(){for(var r=[],i=this._sentinel,a=i._prev;a!==i;)r.push(JSON.stringify(a,n)),a=a._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,i){if(r!=="_next"&&r!=="_prev")return i}return Qk}var e6,TY;function nat(){if(TY)return e6;TY=1;var t=ni(),e=sl().Graph,n=tat();e6=i;var r=t.constant(1);function i(u,c){if(u.nodeCount()<=1)return[];var d=o(u,c||r),h=a(d.graph,d.buckets,d.zeroIdx);return t.flatten(t.map(h,function(f){return u.outEdges(f.v,f.w)}),!0)}function a(u,c,d){for(var h=[],f=c[c.length-1],m=c[0],x;u.nodeCount();){for(;x=m.dequeue();)s(u,c,d,x);for(;x=f.dequeue();)s(u,c,d,x);if(u.nodeCount()){for(var b=c.length-2;b>0;--b)if(x=c[b].dequeue(),x){h=h.concat(s(u,c,d,x,!0));break}}}return h}function s(u,c,d,h,f){var m=f?[]:void 0;return t.forEach(u.inEdges(h.v),function(x){var b=u.edge(x),y=u.node(x.v);f&&m.push({v:x.v,w:x.w}),y.out-=b,l(c,d,y)}),t.forEach(u.outEdges(h.v),function(x){var b=u.edge(x),y=x.w,w=u.node(y);w.in-=b,l(c,d,w)}),u.removeNode(h.v),m}function o(u,c){var d=new e,h=0,f=0;t.forEach(u.nodes(),function(b){d.setNode(b,{v:b,in:0,out:0})}),t.forEach(u.edges(),function(b){var y=d.edge(b.v,b.w)||0,w=c(b),_=y+w;d.setEdge(b.v,b.w,_),f=Math.max(f,d.node(b.v).out+=w),h=Math.max(h,d.node(b.w).in+=w)});var m=t.range(f+h+3).map(function(){return new n}),x=h+1;return t.forEach(d.nodes(),function(b){l(m,x,d.node(b))}),{graph:d,buckets:m,zeroIdx:x}}function l(u,c,d){d.out?d.in?u[d.out-d.in+c].enqueue(d):u[u.length-1].enqueue(d):u[0].enqueue(d)}return e6}var t6,CY;function rat(){if(CY)return t6;CY=1;var t=ni(),e=nat();t6={run:n,undo:i};function n(a){var s=a.graph().acyclicer==="greedy"?e(a,o(a)):r(a);t.forEach(s,function(l){var u=a.edge(l);a.removeEdge(l),u.forwardName=l.name,u.reversed=!0,a.setEdge(l.w,l.v,u,t.uniqueId("rev"))});function o(l){return function(u){return l.edge(u).weight}}}function r(a){var s=[],o={},l={};function u(c){t.has(l,c)||(l[c]=!0,o[c]=!0,t.forEach(a.outEdges(c),function(d){t.has(o,d.w)?s.push(d):u(d.w)}),delete o[c])}return t.forEach(a.nodes(),u),s}function i(a){t.forEach(a.edges(),function(s){var o=a.edge(s);if(o.reversed){a.removeEdge(s);var l=o.forwardName;delete o.reversed,delete o.forwardName,a.setEdge(s.w,s.v,o,l)}})}return t6}var n6,MY;function ws(){if(MY)return n6;MY=1;var t=ni(),e=sl().Graph;n6={addDummyNode:n,simplify:r,asNonCompoundGraph:i,successorWeights:a,predecessorWeights:s,intersectRect:o,buildLayerMatrix:l,normalizeRanks:u,removeEmptyRanks:c,addBorderNode:d,maxRank:h,partition:f,time:m,notime:x};function n(b,y,w,_){var S;do S=t.uniqueId(_);while(b.hasNode(S));return w.dummy=y,b.setNode(S,w),S}function r(b){var y=new e().setGraph(b.graph());return t.forEach(b.nodes(),function(w){y.setNode(w,b.node(w))}),t.forEach(b.edges(),function(w){var _=y.edge(w.v,w.w)||{weight:0,minlen:1},S=b.edge(w);y.setEdge(w.v,w.w,{weight:_.weight+S.weight,minlen:Math.max(_.minlen,S.minlen)})}),y}function i(b){var y=new e({multigraph:b.isMultigraph()}).setGraph(b.graph());return t.forEach(b.nodes(),function(w){b.children(w).length||y.setNode(w,b.node(w))}),t.forEach(b.edges(),function(w){y.setEdge(w,b.edge(w))}),y}function a(b){var y=t.map(b.nodes(),function(w){var _={};return t.forEach(b.outEdges(w),function(S){_[S.w]=(_[S.w]||0)+b.edge(S).weight}),_});return t.zipObject(b.nodes(),y)}function s(b){var y=t.map(b.nodes(),function(w){var _={};return t.forEach(b.inEdges(w),function(S){_[S.v]=(_[S.v]||0)+b.edge(S).weight}),_});return t.zipObject(b.nodes(),y)}function o(b,y){var w=b.x,_=b.y,S=y.x-w,M=y.y-_,E=b.width/2,C=b.height/2;if(!S&&!M)throw new Error("Not possible to find intersection inside of the rectangle");var R,k;return Math.abs(M)*E>Math.abs(S)*C?(M<0&&(C=-C),R=C*S/M,k=C):(S<0&&(E=-E),R=E,k=E*M/S),{x:w+R,y:_+k}}function l(b){var y=t.map(t.range(h(b)+1),function(){return[]});return t.forEach(b.nodes(),function(w){var _=b.node(w),S=_.rank;t.isUndefined(S)||(y[S][_.order]=w)}),y}function u(b){var y=t.min(t.map(b.nodes(),function(w){return b.node(w).rank}));t.forEach(b.nodes(),function(w){var _=b.node(w);t.has(_,"rank")&&(_.rank-=y)})}function c(b){var y=t.min(t.map(b.nodes(),function(M){return b.node(M).rank})),w=[];t.forEach(b.nodes(),function(M){var E=b.node(M).rank-y;w[E]||(w[E]=[]),w[E].push(M)});var _=0,S=b.graph().nodeRankFactor;t.forEach(w,function(M,E){t.isUndefined(M)&&E%S!==0?--_:_&&t.forEach(M,function(C){b.node(C).rank+=_})})}function d(b,y,w,_){var S={width:0,height:0};return arguments.length>=4&&(S.rank=w,S.order=_),n(b,"border",S,y)}function h(b){return t.max(t.map(b.nodes(),function(y){var w=b.node(y).rank;if(!t.isUndefined(w))return w}))}function f(b,y){var w={lhs:[],rhs:[]};return t.forEach(b,function(_){y(_)?w.lhs.push(_):w.rhs.push(_)}),w}function m(b,y){var w=t.now();try{return y()}finally{console.log(b+" time: "+(t.now()-w)+"ms")}}function x(b,y){return y()}return n6}var r6,AY;function iat(){if(AY)return r6;AY=1;var t=ni(),e=ws();r6={run:n,undo:i};function n(a){a.graph().dummyChains=[],t.forEach(a.edges(),function(s){r(a,s)})}function r(a,s){var o=s.v,l=a.node(o).rank,u=s.w,c=a.node(u).rank,d=s.name,h=a.edge(s),f=h.labelRank;if(c!==l+1){a.removeEdge(s);var m,x,b;for(b=0,++l;l<c;++b,++l)h.points=[],x={width:0,height:0,edgeLabel:h,edgeObj:s,rank:l},m=e.addDummyNode(a,"edge",x,"_d"),l===f&&(x.width=h.width,x.height=h.height,x.dummy="edge-label",x.labelpos=h.labelpos),a.setEdge(o,m,{weight:h.weight},d),b===0&&a.graph().dummyChains.push(m),o=m;a.setEdge(o,u,{weight:h.weight},d)}}function i(a){t.forEach(a.graph().dummyChains,function(s){var o=a.node(s),l=o.edgeLabel,u;for(a.setEdge(o.edgeObj,l);o.dummy;)u=a.successors(s)[0],a.removeNode(s),l.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(l.x=o.x,l.y=o.y,l.width=o.width,l.height=o.height),s=u,o=a.node(s)})}return r6}var i6,kY;function r2(){if(kY)return i6;kY=1;var t=ni();i6={longestPath:e,slack:n};function e(r){var i={};function a(s){var o=r.node(s);if(t.has(i,s))return o.rank;i[s]=!0;var l=t.min(t.map(r.outEdges(s),function(u){return a(u.w)-r.edge(u).minlen}));return(l===Number.POSITIVE_INFINITY||l===void 0||l===null)&&(l=0),o.rank=l}t.forEach(r.sources(),a)}function n(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return i6}var a6,IY;function Hue(){if(IY)return a6;IY=1;var t=ni(),e=sl().Graph,n=r2().slack;a6=r;function r(o){var l=new e({directed:!1}),u=o.nodes()[0],c=o.nodeCount();l.setNode(u,{});for(var d,h;i(l,o)<c;)d=a(l,o),h=l.hasNode(d.v)?n(o,d):-n(o,d),s(l,o,h);return l}function i(o,l){function u(c){t.forEach(l.nodeEdges(c),function(d){var h=d.v,f=c===h?d.w:h;!o.hasNode(f)&&!n(l,d)&&(o.setNode(f,{}),o.setEdge(c,f,{}),u(f))})}return t.forEach(o.nodes(),u),o.nodeCount()}function a(o,l){return t.minBy(l.edges(),function(u){if(o.hasNode(u.v)!==o.hasNode(u.w))return n(l,u)})}function s(o,l,u){t.forEach(o.nodes(),function(c){l.node(c).rank+=u})}return a6}var s6,NY;function aat(){if(NY)return s6;NY=1;var t=ni(),e=Hue(),n=r2().slack,r=r2().longestPath,i=sl().alg.preorder,a=sl().alg.postorder,s=ws().simplify;s6=o,o.initLowLimValues=d,o.initCutValues=l,o.calcCutValue=c,o.leaveEdge=f,o.enterEdge=m,o.exchangeEdges=x;function o(_){_=s(_),r(_);var S=e(_);d(S),l(S,_);for(var M,E;M=f(S);)E=m(S,_,M),x(S,_,M,E)}function l(_,S){var M=a(_,_.nodes());M=M.slice(0,M.length-1),t.forEach(M,function(E){u(_,S,E)})}function u(_,S,M){var E=_.node(M),C=E.parent;_.edge(M,C).cutvalue=c(_,S,M)}function c(_,S,M){var E=_.node(M),C=E.parent,R=!0,k=S.edge(M,C),I=0;return k||(R=!1,k=S.edge(C,M)),I=k.weight,t.forEach(S.nodeEdges(M),function(N){var D=N.v===M,F=D?N.w:N.v;if(F!==C){var L=D===R,U=S.edge(N).weight;if(I+=L?U:-U,y(_,M,F)){var j=_.edge(M,F).cutvalue;I+=L?-j:j}}}),I}function d(_,S){arguments.length<2&&(S=_.nodes()[0]),h(_,{},1,S)}function h(_,S,M,E,C){var R=M,k=_.node(E);return S[E]=!0,t.forEach(_.neighbors(E),function(I){t.has(S,I)||(M=h(_,S,M,I,E))}),k.low=R,k.lim=M++,C?k.parent=C:delete k.parent,M}function f(_){return t.find(_.edges(),function(S){return _.edge(S).cutvalue<0})}function m(_,S,M){var E=M.v,C=M.w;S.hasEdge(E,C)||(E=M.w,C=M.v);var R=_.node(E),k=_.node(C),I=R,N=!1;R.lim>k.lim&&(I=k,N=!0);var D=t.filter(S.edges(),function(F){return N===w(_,_.node(F.v),I)&&N!==w(_,_.node(F.w),I)});return t.minBy(D,function(F){return n(S,F)})}function x(_,S,M,E){var C=M.v,R=M.w;_.removeEdge(C,R),_.setEdge(E.v,E.w,{}),d(_),l(_,S),b(_,S)}function b(_,S){var M=t.find(_.nodes(),function(C){return!S.node(C).parent}),E=i(_,M);E=E.slice(1),t.forEach(E,function(C){var R=_.node(C).parent,k=S.edge(C,R),I=!1;k||(k=S.edge(R,C),I=!0),S.node(C).rank=S.node(R).rank+(I?k.minlen:-k.minlen)})}function y(_,S,M){return _.hasEdge(S,M)}function w(_,S,M){return M.low<=S.lim&&S.lim<=M.lim}return s6}var o6,RY;function sat(){if(RY)return o6;RY=1;var t=r2(),e=t.longestPath,n=Hue(),r=aat();o6=i;function i(l){switch(l.graph().ranker){case"network-simplex":o(l);break;case"tight-tree":s(l);break;case"longest-path":a(l);break;default:o(l)}}var a=e;function s(l){e(l),n(l)}function o(l){r(l)}return o6}var l6,PY;function oat(){if(PY)return l6;PY=1;var t=ni();l6=e;function e(i){var a=r(i);t.forEach(i.graph().dummyChains,function(s){for(var o=i.node(s),l=o.edgeObj,u=n(i,a,l.v,l.w),c=u.path,d=u.lca,h=0,f=c[h],m=!0;s!==l.w;){if(o=i.node(s),m){for(;(f=c[h])!==d&&i.node(f).maxRank<o.rank;)h++;f===d&&(m=!1)}if(!m){for(;h<c.length-1&&i.node(f=c[h+1]).minRank<=o.rank;)h++;f=c[h]}i.setParent(s,f),s=i.successors(s)[0]}})}function n(i,a,s,o){var l=[],u=[],c=Math.min(a[s].low,a[o].low),d=Math.max(a[s].lim,a[o].lim),h,f;h=s;do h=i.parent(h),l.push(h);while(h&&(a[h].low>c||d>a[h].lim));for(f=h,h=o;(h=i.parent(h))!==f;)u.push(h);return{path:l.concat(u.reverse()),lca:f}}function r(i){var a={},s=0;function o(l){var u=s;t.forEach(i.children(l),o),a[l]={low:u,lim:s++}}return t.forEach(i.children(),o),a}return l6}var u6,DY;function lat(){if(DY)return u6;DY=1;var t=ni(),e=ws();u6={run:n,cleanup:s};function n(o){var l=e.addDummyNode(o,"root",{},"_root"),u=i(o),c=t.max(t.values(u))-1,d=2*c+1;o.graph().nestingRoot=l,t.forEach(o.edges(),function(f){o.edge(f).minlen*=d});var h=a(o)+1;t.forEach(o.children(),function(f){r(o,l,d,h,c,u,f)}),o.graph().nodeRankFactor=d}function r(o,l,u,c,d,h,f){var m=o.children(f);if(!m.length){f!==l&&o.setEdge(l,f,{weight:0,minlen:u});return}var x=e.addBorderNode(o,"_bt"),b=e.addBorderNode(o,"_bb"),y=o.node(f);o.setParent(x,f),y.borderTop=x,o.setParent(b,f),y.borderBottom=b,t.forEach(m,function(w){r(o,l,u,c,d,h,w);var _=o.node(w),S=_.borderTop?_.borderTop:w,M=_.borderBottom?_.borderBottom:w,E=_.borderTop?c:2*c,C=S!==M?1:d-h[f]+1;o.setEdge(x,S,{weight:E,minlen:C,nestingEdge:!0}),o.setEdge(M,b,{weight:E,minlen:C,nestingEdge:!0})}),o.parent(f)||o.setEdge(l,x,{weight:0,minlen:d+h[f]})}function i(o){var l={};function u(c,d){var h=o.children(c);h&&h.length&&t.forEach(h,function(f){u(f,d+1)}),l[c]=d}return t.forEach(o.children(),function(c){u(c,1)}),l}function a(o){return t.reduce(o.edges(),function(l,u){return l+o.edge(u).weight},0)}function s(o){var l=o.graph();o.removeNode(l.nestingRoot),delete l.nestingRoot,t.forEach(o.edges(),function(u){var c=o.edge(u);c.nestingEdge&&o.removeEdge(u)})}return u6}var c6,OY;function uat(){if(OY)return c6;OY=1;var t=ni(),e=ws();c6=n;function n(i){function a(s){var o=i.children(s),l=i.node(s);if(o.length&&t.forEach(o,a),t.has(l,"minRank")){l.borderLeft=[],l.borderRight=[];for(var u=l.minRank,c=l.maxRank+1;u<c;++u)r(i,"borderLeft","_bl",s,l,u),r(i,"borderRight","_br",s,l,u)}}t.forEach(i.children(),a)}function r(i,a,s,o,l,u){var c={width:0,height:0,rank:u,borderType:a},d=l[a][u-1],h=e.addDummyNode(i,"border",c,s);l[a][u]=h,i.setParent(h,o),d&&i.setEdge(d,h,{weight:1})}return c6}var d6,LY;function cat(){if(LY)return d6;LY=1;var t=ni();d6={adjust:e,undo:n};function e(u){var c=u.graph().rankdir.toLowerCase();(c==="lr"||c==="rl")&&r(u)}function n(u){var c=u.graph().rankdir.toLowerCase();(c==="bt"||c==="rl")&&a(u),(c==="lr"||c==="rl")&&(o(u),r(u))}function r(u){t.forEach(u.nodes(),function(c){i(u.node(c))}),t.forEach(u.edges(),function(c){i(u.edge(c))})}function i(u){var c=u.width;u.width=u.height,u.height=c}function a(u){t.forEach(u.nodes(),function(c){s(u.node(c))}),t.forEach(u.edges(),function(c){var d=u.edge(c);t.forEach(d.points,s),t.has(d,"y")&&s(d)})}function s(u){u.y=-u.y}function o(u){t.forEach(u.nodes(),function(c){l(u.node(c))}),t.forEach(u.edges(),function(c){var d=u.edge(c);t.forEach(d.points,l),t.has(d,"x")&&l(d)})}function l(u){var c=u.x;u.x=u.y,u.y=c}return d6}var h6,FY;function dat(){if(FY)return h6;FY=1;var t=ni();h6=e;function e(n){var r={},i=t.filter(n.nodes(),function(u){return!n.children(u).length}),a=t.max(t.map(i,function(u){return n.node(u).rank})),s=t.map(t.range(a+1),function(){return[]});function o(u){if(!t.has(r,u)){r[u]=!0;var c=n.node(u);s[c.rank].push(u),t.forEach(n.successors(u),o)}}var l=t.sortBy(i,function(u){return n.node(u).rank});return t.forEach(l,o),s}return h6}var f6,BY;function hat(){if(BY)return f6;BY=1;var t=ni();f6=e;function e(r,i){for(var a=0,s=1;s<i.length;++s)a+=n(r,i[s-1],i[s]);return a}function n(r,i,a){for(var s=t.zipObject(a,t.map(a,function(h,f){return f})),o=t.flatten(t.map(i,function(h){return t.sortBy(t.map(r.outEdges(h),function(f){return{pos:s[f.w],weight:r.edge(f).weight}}),"pos")}),!0),l=1;l<a.length;)l<<=1;var u=2*l-1;l-=1;var c=t.map(new Array(u),function(){return 0}),d=0;return t.forEach(o.forEach(function(h){var f=h.pos+l;c[f]+=h.weight;for(var m=0;f>0;)f%2&&(m+=c[f+1]),f=f-1>>1,c[f]+=h.weight;d+=h.weight*m})),d}return f6}var p6,UY;function fat(){if(UY)return p6;UY=1;var t=ni();p6=e;function e(n,r){return t.map(r,function(i){var a=n.inEdges(i);if(a.length){var s=t.reduce(a,function(o,l){var u=n.edge(l),c=n.node(l.v);return{sum:o.sum+u.weight*c.order,weight:o.weight+u.weight}},{sum:0,weight:0});return{v:i,barycenter:s.sum/s.weight,weight:s.weight}}else return{v:i}})}return p6}var m6,zY;function pat(){if(zY)return m6;zY=1;var t=ni();m6=e;function e(i,a){var s={};t.forEach(i,function(l,u){var c=s[l.v]={indegree:0,in:[],out:[],vs:[l.v],i:u};t.isUndefined(l.barycenter)||(c.barycenter=l.barycenter,c.weight=l.weight)}),t.forEach(a.edges(),function(l){var u=s[l.v],c=s[l.w];!t.isUndefined(u)&&!t.isUndefined(c)&&(c.indegree++,u.out.push(s[l.w]))});var o=t.filter(s,function(l){return!l.indegree});return n(o)}function n(i){var a=[];function s(u){return function(c){c.merged||(t.isUndefined(c.barycenter)||t.isUndefined(u.barycenter)||c.barycenter>=u.barycenter)&&r(u,c)}}function o(u){return function(c){c.in.push(u),--c.indegree===0&&i.push(c)}}for(;i.length;){var l=i.pop();a.push(l),t.forEach(l.in.reverse(),s(l)),t.forEach(l.out,o(l))}return t.map(t.filter(a,function(u){return!u.merged}),function(u){return t.pick(u,["vs","i","barycenter","weight"])})}function r(i,a){var s=0,o=0;i.weight&&(s+=i.barycenter*i.weight,o+=i.weight),a.weight&&(s+=a.barycenter*a.weight,o+=a.weight),i.vs=a.vs.concat(i.vs),i.barycenter=s/o,i.weight=o,i.i=Math.min(a.i,i.i),a.merged=!0}return m6}var g6,jY;function mat(){if(jY)return g6;jY=1;var t=ni(),e=ws();g6=n;function n(a,s){var o=e.partition(a,function(x){return t.has(x,"barycenter")}),l=o.lhs,u=t.sortBy(o.rhs,function(x){return-x.i}),c=[],d=0,h=0,f=0;l.sort(i(!!s)),f=r(c,u,f),t.forEach(l,function(x){f+=x.vs.length,c.push(x.vs),d+=x.barycenter*x.weight,h+=x.weight,f=r(c,u,f)});var m={vs:t.flatten(c,!0)};return h&&(m.barycenter=d/h,m.weight=h),m}function r(a,s,o){for(var l;s.length&&(l=t.last(s)).i<=o;)s.pop(),a.push(l.vs),o++;return o}function i(a){return function(s,o){return s.barycenter<o.barycenter?-1:s.barycenter>o.barycenter?1:a?o.i-s.i:s.i-o.i}}return g6}var v6,HY;function gat(){if(HY)return v6;HY=1;var t=ni(),e=fat(),n=pat(),r=mat();v6=i;function i(o,l,u,c){var d=o.children(l),h=o.node(l),f=h?h.borderLeft:void 0,m=h?h.borderRight:void 0,x={};f&&(d=t.filter(d,function(M){return M!==f&&M!==m}));var b=e(o,d);t.forEach(b,function(M){if(o.children(M.v).length){var E=i(o,M.v,u,c);x[M.v]=E,t.has(E,"barycenter")&&s(M,E)}});var y=n(b,u);a(y,x);var w=r(y,c);if(f&&(w.vs=t.flatten([f,w.vs,m],!0),o.predecessors(f).length)){var _=o.node(o.predecessors(f)[0]),S=o.node(o.predecessors(m)[0]);t.has(w,"barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+_.order+S.order)/(w.weight+2),w.weight+=2}return w}function a(o,l){t.forEach(o,function(u){u.vs=t.flatten(u.vs.map(function(c){return l[c]?l[c].vs:c}),!0)})}function s(o,l){t.isUndefined(o.barycenter)?(o.barycenter=l.barycenter,o.weight=l.weight):(o.barycenter=(o.barycenter*o.weight+l.barycenter*l.weight)/(o.weight+l.weight),o.weight+=l.weight)}return v6}var y6,$Y;function vat(){if($Y)return y6;$Y=1;var t=ni(),e=sl().Graph;y6=n;function n(i,a,s){var o=r(i),l=new e({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(function(u){return i.node(u)});return t.forEach(i.nodes(),function(u){var c=i.node(u),d=i.parent(u);(c.rank===a||c.minRank<=a&&a<=c.maxRank)&&(l.setNode(u),l.setParent(u,d||o),t.forEach(i[s](u),function(h){var f=h.v===u?h.w:h.v,m=l.edge(f,u),x=t.isUndefined(m)?0:m.weight;l.setEdge(f,u,{weight:i.edge(h).weight+x})}),t.has(c,"minRank")&&l.setNode(u,{borderLeft:c.borderLeft[a],borderRight:c.borderRight[a]}))}),l}function r(i){for(var a;i.hasNode(a=t.uniqueId("_root")););return a}return y6}var x6,VY;function yat(){if(VY)return x6;VY=1;var t=ni();x6=e;function e(n,r,i){var a={},s;t.forEach(i,function(o){for(var l=n.parent(o),u,c;l;){if(u=n.parent(l),u?(c=a[u],a[u]=l):(c=s,s=l),c&&c!==l){r.setEdge(c,l);return}l=u}})}return x6}var b6,qY;function xat(){if(qY)return b6;qY=1;var t=ni(),e=dat(),n=hat(),r=gat(),i=vat(),a=yat(),s=sl().Graph,o=ws();b6=l;function l(h){var f=o.maxRank(h),m=u(h,t.range(1,f+1),"inEdges"),x=u(h,t.range(f-1,-1,-1),"outEdges"),b=e(h);d(h,b);for(var y=Number.POSITIVE_INFINITY,w,_=0,S=0;S<4;++_,++S){c(_%2?m:x,_%4>=2),b=o.buildLayerMatrix(h);var M=n(h,b);M<y&&(S=0,w=t.cloneDeep(b),y=M)}d(h,w)}function u(h,f,m){return t.map(f,function(x){return i(h,x,m)})}function c(h,f){var m=new s;t.forEach(h,function(x){var b=x.graph().root,y=r(x,b,m,f);t.forEach(y.vs,function(w,_){x.node(w).order=_}),a(x,m,y.vs)})}function d(h,f){t.forEach(f,function(m){t.forEach(m,function(x,b){h.node(x).order=b})})}return b6}var _6,GY;function bat(){if(GY)return _6;GY=1;var t=ni(),e=sl().Graph,n=ws();_6={positionX:m,findType1Conflicts:r,findType2Conflicts:i,addConflict:s,hasConflict:o,verticalAlignment:l,horizontalCompaction:u,alignCoordinates:h,findSmallestWidthAlignment:d,balance:f};function r(y,w){var _={};function S(M,E){var C=0,R=0,k=M.length,I=t.last(E);return t.forEach(E,function(N,D){var F=a(y,N),L=F?y.node(F).order:k;(F||N===I)&&(t.forEach(E.slice(R,D+1),function(U){t.forEach(y.predecessors(U),function(j){var q=y.node(j),Z=q.order;(Z<C||L<Z)&&!(q.dummy&&y.node(U).dummy)&&s(_,j,U)})}),R=D+1,C=L)}),E}return t.reduce(w,S),_}function i(y,w){var _={};function S(E,C,R,k,I){var N;t.forEach(t.range(C,R),function(D){N=E[D],y.node(N).dummy&&t.forEach(y.predecessors(N),function(F){var L=y.node(F);L.dummy&&(L.order<k||L.order>I)&&s(_,F,N)})})}function M(E,C){var R=-1,k,I=0;return t.forEach(C,function(N,D){if(y.node(N).dummy==="border"){var F=y.predecessors(N);F.length&&(k=y.node(F[0]).order,S(C,I,D,R,k),I=D,R=k)}S(C,I,C.length,k,E.length)}),C}return t.reduce(w,M),_}function a(y,w){if(y.node(w).dummy)return t.find(y.predecessors(w),function(_){return y.node(_).dummy})}function s(y,w,_){if(w>_){var S=w;w=_,_=S}var M=y[w];M||(y[w]=M={}),M[_]=!0}function o(y,w,_){if(w>_){var S=w;w=_,_=S}return t.has(y[w],_)}function l(y,w,_,S){var M={},E={},C={};return t.forEach(w,function(R){t.forEach(R,function(k,I){M[k]=k,E[k]=k,C[k]=I})}),t.forEach(w,function(R){var k=-1;t.forEach(R,function(I){var N=S(I);if(N.length){N=t.sortBy(N,function(j){return C[j]});for(var D=(N.length-1)/2,F=Math.floor(D),L=Math.ceil(D);F<=L;++F){var U=N[F];E[I]===I&&k<C[U]&&!o(_,I,U)&&(E[U]=I,E[I]=M[I]=M[U],k=C[U])}}})}),{root:M,align:E}}function u(y,w,_,S,M){var E={},C=c(y,w,_,M),R=M?"borderLeft":"borderRight";function k(D,F){for(var L=C.nodes(),U=L.pop(),j={};U;)j[U]?D(U):(j[U]=!0,L.push(U),L=L.concat(F(U))),U=L.pop()}function I(D){E[D]=C.inEdges(D).reduce(function(F,L){return Math.max(F,E[L.v]+C.edge(L))},0)}function N(D){var F=C.outEdges(D).reduce(function(U,j){return Math.min(U,E[j.w]-C.edge(j))},Number.POSITIVE_INFINITY),L=y.node(D);F!==Number.POSITIVE_INFINITY&&L.borderType!==R&&(E[D]=Math.max(E[D],F))}return k(I,C.predecessors.bind(C)),k(N,C.successors.bind(C)),t.forEach(S,function(D){E[D]=E[_[D]]}),E}function c(y,w,_,S){var M=new e,E=y.graph(),C=x(E.nodesep,E.edgesep,S);return t.forEach(w,function(R){var k;t.forEach(R,function(I){var N=_[I];if(M.setNode(N),k){var D=_[k],F=M.edge(D,N);M.setEdge(D,N,Math.max(C(y,I,k),F||0))}k=I})}),M}function d(y,w){return t.minBy(t.values(w),function(_){var S=Number.NEGATIVE_INFINITY,M=Number.POSITIVE_INFINITY;return t.forIn(_,function(E,C){var R=b(y,C)/2;S=Math.max(E+R,S),M=Math.min(E-R,M)}),S-M})}function h(y,w){var _=t.values(w),S=t.min(_),M=t.max(_);t.forEach(["u","d"],function(E){t.forEach(["l","r"],function(C){var R=E+C,k=y[R],I;if(k!==w){var N=t.values(k);I=C==="l"?S-t.min(N):M-t.max(N),I&&(y[R]=t.mapValues(k,function(D){return D+I}))}})})}function f(y,w){return t.mapValues(y.ul,function(_,S){if(w)return y[w.toLowerCase()][S];var M=t.sortBy(t.map(y,S));return(M[1]+M[2])/2})}function m(y){var w=n.buildLayerMatrix(y),_=t.merge(r(y,w),i(y,w)),S={},M;t.forEach(["u","d"],function(C){M=C==="u"?w:t.values(w).reverse(),t.forEach(["l","r"],function(R){R==="r"&&(M=t.map(M,function(D){return t.values(D).reverse()}));var k=(C==="u"?y.predecessors:y.successors).bind(y),I=l(y,M,_,k),N=u(y,M,I.root,I.align,R==="r");R==="r"&&(N=t.mapValues(N,function(D){return-D})),S[C+R]=N})});var E=d(y,S);return h(S,E),f(S,y.graph().align)}function x(y,w,_){return function(S,M,E){var C=S.node(M),R=S.node(E),k=0,I;if(k+=C.width/2,t.has(C,"labelpos"))switch(C.labelpos.toLowerCase()){case"l":I=-C.width/2;break;case"r":I=C.width/2;break}if(I&&(k+=_?I:-I),I=0,k+=(C.dummy?w:y)/2,k+=(R.dummy?w:y)/2,k+=R.width/2,t.has(R,"labelpos"))switch(R.labelpos.toLowerCase()){case"l":I=R.width/2;break;case"r":I=-R.width/2;break}return I&&(k+=_?I:-I),I=0,k}}function b(y,w){return y.node(w).width}return _6}var w6,WY;function _at(){if(WY)return w6;WY=1;var t=ni(),e=ws(),n=bat().positionX;w6=r;function r(a){a=e.asNonCompoundGraph(a),i(a),t.forEach(n(a),function(s,o){a.node(o).x=s})}function i(a){var s=e.buildLayerMatrix(a),o=a.graph().ranksep,l=0;t.forEach(s,function(u){var c=t.max(t.map(u,function(d){return a.node(d).height}));t.forEach(u,function(d){a.node(d).y=l+c/2}),l+=c+o})}return w6}var S6,YY;function wat(){if(YY)return S6;YY=1;var t=ni(),e=rat(),n=iat(),r=sat(),i=ws().normalizeRanks,a=oat(),s=ws().removeEmptyRanks,o=lat(),l=uat(),u=cat(),c=xat(),d=_at(),h=ws(),f=sl().Graph;S6=m;function m(J,te){var ee=te&&te.debugTiming?h.time:h.notime;ee("layout",function(){var se=ee("  buildLayoutGraph",function(){return k(J)});ee("  runLayout",function(){x(se,ee)}),ee("  updateInputGraph",function(){b(J,se)})})}function x(J,te){te("    makeSpaceForEdgeLabels",function(){I(J)}),te("    removeSelfEdges",function(){Q(J)}),te("    acyclic",function(){e.run(J)}),te("    nestingGraph.run",function(){o.run(J)}),te("    rank",function(){r(h.asNonCompoundGraph(J))}),te("    injectEdgeLabelProxies",function(){N(J)}),te("    removeEmptyRanks",function(){s(J)}),te("    nestingGraph.cleanup",function(){o.cleanup(J)}),te("    normalizeRanks",function(){i(J)}),te("    assignRankMinMax",function(){D(J)}),te("    removeEdgeLabelProxies",function(){F(J)}),te("    normalize.run",function(){n.run(J)}),te("    parentDummyChains",function(){a(J)}),te("    addBorderSegments",function(){l(J)}),te("    order",function(){c(J)}),te("    insertSelfEdges",function(){z(J)}),te("    adjustCoordinateSystem",function(){u.adjust(J)}),te("    position",function(){d(J)}),te("    positionSelfEdges",function(){W(J)}),te("    removeBorderNodes",function(){Z(J)}),te("    normalize.undo",function(){n.undo(J)}),te("    fixupEdgeLabelCoords",function(){j(J)}),te("    undoCoordinateSystem",function(){u.undo(J)}),te("    translateGraph",function(){L(J)}),te("    assignNodeIntersects",function(){U(J)}),te("    reversePoints",function(){q(J)}),te("    acyclic.undo",function(){e.undo(J)})}function b(J,te){t.forEach(J.nodes(),function(ee){var se=J.node(ee),ue=te.node(ee);se&&(se.x=ue.x,se.y=ue.y,te.children(ee).length&&(se.width=ue.width,se.height=ue.height))}),t.forEach(J.edges(),function(ee){var se=J.edge(ee),ue=te.edge(ee);se.points=ue.points,t.has(ue,"x")&&(se.x=ue.x,se.y=ue.y)}),J.graph().width=te.graph().width,J.graph().height=te.graph().height}var y=["nodesep","edgesep","ranksep","marginx","marginy"],w={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},_=["acyclicer","ranker","rankdir","align"],S=["width","height"],M={width:0,height:0},E=["minlen","weight","width","height","labeloffset"],C={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},R=["labelpos"];function k(J){var te=new f({multigraph:!0,compound:!0}),ee=H(J.graph());return te.setGraph(t.merge({},w,X(ee,y),t.pick(ee,_))),t.forEach(J.nodes(),function(se){var ue=H(J.node(se));te.setNode(se,t.defaults(X(ue,S),M)),te.setParent(se,J.parent(se))}),t.forEach(J.edges(),function(se){var ue=H(J.edge(se));te.setEdge(se,t.merge({},C,X(ue,E),t.pick(ue,R)))}),te}function I(J){var te=J.graph();te.ranksep/=2,t.forEach(J.edges(),function(ee){var se=J.edge(ee);se.minlen*=2,se.labelpos.toLowerCase()!=="c"&&(te.rankdir==="TB"||te.rankdir==="BT"?se.width+=se.labeloffset:se.height+=se.labeloffset)})}function N(J){t.forEach(J.edges(),function(te){var ee=J.edge(te);if(ee.width&&ee.height){var se=J.node(te.v),ue=J.node(te.w),oe={rank:(ue.rank-se.rank)/2+se.rank,e:te};h.addDummyNode(J,"edge-proxy",oe,"_ep")}})}function D(J){var te=0;t.forEach(J.nodes(),function(ee){var se=J.node(ee);se.borderTop&&(se.minRank=J.node(se.borderTop).rank,se.maxRank=J.node(se.borderBottom).rank,te=t.max(te,se.maxRank))}),J.graph().maxRank=te}function F(J){t.forEach(J.nodes(),function(te){var ee=J.node(te);ee.dummy==="edge-proxy"&&(J.edge(ee.e).labelRank=ee.rank,J.removeNode(te))})}function L(J){var te=Number.POSITIVE_INFINITY,ee=0,se=Number.POSITIVE_INFINITY,ue=0,oe=J.graph(),Te=oe.marginx||0,Ne=oe.marginy||0;function be(De){var ke=De.x,Me=De.y,Ie=De.width,ce=De.height;te=Math.min(te,ke-Ie/2),ee=Math.max(ee,ke+Ie/2),se=Math.min(se,Me-ce/2),ue=Math.max(ue,Me+ce/2)}t.forEach(J.nodes(),function(De){be(J.node(De))}),t.forEach(J.edges(),function(De){var ke=J.edge(De);t.has(ke,"x")&&be(ke)}),te-=Te,se-=Ne,t.forEach(J.nodes(),function(De){var ke=J.node(De);ke.x-=te,ke.y-=se}),t.forEach(J.edges(),function(De){var ke=J.edge(De);t.forEach(ke.points,function(Me){Me.x-=te,Me.y-=se}),t.has(ke,"x")&&(ke.x-=te),t.has(ke,"y")&&(ke.y-=se)}),oe.width=ee-te+Te,oe.height=ue-se+Ne}function U(J){t.forEach(J.edges(),function(te){var ee=J.edge(te),se=J.node(te.v),ue=J.node(te.w),oe,Te;ee.points?(oe=ee.points[0],Te=ee.points[ee.points.length-1]):(ee.points=[],oe=ue,Te=se),ee.points.unshift(h.intersectRect(se,oe)),ee.points.push(h.intersectRect(ue,Te))})}function j(J){t.forEach(J.edges(),function(te){var ee=J.edge(te);if(t.has(ee,"x"))switch((ee.labelpos==="l"||ee.labelpos==="r")&&(ee.width-=ee.labeloffset),ee.labelpos){case"l":ee.x-=ee.width/2+ee.labeloffset;break;case"r":ee.x+=ee.width/2+ee.labeloffset;break}})}function q(J){t.forEach(J.edges(),function(te){var ee=J.edge(te);ee.reversed&&ee.points.reverse()})}function Z(J){t.forEach(J.nodes(),function(te){if(J.children(te).length){var ee=J.node(te),se=J.node(ee.borderTop),ue=J.node(ee.borderBottom),oe=J.node(t.last(ee.borderLeft)),Te=J.node(t.last(ee.borderRight));ee.width=Math.abs(Te.x-oe.x),ee.height=Math.abs(ue.y-se.y),ee.x=oe.x+ee.width/2,ee.y=se.y+ee.height/2}}),t.forEach(J.nodes(),function(te){J.node(te).dummy==="border"&&J.removeNode(te)})}function Q(J){t.forEach(J.edges(),function(te){if(te.v===te.w){var ee=J.node(te.v);ee.selfEdges||(ee.selfEdges=[]),ee.selfEdges.push({e:te,label:J.edge(te)}),J.removeEdge(te)}})}function z(J){var te=h.buildLayerMatrix(J);t.forEach(te,function(ee){var se=0;t.forEach(ee,function(ue,oe){var Te=J.node(ue);Te.order=oe+se,t.forEach(Te.selfEdges,function(Ne){h.addDummyNode(J,"selfedge",{width:Ne.label.width,height:Ne.label.height,rank:Te.rank,order:oe+ ++se,e:Ne.e,label:Ne.label},"_se")}),delete Te.selfEdges})})}function W(J){t.forEach(J.nodes(),function(te){var ee=J.node(te);if(ee.dummy==="selfedge"){var se=J.node(ee.e.v),ue=se.x+se.width/2,oe=se.y,Te=ee.x-ue,Ne=se.height/2;J.setEdge(ee.e,ee.label),J.removeNode(te),ee.label.points=[{x:ue+2*Te/3,y:oe-Ne},{x:ue+5*Te/6,y:oe-Ne},{x:ue+Te,y:oe},{x:ue+5*Te/6,y:oe+Ne},{x:ue+2*Te/3,y:oe+Ne}],ee.label.x=ee.x,ee.label.y=ee.y}})}function X(J,te){return t.mapValues(t.pick(J,te),Number)}function H(J){var te={};return t.forEach(J,function(ee,se){te[se.toLowerCase()]=ee}),te}return S6}var E6,XY;function Sat(){if(XY)return E6;XY=1;var t=ni(),e=ws(),n=sl().Graph;E6={debugOrdering:r};function r(i){var a=e.buildLayerMatrix(i),s=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(i.nodes(),function(o){s.setNode(o,{label:o}),s.setParent(o,"layer"+i.node(o).rank)}),t.forEach(i.edges(),function(o){s.setEdge(o.v,o.w,{},o.name)}),t.forEach(a,function(o,l){var u="layer"+l;s.setNode(u,{rank:"same"}),t.reduce(o,function(c,d){return s.setEdge(c,d,{style:"invis"}),d})}),s}return E6}var T6,KY;function Eat(){return KY||(KY=1,T6="0.8.5"),T6}var C6,ZY;function Tat(){return ZY||(ZY=1,C6={graphlib:sl(),layout:wat(),debug:Sat(),util:{time:ws().time,notime:ws().notime},version:Eat()}),C6}var Cat=Tat();const F0=pv(Cat);function oy(t,e,n){if(!e||!t[e])return{nodes:[],edges:[]};const r=[],i=[],a=(s,o=0)=>{const l=t[s];l&&(r.push({id:s,type:"arenaNode",position:{x:0,y:0},data:{arenaNode:l,depth:o}}),l.children.forEach(u=>{i.push({id:`${s}-${u}`,source:s,target:u,type:"smoothstep",animated:!1}),a(u,o+1)}))};return a(e),Mat({nodes:r,edges:i},n,t,e)}function Mat(t,e,n,r){switch(e){case"mindmap":return Aat(t);case"flowchart":return kat(t);case"debate":return Iat(t,n,r);case"fishbone":return Nat(t,n,r);case"timeline":return Rat(t);default:return t}}function Aat(t){const e=new F0.graphlib.Graph;return e.setGraph({rankdir:"LR",ranksep:120,nodesep:80,edgesep:40}),e.setDefaultEdgeLabel(()=>({})),t.nodes.forEach(r=>{e.setNode(r.id,{width:200,height:60})}),t.edges.forEach(r=>{e.setEdge(r.source,r.target)}),F0.layout(e),{nodes:t.nodes.map(r=>{const i=e.node(r.id);return{...r,position:{x:i.x-100,y:i.y-30}}}),edges:t.edges}}function kat(t){const e=new F0.graphlib.Graph;return e.setGraph({rankdir:"TB",ranksep:100,nodesep:80}),e.setDefaultEdgeLabel(()=>({})),t.nodes.forEach(r=>{e.setNode(r.id,{width:200,height:60})}),t.edges.forEach(r=>{e.setEdge(r.source,r.target)}),F0.layout(e),{nodes:t.nodes.map(r=>{const i=e.node(r.id);return{...r,position:{x:i.x-100,y:i.y-30}}}),edges:t.edges}}function Iat(t,e,n){const a=[],s=new Set,o=(l,u,c,d,h)=>{if(s.has(l))return;s.add(l);const f=t.nodes.find(b=>b.id===l);if(!f)return;a.push({...f,position:{x:u,y:c}}),(e[l]?.children||[]).forEach((b,y)=>{const w=d==="center"?y%2===0?"left":"right":d,_=w==="left"?u-250:u+250,S=c+100*(Math.floor(y/2)+1);o(b,_,S,w)})};return o(n,0,0,"center"),{nodes:a,edges:t.edges}}function Nat(t,e,n){const a=[],s=new Set,o=(l,u,c,d,h)=>{if(s.has(l))return;s.add(l);const f=t.nodes.find(b=>b.id===l);if(!f)return;a.push({...f,position:{x:u,y:c}}),(e[l]?.children||[]).forEach((b,y)=>{const w=y%2===0?!d:d,_=u-250,S=w?c-100*(Math.floor(y/2)+1):c+100*(Math.floor(y/2)+1);o(b,_,S,w)})};return o(n,800,0,!1),{nodes:a,edges:t.edges}}function Rat(t){const e=new F0.graphlib.Graph;return e.setGraph({rankdir:"LR",ranksep:200,nodesep:100}),e.setDefaultEdgeLabel(()=>({})),t.nodes.forEach(r=>{e.setNode(r.id,{width:200,height:60})}),t.edges.forEach(r=>{e.setEdge(r.source,r.target)}),F0.layout(e),{nodes:t.nodes.map(r=>{const i=e.node(r.id);return{...r,position:{x:i.x-100,y:i.y-30}}}),edges:t.edges}}const Pat={exploring:"bg-blue-400/5",valid:"bg-green-400/5",invalid:"bg-gray-500/5 opacity-60"},Dat={exploring:"🔵",valid:"✅",invalid:"❌"},ly=({data:t,id:e})=>{const{arenaNode:n,isSelected:r,onAddChild:i}=t,[a,s]=P.useState(!1);return n?g.jsxs("div",{className:`
        group relative
        border border-white/5 rounded-xl p-3 cursor-pointer transition-all duration-200
        hover:shadow-lg hover:shadow-black/10 hover:border-white/10 hover:bg-white/[0.02]
        ${Pat[n.status]}
        ${r?"ring-2 ring-blue-400/30 shadow-lg shadow-blue-500/5 border-blue-400/20 bg-blue-500/5":""}
        ${n.status==="invalid"?"line-through":""}
        min-w-[180px] max-w-[220px]
      `,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[g.jsx(L0,{type:"target",position:rn.Top,className:"w-2 h-2 bg-white/20 border-none"}),g.jsx(L0,{type:"source",position:rn.Bottom,className:"w-2 h-2 bg-white/20 border-none"}),g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("div",{className:"shrink-0 text-sm leading-none mt-0.5",children:Dat[n.status]}),g.jsx("div",{className:"flex-1 min-w-0 text-xs text-gray-100 leading-relaxed",children:n.text}),r&&i&&g.jsx("button",{onClick:o=>{o.stopPropagation(),i(e)},className:`
              shrink-0 w-5 h-5 flex items-center justify-center
              text-blue-400/70 hover:text-blue-400 transition-all duration-200
              hover:scale-110
            `,title:"延伸推导",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2.5,children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})})]}),a&&(n.reasoning||n.invalidReason)&&g.jsxs("div",{className:"mt-2 pt-2 border-t border-white/5 space-y-1",children:[n.reasoning&&g.jsxs("div",{className:"text-[10px] text-gray-400 leading-tight",children:["💭 ",n.reasoning]}),n.invalidReason&&g.jsxs("div",{className:"text-[10px] text-red-400 leading-tight",children:["⚠️ ",n.invalidReason]})]})]}):null},Oat={arenaNode:ly},Lat=({nodes:t,rootNodeId:e,selectedNodeId:n,onSelectNode:r,onEditNode:i,onAddChild:a})=>{const{nodes:s,edges:o}=P.useMemo(()=>e?oy(t,e,"mindmap"):{nodes:[],edges:[]},[t,e]),l=P.useCallback((h,f)=>{r(f.id)},[r]),u=P.useCallback((h,f)=>{i(f.id)},[i]),c=P.useMemo(()=>s.map(h=>({...h,data:{...h.data,isSelected:h.id===n,onAddChild:a}})),[s,n,a]),d=P.useMemo(()=>o.map(h=>({...h,style:{stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2},markerEnd:{type:"arrowclosed",color:"rgba(255, 255, 255, 0.2)"}})),[o]);return e?g.jsx("div",{className:"w-full h-full bg-[#0a0c14]",children:g.jsxs(Jv,{nodes:c,edges:d,onNodeClick:l,onNodeDoubleClick:u,nodeTypes:Oat,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"smoothstep",animated:!1},proOptions:{hideAttribution:!0},children:[g.jsx(Qv,{color:"rgba(255, 255, 255, 0.05)",gap:20,size:1}),g.jsx(ey,{showInteractive:!1,className:"bg-gray-900/90 border-white/10"}),g.jsx(ty,{nodeColor:"#3b82f6",maskColor:"rgba(0, 0, 0, 0.7)",className:"bg-gray-900/90 border border-white/10"})]})}):g.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-4xl mb-2",children:"🧠"}),g.jsx("div",{className:"text-sm",children:"没有推导节点"})]})})},Fat={arenaNode:ly},Bat=({nodes:t,rootNodeId:e,selectedNodeId:n,onSelectNode:r,onEditNode:i,onAddChild:a})=>{const{nodes:s,edges:o}=P.useMemo(()=>e?oy(t,e,"flowchart"):{nodes:[],edges:[]},[t,e]),l=P.useCallback((h,f)=>{r(f.id)},[r]),u=P.useCallback((h,f)=>{i(f.id)},[i]),c=P.useMemo(()=>s.map(h=>({...h,data:{...h.data,isSelected:h.id===n,onAddChild:a}})),[s,n,a]),d=P.useMemo(()=>o.map(h=>({...h,style:{stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2},markerEnd:{type:"arrowclosed",color:"rgba(255, 255, 255, 0.2)"}})),[o]);return e?g.jsx("div",{className:"w-full h-full bg-[#0a0c14]",children:g.jsxs(Jv,{nodes:c,edges:d,onNodeClick:l,onNodeDoubleClick:u,nodeTypes:Fat,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"step",animated:!1},proOptions:{hideAttribution:!0},children:[g.jsx(Qv,{color:"rgba(255, 255, 255, 0.05)",gap:20,size:1}),g.jsx(ey,{showInteractive:!1,className:"bg-gray-900/90 border-white/10"}),g.jsx(ty,{nodeColor:"#3b82f6",maskColor:"rgba(0, 0, 0, 0.7)",className:"bg-gray-900/90 border border-white/10"})]})}):g.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-4xl mb-2",children:"📊"}),g.jsx("div",{className:"text-sm",children:"没有推导节点"})]})})},Uat={arenaNode:ly},zat=({nodes:t,rootNodeId:e,selectedNodeId:n,onSelectNode:r,onEditNode:i,onAddChild:a})=>{const{nodes:s,edges:o}=P.useMemo(()=>e?oy(t,e,"debate"):{nodes:[],edges:[]},[t,e]),l=P.useCallback((h,f)=>{r(f.id)},[r]),u=P.useCallback((h,f)=>{i(f.id)},[i]),c=P.useMemo(()=>s.map(h=>({...h,data:{...h.data,isSelected:h.id===n,onAddChild:a}})),[s,n,a]),d=P.useMemo(()=>o.map(h=>({...h,style:{stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2},markerEnd:{type:"arrowclosed",color:"rgba(255, 255, 255, 0.2)"}})),[o]);return e?g.jsx("div",{className:"w-full h-full bg-[#0a0c14]",children:g.jsxs(Jv,{nodes:c,edges:d,onNodeClick:l,onNodeDoubleClick:u,nodeTypes:Uat,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"smoothstep",animated:!1},proOptions:{hideAttribution:!0},children:[g.jsx(Qv,{color:"rgba(255, 255, 255, 0.05)",gap:20,size:1}),g.jsx(ey,{showInteractive:!1,className:"bg-gray-900/90 border-white/10"}),g.jsx(ty,{nodeColor:"#3b82f6",maskColor:"rgba(0, 0, 0, 0.7)",className:"bg-gray-900/90 border border-white/10"})]})}):g.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-4xl mb-2",children:"⚖️"}),g.jsx("div",{className:"text-sm",children:"没有推导节点"})]})})},jat={arenaNode:ly},Hat=({nodes:t,rootNodeId:e,selectedNodeId:n,onSelectNode:r,onEditNode:i,onAddChild:a})=>{const{nodes:s,edges:o}=P.useMemo(()=>e?oy(t,e,"fishbone"):{nodes:[],edges:[]},[t,e]),l=P.useCallback((h,f)=>{r(f.id)},[r]),u=P.useCallback((h,f)=>{i(f.id)},[i]),c=P.useMemo(()=>s.map(h=>({...h,data:{...h.data,isSelected:h.id===n,onAddChild:a}})),[s,n,a]),d=P.useMemo(()=>o.map(h=>({...h,style:{stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2},markerEnd:{type:"arrowclosed",color:"rgba(255, 255, 255, 0.2)"}})),[o]);return e?g.jsx("div",{className:"w-full h-full bg-[#0a0c14]",children:g.jsxs(Jv,{nodes:c,edges:d,onNodeClick:l,onNodeDoubleClick:u,nodeTypes:jat,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"smoothstep",animated:!1},proOptions:{hideAttribution:!0},children:[g.jsx(Qv,{color:"rgba(255, 255, 255, 0.05)",gap:20,size:1}),g.jsx(ey,{showInteractive:!1,className:"bg-gray-900/90 border-white/10"}),g.jsx(ty,{nodeColor:"#3b82f6",maskColor:"rgba(0, 0, 0, 0.7)",className:"bg-gray-900/90 border border-white/10"})]})}):g.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-4xl mb-2",children:"🐟"}),g.jsx("div",{className:"text-sm",children:"没有推导节点"})]})})},$at={arenaNode:ly},Vat=({nodes:t,rootNodeId:e,selectedNodeId:n,onSelectNode:r,onEditNode:i,onAddChild:a})=>{const{nodes:s,edges:o}=P.useMemo(()=>e?oy(t,e,"timeline"):{nodes:[],edges:[]},[t,e]),l=P.useCallback((h,f)=>{r(f.id)},[r]),u=P.useCallback((h,f)=>{i(f.id)},[i]),c=P.useMemo(()=>s.map(h=>({...h,data:{...h.data,isSelected:h.id===n,onAddChild:a}})),[s,n,a]),d=P.useMemo(()=>o.map(h=>({...h,style:{stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2},markerEnd:{type:"arrowclosed",color:"rgba(255, 255, 255, 0.2)"}})),[o]);return e?g.jsx("div",{className:"w-full h-full bg-[#0a0c14]",children:g.jsxs(Jv,{nodes:c,edges:d,onNodeClick:l,onNodeDoubleClick:u,nodeTypes:$at,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"step",animated:!1},proOptions:{hideAttribution:!0},children:[g.jsx(Qv,{color:"rgba(255, 255, 255, 0.05)",gap:20,size:1}),g.jsx(ey,{showInteractive:!1,className:"bg-gray-900/90 border-white/10"}),g.jsx(ty,{nodeColor:"#3b82f6",maskColor:"rgba(0, 0, 0, 0.7)",className:"bg-gray-900/90 border border-white/10"})]})}):g.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-4xl mb-2",children:"📅"}),g.jsx("div",{className:"text-sm",children:"没有推导节点"})]})})},qat=({arenaMemory:t,onSave:e,onClose:n,onDelete:r,onDistillToCard:i,allMemories:a=[],onConvertNodeToMemory:s})=>{const{nodes:o,selectedNodeId:l,editingNodeId:u,rootNodeId:c,setSelectedNodeId:d,setEditingNodeId:h,addNode:f,updateNode:m,deleteNode:x,markStatus:b,hasUnsavedChanges:y,countInvalidDependentNodes:w,getInvalidNodes:_,cleanupInvalidBranches:S}=VYe(t),[M,E]=P.useState(!1),[C,R]=P.useState(void 0),[k,I]=P.useState(!1),[N,D]=P.useState(""),[F,L]=P.useState(!1),[U,j]=P.useState(!0),[q,Z]=P.useState(!1),Q=t.metadata?.templateId,z=fXe(Q),[W,X]=P.useState(t.preferredLayout||z),[H,J]=P.useState(!1),[te,ee]=P.useState(null),se=P.useRef(null),ue=P.useRef(Promise.resolve()),oe=l?o[l]:null,Te=u?o[u]:null,Ne=P.useCallback(async(de=!1,ve=0)=>(ue.current=ue.current.then(async()=>{E(!0);try{const _e={...t,arenaNodes:o,arenaRootNodeId:c||void 0,preferredLayout:W,lastEditedAt:new Date};await e(_e),console.log(`✅ [Arena] 保存成功${de?"（自动）":""}`)}catch(_e){console.error("❌ [Arena] 保存失败:",_e);const Be=_e instanceof Error&&(_e.message.includes("409")||_e.message.includes("SHA")||_e.message.includes("冲突"));if(de&&Be&&ve<5){const He=Math.min(2e3*Math.pow(2,ve),3e4);console.log(`🔄 [Arena] SHA 冲突，${He}ms 后重试（第 ${ve+1}/5 次）`),setTimeout(()=>Ne(!0,ve+1),He)}else(!de||ve>=5)&&alert(Be?`保存失败：检测到数据冲突

可能原因：
1. 多个标签页同时编辑
2. 网络延迟导致同步问题

建议：关闭其他标签页，稍后重试`:"保存失败，请检查网络连接")}finally{E(!1)}}),ue.current),[t,o,c,W,e]),be=t.snapshots||[],De=P.useCallback((de,ve)=>{const _e={id:`snapshot-${Date.now()}`,name:de,description:ve,createdAt:new Date,nodesSnapshot:JSON.parse(JSON.stringify(o)),selectedNodeId:l},Be={...t,snapshots:[...be,_e]};e(Be),console.log(`📸 [Arena] 快照已创建: ${de}`)},[o,l,be,t,e]),ke=P.useCallback(de=>{const ve=be.find(_e=>_e.id===de);ve&&(Object.keys(ve.nodesSnapshot).forEach(_e=>{const Be=ve.nodesSnapshot[_e];Be&&m(_e,Be)}),ve.selectedNodeId&&d(ve.selectedNodeId),console.log(`🔄 [Arena] 快照已恢复: ${ve.name}`))},[be,m,d]),Me=P.useCallback(de=>{const ve={...t,snapshots:be.filter(_e=>_e.id!==de)};e(ve),console.log("🗑️ [Arena] 快照已删除")},[be,t,e]);P.useEffect(()=>{oe?.note?D(oe.note):D("")},[l,oe?.note]);const Ie=P.useCallback(()=>{l&&(m(l,{note:N.trim()||void 0}),N.trim()||I(!1))},[l,N,m]),ce=P.useCallback(()=>{D(""),l&&m(l,{note:void 0}),I(!1)},[l,m]),G=P.useCallback((de,ve)=>{const _e=o[de];if(!_e)return;const Be=[..._e.evidenceIds||[],ve];m(de,{evidenceIds:Be})},[o,m]),xe=P.useCallback((de,ve)=>{const _e=o[de];if(!_e)return;const Be=(_e.evidenceIds||[]).filter(He=>He!==ve);m(de,{evidenceIds:Be})},[o,m]);P.useEffect(()=>{if(y)return se.current&&clearTimeout(se.current),se.current=setTimeout(()=>{Ne(!0)},1e4),()=>{se.current&&clearTimeout(se.current)}},[o,c,y,Ne]);const Oe=P.useCallback(de=>{R(de)},[]),Fe=P.useCallback(()=>{R(null)},[]),ze=P.useCallback((de,ve)=>{if(C===void 0)return;const _e=f(C,de);ve&&m(_e,{reasoning:ve}),R(void 0),d(_e)},[C,f,m,d]),le=P.useCallback(de=>{h(de)},[h]),re=P.useCallback((de,ve)=>{u&&(m(u,{text:de,reasoning:ve}),h(null))},[u,m,h]),me=P.useCallback((de,ve)=>{u&&b(u,de,ve)},[u,b]);return P.useEffect(()=>{const de=ve=>{if(!(ve.target instanceof HTMLInputElement||ve.target instanceof HTMLTextAreaElement)&&l){if(ve.key==="Tab")ve.preventDefault(),Oe(l);else if(ve.key==="Enter"&&!ve.metaKey&&!ve.ctrlKey)ve.preventDefault(),le(l);else if(ve.key===" "){ve.preventDefault();const _e=o[l];if(!_e)return;const Be=_e.status==="exploring"?"valid":_e.status==="valid"?"invalid":"exploring";b(l,Be)}}};return window.addEventListener("keydown",de),()=>window.removeEventListener("keydown",de)},[l,Oe,le,o,b]),g.jsxs("div",{className:"fixed inset-0 z-40 bg-black flex flex-col",children:[g.jsx("div",{className:"shrink-0 bg-[#0f111a] border-b border-white/10",children:g.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("button",{onClick:()=>{y?confirm("有未保存的更改，确定要离开吗？")&&n():n()},className:"w-9 h-9 rounded-xl hover:bg-white/10 text-gray-500 hover:text-gray-300 transition-all flex items-center justify-center",title:"返回",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-base opacity-60",children:"🥋"}),g.jsx("h1",{className:"text-sm text-gray-400",children:t.title||"思维演武场"})]})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>J(!H),className:"flex items-center gap-2 px-3 py-1.5 rounded-xl hover:bg-white/10 text-gray-300 hover:text-white transition-all",title:`当前布局：${Eb[W].name}`,children:[g.jsx("span",{className:"text-lg",children:Eb[W].icon}),g.jsx("span",{className:"text-xs",children:Eb[W].name}),W===z&&g.jsx("span",{className:"text-[10px] text-blue-400 bg-blue-500/10 px-1.5 py-0.5 rounded",children:"推荐"}),g.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),H&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>J(!1)}),g.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-[#1a1d2e] border border-white/20 rounded-xl shadow-2xl z-20 overflow-hidden",children:[g.jsx("div",{className:"p-2 space-y-1",children:Object.values(Eb).map(de=>{const ve=de.type===z,_e=W===de.type;return g.jsx("button",{onClick:()=>{X(de.type),J(!1),ee(`已切换到 ${de.icon} ${de.name}`),setTimeout(()=>ee(null),3e3)},className:`w-full text-left px-3 py-2 rounded-lg transition-all ${_e?"bg-blue-500/20 text-blue-300 border border-blue-400/30":"hover:bg-white/5 text-gray-300 border border-transparent"}`,children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-base",children:de.icon}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"text-sm font-medium flex items-center gap-2",children:[de.name,ve&&g.jsx("span",{className:"text-[10px] text-blue-400 bg-blue-500/20 px-1.5 py-0.5 rounded",children:"推荐"})]}),g.jsx("div",{className:"text-xs text-gray-500 truncate",children:de.description})]}),_e&&g.jsx("svg",{className:"w-4 h-4 text-blue-400 shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]})},de.type)})}),g.jsx("div",{className:"border-t border-white/5 px-3 py-2 bg-white/[0.02]",children:g.jsx("div",{className:"text-[10px] text-gray-600",children:"💡 不同布局适配不同思维方式"})})]})]})]}),g.jsx("div",{className:"w-px h-5 bg-white/5 mx-1"}),g.jsx("button",{onClick:()=>Ne(!1),disabled:M,className:`w-9 h-9 rounded-xl transition-all flex items-center justify-center
                ${M?"text-gray-600":y?"text-blue-400 hover:bg-white/10":"text-green-400/30"}`,title:y?"立即保存（自动保存10秒后触发）":"所有更改已保存",children:M?g.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):y?g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}):g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),g.jsxs(Vo,{as:"div",className:"relative",children:[g.jsx(Vo.Button,{className:"w-9 h-9 rounded-xl hover:bg-white/10 text-gray-400 hover:text-white transition-all flex items-center justify-center",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),g.jsx(Vo.Items,{className:"absolute right-0 mt-2 w-48 bg-[#1a1d2e]/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-lg overflow-hidden z-20"})]})]})]})}),g.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[g.jsxs("div",{className:"flex-1 overflow-hidden bg-black/20 flex flex-col",children:[U&&g.jsxs("div",{className:"shrink-0 bg-blue-500/10 border-b border-blue-400/20 px-4 py-2 flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-3 text-xs text-blue-300",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("span",{className:"font-medium",children:"快速上手"})]}),g.jsx("span",{className:"text-gray-400",children:"|"}),g.jsx("span",{children:"单击选中"}),g.jsx("span",{className:"text-gray-400",children:"•"}),g.jsx("span",{children:"双击编辑"}),g.jsx("span",{className:"text-gray-400",children:"•"}),g.jsxs("span",{children:[g.jsx("kbd",{className:"px-1 py-0.5 bg-blue-400/20 rounded text-[10px]",children:"Tab"})," 延伸"]})]}),g.jsx("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-300 transition-colors",title:"关闭提示",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"flex-1 overflow-hidden",children:[W==="tree"&&g.jsx(ZYe,{nodes:o,rootNodeId:c,selectedNodeId:l,editingNodeId:u,onSelectNode:d,onAddChild:Oe,onEditNode:le,onDeleteNode:x,onToggleStatus:de=>{const ve=o[de];if(!ve)return;const _e=ve.status==="exploring"?"valid":ve.status==="valid"?"invalid":"exploring";b(de,_e)},onAddRootNode:Fe,allMemories:a}),W==="mindmap"&&g.jsx(Lat,{nodes:o,rootNodeId:c,selectedNodeId:l,onSelectNode:d,onEditNode:le,onAddChild:Oe}),W==="flowchart"&&g.jsx(Bat,{nodes:o,rootNodeId:c,selectedNodeId:l,onSelectNode:d,onEditNode:le,onAddChild:Oe}),W==="debate"&&g.jsx(zat,{nodes:o,rootNodeId:c,selectedNodeId:l,onSelectNode:d,onEditNode:le,onAddChild:Oe}),W==="fishbone"&&g.jsx(Hat,{nodes:o,rootNodeId:c,selectedNodeId:l,onSelectNode:d,onEditNode:le,onAddChild:Oe}),W==="timeline"&&g.jsx(Vat,{nodes:o,rootNodeId:c,selectedNodeId:l,onSelectNode:d,onEditNode:le,onAddChild:Oe})]})]}),g.jsxs("div",{className:"w-80 border-l border-white/5 bg-[#0a0c14] overflow-y-auto",children:[g.jsx("div",{className:"p-4 border-b border-white/5",children:g.jsxs("button",{onClick:()=>Z(!0),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500/15 to-blue-500/15 hover:from-purple-500/25 hover:to-blue-500/25 text-purple-300 rounded-xl border border-purple-400/20 hover:border-purple-400/40 transition-all font-medium text-sm",title:"将推导结论提炼为知识卡片",children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),g.jsx("span",{children:"📚 提炼为卡片"})]})}),g.jsx("div",{className:"px-4 pt-4 pb-2 border-b border-white/5",children:g.jsxs("div",{className:"bg-blue-500/5 border border-blue-400/20 rounded-xl p-3 space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[g.jsx("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("span",{className:"text-xs font-medium text-blue-300",children:"Arena 信息"})]}),g.jsxs("div",{className:"space-y-1.5 text-[11px]",children:[g.jsxs("div",{className:"flex items-baseline gap-2",children:[g.jsx("span",{className:"text-gray-500 min-w-[60px] shrink-0",children:"模板："}),g.jsx("span",{className:"text-gray-300",children:t.metadata?.templateName||"自由推导"})]}),t.metadata?.triggerQuestion&&g.jsxs("div",{className:"flex items-baseline gap-2",children:[g.jsx("span",{className:"text-gray-500 min-w-[60px] shrink-0",children:"💭 问题："}),g.jsx("span",{className:"text-gray-300 italic line-clamp-2 leading-relaxed",children:t.metadata.triggerQuestion})]}),g.jsxs("div",{className:"flex items-baseline gap-2",children:[g.jsx("span",{className:"text-gray-500 min-w-[60px] shrink-0",children:"创建："}),g.jsx("span",{className:"text-gray-400",children:new Date(t.date).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric",year:"numeric"})})]}),t.lastEditedAt&&g.jsxs("div",{className:"flex items-baseline gap-2",children:[g.jsx("span",{className:"text-gray-500 min-w-[60px] shrink-0",children:"编辑："}),g.jsx("span",{className:"text-gray-400",children:new Date(t.lastEditedAt).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})})]})]}),g.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-400/10",children:[g.jsxs("label",{className:"text-[10px] text-gray-500 mb-1.5 block flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"✅ 推导结论（可选）"]}),g.jsx("textarea",{value:t.metadata?.conclusion||"",onChange:de=>{const ve={...t,metadata:{...t.metadata,conclusion:de.target.value||void 0},lastEditedAt:new Date};e(ve)},placeholder:"总结你的推导结论...",rows:3,className:"w-full px-2 py-1.5 bg-gray-900/50 border border-blue-400/20 rounded text-xs text-gray-200 placeholder-gray-500 focus:outline-none focus:border-blue-400/40 resize-none"})]})]})}),oe?g.jsxs("div",{className:"p-4 space-y-4",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"text-[10px] text-gray-700 mb-2 flex items-center justify-between",children:[g.jsx("span",{children:"节点详情"}),g.jsxs("button",{onClick:()=>le(l),className:"text-blue-400 hover:text-blue-300 text-[10px] flex items-center gap-1 transition-colors",title:"编辑此节点",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"编辑"]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{children:[g.jsx("div",{className:"text-[9px] text-gray-600 mb-1",children:"文本"}),g.jsx("div",{className:"text-xs text-gray-300 leading-relaxed cursor-pointer hover:text-blue-300 transition-colors p-2 rounded hover:bg-white/5",onClick:()=>le(l),title:"点击编辑",children:oe.text})]}),oe.reasoning&&g.jsxs("div",{children:[g.jsx("div",{className:"text-[9px] text-gray-600 mb-1",children:"推导理由"}),g.jsx("div",{className:"text-xs text-gray-400 leading-relaxed",children:oe.reasoning})]}),g.jsxs("div",{children:[g.jsx("div",{className:"text-[9px] text-gray-600 mb-1",children:"状态"}),g.jsx("div",{className:"flex items-center gap-2",children:g.jsxs("button",{onClick:()=>{const de=oe.status==="exploring"?"valid":oe.status==="valid"?"invalid":"exploring";b(l,de)},className:"flex items-center gap-1 px-2 py-1 bg-white/5 hover:bg-white/10 rounded text-xs transition-colors",children:[g.jsxs("span",{children:[oe.status==="exploring"&&"🔵",oe.status==="valid"&&"✅",oe.status==="invalid"&&"❌"]}),g.jsxs("span",{className:"text-gray-300",children:[oe.status==="exploring"&&"探索中",oe.status==="valid"&&"有效",oe.status==="invalid"&&"无效"]}),g.jsx("svg",{className:"w-3 h-3 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})]})})]})]})]}),g.jsxs("div",{children:[g.jsx("div",{className:"text-[10px] text-gray-700 mb-2",children:"快捷操作"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("button",{onClick:()=>Oe(l),className:"w-full flex items-center justify-between px-3 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-300 text-xs rounded border border-blue-400/20 hover:border-blue-400/40 transition-all",children:[g.jsx("span",{children:"延伸推导"}),g.jsx("kbd",{className:"px-1.5 py-0.5 bg-white/5 rounded text-[10px]",children:"Tab"})]}),g.jsxs("button",{onClick:()=>le(l),className:"w-full flex items-center justify-between px-3 py-2 bg-purple-500/10 hover:bg-purple-500/20 text-purple-300 text-xs rounded border border-purple-400/20 hover:border-purple-400/40 transition-all",children:[g.jsx("span",{children:"编辑节点"}),g.jsx("kbd",{className:"px-1.5 py-0.5 bg-white/5 rounded text-[10px]",children:"Enter"})]})]})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"text-[10px] text-gray-700 mb-2 flex items-center gap-1 cursor-pointer hover:text-gray-500 transition-colors",onClick:()=>I(!k),children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"推导笔记",oe.note&&!k&&g.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full ml-1"})]}),k&&g.jsxs("div",{className:"bg-white/5 rounded-lg p-2 text-[11px] text-gray-500 space-y-1",children:[g.jsx("textarea",{value:N,onChange:de=>D(de.target.value),placeholder:"记录补充信息...",rows:4,className:"w-full bg-transparent outline-none resize-none text-gray-300 placeholder-gray-600 text-xs"}),g.jsxs("div",{className:"flex justify-end gap-2",children:[g.jsx("button",{onClick:ce,className:"px-2 py-1 bg-red-500/10 hover:bg-red-500/20 text-red-300 text-[10px] rounded border border-red-400/20 hover:border-red-400/40 transition-all",children:"清除"}),g.jsx("button",{onClick:Ie,className:"px-2 py-1 bg-blue-500/10 hover:bg-blue-500/20 text-blue-300 text-[10px] rounded border border-blue-400/20 hover:border-blue-400/40 transition-all",children:"保存"})]})]})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"text-[10px] text-gray-700 mb-2 flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"节点分类"]}),g.jsxs("div",{className:"flex flex-wrap gap-2",children:[g.jsx("button",{onClick:()=>m(l,{classificationType:void 0}),className:`px-3 py-1.5 text-xs rounded-lg border transition-all ${oe.classificationType?"bg-gray-700/20 border-gray-600/20 text-gray-400 hover:bg-gray-700/30 hover:border-gray-600/30":"bg-gray-700/50 border-gray-600/50 text-gray-200"}`,children:"无分类"}),g.jsx("button",{onClick:()=>m(l,{classificationType:"?"}),className:`px-3 py-1.5 text-xs rounded-lg border transition-all ${oe.classificationType==="?"?"bg-cyan-500/20 border-cyan-400/40 text-cyan-300":"bg-cyan-500/10 border-cyan-400/20 text-cyan-400 hover:bg-cyan-500/15 hover:border-cyan-400/30"}`,title:"待澄清的术语",children:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[g.jsx("span",{className:"font-bold",children:"?"}),g.jsx("span",{children:"术语"})]})}),g.jsx("button",{onClick:()=>m(l,{classificationType:"!"}),className:`px-3 py-1.5 text-xs rounded-lg border transition-all ${oe.classificationType==="!"?"bg-orange-500/20 border-orange-400/40 text-orange-300":"bg-orange-500/10 border-orange-400/20 text-orange-400 hover:bg-orange-500/15 hover:border-orange-400/30"}`,title:"核心假设",children:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[g.jsx("span",{className:"font-bold",children:"!"}),g.jsx("span",{children:"假设"})]})}),g.jsx("button",{onClick:()=>m(l,{classificationType:"->"}),className:`px-3 py-1.5 text-xs rounded-lg border transition-all ${oe.classificationType==="->"?"bg-green-500/20 border-green-400/40 text-green-300":"bg-green-500/10 border-green-400/20 text-green-400 hover:bg-green-500/15 hover:border-green-400/30"}`,title:"逻辑推论",children:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[g.jsx("span",{className:"font-bold",children:"→"}),g.jsx("span",{children:"推论"})]})})]}),oe.classificationType==="?"&&g.jsxs("div",{className:"mt-3 p-3 bg-cyan-500/10 rounded-lg border border-cyan-400/20",children:[g.jsxs("div",{className:"text-[10px] text-cyan-300 mb-2 flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"术语定义"]}),g.jsx("textarea",{value:oe.termDefinition||"",onChange:de=>m(l,{termDefinition:de.target.value}),placeholder:"请定义这个术语的具体含义...",rows:3,className:"w-full px-2 py-1.5 bg-gray-900/50 border border-cyan-400/20 rounded text-xs text-gray-200 placeholder-gray-500 focus:outline-none focus:border-cyan-400/40 resize-none"}),g.jsx("div",{className:"text-[9px] text-cyan-400/60 mt-1",children:"💡 明确定义有助于消除模糊概念"})]})]}),w()>0&&g.jsx("div",{className:"p-3 bg-yellow-500/10 rounded-lg border border-yellow-400/30",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("div",{className:"text-yellow-400 text-lg shrink-0",children:"⚠️"}),g.jsxs("div",{className:"flex-1",children:[g.jsx("div",{className:"text-xs text-yellow-300 font-medium mb-1",children:"检测到逻辑链问题"}),g.jsxs("div",{className:"text-[10px] text-yellow-400/80 mb-2",children:["有 ",g.jsx("span",{className:"font-bold text-yellow-300",children:w()})," 个节点依赖于无效前提，推论可能不成立"]}),g.jsxs("button",{onClick:()=>{confirm(`确定要清理所有无效分支吗？这将删除 ${_().filter(de=>de.status==="invalid").length} 个无效节点及其子树。`)&&S()},className:"w-full px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 border border-red-400/30 hover:border-red-400/50 text-red-300 text-[10px] rounded transition-all flex items-center justify-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"清理无效分支"]})]})]})}),g.jsxs("div",{children:[g.jsxs("div",{className:"text-[10px] text-gray-700 mb-2 flex items-center gap-1",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),"元数据标签"]}),g.jsx(uXe,{selectedTags:oe.metadataTags||[],onChange:de=>{m(l,{metadataTags:de})}})]}),g.jsxs("div",{children:[g.jsxs("button",{onClick:()=>L(!F),className:"w-full flex items-center justify-between text-[10px] text-gray-700 hover:text-gray-500 transition-colors py-1",children:[g.jsx("span",{children:"高级操作"}),g.jsx("svg",{className:`w-3 h-3 transition-transform ${F?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),F&&g.jsxs("div",{className:"mt-2 space-y-2",children:[s&&g.jsxs("button",{onClick:async()=>{await s({text:oe.text,reasoning:oe.reasoning,note:oe.note,evidenceIds:oe.evidenceIds,arenaId:t.id,arenaTitle:t.title||t.text})},className:"w-full px-3 py-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-300 text-xs rounded border border-blue-400/20 hover:border-blue-400/40 transition-all text-left flex items-center gap-2",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"💭 转为记忆"]}),g.jsx("button",{onClick:()=>{confirm("确定要删除这个节点及其所有子节点吗？")&&(x(l),d(null))},className:"w-full px-3 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-300 text-xs rounded border border-red-400/20 hover:border-red-400/40 transition-all text-left",children:"🗑️ 删除节点"})]})]})]}):g.jsxs("div",{className:"p-4 text-center",children:[g.jsx("div",{className:"text-4xl mb-2 opacity-20",children:"👈"}),g.jsx("div",{className:"text-xs text-gray-600",children:"选择一个节点查看详情"})]})]})]}),Te&&g.jsx(AH,{node:Te,onSave:re,onCancel:()=>h(null),onStatusChange:me,allNodes:o,allMemories:a,evidenceIds:Te.evidenceIds||[],onAddEvidence:de=>G(Te.id,de),onRemoveEvidence:de=>xe(Te.id,de)}),C!==void 0&&g.jsx(AH,{node:null,onSave:ze,onCancel:()=>R(void 0),allNodes:o}),g.jsx(oXe,{snapshots:be,onCreateSnapshot:De,onRestoreSnapshot:ke,onDeleteSnapshot:Me}),q&&g.jsx(dXe,{arena:t,arenaNodes:o,onConfirm:async de=>{i&&await i(t.id,de)},onClose:()=>Z(!1)}),te&&g.jsx("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 animate-fade-in",children:g.jsxs("div",{className:"bg-blue-500/90 backdrop-blur-sm text-white px-6 py-3 rounded-xl shadow-2xl border border-blue-400/30 flex items-center gap-2",children:[g.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),g.jsx("span",{className:"text-sm font-medium",children:te})]})})]})},$ue=6048e5,Gat=864e5,JY=Symbol.for("constructDateFrom");function fd(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&JY in t?t[JY](e):t instanceof Date?new t.constructor(e):new Date(e)}function dl(t,e){return fd(e||t,t)}let Wat={};function bS(){return Wat}function dv(t,e){const n=bS(),r=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,i=dl(t,e?.in),a=i.getDay(),s=(a<r?7:0)+a-r;return i.setDate(i.getDate()-s),i.setHours(0,0,0,0),i}function i2(t,e){return dv(t,{...e,weekStartsOn:1})}function Vue(t,e){const n=dl(t,e?.in),r=n.getFullYear(),i=fd(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const a=i2(i),s=fd(n,0);s.setFullYear(r,0,4),s.setHours(0,0,0,0);const o=i2(s);return n.getTime()>=a.getTime()?r+1:n.getTime()>=o.getTime()?r:r-1}function QY(t){const e=dl(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function Yat(t,...e){const n=fd.bind(null,e.find(r=>typeof r=="object"));return e.map(n)}function eX(t,e){const n=dl(t,e?.in);return n.setHours(0,0,0,0),n}function Xat(t,e,n){const[r,i]=Yat(n?.in,t,e),a=eX(r),s=eX(i),o=+a-QY(a),l=+s-QY(s);return Math.round((o-l)/Gat)}function Kat(t,e){const n=Vue(t,e),r=fd(t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),i2(r)}function Zat(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Jat(t){return!(!Zat(t)&&typeof t!="number"||isNaN(+dl(t)))}function Qat(t,e){const n=dl(t,e?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const est={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},tst=(t,e,n)=>{let r;const i=est[t];return typeof i=="string"?r=i:e===1?r=i.one:r=i.other.replace("{{count}}",e.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function M6(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const nst={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},rst={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ist={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ast={date:M6({formats:nst,defaultWidth:"full"}),time:M6({formats:rst,defaultWidth:"full"}),dateTime:M6({formats:ist,defaultWidth:"full"})},sst={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ost=(t,e,n,r)=>sst[t];function cg(t){return(e,n)=>{const r=n?.context?String(n.context):"standalone";let i;if(r==="formatting"&&t.formattingValues){const s=t.defaultFormattingWidth||t.defaultWidth,o=n?.width?String(n.width):s;i=t.formattingValues[o]||t.formattingValues[s]}else{const s=t.defaultWidth,o=n?.width?String(n.width):t.defaultWidth;i=t.values[o]||t.values[s]}const a=t.argumentCallback?t.argumentCallback(e):e;return i[a]}}const lst={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ust={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},cst={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dst={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fst={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pst=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},mst={ordinalNumber:pst,era:cg({values:lst,defaultWidth:"wide"}),quarter:cg({values:ust,defaultWidth:"wide",argumentCallback:t=>t-1}),month:cg({values:cst,defaultWidth:"wide"}),day:cg({values:dst,defaultWidth:"wide"}),dayPeriod:cg({values:hst,defaultWidth:"wide",formattingValues:fst,defaultFormattingWidth:"wide"})};function dg(t){return(e,n={})=>{const r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],a=e.match(i);if(!a)return null;const s=a[0],o=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(o)?vst(o,d=>d.test(s)):gst(o,d=>d.test(s));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const c=e.slice(s.length);return{value:u,rest:c}}}function gst(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function vst(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function yst(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const i=r[0],a=e.match(t.parsePattern);if(!a)return null;let s=t.valueCallback?t.valueCallback(a[0]):a[0];s=n.valueCallback?n.valueCallback(s):s;const o=e.slice(i.length);return{value:s,rest:o}}}const xst=/^(\d+)(th|st|nd|rd)?/i,bst=/\d+/i,_st={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},wst={any:[/^b/i,/^(a|c)/i]},Sst={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Est={any:[/1/i,/2/i,/3/i,/4/i]},Tst={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Cst={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Mst={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ast={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},kst={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ist={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Nst={ordinalNumber:yst({matchPattern:xst,parsePattern:bst,valueCallback:t=>parseInt(t,10)}),era:dg({matchPatterns:_st,defaultMatchWidth:"wide",parsePatterns:wst,defaultParseWidth:"any"}),quarter:dg({matchPatterns:Sst,defaultMatchWidth:"wide",parsePatterns:Est,defaultParseWidth:"any",valueCallback:t=>t+1}),month:dg({matchPatterns:Tst,defaultMatchWidth:"wide",parsePatterns:Cst,defaultParseWidth:"any"}),day:dg({matchPatterns:Mst,defaultMatchWidth:"wide",parsePatterns:Ast,defaultParseWidth:"any"}),dayPeriod:dg({matchPatterns:kst,defaultMatchWidth:"any",parsePatterns:Ist,defaultParseWidth:"any"})},Rst={code:"en-US",formatDistance:tst,formatLong:ast,formatRelative:ost,localize:mst,match:Nst,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Pst(t,e){const n=dl(t,e?.in);return Xat(n,Qat(n))+1}function Dst(t,e){const n=dl(t,e?.in),r=+i2(n)-+Kat(n);return Math.round(r/$ue)+1}function que(t,e){const n=dl(t,e?.in),r=n.getFullYear(),i=bS(),a=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,s=fd(e?.in||t,0);s.setFullYear(r+1,0,a),s.setHours(0,0,0,0);const o=dv(s,e),l=fd(e?.in||t,0);l.setFullYear(r,0,a),l.setHours(0,0,0,0);const u=dv(l,e);return+n>=+o?r+1:+n>=+u?r:r-1}function Ost(t,e){const n=bS(),r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,i=que(t,e),a=fd(e?.in||t,0);return a.setFullYear(i,0,r),a.setHours(0,0,0,0),dv(a,e)}function Lst(t,e){const n=dl(t,e?.in),r=+dv(n,e)-+Ost(n,e);return Math.round(r/$ue)+1}function _r(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const Oc={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return _r(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):_r(n+1,2)},d(t,e){return _r(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return _r(t.getHours()%12||12,e.length)},H(t,e){return _r(t.getHours(),e.length)},m(t,e){return _r(t.getMinutes(),e.length)},s(t,e){return _r(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),i=Math.trunc(r*Math.pow(10,n-3));return _r(i,e.length)}},Up={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},tX={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return Oc.y(t,e)},Y:function(t,e,n,r){const i=que(t,r),a=i>0?i:1-i;if(e==="YY"){const s=a%100;return _r(s,2)}return e==="Yo"?n.ordinalNumber(a,{unit:"year"}):_r(a,e.length)},R:function(t,e){const n=Vue(t);return _r(n,e.length)},u:function(t,e){const n=t.getFullYear();return _r(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return _r(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return _r(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return Oc.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return _r(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const i=Lst(t,r);return e==="wo"?n.ordinalNumber(i,{unit:"week"}):_r(i,e.length)},I:function(t,e,n){const r=Dst(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):_r(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):Oc.d(t,e)},D:function(t,e,n){const r=Pst(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):_r(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const i=t.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return _r(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const i=t.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return _r(a,e.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),i=r===0?7:r;switch(e){case"i":return String(i);case"ii":return _r(i,e.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let i;switch(r===12?i=Up.noon:r===0?i=Up.midnight:i=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let i;switch(r>=17?i=Up.evening:r>=12?i=Up.afternoon:r>=4?i=Up.morning:i=Up.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Oc.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):Oc.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):_r(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):_r(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):Oc.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):Oc.s(t,e)},S:function(t,e){return Oc.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return rX(r);case"XXXX":case"XX":return xh(r);case"XXXXX":case"XXX":default:return xh(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return rX(r);case"xxxx":case"xx":return xh(r);case"xxxxx":case"xxx":default:return xh(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+nX(r,":");case"OOOO":default:return"GMT"+xh(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+nX(r,":");case"zzzz":default:return"GMT"+xh(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return _r(r,e.length)},T:function(t,e,n){return _r(+t,e.length)}};function nX(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Math.trunc(r/60),a=r%60;return a===0?n+String(i):n+String(i)+e+_r(a,2)}function rX(t,e){return t%60===0?(t>0?"-":"+")+_r(Math.abs(t)/60,2):xh(t,e)}function xh(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=_r(Math.trunc(r/60),2),a=_r(r%60,2);return n+i+e+a}const iX=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Gue=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Fst=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return iX(t,e);let a;switch(r){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",iX(r,e)).replace("{{time}}",Gue(i,e))},Bst={p:Gue,P:Fst},Ust=/^D+$/,zst=/^Y+$/,jst=["D","DD","YY","YYYY"];function Hst(t){return Ust.test(t)}function $st(t){return zst.test(t)}function Vst(t,e,n){const r=qst(t,e,n);if(console.warn(r),jst.includes(t))throw new RangeError(r)}function qst(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Gst=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Wst=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Yst=/^'([^]*?)'?$/,Xst=/''/g,Kst=/[a-zA-Z]/;function Zst(t,e,n){const r=bS(),i=r.locale??Rst,a=r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,s=r.weekStartsOn??r.locale?.options?.weekStartsOn??0,o=dl(t,n?.in);if(!Jat(o))throw new RangeError("Invalid time value");let l=e.match(Wst).map(c=>{const d=c[0];if(d==="p"||d==="P"){const h=Bst[d];return h(c,i.formatLong)}return c}).join("").match(Gst).map(c=>{if(c==="''")return{isToken:!1,value:"'"};const d=c[0];if(d==="'")return{isToken:!1,value:Jst(c)};if(tX[d])return{isToken:!0,value:c};if(d.match(Kst))throw new RangeError("Format string contains an unescaped latin alphabet character `"+d+"`");return{isToken:!1,value:c}});i.localize.preprocessor&&(l=i.localize.preprocessor(o,l));const u={firstWeekContainsDate:a,weekStartsOn:s,locale:i};return l.map(c=>{if(!c.isToken)return c.value;const d=c.value;($st(d)||Hst(d))&&Vst(d,e,String(t));const h=tX[d[0]];return h(o,d,i.localize,u)}).join("")}function Jst(t){const e=t.match(Yst);return e?e[1].replace(Xst,"'"):t}const A6=({size:t=24,className:e=""})=>g.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e,style:{overflow:"visible"},children:[g.jsx("path",{d:"M12 7L10.5 22H13.5L12 7Z",fill:"currentColor",className:"text-zinc-500/80"}),g.jsx("line",{x1:"8",y1:"22",x2:"16",y2:"22",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",className:"text-zinc-500/80"}),g.jsxs("g",{transform:"rotate(-12, 12, 7)",children:[g.jsx("line",{x1:"2",y1:"7",x2:"22",y2:"7",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",className:"text-zinc-300"}),g.jsxs("g",{children:[g.jsx("line",{x1:"3",y1:"7",x2:"3",y2:"15",stroke:"currentColor",strokeWidth:"0.8",className:"text-indigo-300/40"}),g.jsxs("g",{transform:"translate(3, 15)",children:[g.jsx("circle",{cx:"0",cy:"0",r:"2.2",fill:"currentColor",className:"text-indigo-500"}),g.jsx("circle",{cx:"-2",cy:"2",r:"1.5",fill:"currentColor",className:"text-indigo-400"}),g.jsx("circle",{cx:"2",cy:"2",r:"1.5",fill:"currentColor",className:"text-indigo-400"})]})]}),g.jsxs("g",{children:[g.jsx("line",{x1:"21",y1:"7",x2:"21",y2:"12",stroke:"currentColor",strokeWidth:"0.8",className:"text-rose-300/40"}),g.jsxs("g",{transform:"translate(21, 12)",children:[g.jsx("circle",{cx:"0",cy:"0",r:"2.2",stroke:"currentColor",strokeWidth:"1.2",fill:"none",className:"text-rose-400"}),g.jsx("circle",{cx:"-2",cy:"-2",r:"1.5",stroke:"currentColor",strokeWidth:"1",fill:"none",className:"text-zinc-400/60"}),g.jsx("circle",{cx:"2",cy:"-2",r:"1.5",stroke:"currentColor",strokeWidth:"1",fill:"none",className:"text-zinc-400/60"})]})]})]}),g.jsx("circle",{cx:"12",cy:"7",r:"1",fill:"currentColor",className:"text-zinc-200"})]}),Qst=({isOpen:t,arenas:e,onOpenArena:n,onCreateNew:r,onCreateNewV2:i,onClose:a,onToggleArchive:s})=>{const[o,l]=P.useState(""),[u,c]=P.useState("v1"),[d,h]=P.useState(!1),{activeArenas:f,archivedArenas:m}=P.useMemo(()=>{const y=o.toLowerCase(),w=e.filter(_=>(u==="v1"?_.type==="arena":_.type==="arena-v2")?_.title?.toLowerCase().includes(y)||_.text.toLowerCase().includes(y)||_.metadata?.triggerQuestion?.toLowerCase().includes(y)||_.arenaV2TriggerQuestion?.toLowerCase().includes(y):!1).sort((_,S)=>new Date(S.lastEditedAt||S.date).getTime()-new Date(_.lastEditedAt||_.date).getTime());return{activeArenas:w.filter(_=>!_.arenaArchived),archivedArenas:w.filter(_=>_.arenaArchived)}},[e,o,u]),x=f,b=()=>{u==="v1"?r():i(),a()};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:a,className:"relative z-[200]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-3xl h-[85vh] bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl flex flex-col overflow-hidden",children:[g.jsxs("div",{className:"px-5 py-4 border-b border-white/5 bg-white/[0.02] flex items-center justify-between flex-shrink-0",children:[g.jsx("div",{className:"flex items-center gap-3",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-2xl",children:"🥋"}),g.jsx(ar.Title,{className:"text-lg font-semibold text-gray-200",children:"思维演武场"})]})}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"flex bg-white/[0.02] p-1 rounded-lg border border-white/10",children:[g.jsx("button",{onClick:()=>c("v1"),className:`px-3 py-1 text-xs font-medium rounded transition-all ${u==="v1"?"bg-white/10 text-gray-200 border border-white/20":"text-gray-500 hover:text-gray-300"}`,children:"🥋 V1 树状"}),g.jsxs("button",{onClick:()=>c("v2"),className:`px-3 py-1 text-xs font-medium rounded transition-all flex items-center gap-1.5 ${u==="v2"?"bg-white/10 text-gray-200 border border-white/20":"text-gray-500 hover:text-gray-300"}`,children:[g.jsx(A6,{size:18}),g.jsx("span",{children:"V2 画布"})]})]}),g.jsxs("button",{onClick:b,className:"px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 text-white border border-white/20 transition-colors text-sm font-medium flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),g.jsx("span",{children:"创建新演武场"})]}),g.jsx("button",{onClick:a,className:"w-8 h-8 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-white/5 transition-colors flex items-center justify-center",title:"关闭 (ESC)",children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),g.jsx("div",{className:"px-5 py-3 border-b border-white/5 flex-shrink-0",children:g.jsxs("div",{className:"relative",children:[g.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("input",{type:"text",value:o,onChange:y=>l(y.target.value),placeholder:"搜索演武场...",className:"w-full pl-10 pr-4 py-2 bg-white/[0.02] border border-white/10 rounded-lg text-gray-200 placeholder-gray-500 focus:outline-none focus:border-white/30 text-sm"})]})}),g.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-2.5",children:x.length===0?g.jsx("div",{className:"py-16 text-center text-gray-500",children:o?g.jsxs(g.Fragment,{children:[g.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 opacity-30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),g.jsx("p",{className:"text-sm",children:"未找到匹配的演武场"}),g.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"试试其他关键词"})]}):g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"text-5xl block mb-4",children:"🥋"}),g.jsx("p",{className:"text-sm",children:"还没有创建演武场"}),g.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"点击右上角按钮创建第一个演武场"})]})}):x.map(y=>{const w=y.type==="arena-v2",_=w?Object.keys(y.arenaV2Nodes||{}).length:Object.keys(y.arenaNodes||{}).length,S=y.lastEditedAt||y.date,E=(C=>{if(C===0)return null;let R,k;return C<=5?(R=2,k=.35):C<=15?(R=3,k=.45):C<=30?(R=4,k=.55):(R=5,k=.65),{size:R,opacity:k}})(_);return g.jsxs("div",{className:"arena-card relative p-3.5 rounded-lg border border-white/10 bg-white/[0.02] hover:bg-white/[0.04] transition-all cursor-pointer group",onClick:()=>{n(y.id),a()},children:[E&&g.jsx("div",{className:"absolute top-2 right-2 rounded-full transition-all duration-200",style:{width:`${E.size}px`,height:`${E.size}px`,backgroundColor:`rgba(255, 255, 255, ${E.opacity})`},title:`${_} 个节点${_<=5?" · 刚起步":_<=15?" · 进行中":_<=30?" · 充实":" · 成熟"}`}),s&&g.jsx("button",{onClick:C=>{C.stopPropagation(),s(y.id,!y.arenaArchived)},className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 p-1 rounded text-gray-600 hover:text-gray-400 hover:bg-white/5 transition-all",title:y.arenaArchived?"取消归档":"归档",children:g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"shrink-0 mt-0.5",children:w?g.jsx(A6,{size:20,className:"text-gray-400"}):g.jsx("span",{className:"text-lg",children:"🥋"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("h4",{className:"text-sm font-medium text-gray-200 mb-1.5 truncate group-hover:text-white transition-colors",children:y.title||y.text}),g.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-gray-500 mb-1.5",children:[g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),y.metadata?.templateName||"自由推导"]}),g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Zst(S,"MM/dd HH:mm")]}),g.jsxs("span",{className:`flex items-center gap-1 transition-colors ${_>30?"text-gray-400 font-medium":_>15?"text-gray-450":(_>5,"text-gray-500")}`,children:[g.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})}),_," 节点"]})]}),(y.metadata?.triggerQuestion||y.arenaV2TriggerQuestion)&&g.jsx("p",{className:"text-xs text-gray-500 italic line-clamp-2",children:y.metadata?.triggerQuestion||y.arenaV2TriggerQuestion})]}),g.jsx("svg",{className:"w-4 h-4 text-gray-600 group-hover:text-gray-400 transition-colors shrink-0 mt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},y.id)})}),m.length>0&&g.jsxs("div",{className:"px-5 py-2 border-t border-white/5 flex-shrink-0",children:[g.jsxs("button",{onClick:()=>h(!d),className:"w-full flex items-center justify-between py-1.5 text-xs text-gray-500 hover:text-gray-400 transition-colors",children:[g.jsxs("span",{className:"flex items-center gap-1.5",children:[g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),"已归档 (",m.length,")"]}),g.jsx("svg",{className:`w-3 h-3 transition-transform duration-200 ${d?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&g.jsx("div",{className:"mt-2 space-y-1.5 max-h-48 overflow-y-auto",children:m.map(y=>{const w=y.type==="arena-v2",_=w?Object.keys(y.arenaV2Nodes||{}).length:Object.keys(y.arenaNodes||{}).length;return g.jsxs("div",{className:"relative p-2.5 rounded-lg border border-white/5 bg-white/[0.01] hover:bg-white/[0.03] transition-all cursor-pointer group flex items-center gap-2.5",onClick:()=>{n(y.id),a()},children:[g.jsx("div",{className:"shrink-0 opacity-50",children:w?g.jsx(A6,{size:14,className:"text-gray-500"}):g.jsx("span",{className:"text-xs",children:"🥋"})}),g.jsx("div",{className:"flex-1 min-w-0",children:g.jsx("span",{className:"text-xs text-gray-400 truncate block group-hover:text-gray-300 transition-colors",children:y.title||y.text})}),g.jsx("span",{className:"text-[10px] text-gray-600 shrink-0",children:_}),s&&g.jsx("button",{onClick:S=>{S.stopPropagation(),s(y.id,!1)},className:"opacity-0 group-hover:opacity-100 p-1 rounded text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all shrink-0",title:"取消归档",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})})]},y.id)})})]}),g.jsxs("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center text-xs text-gray-500 flex-shrink-0",children:[g.jsxs("span",{children:["共 ",f.length+m.length," 个演武场"]}),o&&g.jsxs("span",{children:["显示 ",f.length+m.length," 个结果"]})]})]})})})]})})},s1=[{id:"blank",name:"空白演武场",description:"从零开始，自由推导",emoji:"📝",structure:{text:""}},{id:"5w2h",name:"5W2H分析法",description:"系统性分析问题的七个维度",emoji:"🔍",structure:{text:"问题：[填写你的问题]",children:[{text:"What - 是什么？（问题的本质和现象）"},{text:"Why - 为什么？（原因和目的）"},{text:"Where - 在哪里？（发生的地点和范围）"},{text:"When - 什么时候？（时间节点和周期）"},{text:"Who - 谁？（相关人员和责任人）"},{text:"How - 怎么做？（具体方法和步骤）"},{text:"How much - 多少？（成本、收益、资源）"}]}},{id:"problem-tree",name:"问题树分析",description:"逐层拆解问题，找到根因和解决方案",emoji:"🌳",structure:{text:"核心问题：[填写你的问题]",children:[{text:"第一层：问题表现（看到的现象）",children:[{text:"现象1：..."},{text:"现象2：..."}]},{text:"第二层：问题原因（为什么会这样）",children:[{text:"原因1：..."},{text:"原因2：..."}]},{text:"第三层：解决方案（如何解决）",children:[{text:"方案1：..."},{text:"方案2：..."}]}]}},{id:"first-principles",name:"第一性原理",description:"回归本质，从基本原理推导结论",emoji:"🎯",structure:{text:"探索主题：[填写你的主题]",children:[{text:"第一步：问题的本质是什么？",children:[{text:"去除所有假设和经验，核心是..."}]},{text:"第二步：基本事实和公理",children:[{text:"确定无疑的事实1：..."},{text:"确定无疑的事实2：..."}]},{text:"第三步：从基本原理推导",children:[{text:"推导1：基于事实X，可以得出..."},{text:"推导2：基于事实Y，可以得出..."}]},{text:"第四步：重新构建解决方案",children:[{text:"创新方案：..."}]}]}},{id:"scqa",name:"SCQA框架",description:"结构化表达：情境-冲突-问题-答案",emoji:"📊",structure:{text:"主题：[填写你的主题]",children:[{text:"Situation - 情境（背景和现状）",children:[{text:"当前的情况是..."}]},{text:"Complication - 冲突（遇到的问题）",children:[{text:"但是出现了..."}]},{text:"Question - 问题（需要回答的核心问题）",children:[{text:"所以我们要解决：..."}]},{text:"Answer - 答案（解决方案）",children:[{text:"方案1：...",children:[{text:"理由：..."},{text:"预期效果：..."}]},{text:"方案2：...",children:[{text:"理由：..."},{text:"预期效果：..."}]}]}]}},{id:"feynman",name:"费曼学习法",description:"通过简化和类比来深度理解概念",emoji:"🧠",structure:{text:"学习主题：[填写你想学习的概念]",children:[{text:"第一步：用自己的话解释",children:[{text:"我理解的是..."}]},{text:"第二步：找到不理解的部分",children:[{text:"我还不清楚..."},{text:"需要进一步研究..."}]},{text:"第三步：用简单的类比",children:[{text:"这就像..."},{text:"可以类比为..."}]},{text:"第四步：简化和精炼",children:[{text:"核心要点1：..."},{text:"核心要点2：..."}]}]}},{id:"swot",name:"SWOT分析",description:"评估优势、劣势、机会、威胁",emoji:"⚖️",structure:{text:"分析对象：[填写你要分析的对象]",children:[{text:"Strengths - 优势（内部有利因素）",children:[{text:"优势1：..."},{text:"优势2：..."}]},{text:"Weaknesses - 劣势（内部不利因素）",children:[{text:"劣势1：..."},{text:"劣势2：..."}]},{text:"Opportunities - 机会（外部有利因素）",children:[{text:"机会1：..."},{text:"机会2：..."}]},{text:"Threats - 威胁（外部不利因素）",children:[{text:"威胁1：..."},{text:"威胁2：..."}]}]}},{id:"decision-tree",name:"决策树分析",description:"系统性评估多个选项的优劣",emoji:"🎲",structure:{text:"决策问题：[填写你的决策问题]",children:[{text:"选项A：...",children:[{text:"优点：..."},{text:"缺点：..."},{text:"风险：..."},{text:"预期结果：..."}]},{text:"选项B：...",children:[{text:"优点：..."},{text:"缺点：..."},{text:"风险：..."},{text:"预期结果：..."}]},{text:"对比和结论",children:[{text:"最佳选择：..."},{text:"原因：..."}]}]}}];function eot(t){return s1.find(e=>e.id===t)}const tot=Object.freeze(Object.defineProperty({__proto__:null,arenaTemplates:s1,getTemplateById:eot},Symbol.toStringTag,{value:"Module"})),not=({isOpen:t,onClose:e,onCreate:n})=>{const[r,i]=P.useState("template"),[a,s]=P.useState(s1[0]),[o,l]=P.useState(""),u=P.useRef(null);P.useEffect(()=>{if(t){const f=sessionStorage.getItem("arenaSourceMemoryText");setTimeout(()=>{l(f?`关于"${f.slice(0,30)}${f.length>30?"...":""}"的推导`:""),i("template"),s(s1[0])},0),f&&sessionStorage.removeItem("arenaSourceMemoryText")}},[t]),P.useEffect(()=>{r==="input"&&t&&setTimeout(()=>u.current?.focus(),100)},[r,t]);const c=f=>{s(f),i("input")},d=()=>{o.trim()&&(n(o.trim(),void 0,void 0,a.id),e())},h=f=>{f.key==="Escape"?e():f.key==="Enter"&&(f.metaKey||f.ctrlKey)&&(f.preventDefault(),d())};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:e,className:"relative z-50",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-2xl max-h-[90vh] bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden flex flex-col",children:[g.jsx("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.02]",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-3",children:[r==="input"&&g.jsx("button",{onClick:()=>i("template"),className:"w-7 h-7 rounded hover:bg-white/10 text-gray-500 hover:text-gray-300 transition-colors flex items-center justify-center",title:"返回",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),g.jsx(ar.Title,{className:"text-base font-medium text-gray-200",children:r==="template"?"选择思考框架":"创建演武场"})]}),g.jsx("button",{onClick:e,className:"w-7 h-7 rounded hover:bg-white/10 text-gray-500 hover:text-gray-300 transition-colors flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),g.jsx("div",{className:"px-6 py-5 flex-1 overflow-y-auto custom-scrollbar",children:r==="template"?g.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:s1.map(f=>g.jsx("button",{onClick:()=>c(f),className:`
                          text-left p-3.5 rounded border transition-colors
                          ${a.id===f.id?"bg-white/10 border-white/20":"bg-white/5 border-white/10 hover:border-white/20"}
                        `,children:g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-xl",children:f.emoji}),g.jsx("div",{className:"font-medium text-sm text-gray-200",children:f.name})]}),g.jsx("div",{className:"text-xs text-gray-500 leading-relaxed",children:f.description})]})},f.id))}):g.jsxs("div",{className:"space-y-4",children:[g.jsx("div",{className:"bg-white/5 border border-white/10 rounded p-3",children:g.jsxs("div",{className:"flex items-center gap-2.5",children:[g.jsx("span",{className:"text-2xl",children:a.emoji}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("div",{className:"text-sm font-medium text-gray-200",children:a.name}),g.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate",children:a.description})]}),g.jsx("button",{onClick:()=>i("template"),className:"text-xs text-gray-400 hover:text-gray-300 transition-colors",children:"更换"})]})}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"核心问题 *"}),g.jsx("textarea",{ref:u,value:o,onChange:f=>l(f.target.value),onKeyDown:h,placeholder:"输入你想探索的问题",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2.5 text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-white/30 transition-colors resize-none",maxLength:200,rows:3}),g.jsxs("div",{className:"flex items-center justify-between mt-2",children:[g.jsx("p",{className:"text-xs text-gray-600",children:"⌘Enter 创建 · Esc 取消"}),g.jsxs("span",{className:"text-xs text-gray-600",children:[o.length,"/200"]})]})]})]})}),g.jsxs("div",{className:"px-6 py-4 border-t border-white/5 flex justify-end gap-2",children:[g.jsx("button",{onClick:e,className:"px-4 py-2 rounded text-sm text-gray-400 hover:text-gray-300 hover:bg-white/5 transition-colors",children:"取消"}),r==="input"&&g.jsx("button",{onClick:d,disabled:!o.trim(),className:"px-4 py-2 rounded text-sm bg-white/10 hover:bg-white/15 text-white transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"创建"})]})]})})})]})})};function rot(t){const[e,n]=P.useState(t.arenaV2Universes||[{id:"u1",name:"主宇宙",active:!0,createdAt:new Date}]),[r,i]=P.useState(t.arenaV2ActiveUniverseId||"u1"),[a,s]=P.useState(Object.values(t.arenaV2Nodes||{})),[o,l]=P.useState(t.arenaV2Snapshots||[]),[u,c]=P.useState(null);P.useEffect(()=>{if(t.type!=="arena-v2")return;const m=t.arenaV2Nodes?Object.keys(t.arenaV2Nodes).length:0;a.length>0||m<=0||(s(Object.values(t.arenaV2Nodes||{})),n(t.arenaV2Universes||[{id:"u1",name:"主宇宙",active:!0,createdAt:new Date}]),l(t.arenaV2Snapshots||[]),i(t.arenaV2ActiveUniverseId||"u1"))},[t,a.length,i,s,l,n]);const d=P.useMemo(()=>a.filter(m=>m.universeId===r),[a,r]),h=P.useMemo(()=>d.find(m=>m.parent===null),[d]),f=P.useMemo(()=>u?a.find(m=>m.id===u):null,[u,a]);return{universes:e,activeUniverseId:r,nodes:a,snapshots:o,selectedNodeId:u,currentNodes:d,rootNode:h,selectedNode:f,setUniverses:n,setActiveUniverseId:i,setNodes:s,setSnapshots:l,setSelectedNodeId:c}}/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iot=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aot=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),aX=t=>{const e=aot(t);return e.charAt(0).toUpperCase()+e.slice(1)},Wue=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),sot=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var oot={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lot=P.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:a,iconNode:s,...o},l)=>P.createElement("svg",{ref:l,...oot,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:Wue("lucide",i),...!a&&!sot(o)&&{"aria-hidden":"true"},...o},[...s.map(([u,c])=>P.createElement(u,c)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=(t,e)=>{const n=P.forwardRef(({className:r,...i},a)=>P.createElement(lot,{ref:a,iconNode:e,className:Wue(`lucide-${iot(aX(t))}`,`lucide-${t}`,r),...i}));return n.displayName=aX(t),n};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uot=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],cot=xn("arrow-right",uot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dot=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],hot=xn("brain",dot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fot=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],o1=xn("camera",fot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pot=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Gh=xn("check",pot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mot=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ph=xn("chevron-down",mot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const got=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],hP=xn("chevron-left",got);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vot=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],i_=xn("chevron-right",vot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yot=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],k6=xn("chevron-up",yot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],bot=xn("circle-check",xot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Yue=xn("circle-question-mark",_ot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wot=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],sX=xn("cloud",wot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sot=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],Xue=xn("code-xml",Sot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eot=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Tot=xn("compass",Eot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cot=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],fP=xn("copy",Cot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mot=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],a_=xn("cpu",Mot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aot=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]],oX=xn("dices",Aot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kot=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Kue=xn("ellipsis-vertical",kot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iot=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],pP=xn("ellipsis",Iot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Not=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Rot=xn("eye",Not);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pot=[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]],kN=xn("fast-forward",Pot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dot=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Dh=xn("file-text",Dot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],IN=xn("globe",Oot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lot=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Zue=xn("grip-vertical",Lot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fot=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],mP=xn("history",Fot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Uot=xn("info",Bot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zot=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],jot=xn("lightbulb",zot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hot=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],$ot=xn("link-2",Hot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vot=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],qot=xn("link",Vot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Got=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Jue=xn("map",Got);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wot=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Yot=xn("maximize-2",Wot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xot=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Kot=xn("minimize-2",Xot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zot=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],Que=xn("mouse-pointer-2",Zot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jot=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],a2=xn("panels-top-left",Jot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qot=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],elt=xn("pen-line",Qot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tlt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],NN=xn("plus",tlt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nlt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],gP=xn("refresh-cw",nlt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rlt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ilt=xn("save",rlt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const alt=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],lX=xn("server",alt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const slt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],s2=xn("shield-alert",slt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const olt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],o2=xn("sparkles",olt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const llt=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],ece=xn("split",llt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ult=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],vP=xn("sticky-note",ult);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const clt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],tce=xn("target",clt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dlt=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],hlt=xn("toggle-left",dlt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const flt=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],plt=xn("toggle-right",flt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mlt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],yP=xn("trash-2",mlt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const glt=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],l2=xn("triangle-alert",glt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vlt=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ba=xn("x",vlt),Mi={fact:{color:"text-emerald-500",colorValue:"#10b981",bg:"bg-zinc-900",border:"border-emerald-900/30",icon:bot,label:"事实",weight:1,description:"客观可验证的信息"},assumption:{color:"text-amber-500",colorValue:"#f59e0b",bg:"bg-zinc-900",border:"border-amber-900/30",icon:Tot,label:"假设",weight:.6,description:"需要验证的前提"},risk:{color:"text-rose-500",colorValue:"#ef4444",bg:"bg-zinc-900",border:"border-rose-900/30",icon:s2,label:"风险",weight:.3,description:"潜在的威胁或挑战"},goal:{color:"text-zinc-100",colorValue:"#f4f4f5",bg:"bg-zinc-800",border:"border-zinc-700",icon:tce,label:"目标",weight:.9,description:"期望达到的结果"},question:{color:"text-sky-500",colorValue:"#38bdf8",bg:"bg-zinc-900",border:"border-sky-900/30",icon:Yue,label:"疑问",weight:.5,description:"待解决的问题"}},Xo=[{name:"SWOT 分析",items:["优势 (Strengths)","劣势 (Weaknesses)","机会 (Opportunities)","威胁 (Threats)"],types:["fact","risk","fact","risk"],description:"战略规划的经典框架，分析内部优劣势和外部机会威胁",useCase:"适用于：商业决策、项目评估、竞争分析、个人发展规划"},{name:"SCQA 框架",items:["情景 (Situation)","冲突 (Complication)","疑问 (Question)","回答 (Answer)"],types:["fact","question","question","goal"],description:"结构化表达框架，从背景出发，引出矛盾，提出问题，给出答案",useCase:"适用于：报告撰写、问题诊断、方案陈述、故事叙述"},{name:"5W2H 拆解",items:["Why (目的)","What (内容)","Who (责任)","When (时间)","Where (地点)","How (方法)","How much (成本)"],types:["goal","fact","fact","fact","fact","assumption","risk"],description:"全面的问题分析框架，从7个维度拆解复杂问题",useCase:"适用于：项目规划、流程设计、问题诊断、目标分解"}],Oh={HORIZONTAL_GAP_FREE:320,VERTICAL_GAP:140,MIN_SCALE:.15,MAX_SCALE:3,DEFAULT_SCALE:.8};function ylt(){const[t,e]=P.useState({x:typeof window<"u"?window.innerWidth/3:400,y:typeof window<"u"?window.innerHeight/2:300,scale:Oh.DEFAULT_SCALE}),[n,r]=P.useState(!1),[i,a]=P.useState({x:0,y:0}),[s,o]=P.useState(null),[l,u]=P.useState(!1),[c,d]=P.useState(!1);return{transform:t,setTransform:e,isDraggingCanvas:n,setIsDraggingCanvas:r,dragStart:i,setDragStart:a,draggedNodeId:s,setDraggedNodeId:o,isSpacePressed:l,setIsSpacePressed:u,isNavigationMode:c,setIsNavigationMode:d}}function xlt(t){const{nodes:e,transform:n,viewMode:r,selectedNodeId:i,activeUniverseId:a,setNodes:s,setTransform:o,setViewMode:l,setSelectedNodeId:u,setHasUnsavedChanges:c}=t,d=P.useRef([]),h=P.useRef([]),f=P.useRef(!1),m=P.useRef(null),x=P.useRef(null),b=P.useRef(null),y=P.useCallback(()=>({nodes:e.map(M=>({...M})),transform:{...n},viewMode:r,selectedNodeId:i,activeUniverseId:a}),[a,e,i,n,r]),w=P.useCallback(M=>{s(M.nodes.map(E=>({...E}))),o({...M.transform}),l(M.viewMode),u(M.selectedNodeId),c(!0)},[s,o,l,u,c]),_=P.useCallback(()=>{if(d.current.length===0)return;f.current=!0,b.current&&(clearTimeout(b.current),b.current=null),x.current=null;const M=y(),E=d.current.pop();if(!E){f.current=!1;return}h.current.push(M),w(E),setTimeout(()=>{m.current=E,f.current=!1},0)},[w,y]),S=P.useCallback(()=>{if(h.current.length===0)return;f.current=!0,b.current&&(clearTimeout(b.current),b.current=null),x.current=null;const M=y(),E=h.current.pop();if(!E){f.current=!1;return}d.current.push(M),w(E),setTimeout(()=>{m.current=E,f.current=!1},0)},[w,y]);return P.useEffect(()=>{const M=y();if(!m.current){m.current=M;return}if(f.current){m.current=M;return}x.current||(x.current=m.current),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{const E=x.current;x.current=null,E&&(d.current.push(E),d.current.length>60&&d.current.shift(),h.current=[])},350),m.current=M},[a,e,i,y,n,r]),{handleUndo:_,handleRedo:S,canUndo:d.current.length>0,canRedo:h.current.length>0}}function blt(t){const{arenaMemory:e,nodes:n,universes:r,snapshots:i,viewMode:a,activeUniverseId:s,onSave:o,pauseAutoSave:l=!1}=t,[u,c]=P.useState(!1),[d,h]=P.useState(!1),[f,m]=P.useState(null),[x,b]=P.useState(null),y=P.useRef(null),w=P.useRef(e),_=P.useRef(o);P.useEffect(()=>{w.current=e,_.current=o},[e,o]);const S=P.useRef(n),M=P.useRef(r),E=P.useRef(i),C=P.useRef(a),R=P.useRef(s);P.useEffect(()=>{S.current=n,M.current=r,E.current=i,C.current=a,R.current=s},[n,r,i,a,s]);const k=P.useCallback(async()=>{const N={};S.current.forEach(D=>{N[D.id]=D}),await _.current({...w.current,arenaV2Nodes:N,arenaV2Universes:M.current,arenaV2Snapshots:E.current,arenaV2ViewMode:C.current,arenaV2ActiveUniverseId:R.current,lastEditedAt:new Date})},[]);P.useEffect(()=>{if(u&&!l)return y.current&&(clearTimeout(y.current),y.current=null),y.current=setTimeout(async()=>{h(!0),b(null);try{await k(),c(!1),m(new Date),console.log("✅ Arena V2 自动保存成功")}catch(N){console.error("❌ Arena V2 自动保存失败:",N),b("保存失败，点击保存按钮重试")}finally{h(!1)}},1e3),()=>{y.current&&(clearTimeout(y.current),y.current=null)}},[u,l,k]),P.useEffect(()=>{function N(D){if(u||d)return D.preventDefault(),D.returnValue="您有未保存的更改，确定要离开吗？",D.returnValue}return window.addEventListener("beforeunload",N),()=>window.removeEventListener("beforeunload",N)},[u,d]),P.useEffect(()=>{async function N(){if(document.hidden&&u){h(!0),b(null);try{await k(),c(!1),m(new Date),console.log("✅ Arena V2 页面隐藏时保存成功")}catch(D){console.error("❌ Arena V2 页面隐藏时保存失败:",D),b("保存失败，点击保存按钮重试")}finally{h(!1)}}}return document.addEventListener("visibilitychange",N),()=>document.removeEventListener("visibilitychange",N)},[u,k]);const I=P.useCallback(async()=>{if(!(!u&&!x)&&!d){y.current&&(clearTimeout(y.current),y.current=null),h(!0),b(null);try{await k(),c(!1),m(new Date)}catch(N){console.error("❌ Arena V2 手动保存失败:",N),b("保存失败，请重试")}finally{h(!1)}}},[u,x,d,k]);return{hasUnsavedChanges:u,isSaving:d,lastSavedAt:f,saveError:x,setHasUnsavedChanges:c,handleSaveNow:I}}const hv="thineasy_ai_result_",uX=10;function I6(t,e,n){try{const r=`${hv}${t}_${e}`,i=`${hv}history_${e}`,a={...n,id:`${Date.now()}`,timestamp:new Date};localStorage.setItem(r,JSON.stringify(a));const s=localStorage.getItem(i),o=s?JSON.parse(s):[];o.unshift(a),o.length>uX&&o.splice(uX),localStorage.setItem(i,JSON.stringify(o))}catch(r){console.warn("[AI Result Cache] Failed to save:",r)}}function s_(t,e){try{const n=`${hv}${t}_${e}`,r=localStorage.getItem(n);return r?JSON.parse(r):null}catch{return null}}function o_(t){try{const e=`${hv}history_${t}`,n=localStorage.getItem(e);return n?JSON.parse(n):[]}catch{return[]}}function _lt(t){try{const e=`${hv}history_${t}`;localStorage.removeItem(e)}catch{}}function wlt(t,e){if(!t||!e||e.length===0)return[{type:"text",content:t}];const n=new Map;for(const l of e){n.set(l.id,l);const u=l.id.replace(/^node-/,"");if(u&&u!==l.id&&n.set(u,l),u&&u!==l.id){const c=`${l.type}-${u}`;n.set(c,l),n.set(`node-${c}`,l)}}const r=Array.from(n.keys()).filter(l=>l.length>=10).sort((l,u)=>u.length-l.length).map(l=>l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");if(!r)return[{type:"text",content:t}];const i=new RegExp(`(node-|节点-?)?(?:${r})`,"gi"),a=[];let s=0,o;for(;(o=i.exec(t))!==null;){const l=o[0],u=l.replace(/^(node-|节点-?)/i,""),c=n.get(u)||n.get(`node-${u}`)||n.get(l);c&&(o.index>s&&a.push({type:"text",content:t.slice(s,o.index)}),a.push({type:"node-ref",content:l,nodeId:c.id,node:c}),s=o.index+l.length)}return s<t.length&&a.push({type:"text",content:t.slice(s)}),a.length>0?a:[{type:"text",content:t}]}function kg({source:t}){const e={llm:{icon:o2,label:"AI",className:"text-purple-400/70"},rule:{icon:a_,label:"规则",className:"text-slate-500"},mixed:{icon:o2,label:"混合",className:"text-blue-400/70"}}[t],n=e.icon;return g.jsxs("span",{className:`inline-flex items-center gap-0.5 text-[9px] ${e.className}`,children:[g.jsx(n,{size:9}),e.label]})}function Slt({importance:t}){const e={high:"text-red-400/80",medium:"text-amber-400/80",low:"text-slate-500"};return g.jsx("span",{className:`text-[9px] ${e[t]}`,children:t==="high"?"●":t==="medium"?"○":"·"})}function Elt({severity:t}){const e={critical:"bg-red-500",high:"bg-amber-500",medium:"bg-slate-500"};return g.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${e[t]}`})}function nce({type:t}){const e=Mi[t]||Mi.fact;return g.jsx("span",{className:"inline-block w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:e.colorValue}})}function Tlt({node:t,onFocusNode:e,maxLength:n=18}){const r=t.text.trim(),i=r.length>n?r.slice(0,n)+"...":r;return g.jsxs("span",{onClick:a=>{a.stopPropagation(),e?.(t.id)},className:`inline-flex items-center gap-1 px-1.5 py-0.5 bg-white/[0.05] hover:bg-purple-500/20 
                 rounded text-[10px] text-purple-300 cursor-pointer transition-colors mx-0.5`,title:`点击定位到: ${r}`,children:[g.jsx(nce,{type:t.type}),g.jsx("span",{className:"truncate max-w-[150px]",children:i})]})}function Clt(t){const e=/"([^"]+)"|“([^“]+)”/g,n=[];let r=0,i,a=0;for(;(i=e.exec(t))!==null;){i.index>r&&n.push(g.jsx("span",{children:t.slice(r,i.index)},a++));const s=i[1]||i[2],o=i[0].startsWith('"'),l=o?"“":'"',u=o?"”":'"';n.push(g.jsxs("span",{className:"mx-1 px-1.5 py-0.5 bg-amber-500/10 text-amber-200/90 rounded",style:{fontStyle:"normal"},children:[l,s,u]},a++)),r=i.index+i[0].length}return r<t.length&&n.push(g.jsx("span",{children:t.slice(r)},a++)),n.length>0?n:[g.jsx("span",{children:t},0)]}function hg({text:t,nodes:e,onFocusNode:n,className:r=""}){const i=P.useMemo(()=>!t||t.trim()===""?[]:wlt(t,e||[]),[t,e]);return i.length===0?g.jsx("span",{className:`${r} text-slate-500 italic`,children:"（无内容）"}):g.jsx("span",{className:r,children:i.map((a,s)=>a.type==="node-ref"&&a.node?g.jsx(Tlt,{node:a.node,onFocusNode:n},s):g.jsx("span",{children:Clt(a.content)},s))})}function cX(t,e,n=20){if(!e)return t.slice(-8);const r=e.find(a=>a.id===t);if(!r)return t.slice(-8);const i=r.text.trim();return i.length<=n?i:i.slice(0,n)+"..."}function Mlt({onViewRaw:t,onCopy:e,onClearHistory:n,onViewHistory:r,rawAvailable:i=!1,hasHistory:a=!1}){const[s,o]=P.useState(!1);return g.jsxs("div",{className:"relative",children:[g.jsx("button",{onClick:()=>o(!s),className:"p-1 hover:bg-white/5 rounded text-slate-500 hover:text-slate-400 transition-colors",children:g.jsx(pP,{size:12})}),s&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),g.jsxs("div",{className:"absolute right-0 bottom-full mb-1 w-32 bg-slate-800 border border-white/10 rounded-lg shadow-xl z-50 overflow-hidden text-xs",children:[a&&r&&g.jsxs("button",{onClick:()=>{r(),o(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-white/5 text-slate-400 hover:text-slate-300",children:[g.jsx(mP,{size:11}),"历史记录"]}),i&&t&&g.jsxs("button",{onClick:()=>{t(),o(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-white/5 text-slate-400 hover:text-slate-300",children:[g.jsx(Xue,{size:11}),"原始响应"]}),e&&g.jsxs("button",{onClick:()=>{e(),o(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-white/5 text-slate-400 hover:text-slate-300",children:[g.jsx(fP,{size:11}),"复制"]}),a&&n&&g.jsxs("button",{onClick:()=>{n(),o(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 hover:bg-red-500/10 text-red-400",children:[g.jsx(yP,{size:11}),"清除历史"]})]})]})]})}function Alt({rawResponse:t,prompt:e,onClose:n}){const[r,i]=P.useState(!1),[a,s]=P.useState(!1),o=()=>{navigator.clipboard.writeText(t),i(!0),setTimeout(()=>i(!1),2e3)};return g.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[200] p-4",children:g.jsxs("div",{className:"w-full max-w-2xl bg-slate-800 rounded-xl shadow-2xl border border-white/10 overflow-hidden",children:[g.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Xue,{size:14,className:"text-slate-400"}),g.jsx("span",{className:"text-sm text-slate-300",children:"AI 原始响应"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[e&&g.jsx("button",{onClick:()=>s(!a),className:`px-2 py-1 text-[10px] rounded transition-colors ${a?"bg-purple-500/20 text-purple-300":"text-slate-500 hover:text-slate-400"}`,children:"Prompt"}),g.jsx("button",{onClick:o,className:"p-1.5 hover:bg-white/10 rounded text-slate-400",children:r?g.jsx(Gh,{size:14,className:"text-green-400"}):g.jsx(fP,{size:14})}),g.jsx("button",{onClick:n,className:"p-1.5 hover:bg-white/10 rounded text-slate-400",children:g.jsx(Ba,{size:14})})]})]}),a&&e&&g.jsxs("div",{className:"px-4 py-3 border-b border-white/5 bg-purple-500/5",children:[g.jsx("p",{className:"text-[10px] text-purple-400 mb-1",children:"Prompt"}),g.jsx("pre",{className:"text-xs text-slate-400 whitespace-pre-wrap font-mono max-h-32 overflow-y-auto",children:e})]}),g.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:g.jsx("pre",{className:"text-xs text-slate-300 whitespace-pre-wrap font-mono bg-slate-900/50 p-3 rounded-lg",children:t})})]})})}function klt({history:t,currentType:e,onSelect:n,onClose:r}){const i=t.filter(o=>o.type===e),a=o=>{switch(o.type){case"paradigm":return o.paradigmResults?.length||0;case"blindspot":return o.blindSpotResults?.length||0;case"conflict":return o.conflictResults?.length||0}},s=o=>{const l=new Date(o),c=new Date().getTime()-l.getTime(),d=Math.floor(c/6e4),h=Math.floor(c/36e5);return d<1?"刚刚":d<60?`${d}分钟前`:h<24?`${h}小时前`:l.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return g.jsxs("div",{className:"absolute inset-0 bg-slate-800/98 rounded-lg z-10 flex flex-col",children:[g.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[g.jsx(mP,{size:13}),g.jsx("span",{className:"text-xs",children:"历史分析记录"}),g.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",i.length,")"]})]}),g.jsx("button",{onClick:r,className:"p-1 hover:bg-white/5 rounded text-slate-500",children:g.jsx(Ba,{size:12})})]}),g.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:i.length===0?g.jsx("p",{className:"text-xs text-slate-500 text-center py-4",children:"暂无历史记录"}):g.jsx("div",{className:"space-y-1",children:i.map((o,l)=>g.jsxs("button",{onClick:()=>n(o),className:"w-full flex items-center justify-between p-2 bg-white/[0.02] hover:bg-white/[0.05] rounded text-left transition-colors",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsxs("span",{className:"text-[10px] text-slate-500",children:["#",i.length-l]}),g.jsx(kg,{source:o.source}),g.jsxs("span",{className:"text-[11px] text-slate-400",children:[a(o)," 条结果"]})]}),g.jsx("span",{className:"text-[10px] text-slate-600",children:s(o.timestamp)})]},o.id))})})]})}function Ilt({type:t,isLoading:e=!1,isAIEnabled:n=!0,onClose:r,onRefresh:i,rawResponse:a,prompt:s,paradigmResults:o,onApplyParadigm:l,blindSpotResults:u,onAddQuestion:c,conflictResults:d,onFocusNode:h,onImportAsNode:f,history:m=[],onClearHistory:x,onLoadHistory:b,scope:y="global",nodes:w}){const[_,S]=P.useState(!1),[M,E]=P.useState(!1),[C,R]=P.useState(new Set([0])),[k,I]=P.useState({x:16,y:60}),[N,D]=P.useState(!1),F=P.useRef({x:0,y:0,posX:0,posY:0}),[L,U]=P.useState(420),[j,q]=P.useState(!1),Z=P.useRef({x:0,width:0}),Q=P.useRef(null),z=be=>{const De=new Set(C);De.has(be)?De.delete(be):De.add(be),R(De)},W=P.useCallback(be=>{be.preventDefault(),D(!0),F.current={x:be.clientX,y:be.clientY,posX:k.x,posY:k.y}},[k]);P.useEffect(()=>{if(!N)return;const be=ke=>{const Me=ke.clientX-F.current.x,Ie=ke.clientY-F.current.y;I({x:Math.max(0,F.current.posX+Me),y:Math.max(16,F.current.posY-Ie)})},De=()=>{D(!1)};return document.addEventListener("mousemove",be),document.addEventListener("mouseup",De),()=>{document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",De)}},[N]);const X=P.useCallback(be=>{be.preventDefault(),be.stopPropagation(),q(!0),Z.current={x:be.clientX,width:L}},[L]);P.useEffect(()=>{if(!j)return;const be=ke=>{const Me=ke.clientX-Z.current.x;U(Math.max(320,Math.min(800,Z.current.width+Me)))},De=()=>{q(!1)};return document.addEventListener("mousemove",be),document.addEventListener("mouseup",De),()=>{document.removeEventListener("mousemove",be),document.removeEventListener("mouseup",De)}},[j]);const H=()=>{switch(t){case"paradigm":return"范式推荐";case"blindspot":return"盲点扫描";case"conflict":return"冲突检测"}},J=(be,De)=>{const ke={size:be,className:De};switch(t){case"paradigm":return g.jsx(a2,{...ke});case"blindspot":return g.jsx(Rot,{...ke});case"conflict":return g.jsx(l2,{...ke})}},te=()=>{const be=t==="paradigm"?o:t==="blindspot"?u:d;if(!be||be.length===0)return"rule";const De=be.some(Me=>Me.source==="llm"),ke=be.some(Me=>Me.source==="rule");return De&&ke?"mixed":De?"llm":"rule"},ee=()=>t==="paradigm"?o?.length||0:t==="blindspot"?u?.length||0:d?.length||0,se=te(),ue=m.filter(be=>be.type===t),oe=()=>{const be=t==="paradigm"?o?.map(De=>`${De.paradigm.name}: ${De.reasoning}`).join(`
`):t==="blindspot"?u?.map(De=>`${De.category}: ${De.description}`).join(`
`):d?.map(De=>De.description).join(`
`);be&&navigator.clipboard.writeText(be)},Te=be=>{b?.(be),E(!1)},Ne={left:`${k.x}px`,bottom:`${k.y}px`,width:`${L}px`};return e?g.jsxs("div",{ref:Q,className:"fixed max-w-[90vw] bg-slate-800/95 backdrop-blur-lg border border-white/5 rounded-lg shadow-xl z-[80]",style:Ne,children:[g.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[J(13),g.jsx("span",{className:"text-xs",children:H()})]}),g.jsx("button",{onClick:r,className:"p-1 hover:bg-white/5 rounded text-slate-500",children:g.jsx(Ba,{size:12})})]}),g.jsxs("div",{className:"p-6 flex items-center justify-center gap-3",children:[g.jsx("div",{className:"w-5 h-5 border border-purple-500/30 border-t-purple-500 rounded-full animate-spin"}),g.jsx("span",{className:"text-xs text-slate-500",children:n?"分析中...":"规则检测中..."})]})]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{ref:Q,className:"fixed max-w-[90vw] bg-slate-800/95 backdrop-blur-lg border border-white/5 rounded-lg shadow-xl z-[80] flex flex-col",style:Ne,children:[M&&g.jsx(klt,{history:m,currentType:t,onSelect:Te,onClose:()=>E(!1)}),g.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/5 cursor-move select-none",onMouseDown:W,children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Zue,{size:12,className:"text-slate-600"}),J(13,"text-slate-400"),g.jsx("span",{className:"text-xs text-slate-300",children:H()}),g.jsx(kg,{source:se}),ee()>0&&g.jsx("span",{className:"text-[10px] text-slate-500",children:ee()})]}),g.jsxs("div",{className:"flex items-center gap-0.5",onMouseDown:be=>be.stopPropagation(),children:[ue.length>0&&g.jsxs("button",{onClick:()=>E(!0),className:"p-1.5 hover:bg-white/5 rounded text-slate-500 hover:text-slate-400 transition-colors relative",title:"查看历史记录",children:[g.jsx(mP,{size:11}),g.jsx("span",{className:"absolute -top-1 -right-1 text-[9px] text-slate-500 font-medium",children:ue.length})]}),g.jsx("button",{onClick:i,className:"p-1.5 hover:bg-white/5 rounded text-slate-500 hover:text-slate-400 transition-colors",title:"重新分析",children:g.jsx(gP,{size:11})}),g.jsx(Mlt,{onViewRaw:a?()=>S(!0):void 0,rawAvailable:!!a,onCopy:oe,onViewHistory:ue.length>0?()=>E(!0):void 0,onClearHistory:ue.length>0?x:void 0,hasHistory:ue.length>0}),g.jsx("button",{onClick:r,className:"p-1.5 hover:bg-white/5 rounded text-slate-500",children:g.jsx(Ba,{size:12})})]})]}),g.jsxs("div",{className:"p-3 overflow-y-auto select-text",style:{maxHeight:"60vh"},children:[t==="paradigm"&&g.jsx("div",{className:"space-y-3",children:!o||o.length===0?g.jsx("p",{className:"text-xs text-slate-500 text-center py-3",children:"暂无推荐"}):o.map((be,De)=>g.jsxs("div",{className:`rounded-lg border overflow-hidden transition-all ${C.has(De)?"border-purple-500/30 bg-slate-900/50":"border-white/5 bg-white/[0.01]"}`,children:[g.jsxs("div",{onClick:()=>z(De),className:"w-full flex items-center justify-between p-3 cursor-pointer hover:bg-white/[0.02] transition-colors",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx(a2,{size:12,className:"text-purple-400/70"}),g.jsx("span",{className:"text-xs text-slate-200 font-medium truncate",children:be.paradigm.name}),g.jsx(kg,{source:be.source}),g.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-purple-500/10 text-purple-300 rounded",children:[Math.round(be.matchScore*100),"%"]})]}),g.jsx("div",{className:`p-1 rounded transition-colors ${C.has(De)?"bg-purple-500/20":""}`,children:C.has(De)?g.jsx(k6,{size:12,className:"text-purple-400"}):g.jsx(Ph,{size:12,className:"text-slate-500"})})]}),C.has(De)&&g.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-white/5",children:[g.jsxs("div",{className:"pt-3",children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[g.jsx("div",{className:"w-1 h-3 bg-purple-500/50 rounded-full"}),g.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:"推荐理由"})]}),g.jsx(hg,{text:be.reasoning,nodes:w,onFocusNode:h,className:"text-[11px] text-slate-300 leading-relaxed"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[g.jsx("div",{className:"w-1 h-3 bg-cyan-500/50 rounded-full"}),g.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:"范式要素"})]}),g.jsx("div",{className:"flex flex-wrap gap-1.5",children:be.paradigm.items.map((ke,Me)=>g.jsx("span",{onClick:Ie=>{Ie.stopPropagation(),f?.(ke,"assumption")},className:"px-2 py-1 text-[10px] bg-slate-800/50 border border-white/5 text-slate-300 rounded-lg hover:bg-purple-500/10 hover:border-purple-500/30 hover:text-purple-300 transition-colors cursor-pointer",title:"添加为假设节点",children:ke},Me))})]}),g.jsx("div",{className:"flex gap-2 pt-1",children:g.jsxs("button",{onClick:ke=>{ke.stopPropagation(),l?.(be.paradigm)},className:"flex items-center gap-1.5 px-3 py-1.5 text-[10px] bg-purple-500/20 text-purple-300 rounded-lg hover:bg-purple-500/30 transition-all",children:[g.jsx(Gh,{size:11}),"应用此范式"]})})]})]},De))}),t==="blindspot"&&g.jsx("div",{className:"space-y-3",children:!u||u.length===0?g.jsxs("div",{className:"text-center py-4",children:[g.jsx(jot,{size:18,className:"mx-auto text-green-500/50 mb-1"}),g.jsx("p",{className:"text-xs text-slate-500",children:"未发现明显盲点"})]}):u.map((be,De)=>g.jsxs("div",{className:`rounded-lg border overflow-hidden transition-all ${C.has(De)?"border-amber-500/30 bg-slate-900/50":"border-white/5 bg-white/[0.01]"}`,children:[g.jsxs("div",{onClick:()=>z(De),className:"w-full flex items-center justify-between p-3 cursor-pointer hover:bg-white/[0.02] transition-colors",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx(Slt,{importance:be.importance}),g.jsx("span",{className:"text-xs text-slate-200 font-medium truncate",children:be.category}),g.jsx(kg,{source:be.source})]}),g.jsx("div",{className:`p-1 rounded transition-colors ${C.has(De)?"bg-amber-500/20":""}`,children:C.has(De)?g.jsx(k6,{size:12,className:"text-amber-400"}):g.jsx(Ph,{size:12,className:"text-slate-500"})})]}),C.has(De)&&g.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-white/5",children:[g.jsxs("div",{className:"pt-3",children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[g.jsx("div",{className:"w-1 h-3 bg-amber-500/50 rounded-full"}),g.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:"描述"})]}),g.jsx(hg,{text:be.description,nodes:w,onFocusNode:h,className:"text-[11px] text-slate-300 leading-relaxed"})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5",children:[g.jsx("div",{className:"w-1 h-3 bg-cyan-500/50 rounded-full"}),g.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:"引导问题"})]}),g.jsx("div",{className:"space-y-1.5",children:be.questions.map((ke,Me)=>g.jsxs("div",{className:"flex items-start justify-between gap-2 p-2 bg-slate-800/50 border border-white/5 rounded-lg group",children:[g.jsx(hg,{text:ke,nodes:w,onFocusNode:h,className:"text-[11px] text-slate-300 flex-1 leading-relaxed"}),g.jsx("span",{onClick:Ie=>{Ie.stopPropagation(),c?.(ke,"question")},className:"flex-shrink-0 p-1 hover:bg-cyan-500/20 text-slate-500 hover:text-cyan-400 rounded transition-all cursor-pointer opacity-60 group-hover:opacity-100",title:"添加为疑问节点",children:g.jsx(NN,{size:12})})]},Me))})]})]})]},De))}),t==="conflict"&&g.jsx("div",{className:"space-y-3",children:!d||d.length===0?g.jsxs("div",{className:"text-center py-4",children:[g.jsx(Gh,{size:18,className:"mx-auto text-green-500/50 mb-1"}),g.jsx("p",{className:"text-xs text-slate-500",children:"未发现逻辑冲突"})]}):d.map((be,De)=>g.jsxs("div",{className:`rounded-lg border overflow-hidden transition-all ${C.has(De)?"border-purple-500/30 bg-slate-900/50":"border-white/5 bg-white/[0.01]"}`,children:[g.jsxs("div",{onClick:()=>z(De),className:`w-full flex items-center justify-between p-3 cursor-pointer transition-colors ${be.severity==="critical"?"bg-red-500/10 hover:bg-red-500/15":"hover:bg-white/[0.02]"}`,children:[g.jsxs("div",{className:"flex items-center gap-2.5 min-w-0 flex-1",children:[g.jsx(Elt,{severity:be.severity}),g.jsx("span",{className:"text-[13px] text-slate-100 font-medium",children:(be.title||be.description).length>20?(be.title||be.description).slice(0,20)+"...":be.title||be.description}),g.jsx(kg,{source:be.source})]}),g.jsx("div",{className:`p-1 rounded transition-colors ${C.has(De)?"bg-purple-500/20":""}`,children:C.has(De)?g.jsx(k6,{size:14,className:"text-purple-400"}):g.jsx(Ph,{size:14,className:"text-slate-500"})})]}),C.has(De)&&g.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-white/5",children:[g.jsxs("div",{className:"pt-3",children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[g.jsx("div",{className:"w-1 h-3.5 bg-purple-500/50 rounded-full"}),g.jsx("span",{className:"text-[11px] text-slate-400 font-medium",children:"描述"})]}),g.jsx(hg,{text:be.description,nodes:w,onFocusNode:h,className:"text-[13px] text-slate-200 leading-relaxed"})]}),(be.suggestionText||be.suggestion)&&g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[g.jsx("div",{className:"w-1 h-3.5 bg-emerald-500/50 rounded-full"}),g.jsx("span",{className:"text-[11px] text-slate-400 font-medium",children:"建议"})]}),g.jsx("div",{className:"p-3 bg-emerald-500/5 border border-emerald-500/20 rounded-lg",children:g.jsx(hg,{text:be.suggestionText||be.suggestion||"",nodes:w,onFocusNode:h,className:"text-[13px] text-slate-200 leading-relaxed"})})]}),be.insertableNode&&(()=>{const ke=be.nodeIds[0],Me=w?.find(Ie=>Ie.id===ke);return g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[g.jsx("div",{className:"w-1 h-3.5 bg-amber-500/50 rounded-full"}),g.jsx("span",{className:"text-[11px] text-slate-400 font-medium",children:"可插入节点"})]}),g.jsxs("div",{className:"p-3 bg-amber-500/5 border border-amber-500/20 rounded-lg space-y-2",children:[g.jsx("span",{className:"text-[13px] text-amber-200 block",children:be.insertableNode}),g.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1 border-t border-amber-500/10",children:[g.jsxs("span",{className:"text-[10px] text-slate-500",children:["→ 插入至「",Me?cX(ke,w,15):"根节点","」下"]}),g.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),f?.(be.insertableNode,"question",ke)},className:"flex-shrink-0 px-2.5 py-1 text-[10px] bg-amber-500/20 text-amber-300 rounded-md hover:bg-amber-500/30 transition-colors",children:"确认插入"})]})]})]})})(),g.jsxs("details",{className:"group",children:[g.jsxs("summary",{className:"flex items-center gap-1.5 cursor-pointer select-none list-none text-slate-500 hover:text-slate-400 transition-colors",children:[g.jsx("span",{className:"text-[10px]",children:"涉及节点"}),g.jsxs("span",{className:"text-[10px]",children:["(",be.nodeIds.length,")"]}),g.jsx(Ph,{size:10,className:"ml-auto transition-transform group-open:rotate-180"})]}),g.jsx("div",{className:"space-y-1 mt-2",children:be.nodeIds.map((ke,Me)=>{const Ie=w?.find(ce=>ce.id===ke);return g.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-slate-800/30 border border-white/5 rounded text-[11px] group/node",children:[g.jsxs("span",{className:"text-slate-600 w-3",children:[Me+1,"."]}),Ie&&g.jsx(nce,{type:Ie.type}),g.jsx("span",{className:"text-slate-300 flex-1 truncate",children:cX(ke,w,30)}),g.jsx("span",{onClick:ce=>{ce.stopPropagation(),h?.(ke)},className:"flex-shrink-0 p-0.5 text-slate-600 hover:text-purple-400 rounded transition-all cursor-pointer",title:"定位",children:g.jsx(tce,{size:10})})]},ke)})})]})]})]},De))})]}),g.jsxs("div",{className:"px-3 py-1.5 border-t border-white/5 text-[9px] text-slate-600 flex justify-between",children:[g.jsx("span",{children:n?"AI增强":"规则模式"}),g.jsx("span",{children:y==="selected"?"分析选中节点":"分析全部节点"})]}),g.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-purple-500/20 transition-colors",onMouseDown:X})]}),_&&a&&g.jsx(Alt,{rawResponse:a,prompt:s,onClose:()=>S(!1)})]})}function Nlt(t){const[e,n]=P.useState(!1),[r,i]=P.useState(null),[a,s]=P.useState([]),[o,l]=P.useState([]),[u,c]=P.useState([]),[d,h]=P.useState(),[f,m]=P.useState(),[x,b]=P.useState(()=>typeof window<"u"?localStorage.getItem("thineasy_ai_enabled")!=="false":!0),[y,w]=P.useState(()=>o_(t)),[_,S]=P.useState(()=>!!s_("paradigm",t)),[M,E]=P.useState(()=>!!s_("blindspot",t)),[C,R]=P.useState(()=>!!s_("conflict",t));return{isAILoading:e,setIsAILoading:n,aiResultType:r,setAIResultType:i,paradigmResults:a,setParadigmResults:s,blindSpotResults:o,setBlindSpotResults:l,conflictResults:u,setConflictResults:c,aiRawResponse:d,setAIRawResponse:h,aiPrompt:f,setAIPrompt:m,aiEnabled:x,setAIEnabled:b,aiResultHistory:y,setAIResultHistory:w,hasParadigmCache:_,setHasParadigmCache:S,hasBlindspotCache:M,setHasBlindspotCache:E,hasConflictCache:C,setHasConflictCache:R}}function rce(t,e,n){const r=t.filter(u=>u.universeId===e);if(r.length===0)return t;const i=r.find(u=>u.parent===null);if(!i)return t;const a=new Map;r.forEach(u=>{if(u.parent){const c=a.get(u.parent)||[];c.push(u),a.set(u.parent,c)}});const s=new Map;function o(u,c){const d=a.get(u)||[];if(d.length===0)return s.set(u,1),1;const h=d.reduce((f,m)=>f+o(m.id),0);return s.set(u,h),h}o(i.id);const l=new Map;if(n==="tree"){let u=function(h,f,m){const x=a.get(h)||[];if(x.length===0){const E=m,C=f*c;return l.set(h,{x:E,y:C}),{width:d,center:E}}let b=m;const y=[];x.forEach(E=>{const C=u(E.id,f+1,b);y.push(C.center),b+=C.width});const w=y[0],_=y[y.length-1],S=(w+_)/2,M=f*c;return l.set(h,{x:S,y:M}),{width:b-m,center:S}};const c=160,d=200;u(i.id,0,0)}else{let u=function(h,f,m){const x=a.get(h)||[];if(x.length===0){const E=f*c,C=m;return l.set(h,{x:E,y:C}),{height:d,center:C}}let b=m;const y=[];x.forEach(E=>{const C=u(E.id,f+1,b);y.push(C.center),b+=C.height});const w=y[0],_=y[y.length-1],S=(w+_)/2,M=f*c;return l.set(h,{x:M,y:S}),{height:b-m,center:S}};const c=Oh.HORIZONTAL_GAP_FREE,d=Oh.VERTICAL_GAP;u(i.id,0,0)}return t.map(u=>{if(u.universeId!==e)return u;const c=l.get(u.id);return c?{...u,px:c.x,py:c.y,lastEditedAt:new Date}:u})}function dX(t,e,n="bezier"){const{px:r,py:i}=t,{px:a,py:s}=e;if(n==="orthogonal"){const u=r+(a-r)*.5;return`M ${r} ${i} L ${u} ${i} L ${u} ${s} L ${a} ${s}`}const o=r+150,l=a-150;return`M ${r} ${i} C ${o} ${i}, ${l} ${s}, ${a} ${s}`}function Rlt(t,e){if(t.length===0)return 0;const n=t.reduce((r,i)=>{const a=e[i.type]?.weight||0;return r+a},0);return Math.round(n/t.length*100)}function xP(t,e){const n=e.find(a=>a.id===t);if(!n)return[];const i=e.filter(a=>a.parent===t).flatMap(a=>xP(a.id,e));return[n,...i]}function Plt(t){const e=[];return t.forEach(n=>{t.forEach(r=>{n.id!==r.id&&(n.parent!==r.parent||n.parent===null||n.type==="fact"&&r.type==="risk"&&e.push({from:n.id,to:r.id}))})}),e}function Wn(t="medium"){if(!navigator.vibrate)return;let e;switch(t){case"light":e=10;break;case"medium":e=20;break;case"heavy":e=40;break;case"success":e=[10,50,10];break;case"warning":e=[20,100,20,100,20];break;case"error":e=[50,100,50];break;default:e=20}try{navigator.vibrate(e)}catch(n){console.debug("Haptic feedback failed:",n)}}function Dlt({nodes:t,selectedNodeId:e,activeUniverseId:n,isNavigationMode:r,setNodes:i,setSelectedNodeId:a,setHasUnsavedChanges:s}){const[o,l]=P.useState(null),[u,c]=P.useState(null),[d,h]=P.useState(()=>typeof window<"u"?window.innerWidth>=768:!0),[f,m]=P.useState(null),x=P.useCallback((N,D)=>{const F=t.find(j=>j.id===N);if(!F)return;const U={id:`node-${Date.now()}`,text:Mi[D].description,type:D,px:F.px+280,py:F.py+(Math.random()-.5)*200,parent:N,level:F.level+1,universeId:n,expanded:!1,createdAt:new Date};i(j=>[...j.map(q=>q.id===N?{...q,expanded:!0}:q),U]),s(!0),Wn("light")},[t,n,i,s]),b=P.useCallback(N=>{const D=xP(N,t),F=new Set(D.map(L=>L.id));i(L=>L.filter(U=>!F.has(U.id))),e&&F.has(e)&&a(null),s(!0),Wn("medium")},[t,e,i,a,s]),y=P.useCallback(N=>{const D=t.find(F=>F.id===N);D&&(i(F=>F.map(L=>L.parent===N?{...L,parent:D.parent,level:L.level-1}:L).filter(L=>L.id!==N)),e===N&&a(null),s(!0))},[t,e,i,a,s]),w=P.useCallback(N=>{const D=t.find(L=>L.id===N);if(!D)return;const F=t.filter(L=>L.parent===N).length;F>0?m({show:!0,title:"删除节点",message:`此节点有 ${F} 个子节点`,variant:"danger",confirmText:"仅删当前",thirdButtonText:"删含子节点",onConfirm:()=>{m(null),y(N)},onThirdButton:()=>{m(null),b(N)}}):m({show:!0,title:"删除节点",message:`确定删除节点"${D.text||"空节点"}"吗？`,variant:"danger",confirmText:"删除",onConfirm:()=>{m(null),b(N)}})},[t,b,y]),_=P.useCallback((N,D)=>{i(F=>F.map(L=>L.id===N?{...L,text:D,lastEditedAt:new Date}:L)),s(!0)},[i,s]),S=P.useCallback((N,D)=>{i(F=>F.map(L=>L.id===N?{...L,note:D,lastEditedAt:new Date}:L)),s(!0)},[i,s]),M=P.useCallback((N,D)=>{i(F=>F.map(L=>L.id===N?{...L,type:D,lastEditedAt:new Date}:L)),s(!0)},[i,s]),E=P.useCallback(N=>{if(r)return;const D=typeof window<"u"&&window.innerWidth<768;a(N),h(!0),D&&Wn("light")},[r,a]),C=P.useCallback(N=>{l(N)},[]),R=P.useCallback(()=>{l(null)},[]),k=P.useCallback(N=>{c(N)},[]),I=P.useCallback(N=>{if(!u||u===N){c(null);return}const D=(j,q)=>{const Z=t.find(Q=>Q.id===j);return!Z||!Z.parent?!1:Z.parent===q?!0:D(Z.parent,q)};if(D(N,u)){m({show:!0,title:"无法重连",message:"目标节点是当前节点的子孙节点，这会形成循环！",type:"alert",variant:"warning",onConfirm:()=>m(null)}),c(null);return}const F=t.find(j=>j.id===N);if(!F){c(null);return}const L=t.find(j=>j.id===u);if(!L)return;const U=F.level+1-L.level;i(j=>{const q=[...j],Z=(Q,z)=>{const W=q.findIndex(X=>X.id===Q);W!==-1&&(q[W]={...q[W],level:q[W].level+z,parent:Q===u?N:q[W].parent,lastEditedAt:new Date},q.filter(X=>X.parent===Q).forEach(X=>{Z(X.id,z)}))};return Z(u,U),q}),c(null),s(!0)},[u,t,i,s]);return{editingNodeId:o,reconnectingNodeId:u,isRightPanelOpen:d,confirmDialog:f,setEditingNodeId:l,setReconnectingNodeId:c,setIsRightPanelOpen:h,setConfirmDialog:m,handleDeconstructNode:x,handleDeleteNode:w,handleNodeTextChange:_,handleNodeNoteChange:S,handleNodeTypeChange:M,handleNodeSelect:E,handleEnterEditMode:C,handleExitEditMode:R,handleStartReconnect:k,handleReconnectToNode:I}}function Olt({nodes:t,activeUniverseId:e,viewMode:n,selectedNodeId:r,transform:i,isNavigationMode:a,draggedNodeId:s,setNodes:o,setTransform:l,setSelectedNodeId:u,setDraggedNodeId:c,setHasUnsavedChanges:d}){const h=P.useRef(null),[f,m]=P.useState(!1),[x,b]=P.useState({x:0,y:0}),y=P.useCallback((R,k,I)=>{const N=typeof window<"u"?window.innerWidth:1200,D=typeof window<"u"?window.innerHeight:800;let F=null,L=null;if(k){const U=R.find(j=>j.id===k);U&&(F=U.px,L=U.py)}if(F===null||L===null){const U=R.filter(j=>j.universeId===e);U.length>0?(F=U.reduce((j,q)=>j+q.px,0)/U.length,L=U.reduce((j,q)=>j+q.py,0)/U.length):(F=0,L=0)}return{x:N/2-F*I,y:D/2-L*I,scale:I}},[e]),w=P.useCallback(R=>{const I=R||r||null;let N=[];o(D=>{const F=rce(D,e,n);return N=F,F}),N.length>0&&l(y(N,I,.75)),d(!0)},[e,y,r,n,o,l,d]),_=P.useCallback(R=>{R.preventDefault();const k=R.deltaY>0?.95:1.05;l(I=>({...I,scale:Math.min(Math.max(I.scale*k,Oh.MIN_SCALE),Oh.MAX_SCALE)}))},[l]);P.useEffect(()=>{const R=h.current;if(R)return R.addEventListener("wheel",_,{passive:!1}),()=>{R.removeEventListener("wheel",_)}},[_]),P.useEffect(()=>{const R=h.current;if(!R)return;let k=null,I=null;const N=F=>{if(F.touches.length===2){F.preventDefault();const L=F.touches[0],U=F.touches[1],j=Math.hypot(U.clientX-L.clientX,U.clientY-L.clientY),q=(L.clientX+U.clientX)/2,Z=(L.clientY+U.clientY)/2;if(k!==null&&I!==null){const z=1+(j-k)*.005;l(H=>{const J=Math.min(Math.max(H.scale*z,Oh.MIN_SCALE),Oh.MAX_SCALE);return{...H,scale:J}});const W=q-I.x,X=Z-I.y;(Math.abs(W)>1||Math.abs(X)>1)&&l(H=>({...H,x:H.x+W,y:H.y+X}))}k=j,I={x:q,y:Z}}else if(F.touches.length===1){const L=F.touches[0];if(s&&h.current){const U=h.current.getBoundingClientRect(),j=(L.clientX-U.left-i.x)/i.scale,q=(L.clientY-U.top-i.y)/i.scale;o(Z=>Z.map(Q=>Q.id===s?{...Q,px:j,py:q,lastEditedAt:new Date}:Q)),d(!0)}else if(a){if(I!==null){const U=L.clientX-I.x,j=L.clientY-I.y;l(q=>({...q,x:q.x+U,y:q.y+j}))}I={x:L.clientX,y:L.clientY}}}},D=()=>{k=null,I=null,s&&(c(null),Wn("light"))};return R.addEventListener("touchmove",N,{passive:!1}),R.addEventListener("touchend",D),R.addEventListener("touchcancel",D),()=>{R.removeEventListener("touchmove",N),R.removeEventListener("touchend",D),R.removeEventListener("touchcancel",D)}},[a,s,i,l,o,c,d]),P.useEffect(()=>{if(!s)return;const R=I=>{if(!h.current)return;const N=h.current.getBoundingClientRect(),D=(I.clientX-N.left-i.x)/i.scale,F=(I.clientY-N.top-i.y)/i.scale;o(L=>L.map(U=>U.id===s?{...U,px:D,py:F,lastEditedAt:new Date}:U)),d(!0)},k=()=>{c(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",k)}},[s,i,o,c,d]);const S=P.useCallback(R=>{if(R.button===1||R.button===2||a)m(!0),b({x:R.clientX-i.x,y:R.clientY-i.y}),R.preventDefault();else if(R.button===0){const k=R.target;(k===R.currentTarget||k.classList.contains("arena-v2-grid-pattern"))&&r&&u(null)}},[i,a,r,u]),M=P.useCallback(R=>{if(f)l(k=>({...k,x:R.clientX-x.x,y:R.clientY-x.y}));else if(s&&h.current){const k=h.current.getBoundingClientRect(),I=(R.clientX-k.left-i.x)/i.scale,N=(R.clientY-k.top-i.y)/i.scale;o(D=>D.map(F=>F.id===s?{...F,px:I,py:N,lastEditedAt:new Date}:F)),d(!0)}},[f,s,x,i,l,o,d]),E=P.useCallback(()=>{m(!1),c(null)},[c]),C=P.useCallback(R=>{if(R.target===R.currentTarget||R.target.classList.contains("arena-v2-grid-pattern")){if(!h.current)return;const k=h.current.getBoundingClientRect(),I=(R.clientX-k.left-i.x)/i.scale,N=(R.clientY-k.top-i.y)/i.scale,D=`node-${Date.now()}`,F={id:D,text:"新节点...",type:"fact",px:I,py:N,level:0,parent:null,universeId:e,expanded:!1,createdAt:new Date};o(L=>[...L,F]),u(D),d(!0)}},[i,e,o,u,d]);return{canvasRef:h,isDraggingCanvas:f,dragStart:x,handleMouseDown:S,handleMouseMove:M,handleMouseUp:E,handleCanvasDoubleClick:C,handleAutoLayout:w,computeLayoutTransform:y}}function Llt(t="tree"){const[e,n]=P.useState(()=>typeof window<"u"?window.innerWidth>=1024:!0),[r,i]=P.useState(()=>typeof window<"u"?window.innerWidth>=768:!0),[a,s]=P.useState(!1),[o,l]=P.useState(!1),[u,c]=P.useState(!1),[d,h]=P.useState(!1),[f,m]=P.useState(!1),[x,b]=P.useState(!1),[y,w]=P.useState(!1),[_,S]=P.useState(t),[M,E]=P.useState(!1),[C,R]=P.useState(null),k=P.useCallback(()=>n(U=>!U),[]),I=P.useCallback(()=>i(U=>!U),[]),N=P.useCallback(()=>s(U=>!U),[]),D=P.useCallback(()=>l(U=>!U),[]),F=P.useCallback(()=>E(U=>!U),[]),L=P.useCallback(()=>b(U=>!U),[]);return{isLeftPanelOpen:e,isRightPanelOpen:r,isMiniMapOpen:a,isNavigationMode:o,isSpacePressed:u,showViewModeSheet:d,showTypeSwitcher:f,showDiceSidebar:x,showHelpOverlay:y,viewMode:_,isFocusMode:M,draggedNodeId:C,setIsLeftPanelOpen:n,setIsRightPanelOpen:i,setIsMiniMapOpen:s,setIsNavigationMode:l,setIsSpacePressed:c,setShowViewModeSheet:h,setShowTypeSwitcher:m,setShowDiceSidebar:b,setShowHelpOverlay:w,setViewMode:S,setIsFocusMode:E,setDraggedNodeId:R,toggleLeftPanel:k,toggleRightPanel:I,toggleMiniMap:N,toggleNavigationMode:D,toggleFocusMode:F,toggleDiceSidebar:L}}const Flt={1:"fact",2:"assumption",3:"risk",4:"goal",5:"question"};function Blt({nodes:t,selectedNodeId:e,editingNodeId:n,reconnectingNodeId:r,activeUniverseId:i,isFocusMode:a,setNodes:s,setSelectedNodeId:o,setHasUnsavedChanges:l,setReconnectingNodeId:u,setIsFocusMode:c,handleUndo:d,handleRedo:h,handleDeleteNode:f,handleAutoLayout:m,handleCreateSnapshot:x,handleEnterEditMode:b,handleDeconstructNode:y,handleStartReconnect:w}){const[_,S]=P.useState(!1),[M,E]=P.useState(a);P.useEffect(()=>{c(M)},[M,c]);const C=P.useCallback(R=>{const k=R.target;if((k.tagName==="TEXTAREA"||k.tagName==="INPUT"||k.isContentEditable)&&R.key!=="Escape")return;if((R.ctrlKey||R.metaKey)&&!R.altKey){const D=R.key.toLowerCase();if(D==="z"&&R.shiftKey){R.preventDefault(),h();return}if(D==="z"&&!R.shiftKey){R.preventDefault(),d();return}if(D==="y"){R.preventDefault(),h();return}}if(e&&!n&&!r){const D=Flt[R.key];if(D){R.preventDefault(),y(e,D);return}}if(R.key==="Enter"&&e&&!n&&!r){R.preventDefault(),b(e);return}if(R.key===" "&&e&&!n&&!r){R.preventDefault(),S(!0);return}if(R.key==="Tab"&&(R.preventDefault(),e)){const D=t.find(F=>F.id===e);if(D){const F=`node-${Date.now()}`,L={id:F,text:"子节点...",type:D.type,px:D.px+250,py:D.py,level:D.level+1,parent:e,universeId:i,expanded:!1,createdAt:new Date};s(U=>[...U,L]),o(F),l(!0)}}R.key==="Delete"&&e&&f(e),R.key==="Escape"&&(r?u(null):M?E(!1):e&&o(null)),(R.key==="f"||R.key==="F")&&R.shiftKey&&!R.ctrlKey&&!R.metaKey&&(R.preventDefault(),E(!M)),(R.key==="l"||R.key==="L")&&R.shiftKey&&!R.ctrlKey&&!R.metaKey&&(R.preventDefault(),m()),(R.key==="s"||R.key==="S")&&R.shiftKey&&!R.ctrlKey&&!R.metaKey&&(R.preventDefault(),x())},[e,n,t,i,r,M,f,m,x,d,h,s,o,l,u,b,y,w]);return P.useEffect(()=>(window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)),[C]),{showTypeSwitcher:_,setShowTypeSwitcher:S,isFocusMode:M,setIsFocusMode:E}}function Ult({nodes:t,snapshots:e,activeUniverseId:n,setNodes:r,setSnapshots:i,setHasUnsavedChanges:a,onCenterView:s,setConfirmDialog:o}){const l=P.useCallback(()=>{const f={name:`快照 ${e.length+1} (${new Date().toLocaleTimeString()})`,nodes:JSON.parse(JSON.stringify(t)),timestamp:new Date};i(x=>[...x,f]),a(!0),Wn("success");const m=document.createElement("div");m.textContent="📸 快照已保存",m.className="fixed top-20 left-1/2 -translate-x-1/2 z-[300] px-4 py-2 rounded-lg text-sm shadow-lg backdrop-blur-md",m.style.background="rgba(26, 29, 46, 0.95)",m.style.color="rgb(228, 228, 231)",m.style.border="1px solid rgba(255, 255, 255, 0.1)",document.body.appendChild(m),setTimeout(()=>m.remove(),2e3)},[t,e.length,i,a]),u=P.useCallback(h=>{const f=h.nodes.map(m=>({...m,universeId:n}));r(m=>[...m.filter(x=>x.universeId!==n),...f]),a(!0),s?.(f)},[n,r,a]),c=P.useCallback((h,f)=>{!f||!f.trim()||(i(m=>{const x=[...m];return x[h]={...x[h],name:f.trim()},x}),a(!0))},[i,a]),d=P.useCallback(h=>{o({show:!0,title:"删除快照",message:`确定删除快照"${e[h].name}"吗？`,variant:"danger",confirmText:"删除",onConfirm:()=>{o(null),i(f=>f.filter((m,x)=>x!==h)),a(!0)}})},[e,i,a,o]);return{handleCreateSnapshot:l,handleRestoreSnapshot:u,handleRenameSnapshot:c,handleDeleteSnapshot:d}}function zlt({nodes:t,currentNodes:e,universes:n,activeUniverseId:r,setNodes:i,setUniverses:a,setActiveUniverseId:s,setHasUnsavedChanges:o,setConfirmDialog:l}){const u=P.useCallback(()=>{const h=`u${Date.now()}`,f={id:h,name:`推演-${n.length}`,active:!1,createdAt:new Date},m=e.map(x=>({...x,id:`${x.id}_${h}`,universeId:h,parent:x.parent?`${x.parent}_${h}`:null}));a(x=>[...x,f]),i(x=>[...x,...m]),s(h),o(!0),Wn("medium")},[n.length,e,a,i,s,o]),c=P.useCallback(h=>{h!=="u1"&&l({show:!0,title:"删除推演",message:"确定删除这个推演线吗？其中的所有节点将被删除。",variant:"danger",confirmText:"删除",onConfirm:()=>{a(f=>f.filter(m=>m.id!==h)),i(f=>f.filter(m=>m.universeId!==h)),r===h&&s("u1"),o(!0),l(null)}})},[r,a,i,s,o,l]),d=P.useCallback(h=>{if(r==="u1")return;const f=xP(h,t),m=`_merge_${Date.now()}`,x=f.map(b=>({...b,id:`${b.id}${m}`,universeId:"u1",parent:b.parent?`${b.parent}${m}`:null,text:`[推演成果] ${b.text}`,lastEditedAt:new Date}));i(b=>[...b,...x]),s("u1"),o(!0)},[t,r,i,s,o]);return{handleCreateUniverse:u,handleDeleteUniverse:c,handleMergeSubtree:d}}const hX={temperature:.7,maxTokens:4096},Wh={lmstudio:{id:"lmstudio",name:"LM Studio",isLocal:!0,requiresApiKey:!1,defaultBaseUrl:"http://localhost:1234/v1",suggestedModels:["local-model","qwen2.5-coder-7b-instruct","qwen2.5-14b-instruct","deepseek-coder-v2","llama-3.1-8b-instruct"],description:"本地运行的 LLM 推理服务"},ollama:{id:"ollama",name:"Ollama",isLocal:!0,requiresApiKey:!1,defaultBaseUrl:"http://localhost:11434/api",suggestedModels:["llama3","llama3.1","qwen2.5","deepseek-coder-v2","codellama","mistral"],description:"轻量级本地 LLM 运行时"},openai:{id:"openai",name:"OpenAI",isLocal:!1,requiresApiKey:!0,suggestedModels:["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-3.5-turbo","o1-preview","o1-mini"],description:"OpenAI GPT 系列模型"},anthropic:{id:"anthropic",name:"Anthropic",isLocal:!1,requiresApiKey:!0,suggestedModels:["claude-3-5-sonnet-20241022","claude-3-opus-20240229","claude-3-haiku-20240307"],description:"Anthropic Claude 系列模型"},google:{id:"google",name:"Google AI",isLocal:!1,requiresApiKey:!0,suggestedModels:["gemini-pro","gemini-1.5-pro","gemini-1.5-flash"],description:"Google Gemini 系列模型"},azure:{id:"azure",name:"Azure OpenAI",isLocal:!1,requiresApiKey:!0,suggestedModels:["gpt-4","gpt-4-turbo","gpt-35-turbo"],description:"Azure 托管的 OpenAI 模型"},bedrock:{id:"bedrock",name:"AWS Bedrock",isLocal:!1,requiresApiKey:!0,suggestedModels:["anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-opus-20240229-v1:0","amazon.titan-text-express-v1"],description:"AWS 托管的多种基础模型"},openrouter:{id:"openrouter",name:"OpenRouter",isLocal:!1,requiresApiKey:!0,suggestedModels:["anthropic/claude-3-5-sonnet","openai/gpt-4o","google/gemini-pro","meta-llama/llama-3-70b-instruct"],description:"多模型统一 API 代理"}};function jlt(){return Object.values(Wh).filter(t=>t.isLocal)}function Hlt(){return Object.values(Wh).filter(t=>!t.isLocal)}function $lt(t){return!(!t||!t.provider||!t.model||!t.credentials)}class Vlt{config=null;setConfig(e){this.config=e,console.log("[AI Config] Configuration updated:",e?{provider:e.provider,model:e.model}:"null")}getConfig(){return this.config}isConfigured(){return $lt(this.config)}clearConfig(){this.config=null,console.log("[AI Config] Configuration cleared")}}const bP=new Vlt,qlt="thineasy-ai-config";function Glt(){return typeof window<"u"&&typeof localStorage<"u"}function Wlt(){if(!Glt())return{};try{const t=localStorage.getItem(qlt);if(t)return JSON.parse(t)}catch(t){console.warn("[AI Runtime Config] Failed to load config:",t)}return{}}const Ylt={PUBLIC_ANTHROPIC_API_KEY:"",PUBLIC_AWS_ACCESS_KEY_ID:"",PUBLIC_AWS_REGION:"",PUBLIC_AWS_SECRET_ACCESS_KEY:"",PUBLIC_AZURE_API_KEY:"",PUBLIC_AZURE_RESOURCE_NAME:"",PUBLIC_GOOGLE_API_KEY:"",PUBLIC_OLLAMA_API_KEY:"",PUBLIC_OPENAI_API_KEY:"",PUBLIC_OPENROUTER_API_KEY:""};function ice(){return typeof window<"u"}function Xlt(){const t=Ylt;return{provider:"lmstudio",model:"local-model",temperature:parseFloat("0.7"),maxTokens:parseInt("4096",10),lmstudioBaseUrl:"http://localhost:1234/v1",lmstudioApiKey:"lm-studio",ollamaBaseUrl:"http://localhost:11434/api",ollamaApiKey:t.PUBLIC_OLLAMA_API_KEY,openaiApiKey:t.PUBLIC_OPENAI_API_KEY,anthropicApiKey:t.PUBLIC_ANTHROPIC_API_KEY,googleApiKey:t.PUBLIC_GOOGLE_API_KEY,azureResourceName:t.PUBLIC_AZURE_RESOURCE_NAME,azureApiKey:t.PUBLIC_AZURE_API_KEY,awsRegion:t.PUBLIC_AWS_REGION,awsAccessKeyId:t.PUBLIC_AWS_ACCESS_KEY_ID,awsSecretAccessKey:t.PUBLIC_AWS_SECRET_ACCESS_KEY,openrouterApiKey:t.PUBLIC_OPENROUTER_API_KEY}}function Klt(t,e){return{provider:e.provider||t.provider,model:e.model||t.model,temperature:e.temperature??t.temperature,maxTokens:e.maxTokens??t.maxTokens,lmstudioBaseUrl:e.lmstudioBaseUrl||t.lmstudioBaseUrl,lmstudioApiKey:e.lmstudioApiKey||t.lmstudioApiKey,ollamaBaseUrl:e.ollamaBaseUrl||t.ollamaBaseUrl,ollamaApiKey:e.ollamaApiKey||t.ollamaApiKey,openaiApiKey:e.openaiApiKey||t.openaiApiKey,anthropicApiKey:e.anthropicApiKey||t.anthropicApiKey,googleApiKey:e.googleApiKey||t.googleApiKey,azureResourceName:e.azureResourceName||t.azureResourceName,azureApiKey:e.azureApiKey||t.azureApiKey,awsRegion:e.awsRegion||t.awsRegion,awsAccessKeyId:e.awsAccessKeyId||t.awsAccessKeyId,awsSecretAccessKey:e.awsSecretAccessKey||t.awsSecretAccessKey,openrouterApiKey:e.openrouterApiKey||t.openrouterApiKey}}function RN(){const t=Xlt();if(ice()){const e=Wlt();return Klt(t,e)}return t}let N6=null;function ace(){return ice()?RN():(N6||(N6=RN()),N6)}RN();const sce="thineasy_ai_preferences";function oce(){const t=ace();return{provider:t.provider,model:t.model,lmstudioBaseUrl:t.lmstudioBaseUrl,ollamaBaseUrl:t.ollamaBaseUrl,temperature:t.temperature,maxTokens:t.maxTokens,updatedAt:Date.now()}}function lce(){return typeof window<"u"&&typeof localStorage<"u"}function R6(t){if(!lce()){console.warn("[AI Config Storage] Not in browser environment, skipping save");return}try{const n={..._P()||oce(),...t,updatedAt:Date.now()};localStorage.setItem(sce,JSON.stringify(n)),console.log("[AI Config Storage] Preferences saved:",{provider:n.provider,model:n.model})}catch(e){console.error("[AI Config Storage] Failed to save preferences:",e)}}function _P(){if(!lce())return null;try{const t=localStorage.getItem(sce);if(!t)return null;const e=JSON.parse(t);return!e.provider||!e.model?(console.warn("[AI Config Storage] Invalid stored preferences, missing required fields"),null):e}catch(t){return console.error("[AI Config Storage] Failed to load preferences:",t),null}}function uce(){return _P()||oce()}function wP(t){const e=bP.getConfig(),n=uce(),r=t?.provider||n.provider,i=t?.model||n.model,a=ace(),s={...e?.credentials||{},lmstudioBaseUrl:t?.lmstudioBaseUrl||n.lmstudioBaseUrl||a.lmstudioBaseUrl,lmstudioApiKey:e?.credentials?.lmstudioApiKey||a.lmstudioApiKey,ollamaBaseUrl:t?.ollamaBaseUrl||n.ollamaBaseUrl||a.ollamaBaseUrl,ollamaApiKey:e?.credentials?.ollamaApiKey||a.ollamaApiKey,openaiApiKey:e?.credentials?.openaiApiKey||a.openaiApiKey,anthropicApiKey:e?.credentials?.anthropicApiKey||a.anthropicApiKey,googleApiKey:e?.credentials?.googleApiKey||a.googleApiKey,azureApiKey:e?.credentials?.azureApiKey||a.azureApiKey,azureResourceName:e?.credentials?.azureResourceName||a.azureResourceName,awsAccessKeyId:e?.credentials?.awsAccessKeyId||a.awsAccessKeyId,awsSecretAccessKey:e?.credentials?.awsSecretAccessKey||a.awsSecretAccessKey,awsRegion:e?.credentials?.awsRegion||a.awsRegion,openrouterApiKey:e?.credentials?.openrouterApiKey||a.openrouterApiKey};return{provider:r,model:i,credentials:s,temperature:t?.temperature||n.temperature||hX.temperature,maxTokens:t?.maxTokens||n.maxTokens||hX.maxTokens}}function fX(){return wP()}function PN(t){if(typeof window>"u")return{isMixed:!1};const n=window.location.protocol==="https:",r=t.startsWith("http://");return n&&r?{isMixed:!0,message:`当前页面使用 HTTPS，无法访问 HTTP 服务 (${t})。请使用云端 AI 服务（如 OpenRouter），或为本地服务配置 HTTPS。`}:{isMixed:!1}}async function Zlt(){const t=fX(),e=Date.now();try{const n=Wh[t.provider];if(n.isLocal){const r=t.provider==="lmstudio"?t.credentials.lmstudioBaseUrl:t.credentials.ollamaBaseUrl;if(!r)return{available:!1,provider:t.provider,model:t.model,error:"Base URL not configured"};const i=PN(r);if(i.isMixed)return{available:!1,provider:t.provider,model:t.model,error:i.message};const a=t.provider==="lmstudio"?`${r}/models`:`${r.replace("/api","")}/api/tags`,s=new AbortController,o=setTimeout(()=>s.abort(),5e3);try{const l=await fetch(a,{method:"GET",signal:s.signal});return clearTimeout(o),l.ok?{available:!0,provider:t.provider,model:t.model,latency:Date.now()-e}:{available:!1,provider:t.provider,model:t.model,error:`HTTP ${l.status}`}}catch(l){throw clearTimeout(o),l}}else{if(n.requiresApiKey){const r=cce(t);return{available:r,provider:t.provider,model:t.model,latency:Date.now()-e,error:r?void 0:"API Key not configured"}}return{available:!0,provider:t.provider,model:t.model,latency:Date.now()-e}}}catch(n){const r=n instanceof Error?n.message:"Connection failed";if(r.includes("Failed to fetch")){const i=fX(),a=i.provider==="lmstudio"?i.credentials.lmstudioBaseUrl:i.credentials.ollamaBaseUrl;if(a){const s=PN(a);if(s.isMixed)return{available:!1,provider:t.provider,model:t.model,error:s.message}}}return{available:!1,provider:t.provider,model:t.model,error:r}}}function cce(t){const{provider:e,credentials:n}=t;switch(e){case"openai":return!!n.openaiApiKey;case"anthropic":return!!n.anthropicApiKey;case"google":return!!n.googleApiKey;case"azure":return!!n.azureApiKey;case"bedrock":return!!(n.awsAccessKeyId&&n.awsSecretAccessKey);case"openrouter":return!!n.openrouterApiKey;case"lmstudio":case"ollama":return!0;default:return!1}}async function Jlt(t,e,n,r,i,a,s,o=3e4){const l=new AbortController,u=setTimeout(()=>{l.abort()},o);try{const c=[];i&&c.push({role:"system",content:i}),c.push({role:"user",content:r});const d=await fetch(`${t}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:n,messages:c,max_tokens:a,temperature:s??.7,stream:!1}),signal:l.signal});if(clearTimeout(u),!d.ok){const x=await d.text();throw new Error(`API request failed: ${d.status} ${x}`)}const h=await d.json(),f=h.choices?.[0]?.message?.content||h.choices?.[0]?.text||"",m=h.usage?{promptTokens:h.usage.prompt_tokens||0,completionTokens:h.usage.completion_tokens||0,totalTokens:h.usage.total_tokens||0}:void 0;return{content:f,usage:m}}catch(c){clearTimeout(u);const d=c;if((typeof d?.name=="string"?d.name:"")==="AbortError")return null;throw c}}async function SP(t,e={}){const{maxTokens:n,temperature:r,timeout:i,systemPrompt:a,gracefulFail:s=!1}=e,o=Date.now(),l=wP({maxTokens:n,temperature:r});try{if(l.provider==="lmstudio"||l.provider==="ollama"){const m=Math.max(i??12e4,12e4),x=l.provider==="lmstudio"?l.credentials.lmstudioBaseUrl||"http://localhost:1234/v1":l.credentials.ollamaBaseUrl||"http://localhost:11434/v1",b=PN(x);if(b.isMixed)throw new Error(b.message);const y=l.provider==="lmstudio"?l.credentials.lmstudioApiKey||"lm-studio":"ollama";console.log(`[AI Service] Using direct fetch for ${l.provider}: ${x}`);const w=await Jlt(x,y,l.model,t,a,l.maxTokens,l.temperature,m);return w?{content:w.content,source:"llm",provider:l.provider,model:l.model,duration:Date.now()-o,usage:w.usage}:null}const{model:u}=Ine(l),c=new AbortController,d=setTimeout(()=>c.abort(),i??3e4);try{const h=await HCe({model:u,prompt:t,system:a,maxOutputTokens:l.maxTokens,temperature:l.temperature,abortSignal:c.signal});clearTimeout(d);const f=h.usage;return{content:h.text,source:"llm",provider:l.provider,model:l.model,duration:Date.now()-o,usage:f?{promptTokens:f.promptTokens||0,completionTokens:f.completionTokens||0,totalTokens:f.totalTokens||0}:void 0}}catch(h){throw clearTimeout(d),h}}catch(u){const c=u;if((typeof c?.name=="string"?c.name:"")==="AbortError")return console.warn("[AI Service] Query aborted (AbortError)"),null;const h=u instanceof Error?u.message:"Unknown error";if(console.error("[AI Service] Query failed:",h),s)return null;throw new Error(`AI query failed: ${h}`)}}function EP(){const t=_P();if(!t)return!1;const e=Wh[t.provider];return e?e.isLocal?t.provider==="lmstudio"?!!t.lmstudioBaseUrl:t.provider==="ollama"?!!t.ollamaBaseUrl:!0:bP.getConfig()?cce(wP()):!1:!1}function Qlt(t,e){const n=[];if(t.toLowerCase(),/要不要|是否|选择|决策|决定|比较|权衡/i.test(t)&&n.push({paradigm:Xo.find(r=>r.name==="SWOT 分析"),matchScore:.85,reasoning:"问题涉及决策或选择，SWOT 分析可以帮助全面评估优劣势和机会威胁",source:"rule"}),/为什么|原因|怎么回事|出了什么问题|如何解释/i.test(t)&&n.push({paradigm:Xo.find(r=>r.name==="SCQA 框架"),matchScore:.8,reasoning:"问题涉及原因分析，SCQA 框架可以结构化地呈现问题背景和解决方案",source:"rule"}),/怎么做|如何|方法|步骤|计划|规划|实施/i.test(t)&&n.push({paradigm:Xo.find(r=>r.name==="5W2H 拆解"),matchScore:.75,reasoning:"问题涉及执行规划，5W2H 可以全面拆解任务的各个维度",source:"rule"}),n.length===0){const r=dce(e);r.risk>r.fact?n.push({paradigm:Xo.find(i=>i.name==="SWOT 分析"),matchScore:.6,reasoning:"当前节点中风险类占比较高，SWOT 分析可以帮助系统化地应对风险",source:"rule"}):n.push({paradigm:Xo.find(i=>i.name==="SCQA 框架"),matchScore:.5,reasoning:"默认推荐：SCQA 框架适合结构化思考，帮助理清问题脉络",source:"rule"})}return n.filter(r=>r.paradigm)}function dce(t){const e={fact:0,assumption:0,risk:0,goal:0,question:0};for(const n of t)e[n.type]!==void 0&&e[n.type]++;return e}function eut(t,e){const n=[],r=dce(t),i=t.length;if(!t.some(u=>/长期|短期|未来|过去|历史|趋势|发展/i.test(u.text))&&i>2&&n.push({category:"时间维度",description:"缺少时间维度的考量，可能忽略了长期影响或历史经验",questions:["长期来看会有什么变化？","短期和长期的利弊如何权衡？","历史上有类似的情况吗？"],importance:"medium",source:"rule"}),!t.some(u=>/他人|用户|客户|团队|对方|受众|利益方/i.test(u.text))&&i>2&&n.push({category:"利益相关方",description:"仅从自身角度思考，可能忽略其他利益相关方的视角",questions:["这对其他人有什么影响？","不同角色会如何看待这个问题？","谁会受益？谁会受损？"],importance:"high",source:"rule"}),!t.some(u=>/但是|然而|不过|反对|质疑|风险|挑战|缺点|弊端/i.test(u.text))&&i>3&&n.push({category:"反面论证",description:"缺少反对意见或风险考量，可能过于乐观",questions:["有什么理由反对这个观点？","最大的风险是什么？","可能的反驳是什么？"],importance:"high",source:"rule"}),r.assumption>0&&(t.filter(d=>d.type==="assumption").some(d=>t.some(h=>h.type==="fact"&&h.parent===d.id))||n.push({category:"假设验证",description:`存在 ${r.assumption} 个假设节点，但缺少对应的事实验证`,questions:["这些假设如何验证？","有什么证据支持这些假设？","如果假设不成立，结论会如何变化？"],importance:"high",source:"rule"})),/要不要|是否|选择|决定/i.test(e)&&(t.some(c=>/退出|备选|Plan B|后备|失败|撤退/i.test(c.text))||n.push({category:"退出策略",description:"决策类问题缺少 Plan B 或退出策略",questions:["如果失败了怎么办？","有没有备选方案？","退出的成本是什么？"],importance:"medium",source:"rule"})),i>4&&Object.entries(r).sort((d,h)=>h[1]-d[1])[0][1]/i>.6){const d=Object.entries(r).filter(([h,f])=>f===0).map(([h])=>Mi[h]?.label||h);d.length>0&&n.push({category:"思维平衡",description:`节点类型分布不均衡，缺少：${d.join("、")}`,questions:[`是否需要添加${d[0]}类型的思考？`,"从其他角度思考会有什么发现？"],importance:"low",source:"rule"})}return n}function tut(t){const e=[],n=new Map;for(const s of t)if(s.parent){const o=n.get(s.parent)||[];o.push(s),n.set(s.parent,o)}for(const[s,o]of n){const l=o.filter(c=>c.type==="fact"),u=o.filter(c=>c.type==="risk");if(l.length>0&&u.length>0)for(const c of l)for(const d of u)pX(c.text,d.text)&&e.push({type:"logical",severity:"medium",nodeIds:[c.id,d.id],description:`事实"${fg(c.text)}"与风险"${fg(d.text)}"存在张力`,suggestion:"考虑是否需要进一步论证或添加条件限定",source:"rule"})}const r=t.filter(s=>s.type==="goal"),i=t.filter(s=>s.type==="risk");for(const s of r)for(const o of i)pX(s.text,o.text)&&e.push({type:"logical",severity:"high",nodeIds:[s.id,o.id],description:`目标"${fg(s.text)}"可能被风险"${fg(o.text)}"阻碍`,suggestion:"需要制定风险应对策略或调整目标",source:"rule"});const a=t.filter(s=>s.type==="assumption");for(const s of a)!t.filter(u=>u.parent===s.id).some(u=>u.type==="fact")&&a.length>0&&e.push({type:"evidence",severity:"medium",nodeIds:[s.id],description:`假设"${fg(s.text)}"缺乏事实支撑`,suggestion:"添加支持此假设的事实或证据",source:"rule"});return e}function pX(t,e){const n=["能够","可以","有利","增加","提升","成功","优势"],r=["不能","无法","不利","减少","降低","失败","劣势"],i=n.some(l=>t.includes(l)),a=r.some(l=>t.includes(l)),s=n.some(l=>e.includes(l)),o=r.some(l=>e.includes(l));return i&&o||a&&s}function fg(t,e=20){return t.length>e?t.slice(0,e)+"...":t}const nut=`你是一个思维方法专家。根据用户的问题和已有的思考节点，推荐最适合的思维范式。

**用户问题：**
{{question}}

**已有节点：**
{{nodes}}

**可选范式：**
{{paradigms}}

**任务：**
分析问题和已有节点，推荐1-2个最适合的范式，并说明理由。

**输出格式（JSON）：**
\`\`\`json
{
  "recommendations": [
    {
      "paradigmName": "范式名称",
      "matchScore": 0.85,
      "reasoning": "推荐理由"
    }
  ]
}
\`\`\``,rut=`你是一个批判性思维专家。请分析用户的思考，找出可能遗漏的视角和盲点。

**问题：**
{{question}}

**节点列表：**
{{nodes}}

**任务：**
识别思考中可能存在的盲点，并提供引导性问题帮助用户完善思考。

**重要说明：**
1. 在 description 中引用节点时，必须使用节点列表中提供的完整 ID（如 node-1736843010203）
2. 不要编造节点 ID，只引用上方列表中真实存在的 ID
3. questions 中也可以引用节点 ID

**输出格式（JSON）：**
\`\`\`json
{
  "blindSpots": [
    {
      "category": "盲点类别",
      "description": "盲点描述（引用节点时使用列表中的真实 ID）",
      "questions": ["引导问题1", "引导问题2"],
      "importance": "high | medium | low"
    }
  ]
}
\`\`\``,iut=`你是一个逻辑分析专家。请分析以下思维节点，识别其中的逻辑冲突和矛盾。

**节点列表：**
{{nodes}}

**任务：**
识别节点之间的逻辑冲突，并提供解决建议。

**重要说明：**
1. 在 nodeIds 和 description 中引用节点时，必须使用完整的节点 ID 格式：node-xxxxxxxxxxxxxxx
2. description 中如需提及节点，请使用格式：node-1234567890123（使用节点ID）
3. title 是冲突的简短标题（15字以内），不要包含节点ID，要概括冲突核心
4. suggestion_text 是详细的建议说明，可以引用节点ID
5. insertable_node 是可直接作为新节点插入的简洁内容（20字以内的陈述句），不要包含节点ID引用

**输出格式（JSON）：**
\`\`\`json
{
  "conflicts": [
    {
      "type": "logical | semantic | assumption | evidence",
      "severity": "critical | high | medium",
      "nodeIds": ["node-1234567890123", "node-9876543210987"],
      "title": "动机与行为矛盾",
      "description": "node-1234567890123 与 node-9876543210987 存在冲突，前者认为...，后者则...",
      "suggestion_text": "建议对 node-1234567890123 进行修改，或者考虑...",
      "insertable_node": "需要明确真实动机是什么"
    }
  ]
}
\`\`\``;async function aut(t,e,n=!1){const r=Qlt(t,e);if(n||r.length>0&&r[0].matchScore>.7)return{results:r,source:"rule",timestamp:new Date};if(!EP())return{results:r,source:"rule",timestamp:new Date};try{const i=e.map(l=>`- [${l.type}] ${l.text}`).join(`
`),a=Xo.map(l=>`- ${l.name}: ${l.description}`).join(`
`),s=bR(nut,{question:t,nodes:i,paradigms:a}),o=await SP(s,{timeout:15e3,gracefulFail:!0});if(o){const l=_R(o.content);if(l?.recommendations){const u=l.recommendations.map(f=>{const m=Xo.find(x=>x.name===f.paradigmName);return m?{paradigm:m,matchScore:f.matchScore,reasoning:f.reasoning,source:"llm"}:null}).filter(f=>f!==null),c=[...r];for(const f of u)f&&(c.some(x=>x.paradigm.name===f.paradigm.name)||c.push(f));const d=c.some(f=>f.source==="llm"),h=c.some(f=>f.source==="rule");return{results:c.sort((f,m)=>m.matchScore-f.matchScore),rawResponse:o.content,prompt:s,source:d&&h?"mixed":d?"llm":"rule",timestamp:new Date}}}}catch(i){console.error("[Arena AI] LLM paradigm recommendation failed:",i)}return{results:r,source:"rule",timestamp:new Date}}async function sut(t,e,n=!1){const r=eut(t,e);if(n||!EP())return{results:r,source:"rule",timestamp:new Date};try{const i=t.map(o=>`ID: ${o.id}
类型: ${o.type}
内容: ${o.text}`).join(`

`),a=bR(rut,{question:e,nodes:i}),s=await SP(a,{timeout:15e3,gracefulFail:!0});if(s){const o=_R(s.content);if(o?.blindSpots){const l=o.blindSpots.map(h=>({...h,source:"llm"})),u=[...r];for(const h of l)u.some(m=>m.category===h.category)||u.push(h);const c=u.some(h=>h.source==="llm"),d=u.some(h=>h.source==="rule");return{results:u,rawResponse:s.content,prompt:a,source:c&&d?"mixed":c?"llm":"rule",timestamp:new Date}}}}catch(i){console.error("[Arena AI] LLM blind spot scan failed:",i)}return{results:r,source:"rule",timestamp:new Date}}async function out(t,e=!1){const n=tut(t);if(e||!EP()||t.length<3)return{results:n,source:"rule",timestamp:new Date};try{const r=t.map(s=>`ID: ${s.id}
类型: ${s.type}
内容: ${s.text}`).join(`

`),i=bR(iut,{nodes:r}),a=await SP(i,{timeout:2e4,gracefulFail:!0});if(a){const s=_R(a.content);if(s?.conflicts){const o=s.conflicts.map(d=>({type:d.type,severity:d.severity,nodeIds:d.nodeIds,title:d.title,description:d.description,suggestionText:d.suggestion_text||d.suggestion,insertableNode:d.insertable_node,suggestion:d.suggestion||d.suggestion_text,source:"llm"})),l=[...n];for(const d of o)l.some(f=>f.nodeIds.sort().join(",")===d.nodeIds.sort().join(","))||l.push(d);const u=l.some(d=>d.source==="llm"),c=l.some(d=>d.source==="rule");return{results:l,rawResponse:a.content,prompt:i,source:u&&c?"mixed":u?"llm":"rule",timestamp:new Date}}}}catch(r){console.error("[Arena AI] LLM conflict detection failed:",r)}return{results:n,source:"rule",timestamp:new Date}}function lut({arenaMemoryId:t,rootNode:e,currentNodes:n,nodes:r,selectedNode:i,selectedNodeId:a,activeUniverseId:s,viewMode:o,aiState:l,setNodes:u,setTransform:c,setSelectedNodeId:d,setHasUnsavedChanges:h,setIsPressureTesting:f,setConfirmDialog:m,computeLayoutTransform:x}){const b=P.useCallback(async()=>{if(e){l.setIsAILoading(!0),l.setAIResultType("paradigm");try{const N=await aut(e.text,n,!l.aiEnabled);l.setParadigmResults(N.results),l.setAIRawResponse(N.rawResponse),l.setAIPrompt(N.prompt),I6("paradigm",t,{type:"paradigm",source:N.source,rawResponse:N.rawResponse,prompt:N.prompt,paradigmResults:N.results}),l.setAIResultHistory(o_(t)),l.setHasParadigmCache(!0)}catch(N){console.error("Paradigm recommendation failed:",N)}finally{l.setIsAILoading(!1)}}},[e,n,l,t]),y=P.useCallback(async()=>{if(e){l.setIsAILoading(!0),l.setAIResultType("blindspot");try{const N=await sut(n,e.text,!l.aiEnabled);l.setBlindSpotResults(N.results),l.setAIRawResponse(N.rawResponse),l.setAIPrompt(N.prompt),I6("blindspot",t,{type:"blindspot",source:N.source,rawResponse:N.rawResponse,prompt:N.prompt,blindSpotResults:N.results}),l.setAIResultHistory(o_(t)),l.setHasBlindspotCache(!0)}catch(N){console.error("Blind spot scan failed:",N)}finally{l.setIsAILoading(!1)}}},[e,n,l,t]),w=P.useCallback(async()=>{l.setIsAILoading(!0),l.setAIResultType("conflict"),f(!0);try{const N=await out(n,!l.aiEnabled);l.setConflictResults(N.results),l.setAIRawResponse(N.rawResponse),l.setAIPrompt(N.prompt),I6("conflict",t,{type:"conflict",source:N.source,rawResponse:N.rawResponse,prompt:N.prompt,conflictResults:N.results}),l.setAIResultHistory(o_(t)),l.setHasConflictCache(!0)}catch(N){console.error("Conflict detection failed:",N)}finally{l.setIsAILoading(!1)}},[n,l,t,f]),_=P.useCallback(N=>{const D=s_(N,t);D&&(l.setAIResultType(N),l.setAIRawResponse(D.rawResponse),l.setAIPrompt(D.prompt),N==="paradigm"&&D.paradigmResults?l.setParadigmResults(D.paradigmResults):N==="blindspot"&&D.blindSpotResults?l.setBlindSpotResults(D.blindSpotResults):N==="conflict"&&D.conflictResults&&l.setConflictResults(D.conflictResults))},[l,t]),S=P.useCallback((N,D)=>{const F=i||e;if(!F)return;const U=n.filter(q=>q.parent===F.id).length*80,j={id:`node-${Date.now()}`,text:N,type:D,px:F.px+280,py:F.py+U+80,parent:F.id,level:(F.level||0)+1,expanded:!0,universeId:s,createdAt:new Date,lastEditedAt:new Date};u(q=>[...q,j]),h(!0),Wn("light")},[e,i,n,s,u,h]),M=P.useCallback((N,D,F)=>{const L=F||a||e?.id||null,U=L?r.find(z=>z.id===L):null,j=`node_${Date.now()}`,q={id:j,text:N,type:D,px:U?U.px+150:Math.random()*200-100,py:U?U.py+50:Math.random()*200-100,parent:L,level:U?(U.level||0)+1:1,expanded:!0,universeId:s,createdAt:new Date,lastEditedAt:new Date},Z=.75;let Q=[];u(z=>{const W=[...z,q],X=rce(W,s,o);return Q=X,X}),Q.length>0&&c(x(Q,j,Z)),h(!0),Wn("light")},[a,e?.id,r,s,o,x,u,c,h]),E=P.useCallback(N=>{if(!a)return;const D=n.find(L=>L.id===a);if(!D)return;const F=N.items.map((L,U)=>({id:`node-${Date.now()}-${U}`,text:L,type:N.types[U]||"fact",px:D.px+(U%2===0?-200:200),py:D.py+150+Math.floor(U/2)*120,parent:D.id,level:(D.level||0)+1,expanded:!0,universeId:s,createdAt:new Date,lastEditedAt:new Date}));u(L=>[...L,...F]),h(!0),l.setAIResultType(null),m({show:!0,title:"范式已应用",message:`已添加 ${N.name} 的 ${N.items.length} 个节点`,type:"alert",variant:"info",onConfirm:()=>m(null)})},[a,n,s,u,h,l,m]),C=P.useCallback((N,D)=>{if(!e)return;const L=n.filter(j=>j.parent===e.id).length*100,U={id:`node-${Date.now()}`,text:N,type:D,px:e.px+300,py:e.py+L+100,parent:e.id,level:(e.level||0)+1,expanded:!0,universeId:s,createdAt:new Date,lastEditedAt:new Date};u(j=>[...j,U]),h(!0),Wn("medium")},[e,n,s,u,h]),R=P.useCallback(N=>{const D=n.find(F=>F.id===N);D&&(c(F=>({...F,x:-D.px*F.scale+window.innerWidth/2,y:-D.py*F.scale+window.innerHeight/2})),d(N))},[n,c,d]),k=P.useCallback(N=>{N.type==="paradigm"&&N.paradigmResults?l.setParadigmResults(N.paradigmResults):N.type==="blindspot"&&N.blindSpotResults?l.setBlindSpotResults(N.blindSpotResults):N.type==="conflict"&&N.conflictResults&&l.setConflictResults(N.conflictResults),N.rawResponse&&l.setAIRawResponse(N.rawResponse),N.prompt&&l.setAIPrompt(N.prompt)},[l]),I=P.useCallback(()=>{_lt(t),l.setAIResultHistory([])},[t,l]);return{handleParadigmRecommend:b,handleBlindSpotScan:y,handleEnhancedConflictDetection:w,handleLoadCachedResult:_,handleAddNodeFromDice:S,handleImportAsNode:M,handleApplyParadigm:E,handleAddQuestionAsNode:C,handleFocusNode:R,handleLoadHistory:k,handleClearHistory:I}}function uut(t){if(!t||t.trim().length===0)return null;const e=t.trim();if(e.endsWith("?")||e.endsWith("？"))return"question";if(e.endsWith("!")||e.endsWith("！"))return"risk";if(e===e.toUpperCase()&&e.length>0&&e.length<10&&/^[A-Z\s]+$/.test(e))return"goal";const n=["假设","假如","假定","如果","若是","if","assume","suppose"],r=e.toLowerCase();for(const i of n)if(r.includes(i.toLowerCase()))return"assumption";return null}function cut(t){return{fact:"已识别为事实",assumption:"已识别为假设",risk:"已识别为风险",goal:"已识别为目标",question:"已识别为疑问"}[t]||""}const Db=({content:t,children:e,position:n="top",className:r=""})=>{const[i,a]=P.useState(!1),s={top:"bottom-full left-1/2 -translate-x-1/2 mb-2",bottom:"top-full left-1/2 -translate-x-1/2 mt-2",left:"right-full top-1/2 -translate-y-1/2 mr-2",right:"left-full top-1/2 -translate-y-1/2 ml-2"},o={top:"top-full left-1/2 -translate-x-1/2 border-t-[#1a1d2e] border-l-transparent border-r-transparent border-b-transparent",bottom:"bottom-full left-1/2 -translate-x-1/2 border-b-[#1a1d2e] border-l-transparent border-r-transparent border-t-transparent",left:"left-full top-1/2 -translate-y-1/2 border-l-[#1a1d2e] border-t-transparent border-b-transparent border-r-transparent",right:"right-full top-1/2 -translate-y-1/2 border-r-[#1a1d2e] border-t-transparent border-b-transparent border-l-transparent"};return g.jsxs("div",{className:`relative inline-flex ${r}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e,i&&g.jsxs("div",{className:`absolute z-[100] pointer-events-none whitespace-nowrap ${s[n]}`,style:{animationDuration:"0ms"},children:[g.jsx("div",{className:"bg-[#1a1d2e]/98 backdrop-blur-xl border border-white/10 rounded-lg shadow-2xl px-2.5 py-1.5",children:g.jsx("span",{className:"text-xs text-gray-300 font-medium",children:t})}),g.jsx("div",{className:`absolute w-0 h-0 border-[4px] ${o[n]}`,style:{filter:"drop-shadow(0 0 1px rgba(255,255,255,0.1))"}})]})]})},dut=({node:t,isSelected:e,isEditing:n,isReconnecting:r,isReconnectTarget:i,isNavigationMode:a=!1,canvasScale:s,onSelect:o,onTextChange:l,onTypeChange:u,onDelete:c,onDeconstructNode:d,onDragStart:h,onStartReconnect:f,onReconnectTo:m,onEnterEditMode:x,onExitEditMode:b})=>{const y=Mi[t.type]||Mi.fact,w=P.useRef(null),[_,S]=P.useState(!1),[M,E]=P.useState("");P.useEffect(()=>{if(n&&w.current){w.current.focus();const H=w.current.value.length;w.current.setSelectionRange(H,H)}},[n]);const C=H=>{const J=uut(H);J&&J!==t.type&&(u(t.id,J),E(cut(J)),S(!0),setTimeout(()=>{S(!1)},2e3))},[R,k]=P.useState(null),[I,N]=P.useState(!1),D=H=>{if(!n){if(H.stopPropagation(),i){m(t.id);return}k({x:H.clientX,y:H.clientY}),N(!1)}},F=H=>{if(!(n||!R)&&!I){const J=H.clientX-R.x,te=H.clientY-R.y;Math.sqrt(J*J+te*te)>5&&(N(!0),h(t.id))}},L=()=>{!I&&R&&o(t.id),k(null),N(!1)},U=H=>{if(n||H.touches.length!==1)return;if(H.stopPropagation(),i){m(t.id);return}const J=H.touches[0];k({x:J.clientX,y:J.clientY}),N(!1)},j=H=>{if(!(n||H.touches.length!==1||!R)&&(H.stopPropagation(),!I&&a)){const J=H.touches[0],te=J.clientX-R.x,ee=J.clientY-R.y;Math.sqrt(te*te+ee*ee)>5&&(N(!0),h(t.id))}},q=H=>{H.stopPropagation(),H.preventDefault(),!a&&!I&&R&&o(t.id),k(null),N(!1)},Z=H=>{H.stopPropagation(),!n&&!r&&!i&&x(t.id)},Q=1/s,X=Math.min(Math.max(Q,.8),1.5);return g.jsxs("div",{className:`
        absolute -translate-x-1/2 -translate-y-1/2 group transition-all
        ${n?"cursor-text":i?"cursor-pointer z-[60]":"cursor-move"}
        ${e?"z-50":"z-40"}
      `,style:{left:t.px,top:t.py},onMouseDown:D,onMouseMove:F,onMouseUp:L,onMouseLeave:L,onTouchStart:U,onTouchMove:j,onTouchEnd:q,onTouchCancel:q,children:[_&&g.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-zinc-900/90 backdrop-blur-sm text-zinc-100 px-2 py-1 rounded border border-white/5 whitespace-nowrap z-[100]",style:{transform:`translateX(-50%) scale(${X})`,transformOrigin:"center bottom",fontSize:"12px"},children:M}),!i&&!n&&g.jsxs("div",{className:`absolute ${e?"-top-10":"-top-8"} left-1/2 -translate-x-1/2 flex gap-1.5 p-1.5 backdrop-blur-xl rounded-xl border shadow-2xl transition-all duration-200
            ${e?"opacity-100 scale-100":"opacity-0 scale-90 translate-y-1 group-hover:opacity-100 group-hover:scale-100 group-hover:translate-y-0"}
          `,style:{transform:`translate(-50%, 0) scale(${X})`,transformOrigin:"center bottom",background:e?"rgba(38, 38, 43, 0.95)":"rgba(38, 38, 43, 0.85)",borderColor:"rgba(255, 255, 255, 0.12)"},children:[!r&&Object.entries(Mi).map(([H,J],te)=>{const ee=J.icon,se=te+1;return g.jsx(Db,{content:`添加${J.label} [${se}]`,position:"top",children:g.jsx("button",{onClick:ue=>{ue.stopPropagation(),d(t.id,H)},className:`p-1.5 rounded-lg hover:bg-white/15 transition-colors ${J.color}`,children:g.jsx(ee,{size:14,strokeWidth:2})})},H)}),g.jsx("div",{className:"w-[1px] h-5 bg-white/10 mx-0.5"}),g.jsx(Db,{content:"编辑 [Enter]",position:"top",children:g.jsx("button",{onClick:H=>{H.stopPropagation(),x(t.id)},className:"p-1.5 rounded-lg hover:bg-white/15 text-stone-300 hover:text-stone-100 transition-colors",children:g.jsx(elt,{size:14,strokeWidth:2})})}),t.parent&&g.jsx(Db,{content:"重连",position:"top",children:g.jsx("button",{onClick:H=>{H.stopPropagation(),f(t.id)},className:"p-1.5 rounded-lg hover:bg-white/15 text-stone-300 hover:text-stone-100 transition-colors",children:g.jsx($ot,{size:14,strokeWidth:2})})}),g.jsx(Db,{content:"删除 [Del]",position:"top",children:g.jsx("button",{onClick:H=>{H.stopPropagation(),o(t.id),setTimeout(()=>c(t.id),0)},className:"p-1.5 rounded-lg hover:bg-rose-900/40 text-stone-300 hover:text-rose-400 transition-colors",children:g.jsx(yP,{size:14,strokeWidth:2})})})]}),!n&&g.jsxs("div",{className:`
            px-2.5 py-1.5 rounded-lg transition-all duration-300 flex items-center gap-2.5
            ${r?"border-2 border-orange-500/50":i?"border-2 border-cyan-400/50":e?"border-[1.5px] shadow-[0_0_20px_rgba(255,255,255,0.08),0_4px_12px_rgba(0,0,0,0.3)] scale-[1.02]":"border shadow-[0_2px_8px_rgba(0,0,0,0.25)] hover:shadow-[0_4px_16px_rgba(0,0,0,0.35)]"}
          `,style:{opacity:t.confidence!==void 0?t.confidence:1,minWidth:"180px",maxWidth:"300px",background:e?"var(--arena-node-selected-bg)":"var(--arena-node-bg)",borderColor:r||i?void 0:e?"var(--arena-border-selected)":"var(--arena-border-primary)"},onDoubleClick:Z,children:[g.jsx("div",{className:"rounded-full shrink-0",style:{backgroundColor:y.colorValue||"#888",width:`${Math.max(8,3*X)}px`,height:`${Math.max(8,3*X)}px`,minWidth:"8px",minHeight:"8px",boxShadow:`0 0 6px ${y.colorValue||"#888"}50, 0 0 12px ${y.colorValue||"#888"}25`}}),g.jsx("p",{className:"font-medium cursor-text flex-1",onClick:H=>H.stopPropagation(),style:{color:"var(--arena-text-primary)",fontSize:`${14*X}px`,lineHeight:"1.4",display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",overflow:"hidden",wordBreak:"break-word",minWidth:0},children:t.text||g.jsx("span",{className:"text-zinc-500 italic",children:"双击编辑..."})}),t.note&&g.jsx(vP,{size:10,className:"text-amber-500/70 shrink-0 ml-1",style:{width:`${10*X}px`,height:`${10*X}px`,minWidth:"8px",minHeight:"8px"}})]}),n&&g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute left-0 top-0 -translate-x-3 translate-y-2 rounded-full shrink-0 z-10",style:{backgroundColor:y.colorValue||"#888",width:`${8*X}px`,height:`${8*X}px`,minWidth:"6px",minHeight:"6px",boxShadow:`0 0 8px ${y.colorValue||"#888"}80, 0 0 16px ${y.colorValue||"#888"}40`}}),g.jsx("div",{className:"px-2.5 py-1.5 rounded border shadow-xl",style:{background:"#252836",borderColor:"rgb(161, 161, 170)",minWidth:"200px",maxWidth:"300px"},onMouseDown:H=>H.stopPropagation(),onMouseMove:H=>H.stopPropagation(),onMouseUp:H=>H.stopPropagation(),children:g.jsx("textarea",{ref:w,value:t.text,onChange:H=>{H.stopPropagation(),l(t.id,H.target.value)},onBlur:H=>{C(H.target.value),b()},onKeyDown:H=>{H.key==="Escape"&&(H.preventDefault(),b()),H.key===" "&&H.stopPropagation()},onClick:H=>H.stopPropagation(),onMouseDown:H=>H.stopPropagation(),onMouseMove:H=>H.stopPropagation(),onMouseUp:H=>H.stopPropagation(),className:"w-full text-zinc-100 bg-transparent border-none outline-none resize-none",style:{fontSize:`${14*X}px`,lineHeight:"1.4",minHeight:"40px"},placeholder:"输入思维节点内容..."})})]}),r&&g.jsx("div",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-zinc-500 whitespace-nowrap",style:{fontSize:`${11*X}px`},children:"🔗 重连模式"}),i&&g.jsx("div",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-zinc-400 whitespace-nowrap",style:{fontSize:`${11*X}px`},children:"✅ 点击完成"})]})},hut=({arenaMemory:t,currentTheme:e,universes:n,activeUniverseId:r,isNavigationMode:i,isSaving:a,hasUnsavedChanges:s,snapshotCount:o,showMinimap:l,onClose:u,onSwitchUniverse:c,onCreateUniverse:d,onDeleteUniverse:h,onToggleNavigationMode:f,onAutoLayout:m,onCreateSnapshot:x,onManualSave:b,onShowMenu:y,onToggleMinimap:w})=>g.jsx("header",{className:"backdrop-blur-md z-50",style:{background:e.colors.headerBg,borderBottom:`1px solid ${e.colors.borderPrimary}`},children:g.jsxs("div",{className:"h-11 md:h-12 flex items-center justify-between px-3 md:px-4 border-b md:border-b-0",style:{borderColor:e.colors.borderPrimary},children:[g.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[g.jsxs("button",{onClick:u,className:"flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1 md:py-1.5 text-zinc-300 hover:text-zinc-400 hover:bg-white/5 rounded transition-all min-w-0 flex-shrink-0",title:"返回记忆界面",children:[g.jsx(hP,{size:16,className:"flex-shrink-0"}),g.jsx("span",{className:"text-[11px] md:text-xs truncate max-w-[140px] md:max-w-[280px]",children:t.arenaV2TriggerQuestion||t.title||t.content||"思维演武场"})]}),g.jsxs("div",{className:"hidden md:flex items-center gap-1 flex-shrink-0",children:[n.map(_=>g.jsxs("div",{className:"flex items-center gap-0.5 group",children:[g.jsx("button",{onClick:()=>c(_.id),className:`px-2 py-1 text-xs rounded transition-all ${r===_.id?"bg-white/10 text-slate-300 border-b-2 border-white/30":"text-slate-400 hover:text-slate-400"}`,children:_.name}),_.id!=="u1"&&g.jsx("button",{onClick:S=>{S.stopPropagation(),h(_.id)},className:"p-0.5 rounded opacity-0 group-hover:opacity-100 transition-all text-slate-400 hover:text-red-400",title:"删除推演",children:g.jsx(Ba,{size:10})})]},_.id)),g.jsx("button",{onClick:d,className:"px-1.5 py-1 text-slate-400 hover:text-slate-400 rounded transition-all",title:"创建平行宇宙",children:g.jsx(ece,{size:12})})]})]}),g.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[g.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[g.jsx("button",{onClick:()=>{f(),Wn("light")},className:`p-2 rounded transition-all ${i?"bg-white/15 text-white":"text-slate-400 hover:text-slate-300 hover:bg-white/5"}`,title:i?"退出导航模式":"进入导航模式 (右键拖动也可平移)",children:g.jsx(Que,{size:16})}),g.jsx("button",{onClick:()=>{m(),Wn("light")},className:"p-2 text-slate-400 hover:text-slate-300 hover:bg-white/5 rounded transition-all",title:"自动重排 (Shift+L)",children:g.jsx(a2,{size:16})}),g.jsxs("button",{onClick:()=>{x(),Wn("light")},className:"p-2 text-slate-400 hover:text-slate-300 hover:bg-white/5 rounded transition-all relative",title:"创建快照 (Shift+S)",children:[g.jsx(o1,{size:16}),o>0&&g.jsx("span",{className:"absolute -top-0.5 -right-0.5 text-[8px] bg-white/20 text-white px-1 rounded-full",children:o})]}),w&&g.jsx("button",{onClick:()=>{w(),Wn("light")},className:`p-2 rounded transition-all ${l?"bg-white/10 text-slate-300":"text-slate-400 hover:text-slate-300 hover:bg-white/5"}`,title:l?"隐藏导航图":"显示导航图",children:g.jsx(Jue,{size:16})}),g.jsx("button",{onClick:()=>{b(),Wn("light")},disabled:!s||a,className:`p-2 rounded transition-all ${s?"text-amber-400 hover:text-amber-300 hover:bg-amber-500/10":"text-slate-500"} ${a?"animate-pulse":""}`,title:a?"保存中...":s?"点击保存":"已保存",children:g.jsx(ilt,{size:16})})]}),g.jsx("button",{onClick:y,className:"p-2 text-slate-400 hover:text-slate-300 hover:bg-white/5 rounded transition-all",title:"更多选项",children:g.jsx(Kue,{size:16})})]})]})}),fut=({currentTheme:t,isNavigationMode:e,universes:n,activeUniverseId:r,showMinimap:i,onToggleNavigationMode:a,onAutoLayout:s,onCreateSnapshot:o,onSwitchUniverse:l,onCreateUniverse:u,onDeleteUniverse:c,onToggleMinimap:d})=>g.jsxs("div",{className:"md:hidden flex flex-wrap items-center gap-1.5 px-3 py-1.5",style:{borderTop:`1px solid ${t.colors.borderPrimary}`},children:[n&&l&&g.jsxs("div",{className:"flex items-center gap-1",children:[n.map(h=>g.jsxs("div",{className:"flex items-center gap-0.5 group",children:[g.jsx("button",{onClick:()=>{l(h.id),Wn("light")},className:`px-2.5 py-1.5 text-[11px] rounded whitespace-nowrap transition-all active:scale-95 flex items-center justify-center ${r===h.id?"bg-white/10 text-slate-300":"text-slate-400"}`,children:h.name}),h.id!=="u1"&&c&&g.jsx("button",{onClick:f=>{f.stopPropagation(),c(h.id),Wn("medium")},className:"w-7 h-7 flex items-center justify-center rounded text-slate-400 active:text-red-400",title:"删除推演",children:g.jsx(Ba,{size:12})})]},h.id)),u&&g.jsx("button",{onClick:()=>{u(),Wn("medium")},className:"w-7 h-7 flex items-center justify-center text-slate-400 rounded transition-all active:scale-95",title:"创建平行宇宙",children:g.jsx(ece,{size:12})})]}),n&&g.jsx("div",{className:"w-px h-5 bg-white/10"}),g.jsx("button",{onClick:()=>{a(),Wn("medium")},className:`w-8 h-8 flex items-center justify-center rounded transition-all active:scale-95 ${e?"bg-blue-500/20 border border-blue-400":""}`,style:{color:e?t.colors.textPrimary:t.colors.textSecondary},title:e?"退出导航":"导航模式",children:g.jsx(Que,{size:14})}),g.jsx("button",{onClick:()=>{s(),Wn("medium")},className:"w-8 h-8 flex items-center justify-center rounded transition-all active:scale-95 active:bg-white/10",style:{color:t.colors.textSecondary},title:"自动布局",children:g.jsx(a2,{size:14})}),g.jsx("button",{onClick:()=>{o(),Wn("medium")},className:"w-8 h-8 flex items-center justify-center rounded transition-all active:scale-95 active:bg-white/10",style:{color:t.colors.textSecondary},title:"创建快照",children:g.jsx(o1,{size:14})}),d&&g.jsx("button",{onClick:()=>{d(),Wn("light")},className:`w-8 h-8 flex items-center justify-center rounded transition-all active:scale-95 ${i?"bg-white/10":""}`,style:{color:i?t.colors.textPrimary:t.colors.textSecondary},title:i?"隐藏导航图":"显示导航图",children:g.jsx(Jue,{size:14})})]}),fv={id:"soft-light",name:"柔光模式",description:"护眼首选，暖灰色调减少疲劳",colors:{canvasBg:"#1c1c20",headerBg:"rgba(28, 28, 32, 0.9)",sidebarBg:"#222226",nodeBg:"#2a2a30",nodeSelectedBg:"#38383f",borderPrimary:"rgba(255, 255, 255, 0.14)",borderSecondary:"rgba(255, 255, 255, 0.08)",borderSelected:"rgba(180, 175, 168, 0.55)",lineColor:"#9a9590",lineWidth:1.8,textPrimary:"#ebe9e6",textSecondary:"#b5b2ad",textTertiary:"#807d78",accentPrimary:"#a78bfa",accentSecondary:"#818cf8"}},put={id:"comfortable",name:"舒适模式",description:"均衡配色，适合日常使用",colors:{canvasBg:"#121316",headerBg:"rgba(18, 19, 22, 0.8)",sidebarBg:"#0e0f11",nodeBg:"#1e2024",nodeSelectedBg:"#2a2d33",borderPrimary:"rgba(255, 255, 255, 0.13)",borderSecondary:"rgba(255, 255, 255, 0.06)",borderSelected:"rgba(161, 161, 170, 0.6)",lineColor:"#7c8594",lineWidth:1.8,textPrimary:"#e4e4e7",textSecondary:"#a1a1aa",textTertiary:"#71717a",accentPrimary:"#8b5cf6",accentSecondary:"#6366f1"}},mut={id:"deep-dark",name:"深邃模式",description:"OLED 友好，高对比护眼",colors:{canvasBg:"#0a0a0c",headerBg:"rgba(10, 10, 12, 0.9)",sidebarBg:"#050506",nodeBg:"#18181c",nodeSelectedBg:"#252529",borderPrimary:"rgba(255, 255, 255, 0.15)",borderSecondary:"rgba(255, 255, 255, 0.08)",borderSelected:"rgba(200, 200, 210, 0.6)",lineColor:"#5c6370",lineWidth:1.5,textPrimary:"#d4d4d8",textSecondary:"#8b8b92",textTertiary:"#5c5c64",accentPrimary:"#a78bfa",accentSecondary:"#818cf8"}},gut={id:"ink-wash",name:"墨韵模式",description:"素雅水墨风，专注思考",colors:{canvasBg:"#1c1c1f",headerBg:"rgba(28, 28, 31, 0.85)",sidebarBg:"#141416",nodeBg:"#282830",nodeSelectedBg:"#363640",borderPrimary:"rgba(180, 180, 190, 0.12)",borderSecondary:"rgba(180, 180, 190, 0.06)",borderSelected:"rgba(180, 180, 190, 0.4)",lineColor:"#6b6b78",lineWidth:1.6,textPrimary:"#dcdce0",textSecondary:"#9898a0",textTertiary:"#606068",accentPrimary:"#9ca3af",accentSecondary:"#6b7280"}},vut={id:"warm-night",name:"暖夜模式",description:"暖橙色调，深夜护眼",colors:{canvasBg:"#1a1815",headerBg:"rgba(26, 24, 21, 0.85)",sidebarBg:"#141210",nodeBg:"#262320",nodeSelectedBg:"#35312c",borderPrimary:"rgba(255, 245, 235, 0.1)",borderSecondary:"rgba(255, 245, 235, 0.05)",borderSelected:"rgba(215, 195, 170, 0.45)",lineColor:"#8a8075",lineWidth:1.8,textPrimary:"#e8e0d8",textSecondary:"#a8a090",textTertiary:"#706858",accentPrimary:"#d4a574",accentSecondary:"#c49a6c"}},hce=[fv,put,mut,gut,vut];function mX(t){return t&&hce.find(e=>e.id===t)||fv}function gX(t,e){const n=document.documentElement;n.style.setProperty("--arena-canvas-bg",t.colors.canvasBg),n.style.setProperty("--arena-header-bg",t.colors.headerBg),n.style.setProperty("--arena-sidebar-bg",t.colors.sidebarBg),n.style.setProperty("--arena-node-bg",t.colors.nodeBg),n.style.setProperty("--arena-node-selected-bg",t.colors.nodeSelectedBg),n.style.setProperty("--arena-border-primary",t.colors.borderPrimary),n.style.setProperty("--arena-border-secondary",t.colors.borderSecondary),n.style.setProperty("--arena-border-selected",t.colors.borderSelected),n.style.setProperty("--arena-line-color",t.colors.lineColor),n.style.setProperty("--arena-line-width",t.colors.lineWidth.toString()),n.style.setProperty("--arena-text-primary",t.colors.textPrimary),n.style.setProperty("--arena-text-secondary",t.colors.textSecondary),n.style.setProperty("--arena-text-tertiary",t.colors.textTertiary),n.style.setProperty("--arena-accent-primary",t.colors.accentPrimary),n.style.setProperty("--arena-accent-secondary",t.colors.accentSecondary)}function yut(t){try{localStorage.setItem("arena-v2-theme",t)}catch(e){console.warn("Failed to save theme preference:",e)}}function xut(){try{return localStorage.getItem("arena-v2-theme")||fv.id}catch(t){return console.warn("Failed to load theme preference:",t),fv.id}}const fce=[{id:"free",name:"拓扑模式"},{id:"tree",name:"树状模式"},{id:"orthogonal",name:"直角线模式"}],but=({currentTheme:t,viewMode:e,currentNodes:n,selectedNode:r,isFocusMode:i,onThemeChange:a,onViewModeChange:s,onShowViewModeSheet:o})=>i?null:g.jsxs("footer",{className:"h-10 md:h-7 flex items-center justify-between px-3 relative",style:{background:`${t.colors.canvasBg}f5`},children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"md:hidden flex items-center gap-2",children:g.jsx("button",{onClick:()=>{o(),Wn("light")},className:"min-w-[44px] min-h-[44px] flex items-center justify-center rounded transition-all active:scale-95 bg-white/5 hover:bg-white/10",style:{color:t.colors.textSecondary},title:"画布风格",children:g.jsx(IN,{size:16})})}),g.jsxs("div",{className:"hidden md:block relative group",children:[g.jsx("button",{className:"w-5 h-5 flex items-center justify-center text-[10px] hover:text-slate-300 transition-colors",style:{color:t.colors.textSecondary},title:"快捷键",children:"?"}),g.jsx(_ut,{theme:t})]}),g.jsxs("div",{className:"hidden md:block relative group",children:[g.jsxs("button",{className:"flex items-center gap-1 px-2 py-0.5 text-[10px] hover:text-slate-300 transition-colors",style:{color:t.colors.textSecondary},title:"视觉主题",children:[g.jsx("svg",{className:"w-[11px] h-[11px]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),g.jsx("span",{children:t.name})]}),g.jsx(wut,{currentTheme:t,onThemeChange:a})]}),g.jsxs("div",{className:"hidden md:block relative group",children:[g.jsxs("button",{className:"flex items-center gap-1 px-2 py-0.5 text-[10px] hover:text-slate-300 transition-colors",style:{color:t.colors.textSecondary},title:"画布风格",children:[g.jsx(IN,{size:11}),g.jsx("span",{children:fce.find(l=>l.id===e)?.name||"拓扑模式"})]}),g.jsx(Sut,{currentTheme:t,viewMode:e,onViewModeChange:s})]})]}),g.jsxs("div",{className:"flex items-center gap-3 text-[10px]",style:{color:`${t.colors.textSecondary}60`},children:[g.jsxs("span",{children:[n.length," 节点"]}),r&&g.jsx("span",{className:"opacity-50",children:"·"}),r&&g.jsx("span",{children:"已选中"})]})]}),_ut=({theme:t})=>{const e=[{key:"1-5",label:"添加节点"},{key:"Enter",label:"编辑"},{key:"Del",label:"删除"},{key:"Tab",label:"子节点"},{key:"Space",label:"切换类型"},{key:"Shift+F",label:"专注"},{key:"Shift+L",label:"重排"},{key:"Shift+S",label:"快照"}];return g.jsx("div",{className:"absolute bottom-full left-0 mb-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:g.jsxs("div",{className:"backdrop-blur-xl rounded-lg p-2 shadow-2xl",style:{background:`${t.colors.nodeBg}f0`,border:`1px solid ${t.colors.borderPrimary}`},children:[g.jsx("div",{className:"text-[9px] text-slate-400 uppercase tracking-wider mb-1.5",children:"快捷键"}),g.jsx("div",{className:"space-y-0.5 text-[10px]",style:{color:t.colors.textSecondary},children:e.map(({key:n,label:r})=>g.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[g.jsx("kbd",{className:"px-1 py-0.5 bg-white/5 border border-white/10 rounded text-[8px] min-w-[1.5rem] text-center",children:n}),g.jsx("span",{children:r})]},n))})]})})},wut=({currentTheme:t,onThemeChange:e})=>g.jsx("div",{className:"absolute bottom-full left-0 mb-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:g.jsxs("div",{className:"backdrop-blur-xl rounded-lg p-2 shadow-2xl min-w-[120px]",style:{background:`${t.colors.nodeBg}f0`,border:`1px solid ${t.colors.borderPrimary}`},children:[g.jsx("div",{className:"text-[9px] text-slate-400 uppercase tracking-wider mb-1.5",children:"视觉主题"}),g.jsx("div",{className:"space-y-1",children:hce.map(n=>g.jsxs("button",{onClick:()=>e(n.id),className:`w-full flex items-center justify-between px-2 py-1 rounded text-[10px] transition-all ${t.id===n.id?"bg-white/10 text-slate-300":"hover:bg-white/5 text-slate-400 hover:text-slate-300"}`,children:[g.jsx("span",{children:n.name}),t.id===n.id&&g.jsx("span",{className:"text-[8px]",children:"✓"})]},n.id))})]})}),Sut=({currentTheme:t,viewMode:e,onViewModeChange:n})=>g.jsx("div",{className:"absolute bottom-full left-0 mb-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:g.jsxs("div",{className:"backdrop-blur-xl rounded-lg p-2 shadow-2xl min-w-[140px]",style:{background:`${t.colors.nodeBg}f0`,border:`1px solid ${t.colors.borderPrimary}`},children:[g.jsx("div",{className:"text-[9px] text-slate-400 uppercase tracking-wider mb-1.5",children:"画布风格"}),g.jsx("div",{className:"space-y-1",children:fce.map(r=>g.jsxs("button",{onClick:()=>n(r.id),className:`w-full flex items-center justify-between px-2 py-1 rounded text-[10px] transition-all ${e===r.id?"bg-white/10 text-slate-300":"hover:bg-white/5 text-slate-400 hover:text-slate-300"}`,children:[g.jsx("span",{children:r.name}),e===r.id&&g.jsx("span",{className:"text-[8px]",children:"✓"})]},r.id))})]})}),Eut=({isOpen:t,isFocusMode:e,snapshots:n,currentTheme:r,onSetIsOpen:i,onCreateSnapshot:a,onRenameSnapshot:s,onDeleteSnapshot:o,onRestoreSnapshot:l})=>{const[u,c]=P.useState(null),[d,h]=P.useState(null);return g.jsxs("aside",{className:`
        ${e?"w-0":t?"w-64":"w-0"} 
        flex flex-col transition-all duration-300 z-40
        md:relative fixed left-0 top-0 bottom-0
      `,style:{background:r.colors.sidebarBg,borderRight:`1px solid ${r.colors.borderPrimary}`},children:[g.jsx("button",{onClick:()=>i(!t),className:"absolute -right-4 top-1/2 -translate-y-1/2 w-8 h-16 rounded-full flex items-center justify-center hover:bg-white/10 z-50 transition-all",style:{background:r.colors.nodeBg,border:`1px solid ${r.colors.borderPrimary}`,color:r.colors.textSecondary},children:t?g.jsx(hP,{size:14}):g.jsx("div",{className:"pl-1",title:"历史快照 (Shift+S)",children:g.jsx(o1,{size:14})})}),t&&g.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[g.jsx("div",{className:"p-4 pb-3 border-b",style:{borderColor:r.colors.borderPrimary},children:g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"历史快照"}),g.jsxs("button",{onClick:()=>{a(),Wn("medium")},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs transition-all hover:bg-white/10 active:scale-95",style:{background:`${r.colors.nodeBg}80`,border:`1px solid ${r.colors.borderPrimary}`,color:r.colors.textPrimary},title:"保存当前状态 (Shift+S)",children:[g.jsx(o1,{size:12}),g.jsx("span",{children:"保存"})]})]})}),g.jsx("div",{className:"p-4 flex-1 overflow-y-auto",children:g.jsxs("div",{className:"space-y-1.5",children:[[...n].slice().reverse().map((f,m)=>{const x=n.length-1-m;return g.jsx("div",{className:"relative group",children:u===x?g.jsx("input",{type:"text",defaultValue:f.name,autoFocus:!0,onBlur:b=>{s(x,b.target.value),c(null)},onKeyDown:b=>{b.key==="Enter"?(s(x,b.currentTarget.value),c(null)):b.key==="Escape"&&c(null)},className:"w-full px-2 py-1.5 bg-zinc-900 border border-white/10 rounded text-sm text-zinc-200 outline-none"}):g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsxs("button",{onClick:()=>l(f),onDoubleClick:()=>c(x),className:"flex-1 flex items-center gap-2 px-2 py-1.5 bg-white/5 hover:bg-white/10 border border-transparent hover:border-white/20 rounded text-sm text-slate-400 hover:text-slate-200 transition-all",children:[g.jsx(o1,{size:12,className:"text-slate-400 flex-shrink-0"}),g.jsx("span",{className:"flex-1 text-left truncate",children:f.name})]}),g.jsx("button",{onClick:b=>{b.stopPropagation(),h(d===x?null:x)},className:"p-1 opacity-0 group-hover:opacity-100 text-slate-400 hover:text-slate-300 hover:bg-white/10 rounded transition-all",children:g.jsx(Kue,{size:12})}),d===x&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>h(null)}),g.jsxs("div",{className:"absolute right-0 top-8 z-[110] backdrop-blur-xl rounded-lg shadow-2xl py-1 min-w-[120px]",style:{background:r.colors.nodeBg,border:`1px solid ${r.colors.borderPrimary}`},children:[g.jsx("button",{onClick:()=>{c(x),h(null)},className:"w-full px-3 py-1.5 text-left text-sm text-slate-300 hover:bg-white/10 hover:text-white transition-all",children:"重命名"}),g.jsx("button",{onClick:()=>{o(x),h(null)},className:"w-full px-3 py-1.5 text-left text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300 transition-all",children:"删除"})]})]})]})},x)}),n.length===0&&g.jsx("p",{className:"text-xs text-slate-400 text-center py-4",children:"暂无快照"})]})})]})]})},pce=({description:t})=>{const[e,n]=P.useState(!1),[r,i]=P.useState("left"),a=P.useRef(null),s=P.useRef(null);return P.useEffect(()=>{e&&a.current&&(a.current.getBoundingClientRect().left<200?i("top"):i("left"))},[e]),g.jsxs("div",{className:"relative inline-flex items-center",children:[g.jsx("span",{ref:a,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),className:"flex items-center justify-center w-4 h-4 rounded-full text-slate-600 hover:text-slate-400 transition-all cursor-help",role:"img","aria-label":"帮助信息",children:g.jsx(Yue,{size:11})}),e&&g.jsx("div",{ref:s,className:`absolute z-[9999] w-[200px] pointer-events-none ${r==="left"?"right-full mr-2 top-1/2 -translate-y-1/2":"bottom-full mb-2 left-1/2 -translate-x-1/2"}`,children:g.jsx("div",{className:"bg-slate-900 border border-white/10 rounded-lg shadow-xl p-2.5",children:g.jsx("div",{className:"text-[10px] text-slate-300 leading-relaxed",children:t})})})]})},Tut=({isOpen:t,isFocusMode:e,selectedNode:n,activeUniverseId:r,currentTheme:i,aiEnabled:a,isAILoading:s,aiResultType:o,isPressureTesting:l,hasParadigmCache:u,hasBlindspotCache:c,hasConflictCache:d,hasExportNodeToMemory:h,hasDistillToCard:f,aiBrainIndicator:m,thinkingDice:x,onSetIsOpen:b,onNodeTextChange:y,onNodeNoteChange:w,onMergeSubtree:_,onNodeTypeChange:S,onInjectParadigm:M,onExportNodeToMemory:E,onDistillToCard:C,onExport:R,onConflictDetection:k,onBlindSpotScan:I,onParadigmRecommend:N,onLoadCachedResult:D})=>{const[F,L]=P.useState(!1);return g.jsxs("aside",{className:`
        hidden md:flex
        absolute right-0 top-0 bottom-0
        ${e?"w-0":t?"w-72":"w-0"} 
        flex-col transition-all duration-300 z-40
      `,style:{background:i.colors.sidebarBg,borderLeft:t?`1px solid ${i.colors.borderPrimary}`:"none",pointerEvents:t?"auto":"none"},children:[g.jsx("button",{onClick:()=>b(!t),className:"absolute -left-3 top-1/2 -translate-y-1/2 w-5 h-10 rounded-full flex items-center justify-center hover:bg-white/10 z-50 transition-all",style:{background:i.colors.nodeBg,border:`1px solid ${i.colors.borderPrimary}`,color:i.colors.textSecondary,pointerEvents:"auto"},children:t?g.jsx(i_,{size:10}):g.jsx(hP,{size:10})}),t&&g.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:g.jsxs("div",{className:"px-4 pb-4 pt-4 flex-1 flex flex-col gap-3",children:[g.jsxs("section",{className:"md:hidden rounded-lg border border-white/5 p-3",style:{background:`${i.colors.nodeBg}40`},children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("h4",{className:"text-[10px] font-medium tracking-wider",style:{color:i.colors.textSecondary},children:"AI 赋能"}),m]}),x]}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex gap-1",children:[g.jsxs("button",{onClick:k,disabled:s,className:`flex-1 py-1.5 rounded flex items-center justify-center gap-1.5 text-[11px] transition-all ${l?"bg-white/10 text-slate-300 border":"bg-white/5 text-slate-400 hover:bg-white/10 hover:text-slate-300"} disabled:opacity-50`,style:l?{borderColor:i.colors.borderPrimary}:{},children:[s&&o==="conflict"?g.jsx("div",{className:"w-3 h-3 border border-slate-400 border-t-transparent rounded-full animate-spin"}):g.jsx(s2,{size:11}),"冲突测试"]}),d&&g.jsx("button",{onClick:()=>D("conflict"),className:"px-2 py-1.5 rounded bg-white/5 text-slate-500 hover:bg-white/10 hover:text-slate-400 transition-all",title:"查看上次结果",children:g.jsx(Dh,{size:11})})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsxs("button",{onClick:I,disabled:s,className:"flex-1 py-1.5 rounded flex items-center justify-center gap-1.5 text-[11px] transition-all bg-white/5 text-slate-400 hover:bg-white/10 hover:text-slate-300 disabled:opacity-50",children:[s&&o==="blindspot"?g.jsx("div",{className:"w-3 h-3 border border-slate-400 border-t-transparent rounded-full animate-spin"}):g.jsx(s2,{size:11}),"盲点扫描"]}),c&&g.jsx("button",{onClick:()=>D("blindspot"),className:"px-2 py-1.5 rounded bg-white/5 text-slate-500 hover:bg-white/10 hover:text-slate-400 transition-all",title:"查看上次结果",children:g.jsx(Dh,{size:11})})]}),g.jsxs("details",{className:"group pt-1",children:[g.jsxs("summary",{className:"text-[10px] text-slate-500 cursor-pointer hover:text-slate-400 transition-colors list-none flex items-center gap-1",children:[g.jsx(i_,{size:10,className:"transition-transform group-open:rotate-90"}),"更多"]}),g.jsxs("div",{className:"mt-2 space-y-1.5",children:[g.jsxs("div",{className:"flex gap-1",children:[g.jsxs("button",{onClick:N,disabled:s,className:"flex-1 py-1.5 rounded flex items-center justify-center gap-1.5 text-[11px] transition-all bg-white/5 text-slate-400 hover:bg-white/10 hover:text-slate-300 disabled:opacity-50",children:[s&&o==="paradigm"?g.jsx("div",{className:"w-3 h-3 border border-slate-400 border-t-transparent rounded-full animate-spin"}):g.jsx(kN,{size:11}),"范式推荐"]}),u&&g.jsx("button",{onClick:()=>D("paradigm"),className:"px-2 py-1.5 rounded bg-white/5 text-slate-500 hover:bg-white/10 hover:text-slate-400 transition-all",title:"查看上次结果",children:g.jsx(Dh,{size:11})})]}),g.jsxs("button",{onClick:R,className:"w-full py-1.5 rounded flex items-center justify-center gap-1.5 text-[11px] transition-all bg-white/5 text-slate-400 hover:bg-white/10 hover:text-slate-300",children:[g.jsx(Dh,{size:11}),"生成报告"]})]})]})]})]}),n?g.jsxs("section",{className:"flex-1 flex flex-col rounded-xl border p-4 overflow-hidden",style:{background:i.colors.nodeBg,borderColor:i.colors.borderPrimary},children:[g.jsxs("div",{className:"flex items-center justify-between mb-3",children:[g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>L(!F),className:"flex items-center gap-2 px-2.5 py-1.5 rounded-lg hover:bg-white/8 transition-colors group",children:[g.jsx("div",{className:"w-3 h-3 rounded-full",style:{background:Mi[n.type].colorValue,boxShadow:`0 0 8px ${Mi[n.type].colorValue}50`}}),g.jsx("span",{className:"text-xs font-medium",style:{color:i.colors.textPrimary},children:Mi[n.type].label}),g.jsx(Ph,{size:12,className:`text-stone-500 transition-transform ${F?"rotate-180":""}`})]}),F&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>L(!1)}),g.jsx("div",{className:"absolute top-full left-0 mt-1 z-50 min-w-[140px] rounded-xl border shadow-2xl overflow-hidden",style:{background:i.colors.nodeBg,borderColor:i.colors.borderPrimary},children:Object.entries(Mi).map(([U,j])=>{const q=n.type===U,Z=j.icon;return g.jsxs("button",{onClick:()=>{S(n.id,U),L(!1)},className:`w-full flex items-center gap-2.5 px-3 py-2.5 text-left transition-colors ${q?"bg-white/10":"hover:bg-white/6"}`,children:[g.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{background:j.colorValue,boxShadow:`0 0 6px ${j.colorValue}40`}}),g.jsx(Z,{size:14,className:j.color}),g.jsx("span",{className:"text-xs font-medium",style:{color:q?i.colors.textPrimary:i.colors.textSecondary},children:j.label}),q&&g.jsx("span",{className:"ml-auto text-[10px] text-stone-500",children:"✓"})]},U)})})]})]}),r!=="u1"&&g.jsx("button",{onClick:()=>_(n.id),className:"px-2 py-1 bg-white/8 text-slate-400 rounded-lg text-xs hover:bg-white/12 hover:text-slate-300 transition-colors",title:"归并到主宇宙",children:"归并"})]}),g.jsx("textarea",{value:n.text,onChange:U=>y(n.id,U.target.value),placeholder:"输入节点内容...",className:"w-full px-3 py-2 rounded-lg text-sm placeholder-stone-500 outline-none focus:ring-2 focus:ring-sky-500/30 transition-all resize-none mb-3",style:{background:i.colors.canvasBg,border:`1px solid ${i.colors.borderPrimary}`,color:i.colors.textPrimary,minHeight:"80px",height:"auto",fontSize:"14px",lineHeight:"1.6"},rows:Math.max(3,Math.min(8,n.text.split(`
`).length+1))}),g.jsxs("div",{className:"mb-4",children:[g.jsxs("div",{className:"text-xs text-stone-400 mb-2 flex items-center gap-1.5",children:[g.jsx(vP,{size:12,className:"text-amber-500/70"}),"笔记"]}),g.jsx("textarea",{value:n.note||"",onChange:U=>w(n.id,U.target.value),placeholder:"添加笔记...",className:"w-full px-3 py-2 rounded-lg text-sm placeholder-stone-500 outline-none focus:ring-2 focus:ring-amber-500/30 transition-all resize-none overflow-y-auto",style:{background:i.colors.canvasBg,border:`1px solid ${i.colors.borderPrimary}`,color:i.colors.textSecondary,maxHeight:"120px",lineHeight:"1.5"},rows:n.note&&n.note.length>0?Math.min(6,Math.max(2,n.note.split(`
`).length+1)):2})]}),g.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h&&g.jsx("button",{onClick:E,className:"flex-1 py-2 rounded-lg flex items-center justify-center gap-1.5 text-xs bg-white/6 text-stone-400 hover:bg-white/10 hover:text-stone-200 transition-colors",children:"💭 导出为记忆"}),f&&g.jsx("button",{onClick:C,className:"flex-1 py-2 rounded-lg flex items-center justify-center gap-1.5 text-xs bg-white/6 text-stone-400 hover:bg-white/10 hover:text-stone-200 transition-colors",children:"📚 提炼为卡片"})]}),g.jsxs("details",{className:"group",children:[g.jsxs("summary",{className:"text-xs text-stone-400 cursor-pointer hover:text-stone-300 transition-colors list-none flex items-center gap-1.5 mb-2",children:[g.jsx(i_,{size:12,className:"transition-transform group-open:rotate-90"}),"范式注入"]}),g.jsx("div",{className:"space-y-1 max-h-[180px] overflow-y-auto pr-1",children:Xo.map((U,j)=>g.jsxs("button",{onClick:()=>M(j),className:"w-full flex items-center justify-between px-3 py-2 bg-white/[0.03] hover:bg-white/8 rounded-lg text-xs text-stone-400 hover:text-stone-200 transition-all group/btn",children:[g.jsx("span",{className:"text-left truncate",children:U.name}),g.jsxs("div",{className:"flex items-center gap-1.5 opacity-0 group-hover/btn:opacity-100 transition-opacity",children:[g.jsx(pce,{description:U.useCase}),g.jsx(kN,{size:12,className:"text-stone-400"})]})]},j))})]})]}):g.jsx("div",{className:"flex-1 flex items-center justify-center border border-dashed rounded-xl p-8 text-center",style:{borderColor:i.colors.borderPrimary},children:g.jsx("p",{className:"text-sm text-stone-500 leading-relaxed",children:"请选中一个思维节点"})})]})})]})},Cut=({title:t,message:e,type:n="confirm",variant:r="warning",confirmText:i="确定",cancelText:a="取消",thirdButtonText:s,requireInput:o=!1,requiredInputText:l="",onConfirm:u,onCancel:c,onThirdButton:d})=>{const[h,f]=P.useState(""),m=P.useRef(null);P.useEffect(()=>{o&&m.current&&m.current.focus()},[o]);const x=!o||h===l,b=()=>r==="danger"?g.jsx(l2,{size:20,className:"text-rose-500"}):r==="warning"?g.jsx(l2,{size:20,className:"text-amber-500"}):g.jsx(Uot,{size:20,className:"text-sky-500"}),y=()=>r==="danger"?"bg-rose-600 hover:bg-rose-700 text-white disabled:opacity-50 disabled:cursor-not-allowed":r==="warning"?"bg-amber-600 hover:bg-amber-700 text-white disabled:opacity-50 disabled:cursor-not-allowed":"bg-zinc-100 hover:bg-zinc-200 text-zinc-950 disabled:opacity-50 disabled:cursor-not-allowed",w=()=>r==="danger"?"fixed inset-0 bg-black/20":"fixed inset-0 bg-black/80 backdrop-blur-sm";return g.jsx(zn,{show:!0,as:P.Fragment,children:g.jsxs(ar,{onClose:c,className:"relative z-[200]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:w()})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"relative bg-[#0f111a]/95 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl max-w-sm w-full",children:[g.jsx("button",{onClick:c,className:"absolute top-3 right-3 p-1 rounded hover:bg-white/5 text-zinc-600 hover:text-zinc-400 transition-colors z-10",children:g.jsx(Ba,{size:14})}),g.jsxs("div",{className:"flex gap-3 p-5 pb-4",children:[g.jsx("div",{className:"flex-shrink-0 mt-0.5",children:b()}),g.jsxs("div",{className:"flex-1 min-w-0",children:[t&&g.jsx(ar.Title,{className:"text-sm font-semibold text-zinc-100 mb-1.5",children:t}),g.jsx(ar.Description,{className:"text-xs text-zinc-400 leading-relaxed break-words",children:e})]})]}),o&&g.jsx("div",{className:"px-5 pb-3",children:g.jsx("input",{ref:m,type:"text",value:h,onChange:_=>f(_.target.value),placeholder:`请输入"${l}"`,className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-lg text-xs text-zinc-100 placeholder-zinc-600 outline-none focus:border-rose-500/50 focus:ring-1 focus:ring-rose-500/20 transition-all"})}),g.jsx("div",{className:`flex gap-2 px-5 pb-4 pt-2 ${s?"flex-col":"justify-end"}`,children:s&&d?g.jsxs(g.Fragment,{children:[g.jsx("button",{onClick:d,className:"w-full px-3 py-2 rounded-lg text-xs font-bold bg-rose-600 hover:bg-rose-700 text-white transition-colors",children:s}),g.jsx("button",{onClick:u,disabled:!x,className:"w-full px-3 py-2 rounded-lg text-xs font-medium bg-zinc-700 hover:bg-zinc-600 text-zinc-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i}),g.jsx("button",{onClick:c,className:"w-full px-3 py-2 rounded-lg text-xs font-medium bg-zinc-800 hover:bg-zinc-700 text-zinc-400 transition-colors",children:a})]}):g.jsxs(g.Fragment,{children:[n==="confirm"&&g.jsx("button",{onClick:c,className:"px-4 py-2 rounded-lg text-xs font-medium bg-zinc-800 hover:bg-zinc-700 text-zinc-300 transition-colors",children:a}),g.jsx("button",{onClick:u,disabled:!x,className:`px-4 py-2 rounded-lg text-xs font-bold transition-colors ${y()}`,children:i})]})})]})})})]})})},Mut=({title:t,message:e,defaultValue:n="",placeholder:r="",confirmText:i="确定",cancelText:a="取消",onConfirm:s,onCancel:o})=>{const[l,u]=P.useState(n),c=P.useRef(null);P.useEffect(()=>{c.current?.focus(),c.current?.select()},[]);const d=h=>{h.preventDefault(),l.trim()&&s(l.trim())};return g.jsx(zn,{show:!0,as:P.Fragment,children:g.jsxs(ar,{onClose:o,className:"relative z-[200]",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"relative bg-[#0f111a]/95 backdrop-blur-2xl border border-white/10 rounded-2xl shadow-2xl max-w-md w-full p-6",children:[g.jsx("button",{onClick:o,className:"absolute top-3 right-3 p-1 rounded hover:bg-white/5 text-zinc-600 hover:text-zinc-400 transition-colors",children:g.jsx(Ba,{size:14})}),g.jsxs("form",{onSubmit:d,children:[g.jsx(ar.Title,{className:"text-base font-semibold text-zinc-100 mb-2",children:t}),e&&g.jsx(ar.Description,{className:"text-sm text-zinc-400 mb-4",children:e}),g.jsx("input",{ref:c,type:"text",value:l,onChange:h=>u(h.target.value),placeholder:r,className:"w-full px-3 py-2 bg-zinc-800 border border-white/10 rounded-lg text-sm text-zinc-100 placeholder-zinc-600 outline-none focus:border-sky-500/50 focus:ring-1 focus:ring-sky-500/20 transition-all"}),g.jsxs("div",{className:"flex gap-3 mt-6 justify-end",children:[g.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 rounded-lg text-sm font-medium bg-zinc-800 hover:bg-zinc-700 text-zinc-300 transition-colors",children:a}),g.jsx("button",{type:"submit",disabled:!l.trim(),className:"px-4 py-2 rounded-lg text-sm font-bold bg-sky-600 hover:bg-sky-700 text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i})]})]})]})})})]})})},Aut=({currentType:t,nodes:e,onSelectType:n,onClose:r,position:i})=>{const a=P.useMemo(()=>{const u={fact:0,assumption:0,risk:0,goal:0,question:0};return e.forEach(c=>{u[c.type]!==void 0&&u[c.type]++}),u},[e]);P.useEffect(()=>{const u=c=>{if(c.key==="Escape"){c.preventDefault(),r();return}const h={1:"fact",2:"assumption",3:"risk",4:"goal",5:"question"}[c.key];h&&(c.preventDefault(),n(h),r())};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[n,r]);const s=i?{position:"absolute",left:`${i.x}px`,top:`${i.y-80}px`,transform:"translateX(-50%)"}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},o=["fact","assumption","risk","goal","question"],l=g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-[150]",onClick:r}),g.jsx("div",{className:"z-[200] bg-zinc-900/95 backdrop-blur-xl border border-white/10 rounded-lg shadow-xl p-1.5 min-w-[160px]",style:s,onClick:u=>u.stopPropagation(),children:g.jsx("div",{className:"space-y-0.5",children:o.map((u,c)=>{const d=Mi[u],h=a[u],f=d.icon;return g.jsxs("button",{onClick:()=>{n(u),r()},className:`
                  w-full flex items-center gap-2 px-2 py-1.5 rounded text-[10px] transition-all
                  ${t===u?`bg-white/10 ${d.color}`:`${d.color} opacity-50 hover:opacity-100 hover:bg-white/5`}
                `,children:[g.jsx("span",{className:"w-2 text-center text-[9px] opacity-40",children:c+1}),g.jsx(f,{size:11}),g.jsx("span",{className:"flex-1 text-left",children:d.label}),h>0&&g.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-black/20 opacity-60",children:h})]},u)})})})]});return Vu.createPortal(l,document.body)},kut=({nodes:t,transform:e,canvasSize:n,onTransformChange:r,currentTheme:i,onClose:a})=>{const[s,o]=P.useState(!1),[l,u]=P.useState(!1),c=P.useRef(null),d=l?240:180,h=l?180:135,f=10,m=Xt.useMemo(()=>{if(t.length===0)return{minX:0,maxX:1e3,minY:0,maxY:1e3};let k=1/0,I=-1/0,N=1/0,D=-1/0;t.forEach(L=>{k=Math.min(k,L.px),I=Math.max(I,L.px),N=Math.min(N,L.py),D=Math.max(D,L.py)});const F=200;return{minX:k-F,maxX:I+F,minY:N-F,maxY:D+F}},[t]),x=m.maxX-m.minX,b=m.maxY-m.minY,y=Math.min((d-f*2)/x,(h-f*2)/b),w=(k,I)=>({x:(k-m.minX)*y+f,y:(I-m.minY)*y+f}),_=(k,I)=>({x:(k-f)/y+m.minX,y:(I-f)/y+m.minY}),S=Xt.useMemo(()=>{const k=n.width/e.scale,I=n.height/e.scale,N=-e.x/e.scale+k/2,D=-e.y/e.scale+I/2,F=w(N-k/2,D-I/2),L=w(N+k/2,D+I/2);return{x:F.x,y:F.y,width:L.x-F.x,height:L.y-F.y}},[e,n,m,y]),M=k=>{if(!c.current)return;const I=c.current.getBoundingClientRect(),N=k.clientX-I.left,D=k.clientY-I.top;o(!0),R(N,D)},E=k=>{if(!s||!c.current)return;const I=c.current.getBoundingClientRect(),N=k.clientX-I.left,D=k.clientY-I.top;R(N,D)},C=()=>{o(!1)},R=(k,I)=>{const N=_(k,I),D=n.width/e.scale,F=n.height/e.scale,L={x:-(N.x-D/2)*e.scale,y:-(N.y-F/2)*e.scale,scale:e.scale};r(L)};return P.useEffect(()=>{if(s){const k=()=>o(!1);return window.addEventListener("pointerup",k),()=>window.removeEventListener("pointerup",k)}},[s]),g.jsxs("div",{className:`fixed bottom-4 right-4 z-50 rounded-lg shadow-2xl transition-all ${s?"cursor-grabbing":"cursor-grab"}`,style:{width:`${d}px`,height:`${h+32}px`,background:`${i.colors.nodeBg}f0`,backdropFilter:"blur(20px)",border:`1px solid ${i.colors.borderPrimary}`},children:[g.jsxs("div",{className:"h-8 flex items-center justify-between px-2 border-b",style:{borderColor:i.colors.borderPrimary},children:[g.jsx("span",{className:"text-[10px] font-medium",style:{color:i.colors.textSecondary},children:"导航图"}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("button",{onClick:()=>u(!l),className:"p-1 rounded hover:bg-white/10 transition-all",style:{color:i.colors.textSecondary},title:l?"缩小":"放大",children:l?g.jsx(Kot,{size:12}):g.jsx(Yot,{size:12})}),a&&g.jsx("button",{onClick:a,className:"p-1 rounded hover:bg-white/10 transition-all",style:{color:i.colors.textSecondary},title:"关闭",children:g.jsx(Ba,{size:12})})]})]}),g.jsxs("div",{ref:c,className:"relative overflow-hidden",style:{width:`${d}px`,height:`${h}px`,background:`${i.colors.canvasBg}80`},onPointerDown:M,onPointerMove:E,onPointerUp:C,children:[g.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:`
              linear-gradient(${i.colors.lineColor} 1px, transparent 1px),
              linear-gradient(90deg, ${i.colors.lineColor} 1px, transparent 1px)
            `,backgroundSize:`${20*y}px ${20*y}px`,backgroundPosition:`${f}px ${f}px`}}),g.jsxs("svg",{width:d,height:h,className:"absolute inset-0",children:[t.map(k=>{const I=t.find(F=>F.id===k.parent);if(!I)return null;const N=w(I.px,I.py),D=w(k.px,k.py);return g.jsx("line",{x1:N.x,y1:N.y,x2:D.x,y2:D.y,stroke:i.colors.lineColor,strokeWidth:"1",opacity:"0.3"},`link-${k.id}`)}),t.map(k=>{const I=w(k.px,k.py),N=Mi[k.type];return g.jsx("circle",{cx:I.x,cy:I.y,r:3,fill:N.colorValue,opacity:"0.8"},k.id)})]}),g.jsx("div",{className:"absolute border-2 pointer-events-none",style:{left:`${Math.max(0,Math.min(S.x,d))}px`,top:`${Math.max(0,Math.min(S.y,h))}px`,width:`${Math.max(0,Math.min(S.width,d-S.x))}px`,height:`${Math.max(0,Math.min(S.height,h-S.y))}px`,borderColor:i.colors.textPrimary,background:`${i.colors.textPrimary}10`}})]}),g.jsxs("div",{className:"absolute bottom-1 left-0 right-0 text-center text-[9px] opacity-60",style:{color:i.colors.textSecondary},children:[t.length," 节点"]})]})},Iut=[{id:"free",title:"拓扑模式",subtitle:"自由拓扑连线（曲线）"},{id:"tree",title:"树状模式",subtitle:"层级树形排布（曲线）"},{id:"orthogonal",title:"直角线模式",subtitle:"连线改为直角折线（更干净）"}];function Nut({isOpen:t,value:e,onClose:n,onChange:r}){return P.useEffect(()=>{if(!t)return;const i=a=>{a.key==="Escape"&&n()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[t,n]),t?g.jsxs("div",{className:"fixed inset-0 z-[170] md:z-[160]",onMouseDown:n,children:[g.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),g.jsxs("div",{className:"absolute left-0 right-0 bottom-0 rounded-t-2xl border border-white/10 bg-slate-900/95 backdrop-blur-xl shadow-2xl",onMouseDown:i=>i.stopPropagation(),children:[g.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10",children:[g.jsxs("div",{className:"flex items-center gap-2 text-slate-200",children:[g.jsx(IN,{size:14,className:"text-slate-400"}),g.jsx("span",{className:"text-sm font-medium",children:"画布风格"})]}),g.jsx("button",{onClick:n,className:"p-1.5 rounded hover:bg-white/10 text-slate-400 hover:text-slate-200 transition-colors",title:"关闭",children:g.jsx(Ba,{size:14})})]}),g.jsx("div",{className:"p-3 pb-5 space-y-2",children:Iut.map(i=>{const a=e===i.id;return g.jsxs("button",{onClick:()=>{r(i.id),n()},className:`w-full text-left px-4 py-3 rounded-xl border transition-all ${a?"bg-white/10 border-white/15 text-slate-100":"bg-white/5 border-white/10 text-slate-200 hover:bg-white/8"}`,children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("div",{className:"text-sm font-medium",children:i.title}),a&&g.jsx("span",{className:"text-[11px] text-slate-400",children:"当前"})]}),g.jsx("div",{className:"text-xs text-slate-400 mt-1",children:i.subtitle})]},i.id)})})]})]}):null}const Rut=({node:t,currentTheme:e,activeUniverseId:n,onUpdate:r,onNoteUpdate:i,onTypeChange:a,onClose:s,onDelete:o,onDeconstructNode:l,onStartReconnect:u,onMergeSubtree:c,onInjectParadigm:d,onExportNodeToMemory:h,onDistillToCard:f})=>{const[m,x]=P.useState(!1),[b,y]=P.useState(!1),w=P.useRef(null),_=P.useRef(null),S=P.useRef(null),[M,E]=P.useState(70),[C,R]=P.useState(!1),[k,I]=P.useState(0),[N,D]=P.useState(70);P.useEffect(()=>{const L=q=>{_.current?.contains(q.target)&&(R(!0),I(q.touches[0].clientY),D(M),Wn("light"))},U=q=>{if(!C)return;q.preventDefault();const Z=k-q.touches[0].clientY,Q=window.innerHeight,z=Math.min(90,Math.max(30,N+Z/Q*100));E(z)},j=()=>{R(!1)};return document.addEventListener("touchstart",L),document.addEventListener("touchmove",U,{passive:!1}),document.addEventListener("touchend",j),()=>{document.removeEventListener("touchstart",L),document.removeEventListener("touchmove",U),document.removeEventListener("touchend",j)}},[C,k,N,M]);const F=({type:L,onChange:U})=>{const[j,q]=P.useState(!1);return g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>{q(!j),Wn("light")},className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`},children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:Mi[L].colorValue}}),g.jsx("span",{className:"text-xs font-medium",style:{color:e.colors.textPrimary},children:Mi[L].label})]}),j&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-[200]",onClick:()=>q(!1)}),g.jsx("div",{className:"absolute bottom-full left-0 mb-2 z-[210] rounded-lg shadow-2xl overflow-hidden min-w-[120px]",style:{background:e.colors.nodeBg,border:`1px solid ${e.colors.borderPrimary}`},children:Object.entries(Mi).map(([Z,Q])=>g.jsxs("button",{onClick:()=>{U(Z),q(!1),Wn("light")},className:"w-full flex items-center gap-2 px-3 py-2 text-left transition-all active:bg-white/10",style:{color:e.colors.textSecondary},children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:Q.colorValue}}),g.jsx("span",{className:"text-xs",children:Q.label})]},Z))})]})]})};return g.jsxs("div",{ref:w,className:"fixed left-0 right-0 z-[100] flex flex-col rounded-t-3xl shadow-2xl animate-slide-up",style:{bottom:0,height:`${M}vh`,background:`${e.colors.sidebarBg}f8`,backdropFilter:"blur(20px)",borderTop:`1px solid ${e.colors.borderPrimary}`,animation:"slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},children:[g.jsx("div",{ref:_,className:"w-full flex justify-center py-2 cursor-grab active:cursor-grabbing",children:g.jsx("div",{className:"w-12 h-1 rounded-full",style:{background:`${e.colors.textSecondary}40`}})}),g.jsxs("div",{className:"flex items-center justify-between px-3 pb-2",style:{borderColor:e.colors.borderPrimary},children:[g.jsx(F,{type:t.type,onChange:L=>a(t.id,L)}),g.jsxs("div",{className:"flex items-center gap-1",children:[n!=="u1"&&c&&g.jsx("button",{onClick:()=>{c(t.id),Wn("medium")},className:"px-2.5 py-1.5 rounded-lg text-xs transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary},children:"归并"}),g.jsxs("div",{className:"relative",children:[g.jsx("button",{onClick:()=>{y(!b),Wn("light")},className:"p-1.5 rounded-lg transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary},children:g.jsx(pP,{size:16})}),b&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 z-[200]",onClick:()=>y(!1)}),g.jsx("div",{className:"absolute top-full right-0 mt-1 z-[210] rounded-lg shadow-2xl overflow-hidden min-w-[100px]",style:{background:e.colors.nodeBg,border:`1px solid ${e.colors.borderPrimary}`},children:g.jsxs("button",{onClick:()=>{confirm("确定删除此节点？")&&(o(t.id),Wn("medium")),y(!1)},className:"w-full flex items-center gap-2 px-3 py-2.5 text-left transition-all active:bg-white/10",style:{color:"#ef4444"},children:[g.jsx(yP,{size:14}),g.jsx("span",{className:"text-xs",children:"删除"})]})})]})]}),g.jsx("button",{onClick:()=>{s(),Wn("light")},className:"p-1.5 rounded-lg transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary},children:g.jsx(Ba,{size:16})})]})]}),g.jsxs("div",{className:"flex-1 overflow-y-auto px-3 py-2 space-y-3",children:[g.jsxs("div",{children:[g.jsx("label",{className:"text-[9px] uppercase tracking-wider mb-1.5 block",style:{color:e.colors.textSecondary},children:"节点内容"}),g.jsx("textarea",{ref:S,value:t.text,onChange:L=>r(t.id,L.target.value),placeholder:"输入节点内容...",className:"w-full px-3 py-2 rounded-lg text-sm placeholder-zinc-600 outline-none focus:ring-1 transition-all resize-none",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textPrimary,minHeight:"80px"},rows:3})]}),g.jsxs("div",{children:[g.jsxs("label",{className:"text-[9px] uppercase tracking-wider mb-1.5 flex items-center gap-1",style:{color:e.colors.textSecondary},children:[g.jsx(vP,{size:10,className:"text-amber-500/70"}),"笔记"]}),g.jsx("textarea",{value:t.note||"",onChange:L=>i(t.id,L.target.value),placeholder:"添加笔记...",className:"w-full px-3 py-2 rounded-lg text-xs placeholder-zinc-600 outline-none focus:ring-1 transition-all resize-none",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary,minHeight:"60px"},rows:2})]}),g.jsxs("div",{children:[g.jsx("div",{className:"flex items-center justify-between mb-2",children:g.jsx("label",{className:"text-[9px] uppercase tracking-wider",style:{color:e.colors.textSecondary},children:"快捷操作"})}),g.jsxs("div",{className:"flex gap-1.5 overflow-x-auto pb-1 -mx-3 px-3 no-scrollbar",children:[Object.entries(Mi).map(([L,U])=>{const j=U.icon;return g.jsxs("button",{onClick:()=>{l(t.id,L),Wn("light")},className:"flex flex-col items-center gap-0.5 px-3 py-1.5 rounded-lg transition-all active:scale-95 min-w-[56px] flex-shrink-0",style:{background:`${U.colorValue}15`,border:`1px solid ${U.colorValue}30`,color:U.colorValue},children:[g.jsx(j,{size:14}),g.jsxs("span",{className:"text-[9px]",children:["+",U.label]})]},L)}),g.jsxs("button",{onClick:()=>{u(t.id),Wn("light")},className:"flex flex-col items-center gap-0.5 px-3 py-1.5 rounded-lg transition-all active:scale-95 min-w-[56px] flex-shrink-0",style:{background:`${e.colors.nodeBg}60`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary},children:[g.jsx(qot,{size:14}),g.jsx("span",{className:"text-[9px]",children:"重连"})]})]})]}),(h||f)&&g.jsxs("div",{className:"space-y-1.5",children:[h&&g.jsx("button",{onClick:()=>{h(),Wn("medium")},className:"w-full py-2.5 rounded-lg flex items-center justify-center gap-2 text-xs transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textPrimary},children:"💭 导出为记忆"}),f&&g.jsx("button",{onClick:()=>{f(),Wn("medium")},className:"w-full py-2.5 rounded-lg flex items-center justify-center gap-2 text-xs transition-all active:scale-95",style:{background:`${e.colors.nodeBg}80`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textPrimary},children:"📚 提炼为卡片"})]}),g.jsxs("div",{children:[g.jsxs("button",{onClick:()=>{x(!m),Wn("light")},className:"w-full flex items-center justify-between py-1.5 text-[9px] uppercase tracking-wider",style:{color:e.colors.textSecondary},children:[g.jsxs("span",{className:"flex items-center gap-1",children:[g.jsx(i_,{size:10,className:`transition-transform ${m?"rotate-90":""}`}),"范式注入"]}),g.jsxs("span",{className:"text-[8px] opacity-60",children:[Xo.length," 个"]})]}),m&&g.jsx("div",{className:"space-y-1.5 mt-1.5 max-h-[180px] overflow-y-auto",children:Xo.map((L,U)=>g.jsxs("button",{onClick:()=>{d(U),Wn("medium")},className:"w-full flex items-center justify-between px-2.5 py-2 rounded-lg text-xs transition-all active:scale-95",style:{background:`${e.colors.nodeBg}60`,border:`1px solid ${e.colors.borderPrimary}`,color:e.colors.textSecondary},children:[g.jsx("span",{children:L.name}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(pce,{description:L.useCase}),g.jsx(kN,{size:12})]})]},U))})]})]}),g.jsx("div",{className:"h-[env(safe-area-inset-bottom)]"})]})},Put=({nodes:t,arenaId:e,arenaTitle:n,onDistill:r,onClose:i})=>{const a=P.useMemo(()=>t.find(y=>y.parent===null),[t]),s=P.useMemo(()=>{const y={};return t.forEach(w=>{w.parent!==null&&(y[w.type]=(y[w.type]||0)+1)}),y},[t]),o=Object.values(s).reduce((y,w)=>y+w,0),l=P.useMemo(()=>{if(!a)return"推演总结";const y=a.text.replace(/[？?。!！]+$/,"").trim();return a.text.includes("?")||a.text.includes("？")?y.startsWith("为什么")||y.startsWith("为何")?y.replace(/^(为什么|为何)/,"")+"的原因分析":y.startsWith("如何")||y.startsWith("怎么")||y.startsWith("怎样")?y.replace(/^(如何|怎么|怎样)/,"")+"的方法":y.startsWith("是否")||y.startsWith("能否")?y.replace(/^(是否|能否)/,"")+"的判断":`关于「${y.slice(0,20)}${y.length>20?"...":""}」的分析`:y.length>30?y.slice(0,30)+"...":y},[a]),u=P.useMemo(()=>{if(!a)return"";let y="";y+=`## 核心命题

${a.text}

`;const w={fact:"已知事实",assumption:"假设与前提",risk:"风险与挑战",goal:"目标与愿景",question:"待解问题"};return["fact","goal","assumption","risk","question"].forEach(S=>{const M=t.filter(E=>E.type===S&&E.parent!==null);M.length>0&&(y+=`## ${w[S]||Mi[S]?.label||S}

`,M.forEach(E=>{y+=`- ${E.text}`,E.note&&E.note.trim()&&(y+=`
  > ${E.note.trim().replace(/\n/g,`
  > `)}`),y+=`
`}),y+=`
`)}),o>0&&(y+=`---

*本分析包含 ${o} 个思维节点*
`),y.trim()},[t,a,o]),[c,d]=P.useState(l),[h,f]=P.useState(u),[m,x]=P.useState(!1),b=async()=>{if(!(!c.trim()||!h.trim())){x(!0);try{await r(e,{title:c.trim(),content:h.trim()}),i()}catch(y){console.error("提炼失败:",y)}finally{x(!1)}}};return g.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:g.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col",children:[g.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Dh,{size:16,className:"text-cyan-400"}),g.jsx("span",{className:"text-sm font-medium text-slate-200",children:"提炼为卡片"}),o>0&&g.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-white/5 text-slate-500 rounded",children:[o," 节点"]})]}),g.jsx("button",{onClick:i,className:"p-1 hover:bg-white/10 rounded text-slate-500 hover:text-slate-300 transition-colors",children:g.jsx(Ba,{size:14})})]}),g.jsxs("div",{className:"p-5 flex-1 overflow-y-auto space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"block text-[10px] text-slate-500 uppercase tracking-wider mb-1.5",children:"标题"}),g.jsx("input",{type:"text",value:c,onChange:y=>d(y.target.value),className:"w-full px-3 py-2 bg-slate-800/50 border border-white/10 rounded-lg text-sm text-white focus:outline-none focus:border-cyan-500/50 transition-colors",placeholder:"输入卡片标题..."})]}),g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-[10px] text-slate-500 uppercase tracking-wider mb-1.5",children:"内容（Markdown）"}),g.jsx("textarea",{value:h,onChange:y=>f(y.target.value),className:"w-full h-72 px-3 py-2 bg-slate-800/50 border border-white/10 rounded-lg text-[13px] text-slate-300 font-mono leading-relaxed resize-none focus:outline-none focus:border-cyan-500/50 transition-colors",placeholder:"编辑卡片内容..."})]})]}),g.jsxs("div",{className:"px-5 py-4 border-t border-white/5 flex justify-end gap-2",children:[g.jsx("button",{onClick:i,disabled:m,className:"px-4 py-2 text-xs text-slate-400 hover:text-slate-300 transition-colors disabled:opacity-50",children:"取消"}),g.jsxs("button",{onClick:b,disabled:m||!c.trim()||!h.trim(),className:"flex items-center gap-1.5 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-xs font-medium text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[g.jsx(o2,{size:12}),m?"提炼中...":"确认提炼"]})]})]})})};function Dut({markdown:t,title:e="导出预览",onClose:n}){const[r,i]=P.useState(!1),a=P.useCallback(async()=>{try{await navigator.clipboard.writeText(t),i(!0),setTimeout(()=>i(!1),2e3)}catch(l){console.error("复制失败:",l)}},[t]),s=t.split(`
`).length,o=t.length;return g.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:g.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col",children:[g.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-white/5",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Dh,{size:14,className:"text-slate-400"}),g.jsx("span",{className:"text-sm font-medium text-slate-200",children:e}),g.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-white/5 text-slate-500 rounded",children:[s," 行 · ",o," 字符"]})]}),g.jsx("button",{onClick:n,className:"p-1 hover:bg-white/10 rounded text-slate-500 hover:text-slate-300 transition-colors",children:g.jsx(Ba,{size:14})})]}),g.jsx("div",{className:"flex-1 overflow-hidden p-4",children:g.jsx("pre",{className:"w-full h-full overflow-auto p-4 bg-slate-800/50 border border-white/5 rounded-lg text-[12px] text-slate-300 font-mono leading-relaxed whitespace-pre-wrap",children:t})}),g.jsxs("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[g.jsx("span",{className:"text-[10px] text-slate-600",children:"Markdown 格式 · 可粘贴到任意支持 Markdown 的编辑器"}),g.jsx("button",{onClick:a,className:`flex items-center gap-1.5 px-4 py-2 rounded-lg text-xs font-medium transition-all ${r?"bg-emerald-600 text-white":"bg-white/10 hover:bg-white/15 text-slate-300"}`,children:r?g.jsxs(g.Fragment,{children:[g.jsx(Gh,{size:12}),"已复制"]}):g.jsxs(g.Fragment,{children:[g.jsx(fP,{size:12}),"复制到剪贴板"]})})]})]})})}const vX="thineasy_arena_v2_ai_toolbar_pos_v1";function yX(t,e,n){return Math.min(n,Math.max(e,t))}function Out({aiEnabled:t,brainIndicator:e,isLoading:n=!1,loadingType:r=null,onConflict:i,onBlindspot:a,onParadigm:s,onExportReport:o,hasParadigmCache:l=!1,hasBlindspotCache:u=!1,hasConflictCache:c=!1,onLoadCache:d,thinkingDice:h}){const f=P.useRef(null),[m,x]=P.useState(!1),[b,y]=P.useState(!1),[w,_]=P.useState(()=>{try{const R=localStorage.getItem(vX);if(!R)return{x:12,y:72};const k=JSON.parse(R);return typeof k.x!="number"||typeof k.y!="number"?{x:12,y:72}:{x:k.x,y:k.y}}catch{return{x:12,y:72}}}),S=P.useRef({dragging:!1,startX:0,startY:0,baseX:0,baseY:0}),M=P.useCallback(R=>{_(R);try{localStorage.setItem(vX,JSON.stringify(R))}catch{}},[]),E=P.useCallback(R=>{R.preventDefault(),R.stopPropagation(),y(!0),S.current={dragging:!0,startX:R.clientX,startY:R.clientY,baseX:w.x,baseY:w.y}},[w.x,w.y]);P.useEffect(()=>{const R=I=>{if(!S.current.dragging)return;const N=I.clientX-S.current.startX,D=I.clientY-S.current.startY,F=(typeof window<"u"?window.innerWidth:1200)-320,L=(typeof window<"u"?window.innerHeight:800)-60;M({x:yX(S.current.baseX+N,8,F),y:yX(S.current.baseY+D,8,L)})},k=()=>{if(!S.current.dragging)return;S.current.dragging=!1,y(!1);const I=24,N=8,D=f.current?.getBoundingClientRect();if(!D)return;const F=typeof window<"u"?window.innerWidth:1200,L=typeof window<"u"?window.innerHeight:800,U=D.width,j=D.height,q=w.x,Z=F-(w.x+U),Q=w.y,z=L-(w.y+j),W=[{edge:"left",dist:Math.abs(q)},{edge:"right",dist:Math.abs(Z)},{edge:"top",dist:Math.abs(Q)},{edge:"bottom",dist:Math.abs(z)}];W.sort((H,J)=>H.dist-J.dist);const X=W[0];if(!(!X||X.dist>I)){if(X.edge==="left"){M({x:N,y:w.y});return}if(X.edge==="right"){M({x:Math.max(N,F-U-N),y:w.y});return}if(X.edge==="top"){M({x:w.x,y:N});return}M({x:w.x,y:Math.max(N,L-j-N)})}};return document.addEventListener("mousemove",R),document.addEventListener("mouseup",k),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",k)}},[w.x,w.y,M]),P.useEffect(()=>{if(!m)return;const R=k=>{const I=k.target;I&&(f.current&&f.current.contains(I)||x(!1))};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[m]);const C=P.useMemo(()=>t?"":"（规则模式）",[t]);return g.jsxs("div",{ref:f,className:"fixed z-[140] pointer-events-auto",style:{left:w.x,top:w.y},onMouseDown:R=>R.stopPropagation(),children:[g.jsxs("div",{className:`group flex items-center gap-1.5 rounded-xl border backdrop-blur-xl shadow-xl px-2.5 py-2 transition-all ${m||b?"border-white/12 bg-slate-900/85":"border-white/8 bg-slate-900/45"}`,children:[g.jsx("button",{className:`p-1 rounded transition-colors cursor-move ${m||b?"bg-white/10 text-slate-300":"text-slate-500 hover:text-slate-300 hover:bg-white/10"}`,title:"拖动面板",onMouseDown:E,children:g.jsx(Zue,{size:12})}),g.jsx("div",{className:"pl-0.5 pr-1",title:`AI 状态${C}`,children:e}),g.jsx("button",{onClick:i,disabled:n,className:`px-2 py-1 rounded-md text-[11px] transition-colors disabled:opacity-50 ${m||b?"bg-white/10 text-slate-200 hover:bg-white/15":"bg-white/5 text-slate-300 hover:bg-white/10 group-hover:bg-white/10 group-hover:text-slate-200"}`,title:"冲突测试",children:g.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[g.jsx(s2,{size:12,className:"text-red-400/70"}),n&&r==="conflict"?"分析中…":"冲突"]})}),g.jsx("button",{onClick:a,disabled:n,className:`px-2 py-1 rounded-md text-[11px] transition-colors disabled:opacity-50 ${m||b?"bg-white/10 text-slate-200 hover:bg-white/15":"bg-white/5 text-slate-300 hover:bg-white/10 group-hover:bg-white/10 group-hover:text-slate-200"}`,title:"盲点扫描",children:g.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[g.jsx(l2,{size:12,className:"text-amber-400/70"}),n&&r==="blindspot"?"分析中…":"盲点"]})}),g.jsx("button",{onClick:()=>x(R=>!R),className:`p-1.5 rounded-md transition-colors ${m?"bg-white/10 text-slate-200":"text-slate-500 hover:text-slate-300 hover:bg-white/10 group-hover:text-slate-200"}`,title:"更多",children:g.jsx(pP,{size:14})})]}),m&&g.jsxs("div",{className:"mt-2 w-[320px] max-w-[90vw] rounded-xl border border-white/10 bg-slate-900/80 backdrop-blur-xl shadow-2xl overflow-hidden",children:[g.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",children:[g.jsx("div",{className:"text-[10px] text-slate-400",children:"更多"}),g.jsx("button",{onClick:()=>x(!1),className:"p-1 rounded hover:bg-white/10 text-slate-500 hover:text-slate-300 transition-colors",title:"关闭",children:g.jsx(Ba,{size:12})})]}),g.jsxs("div",{className:"p-3 space-y-2",children:[g.jsx("button",{onClick:()=>{x(!1),s()},disabled:n,className:"w-full px-3 py-2 rounded-lg text-[12px] bg-white/5 text-slate-300 hover:bg-white/10 transition-colors disabled:opacity-50",children:"范式推荐"}),g.jsx("button",{onClick:()=>{x(!1),o()},className:"w-full px-3 py-2 rounded-lg text-[12px] bg-white/5 text-slate-300 hover:bg-white/10 transition-colors",children:g.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[g.jsx(Dh,{size:12,className:"text-slate-400"}),"生成报告"]})}),(l||u||c)&&g.jsxs("div",{className:"pt-1",children:[g.jsx("div",{className:"text-[10px] text-slate-500 mb-1",children:"查看上次结果"}),g.jsxs("div",{className:"flex gap-1.5",children:[l&&g.jsx("button",{onClick:()=>{x(!1),d?.("paradigm")},className:"flex-1 px-2 py-1.5 rounded-md text-[11px] bg-white/5 text-slate-300 hover:bg-white/10 transition-colors",children:"范式"}),u&&g.jsx("button",{onClick:()=>{x(!1),d?.("blindspot")},className:"flex-1 px-2 py-1.5 rounded-md text-[11px] bg-white/5 text-slate-300 hover:bg-white/10 transition-colors",children:"盲点"}),c&&g.jsx("button",{onClick:()=>{x(!1),d?.("conflict")},className:"flex-1 px-2 py-1.5 rounded-md text-[11px] bg-white/5 text-slate-300 hover:bg-white/10 transition-colors",children:"冲突"})]})]}),h&&g.jsxs("div",{className:"pt-1",children:[g.jsx("div",{className:"text-[10px] text-slate-500 mb-1",children:"催化"}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("div",{className:"text-[11px] text-slate-400",children:"思维骰子"}),h]})]})]})]})]})}const xX=[{id:"p1",category:"视角",title:"导师视角",description:"假设你最钦佩的导师正在审视这个问题",question:"他/她会注意到什么被忽略的关键点？",color:"purple"},{id:"p2",category:"视角",title:"对手视角",description:"从最强竞争对手或反对者的角度看",question:"他们会如何攻击这个方案的弱点？",color:"purple"},{id:"p3",category:"视角",title:"新手视角",description:"假设一个完全不了解背景的人来看",question:'他们会问什么"愚蠢"但关键的问题？',color:"purple"},{id:"p4",category:"视角",title:"用户视角",description:"从最终受影响者的角度思考",question:"他们真正关心的是什么？",color:"purple"},{id:"t1",category:"时间",title:"10年后",description:"假设现在是10年后，回顾今天的决定",question:"哪些当初认为重要的其实不重要？",color:"cyan"},{id:"t2",category:"时间",title:"极限时间",description:"假设只剩下1/10的时间来完成",question:"什么是绝对必须保留的核心？",color:"cyan"},{id:"t3",category:"时间",title:"慢动作",description:"把整个过程放慢100倍来观察",question:"哪个瞬间的决定导致了现在的局面？",color:"cyan"},{id:"e1",category:"极端",title:"无限资源",description:"假设你拥有无限的时间、金钱和人力",question:"理想状态是什么样的？",color:"amber"},{id:"e2",category:"极端",title:"从零开始",description:"假设一切归零，需要重新开始",question:"你会保留什么？以什么方式重建？",color:"amber"},{id:"e3",category:"极端",title:"最不可能",description:"假设那个你认为绝不可能的事情发生了",question:"会带来什么连锁反应？",color:"amber"},{id:"r1",category:"关系",title:"因果反转",description:"把原因和结果的位置互换",question:"如果结果先发生，需要什么条件？",color:"emerald"},{id:"r2",category:"关系",title:"强制组合",description:"把两个看似无关的要素强行关联",question:"它们之间可能存在什么隐藏的联系？",color:"emerald"},{id:"r3",category:"关系",title:"删除核心",description:"移除你认为最核心的那个要素",question:"系统还能运转吗？",color:"emerald"},{id:"c1",category:"约束",title:"减半法则",description:"只能用一半的资源达到相同目标",question:"必须放弃什么？可以优化什么？",color:"rose"},{id:"c2",category:"约束",title:"单一要素",description:"如果只能保留一个核心功能或目标",question:"那个绝对不能放弃的是什么？",color:"rose"},{id:"i1",category:"逆向",title:"如何失败",description:"思考怎样才能让这件事彻底失败",question:'有哪些"必杀"的失败方法？',color:"red"},{id:"i2",category:"逆向",title:"完全相反",description:"做与当前计划完全相反的事",question:"相反的做法会带来什么意外收获？",color:"red"},{id:"i3",category:"逆向",title:"回避核心",description:"故意不去解决最明显的问题",question:"绕过这个问题后，会发现什么新路径？",color:"red"}];function Lut(t){const e=t?xX.filter(n=>n.id!==t):xX;return e[Math.floor(Math.random()*e.length)]}const bX={purple:{bg:"bg-purple-500/10",text:"text-purple-400",border:"border-purple-500/20"},cyan:{bg:"bg-cyan-500/10",text:"text-cyan-400",border:"border-cyan-500/20"},amber:{bg:"bg-amber-500/10",text:"text-amber-400",border:"border-amber-500/20"},emerald:{bg:"bg-emerald-500/10",text:"text-emerald-400",border:"border-emerald-500/20"},rose:{bg:"bg-rose-500/10",text:"text-rose-400",border:"border-rose-500/20"},red:{bg:"bg-red-500/10",text:"text-red-400",border:"border-red-500/20"}},Fut=8;function _X({selectedNode:t,onAddAsNode:e,className:n=""}){const[r,i]=P.useState(!1),[a,s]=P.useState(null),[o,l]=P.useState(!1),[u,c]=P.useState(0),d=P.useRef(null);P.useEffect(()=>()=>{d.current&&clearInterval(d.current)},[]);const h=P.useCallback(()=>{c(Fut),d.current&&clearInterval(d.current),d.current=setInterval(()=>{c(w=>w<=1?(d.current&&(clearInterval(d.current),d.current=null),0):w-1)},1e3)},[]),f=P.useCallback(()=>{if(u>0||o)return;l(!0);let w=0;const _=setInterval(()=>{s(Lut(a?.id)),w++,w>=6&&(clearInterval(_),l(!1),h())},60)},[a?.id,u,o,h]),m=P.useCallback(()=>{i(!0),a||setTimeout(f,50)},[a,f]),x=P.useCallback(()=>{a&&e&&e(a.question,"question")},[a,e]),b=P.useCallback(()=>{a&&e&&e(`【${a.title}】${a.description}`,"assumption")},[a,e]),y=a?bX[a.color]:bX.purple;return g.jsxs("div",{className:`relative ${n}`,children:[g.jsx("button",{onClick:m,className:"p-1.5 rounded-md hover:bg-amber-500/10 text-slate-500 hover:text-amber-400 transition-all",title:"思维骰子",children:g.jsx(oX,{size:14})}),r&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[150]",onClick:()=>i(!1)}),g.jsxs("div",{className:`fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[340px] max-w-[90vw] 
                          bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl z-[151]
                          overflow-hidden`,children:[g.jsxs("div",{className:"flex items-center justify-between px-4 py-2.5 border-b border-white/5 bg-slate-800/50",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(oX,{size:14,className:"text-amber-400"}),g.jsx("span",{className:"text-xs font-medium text-slate-300",children:"思维骰子"})]}),g.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-white/10 rounded text-slate-500 hover:text-slate-300 transition-colors",children:g.jsx(Ba,{size:12})})]}),g.jsxs("div",{className:"p-4",children:[a&&g.jsxs("div",{className:`p-4 rounded-lg border ${y.bg} ${y.border} ${o?"animate-pulse":""}`,children:[g.jsx("span",{className:`text-[9px] font-medium uppercase tracking-widest ${y.text}`,children:a.category}),g.jsx("h3",{className:"text-base font-semibold text-slate-100 mt-1 mb-2",children:a.title}),g.jsx("p",{className:"text-[11px] text-slate-400 leading-relaxed mb-3",children:a.description}),g.jsxs("div",{className:"flex items-start gap-2 p-2.5 bg-slate-900/60 rounded-md border border-white/5",children:[g.jsx(cot,{size:12,className:"text-slate-600 mt-0.5 flex-shrink-0"}),g.jsx("p",{className:"text-xs text-slate-200 leading-relaxed",children:a.question})]})]}),t&&g.jsxs("div",{className:"mt-3 p-2 bg-slate-800/30 rounded-md border border-white/5",children:[g.jsx("p",{className:"text-[9px] text-slate-600 mb-0.5",children:"关联节点"}),g.jsx("p",{className:"text-[10px] text-slate-400 truncate",children:t.text})]})]}),g.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-white/5 bg-slate-800/30",children:[g.jsxs("div",{className:"flex gap-1.5",children:[g.jsxs("button",{onClick:x,disabled:!a,className:`flex items-center gap-1 px-2 py-1 text-[10px] bg-white/5 text-slate-400 
                             hover:bg-cyan-500/10 hover:text-cyan-400 rounded transition-colors disabled:opacity-40`,title:"添加问题为节点",children:[g.jsx(NN,{size:10}),"问题"]}),g.jsxs("button",{onClick:b,disabled:!a,className:`flex items-center gap-1 px-2 py-1 text-[10px] bg-white/5 text-slate-400 
                             hover:bg-purple-500/10 hover:text-purple-400 rounded transition-colors disabled:opacity-40`,title:"添加指令为节点",children:[g.jsx(NN,{size:10}),"指令"]})]}),g.jsxs("button",{onClick:f,disabled:o||u>0,className:`flex items-center gap-1.5 px-3 py-1.5 text-[10px] bg-amber-500/10 text-amber-400 
                           hover:bg-amber-500/20 rounded transition-colors disabled:opacity-40 disabled:cursor-not-allowed`,children:[g.jsx(gP,{size:11,className:o?"animate-spin":""}),u>0?`${u}s`:"再掷"]})]}),g.jsx("div",{className:"px-4 py-1.5 border-t border-white/5 text-[8px] text-slate-600 text-center",children:"骰子是指南针，不是方向盘"})]})]})]})}const mce={providers:{lmstudio:{models:["local-model"]},ollama:{models:["llama3"]},openai:{models:["gpt-4o","gpt-4o-mini"]},anthropic:{models:["claude-3-5-sonnet-20241022"]},google:{models:["gemini-pro"]},azure:{models:["gpt-4"]},bedrock:{models:["anthropic.claude-3-5-sonnet-20241022-v2:0"]},openrouter:{models:["anthropic/claude-3-5-sonnet"]}}};async function But(){try{const t=await Yh(()=>import("./ai-models.Dtd3WJ6k.js"),[]);return t.default||t}catch(t){return console.warn("[Models Config] Failed to load ai-models.json, using defaults:",t),mce}}let Ob=null,P6=null;async function Uut(){return Ob||(P6||(P6=But()),Ob=await P6,Ob)}async function zut(t){return(await Uut()).providers[t]?.models||[]}function jut(t){return mce.providers[t]?.models||[]}function wX({aiEnabled:t,onAIEnabledChange:e,onConfigChange:n,className:r=""}){const[i,a]=P.useState(uce),[s,o]=P.useState(null),[l,u]=P.useState(!1),[c,d]=P.useState(!1),[h,f]=P.useState(!1),[m,x]=P.useState(!1),[b,y]=P.useState([]),[w,_]=P.useState(""),S=P.useRef(null),M=t?l?"checking":s?.available?"connected":"disconnected":"disabled";P.useEffect(()=>{y(jut(i.provider)),zut(i.provider).then(j=>{j.length>0&&y(j)})},[i.provider]);const E=P.useCallback(async()=>{if(t){u(!0);try{const j=await Zlt();o(j)}catch{o({available:!1,provider:i.provider,model:i.model,error:"Connection check failed"})}finally{u(!1)}}},[t,i.provider,i.model]);P.useEffect(()=>{t&&E()},[t,E]),P.useEffect(()=>{if(!c)return;function j(q){const Z=q.target;Z&&(S.current&&S.current.contains(Z)||(d(!1),f(!1),x(!1)))}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[c]);const C=P.useCallback(j=>{const q=Wh[j],Z={...i,provider:j,model:q.suggestedModels[0]||"default",updatedAt:Date.now()};a(Z),R6(Z),f(!1),n?.(Z),setTimeout(E,100)},[i,n,E]),R=P.useCallback(j=>{const q={...i,model:j,updatedAt:Date.now()};a(q),R6(q),x(!1),_(""),n?.(q)},[i,n]),k=P.useCallback(()=>{w.trim()&&R(w.trim())},[w,R]),I=P.useCallback(j=>{const q=i.provider==="lmstudio"?"lmstudioBaseUrl":"ollamaBaseUrl",Z={...i,[q]:j,updatedAt:Date.now()};a(Z),R6(Z),n?.(Z)},[i,n]),N=()=>{switch(M){case"connected":return"text-emerald-400";case"disconnected":return"text-rose-400";case"checking":return"text-amber-400 animate-pulse";case"disabled":return"text-slate-500";default:return"text-slate-500"}},D=()=>{switch(M){case"connected":return`已连接 · ${Wh[i.provider].name}`;case"disconnected":return"未连接";case"checking":return"检测中...";case"disabled":return"规则模式";default:return""}},F=Wh[i.provider],L=jlt(),U=Hlt();return g.jsxs("div",{ref:S,className:`relative ${r}`,onMouseDown:j=>j.stopPropagation(),children:[g.jsx("button",{onClick:()=>d(j=>!j),className:`p-1 rounded transition-colors hover:bg-white/10 ${N()} ${c?"bg-white/10":""}`,title:D(),children:t?g.jsx(hot,{size:14,className:M==="checking"?"animate-pulse":""}):g.jsx(a_,{size:14})}),c&&g.jsxs("div",{className:"absolute top-full left-0 mt-2 w-72 bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden z-[200]",children:[g.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-white/10",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[t?g.jsx(o2,{size:12,className:"text-purple-400"}):g.jsx(a_,{size:12,className:"text-slate-400"}),g.jsx("span",{className:"text-[11px] font-medium text-slate-300",children:t?"AI 模式":"规则模式"})]}),g.jsx("button",{onClick:()=>d(!1),className:"p-1 rounded hover:bg-white/10 text-slate-500 hover:text-slate-300 transition-colors",title:"关闭",children:g.jsx(Ba,{size:12})})]}),g.jsxs("div",{className:"p-3 space-y-3",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-xs text-slate-400",children:"AI 增强"}),g.jsxs("button",{onClick:()=>e(!t),className:`flex items-center gap-1 px-2 py-1 rounded-full text-[10px] transition-colors ${t?"bg-purple-500/20 text-purple-300 hover:bg-purple-500/30":"bg-slate-600/50 text-slate-400 hover:bg-slate-600"}`,children:[t?g.jsx(plt,{size:12}):g.jsx(hlt,{size:12}),t?"启用":"禁用"]})]}),t&&g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"space-y-1",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${s?.available?"bg-emerald-500 animate-pulse":"bg-rose-500"}`}),g.jsx("span",{className:"text-[10px] text-slate-400",children:s?.available?`已连接${s.latency?` (${s.latency}ms)`:""}`:"未连接"})]}),g.jsx("button",{onClick:E,disabled:l,className:"p-1 hover:bg-white/10 rounded transition-colors disabled:opacity-50",children:g.jsx(gP,{size:10,className:`text-slate-400 ${l?"animate-spin":""}`})})]}),!s?.available&&s?.error&&g.jsx("div",{className:"px-2 py-1.5 bg-rose-500/10 border border-rose-500/20 rounded-lg",children:g.jsx("p",{className:"text-[9px] text-rose-300 leading-relaxed",children:s.error})})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[9px] text-slate-500 mb-1 uppercase tracking-wider",children:"提供商"}),g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>f(!h),className:"w-full flex items-center justify-between gap-2 px-2.5 py-1.5 text-[11px] bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 transition-colors",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[F.isLocal?g.jsx(lX,{size:10}):g.jsx(sX,{size:10}),g.jsx("span",{className:"text-slate-200",children:F.name})]}),g.jsx(Ph,{size:10,className:"text-slate-400"})]}),h&&g.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-white/10 rounded-lg shadow-xl z-10 overflow-hidden max-h-40 overflow-y-auto",children:[g.jsx("div",{className:"px-2 py-1 text-[8px] text-slate-600 uppercase tracking-wider",children:"本地"}),L.map(j=>g.jsxs("button",{onClick:()=>C(j.id),className:`w-full flex items-center gap-2 px-2.5 py-1.5 text-[10px] text-left transition-colors ${j.id===i.provider?"bg-purple-500/20 text-purple-300":"hover:bg-white/5 text-slate-300"}`,children:[g.jsx(lX,{size:9}),g.jsx("span",{className:"flex-1",children:j.name}),j.id===i.provider&&g.jsx(Gh,{size:9})]},j.id)),g.jsx("div",{className:"px-2 py-1 text-[8px] text-slate-600 uppercase tracking-wider border-t border-white/5",children:"云端"}),U.map(j=>g.jsxs("button",{onClick:()=>C(j.id),className:`w-full flex items-center gap-2 px-2.5 py-1.5 text-[10px] text-left transition-colors ${j.id===i.provider?"bg-purple-500/20 text-purple-300":"hover:bg-white/5 text-slate-300"}`,children:[g.jsx(sX,{size:9}),g.jsx("span",{className:"flex-1",children:j.name}),j.id===i.provider&&g.jsx(Gh,{size:9})]},j.id))]})]})]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-[9px] text-slate-500 mb-1 uppercase tracking-wider",children:"模型"}),g.jsxs("div",{className:"relative",children:[g.jsxs("button",{onClick:()=>x(!m),className:"w-full flex items-center justify-between gap-2 px-2.5 py-1.5 text-[11px] bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 transition-colors",children:[g.jsx("span",{className:"text-slate-200 truncate",children:i.model}),g.jsx(Ph,{size:10,className:"text-slate-400 flex-shrink-0"})]}),m&&g.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-white/10 rounded-lg shadow-xl z-10 overflow-hidden",children:[g.jsx("div",{className:"max-h-28 overflow-y-auto",children:b.map(j=>g.jsxs("button",{onClick:()=>R(j),className:`w-full flex items-center gap-2 px-2.5 py-1.5 text-[10px] text-left transition-colors ${j===i.model?"bg-purple-500/20 text-purple-300":"hover:bg-white/5 text-slate-300"}`,children:[g.jsx("span",{className:"flex-1 truncate",children:j}),j===i.model&&g.jsx(Gh,{size:9})]},j))}),g.jsx("div",{className:"border-t border-white/5 p-2",children:g.jsxs("div",{className:"flex gap-1",children:[g.jsx("input",{type:"text",value:w,onChange:j=>_(j.target.value),placeholder:"自定义模型...",className:"flex-1 px-2 py-1 text-[10px] bg-slate-800 border border-white/10 rounded text-slate-300 placeholder-slate-600 focus:outline-none focus:border-purple-500/50",onKeyDown:j=>j.key==="Enter"&&k()}),g.jsx("button",{onClick:k,disabled:!w.trim(),className:"px-2 py-1 text-[10px] bg-purple-600 hover:bg-purple-500 disabled:opacity-50 rounded text-white",children:"确定"})]})})]})]})]}),F.isLocal&&g.jsxs("div",{children:[g.jsx("label",{className:"block text-[9px] text-slate-500 mb-1 uppercase tracking-wider",children:"服务地址"}),g.jsx("input",{type:"text",value:i.provider==="lmstudio"?i.lmstudioBaseUrl:i.ollamaBaseUrl,onChange:j=>I(j.target.value),placeholder:F.defaultBaseUrl,className:"w-full px-2.5 py-1.5 text-[10px] bg-white/5 border border-white/10 rounded-lg text-slate-300 placeholder-slate-600 focus:outline-none focus:border-purple-500/50"})]})]}),!t&&g.jsxs("div",{className:"text-center py-2",children:[g.jsx(a_,{size:24,className:"mx-auto text-slate-600 mb-1.5"}),g.jsxs("p",{className:"text-[10px] text-slate-500",children:["基于关键词和逻辑规则进行分析",g.jsx("br",{}),"无需连接 AI 模型"]})]})]})]})]})}function Hut(t,e,n,r,i){if(!t)return`# 暂无思维数据

演武场尚未初始化。`;const a=n.find(o=>o.id===r);let s=`# 思维演武报告: ${t.text}

`;return s+=`**演武状态**: ${i}% 固化 (混沌度: ${100-i}%)
`,s+=`**当前宇宙**: ${a?.name||"未知"}
`,s+=`**节点总数**: ${e.length}
`,s+=`**生成时间**: ${new Date().toLocaleString("zh-CN")}

`,s+=`---

`,s+=`## 🌳 逻辑推演图谱

`,s+=gce(t.id,e,0),s+=`
---

`,s+=`## 📊 节点类型统计

`,s+=$ut(e),s+=`
---

`,s+=`*由思维演武场V2自动生成 | Thinking Dojo PRO*
`,s}function gce(t,e,n){let r="";return e.filter(a=>a.parent===t).forEach(a=>{const s="  ".repeat(n),o=n===0?"###":"-",l=Mi[a.type];r+=`${s}${o} [${l.label}] ${a.text}
`,a.confidence!==void 0&&a.confidence<.8&&(r+=`${s}  > ⚠️ 置信度: ${Math.round(a.confidence*100)}%
`),r+=gce(a.id,e,n+1)}),r}function $ut(t){const e={};t.forEach(r=>{e[r.type]=(e[r.type]||0)+1});let n=`| 节点类型 | 数量 | 占比 |
`;return n+=`|---------|------|------|
`,Object.entries(Mi).forEach(([r,i])=>{const a=e[r]||0,s=t.length>0?Math.round(a/t.length*100):0;n+=`| ${i.label} | ${a} | ${s}% |
`}),n}const Vut=({arenaMemory:t,onSave:e,onClose:n,onDelete:r,onExportNodeToMemory:i,onDistillToCard:a})=>{const{nodes:s,setNodes:o,universes:l,setUniverses:u,activeUniverseId:c,setActiveUniverseId:d,selectedNodeId:h,setSelectedNodeId:f,snapshots:m,setSnapshots:x,currentNodes:b,rootNode:y,selectedNode:w}=rot(t),{transform:_,setTransform:S,isDraggingCanvas:M,draggedNodeId:E,setDraggedNodeId:C,isNavigationMode:R,setIsNavigationMode:k}=ylt(),I=P.useRef(""),N=P.useRef(!1);P.useEffect(()=>{M&&(N.current=!0)},[M]);const D=P.useCallback((fe,$e=!1)=>{const Ge=fe&&fe.length>0?fe:b;if(Ge.length===0||N.current&&!$e)return;let st=1/0,Qe=-1/0,Ye=1/0,ft=-1/0;for(const Vt of Ge)Vt.px<st&&(st=Vt.px),Vt.px>Qe&&(Qe=Vt.px),Vt.py<Ye&&(Ye=Vt.py),Vt.py>ft&&(ft=Vt.py);if(!isFinite(st)||!isFinite(Qe)||!isFinite(Ye)||!isFinite(ft)){console.warn("[Arena V2] centerViewToNodeGroup: 节点坐标无效，跳过居中");return}const Ct=(st+Qe)/2,At=(Ye+ft)/2,Ht=typeof window<"u"?window.innerWidth:1200,wn=typeof window<"u"?window.innerHeight:800;S(Vt=>({...Vt,x:Ht/2-Ct*Vt.scale,y:wn/2-At*Vt.scale}))},[b,S]);P.useEffect(()=>{if(b.length===0)return;const fe=`${t.id}:${c}`;I.current!==fe&&(N.current=!1,I.current=fe,requestAnimationFrame(()=>{D(b,!0)}))},[t.id,c]);const F=Nlt(t.id),L=Llt(t.arenaV2ViewMode||"free"),{viewMode:U,setViewMode:j,isFocusMode:q,setIsFocusMode:Z}=L,[Q,z]=P.useState(!1),[W,X]=P.useState(!1),[H,J]=P.useState(""),[te,ee]=P.useState(!1),[se,ue]=P.useState(new Set),[oe,Te]=P.useState(()=>mX(xut())),[Ne,be]=P.useState(!1),[De,ke]=P.useState(!1),[Me,Ie]=P.useState(null),[ce,G]=P.useState(null),[xe,Oe]=P.useState(null),Fe=P.useMemo(()=>typeof window<"u"&&window.innerWidth<768&&b.length>50?[...b].sort((Ge,st)=>{const Qe=Ge.lastEditedAt?new Date(Ge.lastEditedAt).getTime():new Date(Ge.createdAt).getTime();return(st.lastEditedAt?new Date(st.lastEditedAt).getTime():new Date(st.createdAt).getTime())-Qe}).slice(0,50):b,[b]),ze=P.useMemo(()=>{if(!q||!h)return new Set;const fe=new Set([h]);let $e=h;for(;$e;){const st=s.find(Qe=>Qe.id===$e);if(!st||!st.parent)break;fe.add(st.parent),$e=st.parent}const Ge=st=>{s.filter(Ye=>Ye.parent===st).forEach(Ye=>{fe.add(Ye.id),Ge(Ye.id)})};return Ge(h),fe},[q,h,s]),le=Dlt({nodes:s,selectedNodeId:h,activeUniverseId:c,isNavigationMode:R,setNodes:o,setSelectedNodeId:f,setHasUnsavedChanges:fe=>re.setHasUnsavedChanges(fe)}),re=blt({arenaMemory:t,nodes:s,universes:l,snapshots:m,viewMode:U,activeUniverseId:c,onSave:e,pauseAutoSave:Q||le.confirmDialog?.show||xe?.show}),me=xlt({nodes:s,transform:_,viewMode:U,selectedNodeId:h,activeUniverseId:c,setNodes:o,setTransform:S,setViewMode:j,setSelectedNodeId:f,setHasUnsavedChanges:re.setHasUnsavedChanges}),de=Olt({nodes:s,activeUniverseId:c,viewMode:U,selectedNodeId:h,transform:_,isNavigationMode:R,draggedNodeId:E,setNodes:o,setTransform:S,setSelectedNodeId:f,setDraggedNodeId:C,setHasUnsavedChanges:re.setHasUnsavedChanges}),ve=P.useCallback(fe=>{const $e=mX(fe);Te($e),yut(fe),gX($e);const Ge=document.createElement("div");Ge.textContent=`✓ 已切换到 ${$e.name}`,Ge.className="fixed top-20 left-1/2 -translate-x-1/2 z-[300] px-4 py-2 rounded-lg text-sm shadow-lg",Ge.style.background="#1a1d2e",Ge.style.color="rgb(228, 228, 231)",Ge.style.border="1px solid rgba(255, 255, 255, 0.1)",document.body.appendChild(Ge),setTimeout(()=>Ge.remove(),2e3)},[]);P.useEffect(()=>{gX(oe)},[oe]),P.useEffect(()=>{s.length>0&&de.handleAutoLayout()},[U]);const _e=Ult({nodes:s,snapshots:m,activeUniverseId:c,setNodes:o,setSnapshots:x,setHasUnsavedChanges:re.setHasUnsavedChanges,onCenterView:fe=>D(fe,!0),setConfirmDialog:le.setConfirmDialog}),Be=Blt({nodes:s,selectedNodeId:h,editingNodeId:le.editingNodeId,reconnectingNodeId:le.reconnectingNodeId,activeUniverseId:c,isFocusMode:q,setNodes:o,setSelectedNodeId:f,setHasUnsavedChanges:re.setHasUnsavedChanges,setReconnectingNodeId:le.setReconnectingNodeId,setIsFocusMode:Z,handleUndo:me.handleUndo,handleRedo:me.handleRedo,handleDeleteNode:le.handleDeleteNode,handleAutoLayout:de.handleAutoLayout,handleCreateSnapshot:_e.handleCreateSnapshot,handleEnterEditMode:le.handleEnterEditMode,handleDeconstructNode:le.handleDeconstructNode,handleStartReconnect:le.handleStartReconnect}),He=zlt({nodes:s,currentNodes:b,universes:l,activeUniverseId:c,setNodes:o,setUniverses:u,setActiveUniverseId:d,setHasUnsavedChanges:re.setHasUnsavedChanges,setConfirmDialog:le.setConfirmDialog}),pt=P.useCallback(fe=>{if(!h)return;const $e=s.find(Qe=>Qe.id===h);if(!$e)return;const Ge=Xo[fe],st=Ge.items.map((Qe,Ye)=>({id:`p-${Date.now()}-${Ye}`,text:Qe,type:Ge.types[Ye],px:$e.px+300,py:$e.py+(Ye-(Ge.items.length-1)/2)*130,parent:h,level:$e.level+1,universeId:c,expanded:!1,createdAt:new Date}));o(Qe=>[...Qe.map(Ye=>Ye.id===h?{...Ye,expanded:!0}:Ye),...st]),re.setHasUnsavedChanges(!0)},[h,s,c,o,re]),gt=P.useCallback(()=>{ee(!1),le.setConfirmDialog({show:!0,title:"删除演武场",message:'此操作不可撤销，请输入"我确认删除"以继续',variant:"danger",requireInput:!0,requiredInputText:"我确认删除",confirmText:"确认删除",onConfirm:()=>{le.setConfirmDialog(null),r(t.id)}})},[t.id,r,le]),We=P.useCallback(()=>{const fe=`${window.location.origin}/memories/arena-v2?id=${t.id}`;navigator.clipboard.writeText(fe).then(()=>{le.setConfirmDialog({show:!0,title:"复制成功",message:"链接已复制到剪贴板",type:"alert",variant:"info",onConfirm:()=>le.setConfirmDialog(null)})}),ee(!1)},[t.id,le]),Je=P.useCallback(()=>{ee(!1),Oe({show:!0,title:"重命名演武场",message:"请输入新的演武场名称",defaultValue:t.content,placeholder:"请输入名称",onConfirm:fe=>{Oe(null),e({...t,content:fe,lastEditedAt:new Date})}})},[t,e]),ot=P.useCallback(()=>{if(!w||!i)return;if(se.has(w.id)){const $e=document.createElement("div");$e.textContent="✓ 已导出",$e.className="fixed top-20 left-1/2 -translate-x-1/2 z-[300] bg-zinc-100 text-zinc-950 px-4 py-2 rounded-lg text-sm shadow-lg",document.body.appendChild($e),setTimeout(()=>$e.remove(),2e3);return}i({text:w.text,type:w.type,reasoning:w.reasoning,note:w.note,evidenceIds:w.evidenceIds,arenaId:t.id}),ue($e=>new Set([...$e,w.id]));const fe=document.createElement("div");fe.textContent="✓ 已导出",fe.className="fixed top-20 left-1/2 -translate-x-1/2 z-[300] bg-zinc-100 text-zinc-950 px-4 py-2 rounded-lg text-sm shadow-lg",document.body.appendChild(fe),setTimeout(()=>fe.remove(),2e3)},[w,i,t.id,se]),Ee=lut({arenaMemoryId:t.id,rootNode:y,currentNodes:b,nodes:s,selectedNode:w,selectedNodeId:h,activeUniverseId:c,viewMode:U,aiState:F,setNodes:o,setTransform:S,setSelectedNodeId:f,setHasUnsavedChanges:re.setHasUnsavedChanges,setIsPressureTesting:be,setConfirmDialog:le.setConfirmDialog,computeLayoutTransform:de.computeLayoutTransform}),je=P.useCallback(()=>{const fe=Rlt(b,Mi),$e=Hut(y,b,l,c,fe);J($e),X(!0)},[b,y,l,c]);P.useMemo(()=>b.filter(fe=>fe.parent).map(fe=>{const $e=b.find(Ge=>Ge.id===fe.parent);return $e?{id:`${$e.id}-${fe.id}`,source:$e,target:fe,path:dX($e,fe,U==="orthogonal"?"orthogonal":"bezier")}:null}).filter(Boolean),[b,U]);const mt=P.useMemo(()=>Plt(b),[b]);return g.jsxs("div",{className:"flex flex-col h-screen arena-v2-canvas text-slate-300 font-sans overflow-hidden select-none",style:{background:oe.colors.canvasBg},children:[g.jsx("div",{className:"hidden md:block",children:g.jsx(Out,{aiEnabled:F.aiEnabled,brainIndicator:g.jsx(wX,{aiEnabled:F.aiEnabled,onAIEnabledChange:F.setAIEnabled}),isLoading:F.isAILoading,loadingType:F.aiResultType,onConflict:Ee.handleEnhancedConflictDetection,onBlindspot:Ee.handleBlindSpotScan,onParadigm:Ee.handleParadigmRecommend,onExportReport:je,hasParadigmCache:F.hasParadigmCache,hasBlindspotCache:F.hasBlindspotCache,hasConflictCache:F.hasConflictCache,onLoadCache:Ee.handleLoadCachedResult,thinkingDice:g.jsx(_X,{selectedNode:w,onAddAsNode:Ee.handleAddNodeFromDice})})}),g.jsx(hut,{arenaMemory:t,currentTheme:oe,universes:l,activeUniverseId:c,isNavigationMode:R,isSaving:re.isSaving,hasUnsavedChanges:re.hasUnsavedChanges,snapshotCount:m.length,showMinimap:L.isMiniMapOpen,onClose:n,onSwitchUniverse:d,onCreateUniverse:He.handleCreateUniverse,onDeleteUniverse:He.handleDeleteUniverse,onToggleNavigationMode:()=>k(!R),onAutoLayout:de.handleAutoLayout,onCreateSnapshot:_e.handleCreateSnapshot,onManualSave:re.handleSaveNow,onShowMenu:()=>ee(!0),onToggleMinimap:()=>L.setIsMiniMapOpen(!L.isMiniMapOpen)}),g.jsx(fut,{currentTheme:oe,isNavigationMode:R,universes:l,activeUniverseId:c,showMinimap:L.isMiniMapOpen,onToggleNavigationMode:()=>{k(!R),R||(le.setIsRightPanelOpen(!1),f(null))},onAutoLayout:de.handleAutoLayout,onCreateSnapshot:_e.handleCreateSnapshot,onSwitchUniverse:d,onCreateUniverse:He.handleCreateUniverse,onDeleteUniverse:He.handleDeleteUniverse,onToggleMinimap:()=>L.setIsMiniMapOpen(!L.isMiniMapOpen)}),q&&g.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[100] backdrop-blur-md px-6 py-2 rounded-full shadow-2xl flex items-center gap-2 text-sm font-bold",style:{background:oe.colors.nodeBg,border:`1px solid ${oe.colors.borderPrimary}`,color:oe.colors.textPrimary},children:["🎯 专注模式",g.jsx("button",{onClick:()=>Z(!1),className:"ml-2 text-zinc-400 hover:text-zinc-200 transition-colors text-xs",children:"[退出 Esc]"})]}),g.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[(De||le.isRightPanelOpen)&&g.jsx("div",{className:"fixed inset-0 bg-black/40 z-30 md:hidden",onClick:()=>{ke(!1),le.setIsRightPanelOpen(!1)}}),g.jsx(Eut,{isOpen:De,isFocusMode:q,snapshots:m,currentTheme:oe,onSetIsOpen:ke,onCreateSnapshot:_e.handleCreateSnapshot,onRenameSnapshot:_e.handleRenameSnapshot,onDeleteSnapshot:_e.handleDeleteSnapshot,onRestoreSnapshot:_e.handleRestoreSnapshot}),g.jsxs("main",{ref:de.canvasRef,className:`flex-1 relative overflow-hidden transition-all ${de.isDraggingCanvas?"cursor-grabbing":R?"cursor-grab":"cursor-default"} ${R?"ring-2 ring-blue-400 ring-inset":""}`,onMouseDown:de.handleMouseDown,onMouseMove:de.handleMouseMove,onMouseUp:de.handleMouseUp,onDoubleClick:de.handleCanvasDoubleClick,onContextMenu:fe=>fe.preventDefault(),children:[g.jsx("div",{className:"absolute inset-0 arena-v2-grid-pattern",style:{backgroundSize:`${60*_.scale}px ${60*_.scale}px`,backgroundPosition:`${_.x}px ${_.y}px`}}),g.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{transform:`translate(${_.x}px, ${_.y}px) scale(${_.scale})`,transformOrigin:"0 0"},children:[g.jsxs("svg",{className:"absolute inset-0 overflow-visible opacity-50",children:[Fe.map(fe=>{const $e=Fe.find(Ge=>Ge.id===fe.parent);return $e?g.jsx("path",{d:dX($e,fe,U==="orthogonal"?"orthogonal":"bezier"),fill:"none",stroke:oe.colors.lineColor,strokeWidth:oe.colors.lineWidth,strokeDasharray:fe.type==="assumption"?"5 5":"0"},`link-${fe.id}`):null}),Ne&&mt.map((fe,$e)=>{const Ge=Fe.find(Qe=>Qe.id===fe.from),st=Fe.find(Qe=>Qe.id===fe.to);return!Ge||!st?null:g.jsx("path",{d:U==="orthogonal"?(()=>{const Qe=Ge.px+(st.px-Ge.px)*.5;return`M ${Ge.px} ${Ge.py} L ${Qe} ${Ge.py} L ${Qe} ${st.py} L ${st.px} ${st.py}`})():`M ${Ge.px} ${Ge.py} Q ${(Ge.px+st.px)/2} ${(Ge.py+st.py)/2-120}, ${st.px} ${st.py}`,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 4",opacity:"0.3"},`conf-${$e}`)})]}),g.jsx("div",{className:"relative pointer-events-auto",children:Fe.map(fe=>{const $e=!q||ze.has(fe.id);return g.jsx("div",{style:{opacity:$e?R?.6:1:.2,transition:"opacity 0.3s ease"},children:g.jsx(dut,{node:fe,isSelected:h===fe.id,isEditing:le.editingNodeId===fe.id,isReconnecting:le.reconnectingNodeId===fe.id,isReconnectTarget:le.reconnectingNodeId!==null&&le.reconnectingNodeId!==fe.id&&fe.id!=="root",canvasScale:_.scale,isNavigationMode:R,onSelect:le.handleNodeSelect,onTextChange:le.handleNodeTextChange,onTypeChange:le.handleNodeTypeChange,onDelete:le.handleDeleteNode,onDeconstructNode:le.handleDeconstructNode,onDragStart:C,onStartReconnect:le.handleStartReconnect,onReconnectTo:le.handleReconnectToNode,onEnterEditMode:le.handleEnterEditMode,onExitEditMode:le.handleExitEditMode})},fe.id)})})]}),L.isMiniMapOpen&&!q&&g.jsx(kut,{nodes:b,transform:_,canvasSize:{width:typeof window<"u"?window.innerWidth:1920,height:typeof window<"u"?window.innerHeight:1080},onTransformChange:S,currentTheme:oe,onClose:()=>L.setIsMiniMapOpen(!1)})]}),g.jsx(Tut,{isOpen:le.isRightPanelOpen,isFocusMode:q,selectedNode:w,activeUniverseId:c,currentTheme:oe,aiEnabled:F.aiEnabled,isAILoading:F.isAILoading,aiResultType:F.aiResultType,isPressureTesting:Ne,hasParadigmCache:F.hasParadigmCache,hasBlindspotCache:F.hasBlindspotCache,hasConflictCache:F.hasConflictCache,hasExportNodeToMemory:!!i,hasDistillToCard:!!a,aiBrainIndicator:g.jsx(wX,{aiEnabled:F.aiEnabled,onAIEnabledChange:F.setAIEnabled}),thinkingDice:g.jsx(_X,{selectedNode:w,onAddAsNode:Ee.handleAddNodeFromDice}),onSetIsOpen:le.setIsRightPanelOpen,onNodeTextChange:le.handleNodeTextChange,onNodeNoteChange:le.handleNodeNoteChange,onMergeSubtree:He.handleMergeSubtree,onNodeTypeChange:le.handleNodeTypeChange,onInjectParadigm:pt,onExportNodeToMemory:ot,onDistillToCard:()=>z(!0),onExport:je,onSetAIEnabled:F.setAIEnabled,onConflictDetection:Ee.handleEnhancedConflictDetection,onBlindSpotScan:Ee.handleBlindSpotScan,onParadigmRecommend:Ee.handleParadigmRecommend,onLoadCachedResult:Ee.handleLoadCachedResult}),w&&le.isRightPanelOpen&&g.jsx("div",{className:"md:hidden",children:g.jsx(Rut,{node:w,currentTheme:oe,activeUniverseId:c,onUpdate:le.handleNodeTextChange,onNoteUpdate:le.handleNodeNoteChange,onTypeChange:le.handleNodeTypeChange,onClose:()=>{le.setIsRightPanelOpen(!1),f(null)},onDelete:le.handleDeleteNode,onDeconstructNode:le.handleDeconstructNode,onStartReconnect:le.handleStartReconnect,onMergeSubtree:c!=="u1"?He.handleMergeSubtree:void 0,onInjectParadigm:pt,onExportNodeToMemory:i?ot:void 0,onDistillToCard:a?()=>z(!0):void 0})})]}),g.jsx("button",{className:`md:hidden fixed right-4 z-40 w-14 h-14 rounded-full shadow-xl flex items-center justify-center transition-all active:scale-95 ${le.isRightPanelOpen&&w?"bottom-[72vh]":"bottom-20"}`,style:{background:oe.colors.nodeBg,border:`2px solid ${oe.colors.borderPrimary}`},onClick:()=>{const fe=(window.innerWidth/2-_.x)/_.scale,$e=(window.innerHeight/2-_.y)/_.scale,Ge=`node-${Date.now()}`,st={id:Ge,text:"新节点...",type:"fact",px:fe,py:$e,level:0,parent:null,universeId:c,expanded:!1,createdAt:new Date};o(Qe=>[...Qe,st]),f(Ge),re.setHasUnsavedChanges(!0)},title:"创建节点",children:g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:oe.colors.textPrimary},children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),!q&&g.jsx(but,{currentTheme:oe,viewMode:U,currentNodes:b,selectedNode:w,isFocusMode:q,onThemeChange:ve,onViewModeChange:fe=>{j(fe),re.setHasUnsavedChanges(!0)},onShowViewModeSheet:()=>L.setShowViewModeSheet(!0)}),te&&g.jsx("div",{className:"fixed inset-0 z-[200] flex items-start justify-end pt-16 pr-4",onClick:()=>ee(!1),children:g.jsxs("div",{className:"rounded-lg shadow-2xl border overflow-hidden w-48 animate-in fade-in slide-in-from-top-2 duration-200",style:{background:oe.colors.nodeBg,borderColor:oe.colors.borderPrimary},onClick:fe=>fe.stopPropagation(),children:[g.jsx("button",{onClick:Je,className:"w-full px-4 py-3 text-left text-sm flex items-center gap-2 hover:bg-white/5 transition-colors",style:{color:oe.colors.textPrimary},children:"✏️ 重命名"}),g.jsx("button",{onClick:We,className:"w-full px-4 py-3 text-left text-sm flex items-center gap-2 hover:bg-white/5 transition-colors",style:{color:oe.colors.textPrimary},children:"🔗 复制链接"}),g.jsx("button",{onClick:je,className:"w-full px-4 py-3 text-left text-sm flex items-center gap-2 hover:bg-white/5 transition-colors",style:{color:oe.colors.textPrimary},children:"📄 导出Markdown"}),a&&g.jsx("button",{onClick:()=>{ee(!1),z(!0)},className:"w-full px-4 py-3 text-left text-sm flex items-center gap-2 hover:bg-white/5 transition-colors",style:{color:oe.colors.textPrimary},children:"✨ 提炼为卡片"}),g.jsx("div",{className:"h-px",style:{background:oe.colors.borderPrimary}}),g.jsx("button",{onClick:gt,className:"w-full px-4 py-3 text-left text-sm flex items-center gap-2 hover:bg-red-500/10 transition-colors text-red-400",children:"🗑️ 删除演武场"})]})}),le.confirmDialog&&g.jsx(Cut,{title:le.confirmDialog.title,message:le.confirmDialog.message||"",type:le.confirmDialog.type,variant:le.confirmDialog.variant,confirmText:le.confirmDialog.confirmText,thirdButtonText:le.confirmDialog.thirdButtonText,requireInput:le.confirmDialog.requireInput,requiredInputText:le.confirmDialog.requiredInputText,onConfirm:le.confirmDialog.onConfirm,onThirdButton:le.confirmDialog.onThirdButton,onCancel:()=>le.setConfirmDialog(null)}),xe&&g.jsx(Mut,{title:xe.title,message:xe.message,defaultValue:xe.defaultValue,placeholder:xe.placeholder,onConfirm:fe=>{xe.onConfirm(fe),Oe(null)},onCancel:()=>Oe(null)}),Be.showTypeSwitcher&&w&&g.jsx(Aut,{currentType:w.type,nodes:b,onSelectType:fe=>{le.handleNodeTypeChange(h,fe),Be.setShowTypeSwitcher(!1)},onClose:()=>Be.setShowTypeSwitcher(!1),position:w?{x:w.px*_.scale+_.x,y:w.py*_.scale+_.y}:void 0}),Q&&a&&g.jsx(Put,{nodes:b,arenaId:t.id,arenaTitle:t.content,onClose:()=>z(!1),onDistill:a}),W&&g.jsx(Dut,{markdown:H,title:"导出 Markdown",onClose:()=>X(!1)}),F.aiResultType&&g.jsx(Ilt,{type:F.aiResultType,isLoading:F.isAILoading,isAIEnabled:F.aiEnabled,onClose:()=>F.setAIResultType(null),onRefresh:()=>{F.aiResultType==="paradigm"?Ee.handleParadigmRecommend():F.aiResultType==="blindspot"?Ee.handleBlindSpotScan():Ee.handleEnhancedConflictDetection()},rawResponse:F.aiRawResponse,prompt:F.aiPrompt,paradigmResults:F.paradigmResults,blindSpotResults:F.blindSpotResults,conflictResults:F.conflictResults,history:F.aiResultHistory,onClearHistory:Ee.handleClearHistory,nodes:s,onImportAsNode:Ee.handleImportAsNode,onApplyParadigm:Ee.handleApplyParadigm,onAddQuestion:Ee.handleAddQuestionAsNode,onFocusNode:Ee.handleFocusNode,onLoadHistory:Ee.handleLoadHistory}),g.jsx(Nut,{isOpen:L.showViewModeSheet,value:U,onClose:()=>L.setShowViewModeSheet(!1),onChange:fe=>{j(fe),re.setHasUnsavedChanges(!0)}})]})},qut=({isOpen:t,onClose:e,onCreate:n})=>{const[r,i]=P.useState("");P.useEffect(()=>{if(t){const o=sessionStorage.getItem("arena-v2-source");if(o){try{const{text:l}=JSON.parse(o);setTimeout(()=>{i(l||"")},0)}catch(l){console.error("解析源记忆数据失败:",l)}sessionStorage.removeItem("arena-v2-source")}}},[t]);const a=()=>{r.trim()&&(n(r.trim()),i(""))},s=o=>{o.key==="Enter"&&!o.shiftKey?(o.preventDefault(),a()):o.key==="Escape"&&e()};return g.jsx(zn,{show:t,as:P.Fragment,children:g.jsxs(ar,{onClose:e,className:"relative z-50",children:[g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:g.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm"})}),g.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:g.jsx(zn.Child,{as:P.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:g.jsxs(ar.Panel,{className:"w-full max-w-lg bg-[#0f111a]/95 backdrop-blur-2xl rounded-2xl border border-white/10 shadow-2xl overflow-hidden",children:[g.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/5 bg-white/[0.02]",children:[g.jsx(ar.Title,{className:"text-base font-medium text-gray-200",children:"创建演武场 V2"}),g.jsx("button",{onClick:e,className:"w-7 h-7 rounded hover:bg-white/10 text-gray-500 hover:text-gray-300 transition-colors flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsxs("div",{className:"px-6 py-5",children:[g.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"核心问题 *"}),g.jsx("textarea",{value:r,onChange:o=>i(o.target.value),onKeyDown:s,placeholder:"输入你想探索的问题或主题",className:"w-full bg-white/5 border border-white/10 rounded px-3 py-2.5 text-sm text-gray-100 placeholder-gray-600 outline-none focus:border-white/30 transition-colors resize-none",rows:4,autoFocus:!0}),g.jsxs("div",{className:"flex items-center justify-between mt-2",children:[g.jsx("p",{className:"text-xs text-gray-600",children:"Enter 创建 · Esc 取消"}),g.jsxs("span",{className:"text-xs text-gray-600",children:[r.length,"/500"]})]})]}),g.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t border-white/5",children:[g.jsx("button",{onClick:e,className:"px-4 py-2 rounded text-sm text-gray-400 hover:text-gray-300 hover:bg-white/5 transition-colors",children:"取消"}),g.jsx("button",{onClick:a,disabled:!r.trim(),className:"px-4 py-2 rounded text-sm bg-white/10 hover:bg-white/15 text-white transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:"创建"})]})]})})})]})})};function Gut(t){const{memories:e,setMemories:n,visibleMemories:r,searchModal:i,onCloseSearchModal:a,getRelatedMemories:s,onAddRelation:o,onRemoveRelation:l,onDeleteMemory:u,onUpdateMemory:c,onCreateCard:d,onCreateIndex:h,onCreateArenaFromMemory:f,createCardModal:m,onCloseCreateCardModal:x,onConfirmCreateCard:b,cardDetailModal:y,onCloseCardDetailModal:w,onNavigateToSourceMemory:_,createIndexModal:S,onCloseCreateIndexModal:M,onConfirmCreateIndex:E,indexDetailModal:C,onCloseIndexDetailModal:R,onNavigateToIndexedMemory:k,passwordModalOpen:I,setPasswordModalOpen:N,onPasswordConfirm:D,clearAllOpen:F,setClearAllOpen:L,onValidatePassword:U,onClearAllConfirmed:j,arenaManagerModalOpen:q,setArenaManagerModalOpen:Z,onToggleArenaArchive:Q,createArenaModalOpen:z,setCreateArenaModalOpen:W,onCreateArena:X,createArenaV2ModalOpen:H,setCreateArenaV2ModalOpen:J,onCreateArenaV2:te,arenaEditor:ee,onOpenArena:se,onSaveArena:ue,onCloseArena:oe,onDeleteArena:Te,onDistillArenaToCard:Ne,onConvertNodeToMemory:be,arenaV2Editor:De,onSaveArenaV2:ke,onCloseArenaV2:Me,onDeleteArenaV2:Ie,onExportArenaV2NodeToMemory:ce,onDistillArenaV2ToCard:G}=t;return g.jsxs(g.Fragment,{children:[i.visible&&i.memoryId&&g.jsx(PYe,{currentMemory:e.find(xe=>xe.id===i.memoryId),allMemories:r,relatedMemoryIds:s(i.memoryId),onAddRelation:o,onRemoveRelation:l,onDeleteMemory:u,onUpdateMemory:c,onCreateCard:d,onCreateIndex:h,onCreateArena:f,onClose:a,position:i.position}),m.visible&&g.jsx(OYe,{isOpen:m.visible,onClose:x,onConfirm:b,sourceMemories:e.filter(xe=>m.sourceMemoryIds.includes(xe.id))},"create-card-modal-stable"),y.visible&&y.cardId&&g.jsx(LYe,{isOpen:y.visible,onClose:w,card:e.find(xe=>xe.id===y.cardId),sourceMemories:e.find(xe=>xe.id===y.cardId)?.sourceMemoryIds?.map(xe=>e.find(Oe=>Oe.id===xe)).filter(xe=>!!xe)||[],onNavigateToMemory:_,onUpdateCard:xe=>{n(Fe=>Fe.map(ze=>ze.id===xe.id?xe:ze));const Oe=$o.getInstance();Oe&&Oe.save([xe])},position:y.position}),S.visible&&g.jsx(FYe,{isOpen:S.visible,onClose:M,onConfirm:E,allMemories:e,preselectedIds:S.preselectedIds},"create-index-modal-stable"),C.visible&&C.indexId&&g.jsx(BYe,{isOpen:C.visible,onClose:R,index:e.find(xe=>xe.id===C.indexId),linkedMemories:e.find(xe=>xe.id===C.indexId)?.linkedIds?.map(xe=>e.find(Oe=>Oe.id===xe)).filter(xe=>!!xe)||[],allMemories:e,onNavigateToMemory:k,onUpdateIndex:xe=>{n(Fe=>Fe.map(ze=>ze.id===xe.id?xe:ze));const Oe=$o.getInstance();Oe&&Oe.save([xe])},position:C.position}),g.jsx(UYe,{isOpen:I,onClose:()=>N(!1),onConfirm:D,title:"验证密码以导出",description:"为了您的数据安全，导出操作需要验证访问密码。"}),g.jsx(zYe,{isOpen:F,onClose:()=>L(!1),onValidatePassword:U,onConfirmDanger:j,title:"清空所有记忆",description:"这是高危操作：会清空所有记忆与关联数据，并同步到当前存储。",requiredPhrase:"我确认清除所有记忆"}),ee.visible&&ee.arenaId&&(()=>{const xe=e.find(Oe=>Oe.id===ee.arenaId);return!xe||xe.type!=="arena"?null:g.jsx(qat,{arenaMemory:xe,onSave:ue,onClose:oe,onDelete:Te,onDistillToCard:Ne,allMemories:e,onConvertNodeToMemory:be})})(),g.jsx(Qst,{isOpen:q,arenas:e.filter(xe=>xe.type==="arena"||xe.type==="arena-v2"),onOpenArena:se,onCreateNew:()=>W(!0),onCreateNewV2:()=>J(!0),onClose:()=>Z(!1),onToggleArchive:Q}),g.jsx(not,{isOpen:z,onClose:()=>W(!1),onCreate:X}),g.jsx(qut,{isOpen:H,onClose:()=>J(!1),onCreate:te}),De.visible&&De.arenaMemory&&g.jsx("div",{className:"fixed inset-0 z-[150] bg-black",children:g.jsx(Vut,{arenaMemory:De.arenaMemory,onSave:ke,onClose:Me,onDelete:Ie,onExportNodeToMemory:ce,onDistillToCard:G})}),!ee.visible&&g.jsx("button",{onClick:()=>Z(!0),className:"fixed bottom-20 right-6 z-30 w-12 h-12 rounded-full bg-white/5 hover:bg-white/10 backdrop-blur-sm border border-white/10 hover:border-white/20 text-gray-400 hover:text-white shadow-lg shadow-black/20 hover:shadow-xl hover:shadow-black/30 transition-all duration-300 flex items-center justify-center group arena-float-btn",title:"思维演武场",children:g.jsx("span",{className:"text-xl group-hover:scale-110 transition-transform duration-300",children:"🥋"})}),g.jsx("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes zen-breathe {
                  0%, 100% { 
                    transform: scale(1);
                    opacity: 0.7;
                  }
                  50% { 
                    transform: scale(1.05);
                    opacity: 1;
                  }
                }
                
                .arena-float-btn {
                  animation: zen-breathe 4s ease-in-out infinite;
                }
                
                .arena-float-btn:hover {
                  animation: none;
                }
              `}})]})}class Wut extends P.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error("ErrorBoundary caught an error:",e,n)}render(){return this.state.hasError?this.props.fallback||g.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-b from-[#0f0f1e] to-[#1a1a2e]",children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"text-red-500 text-2xl mb-4",children:"⚠️ 加载出错"}),g.jsx("div",{className:"text-gray-400 text-sm mb-4",children:this.state.error?.message||"发生了未知错误"}),g.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-colors",children:"刷新页面"})]})}):this.props.children}}function Yut({selectedDate:t,isCurrentDateToday:e,onClearSelectedDate:n,filteredMemories:r,relations:i,hasRelations:a,onMemoryContextMenu:s,onMemoryDoubleClick:o,onGhostClick:l,focusMemoryId:u,isPaused:c,sphereRef:d}){return g.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[t&&!e&&g.jsx("div",{className:"absolute top-3 left-1/2 transform -translate-x-1/2 z-20",children:g.jsx("div",{className:"bg-black/20 backdrop-blur-md px-3 py-2 rounded-xl border border-white/5 shadow-lg shadow-black/10",children:g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{children:g.jsxs("div",{className:"text-gray-200 text-xs font-medium tracking-wide",children:[t.getFullYear(),"年",t.getMonth()+1,"月",t.getDate(),"日"]})}),g.jsx("button",{onClick:n,className:"ml-2 text-gray-500 hover:text-gray-200 transition-colors",title:"返回今天（关闭提示）",children:g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),g.jsx("div",{className:"flex-1 relative",children:g.jsx(Wut,{children:g.jsx(awe,{ref:d,memories:r,relations:i,hasRelations:a,onMemoryContextMenu:s,onMemoryDoubleClick:o,onGhostClick:l,focusMemoryId:u,isPaused:c})})})]})}function Xut(){try{const t=localStorage.getItem("memory-relations");if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e.map(n=>{if(!n||typeof n!="object")return null;const r=n,i=typeof r.fromId=="string"?r.fromId:null,a=typeof r.toId=="string"?r.toId:null,s=r.createdAt,o=s?new Date(String(s)):null;return!i||!a||!o||Number.isNaN(o.getTime())?null:{fromId:i,toId:a,createdAt:o}}).filter(n=>!!n):[]}catch{return[]}}function Kut({onValidatePassword:t,githubConfig:e,authToken:n,aiConfig:r}){const i=P.useRef(()=>{}),a=P.useRef(null),[s,o]=P.useState(!1),[l,u]=P.useState(new Date),[c,d]=P.useState(!1);P.useEffect(()=>{try{const H=window.matchMedia("(min-width: 768px)"),J=()=>o(H.matches);return J(),H.addEventListener("change",J),()=>H.removeEventListener("change",J)}catch{}},[]);const{relations:h,addRelation:f,removeRelation:m,getRelatedMemories:x,hasRelations:b,initializeRelations:y,removeRelationsForMemory:w,resetRelations:_}=khe({onSaveRelations:async H=>{try{await Bi.saveRelations(H),console.log(`✅ 关联数据已保存 (${H.length} 条)`)}catch(J){const te=J instanceof Error?J.message:String(J);console.error("❌ 保存关联数据失败:",te),i.current(`保存关联失败: ${te}`,"error",3e3)}}}),S=P.useCallback((H,J,te)=>{i.current(H,J,te)},[]),M=P.useCallback((H,J)=>{y(H,J)},[y]),E=Phe({githubConfig:e,authToken:n,onShowToast:S,onInitializeRelations:M}),C=Dhe({onShowToast:S}),R=Ohe();P.useEffect(()=>{if(typeof window>"u"||!R.arenaV2Editor.visible||!R.arenaV2Editor.arenaMemory)return;const H=R.arenaV2Editor.arenaMemory;if(H.type!=="arena-v2"||H.arenaV2Nodes&&Object.keys(H.arenaV2Nodes).length>0)return;const J=E.memories.find(ee=>ee.id===H.id&&ee.type==="arena-v2"),te=!!J?.arenaV2Nodes&&Object.keys(J.arenaV2Nodes).length>0;!J||!te||R.setArenaV2Editor({visible:!0,arenaMemory:J})},[R.arenaV2Editor.visible,R.arenaV2Editor.arenaMemory,E.memories,R.setArenaV2Editor]),Nhe({memories:E.memories,onUpdateMemories:E.setMemories});const k=uwe(),I=P.useRef(R);P.useEffect(()=>{I.current=R},[R]);const N=P.useCallback(()=>{I.current.setCreateArenaModalOpen(!0)},[]),D=owe({memories:E.memories,setMemories:E.setMemories,onShowToast:S,onAddRelation:f,onOpenArenaEditor:R.openArenaEditor,onCloseArenaEditor:R.closeArenaEditor,onOpenArenaV2Editor:R.openArenaV2Editor,onCloseArenaV2Editor:R.closeArenaV2Editor,onSetArenaV2Editor:R.setArenaV2Editor,onCloseSearchModal:R.closeSearchModal,onOpenCreateArenaModal:N}),F=swe({memories:E.memories,setMemories:E.setMemories,relations:h,selectedDate:l,setSelectedDate:u,inputRef:k.inputRef,inputText:k.inputText,setInputText:k.setInputText,onShowToast:S,onRemoveRelationsForMemory:w,onOpenCardDetail:R.openCardDetailModal,onOpenIndexDetail:R.openIndexDetailModal,onOpenArena:D.handleOpenArena,onOpenSearchModal:R.openSearchModal,onCloseCardDetailModal:R.closeCardDetailModal,onCloseIndexDetailModal:R.closeIndexDetailModal});P.useEffect(()=>{try{const H=Xut();y(H)}catch{}},[y]);const L=P.useRef(!1);P.useEffect(()=>{const H=sessionStorage.getItem("openArenaId");H&&(sessionStorage.removeItem("openArenaId"),setTimeout(()=>{const J=E.memories.find(te=>te.id===H);J&&(J.type==="arena-v2"?(R.setArenaV2Editor({visible:!0,arenaMemory:J}),typeof window<"u"&&window.history.replaceState({arenaId:H,type:"arena-v2"},"",`/memories/arena-v2?id=${H}`)):(R.setArenaEditor({visible:!0,arenaId:H}),typeof window<"u"&&window.history.replaceState({arenaId:H},"",`/memories/arena?id=${H}`)))},1e3))},[E.memories]),P.useEffect(()=>{if(typeof window>"u"||E.memories.length===0||L.current)return;const H=new URL(window.location.href),J=H.pathname,ee=H.searchParams.get("id");if(J.includes("/arena-v2")&&ee){const se=E.memories.find(ue=>ue.id===ee&&ue.type==="arena-v2");se&&(L.current=!0,R.setArenaV2Editor({visible:!0,arenaMemory:se}),window.history.replaceState({arenaId:ee,type:"arena-v2"},"",`/memories/arena-v2?id=${ee}`))}else J.includes("/arena")&&ee&&E.memories.find(ue=>ue.id===ee&&ue.type==="arena")&&(L.current=!0,R.setArenaEditor({visible:!0,arenaId:ee}),window.history.replaceState({arenaId:ee},"",`/memories/arena?id=${ee}`))},[E.memories]),P.useEffect(()=>{const H=J=>{if(J.state?.arenaId)if(J.state?.type==="arena-v2"){const te=E.memories.find(ee=>ee.id===J.state.arenaId);te&&R.setArenaV2Editor({visible:!0,arenaMemory:te}),R.setArenaEditor({visible:!1,arenaId:null})}else R.setArenaEditor({visible:!0,arenaId:J.state.arenaId}),R.setArenaV2Editor({visible:!1,arenaMemory:null});else R.setArenaEditor({visible:!1,arenaId:null}),R.setArenaV2Editor({visible:!1,arenaMemory:null})};return window.addEventListener("popstate",H),()=>window.removeEventListener("popstate",H)},[E.memories]),P.useEffect(()=>{if(!E.isLoaded||E.storageStatus==="syncing"||E.storageStatus==="error"||R.createCardModal.visible||R.createIndexModal.visible||R.searchModal.visible||R.cardDetailModal.visible||R.indexDetailModal.visible||R.arenaEditor.visible||R.arenaV2Editor.visible)return;const J=setTimeout(async()=>{try{await Bi.save(E.memories),console.log(`💾 自动保存完成 (${E.memories.length} 条)`)}catch(te){console.error("❌ 保存失败:",te);const ee=te instanceof Error?te.message:"保存失败，请检查网络连接";ee.includes("不存在")?i.current(`保存失败: ${ee}
请先创建GitHub分支或检查配置`,"error",5e3):i.current(`保存失败: ${ee}`,"error",3e3)}},u2.DEBOUNCE_SAVE_MS);return()=>clearTimeout(J)},[E.memories,E.isLoaded,E.storageStatus,R]);const U=P.useCallback(H=>{u(H),console.log("选中日期:",H),jL(H)&&setTimeout(()=>{k.inputRef.current?.focus()},100)},[k.inputRef]),j=async()=>{try{const H=await Bi.export(),J=new Blob([H],{type:"application/json"}),te=URL.createObjectURL(J),ee=document.createElement("a");ee.href=te,ee.download=`memories-${new Date().toISOString().split("T")[0]}.json`,ee.click(),URL.revokeObjectURL(te),console.log("✅ 导出成功")}catch(H){console.error("❌ 导出失败:",H),alert("导出失败，请重试")}},q=()=>{t?R.setPasswordModalOpen(!0):j()},Z=async H=>{t&&(await t(H),await j())},Q=async()=>{await Bi.clear(),E.setMemories([]),_();try{localStorage.removeItem("memory-relations")}catch{}i.current("已清空所有记忆","success",2500)},z=!l||jL(l),W=P.useCallback(H=>{R.searchModal.memoryId&&f(R.searchModal.memoryId,H)},[R.searchModal.memoryId,f]),X=P.useCallback(H=>{R.searchModal.memoryId&&m(R.searchModal.memoryId,H)},[R.searchModal.memoryId,m]);return g.jsx(dwe,{children:H=>(i.current=H.showToast,g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"w-screen h-screen overflow-hidden relative bg-gradient-to-b from-[#0f0f1e] to-[#1a1a2e]",children:[g.jsx(x$e,{timelineOpen:s,setTimelineOpen:o,focusMode:F.focusMode,visibleMemories:F.visibleMemories,relations:h,selectedDate:l,onDateSelect:U}),g.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[g.jsx(Yut,{selectedDate:l,isCurrentDateToday:z,onClearSelectedDate:()=>u(void 0),filteredMemories:F.filteredMemories,relations:h,hasRelations:b,onMemoryContextMenu:F.handleMemoryContextMenu,onMemoryDoubleClick:F.handleMemoryDoubleClick,onGhostClick:F.handleGhostClick,focusMemoryId:F.focusMemoryId,isPaused:R.searchModal.visible||R.cardDetailModal.visible||R.indexDetailModal.visible||R.arenaEditor.visible,sphereRef:a,hasGhostNodes:F.hasGhostNodes,focusMode:F.focusMode,setFocusMode:F.setFocusMode}),g.jsx(NYe,{storageStatus:E.storageStatus,onStorageRefresh:E.handleStorageRefresh,vectorEngine:C.vectorEngine,onVectorEngineRefresh:C.handleVectorEngineRefresh,cacheStats:E.cacheStats,memories:E.memories,showHidden:F.showHidden,setShowHidden:F.setShowHidden,advancedOpen:c,setAdvancedOpen:d,onCreateIndex:()=>R.openCreateIndexModal(),onExportClick:q,onClearAllRequest:()=>R.setClearAllOpen(!0),onShowToast:(J,te,ee)=>i.current(J,te,ee),selectedDate:l,onDateSelect:U,setFocusMemoryId:F.setFocusMemoryId,hasGhostNodes:F.hasGhostNodes,focusMode:F.focusMode,setFocusMode:F.setFocusMode}),g.jsx(RYe,{inputText:k.inputText,setInputText:k.setInputText,inputRef:k.inputRef,onKeyDown:k.handleKeyDown,onAddMemory:F.handleAddMemory,isCurrentDateToday:z}),g.jsx(Gut,{memories:E.memories,setMemories:E.setMemories,visibleMemories:F.visibleMemories,searchModal:R.searchModal,onCloseSearchModal:R.closeSearchModal,getRelatedMemories:x,onAddRelation:W,onRemoveRelation:X,onDeleteMemory:F.handleDeleteMemory,onUpdateMemory:F.handleUpdateMemory,onCreateCard:R.openCreateCardModal,onCreateIndex:R.openCreateIndexModal,onCreateArenaFromMemory:D.handleCreateArenaFromMemory,createCardModal:R.createCardModal,onCloseCreateCardModal:R.closeCreateCardModal,onConfirmCreateCard:F.handleConfirmCreateCard,cardDetailModal:R.cardDetailModal,onCloseCardDetailModal:R.closeCardDetailModal,onNavigateToSourceMemory:F.handleNavigateToSourceMemory,createIndexModal:R.createIndexModal,onCloseCreateIndexModal:R.closeCreateIndexModal,onConfirmCreateIndex:F.handleConfirmCreateIndex,indexDetailModal:R.indexDetailModal,onCloseIndexDetailModal:R.closeIndexDetailModal,onNavigateToIndexedMemory:F.handleNavigateToIndexedMemory,passwordModalOpen:R.passwordModalOpen,setPasswordModalOpen:R.setPasswordModalOpen,onPasswordConfirm:Z,clearAllOpen:R.clearAllOpen,setClearAllOpen:R.setClearAllOpen,onValidatePassword:t,onClearAllConfirmed:Q,arenaManagerModalOpen:R.arenaManagerModalOpen,setArenaManagerModalOpen:R.setArenaManagerModalOpen,onToggleArenaArchive:D.handleToggleArenaArchive,createArenaModalOpen:R.createArenaModalOpen,setCreateArenaModalOpen:R.setCreateArenaModalOpen,onCreateArena:D.handleCreateArena,createArenaV2ModalOpen:R.createArenaV2ModalOpen,setCreateArenaV2ModalOpen:R.setCreateArenaV2ModalOpen,onCreateArenaV2:D.handleCreateArenaV2,arenaEditor:R.arenaEditor,onOpenArena:D.handleOpenArena,onSaveArena:D.handleSaveArena,onCloseArena:D.handleCloseArena,onDeleteArena:D.handleDeleteArena,onDistillArenaToCard:D.handleDistillArenaToCard,onConvertNodeToMemory:D.handleConvertNodeToMemory,arenaV2Editor:R.arenaV2Editor,onSaveArenaV2:D.handleSaveArenaV2,onCloseArenaV2:D.handleCloseArenaV2,onDeleteArenaV2:D.handleDeleteArenaV2,onExportArenaV2NodeToMemory:D.handleExportArenaV2NodeToMemory,onDistillArenaV2ToCard:D.handleDistillArenaV2ToCard})]})]}),r&&g.jsx(s$e,{aiConfig:r})]}))})}const Lb={encryptedData:"NsKvz+8U1O3r2Pf/79okTqcCOzHF0DsXM9+tuYC4V/3yFXx0MbPty5hCtwbc5c5hAkxH4bvkh/kXAh6ecL1Ycdta5UuJt3mPgA2D8jX1VzKAvb7NsNa/i4g4/0oa",iv:"SZVn6jkbQ5W3g9aT",salt:"INKhzXr3fhvBIPdgGKIeXg==",authTag:"3BjRL7aL8RH3UV+Uy+Nfhw=="},Zut={owner:"kamjin3086",repo:"thineasy",path:"memories.json",branch:"data"},Jut=null;function Uct(){const[t,e]=P.useState(!1),[n,r]=P.useState(""),[i,a]=P.useState(""),[s,o]=P.useState(!1),[l,u]=P.useState(""),[c,d]=P.useState(null),[h,f]=P.useState(null);P.useEffect(()=>{(async()=>{if(t)return;const w=localStorage.getItem("thineasy_auth_token"),_=localStorage.getItem("thineasy_auth_expiry");w&&_&&(Date.now()<parseInt(_)?(d(w),e(!0)):(localStorage.removeItem("thineasy_auth_token"),localStorage.removeItem("thineasy_auth_expiry")))})()},[t]);const m=async()=>{if(!Lb.encryptedData){a("未配置加密数据，请先运行生成脚本并在代码中填入配置。");return}o(!0),a("");try{u("正在验证密码..."),await new Promise(_=>setTimeout(_,50));const y=await S9(n,Lb);let w=null;localStorage.setItem("thineasy_auth_token",y),localStorage.setItem("thineasy_auth_expiry",(Date.now()+360*60*60*1e3).toString()),bP.setConfig(w),f(w),d(y),e(!0)}catch(y){console.error(y);const w=y instanceof Error?y.message:String(y);w.includes("密码错误")||w.includes("corrupted")?a("密码错误，请重试"):a(`解锁失败: ${w}`)}finally{o(!1),u("")}},x=async y=>{try{if(!Lb.encryptedData)throw new Error("未配置加密数据");await S9(y,Lb)}catch{throw new Error("密码错误")}},b=()=>{const y=$o.create({type:"local"});Bi.setStorage(y),e(!0)};return t?g.jsx(Kut,{onValidatePassword:x,githubConfig:Zut,authToken:c,aiConfig:h}):g.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[#0f0f1e] text-white p-3",children:g.jsxs("div",{className:"w-full max-w-md p-5 bg-gray-900/80 backdrop-blur-xl rounded-2xl shadow-2xl border border-gray-700/50",children:[g.jsxs("div",{className:"text-center mb-5",children:[g.jsx("h1",{className:"text-xl font-semibold text-gray-100 mb-2 tracking-tight",children:"记忆空间"}),g.jsx("p",{className:"text-gray-400 text-sm",children:"Thineasy Memory Space"})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("form",{onSubmit:y=>{y.preventDefault(),m()},children:[g.jsx("label",{className:"block text-xs text-gray-500 mb-1 ml-1",children:"访问密码"}),g.jsx("input",{type:"password",value:n,onChange:y=>r(y.target.value),placeholder:"请输入密码解锁云端数据...",autoComplete:"current-password",className:"w-full bg-gray-950/50 border border-gray-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/20 transition-all placeholder-gray-600"})]}),i&&g.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 text-red-400 text-xs flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),i]}),g.jsx("button",{onClick:m,disabled:s||!n,className:"w-full bg-blue-600 hover:bg-blue-500 disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed text-white font-medium py-3 rounded-xl transition-all shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 active:scale-[0.98] flex items-center justify-center gap-2",children:s?g.jsxs(g.Fragment,{children:[g.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[g.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),g.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),g.jsx("span",{children:l||"正在解密..."})]}):"解锁并进入"}),g.jsxs("div",{className:"relative py-2",children:[g.jsx("div",{className:"absolute inset-0 flex items-center",children:g.jsx("div",{className:"w-full border-t border-gray-800"})}),g.jsx("div",{className:"relative flex justify-center text-xs",children:g.jsx("span",{className:"px-2 bg-[#131326] text-gray-600",children:"或者"})})]}),g.jsxs("button",{onClick:b,className:"w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium py-3 rounded-xl transition-all border border-gray-700 hover:border-gray-600 flex items-center justify-center gap-2 text-sm",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),"使用本地存储 (离线模式)"]})]})]})})}export{Uct as default};
