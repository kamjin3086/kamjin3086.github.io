function b(){const e=document.getElementById("docs-search"),t=document.getElementById("docs-nav");!e||!t||e.addEventListener("input",()=>{const o=e.value.trim().toLowerCase();t.querySelectorAll("li").forEach(r=>{const d=(r.textContent?.trim().toLowerCase()??"").includes(o);r.style.display=d?"":"none"})})}function h(){const e=document.getElementById("docs-content"),t=document.getElementById("toc"),o=document.querySelector(".docs-main");if(!e||!t||!o)return;const n=Array.from(e.querySelectorAll("h2, h3"));if(n.length===0){const s=document.querySelector(".docs-title");if(s){const a=document.createElement("p");a.className="toc-empty",a.textContent=s.textContent||"本页无二级标题",t.innerHTML="",t.appendChild(a)}return}const r=document.createDocumentFragment();let i=null;n.forEach(s=>{s.id||(s.id=s.textContent?.trim().toLowerCase().replace(/\s+/g,"-")?.replace(/[^a-z0-9\-]/g,"")??"");const a=document.createElement("li"),u=document.createElement("a");if(u.href=`#${s.id}`,u.textContent=s.textContent??"",u.addEventListener("click",c=>{c.preventDefault();const l=document.getElementById(s.id);if(l){try{l.scrollIntoView({block:"start",behavior:"smooth"})}catch{l.scrollIntoView()}history.replaceState(null,"",`#${s.id}`)}}),a.appendChild(u),s.tagName.toLowerCase()==="h2"){const c=document.createElement("ul");c.className="toc-level toc-level-2",c.appendChild(a),r.appendChild(c),i=c}else{let c=i;c||(c=document.createElement("ul"),c.className="toc-level toc-level-2",r.appendChild(c),i=c);const l=document.createElement("ul");l.className="toc-level toc-level-3",l.appendChild(a),c.appendChild(l)}}),t.innerHTML="",t.appendChild(r);const d=Array.from(t.querySelectorAll("a")),m=new IntersectionObserver(s=>{s.forEach(a=>{const u=a.target.getAttribute("id");if(!u)return;const c=d.find(l=>l.hash===`#${u}`);c&&a.isIntersecting&&(d.forEach(l=>l.classList.remove("active")),c.classList.add("active"))})},{root:o,rootMargin:"0px 0px -60% 0px",threshold:[0,1]});n.forEach(s=>m.observe(s))}function f(){const e=location.pathname.replace(/\/$/,"");document.querySelectorAll("#docs-nav a.nav-link").forEach(t=>{const o=t.getAttribute("href")||"";if(t.classList.remove("active"),o.replace(/\/$/,"")===e){t.classList.add("active");let n=t.parentElement;for(;n;)n.classList.contains("nav-group")&&n.setAttribute("aria-collapsed","false"),n=n.parentElement;try{t.scrollIntoView({block:"nearest"})}catch{}}}),document.querySelectorAll(".nav-group-toggle").forEach(t=>{t.addEventListener("click",()=>{const o=t.closest(".nav-group");if(!o)return;const n=o.getAttribute("aria-collapsed")==="true";o.setAttribute("aria-collapsed",n?"false":"true")})})}function L(){const e=document.createElement("button");e.textContent="↑ 返回顶部",e.setAttribute("type","button"),e.style.position="fixed",e.style.right="18px",e.style.bottom="18px",e.style.zIndex="50",e.style.padding="8px 10px",e.style.borderRadius="10px",e.style.border="1px solid rgba(255,255,255,0.2)",e.style.background="rgba(17,17,17,0.6)",e.style.color="#e5e7eb",e.style.display="none",document.body.appendChild(e),window.addEventListener("scroll",()=>{e.style.display=window.scrollY>300?"block":"none"}),e.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"}))}function S(){const e=document.querySelector(".docs-aside");if(!e)return;const t=sessionStorage.getItem("docs-aside-scroll");t&&(e.scrollTop=parseInt(t,10)||0);const o=()=>{sessionStorage.setItem("docs-aside-scroll",String(e.scrollTop))};e.addEventListener("scroll",o,{passive:!0}),window.addEventListener("beforeunload",o),document.querySelectorAll("#docs-nav a.nav-link").forEach(n=>{n.addEventListener("click",o,{passive:!0})})}function g(){document.querySelector(".docs-main")&&document.getElementById("docs-content")?.addEventListener("click",t=>{const o=t.target;if(!o)return;const n=o.closest("a");if(!n)return;const r=n.getAttribute("href")||"";if(!r.startsWith("#"))return;t.preventDefault();const i=r.slice(1),d=document.getElementById(i);if(d){try{d.scrollIntoView({block:"start",behavior:"smooth"})}catch{d.scrollIntoView()}history.replaceState(null,"",`#${i}`)}})}function y(e){const t=document.querySelector(".docs-main");if(!t)return;const o=e.replace(/^#/,"");if(!o){t.scrollTo({top:0});return}const n=document.getElementById(o);if(!n){t.scrollTo({top:0});return}const r=t.getBoundingClientRect(),i=n.getBoundingClientRect(),d=t.scrollTop+(i.top-r.top)-8;t.scrollTo({top:Math.max(0,d),behavior:"smooth"})}async function p(e,t=!1){if(!document.querySelector(".docs-main"))return;const n=document.getElementById("docs-content"),r=document.querySelector(".docs-header"),i=document.querySelector(".docs-pager");try{const m=await(await fetch(e,{credentials:"same-origin"})).text(),a=new DOMParser().parseFromString(m,"text/html"),u=a.querySelector(".docs-header"),c=a.getElementById("docs-content"),l=a.querySelector(".docs-pager"),v=a.querySelector("title")?.textContent||document.title;u&&r&&(r.innerHTML=u.innerHTML),c&&n&&(n.innerHTML=c.innerHTML),l&&i&&(i.innerHTML=l.innerHTML),document.title=v,t?history.replaceState(null,"",e):history.pushState(null,"",e),h(),f(),g();const E=new URL(e,location.origin).hash||location.hash;requestAnimationFrame(()=>y(E))}catch{location.href=e}}function w(){const e="/chatless/docs";document.querySelectorAll("#docs-nav a.nav-link").forEach(t=>{t.addEventListener("click",o=>{const n=t.getAttribute("href")||"";!n||n.startsWith("http")||n.startsWith("#")||n.startsWith(e)&&(o.preventDefault(),p(n))})}),document.getElementById("docs-content")?.addEventListener("click",t=>{const o=t.target;if(!o)return;const n=o.closest("a");if(!n)return;const r=n.getAttribute("href")||"";!r||r.startsWith("http")||r.startsWith("#")||r.startsWith(e)&&(t.preventDefault(),p(r))}),window.addEventListener("popstate",()=>{p(location.pathname+location.search+location.hash,!0),location.hash&&requestAnimationFrame(()=>y(location.hash))})}document.addEventListener("DOMContentLoaded",()=>{b(),h(),f(),S(),w(),g(),L()});
